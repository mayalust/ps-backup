define(["controllers/controllers","Array"],function(e){"use strict";e.initController("dashboardmanageCtrl",["$scope","$q","$rootScope","$location","$routeParams","$timeout","userRoleUIService","resourceUIService","userLoginUIService","Info","growl","userEnterpriseService","viewFlexService","userDomainService","$window","freeboardservice","dialogue","ngDialog",function(u,c,e,t,n,i,d,f,p,a,m,o,v,b,h,l,r,g){var T,w,s,E,y,I,S,A,_="确定",N="取消",x=n.viewType;u.viewId=n.viewId;var D=function(i,e){var a=this,o={viewId:0,viewTitle:"根层级",children:[]},t={children:[o]},n=function(t){t.viewHierarchy=t.viewHierarchy?t.viewHierarchy:0;var e=function(){};e=a&&t.viewId==a.viewId?function(e){t.parent=e,Object.defineProperty(t,"parent",{enumerable:!1}),e._children||(e._children=[]),e._children.push(t)}:function(e){t.parent=e,Object.defineProperty(t,"parent",{enumerable:!1}),e.children||(e.children=[]),e.children.push(t)};var n=i.find(function(e){return e.viewId==t.viewHierarchy});e(n?t.parent=n:o)};for(var l in i)delete i[l].children,delete i[l]._children;for(var l in i)n(i[l]);return t},O=function(r){var d=w.filter(function(e){return!r||e.viewTitle!=r.viewTitle}).map(function(e){return e.viewTitle}),s=$$.duplicateName("创建告警组",d),e=function(e,i){var a=function(e,t){if(t){var n=t.split(",");for(var i in e)(a=e[i]).value=-1<n.indexOf(a.replacer+"")}var a;return e},o=[{label:"新产生",replacer:0},{label:"已确认",replacer:5},{label:"处理中",replacer:10},{label:"已解决",replacer:20}],l=[{label:"警告",replacer:1,value:!1},{label:"次要",replacer:2,value:!1},{label:"重要",replacer:3,value:!1},{label:"严重",replacer:4,value:!1}],t=function(e){if("0"==e.code){var t,n=null;e.data&&(t=null!=e.data.content?JSON.parse(e.data.content):{},n=e.data.domainPath),u.dialog={title:T+"信息",input:[{label:"告警视图名称",value:r?r.viewTitle:s,data:"viewTitle",type:"input",maxlength:32,composory:!0,events:{change:function(e){-1!=d.indexOf(e.value)?(e.error="告警视图以存在，请更换视图名称",u.dialog.input[0].right=!1):""==e.value?(e.error="视图名称不可为空",u.dialog.input[0].right=!1):(e.error=void 0,u.dialog.input[0].right=!0)}}},{label:"管理域",value:n,data:"domainPath",type:"tree",key:"domainPath",mark:"domainInfos",options:E,composory:!0,disabled:null!=r,right:!!n,fontsize:"12px",width:"200px",events:{change:function(e){e&&(u.dialog.input[1].right=!0)}}},{label:"设备模板",value:r?t.modelIds:null,data:"content/modelIds",type:"multiple",options:i,fontsize:"12px",width:"200px"},{value:r?t.pageSize:1e3,label:"取得告警数量",data:"content/pageSize",type:"number",maxlength:99999999,minlength:0,events:{change:function(e){if(e.value){var t=/^[0-9]*$/.test(e.value);8<e.value.toString().length?(e.error="长度不能大于8位数",u.dialog.input[3].right=!1):u.dialog.input[3].right=t?!(e.error=void 0):!(e.error="请输入整数")}}}},{label:"内容关键词",value:r?t.messageFilter:"",data:"content/messageFilter",maxlength:32,type:"input"},{label:"告警状态",data:"content/states",type:"checkbox",options:a(o,r?t.states:"")},{label:"告警级别",data:"content/severities",type:"checkbox",options:a(l,r?t.severities:"")},{label:"视图描述",value:r?r.description:null,data:"description",type:"textarea",maxlength:200,composory:!1,width:"200px"}],button:[{label:_,icon:"btn btn-primary",disabledFn:function(){return u.dialog.input.some(function(e){return 0==e.right})},fn:function(){g.close();var e,t=function(e){var a={},t=function(e,t){var n;if("checkbox"==t.type){for(var i in n=[],t.options)t.options[i].value&&n.push(t.options[i].replacer);n=n.toString()}else n=t.value;a.$attr(t.data,n)};for(var n in e)t(0,e[n]);return a.content=JSON.stringify(a.content),a}(u.dialog.input);t.viewType=x,e=r?(t.viewId=r.viewId,v.updateView):v.addView,e(t,function(e){if("0"==e.code){var t=e.data;if(r)r.viewTitle=e.data.viewTitle,r.content=e.data.content,r.createTime=e.data.createTime,r.updateTime=e.data.updateTime,r.description=e.data.description,r.creatorName=e.data.creatorName,m.success("告警视图修改成功",{});else{var n,i=e.data.domainPath.split("/"),a=c.defer();2<i.length&&(n=i[i.length-2]),u[n]?u[n].hasOwnProperty("$$state")?u[n].then(function(){t.domainObj=u[n],w.pushbefore(t),m.success("创建告警视图成功",{})}):(t.domainObj=u[n],w.pushbefore(t),m.success("创建告警视图成功",{})):(u[n]=a.promise,b.queryDomainInfo(n,function(e){"0"==e.code&&(u[n]=e.data,t.domainObj=u[n],w.pushbefore(t),m.success("创建告警视图成功",{}))}))}}})}},{label:N,icon:"btn btn-default",fn:function(){g.close()}}]}}};r?v.getViewById(r.viewId,t):t({code:0,data:null}),g.open({template:"../partials/dialogue/config_alert_dia.html",className:"ngdialog-theme-plain",scope:u})};!function t(){null==h.domainlist?b.queryDomainTree(p.user.userID,function(e){0==e.code&&(h.domainlist=e.data,t())}):null==h.rootModel?f.getRootModel(function(e){0==e.code&&(h.rootModel=[],f.getModels(function(e){Array.prototype.push.apply(h.rootModel,e.data),t()}))}):e(h.domainlist,h.rootModel)}(),g.close()},R=function(e){var a=e,t=e.viewTitle,n=(e.content,w.map(function(e){return e.viewTitle})),i=$$.duplicateName(t,n),o=[{label:"创建",icon:"btn btn-primary",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(e){var n=e.input[0].value,t=a.viewId;v.getViewById(t,function(e){if(0==e.code){var t=e.data;t.viewTitle=n,delete t.viewId,delete t.updateTime,v.addView(t,function(e){if(0==e.code){m.success("复制视图成功",{});var t=e.data,n=function(e){var t=e.split("/");if(2<t.length)return t[t.length-2]}(t.domainPath),i=function(){t.template?"project"==t.template.resourceType&&t.template.projectId&&u.allprojects&&(t.templateStr=u.allprojects[t.template.projectId].label):t.templateStr="普通",t.domainObj=u[n],a.insertAfter(t),D(w),g.close()};u[n]?i():b.queryDomainInfo(n,function(e){"0"==e.code&&i()})}})}else m.error(e.message)},function(e){m.error(e)})}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close()}}];u.dialog={title:{label:"复制视图"},input:[{value:i,label:"新视图名称",placeholder:"新视图名称",maxlength:32,onChange:function(e){var t=this.value,n=w.find(function(e){return e.viewTitle==t});o[0].disabled=n?(e.error="此视图名已被占用，请更换.",!0):""==t?(e.error="视图名称不可为空.",!0):(e.error=null,!1)}}],fnlist:o},g.open({template:"../partials/dialogue/common_dia.html",className:"ngdialog-theme-plain",scope:u})},B=function(e,t,n,i){var a=[{label:_,icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){r.close(),v.releaseViews(t,function(e){0==e.code&&(1==t.length?m.success("发布"+T+"成功",{}):m.success("发布"+T+",成功"+e.data.successObj.length+"个,失败"+e.data.failObj.length+"个",{}),i(e.data.successObj))})}},{label:N,icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){r.close()}}];r.open({title:{label:"提示"},description:{label:"确认要发布"+T+"吗？"},fnlist:a})},L=function(e){var n=e,t=e.filter(function(e){return 0==e.releaseStatus}).map(function(e){return e.viewId});e.filter(function(e){return 1==e.releaseStatus}).map(function(e){return e.viewId}),e.map(function(e){return e.viewTitle});B(0,t,0,function(e){for(var t in n)n[t].releaseStatus=1;w.removeAllChecked()})},P=function(e){var t=e,n=e.viewId;e.viewTitle;B(0,[n],e.viewType,function(e){t.releaseStatus=1})},V=function(e,t){var n=t?{component:!0}:{component:!1},i={viewId:e.viewId,values:n};v.updateView(i,function(e){"0"==e.code&&m.success("修改成功")})},M=function(e,n){var i=e;u.maindashboard=e;var t=JSON.parse(e.content),a=e.viewTitle;t.viewId=e.viewId;var o={viewTitle:"dashboard",viewName:"dashboard",viewType:"dashboard",content:JSON.stringify(t)};v.saveManageDashboard(o,function(e){if(0==e.code)if(null!=e.data){for(var t in m.success("设定["+a+"]为运营首页",{}),u.maindashboard=JSON.parse(e.data.content),n)n[t].homeview=!1;i.homeview=!0}else m.error("错误:运营首页保存失败",{});else m.error("错误:"+e.message,{})})},k=function(e){var t=e,n=e.viewId,i=(e.viewTitle,[{label:_,icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close(),v.deleteView(n,function(e){0==e.code&&(m.success(T+"删除成功",{}),t.remove())})}},{label:N,icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close()}}]);u.dialog={title:{label:"提示"},description:{label:"确认要删除"+T+"吗？"},fnlist:i},g.open({template:"../partials/dialogue/common_dia_prompt.html",className:"ngdialog-theme-plain",scope:u})},C=function(e){var n=e,i=[{label:_,icon:"btn btn-primary",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},disabledFn:function(){return this.disabled},fn:function(e){g.close();var t=n.$clone();t.viewTitle=u.dialog.input[0].value,t.description=u.dialog.input[1].value,v.updateView(t,function(e){"0"==e.code&&(n.viewTitle=e.data.viewTitle,n.description=e.data.description,n.updateTime=e.data.updateTime,m.success(T+"修改成功"))})}},{label:N,icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close()}}];u.dialog={title:{label:T+"信息"},input:[{value:e.viewTitle,composory:!0,type:"input",label:T+"名称",placeholder:T+"名称",maxlength:32,onChange:function(e){var t=this.value;-1!=w.filter(function(e){return e.viewId!=n.viewId}).map(function(e){return e.viewTitle}).indexOf(t)?(e.error="此视图名已被占用，请更换.",i[0].disabled=!0):i[0].disabled=""==t?(e.error="视图名称不可为空.",!0):(e.error=null,!1)}},{value:e.description,type:"textarea",maxlength:200,composory:!1,label:"描述信息",placeholder:"新视图名称"}],fnlist:i},g.open({template:"../partials/dialogue/common_dia.html",className:"ngdialog-theme-plain",scope:u})},j="dashboard"==x?function(){h.open("../app-freeboard/index.html#/freeboard/view/dashboard","_blank")}:"configAlert"==x?function(){O()}:"configure"==x?function(e){location.href="../app-configure/index.html#/configure/0"}:"designView"==x?function(){h.open("../app-freeboard/index.html#/editor/view/editor","_blank")}:void 0,$="dashboard"==x?k:"configAlert"==x?k:"configure"==x?function(e){var i=e,a=e.viewId,t=(e.viewTitle,[{label:_,icon:"btn btn-primary",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){r.close(),v.deleteView([a],function(e){if(0==e.code){for(var t in w)(n=w[t]).viewHierarchy==a&&(n.viewHierarchy=0,v.updateView(n,function(e){m.success(T+" [ "+e.data.viewTitle+" ] 的父节点被放回根节点。",{})}));D(w),m.success(T+"删除成功",{}),i.remove()}var n})}},{label:N,icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){r.close()}}]);r.open({title:{label:"提示"},description:{label:"该视图下的子节点将会被移动到根节点下，确认删除？"},fnlist:t})}:"designView"==x?k:void 0,z="dashboard"==x?function(e){var t,n,i=e.template,a=function(){h.open("../app-freeboard/index.html#/freeboard/view/dashboard/"+e.viewId+"/0","_blank")};i&&"default"==i.keyValue?(t=i.resourceId,n={modelId:t},h.open("../app-freeboard/index.html#/template/model/dashboard/"+JSON.stringify(n),"_blank")):a()}:"configAlert"==x?O:"configure"==x?function(e){h.open("../app-configure/index.html#/configure/"+e.viewId,"_blank")}:"designView"==x?function(e){h.open("../app-freeboard/index.html#/editor/view/editor/"+e.viewId,"_blank")}:void 0,U="dashboard"==x?C:"configAlert"==x?O:"configure"==x?function(e){var a=e,i=[{label:_,icon:"btn btn-primary",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(e){var t=e.input[1].value,n=e.input[2].value;n=n||"";var i={viewType:"configure",viewId:a.viewId,viewTitle:e.input[0].value,viewHierarchy:t,description:n};v.updateView(i,function(e){0==e.code&&(m.success("组态视图修改成功",{}),g.close(),a.viewTitle=e.data.viewTitle,a.description=e.data.description,a.viewHierarchy=t,a.createTime=e.data.createTime,a.updateTime=e.data.updateTime,D(w))})}},{label:N,icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close()}}],t=e.viewHierarchy?e.viewHierarchy:0,n=D.call(a,w,a.viewHierarchy);u.dialog={title:{label:T+"信息"},input:[{value:e.viewTitle,composory:!0,type:"input",label:"组态视图名称",placeholder:"组态视图名称",maxlength:32,onChange:function(t){var n=this.value,e=w.find(function(e){return e.viewTitle==n&&e.viewTitle!=t.viewTitle});i[0].disabled=e?(t.error="此视图名已被占用，请更换.",!0):""==n?(t.error="视图名称不可为空.",!0):(t.error=null,!1)}},{value:t,type:"tree",lb:"viewTitle",fontsize:"12px",width:"200px",key:"viewId",mark:"children",composory:!1,label:"选择父级视图",placeholder:"层级结构，例如 0/1",options:n},{value:e.description,type:"textarea",maxlength:200,composory:!1,label:"描述信息",placeholder:"描述信息"}],fnlist:i},g.open({template:"../partials/dialogue/common_dia.html",className:"ngdialog-theme-plain",scope:u})}:"designView"==x?C:void 0,H="dashboard"==x?function(e){h.open("../app-free-style/index.html#/"+e.viewId)}:"configure"==x?function(e){var t=[{viewId:e.viewId}];h.open("../app-free-style/index.html#/topoview/index/"+encodeURIComponent(JSON.stringify(t)),"_blank")}:"designView"==x?function(e){h.open("../app-free-style/index.html#/"+e.viewId)}:"configAlert"==x?function(o){!function t(){null==h.domainlist?b.queryDomainTree(p.user.userID,function(e){0==e.code&&(h.domainlist=e.data,t())}):null==h.rootModel?f.getRootModel(function(e){0==e.code&&(h.rootModel=[],f.getModels(function(e){Array.prototype.push.apply(h.rootModel,e.data),t()}))}):function(){if(o){var n=function(e,t){var n,i=t.split(",");for(var a in e)(n=e[a]).value=-1<i.indexOf(n.replacer+"");return e},i=[{label:"新产生",replacer:0},{label:"已确认",replacer:5},{label:"处理中",replacer:10},{label:"已解决",replacer:20}],a=[{label:"警告",replacer:1,value:!1},{label:"次要",replacer:2,value:!1},{label:"重要",replacer:3,value:!1},{label:"严重",replacer:4,value:!1}];v.getViewById(o.viewId,function(e){if("0"==e.code){var t=JSON.parse(e.data.content);u.dialog={title:T+"信息",input:[{label:"告警组名称",value:o?o.viewTitle:newTitle,data:"viewTitle",type:"text"},{label:"视图描述",value:o?o.description:"",data:"viewTitle",type:"text"},{label:"管理域",value:o?t.domain:null,data:"content/domain",type:"text",format:function(e){var t=s.find(function(e){return e.domainPath==o.domainPath});return t?t.name:"-"}},{label:"设备模板",value:o?t.modelIds:null,data:"content/modelIds",type:"text",format:function(e){return rootModel.filter(function(e){return-1!=t.modelIds.indexOf(e.id)}).map(function(e){return e.label}).toString()}},{value:o?t.pageSize:1e3,label:"取得告警数量",data:"content/pageSize",type:"number"},{label:"内容关键词",value:o?t.messageFilter:"",data:"content/messageFilter",type:"text",format:function(e){return e||"-"}},{label:"告警状态",value:n(i,o?t.states:""),data:"content/states",type:"text",format:function(){var e=this.value.filter(function(e){return 1==e.value}).map(function(e){return e.label});return 0<e.length?e.toString():"-"}},{label:"告警级别",value:n(a,o?t.severities:""),data:"content/severities",type:"text",format:function(){var e=this.value.filter(function(e){return 1==e.value}).map(function(e){return e.label});return 0<e.length?e.toString():"-"}}],button:[{label:"返回",icon:"btn btn-primary",fn:function(){g.close()}}]}}})}}(h.domainlist,h.rootModel)}(),g.open({template:"../partials/dialogue/config_alert_dia.html",className:"ngdialog-theme-plain",scope:u})}:void 0,W="configure"==x?function(e){var l=e,t=e.map(function(e){return e.viewId}),n=(e.map(function(e){return e.viewTitle}),[{label:_,icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close(),v.deleteViews(t,function(e){if(0==e.code){var i=e.$attr("data/successObj"),t=e.$attr("data/failObj");m.success(T+"删除成功"+i.length+"个,失败"+t.length+"个",{});var n=function(e){var t;for(var n in i)t=i[n],e.viewHierarchy==t&&(e.viewHierarchy=0,v.updateView(e,function(e){m.success(T+" [ "+e.data.viewTitle+" ] 的父节点被放回根节点。",{})}))};for(var a in w)n(w[a]);D(w);for(var a in l)o=l[a],-1!=i.indexOf(o.viewId)&&o.remove()}var o})}},{label:N,icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close()}}]);u.dialog={title:{label:"提示"},description:{label:"该视图下的子节点将会被移动到根节点下，确认删除？"},fnlist:n},g.open({template:"../partials/dialogue/common_dia_prompt.html",className:"ngdialog-theme-plain",scope:u})}:function(e){var a=e,t=e.filter(function(e){return e.creator==p.user.userID}),n=t.map(function(e){return e.viewId}),i=(t.map(function(e){return e.viewTitle}),[{label:_,icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close(),v.deleteViews(n,function(e){if(0==e.code){var t=e.$attr("data/successObj");e.$attr("data/failObj");m.success(T+"删除成功"+t.length+"个,失败"+(a.length-t.length)+"个",{});for(var n in a)i=a[n],-1!=t.indexOf(i.viewId)&&i.remove()}var i})}},{label:N,icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){g.close()}}]);u.dialog={title:{label:"提示"},description:{label:"确认要删除此"+T+"吗？"},fnlist:i},g.open({template:"../partials/dialogue/common_dia_prompt.html",className:"ngdialog-theme-plain",scope:u})},q={dashboard:{label:"仪表板视图",viewType:"dashboard",charRoot:"仪表板视图",header:["CREAT","RELEASE","DELETE"],columnDefs:["VIEWTITLE","OWNER","RESTYPE","RELEASESTATUS","COMPONENT","CREATETIME","UPDATETIME","DOMAIN","OPTIONS"],buttons:["BTN_DESIGN","BTN_EDIT","BTN_DELETE","BTN_DUPLICATE","BTN_RELEASE","BTN_VIEW"],active:"dashboard"==x,run:function(e){e()}},configure:{label:"组态视图",charRoot:"组态视图",viewType:"configure",header:["CREAT","RELEASE","DELETE"],columnDefs:["VIEWTITLE","DESCRIPTION","OWNER","RESTYPE","RELEASESTATUS","HIERARCHY","CREATETIME","UPDATETIME","DOMAIN","OPTIONS"],buttons:["BTN_DESIGN","BTN_EDIT","BTN_DELETE","BTN_DUPLICATE","BTN_RELEASE","BTN_VIEW"],active:"configure"==x,run:function(e){e()}},designView:{label:"分析视图",charRoot:"分析视图",viewType:"designView",active:"designView"==x,header:["CREAT","RELEASE","DELETE"],columnDefs:["VIEWTITLE","DESCRIPTION","OWNER","RELEASESTATUS","CREATETIME","UPDATETIME","DOMAIN","OPTIONS"],buttons:["BTN_DESIGN","BTN_EDIT","BTN_DELETE","BTN_DUPLICATE","BTN_RELEASE","BTN_VIEW"],run:function(e){e()}},configAlert:{label:"告警视图",charRoot:"告警视图",viewType:"configAlert",header:["CREAT","RELEASE","DELETE"],columnDefs:["VIEWTITLE","DESCRIPTION","OWNER","RELEASESTATUS","CREATETIME","UPDATETIME","DOMAIN","OPTIONS"],buttons:["BTN_DESIGN","BTN_DELETE","BTN_DUPLICATE","BTN_RELEASE"],active:"configAlert"==x,run:function(e){e()}}};if(u.nav=q,u.viewId)u.viewId;else{T=q[x].charRoot,u.navClick=function(e){t.path("views/"+e)};var F=function(){v.getManagedViewsByTypeAndRole(x,function(e){var t=I.viewType,n=[],o={},a=[],l=e.data;if(0==e.code){var i=function(n){var i=c.defer();"configure"==t&&n.template&&"project"==n.template.resourceType&&a.push(n.template.resourceId);var e=n.viewId;return n.value&&(n.component=n.value.component),n.template&&(n.keyValue=n.template.keyValue),d.findRoleRes({resId:e},function(e){if(0==e.code){var t=e.data.map(function(e){return e.roleId});0<t.length&&(n.bindRoles=S.filter(function(e){return-1!=t.indexOf(e.roleID)}).map(function(e){return e.roleName}).toString()),i.resolve("success")}}),i.promise};for(var r in l)n.push(i(l[r]));c.all(n).then(function(e){var t=function(n){u.allprojects=n;var e=function(t){if(t.template)if("device"==t.template.resourceType)f.getModelByIds([t.template.resourceId],function(e){t.templateStr="模版 : 已删除",e.data&&e.data[0]&&(t.templateStr="模版 : "+(e.data?e.data[0].label:"-"))});else if("project"==t.template.resourceType){if(n){var e=n[t.template.resourceId];e&&(t.templateStr="项目 : "+e.label)}}else t.templateStr="普通";else t.templateStr="普通"};for(var t in l)e(l[t]);w=l,o.source=l,o.rowclass=function(e){if(e.creator!=p.user.userID)return"self"},h.header=[],h.columnDefs=[],h.buttons=[];var i=function(e){var t,n=I[e];for(var i in n)t=n[i],h[e].push(y[t])},a=["header","columnDefs","buttons"];for(var t in a)i(a[t]);for(var t in y.OPTIONS.modes.default.options=h.buttons,o.header=h.header,o.columnDefs=h.columnDefs,y.columnDefs)init(y.columnDefs[t]);u.dataTable=o,c.all(function(e){var t=[],n=function(i){var t,n,a=c.defer(),e=[],o=i.domainPath.split("/");return 2<o.length&&(t=o[o.length-2]),e.push(function(){var t=c.defer();if(i.values&&(i.component=i.values.component),i.template){var n=i.template.resourceId;u["model_"+n]?u["model_"+n].hasOwnProperty("$$state")?u["model_"+n].then(function(){i.modelObj=u["model_"+n],t.resolve("success")}):(i.modelObj=u["model_"+n],t.resolve("success")):$$.cacheAsyncData.call(f.getModelByIds,[[n]],function(e){e&&0==e.code&&(u["model_"+n]=e.data[0],i.modelObj=u["model_"+n]),t.resolve("success")})}else t.resolve("success");return t.promise}(),(n=c.defer(),u[t]?u[t].hasOwnProperty("$$state")?u[t].then(function(){i.domainObj=u[t],n.resolve("success")}):(i.domainObj=u[t],n.resolve("success")):(u[t]=n.promise,b.queryDomainInfo(t,function(e){"0"==e.code&&(u[t]=e.data,i.domainObj=u[t]),n.resolve("success")})),n.promise)),c.all(e).then(function(e){a.resolve("success")}),a.promise};for(var i in e)t.push(n(e[i]));return t}(w)).then(function(){})};0<a.length?f.getResourceByIds(a,function(e){e&&t(e)}):t()})}else m.error(e.message),w=[]})},G=function(e){var t="";return"CREAT"==e?("告警视图"!=T||u.menuitems.A1_S77||(t="ng-hide"),"组态视图"!=T||u.menuitems.A03_S22||(t="ng-hide"),"分析视图"!=T||u.menuitems.A02_S78||(t="ng-hide"),"仪表板视图"!=T||u.menuitems.A04_S21||(t="ng-hide")):"RELEASE"==e?("告警视图"!=T||u.menuitems.A2_S77||(t="ng-hide"),"组态视图"!=T||u.menuitems.A04_S22||(t="ng-hide"),"分析视图"!=T||u.menuitems.A03_S78||(t="ng-hide"),"仪表板视图"!=T||u.menuitems.A04_S21||(t="ng-hide")):"DELETE"==e&&("告警视图"!=T||u.menuitems.A3_S77||(t="ng-hide"),"组态视图"!=T||u.menuitems.A05_S22||(t="ng-hide"),"分析视图"!=T||u.menuitems.A04_S78||(t="ng-hide"),"仪表板视图"!=T||u.menuitems.A05_S21||(t="ng-hide")),t},J=function(e){var t=!0;return"BTN_DESIGN"==e?("分析视图"!=T||u.menuitems.A05_S78||(t=!1),"组态视图"!=T||u.menuitems.A01_S22||(t=!1),"仪表板视图"!=T||u.menuitems.A01_S21||(t=!1),"告警视图"!=T||u.menuitems.A4_S77||(t=!1)):"BTN_DELETE"==e?("告警视图"!=T||u.menuitems.A3_S77||(t=!1),"组态视图"!=T||u.menuitems.A05_S22||(t=!1),"分析视图"!=T||u.menuitems.A04_S78||(t=!1),"仪表板视图"!=T||u.menuitems.A05_S21||(t=!1)):"BTN_EDIT"==e?("告警视图"!=T||u.menuitems.A4_S77||(t=!1),"分析视图"!=T||u.menuitems.A01_S78||(t=!1),"组态视图"!=T||u.menuitems.A06_S22||(t=!1),"仪表板视图"!=T||u.menuitems.A06_S21||(t=!1)):"BTN_DUPLICATE"==e?("告警视图"!=T||u.menuitems.A5_S77||(t=!1),"组态视图"!=T||u.menuitems.A07_S22||(t=!1),"分析视图"!=T||u.menuitems.A06_S78||(t=!1),"仪表板视图"!=T||u.menuitems.A07_S21||(t=!1)):"BTN_RELEASE"==e?("告警视图"!=T||u.menuitems.A2_S77||(t=!1),"组态视图"!=T||u.menuitems.A04_S22||(t=!1),"分析视图"!=T||u.menuitems.A03_S78||(t=!1),"仪表板视图"!=T||u.menuitems.A04_S21||(t=!1)):"BTN_VIEW"==e&&("告警视图"==T&&(t=!1),"组态视图"!=T||u.menuitems.A08_S22||(t=!1),"分析视图"!=T||u.menuitems.A07_S78||(t=!1),"仪表板视图"!=T||u.menuitems.A08_S21||(t=!1)),t},Y=function(e){if("0"==e.code){t=e.data[0],i=[],function e(t){if(i.push(t),t.hasOwnProperty("domainInfos"))for(var n in t.domainInfos)e(t.domainInfos[n])}(t),s=i,E={domainInfos:e.data},y={CREAT:{label:"创建"+T,icon:"fa fa-plus",type:"button",class:"btn btn-primary btn-sm "+G("CREAT"),style:{margin:"2px"},events:{click:j}},DESIGNVIEW:{label:"管理性能视图",icon:"glyphicon glyphicon-new-window",type:"button",class:"btn btn-default btn-sm",style:{margin:"2px"},events:{click:function(){location.href="#/designView2"}}},RELEASE:{label:"发布",icon:"glyphicon glyphicon-new-window",type:"button",class:"btn btn-default btn-sm "+G("RELEASE"),disabled:function(e){return!e||!e.some(function(e){return 1==e.selected&&1!=e.releaseStatus})},style:{margin:"2px"},events:{click:L}},DELETE:{label:"删除",icon:"fa fa-minus",type:"button",disabled:function(e){return!e||!e.some(function(e){return 1==e.selected})},class:"btn btn-default btn-sm "+G("DELETE"),style:{margin:"2px"},events:{click:W}},COMPONENT:{label:"组件",data:"component",type:"toggle",filterable:!1,sortable:!1,format:function(e,t){return"default"==e?"是":"否"},events:{click:V}},TEMPLATE:{label:"默认仪表板",data:"keyValue",type:"text",filterable:!1,sortable:!0,format:function(e,t){return"default"==e?"是":"否"},modes:{default:{type:"text"}}},SETHOME:{label:"首页设置",data:"homeview",type:"sethome",filterable:!1,sortable:!1,width:30,events:{click:M}},VIEWTITLE:{label:"视图名称",data:"viewTitle",type:"text",filterable:!0,sortable:!0,modes:{default:{type:"text"}}},HIERARCHY:{label:"视图层级",data:"viewHierarchy",type:"text",filterable:!1,sortable:!0,modes:{default:{type:"text"}},format:function(e,t){null==A&&(A=D(w));for(var n="",i=t.parent;i;)0!=i.viewId&&(n=i.viewTitle+"/"+n),i=i.parent;return n="/"+n}},RESTYPE:{label:"视图类型",data:"templateStr",type:"text",modes:{default:{type:"text"}},filterable:!1,sortable:!0},DESCRIPTION:{label:"视图描述",data:"description",type:"text",modes:{default:{type:"text"}},format:function(e){return null==e?"-":e},filterable:!1,sortable:!0},OWNER:{label:"绑定角色",data:"bindRoles",type:"select",options:S,filterFormat:{label:"roleName",value:"roleName"},modes:{default:{type:"text"}},filterable:!0,sortable:!1},RELEASESTATUS:{label:"发布状态",data:"releaseStatus",type:"text",modes:{default:{type:"text"}},format:function(e){return null==e?"未发布":0==e?"未发布":1==e?"已发布":"-"},filterable:!1,sortable:!0},CREATETIME:{label:"创建时间",data:"createTime",type:"date",format:"yy-mm-dd hh:nn:ss",filterable:!1,sortable:!0,modes:{default:{type:"date"}}},UPDATETIME:{label:"更新时间",data:"updateTime",type:"date",format:"yy-mm-dd hh:nn:ss",filterable:!1,sortable:!0,modes:{default:{type:"date"}}},DOMAIN:{label:"管理域",type:"tree",sortable:!0,filterable:!0,data:"domainPath",key:"id",mark:"domainInfos",options:E,format:function(e,t){return t.domainObj?t.domainObj.label:"-"},modes:{default:{type:"text"}}},OPTIONS:{label:"操作",width:141,type:"buttonGroup",filterable:!1,sortable:!1,modes:{default:{options:[]}}},BTN_DESIGN:{label:"configAlert"==x?"编辑":"设计",disabled:function(e){return!J("BTN_DESIGN")},type:"button",class:"btn btn-primary",events:{click:z}},BTN_EDIT:{label:"编辑",type:"button",class:"btn btn-default",disabled:function(e){return!J("BTN_EDIT")},events:{click:U}},BTN_DELETE:{label:"删除",type:"button",visible:function(e){return J("BTN_DELETE")},events:{click:$}},BTN_VIEW:{label:"预览",type:"button",visible:function(e){return J("BTN_VIEW")},events:{click:H}},BTN_DUPLICATE:{label:"复制",type:"button",visible:function(e){return J("BTN_DUPLICATE")},events:{click:R}},BTN_RELEASE:{label:"发布",type:"button",visible:function(e){return J("BTN_RELEASE")&&1!=e.releaseStatus},events:{click:P}},BTN_HOME:{label:"设为首页",type:"button",visible:function(e){return!e.homeview},events:{click:M}}},I=q[x];o.queryEnterpriseUser(function(e){0==e.code&&(e.data,I.run(F))})}var t,i};i(function(){o.queryEnterpriseRole(function(e){0==e.code&&(S=e.data,b.queryDomainTree(p.user.userID,Y))})},1e3)}u.bgColorFn=function(e){return{"background-color":e||"#eee"}}}])});
//# sourceMappingURL=../../../map/app-oc/js/controllers/dashboard-management-ctrl.js.map
