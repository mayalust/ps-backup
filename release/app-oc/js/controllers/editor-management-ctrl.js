define(["controllers/controllers","bootstrap-dialog"],function(e,n){"use strict";e.initController("editorManagementCtrl",["$scope","resourceUIService","$q","ngDialog","$location","$routeParams","$timeout","userLoginUIService","Info","growl","configUIService",function(o,e,n,t,a,l,i,r,s,d,c){var u;function p(){o.calcRule=[];c.getConfigsByGroupName("CustomerTools",function(e){console.log(e);for(var n=0;n<e.data.length;n++){var t=JSON.parse(e.data[n].value);t.id=e.data[n].id,t.type=t.type.substring(7),o.calcRule.push(t)}}),console.log(o.calcRule),o.calcRules={source:o.calcRule,showSelector:!1,showIndex:!0,header:[v],columnDefs:[{label:"名称",width:"35%",editable:!0,sortable:!1,filterable:!0,data:"label",type:"text",modes:{default:{type:"text"},edit:{type:"input",placeholder:"例如：请填写用户名，用户名不可为空"}}},{label:"标识",editable:!0,sortable:!1,filterable:!0,data:"type",type:"text",modes:{default:{type:"text"},edit:{type:"input",placeholder:"例如：请填写用户名，用户名不可为空"}}},{label:"操作",type:"buttonGroup",filterable:!1,sortable:!1,width:"100px",modes:{default:{options:g}}}]}}u=function(e){if(e){c.saveConfigGroup({label:"自定义视图组件",name:"CustomerTools"},function(e){console.log(e)})}else p()},c.getAllConfigGroups(function(e){for(var n=!0,t=0;t<e.data.length;t++)if("CustomerTools"==e.data[t].name){n=!1;break}u(n)});var f=!(o.editor={name:"",id:"",json:"",code:""});o.editorManagemengt=function(){if((""==o.editor.name?(d.error("名称不能为空"),0):""!=o.editor.id||(d.error("标识不能为空"),0))&&function(){for(var e=[],n=0;n<o.calcRule.length;n++)e.push(o.calcRule[n].label);if($$.isExistItems(o.editor.name,e))return d.error("名称已经存在"),!1;var t=[];for(n=0;n<o.calcRule.length;n++)t.push(o.calcRule[n].type);return!$$.isExistItems(o.editor.id,t)||(d.error("标识已经存在"),!1)}()){var e=JSON.parse(o.editor.json);if(console.log(e),e.label=o.editor.name,e.type="custom_"+o.editor.id,e.source="CUSTOM_"+o.editor.id.toUpperCase(),f)var n={value:JSON.stringify(e),label:o.editor.name,groupName:"CustomerTools"};else n={value:JSON.stringify(e),label:o.editor.name,groupName:"CustomerTools",id:o.editor.Id};console.log(n),c.saveConfig(n,function(e){console.log(e),p()}),t.close()}},o.closeEditorManagemengt=function(){t.close(),p()};var g=[],m={label:"编辑",type:"button",class:"btn btn-primary",events:{click:function(e){console.log(e),t.open({template:"../partials/dialogue/editor_management_diag.html",className:"ngdialog-theme-plain",scope:o}),o.editor={name:e.label,id:e.source.substring(7),code:e.code,Id:e.id},delete e.label,delete e.$$hashKey,delete e.source,delete e.type,delete e.id,o.editor.json=JSON.stringify(e,null,2),f=!1}}};g.push(m);var b={label:"删除",type:"button",class:"btn btn-default",events:{click:function(n){var e=[{label:"确定",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){t.close();var e=n.id;c.deleteConfig(e,function(e){console.log(e)}),p()}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){t.close()}}];o.dialog={title:{label:"提示"},description:{label:"确认要删除此工具？"},fnlist:e},t.open({template:"../partials/dialogue/common_dia_prompt.html",className:"ngdialog-theme-plain",scope:o})}}};g.push(b);var v={icon:"fa fa-plus",class:"btn btn-warning btn-sm",label:"添加设计器名称",style:{margin:"2px"},type:"button",events:{click:function(e){o.editor={name:"",id:"",json:JSON.stringify({advance:{expression:"express = {\n  on : {\n    init : function(event){\n      var target = event.target;\n      var global = event.global;\n      var hours = ['12a', '1a', '2a', '3a', '4a', '5a', '6a','7a', '8a', '9a', '10a', '11a',\n          '12p', '1p', '2p', '3p', '4p', '5p','6p', '7p', '8p', '9p', '10p', '11p'];\n      var days = ['1', '2', '3','4', '5', '6', '7'];\n      var data = [[12, 0, 10], [3, 3, 15], [4, 3, 20], [10, 1, 12], [3, 0, 14]]\n      var option = {\n        tooltip: {},\n        visualMap: {\n            max: 20,\n            inRange: {\n                color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']\n            }\n        },\n        xAxis3D: {\n            type: 'category',\n            data: hours\n        },\n        yAxis3D: {\n            type: 'category',\n            data: days\n        },\n        zAxis3D: {\n            type: 'value'\n        },\n        grid3D: {\n            boxWidth: 200,\n            boxHeight: 40,\n            boxDepth: 90,\n            light: {\n                main: {\n                    intensity: 1.2\n                },\n                ambient: {\n                    intensity: 0.3\n                }\n            }\n        },\n        series: [{\n            type: 'bar3D',\n            data: data.map(function (item) {\n                return {\n                    value: [item[1], item[0], item[2]]\n                }\n            }),\n            shading: 'color',\n\n            label: {\n                show: false,\n                textStyle: {\n                    fontSize: 16,\n                    borderWidth: 1\n                }\n            },\n\n            itemStyle: {\n                opacity: 0.8\n            },\n\n            emphasis: {\n                label: {\n                    textStyle: {\n                        fontSize: 20,\n                        color: '#900'\n                    }\n                },\n                itemStyle: {\n                    color: '#900'\n                }\n            }\n        }]\n    }\n    //   target.line3DOption()  3D 折线图\n    //   target.bar3DOption()  3D  柱状图\n    //   target.scatter3DOption()  3D 散点图\n      event.target.render(option);\n    }\n  }\n}"},style:{margin:"auto",width:"100%",height:"300px"}},null,2),code:'function tool(data) {\n  var element = data.element;\n  var global = data.global;\n  var target = $("<div></div>");\n  var route = data.route;\n  if(element.style) {\n    target.css(element.style);\n  };\n  var expression;\n  $$.runExpression(element.$attr("advance/expression"), function(funRes) {\n    if(funRes.code == "0") {\n      var fnResult = funRes.data;\n      if(typeof fnResult == \'function\') {\n        expression = fnResult(data, system);\n      } else {\n        expression = fnResult;\n      }\n      expression = expression ? expression : {};\n    } else {\n      expression = {};\n      console.log(funRes.message);\n      //throw new Error(funRes.message);\n    }\n  });\n  var clickFn = expression.$attr("on/click");\n  var initFn = expression.$attr("on/init");\n  target.on("click", function(event){\n    if(typeof clickFn == "function"){\n      target.css("cursor", "pointer");\n      if(route.current.$$route.controller != "freeBoardCtrl"){\n        clickFn({\n          target : element,\n          global : global\n        })\n      };\n    }\n  });\n  var render = function(){\n  };\n  element.render = render\n  if(initFn){\n    try {\n      initFn({\n        target : element,\n        global : global\n      })\n    } catch(e){\n      element.growl(e.message, "warning");\n    }\n  } else {\n    render();\n  };\n  return target;\n}'},t.open({template:"../partials/dialogue/editor_management_diag.html",className:"ngdialog-theme-plain",scope:o}),f=!0}}}}])});
//# sourceMappingURL=../../../map/app-oc/js/controllers/editor-management-ctrl.js.map
