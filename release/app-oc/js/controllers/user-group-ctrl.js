define(["controllers/controllers","bootstrap-dialog"],function(e,d){"use strict";e.initController("userGroupCtrl",["$scope","userInitService","$location","$routeParams","$timeout","userLoginUIService","Info","growl","userEnterpriseService",function(s,u,e,r,o,t,i,n,p){s.activeListTab="tab3",s.queryGroupList="",s.selectedGroup="",s.formReg={name:"",desc:""},s.userGroupList={},s.userGridData={},s.groupsAry=[],p.queryEnterpriseGroup(function(e){0==e.code&&(s.queryGroupList=e.data,s.selectedGroup=e.data[0])}),s.addGroup=function(){var e=[];for(var r in s.queryGroupList){var u=s.queryGroupList[r];if(e.push(u),0==u.groupID)return void n.warning("当前有未保存用户组",{})}s.activeListTab="tab3";var o;(o={}).groupName="",o.groupID=0,o.description="",o.enterpriseID=t.user.enterpriseID,c(o.groupID),s.queryGroupList.unshift(o),s.selectedGroup=o},s.delGroup=function(){if(0==s.selectedGroup.groupID){var e=[];for(var r in s.queryGroupList)s.selectedGroup.groupID!=s.queryGroupList[r].groupID&&e.push(s.queryGroupList[r]);return s.queryGroupList=e,s.selectedGroup=s.queryGroupList[0],void n.success("删除用户组成功",{})}d.show({title:"提示",closable:!1,message:"确认删除 "+s.selectedGroup.groupName+" 吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){s.selectedGroup&&(u.deleteGroup(s.selectedGroup.groupID,function(e){if(0==e.code){var r=[];for(var u in s.queryGroupList)s.selectedGroup.groupID!=s.queryGroupList[u].groupID&&r.push(s.queryGroupList[u]);s.queryGroupList=r,n.success("删除用户组成功",{}),0<r.length?s.groupClick(s.queryGroupList[0]):s.selectedGroup=null}else n.success("删除用户组失败",{})}),e.close())}},{label:"取消",action:function(e){e.close()}}]})},s.doAction=function(e,r){if("saveUser"==e){if(""==r||null==r)return void n.warning("请选择用户",{});p.addUser2UserGroup(s.selectedGroup.groupID,t.user.enterpriseID,[r],function(e){0==e.code?(n.success("添加用户到用户组成功",{}),c(s.selectedGroup.groupID)):n.warning("用户已经存在该用户组中，添加失败",{})})}else"removeUser"==e?d.show({title:"提示",closable:!1,message:'确认将用户 "'+r.userName+'"移出" '+s.selectedGroup.groupName+'" 用户组吗？',buttons:[{label:"确定",cssClass:"btn-success",action:function(e){p.deleteUser2UserGroup(s.selectedGroup.groupID,[r.userID],function(e){0==e.code?(n.success("用户组移出用户成功",{}),c(s.selectedGroup.groupID)):n.warning("该用户移出失败",{})}),e.close()}},{label:"取消",action:function(e){e.close()}}]}):"cancel"==e&&(n.success("已取消添加用户组用户",{}),c(s.selectedGroup.groupID))},s.saveUserGrop=function(){if(0==s.formReg.name&&0==s.formReg.desc){if(""==s.selectedGroup.groupName)return void(s.formReg.name="1000");if(0==s.selectedGroup.groupID){for(var e in s.queryGroupList)if(s.selectedGroup.groupName==s.queryGroupList[e].groupName&&0!=s.queryGroupList[e].groupID)return void n.warning("您输入的用户组名称已存在，请重新输入",{});s.selectedGroup.groupName=$.trim(s.selectedGroup.groupName),s.selectedGroup.description=$.trim(s.selectedGroup.description),p.addGroup(s.selectedGroup,function(e){if(0==e.code){var r=[];for(var u in s.queryGroupList)0!=s.queryGroupList[u].groupID?r.push(s.queryGroupList[u]):r.push(e.data);s.queryGroupList=r,s.groupClick(e.data),s.selectedGroup=e.data,n.success("新增用户组成功",{})}else n.success("新增用户组失败",{})})}else{for(var e in s.queryGroupList)if(s.queryGroupList[e].groupID!=s.selectedGroup.groupID&&s.selectedGroup.groupName==s.queryGroupList[e].groupName)return void n.warning("当前有重复用户组名称，请修改",{});if(""==s.selectedGroup.groupName)return void(s.formReg.name="1000");s.selectedGroup.groupName=$.trim(s.selectedGroup.groupName),s.selectedGroup.description=$.trim(s.selectedGroup.description),p.modifyGroupInfo(s.selectedGroup,function(e){if(0==e.code){var r=[];for(var u in s.queryGroupList)s.queryGroupList[u].groupID!=s.selectedGroup.groupID?r.push(s.queryGroupList[u]):r.push(e.data);s.queryGroupList=r,s.selectedGroup=e.data,n.success("修改用户组成功",{})}else n.success("修改用户组失败",{})})}}},s.groupClick=function(e){s.selectedGroup=e,c(e.groupID)},s.$watch("selectedGroup.groupName",function(e,r){if(s.formReg.name="0",null!=s.selectedGroup){var u=$.trim(e);""!=u&&null!=u||(s.formReg.name="0")}}),s.$watch("selectedGroup.description",function(e,r){if(s.formReg.desc="0",null!=s.selectedGroup){var u=$.trim(e);""!=u&&null!=u||(s.formReg.desc="0")}}),s.addGroupUser=function(){if(null!=s.selectedGroup)if(0!=s.selectedGroup.groupID){var e={userName:"选择用户",emailAddress:"",mobilePhone:"",officePhone:"",groupID:0,domainId:"",userEmail:"",domainPath:"",isEdit:2,userType:2,userTypeLabel:"普通用户",jobTitle:"",discription:"",edit:"",userID:null};if(!(0<s.userGroupList.data.length))return s.userGroupList.data.unshift(e),void s.$broadcast(Event.USERGROUPINIT,s.userGroupList);if(s.userGroupList.data.length!=s.enterpriseUser.length)for(var r in s.userGroupList.data)return null==s.userGroupList.data[r].userID?n.warning("请先保存用户再进行添加",{}):s.userGroupList.data.unshift(e),void s.$broadcast(Event.USERGROUPINIT,s.userGroupList);else n.warning("您已经没有用户可以添加",{})}else n.warning("请先保存新添加的用户组，再进行以下操作",{})};var a=function(){$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var r=$(e.target).attr("name");$(e.target).text();if(s.activeListTab=r,s.$apply(),"tab4"==r&&null!=s.selectedGroup){if(null==s.selectedGroup.groupID)return n.warning("请先添加用户组再进行切换",{}),void(s.userGroupList.data=null);if(0==s.selectedGroup.groupID)return;c(s.selectedGroup.groupID)}})},c=function(e){p.queryGroupUser(e,function(e){if(0==e.code){for(var r in e.data){var u=e.data[r];u.isEdit=0,null==u.emailAddress||""==u.emailAddress?u.userEmail=u.mobilePhone:u.userEmail=u.emailAddress}s.userGroupList.data=e.data,s.$broadcast(Event.USERGROUPINIT,s.userGroupList)}else n.warning("查询用户信息失败",{})})},l=function(){p.queryEnterpriseUser(function(e){0==e.code&&(s.enterpriseUser=e.data)})};t.user.isAuthenticated?(a(),l()):s.$on("loginStatusChanged",function(e,r){t.user.isAuthenticated&&(a(),l())})}])});
//# sourceMappingURL=../../../map/app-oc/js/controllers/user-group-ctrl.js.map
