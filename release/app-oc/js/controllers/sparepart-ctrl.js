define(["controllers/controllers","bootstrap-dialog"],function(e,I){"use strict";e.initController("sparePartInfoCtrl",["$scope","ngDialog","$location","$routeParams","$timeout","sparePartUIService","userEnterpriseService","userLoginUIService","Info","growl",function(n,e,t,a,s,i,r,d,c,o){n.selecteditem=!0,n.spareInfoList=[],n.allSpareInfos=[],n.editStatus=3,n.ifRouteParams=0,n.queryState=1;n.addSpareInfo=function(){for(var e in n.editStatus=3,n.spareInfoList)if(0==n.spareInfoList[e].id||2==n.spareInfoList[e].isEdit)return void o.warning("已存在正在编辑的备件信息",{});n.spareInfoList.push({name:"",unit:"",model:"",label:"",desc:"",originalNumber:"",upperLimit:"",lowerLimit:"",id:0,isEdit:2}),function(e){var t=[];for(var a in e){var r=e[a],s=jQuery.extend(!0,{},r);s.isEdit=s.isEdit?s.isEdit:0,s.id=r.id,s.name=r.name,s.label=r.label,s.unit=r.unit,s.desc=r.desc,s.originalNumber=r.originalNumber,s.upperLimit=r.upperLimit,s.lowerLimit=r.lowerLimit,t.push(s)}n.$broadcast(Event.SPAREINFOINIT,{option:[t]})}(n.spareInfoList)},n.doActionInfo=function(e,t,a){if("savespareInfo"==e){if(""==t||null==t)return void o.warning("请填写完整备件信息",{});var r={};r=0<t.id?{name:t.name,unit:t.unit,model:t.model,label:t.label,desc:t.desc,originalNumber:t.originalNumber,upperLimit:t.upperLimit,lowerLimit:t.lowerLimit,id:t.id}:{name:t.name,unit:t.unit,model:t.model,label:t.label,desc:t.desc,originalNumber:t.originalNumber,upperLimit:t.upperLimit,lowerLimit:t.lowerLimit},i.saveSparePart(r,function(e){if(0==e.code)return 0<t.id?o.success("已成功修改此备件信息",{}):o.success("已成功添加备件信息",{}),void u()})}else"deletespareInfo"==e?I.show({title:"提示",closable:!1,message:"确认删除此备件信息吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){i.deleteSparePart(t.id,function(e){if(0==e.code)return o.success("成功删除此备件信息",{}),void u()}),e.close()}},{label:"取消",action:function(e){e.close()}}]}):"cancel"==e?u():"showStockOrder"==e&&(n.SpareName=t.name,l(t.id))};var l=function(e){i.getStockOrderItemsBySparePartId(e,function(e){if(0==e.code){var t=[];for(var a in e.data){var r={};r.handlerPerson=e.data[a].stockOder.handlerPerson,r.name=e.data[a].stockOder.name,r.createTime=e.data[a].stockOder.createTime,r.category=e.data[a].stockOder.category,r.sparePartNumber=e.data[a].sparePartNumber,t.push(r)}s(function(){n.$broadcast(Event.SPAREINFOINIT+"record",{option:[t]})})}})},u=function(){i.getAllSpareParts(function(e){if(0==e.code){for(var t in n.allSpareInfos=e.data,n.spareInfoList=[],n.spareInfos=[],e.data){var a=e.data[t];a.isEdit=0,n.spareInfoList.push(a)}n.$broadcast(Event.SPAREINFOINIT,{option:[n.spareInfoList]})}})},p=function(){var e;a.spareinfoId?(n.ifRouteParams=2010,(e=a.spareinfoId)?i.getSparePartById(e,function(e){if(0==e.code){var t=[];isArray(e.data)?t=e.data:null==e.data?t=[]:t.push(e.data),s(function(){n.$broadcast(Event.SPAREINFOINIT,{option:[t]})})}}):o.info("此备件信息不存在",{})):u()};p(),n.getEvent=function(){1==n.queryState?p():2==n.queryState?s(function(){n.$broadcast("spareIn")}):3==n.queryState&&s(function(){n.$broadcast("spareOut")})},n.getEvent()}]),e.initController("spareInPartCtrl",["$scope","ngDialog","$location","$routeParams","$timeout","sparePartUIService","userEnterpriseService","userLoginUIService","Info","growl",function(n,e,t,a,r,i,s,d,c,o){n.selecteditem=!0,n.spareInLists=[],n.$parent.selectedSparecalInList=[],n.$parent.ifSubmitIn=0,n.selectedConItem={},n.createTime="",n.$parent.selected={sparePartId:"",stockOrderId:""},n.relatedDeviceList=[],n.$on("spareIn",function(){u(),p()});function l(e){i.getStockOrderItemsById(e,function(e){0==e.code&&(n.$parent.selectedSparecalInList=e.data,r(function(){n.$parent.$broadcast(Event.INSPARECLAUSESINIT,{option:[e.data]})}))})}n.addspareIn=function(){for(var e in n.spareInLists)if(0==n.spareInLists[e].id)return void o.warning("已存在正在编辑的入库单",{});n.spareInLists.unshift({name:"",handlerPerson:"",createTime:"",desc:"",id:0,isEdit:2}),function(e){var t=[];for(var a in e){var r=e[a],s=jQuery.extend(!0,{},r);s.isEdit=s.isEdit?s.isEdit:0,s.id=r.id,s.name=r.name,s.handlerPerson=r.handlerPerson,s.createTime=r.createTime,s.desc=r.desc,t.unshift(s)}n.$broadcast(Event.SPAREININIT,{option:[t]})}(n.spareInLists)},n.doActionIns=function(e,r,s){if("cancel"==e)p();else if("saveSpareIn"==e){for(var t=n.spareInLists.length-1;-1<t;t--)0==n.spareInLists[t].id?n.spareInLists.splice(t,1):n.spareInLists[t].isEdit=0;if(""!=r&&null!=r){var a={};a=0<r.id?{name:r.name,handlerPerson:r.handlerPerson,createTime:r.createTime,desc:r.desc,id:r.id}:{name:r.name,handlerPerson:r.handlerPerson,createTime:r.createTime,desc:r.desc},i.saveInStockOrder(a,function(e){if(0==e.code&&(s(e.data),0<r.id)){o.success("已成功保存入库单",{});var t=-1;for(var a in n.spareInLists)if(n.spareInLists[a].id==r.id){t=r.id,n.spareInLists[a]=jQuery.extend(!0,{},e.data);break}-1==t&&n.spareInLists.push(e.data)}})}}else"deleteSpareIn"==e?I.show({title:"提示",closable:!1,message:"确认删除此入库单吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){i.deleteStockOrder(r.id,function(e){0==e.code&&o.success("成功删除此入库单",{}),p()}),e.close()}},{label:"取消",action:function(e){e.close()}}]}):"showSpareList"==e&&(n.$parent.selSpareName=r.name,l(r.id),n.$parent.selected.stockOrderId=r.id,r.commit?n.$parent.ifSubmitIn=2010:n.$parent.ifSubmitIn=0)},n.$parent.doActionIn=function(e,t,a){if("saveSpareInCaluses"==e){if(""!=t&&null!=t){var r={};r=0<t.id?{sparePartId:t.sparePartId,stockOrderId:n.$parent.selected.stockOrderId,sparePartNumber:t.sparePartNumber,desc:t.desc,id:t.id}:{sparePartId:t.sparePartId,stockOrderId:n.$parent.selected.stockOrderId,sparePartNumber:t.sparePartNumber,desc:t.desc},i.saveStockOrderItem(r,function(e){if(0==e.code)return 0<t.id?o.success("已成功修改此库单条目",{}):o.success("已成功添加入库单条目",{}),void l(n.$parent.selected.stockOrderId)})}}else if("cancel"==e){for(var s=n.$parent.selectedSparecalInList.length-1;-1<s;s--)0==n.$parent.selectedSparecalInList[s].id?n.$parent.selectedSparecalInList.splice(s,1):n.$parent.selectedSparecalInList[s].isEdit=0;n.$parent.$broadcast(Event.INSPARECLAUSESINIT,{option:[n.$parent.selectedSparecalInList]})}else"deleteStockOrderItem"==e&&I.show({title:"提示",closable:!1,message:"确认删除此条目吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){i.deleteStockOrderItem(t.id,function(e){return 0==e.code?(o.success("成功删除此条目",{}),void l(n.$parent.selected.stockOrderId)):void o.warning("删除此条目失败",{})}),e.close()}},{label:"取消",action:function(e){e.close()}}]})},n.$parent.addInSpareClauseItem=function(){for(var e in n.$parent.selectedSparecalInList)if(0==n.$parent.selectedSparecalInList[e].id)return void o.warning("已存在正在编辑的条目",{});n.$parent.selectedSparecalInList.push({sparePartName:"",sparePartNumber:"",desc:"",id:0,isEdit:2}),function(e){var t=[];for(var a in e){var r=e[a],s=jQuery.extend(!0,{},r);s.isEdit=s.isEdit?s.isEdit:0,s.id=r.id,s.sparePartName=r.sparePartName,s.handlerPerson=r.handlerPerson,s.desc=r.desc,t.unshift(s)}n.$parent.$broadcast(Event.INSPARECLAUSESINIT,{option:[t]})}(n.$parent.selectedSparecalInList)},n.submitInCaluses=function(){var e=n.$parent.selected.stockOrderId;if(e){var t=[e,!0];i.commitStockOrder(t,function(e){0==e.code?(o.success("已成功提交此入库单",{}),p(),n.$parent.ifSubmitIn=2010):20622==e.code&&p()})}};var u=function(){i.getAllSpareParts(function(e){0==e.code&&(n.spareInfos=e.data)})},p=function(e){a.spareInId?i.getInStockOrdersByhandlerId(a.spareInId,function(e){if(0==e.code){for(var t in n.spareInLists=e.data,e.data)n.spareInLists[t].isEdit=0;r(function(){n.$parent.$broadcast(Event.SPAREININIT,{option:[n.spareInLists]})})}}):i.getAllInStockOrders(function(e){if(0==e.code){for(var t in n.spareInLists=e.data,e.data)n.spareInLists[t].isEdit=0;r(function(){n.$parent.$broadcast(Event.SPAREININIT,{option:[n.spareInLists]})})}})}}]),e.initController("spareOutPartCtrl",["$scope","ngDialog","$location","$routeParams","$timeout","sparePartUIService","userEnterpriseService","userLoginUIService","Info","growl",function(n,e,t,a,r,i,s,d,c,o){n.selecteditem=!0,n.spareOutLists=[],n.$parent.selectedSparecalOutList=[],n.$parent.ifSubmitOut=0,n.selectedConItem={},n.$parent.selected={sparePartId:"",stockOrderId:""},n.$on("spareOut",function(){u(),p()});function l(e){i.getStockOrderItemsById(e,function(e){0==e.code&&(n.$parent.selectedSparecalOutList=e.data,r(function(){n.$parent.$broadcast(Event.OUTSPARECLAUSESINIT,{option:[e.data]})}))})}n.addspareOut=function(){for(var e in n.spareOutLists)if(0==n.spareOutLists[e].id)return void o.warning("已存在正在编辑的出库单",{});n.spareOutLists.push({name:"",handlerPerson:"",createTime:"",desc:"",id:0,isEdit:2}),function(e){var t=[];for(var a in e){var r=e[a],s=jQuery.extend(!0,{},r);s.isEdit=s.isEdit?s.isEdit:0,s.id=r.id,s.name=r.name,s.handlerPerson=r.handlerPerson,s.createTime=r.createTime,s.desc=r.desc,t.push(s)}n.$parent.$broadcast(Event.SPAREOUTINIT,{option:[t]})}(n.spareOutLists)},n.doAction=function(e,r,s){if("cancel"==e)p();else if("saveSpareOut"==e){for(var t=n.spareOutLists.length-1;-1<t;t--)0==n.spareOutLists[t].id?n.spareOutLists.splice(t,1):n.spareOutLists[t].isEdit=0;if(""!=r&&null!=r){var a={};a=0<r.id?{name:r.name,handlerPerson:r.handlerPerson,createTime:r.createTime,desc:r.desc,id:r.id}:{name:r.name,handlerPerson:r.handlerPerson,createTime:r.createTime,desc:r.desc},i.saveOutStockOrder(a,function(e){if(0==e.code&&(s(e.data),0<r.id)){o.success("已成功保存出库单",{});var t=-1;for(var a in n.spareOutLists)if(n.spareOutLists[a].id==r.id){t=r.id,n.spareOutLists[a]=jQuery.extend(!0,{},e.data);break}-1==t&&n.spareOutLists.push(e.data)}})}}else"deleteSpareOut"==e?I.show({title:"提示",closable:!1,message:"确认删除此出库单吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){i.deleteStockOrder(r.id,function(e){0==e.code&&o.success("成功删除此出库单",{}),p()}),e.close()}},{label:"取消",action:function(e){e.close()}}]}):"showSpareList"==e&&(n.$parent.selSpareName=r.name,l(r.id),n.$parent.selected.stockOrderId=r.id,r.commit?n.$parent.ifSubmitOut=2010:n.$parent.ifSubmitOut=0)},n.$parent.doActionOut=function(e,t,a){if("saveSpareOutCaluses"==e){if(""!=t&&null!=t){var r={};r=0<t.id?{sparePartId:t.sparePartId,stockOrderId:n.$parent.selected.stockOrderId,sparePartNumber:t.sparePartNumber,desc:t.desc,id:t.id}:{sparePartId:t.sparePartId,stockOrderId:n.$parent.selected.stockOrderId,sparePartNumber:t.sparePartNumber,desc:t.desc},i.saveStockOrderItem(r,function(e){if(0==e.code)return 0<t.id?o.success("已成功修改此库单条目",{}):o.success("已成功添加库单条目",{}),void l(n.$parent.selected.stockOrderId)})}}else if("cancel"==e){for(var s=n.$parent.selectedSparecalOutList.length-1;-1<s;s--)0==n.$parent.selectedSparecalOutList[s].id?n.$parent.selectedSparecalOutList.splice(s,1):n.$parent.selectedSparecalOutList[s].isEdit=0;n.$parent.$broadcast(Event.OUTSPARECLAUSESINIT,{option:[n.$parent.selectedSparecalOutList]})}else"deleteStockOrderItem"==e&&I.show({title:"提示",closable:!1,message:"确认删除此条目吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){i.deleteStockOrderItem(t.id,function(e){return 0==e.code?(o.success("成功删除此条目",{}),void l(n.$parent.selected.stockOrderId)):void o.warning("删除此条目失败",{})}),e.close()}},{label:"取消",action:function(e){e.close()}}]})},n.$parent.addOutSpareClauseItem=function(){for(var e in n.$parent.selectedSparecalOutList)if(0==n.$parent.selectedSparecalOutList[e].id)return void o.warning("已存在正在编辑的条目",{});n.$parent.selectedSparecalOutList.push({sparePartName:"",sparePartNumber:"",desc:"",id:0,isEdit:2}),function(e){var t=[];for(var a in e){var r=e[a],s=jQuery.extend(!0,{},r);s.isEdit=s.isEdit?s.isEdit:0,s.id=r.id,s.sparePartName=r.sparePartName,s.handlerPerson=r.handlerPerson,s.desc=r.desc,t.push(s)}n.$parent.$broadcast(Event.OUTSPARECLAUSESINIT,{option:[t]})}(n.$parent.selectedSparecalOutList)},n.submitOutCaluses=function(){var e=n.$parent.selected.stockOrderId;e&&function t(a){i.commitStockOrder(a,function(e){0==e.code&&(0<e.data.length?I.show({title:"提示",closable:!1,message:"此库单显示备件不足,仍确定提交此库单吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){t([a[0],!1]),p(),e.close()}},{label:"取消",action:function(e){e.close()}}]}):(o.success("已成功提交此出库单",{}),p()))})}([e,!0])};var u=function(){i.getAllSpareParts(function(e){0==e.code&&(n.spareInfos=e.data)})},p=function(){a.spareInId?i.getOutStockOrdersByhandlerId(a.spareInId,function(e){if(0==e.code){for(var t in n.spareOutLists=e.data,e.data)n.spareOutLists[t].isEdit=0;r(function(){n.$parent.$broadcast(Event.SPAREOUTINIT,{option:[n.spareOutLists]})})}}):i.getAllOutStockOrders(function(e){if(0==e.code){for(var t in n.spareOutLists=e.data,e.data)n.spareOutLists[t].isEdit=0;r(function(){n.$parent.$broadcast(Event.SPAREOUTINIT,{option:[n.spareOutLists]})})}})}}])});
//# sourceMappingURL=../../../map/app-oc/js/controllers/sparepart-ctrl.js.map
