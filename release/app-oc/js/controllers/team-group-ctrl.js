define(["controllers/controllers","bootstrap-dialog"],function(e,L){"use strict";e.initController("teamGroupCtrl",["$scope","solutionUIService","userInitService","ngDialog","kpiDataService","viewFlexService","resourceUIService","userDomainService","$location","$routeParams","$timeout","userEnterpriseService","userLoginUIService","Info","growl","maintenanceUIService",function(s,e,t,r,i,o,a,n,u,c,d,l,p,m,G,f){function v(){s.selectedAlertitem={domain:"",nodeType:"",id:""}}function g(e){f.getUsersByTeamId(e,function(e){if(0==e.code){for(var t in e.data){var r=e.data[t];null==r.emailAddress||""==r.emailAddress?r.userEmail=r.mobilePhone:r.userEmail=r.emailAddress}s.teamGroupList=e.data,s.$broadcast(Event.TEAM2USERINIT,{option:[s.teamGroupList]})}})}s.activeListTab="tab3",s.queryGroupList=[],s.selectedGroup="",s.formReg={name:"",workArea:""},s.teamGroupList={},s.userGridData={},s.groupsAry=[],s.selectedTeamDevices=[],s.relatedDeviceList=[],s.teamTypes=[{teamType:"巡检组",typeName:"巡检组"},{teamType:"保安组",typeName:"保安组"}],s.domainListDic={},s.domainListTree=null,s.routePathNodes={},s.rootModel=[],s.rootModelDic={},s.selectedDeviceIds=[],s.selectedDitem={label:[],types:[]},s.selectedDeviceList=[],f.getAllTeams(function(e){0==e.code&&(s.queryGroupList=e.data,s.selectedGroup=e.data[0])}),s.addTeamGroup=function(){var e=[];for(var t in s.queryGroupList){var r=s.queryGroupList[t];if(e.push(r),0==r.id)return void G.warning("当前有未保存班组",{})}s.activeListTab="tab3";var i;(i={}).name="",i.id=0,i.workArea="",i.remark="",i.teamType="",s.queryGroupList.unshift(i),s.selectedGroup=i},s.delTeamGroup=function(){if(0==s.selectedGroup.id){var e=[];for(var t in s.queryGroupList)s.selectedGroup.id!=s.queryGroupList[t].id&&e.push(s.queryGroupList[t]);return s.queryGroupList=e,s.selectedGroup=s.queryGroupList[0],void G.success("删除班组成功",{})}L.show({title:"提示",closable:!1,message:"确认删除 "+s.selectedGroup.name+" 吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){s.selectedGroup&&(f.deleteTeamById(s.selectedGroup.id,function(e){if(0==e.code){var t=[];for(var r in s.queryGroupList)s.selectedGroup.id!=s.queryGroupList[r].id&&t.push(s.queryGroupList[r]);s.queryGroupList=t,G.success("删除班组成功",{}),0<t.length?s.groupClick(s.queryGroupList[0]):s.selectedGroup=null}else G.error("删除班组失败",{})}),e.close())}},{label:"取消",action:function(e){e.close()}}]})},s.saveTeamGroup=function(){if(0==s.formReg.name){if(""==s.selectedGroup.name)return G.info("请先填写班组名称",{}),void(s.formReg.name="1000");if(0==s.selectedGroup.id){for(var e in s.queryGroupList)if(s.selectedGroup.name==s.queryGroupList[e].name&&0!=s.queryGroupList[e].id)return void G.warning("您输入的班组名称已存在，请重新输入",{});var t={name:$.trim(s.selectedGroup.name),workArea:$.trim(s.selectedGroup.workArea),teamType:s.selectedGroup.teamType,remark:$.trim(s.selectedGroup.remark)};f.addTeam(t,function(e){if(0==e.code){e.data;var t=[];for(var r in s.queryGroupList)0!=s.queryGroupList[r].id?t.push(s.queryGroupList[r]):t.push(e.data);s.queryGroupList=t,s.groupClick(e.data),s.selectedGroup=e.data,G.success("新增班组成功",{})}else G.success("新增班组失败",{})})}else{for(var e in s.queryGroupList)if(s.queryGroupList[e].id!=s.selectedGroup.id&&s.selectedGroup.name==s.queryGroupList[e].name)return void G.warning("当前有重复班组名称，请修改",{});if(""==s.selectedGroup.name)return void(s.formReg.name="1000");t={domainPath:s.selectedGroup.domainPath,id:s.selectedGroup.id,name:$.trim(s.selectedGroup.name),workArea:$.trim(s.selectedGroup.workArea),teamType:s.selectedGroup.teamType,remark:$.trim(s.selectedGroup.remark)};f.updateTeam(t,function(e){if(0==e.code){var t=[];for(var r in s.queryGroupList)s.queryGroupList[r].id!=s.selectedGroup.id?t.push(s.queryGroupList[r]):t.push(e.data);s.queryGroupList=t,s.selectedGroup=e.data,G.success("修改班组成功",{})}else G.success("修改班组失败",{})})}}},s.groupClick=function(e){s.selectedGroup=e,v(),g(s.selectedGroup.id),y(s.selectedGroup.id)},s.$watch("selectedGroup.name",function(e,t){if(s.formReg.name="0",null!=s.selectedGroup){var r=$.trim(e);""!=r&&null!=r||(s.formReg.name="0")}}),s.$watch("selectedGroup.workArea",function(e,t){if(s.formReg.desc="0",null!=s.selectedGroup){var r=$.trim(e);""!=r&&null!=r||(s.formReg.desc="0")}}),s.addGroupUser=function(){if(null!=s.selectedGroup)if(0!=s.selectedGroup.id){var e={userName:"选择用户",emailAddress:"",mobilePhone:"",officePhone:"",id:0,userEmail:"",domainPath:"",isEdit:2,userType:2,userTypeLabel:"普通用户",jobTitle:"",discription:"",edit:"",userID:null};if(!(0<s.teamGroupList.length))return s.teamGroupList.unshift(e),void s.$broadcast(Event.TEAM2USERINIT,{option:[s.teamGroupList]});if(s.teamGroupList.length!=s.enterpriseUser.length)for(var t in s.teamGroupList)return null==s.teamGroupList[t].userID?G.warning("请先保存用户再进行添加",{}):s.teamGroupList.unshift(e),void s.$broadcast(Event.TEAM2USERINIT,{option:[s.teamGroupList]});else G.warning("您已经没有用户可以添加",{})}else G.warning("请先保存新添加的班组，再进行以下操作",{});else G.warning("请选择班组，再进行以下操作",{})},s.doActions=function(e,r){if("saveTeam"==e){if(""==r||null==r)return void G.warning("请选择用户",{});var t={userId:r,teamId:s.selectedGroup.id};f.addUserToTeam(t,function(e){0==e.code?(G.success("添加用户到班组成功",{}),g(s.selectedGroup.id)):G.warning("用户已经存在该班组中，添加失败",{})})}else"removeUser"==e?L.show({title:"提示",closable:!1,message:'确认将用户 "'+r.userName+'"移出" '+s.selectedGroup.name+'" 吗？',buttons:[{label:"确定",cssClass:"btn-success",action:function(e){var t=[r.userID,s.selectedGroup.id];f.deleteUserToTeamByUserIdAndTeamId(t,function(e){0==e.code?(G.success("用户组移出用户成功",{}),g(s.selectedGroup.id)):G.warning("该用户移出失败",{})}),e.close()}},{label:"取消",action:function(e){e.close()}}]}):"cancel"==e&&(G.success("已取消添加班组用户",{}),g(s.selectedGroup.id))};function T(){e.getGroupModels(function(e){0==e.code&&(s.selectedDitem.types=e.data)})}function y(e){f.getDevicesByTeamId(e,function(e){0==e.code&&(s.selectedTeamDevices=e.data,s.$broadcast(Event.TEAM2DEVICEINIT,{data:[s.selectedTeamDevices]}))})}s.addDevices=function(){s.selectedAlertitem.nodeType||(s.selectedDitem.label=[]),r.open({template:"templateId",className:"ngdialog-theme-plain",scope:s})},s.getDeviceType=function(e){null!=e&&null!=e&&""!=e&&(s.selectedDitem.label=[],a.getResourceByModelId(e,function(e){if(0==e.code){for(var t in e.data){var r=-1;if(0==s.selectedTeamDevices.legnth)s.selectedDitem.label=e.data;else{for(var i in s.selectedTeamDevices)e.data[t].id==s.selectedTeamDevices[i].id&&(r=i);-1==r&&s.selectedDitem.label.push(e.data[t])}}0==s.selectedDitem.label.length&&G.warning("此模板下已没有可添加设备",{})}}))},s.saveDevices=function(){if(0!=s.relatedDeviceList.length){var e={teamId:s.selectedGroup.id,deviceIds:s.relatedDeviceList};f.addDevicesToTeam(e,function(e){0==e.code&&(G.success("添加设备到班组成功",{}),y(s.selectedGroup.id),s.selectedAlertitem.nodeType="",s.selectedAlertitem.id="",r.close())})}else G.warning("请先选择设备模板",{})},s.selectedDevices=function(e){if(""==s.selectedTeamDevices||null==s.selectedTeamDevices)s.relatedDeviceList=e;else for(var t in s.relatedDeviceList=[],s.selectedTeamDevices)for(var r in e)e[r]!=s.selectedTeamDevices[t].id&&s.relatedDeviceList.push(e[r])},s.doAction=function(e,r){"removeDevice"==e&&L.show({title:"提示",closable:!1,message:'确认将设备 "'+r.label+'"移出" '+s.selectedGroup.name+'" 吗？',buttons:[{label:"确定",cssClass:"btn-success",action:function(e){var t=[r.id,s.selectedGroup.id];f.deleteDeviceToTeamByDeviceIdAndTeamId(t,function(e){0==e.code?(G.success("班组移出设备成功",{}),y(s.selectedGroup.id)):G.warning("该设备移出失败",{})}),e.close()}},{label:"取消",action:function(e){e.close()}}]})};var b=function(){$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).attr("name");$(e.target).text();if(s.activeListTab=t,s.$apply(),"tab4"==t&&null!=s.selectedGroup){if(null==s.selectedGroup.id)return G.warning("请先添加班组再进行切换",{}),void(s.teamGroupList=null);if(0==s.selectedGroup.id)return;l.queryEnterpriseUser(function(e){0==e.code&&(s.enterpriseUser=e.data,g(s.selectedGroup.id))})}if("tab5"==t&&null!=s.selectedGroup){if(null==s.selectedGroup.id)return G.warning("请先添加班组再进行切换",{}),void(s.teamGroupList=null);if(0==s.selectedGroup.id)return;y(s.selectedGroup.id)}})};p.user.isAuthenticated?(b(),T(),v()):s.$on("loginStatusChanged",function(e,t){p.user.isAuthenticated&&(b(),T(),v())})}]),e.initController("sparePartCtrl",["$scope","userInitService","ngDialog","$location","$routeParams","$timeout","userEnterpriseService","userLoginUIService","Info","growl",function(r,e,t,i,s,o,a,n,u,c){function d(){r.$broadcast(Event.STOREINIT,{option:[r.demo_sparepart]})}r.demo_sparepart=[{label:"备件1",coding:1234577899,type:"备件型号1",currentNumber:43,minimum:21},{label:"备件2",coding:123457334459,type:"备件型号2",currentNumber:73,minimum:32},{label:"备件3",coding:1234577439,type:"备件型号3",currentNumber:443,minimum:23},{label:"备件4",coding:123434549,type:"备件型号4",currentNumber:993,minimum:22},{label:"备件5",coding:12345222299,type:"备件型号5",currentNumber:433,minimum:28}];o(function(){d()}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).attr("name");"store"==t?(d(),r.$broadcast(Event.STOREINIT,{option:[r.demo_sparepart]})):"stats"==t&&(d(),r.$broadcast(Event.STATSINIT,{option:[r.demo_sparepart]})),r.$apply()})}])});
//# sourceMappingURL=../../../map/app-oc/js/controllers/team-group-ctrl.js.map
