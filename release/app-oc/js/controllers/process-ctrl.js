define(["controllers/controllers","bootstrap-dialog"],function(e,w){"use strict";e.initController("processViewsCtrl",["$scope","ngDialog","workflowService","workflowDefinitionService","viewFlexService","$timeout","growl",function(l,c,a,r,e,i,f){l.historyVersion="",l.selectHistory="",l.historyList="";var d=function(i){r.saveWorkflowDefinition(i,function(e){0==e.code&&(f.success("保存成功"),null==i.id?location.href="../app-flowsheet/index.html#/flow/"+e.data.id:(u(),l.closeDialog()))})};function u(){r.getWorkflowDefinitions(function(e){0==e.code&&(l.configureView=e.data,l.$broadcast("PROCESS",{data:l.configureView}))})}l.releaseObj={name:"",version:"",desc:"",workflowDefinitionId:""},l.addViews=function(e){l.addObj=e||{id:null,domainPath:"",name:"",desc:"",viewContent:"",isEdit:0,createTime:"",updateTime:""},c.open({template:"../partials/dialogue/add_flow.html",className:"ngdialog-theme-plain",scope:l})},l.saveFlow=function(){d(l.addObj)},l.saveRelease=function(){r.publishWorkflow(l.releaseObj,function(e){0==e.code&&(f.success("流程视图发布成功",{}),u(),l.closeDialog())})},l.doAction=function(e,o,s){if("attr-delete"==e)a.getWorkflowByWorkflowDefinitionId(o.id,function(e){if(0==e.code){if(0<e.data.length)return void f.warning("这个流程设计下面有历史版本，请先删除",{});w.show({title:"提示",closable:!1,message:"确认删除该流程视图吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){r.deleteWorkflowDefinitionById([o.id],function(e){if(0==e.code){for(var i=0;i<l.configureView.length;i++)if(l.configureView[i].id==o.id){l.configureView.splice(i,1);break}s&&s(!0)}}),e.close()}},{label:"取消",action:function(e){e.close()}}]})}});else if("view-copy"==e){var i=jQuery.extend(!0,{},o);i.viewTitle=i.viewTitle+"复制",i.viewName=i.viewTitle,i.viewId=0,n=i,r.saveWorkflowDefinition(n,function(e){0==e.code&&(l.configureView.push(e.data),l.$broadcast("PROCESS",{data:l.configureView}),f.success("保存成功"))})}else if("view-save"==e)d(o);else if("release"==e){var t=0;t=""==o.version||null==o.version?1:o.version,l.releaseObj.version=t,l.releaseObj.workflowDefinitionId=o.id,l.releaseObj.name=o.name,l.releaseObj.desc=o.desc,c.open({template:"../partials/dialogue/flow_release.html",className:"ngdialog-theme-plain",scope:l})}else"history"==e?(0==jQuery("#processcollapse").find(".fa.fa-plus").length&&jQuery.AdminLTE.boxWidget.collapse(jQuery("#processcollapse")),a.getWorkflowByWorkflowDefinitionId(o.id,function(e){0==e.code&&(l.historyList=e.data,l.$broadcast("PROCESShistory",{data:e.data}))}),l.selectHistory=o,l.historyVersion="version"):"history-delete"==e&&w.show({title:"提示",closable:!1,message:"确认要删除流程历史版本？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){a.deleteWorkflowById(o.id,function(e){if(0==e.code){for(var i in l.historyList)l.historyList[i].id==o.id&&l.historyList.splice(i,1);l.$broadcast("PROCESShistory",{data:l.historyList}),f.success("流程历史版本删除成功",{}),u()}}),e.close()}},{label:"取消",action:function(e){e.close()}}]});var n},l.closeTable=function(){0<jQuery("#processcollapse").find(".fa.fa-plus").length&&jQuery.AdminLTE.boxWidget.collapse(jQuery("#processcollapse")),l.historyVersion=""},l.configureView=[],u()}]),e.initController("processReleaseCtrl",["$scope","workflowService","viewFlexService","$timeout","growl",function(t,i,e,o,s){t.doAction=function(e,o,s){"attr-delete"==e&&w.show({title:"提示",closable:!1,message:"确认删除该流程视图吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){i.deleteWorkflowById([o.id],function(e){if(0==e.code){for(var i=0;i<t.configureView.length;i++)if(t.configureView[i].id==o.id){t.configureView.splice(i,1);break}s&&s(!0)}}),e.close()}},{label:"取消",action:function(e){e.close()}}]})},t.configureView=[],i.getWorkflows(function(e){0==e.code&&(t.configureView=e.data,t.$broadcast("PROCESS-RELEASE",{data:t.configureView}))})}])});
//# sourceMappingURL=../../../map/app-oc/js/controllers/process-ctrl.js.map
