define(["directives/directives","bootstrap-dialog","datatables.net","datatables.net-bs","datatables.net-select"],function(e,t,a){"use strict";e.initDirective("alertRulesTable",["$timeout","ngDialog","$compile","$filter","growl",function(e,t,n,a,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,e,t){var c,a=e;r.$on(Event.ALERTRULESINIT+"_rules",function(e,t){c&&(c.destroy(),a.empty()),c=a.DataTable({dom:t.option&&1<=t.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,data:t.option[0],order:[[8,"desc"]],columns:[$.ProudSmart.datatable.selectCol,{data:"title",title:"规则名称"},{data:"domain",title:"管理域"},{data:"modelId",title:"资源类型"},{data:"condition",title:"规则条件"},{data:"alertCode",title:"告警类别"},{data:"severity",title:"告警级别"},{data:"enabled",title:"启用",visible:!!r.menuitems.A13_S45,orderable:!1},{data:"risingTime",title:"",visible:!1},$.ProudSmart.datatable.optionCol3],columnDefs:[{targets:0,orderable:!1,render:function(e,t,a){return"display"==t?e?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"title",render:function(e,t,a){e=escape(e);if(2==a.isEdit&&"display"==t);return e}},{targets:3,data:"modelId",render:function(e,t,a){if(2==a.isEdit&&"display"==t)return"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>";var n="";if(e){for(var s in r.allModelLists)r.allModelLists[s].id==e&&(n=r.allModelLists[s].label);if(n||(n="【未知类型】"),a.nodeIds){var l=[];a.nodeIds.split(",").forEach(function(e){for(var t in r.allDeveicesList)if(e==r.allDeveicesList[t].id){l.push(r.allDeveicesList[t].label);break}for(var t in r.projectList)if(e==r.projectList[t].id){l.push(r.projectList[t].projectName);break}r.customerDic[e]&&l.push(r.customerDic[e].text),r.domainListDic[e]&&l.push(r.domainListDic[e].label)}),n="在"+n+"的<b>["+l.toString()+"]</b>有效"}}return n}},{targets:2,data:"domain",render:function(e,t,a){var n="无权限查看";return e&&r.domainListDic[e]&&(n=r.domainListDic[e].label),n}},{targets:4,data:"condition",render:function(e,t,a){var n="";for(var s in a.kpiCode&&r.kpiLists[a.kpiCode]?n+=r.kpiLists[a.kpiCode].label:a.kpiCode&&!r.kpiLists[a.kpiCode]&&(n+="无kpi指标"),r.condition)if(a.condition==r.condition[s].value){"表达式"==r.condition[s].name?n+="满足条件：":n+=r.condition[s].name;break}if(n+=a.refValue,r.kpiLists&&r.kpiLists[a.kpiCode]&&r.kpiLists[a.kpiCode].unit){var l=r.kpiLists[a.kpiCode].unit;n+=r.myOptionDic?r.myOptionDic[l]:""}else n+="";return n}},{targets:5,data:"alertCode",render:function(e,t,a){var n="";if(e)for(var s in r.alertClassifyLists)r.alertClassifyLists[s].id==e&&(n=r.alertClassifyLists[s].label);return n}},{targets:6,data:"severity",render:function(e,t,a){if(2==a.isEdit&&"display"==t)return"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>";var n="无数据",s="alerts-warning";return 4==e?(n="严重",s="alerts-critical"):3==e?(n="重要",s="alerts-major"):2==e?(n="次要",s="alerts-minor"):1==e&&(n="警告",s="alerts-warning"),"<span class='label "+s+"'>"+n+"</span>"}},{targets:7,data:"enabled",visible:!!r.menuitems.A13_S45,render:function(e,t,a){return"display"==t?e?'<input class="enabledCheckBox" checked type="checkbox">':'<input class="enabledCheckBox" type="checkbox">':""}},{targets:9,data:"option",render:function(e,t,a){var n="<div class='btn-group btn-group-sm'>";return 1==a.enabled?(r.menuitems.A05_S45&&(n+="<button id='edit-btn' class='btn btn-primary' disabled='true' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>"),r.menuitems.A04_S45&&(n+="<button id='del-btn' class='btn btn-default'  disabled='true'><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>")):(r.menuitems.A05_S45&&(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>"),r.menuitems.A04_S45&&(n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>")),(r.menuitems.A03_S45||r.menuitems.A06_S45||r.menuitems.A12_S45)&&(n+="<button type='button'  class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>"),n+="<ul class='dropdown-menu' role='menu'>",r.menuitems.A12_S45&&(n+="<li><a role='button' id='view-btn'>查看详情</a></li>"),r.menuitems.A06_S45&&(n+="<li><a role='button' id='copy-btn'>复制规则</a></li>"),r.menuitems.A03_S45&&(n+="<li><a role='button' id='inform-btn'>告警通知</a></li>"),n+="</ul></div>"}}],rowCallback:function(e,t,a){t.selected?$(e).addClass("selected"):$(e).removeClass("selected"),n(e)(r)}})}),a.on("click","#edit-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);a.data().nodeIds?location.href="index.html#/alertRules/special/"+$.trim(a.data().id)+"/edit":location.href="index.html#/alertRules/global/"+$.trim(a.data().id)+"/edit"}),a.on("click","#del-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);r.doAction("deleteAlertRules",[a.data().id],function(e){0==e.code&&(a.remove().draw(!1),u.success("删除成功",{}))},!0)}),a.on("click","#inform-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t).data();location.href="index.html#/alertInforms/"+$.trim(a.id)}),a.on("click","#view-btn",function(e){var t=$(this).closest("tr"),a=c.row(t);a.data();a.data().nodeIds?location.href="index.html#/alertRules/special/"+$.trim(a.data().id)+"/view":location.href="index.html#/alertRules/global/"+$.trim(a.data().id)+"/view"}),a.on("click","#copy-btn",function(e){var t=$(this).closest("tr"),a=c.row(t);a.data();r.doAction("copy",a.data(),function(e){if(0==e.code){for(var t=c.rows({selected:!0}),a=0;a<t.nodes().length;a++){c.row(t.nodes()[a]).data().selected=!1}c.rows().deselect(),c.rows().invalidate().draw(!1)}})}),a.on("change","#allselect-btn",function(e){e.stopPropagation();var t=0,a=0;if(e.target.checked){c.rows().select();for(var n=c.rows({selected:!0}),s=0;s<n.nodes().length;s++){(l=c.row(n.nodes()[s])).data().selected=!0,l.data().enabled?t++:a++}t==n.count()?(r.unabled=!0,r.selectedCount=0):a==n.count()?r.abled=!0:(r.unabled=!0,r.abled=!0,r.selectedCount=0),c.rows().invalidate().draw(!1),r.$apply()}else{for(n=c.rows({selected:!0}),s=0;s<n.nodes().length;s++){var l;(l=c.row(n.nodes()[s])).data().selected=!1}c.rows().deselect(),c.rows().invalidate().draw(!1),r.abled=!1,r.unabled=!1,r.selectedCount=0,r.$apply()}}),a.on("change",".itemCheckBox",function(e){var t=$(this).closest("tr"),a=c.row(t),n=0,s=0,l=c.rows({selected:!0});if(e.target.checked)a.data().selected=!0,a.data().enabled?(r.unabled=!0,r.selectedCount=0):r.abled=!0;else{a.data().selected=!1;c.rows();for(var o=0;o<l.nodes().length;o++){(a=c.row(l.nodes()[o])).data().enabled?n++:s++}0<n&&0==s?(r.abled=!1,r.unabled=!0,r.selectedCount=0):0<s&&0==n&&(r.abled=!0,r.unabled=!1)}l.count()!=c.rows()[0].length?($("#allselect-btn").attr("checked",!1),$("#allselect-btn").prop("checked",!1)):l.count()==c.rows()[0].length&&($("#allselect-btn").attr("checked",!0),$("#allselect-btn").prop("checked",!0)),r.$apply()}),a.on("change",".enabledCheckBox",function(t){var a=this,e=$(this).closest("tr"),n=c.row(e),s=[];s=t.target.checked?(n.data().enabled=!0,[[n.data().id],!0]):(n.data().enabled=!1,[[n.data().id],!1]),r.doAction("AlertEnable",s,function(e){0==e.code?(c.rows().invalidate().draw(!1),t.target.checked?($(a).attr("checked",!0),u.success("启用成功",{})):($(a).prop("checked",!1),u.success("停用成功",{})),$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()):e||(t.target.checked?(n.data().enabled=!1,$(a).attr("checked",!1)):(n.data().enabled=!0,$(a).prop("checked",!0)))},!0)}),r.selectedDelete=function(){var e=c.rows({selected:!0}),t=e.count(),l=e.nodes();if(0!=t){for(var a=0,n=0,s=[],o=!1,i=0;i<l.length;i++){var d=c.row(l[i]).data();0<d.id&&!d.enabled?(s.push(d.id),a++):n++,t==a+n&&(o=!0)}o&&r.doAction("deleteAlertRules",s,function(e){if(0==e.code){var t=e.data.failObj.length,a=e.data.successObj.length;u.success("成功删除"+a+"个,失败"+t+"个",{});for(var n=0;n<l.length;n++){var s=c.row(l[n]);s.data().enabled||s.remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}else e||($(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect())})}else u.warning("当前没有选中的告警规则项",{})},r.selectedEnable=function(){var e=c.rows({selected:!0}),t=e.count(),o=e.nodes();if(0!=t){for(var a=0,n=0,s=[],l=!1,i=0;i<o.length;i++){var d=c.row(o[i]).data();d.enabled?n++:(s.push(d.id),a++),t==a+n&&(l=!0)}l&&r.doAction("AlertEnable",[s,!0],function(e){if(0==e.code){var t=e.data.failObj.length,a=e.data.successObj.length;u.success("成功启用"+a+"个,失败"+t+"个",{});for(var n=0;n<o.length;n++){var s=c.row(o[n]),l=s.data();l.enabled=!0,l.selected=!1,s.cells().invalidate().draw(!1)}$("#allselect-btn").attr("checked",!1),c.rows().deselect()}else e||($(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect())})}else u.warning("当前没有选中的告警规则项",{})},r.selectedUnable=function(){var e=c.rows({selected:!0}),t=e.count(),o=e.nodes();if(0!=t){for(var a=0,n=0,s=[],l=!1,i=0;i<o.length;i++){var d=c.row(o[i]).data();d.enabled?(s.push(d.id),a++):n++,t==a+n&&(l=!0)}l&&r.doAction("AlertEnable",[s,!1],function(e){if(0==e.code){var t=e.data.failObj.length,a=e.data.successObj.length;u.success("成功停用"+a+"个,失败"+t+"个",{});for(var n=0;n<o.length;n++){var s=c.row(o[n]),l=s.data();l.enabled=!1,l.selected=!1,s.cells().invalidate().draw(!1)}$("#allselect-btn").attr("checked",!1),c.rows().deselect()}else e||($(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect())})}else u.warning("当前没有选中的告警规则项",{})}}]}}]),e.initDirective("alertClassifyTable",["$timeout","ngDialog","$compile","$filter","growl",function(e,n,s,t,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,e,t){var c,a=e;r.$on(Event.ALERTRULESINIT+"_classify",function(e,t){c&&(c.destroy(),a.empty()),c=a.DataTable({dom:t.option&&1<=t.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,data:t.option[0],order:[[4,"desc"]],columns:[$.ProudSmart.datatable.selectCol,{data:"label",title:"类别名称"},{data:"name",title:"告警码"},{data:"description",title:"类别描述"},{data:"risingTime",title:"",visible:!1},$.ProudSmart.datatable.optionCol3],columnDefs:[{targets:0,orderable:!1,render:function(e,t,a){return"display"==t?e?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"label",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>":escape(e)}},{targets:2,data:"name",render:function(e,t,a){if(e){var n=r.Category;for(var s in r.Category)if(n[s].index==e)return n[s].label}return escape(e)}},{targets:3,data:"description",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>":escape(e)}},{targets:5,data:"option",render:function(e,t,a){var n="<div class='btn-group btn-group-sm'>";return 2==a.isEdit?(n+="<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>",n+="<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>"):(r.menuitems.D03_A02_S45&&(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>"),r.menuitems.D02_A02_S45&&(n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>")),n+="</div>"}}],rowCallback:function(e,t,a){s(e)(r)}})}),a.on("change","#allselect-btn",function(e){if(e.stopPropagation(),e.target.checked){c.rows().select();var t=c.rows({selected:!0});r.selectedCount=t.count(),r.$apply();for(var a=0;a<t.nodes().length;a++){c.row(t.nodes()[a]).data().selected=!0}c.rows().invalidate().draw(!1)}else{for(t=c.rows({selected:!0}),a=0;a<t.nodes().length;a++){c.row(t.nodes()[a]).data().selected=!1}c.rows().deselect(),r.selectedCount=0,r.$apply(),c.rows().invalidate().draw(!1)}}),a.on("change",".itemCheckBox",function(e){var t=$(this).closest("tr"),a=c.row(t);e.target.checked?a.data().selected=!0:a.data().selected=!1;var n=c.rows({selected:!0});r.selectedCount=n.count(),r.$apply(),n.count()!=c.rows()[0].length?($("#allselect-btn").attr("checked",!1),$("#allselect-btn").prop("checked",!1)):n.count()==c.rows()[0].length&&($("#allselect-btn").attr("checked",!0),$("#allselect-btn").prop("checked",!0))}),a.on("click","#edit-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);$.extend(r.alertClassifyInfo,a.data()),n.open({template:"../partials/dialogue/alert_classification_dia.html",className:"ngdialog-theme-plain",scope:r})}),a.on("click","#del-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);r.doAction("deleteAlertClassify",[a.data().id],function(e){0==e&&a.remove().draw(!1)})}),r.selectedDelete=function(){var e=c.rows({selected:!0}),t=e.count(),a=e.nodes();if(0!=t){for(var n=0,s=0,l=[],o=!1,i=0;i<a.length;i++){var d=c.row(a[i]).data();0<d.id?(l.push(d.id),n++):s++,t==n+s&&(o=!0)}o&&r.doAction("deleteAlertClassify",l,function(e){if(0==e){for(var t=0;t<a.length;t++){c.row(a[t]).remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}})}else u.warning("当前没有选中的告警类别项",{})}}]}}]),e.initDirective("kpiTypeTable",["$timeout","ngDialog","$compile","$filter","growl",function(e,n,s,t,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,e,t){var c,a=e;r.$on(Event.ALERTRULESINIT+"_kpitype",function(e,t){c&&(c.destroy(),a.empty()),c=a.DataTable({dom:t.option&&1<=t.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,data:t.option[0],order:[[4,"desc"]],columns:[$.ProudSmart.datatable.selectCol,{data:"name",title:"数据项"},{data:"label",title:"名称"},{data:"unit",title:"单位"},{data:"number",title:"是否数值"},{data:"type",title:"数据分类"},{data:"range",title:"取值范围"},{data:"icon",title:"图标"},$.ProudSmart.datatable.optionCol3],columnDefs:[{targets:0,orderable:!1,render:function(e,t,a){return"display"==t?e?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"name",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>":escape(e)}},{targets:2,data:"label",render:function(e,t,a){if(e){var n=r.Category;for(var s in r.Category)if(n[s].index==e)return n[s].label}return escape(e)}},{targets:3,data:"unit",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>":escape(e)}},{targets:4,data:"number",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>":e?"是":"否"}},{targets:5,data:"type",render:function(e,t,a){if(2==a.isEdit&&"display"==t)return"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>";var n="";return"kpi"==e?n="测点":"fault"==e&&(n="故障"),n}},{targets:6,data:"range",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%' class='form-control input-sm' autocomplete='off' type='text' value='"+escape(e)+"'>":escape(e)}},{targets:7,data:"icon",render:function(e,t,a){var n="";return e&&(n='<div  class="btn btn-social-icon btn-bitbucket btn-sm"><i  class="'+e+'"></i>'),n}},{targets:8,data:"option",render:function(e,t,a){var n="<div class='btn-group btn-group-sm'>";return 2==a.isEdit?(n+="<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>",n+="<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>"):(r.menuitems.D03_A02_S45&&(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>"),r.menuitems.D02_A02_S45&&(n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>")),n+="</div>"}}],rowCallback:function(e,t,a){s(e)(r)}})}),a.on("change","#allselect-btn",function(e){if(e.stopPropagation(),e.target.checked){c.rows().select();var t=c.rows({selected:!0});r.selectedCount=t.count(),r.$apply();for(var a=0;a<t.nodes().length;a++){c.row(t.nodes()[a]).data().selected=!0}c.rows().invalidate().draw(!1)}else{for(t=c.rows({selected:!0}),a=0;a<t.nodes().length;a++){c.row(t.nodes()[a]).data().selected=!1}c.rows().deselect(),r.selectedCount=0,r.$apply(),c.rows().invalidate().draw(!1)}}),a.on("change",".itemCheckBox",function(e){var t=$(this).closest("tr"),a=c.row(t);e.target.checked?a.data().selected=!0:a.data().selected=!1;var n=c.rows({selected:!0});r.selectedCount=n.count(),r.$apply(),n.count()!=c.rows()[0].length?($("#allselect-btn").attr("checked",!1),$("#allselect-btn").prop("checked",!1)):n.count()==c.rows()[0].length&&($("#allselect-btn").attr("checked",!0),$("#allselect-btn").prop("checked",!0))}),a.on("click","#edit-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);$.extend(r.kpiTypeInfo,a.data()),n.open({template:"../partials/dialogue/kpi_type_dia.html",className:"ngdialog-theme-plain",scope:r})}),a.on("click","#del-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);r.doAction("deleteAlertClassify",[a.data().id],function(e){0==e&&a.remove().draw(!1)})}),r.selectedDelete=function(){var e=c.rows({selected:!0}),t=e.count(),a=e.nodes();if(0!=t){for(var n=0,s=0,l=[],o=!1,i=0;i<a.length;i++){var d=c.row(a[i]).data();0<d.id?(l.push(d.id),n++):s++,t==n+s&&(o=!0)}o&&r.doAction("deleteAlertClassify",l,function(e){if(0==e){for(var t=0;t<a.length;t++){c.row(a[t]).remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}})}else u.warning("当前没有选中的告警类别项",{})}}]}}]),e.initDirective("alertInformTable",["$timeout","resourceUIService","ngDialog","$compile","$filter","growl",function(e,n,s,l,t,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,e,t){var c,a=e;r.$on(Event.ALERTRULESINIT+"_informs",function(e,t){c&&(c.destroy(),a.empty()),c=a.DataTable({dom:t.option&&1<=t.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,data:t.option[0],order:[[5,"desc"]],columns:[{data:"selected",title:"是否启用"},{data:"ruleName",title:"通知名称"},{data:"personType",title:"人员类型"},{data:"noticeRole",title:"通知角色"},{data:"templates",title:"通知方式"},{data:"risingTime",title:"",visible:!1},$.ProudSmart.datatable.optionCol3],columnDefs:[{targets:0,orderable:!1,render:function(e,t,a){return"display"==t?e?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"ruleName",render:function(e,t,a){return escape(e)}},{targets:2,data:"personType",render:function(e,t,a){if(!e)return"-";for(var n in r.notificationType)if(r.notificationType[n].valueCode==e)return r.notificationType[n].label}},{targets:3,data:"noticeRole",render:function(e,t,a){var n="-";if(e)for(var s in r.allRoles)if(r.allRoles[s].roleID==e){n=r.allRoles[s].roleName;break}return n}},{targets:4,data:"templates",render:function(e,t,a){var n="",s={};return r.notificationList.forEach(function(e){s[e.valueCode]=e}),a.templates&&(n=a.templates.map(function(e){return null==s[e.noticeWay]?"":s[e.noticeWay].label}).join(" ,")),n}},{targets:6,data:"option",render:function(e,t,a){var n="<div class='btn-group btn-group-sm'>";return 2==a.isEdit?(n+="<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>",n+="<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>"):(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>"),n+="</div>"}}],rowCallback:function(e,t,a){l(e)(r)}})}),a.on("change","#allselect-btn",function(e){if(e.stopPropagation(),e.target.checked){c.rows().select();var t=c.rows({selected:!0});r.selectedCount=t.count(),r.$apply();for(var a=0;a<t.nodes().length;a++){c.row(t.nodes()[a]).data().selected=!0}c.rows().invalidate().draw(!1)}else{for(t=c.rows({selected:!0}),a=0;a<t.nodes().length;a++){c.row(t.nodes()[a]).data().selected=!1}c.rows().deselect(),r.selectedCount=0,r.$apply(),c.rows().invalidate().draw(!1)}}),a.on("change",".itemCheckBox",function(e){var t=$(this).closest("tr"),a=c.row(t);e.target.checked?(a.data().selected=!0,r.doAction("enabled",a.data())):(a.data().selected=!1,r.doAction("disabled",a.data()));var n=c.rows({selected:!0});r.selectedCount=n.count(),r.$apply(),n.count()!=c.rows()[0].length?($("#allselect-btn").attr("checked",!1),$("#allselect-btn").prop("checked",!1)):n.count()==c.rows()[0].length&&($("#allselect-btn").attr("checked",!0),$("#allselect-btn").prop("checked",!0))}),a.on("click","#edit-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);n.findNoticeRuleById([a.data().id],function(e){0==e.code&&(e.data.ruleTempName=a.data().ruleTempName,function(e){for(var t in $.extend(r.alertInformsInfo,e),e.templates)"boolean"==typeof e.templates[t]&&delete e.templates[t];r.templates.forEach(function(t){if(t.personType!=e.personType)t.state=!0,t.contact="";else if(t.personType==e.personType){var a=e.templates;a.forEach(function(e){a[t.noticeWay]||(t.noticeWay!=e.noticeWay||a[t.noticeWay]?(a[t.noticeWay]=!1,t.state=!1,t.contact=""):a[e.noticeWay]||(a[t.noticeWay]=!0,t.state=!0,t.contact=e.contact))})}}),s.open({template:"../partials/dialogue/alert_inform_dia.html",className:"ngdialog-theme-plain",scope:r})}(e.data))})}),a.on("click","#del-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);r.doAction("deleteAlertForm",a.data(),function(e){0==e&&a.remove().draw(!1)})}),r.selectedDelete=function(){var e=c.rows({selected:!0}),t=e.count(),a=e.nodes();if(0!=t){for(var n=0,s=0,l=[],o=!1,i=0;i<a.length;i++){var d=c.row(a[i]).data();0<d.id?(l.push(d.id),n++):s++,t==n+s&&(o=!0)}o&&r.doAction("deleteAlertForm",l,function(e){if(0==e){for(var t=0;t<a.length;t++){c.row(a[t]).remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}})}else u.warning("当前没有选中的告警通知项",{})}}]}}])});
//# sourceMappingURL=../../../map/app-oc/js/directives/alert-rules-dom.js.map
