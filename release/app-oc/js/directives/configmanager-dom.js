define(["directives/directives","datatables.net","datatables.net-bs"],function(t,e){"use strict";t.initDirective("configGroupTable",["$timeout","$compile","growl",function(t,e,c){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,a){var r,n=t,o=!1;l.$on(Event.CONFIGGROUPINIT,function(t,e){r&&(r.destroy(),n.empty()),o=!1,r=n.DataTable({dom:e&&0<e.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e,order:[[5,"desc"]],columns:[{data:"name",title:"配置组名称"},{data:"label",title:"配置组显示名"},{data:"type",title:"配置组类型"},{data:"value",title:"配置组值"},$.ProudSmart.datatable.optionCol2,{data:"id",visible:!1}],columnDefs:[{targets:0,data:"name",render:function(t,e,a){return 2!=a.isEdit&&3!=a.isEdit||"display"!=e?escape(t):"<input maxlength='50' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>"}},{targets:1,data:"label",render:function(t,e,a){return 2!=a.isEdit&&3!=a.isEdit||"display"!=e?escape(t):"<input maxlength='50' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>"}},{targets:2,data:"type",render:function(t,e,a){if((2==a.isEdit||3==a.isEdit)&&"display"==e){var n="<select class='combobox form-control input-sm'>";for(var i in n+='<option value="">请选择...</option>',l.configTypes)l.configTypes[i].value==t?n+='<option selected="true" value="'+l.configTypes[i].value+'">'+l.configTypes[i].label+"</option>":n+='<option value="'+l.configTypes[i].value+'">'+l.configTypes[i].label+"</option>";return n+="</select>"}for(var i in l.configTypes)if(l.configTypes[i].value==t)return l.configTypes[i].label;return t}},{targets:3,data:"value",render:function(t,e,a){return 2!=a.isEdit&&3!=a.isEdit||"display"!=e?escape(t):"<input maxlength='100' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>"}},{targets:4,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return 2==a.isEdit||3==a.isEdit?(n+="<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>",a.isNew?l.menuitems.D03_A04_S23&&(n+="<button id='del-btn' class='btn btn-primary' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>"):n+="<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>"):(l.menuitems.D02_A04_S23&&(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></button>"),l.menuitems.D03_A04_S23&&(n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>")),n+="</div>"}}]})}),l.$on("table-search-handle",function(t,e){e.name==a.name&&r.search(e.value).draw()}),n.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addConfigGroup()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新建配置组</span></a>'),e(t)(l)}),n.on("click","#save-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),i=r.row(e);if(2==i.data().isEdit||3==i.data().isEdit){var a=$(this).parents("tr").children(),s=!0;$.each(a,function(t,e){var a=$(e);if((0==t||1==t)&&0<a.children("input").length){if(!(n=a.children("input").val()))return $(e).addClass("danger"),s=!1,i.data().isEdit=2,i.cells().invalidate(),c.warning("该字段不能为空",{}),!1;$(e).removeClass("danger")}if(2==t){var n=$(e).children("select").val();return r.cell(a).data(n),!0}if(t<4){n=a.children("input").val();r.cell(a).data(n)}});var n=l.configGroups;for(var d in n)if(n[d].name==i.data().name&&2!=n[d].isEdit&&3!=n[d].isEdit)return s=!1,c.warning("配置组名称不能重复",{}),!1;s&&l.doAction("configGroupSave",i.data(),function(t){0==t?i.data().isEdit=2:(i.data().id=t.id,i.data().isEdit=0,i.cells().invalidate(),o=!1)})}}),n.on("click","#edit-btn",function(t){if(t.preventDefault(),o)c.warning("当前有修改中的配置组，请先完成该操作",{});else{o=!0;var e=$(this).closest("tr"),a=r.row(e);a.data().isEdit=3,a.cells().invalidate()}}),n.on("click","#cancel-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=r.row(e);if(o)o=!1,a.data().isEdit=0,a.cells().invalidate();else{var n=a.data();l.doAction("configGroupDelete",n,function(t){t&&a.remove().draw(!1)})}}),n.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=r.row(e);a.data().isDel=!0;var n=a.data();l.doAction("configGroupDelete",n,function(t){t&&a.remove().draw(!1)})})}]}}]),t.initDirective("configInsTable",["$timeout","$compile","growl",function(t,i,c){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,t,a){var l,r,n=t,o=!1;d.$on(Event.CONFIGINSINIT,function(t,e){l&&(l.destroy(),n.empty()),o=!1,l=n.DataTable({dom:e&&0<e.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e,order:[[5,"desc"]],columns:[{data:"groupName",title:"配置组显示名"},{data:"label",title:"配置项名"},{data:"value",title:"配置项值"},{data:"keyDesc",title:"描述",width:"200px"},$.ProudSmart.datatable.optionCol2,{data:"id",visible:!1}],columnDefs:[{targets:0,data:"groupName",render:function(t,e,a){if(0<a.isEdit&&"display"==e){var n="<select id='group-select' class='combobox form-control input-sm'>";for(var i in n+='<option value="">请选择...</option>',d.configGroups)d.configGroups[i].name==t?n+='<option selected="true" value="'+d.configGroups[i].name+'">'+d.configGroups[i].label+"</option>":n+='<option value="'+d.configGroups[i].name+'">'+d.configGroups[i].label+"</option>";return n+="</select>"}for(var i in d.configGroups)if(d.configGroups[i].name==t)return d.configGroups[i].label;return t}},{targets:1,data:"label",render:function(t,e,a){return 0<a.isEdit&&"display"==e?"<input maxlength='50' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:2,data:"value",render:function(t,e,a){if(0<a.isEdit&&"display"==e){for(var n in r=null,d.configGroups)d.configGroups[n].name==a.groupName&&(r=d.configGroups[n]);return r&&"file"==r.type?"<uploader-div/>":"<input style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>"}return"<div  style='width:400px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;'>"+escape(t)+"</div>"}},{targets:3,data:"keyDesc",render:function(t,e,a){return 0<a.isEdit&&"display"==e?"<input maxlength='100' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:4,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return 0<a.isEdit?(n+="<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>",n+="<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>"):(d.menuitems.A02_S23&&(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></button>"),d.menuitems.A03_S23&&(n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>")),n+="</div>"}}],rowCallback:function(t,e,a){i(t)(d)}})}),d.$on("table-search-handle",function(t,e){e.name==a.name&&l.search(e.value).draw()}),n.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addConfig()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新建配置项</span></a>'),i(t)(d)}),n.on("change","#group-select",function(t){var e=$(this).closest("tr"),a=l.row(e),n=$(this).val();a.data().groupName=n,a.cells().invalidate(),i(e)(d)}),n.on("click","#save-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),i=l.row(e);if(2==i.data().isEdit||3==i.data().isEdit){var a=$(this).parents("tr").children(),s=!0;$.each(a,function(t,e){var a=$(e);if(0==t){if(!(n=$(e).children("select").val()))return c.warning("请选择配置组显示名",{}),s=!1}else if(1==t){if(0<a.children("input").length){var n=a.children("input").val();if(!$.trim(n))return c.warning("请输入配置项名",{}),s=!1;i.data().label=n}}else if(2==t){n=a.children("input").val();if(r&&"file"==r.type){if(!a.children("div").children("input").val()&&!i.data().value)return c.warning("请选择一个上传文件作为配置项值",{}),s=!1}else{if(!n)return c.warning("请输入配置项值",{}),s=!1;l.cell(a).data(n)}}else if(t<4){n=a.children("input").val();l.cell(a).data(n)}}),s&&d.doAction("configSave",i.data(),function(t){0==t?i.data().isEdit=2:(i.data().id=t.id,i.data().isEdit=0,i.cells().invalidate().draw(),o=!1)})}}),n.on("click","#edit-btn",function(t){if(t.preventDefault(),o)c.warning("当前有未保存的配置项，请先完成该操作",{});else{o=!0;var e=$(this).closest("tr"),a=l.row(e);a.data().isEdit=2,a.cells().invalidate(),i(e)(d)}}),n.on("click","#cancel-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=l.row(e);if(o=!1,r&&"file"==r.type&&d.clearUpload(),3==a.data().isEdit){for(var n in d.configIns)3==d.configIns[n].isEdit&&d.configIns.splice(n,1);a.data().isEdit=0,a.remove().draw(!1)}else a.data().isEdit=0,a.cells().invalidate()}),n.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=l.row(e),n=a.data();n.isDel=!0,d.doAction("configDelete",n,function(t){t&&(o=!1,a.remove().draw(!1))})})}]}}])});
//# sourceMappingURL=../../../map/app-oc/js/directives/configmanager-dom.js.map
