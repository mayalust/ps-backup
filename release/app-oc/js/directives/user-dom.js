define(["directives/directives","bootstrap-dialog","datatables.net","datatables.net-bs","datatables.net-select"],function(i,c,t){"use strict";i.initDirective("userTable",["$timeout","$compile","growl",function(t,l,d){return{restrict:"A",controller:["$scope","$element","$attrs",function(o,t,e){var r,a=t,n=!1;o.$on(Event.USERINFOSINIT,function(t,e){r&&r.destroy(),n=!1,r=a.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,order:[[7,"desc"]],data:e.data,columns:[$.ProudSmart.datatable.selectCol,{title:"用户类型",data:"userTypeLabel"},{title:"用户名称",data:"userName"},{title:"登录账户（手机/邮箱）",data:"userEmail"},{title:"办公电话",data:"officePhone"},{title:"默认域",data:"domainPath"},$.ProudSmart.datatable.optionCol3,{data:"createDate",title:"",visible:!1}],columnDefs:[{orderable:!1,targets:0,render:function(t,e,a){return"display"==e?t?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:2,data:"userName",render:function(t,e,a){return 0<a.isEdit&&"display"==e?(n=!0,"<input class='form-control col-xs-6' maxlength='20' placeholder='不能为空、空格，最多20个字符'  type='text'   style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>"):escape(t)}},{targets:3,data:"userEmail",render:function(t,e,a){return 3==a.isEdit&&"display"==e?"<input class='form-control col-xs-6'  placeholder='输入手机号码、邮箱'  type='text'   style='width: 100%;border: 1px solid #F18282;' value='"+t+"'>":t}},{targets:4,data:"officePhone",render:function(t,e,a){var n="";return n=null==t?"":t,0<a.isEdit&&"display"==e?""!=t?"<input class='form-control col-xs-6' placeholder='例如：010-68888888' style='width: 100%;' type='text'  value='"+n+"'>":"<input class='form-control col-xs-6' placeholder='例如：010-68888888' type='text'   style='width: 100%;'>":n}},{targets:5,data:"domainPath",render:function(t,e,a){return 0<a.isEdit&&"display"==e?"<div class='dropdowntree select-sm' name='domainPath' key='domainPath' placeholder='请选择...' model='"+t+"' change='' options='domainListTree' mark='nodes' />":null!=o.domainListDic[t]&&o.domainListDic[t]?o.domainListDic[t].name:""}},{targets:6,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return 2==a.isEdit||3==a.isEdit?(n+="<a id='save-btn' class='btn btn-default btn-sm'><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 取消</span></a>",n+="</div>"):(a.userID==o.userManager.userID?(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default' disabled  title='不能删除自己的账号'><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>",n+="<button type='button' disabled  title='不能操作自己的账号' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>"):(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>",n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>",n+="<li><a role='button' id='pwd-btn'>重置密码</a></li>",n+="<li><a role='button' id='role-user'>角色分配</a></li>",n+="<li><a role='button' id='domain-user'>域分配</a></li>",n+="<li><a role='button' id='remark-edit'>备注</a></li>"),n+="</ul></div>"),n}}],rowCallback:function(t,e,a){e.selected?$(t).addClass("selected"):$(t).removeClass("selected"),l(t)(o)}})}),a.on("change","#allselect-btn",function(t){if(t.stopPropagation(),t.target.checked){r.rows().select();for(var e=r.rows({selected:!0}),a=0;a<e.nodes().length;a++){r.row(e.nodes()[a]).data().selected=!0}r.rows().invalidate().draw(!1)}else{for(e=r.rows({selected:!0}),a=0;a<e.nodes().length;a++){r.row(e.nodes()[a]).data().selected=!1}r.rows().deselect(),r.rows().invalidate().draw(!1)}}),a.on("change",".itemCheckBox",function(t){var e=$(this).closest("tr"),a=r.row(e);t.target.checked?a.data().selected=!0:a.data().selected=!1;var n=r.rows({selected:!0});n.count()!=r.rows()[0].length?($("#allselect-btn").attr("checked",!1),$("#allselect-btn").prop("checked",!1)):n.count()==r.rows()[0].length&&($("#allselect-btn").attr("checked",!0),$("#allselect-btn").prop("checked",!0))}),a.on("click","#domain-user",function(t){n=!1;var e=$(this).closest("tr"),a=r.row(e);o.dialog(a.data().userID)}),a.on("click","#remark-edit",function(t){o.functionRoleName="0",o.$apply();var e=$(this).closest("tr"),a=r.row(e);a.child(function(t){if(null!=t)return'<table width="100%" class="table"><tr><td>备注:</td><td><textarea  id="discription" class="col-sm-6" style="height:100px;resize: none;" name="discription" maxlength="100"  type="text" >'+t.discription+'</textarea></td></tr><tr><td colspan="4"><div class="input-group"><a id="remark-btn" class="btn btn-default btn-sm" style="margin-right: 15px;"><i class="fa fa-check"></i><span class="hidden-xs ng-binding">保存</span></a><a id="remark-cancel" class="btn btn-default btn-sm"><i class="fa fa-close"></i><span class="hidden-xs ng-binding">取消</span></a></div></td></tr></table>'}(a.data())).show()}),a.on("click","#role-user",function(t){n=!1,o.functionRoleName="0",o.$apply();var e=$(this).closest("tr"),a=r.row(e);o.doAction("roleUserRole",a.data())}),a.on("click","#remark-cancel",function(t){var e=r.row(".shown");e&&(e.child.hide(),e.cells().invalidate())}),a.on("click","#remark-btn",function(t){var e=$(this).closest("tr"),a=(r.row(e),r.row(".shown"));a.data().discription=$("#discription").val(),o.doAction("save",a.data(),function(t){t&&(a.child.hide(),a.cells().invalidate())})}),a.on("click","#save-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),l=r.row(e),s=!0,a=(r.row(".shown"),$('div[name="domainPath"]').attr("model"));if(3==l.data().isEdit?$.each(e.children(),function(t,e){var a=$(e);if(!a.has("button").length&&a.has("input").length){var n=$.trim(a.children("input").val());if(n&&"请选择..."!=n){if(3==t){if(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(n))l.data().userEmalStatus="email";else{if(!/^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/.test(n))return $(e).addClass("danger"),s=!1;l.data().userEmalStatus="phone"}}if(4==t)if(!/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/.test(n))return $(e).addClass("danger"),s=!1;$(e).removeClass("danger"),r.cell(a).data(n)}else{if(2==t||3==t)return r.cell(a).data(n),$(e).addClass("danger"),s=!1;if(5==t)return $(e).addClass("danger"),s=!1;4==t&&r.cell(a).data("")}}}):2==l.data().isEdit&&$.each(e.children(),function(t,e){var a=$(e);if(!a.has("button").length&&a.has("input").length){var n=$.trim(a.children("input").val());if(n&&"请选择..."!=n){if(3==t){if(!/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/.test(n))return $(e).addClass("danger"),s=!1}$(e).removeClass("danger"),r.cell(a).data(n)}else if(1==t)return r.cell(a).data(n),$(e).addClass("danger"),s=!1}}),s){if(null==a||""==a||null==a)return void d.warning("请选择域",{});n=!1,3!=l.data().userType&&(l.data().domainPath=a,l.data().domainID=o.domainListDic[a].domainID),o.doAction("save",l.data(),function(t){t&&(3==l.data().isEdit&&(l.data().userID=t.userID),l.data().isEdit=0,l.data().selected=!1,l.cells().invalidate().draw(!1))})}}),a.on("click","#cancel-btn",function(t){t.stopPropagation(),n=!1;var e=$(this).closest("tr"),a=r.row(e);a.data().userID?(a.data().isEdit=0,a.cells().invalidate(),n=!1):(n=!1,a.remove().draw(!1))}),a.on("click","#edit-btn",function(t){if(t.preventDefault(),o.functionRoleName="0",o.$apply(),n)d.warning("当前有在编辑的用户，请先完成该操作",{});else{var e=$(this).closest("tr"),a=r.row(e);a.data().isEdit=2,a.cells().invalidate(),l(e)(o),n=!0}}),a.on("click","#del-btn",function(t){t.preventDefault(),n=!1,o.functionRoleName="0",o.$apply();var e=$(this).closest("tr"),a=r.row(e);o.doAction("delete",a.data(),function(t){t&&a.remove().draw(!1)})}),a.on("click","#group-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=r.row(e);o.doAction("assignGroup",a.data())}),a.on("click","#pwd-btn",function(t){t.preventDefault(),o.functionRoleName="0",o.$apply();var e=$(this).closest("tr"),a=r.row(e);o.doAction("resetPwd",a.data())}),o.activeSelectedDel=function(){var t=r.rows({selected:!0}),s=t.count(),i=t.nodes();0!=s?c.show({title:"提示",closable:!1,message:"确认删除您所选择的 "+s+" 条记录吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(t){for(var a=0,n=0,e=0;e<i.length;e++){var l=r.row(i[e]).data();o.userManager.userID!=l.userID?o.doActiveHanddler(l,function(t,e){t?(r.row(e).remove().draw(!1),a++):n++,s==a+n&&(r.rows().deselect(),d.success("成功删除用户"+a+"个,失败"+n+"个",{}))},i[e]):s-=1}t.close()}},{label:"取消",action:function(t){t.close()}}]}):d.warning("当前没有选中的用户",{})},o.activeSelectedDel=function(){var t=r.rows({selected:!0}),s=t.count(),i=t.nodes();0!=s?c.show({title:"提示",closable:!1,message:"确认重置您所选择的 "+s+" 条记录吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(t){for(var a=0,n=0,e=0;e<i.length;e++){var l=r.row(i[e]).data();o.userManager.userID!=l.userID?o.doActivePwd(l,function(t,e){t?(r.row(e).cells().invalidate().draw(!1),a++):n++,s==a+n&&($(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),r.rows().deselect(),d.success("成功重置用户密码"+a+"个,失败"+n+"个",{}))},i[e]):(s-=1,$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),r.rows().deselect())}t.close()}},{label:"取消",action:function(t){t.close()}}]}):d.warning("当前没有选中的用户",{})}}]}}]),i.initDirective("contractTable",["$timeout","$compile",function(t,s){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,e){var a,l=t;n.$on(Event.USERINFOSINIT+"_contract",function(t,e){a&&a.destroy(),!1,a=l.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:i.datatable.language,data:e.data,rowCallback:function(t,e,a){s(t)(n)},columns:e.columns,columnDefs:e.columnDefs})}),l.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a  class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新建合同</span></a>'),s(t)(n)})}]}}]),i.initDirective("maintainTable",["$timeout","$compile",function(t,s){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,e){var a,l=t;n.$on(Event.USERINFOSINIT+"_maintain",function(t,e){a&&a.destroy(),!1,a=l.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:i.datatable.language,data:e.data,rowCallback:function(t,e,a){s(t)(n)},columns:e.columns,columnDefs:e.columnDefs})}),l.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a  class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新建计划</span></a>'),s(t)(n)})}]}}]),i.initDirective("loreTable",["$timeout","$compile",function(t,s){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,e){var a,l=t;n.$on(Event.USERINFOSINIT+"_lore",function(t,e){a&&a.destroy(),!1,a=l.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:i.datatable.language,data:e.data,rowCallback:function(t,e,a){s(t)(n)},columns:e.columns,columnDefs:e.columnDefs})}),l.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a  class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新建知识</span></a>'),s(t)(n)})}]}}]),i.initDirective("superTable",["$timeout","$compile",function(t,e){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,a){var s,n=t;l.$on(Event.USERINFOSINIT+"_super",function(t,e){s&&s.destroy(),!1,s=n.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,columns:e.columns,columnDefs:e.columnDefs,data:e.data})}),l.$on("table-search-handle",function(t,e){e.name==a.name&&s.search(e.value).draw()}),n.on("click","td",function(t){t.preventDefault();var e=$(this).closest("tr"),a=$(this).text(),n=s.row(e).data();" 切换登录"==a&&l.loginin(n.userEmail)})}]}}]),i.initDirective("currentTable",["$timeout","$compile",function(t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(s,t,e){var i,a=t;s.$on(Event.CURRENTINFOSINIT,function(t,e){i&&i.destroy(),!1,i=a.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,order:[[4,"desc"]],columns:[$.ProudSmart.datatable.selectCol,{title:"角色名称",data:"roleName"},{title:"角色描述",data:"description"},$.ProudSmart.datatable.optionCol3,{data:"roleID",title:"",visible:!1}],columnDefs:[{orderable:!1,targets:0,render:function(t,e,a){return"display"==e?t?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"roleName",render:function(t,e,a){if(0<a.isEdit&&"display"==e)return"<input class='form-control col-xs-6'   type='text'  maxlength='20'  style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>";var n=t;return 1==s.userManager.userID&&(100==a.roleID?n="A"+t:102==a.roleID?n="A"+t:101==a.roleID?n="B"+t:103==a.roleID&&(n="B"+t)),escape(n)}},{targets:2,data:"description",render:function(t,e,a){return 0<a.isEdit&&"display"==e?"<input class='form-control col-xs-6'  maxlength='100'  type='text'   style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";if(0<a.isEdit)n+="<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>",n+="<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>",n+="</div>";else if(100==a.roleID||102==a.roleID||1e3==a.roleID||101==a.roleID||103==a.roleID||2e3==a.roleID||2001==a.roleID){var l="查看功能";1==s.userManager.userID&&(l="功能分配"),n+="<button id='edit-btn' class='btn btn-primary' disabled><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default' disabled><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>",n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>",n+="<li><a role='button' id='user-allot'>用户分配</a></li>",n+="<li><a role='button' id='fun-btn'>"+l+"</a></li>",n+="</ul></div>"}else n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>",n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>",n+="<li><a role='button' id='fun-btn'>功能分配</a></li>",n+="<li><a role='button' id='user-allot'>用户分配</a></li>",n+="</ul></div>";return n}}],data:e.data,rowCallback:function(t,e,a){e.selected?$(t).addClass("selected"):$(t).removeClass("selected"),n(t)(s)}})}),a.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addUser()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新建角色</span></a>'),n(t)(s)}),a.on("change","#allselect-btn",function(t){if(t.stopPropagation(),t.target.checked){i.rows().select();for(var e=i.rows({selected:!0}),a=0;a<e.nodes().length;a++){i.row(e.nodes()[a]).data().selected=!0}i.rows().invalidate().draw(!1)}else{for(e=i.rows({selected:!0}),a=0;a<e.nodes().length;a++){i.row(e.nodes()[a]).data().selected=!1}i.rows().deselect(),i.rows().invalidate().draw(!1)}}),a.on("change",".itemCheckBox",function(t){var e=$(this).closest("tr"),a=i.row(e);t.target.checked?a.data().selected=!0:a.data().selected=!1;var n=i.rows({selected:!0});n.count()!=i.rows()[0].length?($("#allselect-btn").attr("checked",!1),$("#allselect-btn").prop("checked",!1)):n.count()==i.rows()[0].length&&($("#allselect-btn").attr("checked",!0),$("#allselect-btn").prop("checked",!0))}),a.on("click","#edit-save",function(t){var e=$(this).closest("tr"),n=[],a=e.find("input"),l=!0;$.each($(".shown").children(),function(t,e){var a=$(e);if(""==$.trim(a.children("input").val()))return $(e).addClass("danger"),l=!1;$(e).removeClass("danger")}),$.each(a,function(t,e){var a=$.trim($(e).val());0==t?n.roleName=a:1==t?n.description=a:2==t&&(n.roleID=a)}),l&&s.doAction("modifyRole",n,function(t){t&&(3==row.data().isEdit&&(row.data().roleID=t.roleID),row.data().isEdit=0,row.cells().invalidate().draw(!1))})}),a.on("click","#save-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),a=i.row(e),l=!0;i.row(".shown");$.each(e.children(),function(t,e){var a=$(e);if(!a.has("button").length&&a.has("input").length){var n=$.trim(a.children("input").val());if(n&&"请选择..."!=n)$(e).removeClass("danger"),i.cell(a).data(n);else if(0==t||1==t)return i.cell(a).data(n),$(e).addClass("danger"),l=!1}}),l&&(!1,s.doAction("addRole",a.data(),function(t){t&&(3==a.data().isEdit&&(a.data().roleID=t.roleID),a.data().isEdit=0,a.cells().invalidate().draw(!1))}))}),a.on("click","#cancel-btn",function(t){!1;var e=$(this).closest("tr"),a=i.row(e);a.data().isEdit=0,!1,a.data().roleID?a.cells().invalidate().draw(!1):a.remove().draw(!1)}),a.on("click","#user-allot",function(t){var e=$(this).closest("tr"),a=i.row(e);s.dialogUser(a.data())}),a.on("click","#fun-btn",function(t){var e=$(this).closest("tr"),a=i.row(e);s.dialogFun(a.data())}),a.on("click","#cancel-up",function(t){!1,s.doAction("cancel")}),a.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e);s.doAction("deleteRole",a.data(),function(t){t&&a.remove().draw(!1)})}),a.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e);a.data().isEdit=2,a.cells().invalidate()})}]}}]),i.initDirective("functionTable",["$timeout",function(t){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,e,a){var n,l=e;t.$on(Event.FUNCTIONINFOSINIT,function(t,e){n&&n.destroy(),!1,n=l.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e.data,columns:e.columns,columnDefs:e.columnDefs,scrollX:!0})})}]}}]),i.initDirective("userRoleTable",["$timeout","$compile",function(t,s){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,e){var a,l=t;n.$on(Event.CURRENTINFOSINIT+"_userRole",function(t,e){a&&a.destroy(),!1,a=l.DataTable({scrollY:"300px",scrollCollapse:!0,paging:!1,searching:!1,info:!1,select:$.ProudSmart.datatable.select,order:[[3,"desc"]],columns:[$.ProudSmart.datatable.selectCol,{title:"用户名称",data:"userName"},{title:"登录账户（手机/邮箱）",data:"emailAddress"},{data:"createDate",title:"",visible:!1}],columnDefs:[{orderable:!1,targets:0,render:function(t,e,a){return"display"==e?t?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}}],data:e.data,rowCallback:function(t,e,a){e.selected?$(t).addClass("selected"):$(t).removeClass("selected"),s(t)(n)}})})}]}}]),i.initDirective("roleUserTable",["$timeout","$compile",function(t,e){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,e,a){var l,n=e;t.$on(Event.CURRENTINFOSINIT+"_roleUser",function(t,e){l&&l.destroy(),!1,l=n.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e.data,columns:[{title:"选择",orderable:!1,data:"option"},{title:"角色名称",data:"roleName"},{title:"角色描述",data:"description"}],columnDefs:[{targets:0,data:"option",render:function(t,e,a){var n='<input type="checkbox" style="width: 19px;height: 25px;" boxClass="icheckbox_minimal-blue" value="'+a.roleID+'"  name="oddBox" class="minimal" > ';return 1003==a.domainID&&(n='<input type="checkbox" style="width: 19px;height: 25px;" boxClass="icheckbox_minimal-blue" value="'+a.roleID+'"  name="oddBox" class="minimal" checked=checked> '),n}},{targets:1,data:"roleName",render:function(t,e,a){return escape(t)}},{targets:2,data:"description",render:function(t,e,a){return escape(t)}}]})}),n.on("click","td",function(t){t.preventDefault();var e=$(this).closest("tr"),a=l.row(e),n=a.data();1003!=n.domainID?n.domainID=1003:n.domainID=0,a.cells().invalidate()})}]}}]),i.initDirective("enterpriseTable",["$timeout","$compile","growl",function(t,l,o){return{restrict:"A",controller:["$scope","$element","$attrs",function(s,t,a){var i,n=t;s.$on(Event.USERINFOSINIT+"_enter",function(t,e){i&&i.destroy(),!1,i=n.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e.data,columns:e.columns,rowCallback:function(t,e,a){l(t)(s)},columnDefs:e.columnDefs})}),n.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addEnterprise()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新建企业</span></a>'),l(t)(s)}),s.$on("table-search-handle",function(t,e){e.name==a.name&&i.search(e.value).draw()}),n.on("click","td",function(t){t.preventDefault();var e=$(this).closest("tr"),a=$(this).text(),n=i.row(e).data();" 切换登录"==a&&s.loginin(n.userEmail)}),n.on("click","#file-txt",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e),n=a.data();s.enterId=n.enterpriseID,a.child(function(t){if(null!=t)return'<table width="100%" class="table"><tr><td>上传logo:</td><td><input type="file" id="uploadImg" name="uploadImg" /></td></tr><tr><td>图片展示:</td><td><img id="imgLook" name="imgLook" width="200" height="50"  /><span style="color: red;">推荐尺寸200 x 50</span></td></tr><tr><td colspan="4"><div class="input-group"><a id="logo-btn" class="btn btn-default btn-sm" style="margin-right: 15px;"><i class="fa fa-check hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default btn-sm"><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a></div></td></tr></table>'}(a.data())).show()}),n.on("click","#copy-right-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e),n=a.data();s.enterId=n.enterpriseID,a.child(function(t){if(null!=t){var e='<table width="100%" class="table">';return e+="<tr>",e+='<td><label class="control-label">企业版权名称:</label></td>',e+='<td><input class="form-control col-xs-6 input-sm"  type="text" value="'+t.copyRight+'" id="enterpriseName" name="enterpriseName" /></td>',e+='<td><label class="control-label">企业链接:</label></td>',e+='<td><input class="form-control col-xs-6 input-sm"  type="text" value="'+t.websiteUrl+'" id="enterpriseUrl" name="enterpriseUrl" /></td>',e+='<td style="text-align: center;"><div class="input-group">',e+='<a id="update-btn" class="btn btn-default btn-sm" style="margin-right: 15px;"><i class="fa fa-check hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">保存</span></a>',e+='<a id="cancel-btn" class="btn btn-default btn-sm"><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a></div></td>',e+="</tr>",e+="</table>"}}(a.data())).show()}),n.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e),n=a.data();n.closingDate&&(n.closingDate=new Date(n.closingDate).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")),s.enterpriseObj=jQuery.extend(!0,{},n),a.child(function(t){if(null!=t)return'<table width="100%" class="table"><tr><td><label class="control-label">企业名称:</label></td><td><input class="form-control col-xs-6 input-sm"  type="text"  ng-model="enterpriseObj.name" id="name" name="name" /></td><td><label class="control-label">试用结束时间:</label></td><td> <input type="text" class="form-control input-sm"  readonly="readonly" autocomplete="off" drops="down" ng-model="enterpriseObj.closingDate"  date-time-picker ></td><td style="text-align: center;"><div class="input-group"><a id="edit-save-btn" class="btn btn-default btn-sm" style="margin-right: 15px;"><i class="fa fa-check hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default btn-sm"><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a></div></td></tr></table>'}(a.data())).show(),l(e.next())(s)}),n.on("click","#uploadImg",function(t){t.preventDefault(),$("#fileUp").trigger("click")}),n.on("click","#cancel-btn",function(t){t.preventDefault(),s.cancel()}),n.on("click","#block",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e);s.blockClick(a.data())}),n.on("click","#logo-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=(i.row(e),s.uploader.queue);for(var n in a)a[n].upload()}),n.on("click","#update-btn",function(t){t.preventDefault();var e=$("#enterpriseName").val(),a=$("#enterpriseUrl").val(),n=$(this).closest("tr"),l=(i.row(n),s.enterId);s.editEnterprise(e,a,l)}),n.on("click","#edit-save-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=(i.row(e),!1),n=new Date(s.enterpriseObj.closingDate).Format("yyyy-MM-dd"),l=checkDate(n);a=!s.enterpriseObj.closingDate||0!=l||(o.warning("您选择的试用结束时间小于当前时间",{}),!1),s.enterpriseObj&&a&&s.modifyEnterpriseInfo(s.enterpriseObj)}),n.on("click","#role-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e);s.roleEdit(a.data())})}]}}]),i.initDirective("clientTable",["$timeout","growl","$compile",function(t,e,a){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,a){var l,s=t;n.$on(Event.CLIENTMANAGEINIT,function(t,e){l&&(l.destroy(),s.empty()),!1,l=s.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e.data,order:[[7,"desc"]],columns:e.columns,columnDefs:e.columnDefs})}),n.$on("table-search-handle",function(t,e){e.name==a.name&&l.search(e.value).draw()}),s.on("init.dt",function(){}),s.on("click","#edit-btn",function(t){var e=$(this).closest("tr"),a=l.row(e).data();n.doAction("editClient",a)}),s.on("click","#del-btn",function(t){!1;var e=$(this).closest("tr"),a=l.row(e);n.doAction("delete",a.data(),function(t){0==t&&(a.data().isEdit=0,a.remove().draw(!1))})})}]}}]),i.initDirective("clientOtherTable",["$timeout","growl","ngDialog","$compile",function(t,e,l,a){return{restrict:"A",controller:["$scope","$element","$attrs",function(o,t,e){var n,a=t;o.$on(Event.CLIENTMANAGEINIT+"_Other",function(t,e){n&&(n.destroy(),a.empty()),n=a.DataTable({dom:"",language:$.ProudSmart.datatable.language,data:e,columns:[{title:"联系人",data:"contactName"},{title:"联系人职务",data:"contactDuty"},{title:"联系电话",data:"contactPhone"},{title:"邮箱地址",data:"contactEmail"},$.ProudSmart.datatable.optionCol2,{title:"",data:"createTime",visible:!1}],columnDefs:[{targets:0,data:"customerName",render:function(t,e,a){return 0<a.isEdit&&"display"==e?"<input class='form-control col-xs-6' type='text'  maxlength='20'  style='text-indent: 0.5em;' value='"+escape(t)+"'>":escape(t)}},{targets:1,data:"contactDuty",render:function(t,e,a){if(0<a.isEdit&&"display"==e){var n='<select class="bk-select bk-select-l2" style="border: solid 1px #d2d6de;height: 35px;text-indent: 0.5em;"><option value=""></option>';for(var l in o.jobs)o.jobs[l].valueCode==t&&(n+='<option value="'+o.jobs[l].valueCode+'" selected="selected">'+o.jobs[l].label+"</option>"),n+='<option value="'+o.jobs[l].valueCode+'">'+o.jobs[l].label+"</option>";return n+="</select>"}var s="";for(var l in o.jobs)o.jobs[l].valueCode==t&&(s=o.jobs[l].label);return s}},{targets:2,data:"contactPhone",render:function(t,e,a){return 0<a.isEdit&&"display"==e?"<input class='form-control col-xs-6' type='text'  maxlength='20'  style='text-indent: 0.5em;' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"contactEmail",render:function(t,e,a){return 0<a.isEdit&&"display"==e?"<input class='form-control col-xs-6' type='email'  maxlength='320'  style='text-indent: 0.5em;' value='"+escape(t)+"'>":escape(t)}},{targets:4,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return 2==a.isEdit?(n+="<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>",n+="<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>",n+="</div>"):(n+="<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>"),n}},{targets:5,data:"createTime",render:function(t,e,a){return 0<a.isEdit&&"display"==e?"<input class='form-control col-xs-6' type='email'  maxlength='320'  style='text-indent: 0.5em;' value='"+escape(t)+"'>":escape(t)}}]})}),a.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=n.row(e);a.data().isEdit=3,$.extend(o.inputItem.clientOther,a.data()),o.mistakeMesg.email=!1,o.mistakeMesg.phone=!1,l.open({template:"../partials/dialogue/client_other_dia.html",className:"ngdialog-theme-plain",scope:o})}),a.on("click","#cancel-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),a=n.row(e);a.data().isEdit=0,o.inputFun.doActionOther("cancel",a.data())}),a.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=n.row(e);o.inputFun.doActionOther("delete",a.data(),function(t){t&&a.remove().draw(!1)})}),a.on("click","#save-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),s=n.row(e),i=!0;$.each(e.children(),function(t,e){var a=$(e),n=$.trim(a.children("select").val());if(1==t&&(s.data().contactDuty=n),!a.has("button").length&&a.has("input").length){var l=$.trim(a.children("input").val());if(0==t){if(/^\s*$/g.test(l))return $(e).addClass("danger"),i=!1;s.data().contactName=l,$(e).removeClass("danger"),i=!0}if(2==t){if(!/^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/.test(l))return $(e).addClass("danger"),i=!1;$(e).removeClass("danger"),s.data().contactPhone=l,i=!0}if(3==t){if(!/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(l))return $(e).addClass("danger"),i=!1;$(e).removeClass("danger"),s.data().contactEmail=l,i=!0}}}),i&&o.inputFun.doActionOther("save",s.data(),function(){s.data().isEdit=0,s.cells().invalidate().draw(!1)})})}]}}]),i.initDirective("dealerTable",["$timeout","ngDialog","growl","$compile",function(t,l,e,a){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,e){var o,a=t;n.$on(Event.CLIENTMANAGEINIT+"_dealer",function(t,e){o&&(o.destroy(),a.empty()),o=a.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e.data,order:[[7,"desc"]],columns:e.columns,columnDefs:e.columnDefs})}),a.on("click","#save-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),s=o.row(e),i=!0;$.each(e.children(),function(t,e){var a=$(e),n=$.trim(a.children("select").val());if(3==t&&(s.data().contactDuty=n),!a.has("button").length&&a.has("input").length){var l=$.trim(a.children("input").val());if(0==t){if(/^\s*$/g.test(l))return $(e).addClass("danger"),i=!1;s.data().domainPath=l,$(e).removeClass("danger"),i=!0}if(4==t){if(!/^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/.test(l))return $(e).addClass("danger"),i=!1;$(e).removeClass("danger"),s.data().contactPhone=l,i=!0}if(5==t){if(!/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(l))return $(e).addClass("danger"),i=!1;$(e).removeClass("danger"),s.data().contactEmail=l,i=!0}o.cell(a).data(l)}}),i&&n.doDealerAction("save",s.data(),function(t){0==t?(s.data().isEdit=0,s.cells().invalidate().draw(!1)):s.data().isEdit=2})}),a.on("click","#cancel-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),a=o.row(e);n.doDealerAction("cancel",a.data())}),a.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=o.row(e);a.data().isEdit=3,$.extend(n.inputItem.dealer,a.data()),l.open({template:"../partials/dialogue/dealer_info_dia.html",className:"ngdialog-theme-plain",scope:n})}),a.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=o.row(e);n.doDealerAction("delete",a.data(),function(t){0!=t||a.remove().draw(!1)})})}]}}]),i.initDirective("ckeditor",["$timeout","$compile",function(t,e){return{restrict:"A",require:"ngModel",controller:["$scope","$element","$attrs","userUIService",function(t,n,e,l){require(["ckeditor"],function(t){var e=$(n).attr("id"),a=l.uploadFileUrl+"/api/rest/upload/userUIService/uploadFile";CKEDITOR.replace(e,{customConfig:"../../toolkit/ckeditor_config_standard.js",extraPlugins:"myplugin,colorbutton,colordialog,smiley,iframe,iframedialog,flash,find,font,preview,justify,pagebreak,placeholder,newpage,selectall,templates,forms,notificationaggregator,notification,filetools,uploadwidget,widget,showblocks,codesnippet",height:500,filebrowserUploadUrl:a,filebrowserBrowseUrl:a,filebrowserImageBrowseUrl:a,filebrowserFlashBrowseUrl:a,filebrowserImageUploadUrl:a,filebrowserFlashUploadUrl:a,stylesSet:[{name:"Narrow image",type:"widget",widget:"image",attributes:{class:"image-narrow"}},{name:"Wide image",type:"widget",widget:"image",attributes:{class:"image-wide"}}]}).on("fileUploadRequest",function(t){t.data.fileLoader.xhr.withCredentials=!0})})}]}}]),i.initDirective("supplierTable",["$timeout",function(t){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,e){var i,a=t,o=!1;n.$on(Event.SUPPLIERMANAGEINIT,function(t,e){i&&i.destroy(),o=!1,i=a.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e.data,columns:e.columns,columnDefs:e.columnDefs,scrollX:!0})}),a.on("click","td",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e);if(5!=$(this).context.cellIndex||0!=a.data().isEdit){if(a.child.isShown()||null!=a.data()&&e.addClass("shown"),null!=a.data()&&1==a.data().isEdit){a.data().isEdit=2;var n=$(this).parents("tr").children();$.each(n,function(t,e){var a=$(e);if(4==t)return!0;if(a.has("button").length){var n=$('<a id="save-btn" style="margin-right: 15px;" class="btn btn-default btn-sm"><i class="fa fa-check"></i><span class="hidden-xs ng-binding">保存</span></a><a  id="cancel-btn" class="btn btn-default btn-sm"><i class="fa fa-close"></i><span class="hidden-xs ng-binding">取消</span></a>');return a.html(n),!0}var l=a.text();if(3==t&&""==l)return(n=$("<input class='form-control  col-xs-6' style='width:100%;'   maxlength='30'  type='text'  >")).val(l),a.html(n),!0;var s=$("<input class='form-control  col-xs-6' style='width:100%;border: 1px solid #F18282;'  maxlength='30'  type='text'  >");s.val(l),a.html(s)})}}else t.preventDefault()}),a.on("click","#save-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),l=(i.row(e),!0),s=i.row(".shown");$.each($(".shown").children(),function(t,e){var a=$(e);if(!a.has("button").length&&a.has("input").length){var n=a.children("input").val();if(n){if(2==t){if(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(n))s.data().userEmalStatus="email";else{if(!/^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/.test(n))return $(e).addClass("danger"),l=!1;s.data().userEmalStatus="phone"}}$(e).removeClass("danger"),i.cell(a).data(n)}else if(0==t||1==t)return i.cell(a).data(n),$(e).addClass("danger"),l=!1}});e.parent().find("input");l&&(o=!1,n.doAction("save",s.data()))}),a.on("click","#cancel-btn",function(t){t.stopPropagation(),o=!1,n.doAction("cancel")}),a.on("click","#edit-btn",function(t){t.preventDefault(),o=!1;var s=$(this).parents("tbody").children();if($.each(s,function(t,e){var a=$(e).closest("tr"),n=i.row(a);if(null==n.data()&&s.eq(t).remove(),null!=n.data()&&3==n.data().isEdit)s.eq(t).remove();else{var l=s.eq(t).find("input");$.each(l,function(t,e){var a=$(e).val();$(e).replaceWith(a)})}}),!o){o=!0;var e=$(this).closest("tr");i.row(e).data().isEdit=1}}),a.on("click","#del-btn",function(t){t.preventDefault(),o=!1;var s=$(this).parents("tbody").children();$.each(s,function(t,e){var a=$(e).closest("tr"),n=i.row(a);if(null==n.data()&&s.eq(t).remove(),null!=n.data()){var l=s.eq(t).find("input");$.each(l,function(t,e){var a=$(e).val();$(e).replaceWith(a)})}});var e=$(this).closest("tr"),a=i.row(e);n.doAction("delete",a.data())})}]}}]),i.initDirective("systemTable",["$timeout","$compile",function(t,e){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,a){var l,s=t;n.$on(Event.USERINFOSINIT+"_system",function(t,e){l&&l.destroy(),!1,l=s.DataTable({dom:e.data&&0<e.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:e.data,columns:e.columns,aaSorting:[[1,"desc"]],columnDefs:e.columnDefs})}),s.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a href="#/mailedit" class="pull-right btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新增</span></a>'),e(t)(n)}),n.$on("table-search-handle",function(t,e){e.name==a.name&&l.search(e.value).draw()}),s.on("click","#update-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),a=l.row(e);location.href="#/mailedit/"+a.data().messageId}),s.on("click","#delete-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),a=l.row(e);n.deleteMessage(a.data())}),s.on("click","#publish-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),a=l.row(e);n.publishMessage(a.data())}),s.on("click","#preview-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),a=l.row(e);n.preview(a.data())})}]}}])});
//# sourceMappingURL=../../../map/app-oc/js/directives/user-dom.js.map
