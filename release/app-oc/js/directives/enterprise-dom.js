define(["directives/directives","bootstrap-dialog","datatables.net","jszip","datatables.net-bs","datatables.net-select","datatables.net-buttons-bs","datatables.buttons.html5"],function(t,e,a,p){"use strict";t.initDirective("enterpriseInfoTable",["$timeout","ngDialog","$compile","$filter","growl",function(t,n,o,e,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,e){var c,a=t;window.JSZip=p,l.$on(Event.ENTERPRISEINIT+"_info",function(t,e){c&&(c.destroy(),a.empty());var n=[{data:"name",title:"企业名称"},{data:"industryType",title:"行业类型"},{data:"address",title:"所在区域"},{data:"statisticsType",title:"统计周期类型"},{data:"createTime",title:"",visible:!1},$.ProudSmart.datatable.optionCol3];c=a.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+$.ProudSmart.datatable.footerdom,language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,processing:!0,serverSide:!0,ordering:!0,aaSorting:[[4,"desc"]],ajax:l.pipeline(),columns:n,columnDefs:[{targets:0,data:"name",render:function(t,e,a){return escape(t)}},{targets:1,data:"industryType",render:function(t,e,a){var n="",o=l.industryList;for(var s in o)if(o[s].valueCode==t)return n=o[s].text;if(!n)return"-"}},{targets:2,data:"address",render:function(t,e,a){return a.province&&a.city&&a.county?a.county:a.province&&a.city&&!a.county?a.city:a.province}},{targets:3,data:"statisticsType",render:function(t,e,a){var n="",o=l.dialog.list.periodList;for(var s in o)if(o[s].id==t){n=o[s].label;break}return n}},{targets:5,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return n+="<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button>",n+="<button  type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>",n+="<li><a  href='#/energyStructureInfo/"+a.id+"'>能耗结构</a></li>",n+="<li><a  href='#/productInfo/"+a.id+"'>产品结构</a></li>",n+="<li><a  href='#/basicBusinessInfo/"+a.id+"'>企业基本信息</a></li>",n+="<li><a  href='#/EnterpriseOperateInfo/"+a.id+"'>企业经营信息</a></li>",n+="</ul></div>"}}],rowCallback:function(t,e,a){o(t)(l)},drawCallback:function(t){if(0<this.api().data().length){for(var e=[],a=0;a<n.length-1;a++)e.push(a);new $.fn.dataTable.Buttons(c,{buttons:[{extend:"excel",title:"企业信息导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:e}}]}),c.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 ")}else $(".footerdom").hide(),$(".dataTables_wrapper .col-sm-6").hide()}})}),a.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.dialog.event.provinceClick(a.data().province),l.dialog.event.cityClick(a.data().city),$.extend(l.dialog.input,a.data()),n.open({template:"../partials/dialogue/enterprise_dia.html",className:"ngdialog-theme-plain",scope:l})}),a.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.doAction("delete",[a.data().id],function(t){0==t.code&&a.remove().draw(!1)})}),a.on("click","#inform-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e).data();location.href="index.html#/alertInforms/"+$.trim(a.id)}),a.on("change","#allselect-btn",function(t){if(t.stopPropagation(),t.target.checked){c.rows().select(),c.rows().invalidate().draw(!1);for(var e=c.rows({selected:!0}),a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!0,$($(e.nodes()[a]).children()[0]).prop("checked",!0)}}else{c.rows().invalidate().draw(!1);for(e=c.rows({selected:!0}),a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!1}c.rows().deselect()}l.selectedCount=e.count(),l.$apply()}),a.on("change",".itemCheckBox",function(t){var e=$(this).closest("tr"),a=c.row(e);t.target.checked?a.data().selected=!0:a.data().selected=!1;var n=c.rows({selected:!0});0==n.count()&&$("#allselect-btn").attr("checked",!1),l.selectedCount=n.count(),l.$apply()}),l.selectedDelete=function(){var t=c.rows({selected:!0}),e=t.count(),a=t.nodes();if(0!=e){for(var n=0,o=0,s=[],d=!1,i=0;i<a.length;i++){var r=c.row(a[i]).data();0<r.id?(s.push(r.id),n++):o++,e==n+o&&(d=!0)}d&&l.doAction("delete",s,function(t){if(0==t.code){for(var e=0;e<a.length;e++){c.row(a[e]).remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}})}else u.warning("当前没有选中的企业信息",{})}}]}}]),t.initDirective("productInfoTable",["$timeout","ngDialog","$compile","$filter","growl",function(t,n,d,e,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,e){var c,s=t;window.JSZip=p,l.$on(Event.ENTERPRISEINIT+"_product",function(t,e){c&&(c.destroy(),s.empty());var a=[$.ProudSmart.datatable.selectCol,{data:"enterpriseId",title:"企业名称",visible:l.ifShowEnter},{data:"name",title:"产品名称"},{data:"desc",title:"产品描述"},{data:"unit",title:"产品单位"},{data:"createTime",title:"创建时间",visible:!1},$.ProudSmart.datatable.optionCol3];c=s.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+(e.option&&1<=e.option[0].length?$.ProudSmart.datatable.footerdom:""),language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,data:e.option[0],order:[[4,"desc"]],columns:a,columnDefs:[{targets:0,orderable:!1,render:function(t,e,a){return"display"==e?t?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"enterpriseId",render:function(e,t,a){var n=l.enterpriseList.filter(function(t){return t.id==e});return n&&1<=n.length&&n[0].name?n[0].name:"-"}},{targets:2,data:"name",render:function(t,e,a){return escape(t)}},{targets:3,data:"desc",render:function(t,e,a){return escape(t)}},{targets:4,data:"unit",render:function(t,e,a){return t||"无"}},{targets:6,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return n+="<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button>",n+="<button  type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>",n+="<li><a  href='#/productStructureInfo/"+a.id+"'>工艺流程</a></li>",n+="</ul></div>"}}],rowCallback:function(t,e,a){d(t)(l)}});for(var n=[],o=1;o<a.length-1;o++)n.push(o);e.option&&1<=e.option[0].length&&(new $.fn.dataTable.Buttons(c,{buttons:[{extend:"excel",title:"产品结构导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:n}}]}),c.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 "))}),s.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);$.extend(l.dialog.input,a.data()),n.open({template:"../partials/dialogue/product_info_dia.html",className:"ngdialog-theme-plain",scope:l})}),s.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.doAction("delete",[a.data().id],function(t){0==t.code&&a.remove().draw(!1)})}),s.on("change","#allselect-btn",function(t){if(t.stopPropagation(),t.target.checked){c.rows().select();var e=c.rows({selected:!0});l.selectedCount=e.count(),l.$apply();for(var a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!0}c.rows().invalidate().draw(!1)}else{for(e=c.rows({selected:!0}),a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!1}c.rows().deselect(),l.selectedCount=0,l.$apply(),c.rows().invalidate().draw(!1)}}),s.on("change",".itemCheckBox",function(t){var e=$(this).closest("tr"),a=c.row(e);t.target.checked?a.data().selected=!0:a.data().selected=!1;var n=c.rows({selected:!0});0==n.count()&&$("#allselect-btn").attr("checked",!1),l.selectedCount=n.count(),l.$apply()}),l.selectedDelete=function(){var t=c.rows({selected:!0}),e=t.count(),a=t.nodes();if(0!=e){for(var n=0,o=0,s=[],d=!1,i=0;i<a.length;i++){var r=c.row(a[i]).data();0<r.id?(s.push(r.id),n++):o++,e==n+o&&(d=!0)}d&&l.doAction("delete",s,function(t){if(0==t.code){for(var e=0;e<a.length;e++){c.row(a[e]).remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}else t||($(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect())})}else u.warning("当前没有选中的产品信息",{})}}]}}]),t.initDirective("productListTable",["$timeout","ngDialog","$compile","$filter","growl",function(t,n,d,e,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,e){var c,s=t;window.JSZip=p,l.$on(Event.ENTERPRISEINIT+"_productList",function(t,e){c&&(c.destroy(),s.empty());var a=[$.ProudSmart.datatable.selectCol,{data:"name",title:"产品名称"},{data:"desc",title:"产品描述"},{data:"unit",title:"产品单位"},{data:"createTime",title:"创建时间",visible:!1},$.ProudSmart.datatable.optionCol3];c=s.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+(e.option&&1<=e.option[0].length?$.ProudSmart.datatable.footerdom:""),language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,data:e.option[0],order:[[4,"desc"]],columns:a,columnDefs:[{targets:0,orderable:!1,render:function(t,e,a){return"display"==e?t?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"name",render:function(t,e,a){return escape(t)}},{targets:2,data:"desc",render:function(t,e,a){return escape(t)}},{targets:3,data:"unit",render:function(t,e,a){return t||"无"}},{targets:4,data:"createTime",render:function(t,e,a){var n="";return t&&(n=useMomentFormat(t,"yyyy-MM-dd hh:mm:ss")),n}},{targets:5,data:"option",render:function(t,e,a){return"<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>","<button id='del-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button>","</div>","<div class='btn-group btn-group-sm'><button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button><button id='del-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button></div>"}}],rowCallback:function(t,e,a){d(t)(l)}});for(var n=[],o=1;o<a.length-1;o++)n.push(o);e.option&&1<=e.option[0].length&&(new $.fn.dataTable.Buttons(c,{buttons:[{extend:"excel",title:"产品结构导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:n}}]}),c.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 "))}),s.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);$.extend(l.dialog.input,a.data()),n.open({template:"../partials/dialogue/product_info_dia.html",className:"ngdialog-theme-plain",scope:l})}),s.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.doAction("delete",[a.data().id],function(t){0==t.code&&a.remove().draw(!1)})}),s.on("change","#allselect-btn",function(t){if(t.stopPropagation(),t.target.checked){c.rows().select();var e=c.rows({selected:!0});l.selectedCount=e.count(),l.$apply();for(var a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!0}c.rows().invalidate().draw(!1)}else{for(e=c.rows({selected:!0}),a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!1}c.rows().deselect(),l.selectedCount=0,l.$apply(),c.rows().invalidate().draw(!1)}}),s.on("change",".itemCheckBox",function(t){var e=$(this).closest("tr"),a=c.row(e);t.target.checked?a.data().selected=!0:a.data().selected=!1;var n=c.rows({selected:!0});0==n.count()&&$("#allselect-btn").attr("checked",!1),l.selectedCount=n.count(),l.$apply()}),l.selectedDelete=function(){var t=c.rows({selected:!0}),e=t.count(),a=t.nodes();if(0!=e){for(var n=0,o=0,s=[],d=!1,i=0;i<a.length;i++){var r=c.row(a[i]).data();0<r.id?(s.push(r.id),n++):o++,e==n+o&&(d=!0)}d&&l.doAction("delete",s,function(t){if(0==t.code){for(var e=0;e<a.length;e++){c.row(a[e]).remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}else t||($(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect())})}else u.warning("当前没有选中的产品信息",{})}}]}}]),t.initDirective("productStructrueTable",["$timeout","ngDialog","$compile","$filter","growl",function(t,n,d,e,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,e){var c,s=t;window.JSZip=p,l.$on(Event.ENTERPRISEINIT+"_structrue",function(t,e){c&&(c.destroy(),s.empty());var a=[$.ProudSmart.datatable.selectCol,{data:"energyConsumeNodeName",title:"能耗节点"},{data:"occupyPrcent",title:"所用时间（分钟）"},{data:"createTime",title:"",visible:!1},$.ProudSmart.datatable.optionCol3];c=s.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+(e.option&&1<=e.option[0].length?$.ProudSmart.datatable.footerdom:""),language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,data:e.option[0],order:[[3,"desc"]],columns:a,columnDefs:[{targets:0,orderable:!1,render:function(t,e,a){return"display"==e?t?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"energyConsumeNodeName",render:function(t,e,a){return a.energyConsumeNodeName?a.energyConsumeNodeName:"无"}},{targets:2,data:"occupyPrcent",render:function(t,e,a){return t}},{targets:4,data:"option",render:function(t,e,a){return"<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>","<button id='del-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button>","</div>","<div class='btn-group btn-group-sm'><button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button><button id='del-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button></div>"}}],rowCallback:function(t,e,a){d(t)(l)}});for(var n=[],o=0;o<a.length-1;o++)n.push(o);e.option&&1<=e.option[0].length&&(new $.fn.dataTable.Buttons(c,{buttons:[{extend:"excel",title:"工艺流程信息导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:n}}]}),c.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 "))}),s.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);$.extend(l.dialog.input,a.data()),n.open({template:"../partials/dialogue/product_structrue_dia.html",className:"ngdialog-theme-plain",scope:l})}),s.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.doAction("delete",[a.data().id],function(t){0==t.code&&a.remove().draw(!1)})}),s.on("change","#allselect-btn",function(t){if(t.stopPropagation(),t.target.checked){c.rows().select();var e=c.rows({selected:!0});l.selectedCount=e.count(),l.$apply();for(var a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!0}c.rows().invalidate().draw(!1)}else{for(e=c.rows({selected:!0}),a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!1}c.rows().deselect(),l.selectedCount=0,l.$apply(),c.rows().invalidate().draw(!1)}}),s.on("change",".itemCheckBox",function(t){var e=$(this).closest("tr"),a=c.row(e);t.target.checked?a.data().selected=!0:a.data().selected=!1;var n=c.rows({selected:!0});0==n.count()&&$("#allselect-btn").attr("checked",!1),l.selectedCount=n.count(),l.$apply()}),l.selectedDelete=function(){var t=c.rows({selected:!0}),e=t.count(),a=t.nodes();if(0!=e){for(var n=0,o=0,s=[],d=!1,i=0;i<a.length;i++){var r=c.row(a[i]).data();0<r.id?(s.push(r.id),n++):o++,e==n+o&&(d=!0)}d&&l.doAction("delete",s,function(t){if(0==t.code){for(var e=0;e<a.length;e++){c.row(a[e]).remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}else t||($(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect())})}else u.warning("当前没有选中的企业信息",{})}}]}}]),t.initDirective("enterpriseOperateTable",["$timeout","ngDialog","$compile","userLoginUIService","$filter","growl",function(t,e,d,i,r,u){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,e){var c,s=t;window.JSZip=p,l.$on(Event.ENTERPRISEINIT+"_operate",function(t,e){c&&(c.destroy(),s.empty());var a=[$.ProudSmart.datatable.selectCol,{data:"statisticsPeriod",title:"统计周期"},{data:"productionValue",title:"产值（万元）"},{data:"additionalValue",title:"附加值（万元）"},{data:"createTime",title:"创建时间"},{data:"modifyTime",title:"更新时间"},{data:"commitStatus",title:"状态"},$.ProudSmart.datatable.optionCol3];c=s.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+(e.option&&1<=e.option[0].length?$.ProudSmart.datatable.footerdom:""),language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,data:e.option[0],order:[[4,"desc"]],columns:a,columnDefs:[{targets:0,orderable:!1,render:function(t,e,a){return"display"==e?t?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:1,data:"statisticsPeriod",render:function(t,e,a){var n=new Date(t).Format("yyyy-M").split("-");if("YEAR"==l.dialog.statisticsType)return n[0]+"年";if("QUARTER"!=l.dialog.statisticsType)return"MONTH"==l.dialog.statisticsType?n[0]+"年"+n[1]+"月":l.dialog.statisticsType&&t?void 0:"-";var o="";return l.dialog.select.statisticsQuarter.forEach(function(t){t.id==n[1]&&(o=t.text)}),n[0]+"年 "+o}},{targets:2,data:"productionValue",render:function(t,e,a){return escape(t)}},{targets:3,data:"additionalValue",render:function(t,e,a){return escape(t)}},{targets:4,data:"createTime",render:function(t,e,a){return r("date")(t,"yyyy-MM-dd HH:mm:ss")}},{targets:5,data:"modifyTime",render:function(t,e,a){return r("date")(t,"yyyy-MM-dd HH:mm:ss")}},{targets:6,data:"commitStatus",render:function(t,e,a){var n="";return"<span class='label "+(100==i.user.userType?"pass"==t?(n="已审核","label-success"):(n="未审核","label-default"):"yes"==t||"pass"==t?(n="已提交","label-success"):(n="未提交","label-default"))+"'>"+n+"</span>"}},{targets:7,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return 100==i.user.userType?"pass"==a.commitStatus?(n+="<button id='edit-btn' disabled='true' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' disabled='true' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button>",n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>"):(n+="<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button>",n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>",n+="<li><a role='button' id='commit-btn'>审核</a></li>"):"yes"==a.commitStatus||"pass"==a.commitStatus?(n+="<button id='edit-btn' disabled='true' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' disabled='true' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button>",n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>"):(n+="<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>",n+="<button id='del-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></button>",n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>",n+="<ul class='dropdown-menu' role='menu'>",n+="<li><a role='button' id='commit-btn'>提交</a></li>"),n+="<li><a role='button' id='view-btn'>查看详情</a></li>",n+="</ul></div>"}}],rowCallback:function(t,e,a){d(t)(l)}});for(var n=[],o=0;o<a.length-1;o++)n.push(o);e.option&&1<=e.option[0].length&&(new $.fn.dataTable.Buttons(c,{buttons:[{extend:"excel",title:"企业经营信息导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:n}}]}),c.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 "))}),s.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.doAction("edit",a.data(),function(t){})}),s.on("click","#view-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.doAction("view",a.data(),function(t){})}),s.on("click","#del-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.doAction("delete",[a.data().id],function(t){0==t.code&&(u.success("企业信息删除成功",{}),a.remove().draw(!1))})}),s.on("click","#commit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=c.row(e);l.doAction("commit",a.data().id,function(t){0==t.code&&(a.data().commitStatus=t.data.commitStatus,c.rows().invalidate().draw(!1))})}),s.on("change","#allselect-btn",function(t){if(t.stopPropagation(),t.target.checked){c.rows().select();var e=c.rows({selected:!0});l.selectedCount=e.count(),l.$apply();for(var a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!0}c.rows().invalidate().draw(!1)}else{for(e=c.rows({selected:!0}),a=0;a<e.nodes().length;a++){c.row(e.nodes()[a]).data().selected=!1}c.rows().deselect(),c.rows().invalidate().draw(!1),l.selectedCount=0,l.$apply()}}),s.on("change",".itemCheckBox",function(t){var e=$(this).closest("tr"),a=c.row(e);t.target.checked?a.data().selected=!0:a.data().selected=!1;var n=c.rows({selected:!0});0==n.count()&&$("#allselect-btn").attr("checked",!1),l.selectedCount=n.count(),l.$apply()}),l.selectedDelete=function(){var t=c.rows({selected:!0}),e=t.count(),s=t.nodes();if(0!=e){for(var a=0,n=0,o=[],d=!1,i=0;i<s.length;i++){var r=c.row(s[i]).data();0<r.id?(o.push(r.id),a++):n++,e==a+n&&(d=!0)}d&&l.doAction("delete",o,function(t){if(0==t.code){var e=t.data.failObj.length,a=t.data.successObj.length;u.success("成功删除"+a+"个,失败"+e+"个",{});for(var n=0;n<s.length;n++){var o=c.row(s[n]);if("yes"==o.data().commitStatus)break;o.remove().draw(!1)}$(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect()}else t||($(".itemCheckBox").each(function(){$(this).attr("checked",!1)}),$("#allselect-btn").attr("checked",!1),c.rows().deselect())})}else u.warning("当前没有选中的企业信息",{})}}]}}]),t.initDirective("publishInfoTable",["$timeout","ngDialog","$compile","userLoginUIService","$filter","growl",function(t,e,l,a,n,c){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,t,e){var i,r=t;window.JSZip=p,d.$on(Event.ENTERPRISEINIT+"_publish",function(t,e){i&&(i.destroy(),r.empty());var a=[{data:"enterpriseId",title:"企业名称",visible:!d.ifEnterprise},{data:"reducePeriod",title:"节能周期"},{data:"lastReducePeriodData",title:"上周期能耗数据（单位：吨标煤）"},{data:"thisReduceIndicator",title:"本周期节能指标"},{data:"thisExpectPeriodData",title:"本周期预期能耗数据（单位：吨标煤）"}],n=[{targets:0,render:function(t,e,a){var n="-";return escape(t)&&d.EnterprisesDic[t]&&(n=d.EnterprisesDic[t].label),n}},{targets:1,render:function(t,e,a){return t||"-"}},{targets:2,render:function(t,e,a){return t||"-"}},{targets:3,render:function(t,e,a){return t?t+"%":"-"}},{targets:4,render:function(t,e,a){return t||"-"}}];d.ifEnterprise?(a.splice(5,1),n.splice(5,1)):(a.push($.ProudSmart.datatable.optionCol3),n.push({targets:5,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return"yes"==a.lastCompleteStatus?n+="<button id='complete-btn' disabled='true' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>已完成</span></button>":n+="<button id='complete-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>未完成</span></button>",n+="</div>"}})),i=r.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+(e.option&&1<=e.option[0].length?$.ProudSmart.datatable.footerdom:""),language:$.ProudSmart.datatable.language,data:e.option[0],order:[[0,"desc"]],columns:a,columnDefs:n,rowCallback:function(t,e,a){l(t)(d)}});for(var o=[],s=0;s<a.length;s++)o.push(s);e.option&&1<=e.option[0].length&&(new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excel",title:"节能指标导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:o}}]}),i.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 ")),r.on("click","#complete-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e);d.doAction("complete",a.data().id,function(t){0==t.code&&(c.success("节能周期已完成",{}),a.data().lastCompleteStatus=t.data.lastCompleteStatus,i.rows().invalidate().draw(!1))})})})}]}}]),t.initDirective("forecastInfoTable",["$timeout","ngDialog","$compile","userLoginUIService","$filter","growl",function(t,e,l,a,n,o){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,t,e){var i,r=t;d.$on(Event.ENTERPRISEINIT+"_forecast",function(t,e){i&&(i.destroy(),r.empty());var a=[{data:"enterpriseId",title:"企业名称",visible:!d.ifEnterprise},{data:"forecastPeriod",title:"预测周期"},{data:"allEnergyForecastData",title:"综合能耗预测值（单位：吨标煤）"},$.ProudSmart.datatable.optionCol3],n=[{targets:0,render:function(t,e,a){var n="-";return escape(t)&&d.EnterprisesDic[t]&&(n=d.EnterprisesDic[t].label),n}},{targets:1,render:function(t,e,a){return t||"-"}},{targets:2,render:function(t,e,a){return t||"-"}},{targets:3,data:"option",render:function(t,e,a){return"<button id='view-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>查看</span></button>","</div>","<div class='btn-group btn-group-sm'><button id='view-btn' class='btn btn-default btn-sm'><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>查看</span></button></div>"}}];i=r.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+(e.option&&1<=e.option[0].length?$.ProudSmart.datatable.footerdom:""),language:$.ProudSmart.datatable.language,data:e.option[0],order:[[0,"desc"]],columns:a,columnDefs:n,rowCallback:function(t,e,a){l(t)(d)}});for(var o=[],s=0;s<a.length-1;s++)o.push(s);e.option&&1<=e.option[0].length&&(new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excel",title:"预测结果导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:o}}]}),i.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 ")),r.on("click","#view-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=i.row(e);d.doAction("view",a.data(),function(t){})})})}]}}]),t.initDirective("potentialDataTable",["$timeout","ngDialog","$compile","userLoginUIService","$filter","growl",function(t,e,l,a,n,o){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,t,e){var i,r=t;window.JSZip=p,d.$on(Event.ENTERPRISEINIT+"_potential_data",function(t,e){i&&(i.destroy(),r.empty());var a=e.option[0],n=e.option[1];i=r.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+(e.option&&1<=e.option[0].length?$.ProudSmart.datatable.footerdom:""),language:$.ProudSmart.datatable.language,data:e.option[2],order:[[0,"desc"]],columns:a,columnDefs:n,rowCallback:function(t,e,a){l(t)(d)}});for(var o=[],s=0;s<a.length;s++)o.push(s);e.option&&1<=e.option[2].length&&(new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excel",title:"设备潜力点分析导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:o}}]}),i.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 "))})}]}}]),t.initDirective("potentialDeviceTable",["$timeout","ngDialog","$compile","userLoginUIService","$filter","growl",function(t,e,l,a,n,o){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,t,e){var i,r=t;window.JSZip=p,d.$on(Event.ENTERPRISEINIT+"_potential_device",function(t,e){i&&(i.destroy(),r.empty());var a=e.option[0],n=e.option[1];i=r.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+(e.option&&1<=e.option[0].length?$.ProudSmart.datatable.footerdom:""),language:$.ProudSmart.datatable.language,data:e.option[2],order:[[0,"desc"]],columns:a,columnDefs:n,rowCallback:function(t,e,a){l(t)(d)}});for(var o=[],s=0;s<a.length;s++)o.push(s);e.option&&1<=e.option[2].length&&(new $.fn.dataTable.Buttons(i,{buttons:[{extend:"excel",title:"设备潜力点分析导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:o}}]}),i.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 "))})}]}}])});
//# sourceMappingURL=../../../map/app-oc/js/directives/enterprise-dom.js.map
