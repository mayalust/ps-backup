define(["directives/directives","datatables.net","datatables.net-bs"],function(o,e){"use strict";o.initDirective("treeData",["$timeout","ngDialog","userDomainService","customerUIService","projectUIService","growl",function(G,F,R,B,L,V){return{restrict:"A",scope:{ngModel:"=",add:"&",delete:"&",edit:"&",user:"&"},link:function(q,i,e){var O="确定",_="取消",j=$("<div></div>").css("z-index",1999).css("background-color","#fff").css("box-shadow","1px 1px 10px rgba(0,0,0,.3)").css("padding","15px 20px").css("margin","-5px 0 0 25px").css("display","block").css("width","300px").css("position","fixed"),U=$("<p></p>").text("").css("color","#666").css("margin",0).css("line-height","16px").css("font-size","12px").css("font-weight","normal"),n=$("<div></div>").append($("<span class='close'>x</span>"));$("<p></p>").text("描述 :").css("font-weight","bold").css("color","#333").css("margin","10px auto").css("line-height","16px").css("font-size","12px");j.append(n).append(U);G(function(){$(i).css("position","relative");q.$watch("ngModel",function(t,e,n){var M=function(e){var i=[];return function e(n){var t;if(i.push(n.label),n.hasOwnProperty("children"))for(var a in n.children)t=n.children[a],e(t)}(e),i},a=function(e,T,N){var S=e,H="search"!=T;$(i).children().remove();var n=function r(i,c,p,o,s,l,d,u){var h;p++;var f=$("<div></div>").css("border-bottom","1px solid #ddd").css("position","relative").css("overflow","hidden").css("opacity",0).css("max-height",0).css("line-height","32px");$(f).hover(function(){$(f).css("background-color","#eee")},function(){$(f).css("background-color","#fff")});var m=$("<button></button>").css("line-height","20px").css("color","#fff").css("border","0").css("background-color","#009dea").css("float","left").css("padding","2px 5px 2px 6px").css("margin","4px 0px 0px 3px"),v=$("<span></span>").addClass("glyphicon glyphicon-minus").css("font-size","10px"),g=$("<span></span>").addClass("glyphicon glyphicon-user").css("opacity",0).css("margin","0 5px 0 8px").css("color","#ccc"),e=$("<div></div>").addClass("glyphicon glyphicon-trash"),n=$("<div></div>").addClass("glyphicon glyphicon-plus"),b=($("<span></span>").addClass("glyphicon glyphicon-user"),$("<span></span>").css("margin-left",10).text(c.name+(301==c.modelId?"[客户域]":302==c.modelId?"[项目域]":""))),y=$("<span></span>").addClass("glyphicon glyphicon-question-sign").css("font-size","16px").css("color","#eee").css("margin-left","20px"),x=function(e){e.stopPropagation(),j.remove();var n=$(e.target).offset();j.css({opacity:0,top:n.top-20,left:n.left+5}),U.text(c.description),$("body").prepend(j),j.animate({opacity:1},300),$("body").on("click.infoleave",t)},t=function(e){e.stopPropagation(),$("body").off(),j.remove()},a=$("<span></span>").addClass("proudsmart ps-edit"),w=$("<button></button>").css("color","#dd695c").css("border","1px solid #ddd").css("margin",0).css("background-color","#fff").css("line-height","14px").css("position","relative").css("overflow","visible").css("float","right").css("z-index",3).css("margin","4px 3px 0px 2px"),C=w.clone(),k=w.clone(),D=$("<div></div>").css("background-color","#0f58a9").css("opacity",.2).css("position","absolute").css("height","40px").css("top",0).css("width","100%"),P=$("<div></div>").css("margin-left",("search"!=T?20*p:0)+"px");C.append(n),C.css("z-index",1).css("color","#1eb8b8"),k.append(a),k.css("z-index",2).css("color","#009fea"),w.append(e),"search"==T&&(N.find(function(e){return e.name==c.name})?(H=!0,m.prop("disabled",!0),f.on("click",function(e){q.$broadcast("HIGHLIGHTDATA",c)})):f.css("display","none"),m.css("display","none")),m.append(v),c.description&&y.css("cursor","pointer").css("color","#ccc").on("click",x),(!u||301==c.modelId&&1==c.layer||302==c.modelId&&1==c.layer)&&k.css("display","block");var A,I=function(e){"0px"==h.css("max-height")?G(function(){v.removeClass().addClass("glyphicon glyphicon-minus"),h.animate({"max-height":800,opacity:1},300)}):G(function(){v.removeClass().addClass("glyphicon glyphicon-plus"),h.animate({"max-height":0,opacity:0},300)})},z=$("<div></div>").css("padding","2px 10px").css("top","0px").css("right","32px").css("pointer-events","none").css("border-radius","2px").css("background-color","#000").css("position","absolute").css("font-weight","bold").css("width","80px").css("color","#fff");if(w.on("click",function(){event.stopPropagation(),j.remove();var t=c.id,a=c.domainPath,n={id:t,domainPath:a};302==c.modelId?L.findProjectsByCondition({orCondition:"",domainPath:"",projectName:c.name},function(e){e.data&&0!=e.data.length?V.warning("该域不能删除"):R.queryDeleteDomain(n,function(e){if("true"!=e.data)V.warning(e.data,{});else{var n=[{label:"确定",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){R.deleteDomain(t,a,function(e){0==e.code&&(V.success("删除管理域成功",{}),u.$remove(function(e,n){return n.id==c.id}),0==u.length?(s.removeAttr("disabled"),s.css("color","#dd695c")):(s.prop("disabled",!0),s.css("color","#aaa")),F.close(),f.animate({opacity:0,"max-height":0},300,function(){f.remove(),0==i.children().size()&&(i.remove(),l.css("font-weight","normal"),l.css("background-color","#fff"),s.css("display","block"),o.css("display","none"),d.css("display","inline"))}),q.delete({event:c}))})}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){F.close()}}];q.dialog={title:{label:"提示"},description:{label:"确认删除域?"},fnlist:n},F.open({template:"../partials/dialogue/common_dia_prompt.html",className:"ngdialog-theme-plain",scope:q})}})}):301==c.modelId&&B.findCustomersByCondition({id:c.id,orCondition:"",customerName:"",customerAddress:"",domainPath:"",customerPhone:""},function(e){e.data&&0!==e.data.length?V.warning("该域不能删除"):R.queryDeleteDomain(n,function(e){if("true"!=e.data)V.warning(e.data,{});else{var n=[{label:"确定",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){R.deleteDomain(t,a,function(e){0==e.code&&(V.success("删除管理域成功",{}),u.$remove(function(e,n){return n.id==c.id}),0==u.length?(s.removeAttr("disabled"),s.css("color","#dd695c")):(s.prop("disabled",!0),s.css("color","#aaa")),F.close(),f.animate({opacity:0,"max-height":0},300,function(){f.remove(),0==i.children().size()&&(i.remove(),l.css("font-weight","normal"),l.css("background-color","#fff"),s.css("display","block"),o.css("display","none"),d.css("display","inline"))}),q.delete({event:c}))})}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){F.close()}}];q.dialog={title:{label:"提示"},description:{label:"确认删除域?"},fnlist:n},F.open({template:"../partials/dialogue/common_dia_prompt.html",className:"ngdialog-theme-plain",scope:q})}})})}),C.on("click",function(e){var n=q.$parent.provinces,t=q.$parent.cityDics,a=q.$parent.districtDics;e.stopPropagation(),j.remove();var i=[];null==c.children&&(c.children=[]),i=M(S);for(var o=0,s="新建域";-1!=i.indexOf(s);)s="新建域_"+ ++o;var l=[{label:O,icon:"btn btn-primary",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},disabled:function(){return!q.dialog.input.every(function(e){return 1==e.right})},fn:function(){var n=-1;q.dialog.input.forEach(function(e){e.error&&(n=1)}),-1==n&&function(e){if(""!=e.input[0].value&&null!=e.input[0].value)if(""!=e.input[2].value&&null!=e.input[2].value)if(""!=e.input[3].value&&null!=e.input[3].value){F.close();var n=c.id,t=e.input[0].value,a=e.input[e.input.length-1].value,i=e.input[1].value-0,o=e.input[2].value,s=d[2].value.id?d[2].value.id:d[1].value.id?d[1].value.id:d[0].value.id,l=function(e){if(0==e.code){var n=e.data;c.children.push(n),g.css("display","none"),m.css("display","inline"),v.removeClass().addClass("glyphicon glyphicon-minus"),null==h&&(h=$("<div></div>").css("overflow","hidden").css("position","relative")),f.after(h),m.off("click"),m.on("click",I),w.prop("disabled",!0),w.css("color","#aaa"),f.css("font-weight","bold"),r(h,n,p,m,w,f,g,c.children),q.add({event:c}),"0px"==h.css("max-height")&&G(function(){v.removeClass().addClass("glyphicon glyphicon-minus"),h.animate({"max-height":400,opacity:1},300,function(){})}),V.success("新增管理域成功",{})}else V.warning("新增管理域失败",{})};getAddressPointFromTools(s.split(",").join(""),function(e){R.addDomain(n,{name:t,description:a,externalDevId:o,values:{number:i,standardAddress:s,longitude:e?e.location.lng:"",latitude:e?e.location.lat:""}},l)})}else V.warning("所在省不能为空",{});else V.warning("编码不能为空",{});else V.warning("域名称不能为空",{})}(q.dialog)}},{label:_,icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(e){F.close()}}],d=[{value:"",label:"所在省",type:"select",composory:!0,placeholder:"",format:{label:"label"},abled:!1,right:!1,options:n,maxlength:32,onChange:function(e){(d[2].value="")==e.value?(d[1].abled=!0,e.right=!1):(t[e.value.id]&&(d[1].options=t[e.value.id]),d[1].abled=!1,e.right=!0)}},{value:"",label:"所在市",type:"select",composory:!1,placeholder:"",format:{label:"label"},abled:!0,right:!0,options:t,maxlength:32,onChange:function(e){(d[2].value="")==e.value?(d[2].abled=!0,e.right=!1):(e.value&&a[e.value.id]&&(d[2].options=a[e.value.id]),d[2].abled=!1,e.right=!0)}},{value:"",label:"区/县",type:"select",composory:!1,placeholder:"",format:{label:"label"},abled:!0,right:!0,options:a,maxlength:32,onChange:function(e){""==e.value?e.right=!1:e.right=!0}}];q.dialog={title:{label:"管理域信息"},input:[{value:s,label:"域名称 ",type:"input",composory:!0,placeholder:"填写域名称",maxlength:32,right:!0,onChange:function(e){""==e.value?(e.error="域名称不可为空",e.right=!1):(e.error=null,e.right=!0)}},{value:"",label:"序号 ",type:"input",placeholder:"填填写序号",right:!0},{value:"",label:"编码 ",type:"input",composory:!0,placeholder:"填填写编码",right:!0,onChange:function(e){""==e.value?(e.error="编码不可为空",e.right=!1):(e.error=null,e.right=!0)}},d[0],d[1],d[2],{maxlength:200,value:"",label:"域描述 ",type:"textarea",right:!0,placeholder:"填写域描述"}],fnlist:l},F.open({template:"../partials/dialogue/common_dia.html",className:"ngdialog-theme-plain",scope:q})}),C.on("mouseenter",function(){z.text("创建子域"),C.append(z)}),C.on("mouseleave",function(){z.remove()}),w.on("mouseenter",function(){z.text("删除"),w.append(z)}),w.on("mouseleave",function(){z.remove()}),k.on("click",function(e){var n=q.$parent.provinces,t=q.$parent.cityDics,a=q.$parent.districtDics;e.stopPropagation(),j.remove();var s=c.id;if(c.values.standardAddress){var i=c.values.standardAddress.split(",");c.provinceId=i[0],c.province=n.find(function(e){return i[0]==e.label}),i[1]?(c.cityId=t[i[0]].find(function(e){return i[1]==e.label}).id,c.city=t[i[0]].find(function(e){return i[1]==e.label}),i[2]||(c.county="")):i[1]||(c.county="",c.cityId=""),i[2]&&(c.county=a[c.cityId].find(function(e){return i[2]==e.label}))}else c.province="",c.city="",c.county="";M(S).$remove(function(e,n){return n==c.name});var o=[{label:"确定",icon:"btn btn-primary",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},disabled:function(){return!q.dialog.input.every(function(e){return 1==e.right})},fn:function(){var n=-1;q.dialog.input.forEach(function(e){e.error&&(n=1)}),-1==n&&function(e){if(""!=e.input[0].value&&null!=e.input[0].value)if(""!=e.input[2].value&&null!=e.input[2].value)if(""!=e.input[3].value&&null!=e.input[3].value){var n,t=e.input[0].value,a=e.input[e.input.length-1].value,i=e.input[1].value-0,o=e.input[2].value;n=d[2].value?d[2].value.id:d[1].value?d[1].value.id:d[0].value.id,getAddressPointFromTools(n.split(",").join(""),function(e){c.id=s,c.name=t,c.label=t,c.externalDevId=o,c.description=a,c.values=c.values||{},c.values.number=i,c.values.standardAddress=n,c.values.longitude=e?e.location.lng:"",c.values.latitude=e?e.location.lat:"",R.modifyDomain([c],function(e){0==e.code?(e.data&&(e.data.description?y.css("cursor","pointer").css("color","#ccc").on("click",x):y.css("cursor","default").css("color","#eee").off("click"),b.text(e.data.name+(301==e.data.modelId?"[客户域]":302==e.data.modelId?"[项目域]":"")),U.text(e.data.description),c.name=e.data.name,c.label=e.data.label,c.externalDevId=e.data.externalDevId,c.values.number=e.data.values.number,c.values.standardAddress=e.data.values.standardAddress,c.description=e.data.description),V.success("修改管理域成功",{})):V.warning("修改管理域失败",{})})}),F.close()}else V.warning("所在省不能为空",{});else V.warning("编码不能为空",{});else V.warning("域名称不能为空",{})}(q.dialog)}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(e){F.close()}}],l=("301"==c.modelId||"302"==c.modelId)&&"1"==c.layer,d=[{value:c.province,label:"所在省",type:"select",composory:!0,placeholder:"",format:{label:"label"},abled:!!l,options:n,maxlength:32,right:!!c.province,onChange:function(e){d[2].value="",d[2].options=[],""==e.value?(d[1].abled=!0,e.right=!1):(t[e.value.id]&&(d[1].options=t[e.value.id]),d[1].abled=!1,e.right=!0)}},{value:c.city,label:"所在市",type:"select",composory:!1,placeholder:"",format:{label:"label"},abled:!!l,right:!0,options:t[c.provinceId],maxlength:32,onChange:function(e){(d[2].value="")==e.value?(d[2].abled=!0,d[2].options=[],e.right=!1):(e.value&&a[e.value.id]&&(d[2].options=a[e.value.id]),d[2].abled=!1,e.right=!0)}},{value:c.county,label:"区/县",type:"select",composory:!1,placeholder:"",format:{label:"label"},abled:!!l,right:!0,options:a[c.cityId],maxlength:32,onChange:function(e){""==e.value?e.right=!1:e.right=!0}}];q.dialog={title:{label:"管理域信息"},input:[{value:c.name,type:"input",label:"域名称",maxlength:32,composory:!0,disabled:!!l,right:!0,placeholder:"填写域名称",onChange:function(e){""==e.value?(e.error="域名称不可为空",e.right=!1):(e.error=null,e.right=!0)}},{value:c.values.number,label:"序号 ",type:"input",placeholder:"填填写序号",right:!0,abled:!0},{value:c.externalDevId,label:"编码 ",type:"input",composory:!0,placeholder:"填填写编码",right:!0,onChange:function(e){""==e.value?(e.error="编码不可为空",e.right=!1):(e.error=null,e.right=!0)}},d[0],d[1],d[2],{value:c.description,label:"域描述",type:"textarea",right:!0,maxlength:200,placeholder:"填写域描述"}],fnlist:o},F.open({template:"../partials/dialogue/common_dia.html",className:"ngdialog-theme-plain",scope:q}),q.$apply(function(){q.edit({event:c})})}),k.on("mouseenter",function(){z.text("编辑"),k.append(z)}),k.on("mouseleave",function(){z.remove()}),i.append(f),"search"!=T&&P.append(m).append(g),P.append(b).append(y),f.animate({opacity:1,"max-height":"50px"},300),D.animate({opacity:"0"},700,function(){D.remove()}),c.hasOwnProperty("children")){for(var E in g.css("display","none"),m.css("display","block"),f.css("font-weight","bold"),(c.show=!1)&&f.css("max-height",0),h=$("<div></div>").css("overflow","hidden"),"search"==T?v.removeClass().addClass("glyphicon glyphicon-minus"):"highlight"==T?(A=N,function e(n){if(n==A)return!0;if(n.hasOwnProperty("children")){for(var t in n.children)if(e(n.children[t]))return!0;return!1}return!1}(c)&&c!=N?v.removeClass().addClass("glyphicon glyphicon-minus"):(h.css("max-height",0),v.removeClass().addClass("glyphicon glyphicon-plus"))):1<p&&(h.css("max-height",0),v.removeClass().addClass("glyphicon glyphicon-plus")),i.append(h),c.children)r(h,c.children[E],p,m,w,f,g,c.children);w.prop("disabled",!0),w.css("color","#aaa"),m.on("click",I)}else g.css("display","inline"),m.css("display","none"),w.removeAttr("disabled"),w.css("color","#dd695c");u&&P.append(w).append(k),P.append(C),f.append(P),f.append(D)};if(e instanceof Array)for(var t in e)n($(i),e[t],-1);else n($(i),e,-1);if(!H){var a=$("<div></div>").text("没有符合条件的记录。").css("line-height","50px").css("text-align","center");$(i).append(a)}};null!=t&&(q.$on("SEARCHDATA",function(e,n){a(t,"search",n)}),q.$on("HIGHLIGHTDATA",function(e,n){a(t,"highlight",n)}),q.$on("RENDERDATA",function(e,n){a(t,"normal",n)}),a(t))})})}}}]),o.initDirective("domainUserTable",["$timeout","$compile","dialogue","userEnterpriseService",function(e,d,n,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(o,e,n){var s,a,i,l=e;o.$on(Event.DOMAININFOSINIT,function(e,n){for(var t in a&&a.destroy(),(i=$("<input type='checkbox'/>")).on("click",function(e){e.stopPropagation(),i.prop("checked")?(0==$(l).find("tbody tr").hasClass("select")&&$(l).find("tbody tr").addClass("selected"),$(l).find("tbody input[type*=checkbox]").prop("checked",!0)):($(l).find("tbody tr").removeClass("selected"),$(l).find("tbody input[type*=checkbox]").removeAttr("checked"))}),!1,n.data)n.data[t].select=!1;a=l.DataTable({dom:'<"row"<"col-sm-12"<"special-btn">>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:$.ProudSmart.datatable.language,autoWidth:!1,data:n.data,order:[1,"desc"],columns:[{title:"",data:"select",type:""},{title:"用户名称",data:"userName"},{title:"邮箱",data:"emailAddress"},{title:"手机",data:"mobilePhone"},$.ProudSmart.datatable.optionCol1],initComplete:function(e){l.find("th").eq(0).children().remove(),l.find("th").eq(0).append(i)},columnDefs:[{targets:0,width:14,data:"userName",orderable:!1,render:function(e,n,t){return'<input type="checkbox" style="pointer-events: none;"/>'}},{targets:1,data:"userName",render:function(e,n,t){return e}},{targets:3,data:"mobilePhone",render:function(e,n,t){return null==e?"":e}},{targets:4,data:"option",render:function(e,n,t){return"<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>移出</span></a>","</div>","<div class='btn-group btn-group-sm'><a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>移出</span></a></div>"}}]})}),l.on("init.dt",function(){var e=$(".special-btn").parent(),n=function(e,n,t){var a=$("<button></button>").addClass(e),i=$("<i></i>").addClass(n),o=$("<span></span>").addClass("hidden-sm").text(t);return i.append(o),a.append(i),a},t=n("btn btn-primary btn-sm","fa fa-plus","添加域用户").css("margin","2px"),a=n("btn btn-default btn-sm","fa fa-plus","移除").css("margin","2px"),i=function(e){var n=$("<div></div>").addClass("combined-query pull-right"),a=$("<div></div>").addClass("btn-group"),t=$("<button></button>").addClass("btn btn-default btn-sm dropdown-toggle").css("margin","2px"),i=$("<span></span>").text("查询条件"),o=$("<span></span>").addClass("caret"),s=$("<ul></ul>").addClass("dropdown-menu").css("cursor","pointer"),l=$("<div></div>").css("display","inline-block").css("margin","2px"),d=$("<i></i>").addClass("fa fa-search"),r=$("<span></span>").text("查询"),c=$("<button></button>").addClass("btn btn-primary btn-sm").css("margin","2px");c.append(d).append(r),l.append(function(e){if("input"==e.type)return $("<input />").addClass("form-control").css("height","30px").css("padding","2px")}(e[0])),t.append(i).append(o),t.on("click",function(e){a.hasClass("open")?a.removeClass("open"):a.addClass("open")}),a.append(t).append(s),n.append(a).append(l).append(c);var p=function(n){var e=$("<li></li>"),t=$("<a></a>").text(n.title);return e.append(t),e.on("click",function(e){i.text(n.title),a.removeClass("open")}),e};for(var u in e)s.append(p(e[u]));return n}([{title:"用户名称",data:"userName",type:"input"},{title:"邮箱",data:"emailAddress",type:"input"},{title:"手机",data:"mobilePhone",type:"input"}]);e.append(t).append(a).append(i),t.on("click",function(e){var n=function(e){var n=[{label:"确定",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(e){ngDialog.close(),e.input[0].value,e.input[1].value,e.input[2].value}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){ngDialog.close()}}];scope.dialog={type:"list",title:{label:"添加域用户"},input:[{value:e[0],type:"select",options:e,composory:!0,label:"选择用户",onChange:function(e){}},{value:"example@example.com",type:"input",label:"邮箱",placeholder:"填写邮箱"},{value:"12345678",type:"input",label:"手机",placeholder:"填写手机"}],fnlist:n}};s?n(s):r.queryEnterpriseUser(function(e){0==e.code&&(s=e.data,n(s))})}),d(e)(o)}),l.on("click","td",function(e){e.preventDefault();var n=$(this).closest("tr"),t=a.row(n).data();if(t){if(4==$(this).context.cellIndex&&0==t.isEdit)return;t.isEdit}}),l.on("click","tbody tr",function(e){e.preventDefault(),$(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).find("input[type*=checkbox]").prop("checked",!0):$(this).find("input[type*=checkbox]").removeAttr("checked"),a.rows(".selected")[0].length==a.rows()[0].length?i.prop("checked",!0):i.removeAttr("checked")}),l.on("click","#save-btn",function(e){e.stopPropagation();$(this).closest("tr");var n=a.row(".shown");!1,o.doAction("saveUserToDomain",n.data())}),l.on("click","#cancel-btn",function(e){e.stopPropagation(),!1;a.row(".shown");o.doAction("cancel")}),l.on("click","#del-btn",function(e){e.stopPropagation(),e.preventDefault();var n=$(this).closest("tr"),t=a.row(n);o.doAction("removeDomain",t.data())}),l.on("click","#changeDomain-btn",function(e){if(e.preventDefault(),!!1){!0;var n=$(this).closest("tr");a.row(n).data().isEdit=1}}),l.on("click","#removeDomain-btn",function(e){!1;var n=$(this).closest("tr"),t=a.row(n);a.row(".shown");o.doAction("removeDomain",t.data())})}]}}]),o.initDirective("domainCmdbTable",["$timeout","$compile","$filter",function(e,a,i){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,e,n){var s,t=e,d=!1;l.$on(Event.DOMAINDEVICESINIT,function(e,n){s&&s.destroy(),d=!1,s=t.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:o.datatable.language,data:n.data,columns:[{data:"id",title:"编码"},{data:"label",title:"名称"},{data:"createTime",title:"上线时间"},{data:"onlineStatus",title:"在线状态"},{data:"health",title:"健康度",visible:!1},{data:"domainPath",title:"管理域"},{data:"option",orderable:!1,title:"操作",width:"120px"}],columnDefs:[{targets:2,data:"createTime",render:function(e,n,t){return i("date")(e,"yyyy-MM-dd HH:mm:ss")}},{targets:1,data:"label",render:function(e,n,t){return escape(e)}},{targets:3,data:"onlineStatus",render:function(e,n,t){return"<span class='label "+("online"==e?"label-primary":"label-warning")+"'>"+("online"==e?"在线":"离线")+"</span>"}},{targets:4,data:"health",render:function(e,n,t){return"<div class='progress progress-xs progress-striped active'><div class='progress-bar "+(90<(e=100*Math.random())?"progress-bar-success":60<e?"progress-bar-yellow":"progress-bar-red")+"' style='width:"+e+"%'></div></div>"}},{targets:5,data:"domainPath",render:function(e,n,t){var a="",i=(l.enterpriseDomain,""),o="";for(var s in l.enterpriseDomain)l.enterpriseDomain[s].domainPath==e&&(i=l.enterpriseDomain[s].name,o=l.enterpriseDomain[s].domainPath);if(2==t.isEdit&&"display"==n){if(l.deviceIdTree(t.id),null!=e&&""!=e)for(var s in l.domainsAry)l.domainsAry[s].domainPath==e&&(a+="<input name='domainPath' domain-Picker class='form-control input-sm' type='text' value='"+i+"' domainPath='"+o+"'>");a||(a+="<input name='domainPath'  domain-Picker class='form-control input-sm' type='text' domainPath='' value='请选择...'>")}else a+=i;return a}},{targets:6,data:"option",render:function(e,n,t){var a="<div class='btn-group btn-group-sm'>";return 2==t.isEdit?(a+="<a id='save-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",a+="<a id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>"):a+="<a id='edit-btn' class='btn btn-default' ><i class='fa fa-refresh hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 切换域</span></a>",a+="</div>"}}],rowCallback:function(e,n,t){a(e)(l)}})}),t.on("click","#save-btn",function(e){e.stopPropagation();var n=$(this).closest("tr"),t=s.row(n),a=t.data(),i=$(n).find('input[name="domainPath"]').attr("domainPath"),o=$(n).find('input[name="domainPath"]').val();a.domainPath=i,a.domainName=o;l.doAction("saveChangedDomain",a,function(e){e&&(d=!1,a.isEdit=0,t.remove().draw())})}),t.on("click","#edit-btn",function(e){if(e.preventDefault(),d)l.doAction("thresholdMessage","当前有修改中的属性，请先完成该操作");else{d=!0;var n=$(this).closest("tr"),t=s.row(n);t.data().isEdit=2,t.cells().invalidate(),a(n)(l)}}),t.on("click","#cancel-btn",function(e){if(e.stopPropagation(),d){d=!1;var n=$(this).closest("tr"),t=s.row(n);t.data().isEdit=0,t.cells().invalidate()}})}]}}])});
//# sourceMappingURL=../../../map/app-oc/js/directives/domain-dom.js.map
