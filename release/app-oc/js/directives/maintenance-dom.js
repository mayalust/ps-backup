define(["directives/directives","bootstrap-dialog","datatables.net","datatables.net-bs","datatables.net-select"],function(e,m,t){"use strict";e.initDirective("maintenanceTaskDom",["$timeout","$compile","$filter","growl",function(e,n,r,c){return{restrict:"A",controller:["$scope","$element","$attrs",function(o,e,t){var d,a=e;o.$on("MAINTENANCE",function(e,t){d&&(d.destroy(),a.empty()),!1,d=a.DataTable({dom:t.data&&0<t.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:t.data,select:$.ProudSmart.datatable.select,order:[[11,"desc"]],columns:[$.ProudSmart.datatable.selectCol,{data:"name",title:"计划名称"},{data:"ticketCategoryId",title:"维保类型"},{data:"customerId",visible:o.baseConfig.customerConfig.display,title:"客户"},{data:"projectId",title:"项目",visible:o.baseConfig.projectConfig.display},{data:"deviceId",title:"维保设备"},{data:"nextExecutionTime",title:"下次执行时间"},{data:"nextExecutioner",title:"下次执行人"},{data:"operationStatus",title:"运行状态"},{data:"taskStatus",title:"计划状态"},$.ProudSmart.datatable.optionCol3,{data:"createTime",title:"",visible:!1}],columnDefs:[{targets:0,orderable:!1,render:function(e,t,a){return"display"==t?e?'<input class="itemCheckBox" checked type="checkbox">':'<input class="itemCheckBox" type="checkbox">':""}},{targets:2,data:"ticketCategoryId",render:function(e,t,a){return o.processTypeDic&&o.processTypeDic[e]?o.processTypeDic[e].name:""}},{targets:3,data:"customerId",render:function(e,t,a){return o.customersDic&&o.customersDic[e]?o.customersDic[e].customerName:""}},{targets:4,data:"projectId",render:function(e,t,a){return o.projectsDic&&o.projectsDic[e]?o.projectsDic[e].projectName:""}},{targets:5,data:"deviceId",render:function(e,t,a){return o.devicesListDic&&o.devicesListDic[e]?o.devicesListDic[e].label:""}},{targets:6,data:"nextExecutionTime",render:function(e,t,a){return r("date")(e,"yyyy-MM-dd")}},{targets:7,data:"executioner",render:function(e,t,a){return o.enterpriseListDic&&o.enterpriseListDic[e]?o.enterpriseListDic[e].userName:""}},{targets:8,data:"operationStatus",render:function(e,t,a){var n="";return 0==e?n+="未到期":1==e?n+="待分配":2==e?n+="已分配":3==e?n+="待执行":4==e&&(n+="已完成"),n}},{targets:9,data:"taskStatus",render:function(e,t,a){var n="";return 0==e?n+="启用":1==e&&(n+="停用"),n}},{targets:10,data:"option",render:function(e,t,a){var n="<div class='btn-group btn-group-sm'>";return o.menuitems.A05_S47&&(n+="<button id='edit-btn'  class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>"),1==a.taskStatus?o.menuitems.A06_S47&&(n+="<button id='del-btn'   class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>"):o.menuitems.A06_S47&&(n+="<button  disabled class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>"),(o.menuitems.A04_S47||o.menuitems.A03_S47||o.menuitems.A01_S47)&&(n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>"),n+="<ul class='dropdown-menu' role='menu'>",o.menuitems.A01_S47&&(n+="<li><a role='button' href='#/calendarData/"+a.id+"/"+a.nextExecutioner+"' id='design-btn'>指派</a></li>"),0==a.taskStatus?o.menuitems.A04_S47&&(n+="<li><a role='button'  id='disable-btn'>停用</a></li>"):1==a.taskStatus&&o.menuitems.A03_S47&&(n+="<li><a role='button'  id='disable-btn'>启用</a></li>"),n+="</ul></div>"}}],rowCallback:function(e,t,a){t.selected?$(e).addClass("selected"):$(e).removeClass("selected"),n(e)(o)}})}),a.on("change","#allselect-btn",function(e){if(e.stopPropagation(),e.target.checked){d.rows().select();for(var t=d.rows({selected:!0}),a=0;a<t.nodes().length;a++){d.row(t.nodes()[a]).data().selected=!0}d.rows().invalidate().draw(!1)}else{for(t=d.rows({selected:!0}),a=0;a<t.nodes().length;a++){d.row(t.nodes()[a]).data().selected=!1}d.rows().deselect(),d.rows().invalidate().draw(!1)}o.selectedHandler()}),a.on("change",".itemCheckBox",function(e){var t=$(this).closest("tr"),a=d.row(t);e.target.checked?a.data().selected=!0:a.data().selected=!1;var n=d.rows({selected:!0});n.count()!=d.rows()[0].length?($("#allselect-btn").attr("checked",!1),$("#allselect-btn").prop("checked",!1)):n.count()==d.rows()[0].length&&($("#allselect-btn").attr("checked",!0),$("#allselect-btn").prop("checked",!0)),o.selectedHandler()}),o.selectedDelete=function(){var e=d.rows({selected:!0}),t=e.count(),r=e.nodes();0!=t?m.show({title:"提示",closable:!1,message:"确认删除这 "+t+" 条记录吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){for(var t=[],a=0;a<r.length;a++){var n=d.row(r[a]).data();t.push(n.id)}t.length==r.length&&o.doAction("delete2",t),e.close()}},{label:"取消",action:function(e){e.close()}}]}):c.warning("当前没有选中",{})},o.selectedStatus=function(e){var t=d.rows({selected:!0}),i=t.count(),s=t.nodes();0!=i?m.show({title:"提示",closable:!1,message:"确认您所选择的 "+i+" 条记录吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){for(var a=0,n=0,t=0;t<s.length;t++){var r=d.row(s[t]).data();"deactive"==r.managedStatus&&o.doActiveHanddler(r,function(e,t){e?(d.row(t).data().managedStatus="active",d.row(t).cells().invalidate().draw(!1),a++):n++,i==a+n&&(d.rows().deselect(),c.success("成功启用设备"+a+"台,失败"+n+"台",{}))},s[t])}e.close()}},{label:"取消",action:function(e){e.close()}}]}):c.warning("当前没有选中",{})},a.on("click","#edit-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=d.row(t);o.addMain(a.data())}),a.on("click","#disable-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=d.row(t);0==a.data().taskStatus?o.statusSave([a.data().id],1,function(e){e&&(a.data().taskStatus=1,a.cells().invalidate().draw(!1))}):o.statusSave([a.data().id],0,function(e){e&&(a.data().taskStatus=0,a.cells().invalidate().draw(!1))})}),a.on("click","#save-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=d.row(t),n=a.data();if(2==n.isEdit||3==n.isEdit){var r=$(this).parents("tr").children(),i=!0;$.each(r,function(e,t){var a=$(t);if(0==e&&(0<a.children("input").length&&!(n=a.children("input").val())))return c.warning("视图名称不能空"),i=!1;if(0==e||1==e){var n=a.children("input").val();a.html(n),d.cell(a).data(n)}})}i&&o.doAction("view-save",n,function(e){e&&(!1,a.data().isEdit=0,a.cells().invalidate())})}),a.on("click","#cancel-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=d.row(t);a.data();!1,a.data().isEdit=0,a.cells().invalidate()}),a.on("click","#del-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=d.row(t);a.data().isDel=!0;var n=a.data();o.doAction("delete",n,function(e){e&&a.remove().draw(!1)})})}]}}]),e.initDirective("maintenanceRecordDom",["$timeout","$compile","$filter","growl",function(e,t,n,a){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,e,t){var i,a=e;r.$on("RECORD",function(e,t){i&&(i.destroy(),a.empty()),!1,i=a.DataTable({dom:t.data&&0<t.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:t.data,order:[[8,"desc"]],columns:[{data:"taskName",title:"任务名称"},{data:"type",title:"维保类型"},{data:"serverType",title:"服务类别"},{data:"modelName",title:"设备模板"},{data:"deviceId",title:"设备名称"},{data:"maintenanceTime",title:"维保时间"},{data:"executioner",title:"执行人"},$.ProudSmart.datatable.optionCol1,{data:"createTime",title:"",visible:!1}],columnDefs:[{targets:1,data:"type",render:function(e,t,a){return r.processTypeDic&&r.processTypeDic[e]?r.processTypeDic[e].name:""}},{targets:2,data:"serverType",render:function(e,t,a){var n="";return"0"==e?n="保内":"1"==e&&(n="保外"),n}},{targets:3,data:"modelName",render:function(e,t,a){return null!=r.rootModelDic[e]&&""!=e&&null!=e&&r.rootModelDic[e].label,e}},{targets:4,data:"deviceId",render:function(e,t,a){return r.devicesListDic&&r.devicesListDic[e]?r.devicesListDic[e].label:""}},{targets:5,data:"maintenanceTime",render:function(e,t,a){return n("date")(e,"yyyy-MM-dd")}},{targets:6,data:"executioner",render:function(e,t,a){return r.enterpriseListDic&&r.enterpriseListDic[e]?r.enterpriseListDic[e].userName:""}},{targets:7,data:"option",render:function(e,t,a){var n="<div class='btn-group btn-group-sm'>";return r.menuitems.A01_S48&&(n+="<button id='look-btn'  class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 查看</span></button>"),n}}]})}),a.on("click","#look-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=i.row(t);a.data().isDel=!0;var n=a.data();location.href="../app-oc/index.html#/conditionDetail/"+n.id})}]}}]),e.initDirective("calendarData",["$timeout","$parse","growl",function(e,t,u){return{restrict:"A",link:function(l,d,t){require(["fullcalendar"],function(e){t.value;var s=1,o=function(e){d.fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},height:"auto",buttonText:{today:"今天",month:"月",week:"周",day:"天"},timeFormat:"H:mm:ss",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNamesShort:["日","一","二","三","四","五","六"],editable:!0,events:e,droppable:!0,dayClick:function(e,t,a,n){var r=e._d.Format("yyyy-MM-dd");if(0!=checkDate(r))if(""!=l.executioner&&null!=l.executioner){var o=e._d.Format("yyyy-MM-dd"),i=function(e){for(var t="",a=0;a<e;a++)t+='<option value="'+a+'">'+a+"</option>";return t},s=i(24),d=i(60),c=i(60);m.show({title:"提示",closable:!1,message:"确认要选择"+o+' <select id="hourselect">'+s+'</select>:<select id="minuteselect">'+d+'</select>:<select id="secondselect">'+c+"</select>执行吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){if(0<l.selectList.length){var t=l.selectList,a=o+" "+$("#hourselect").val()+":"+$("#minuteselect").val()+":"+$("#secondselect").val(),n=new Date(a).Format("yyyy-MM-dd hh:mm:ss"),r=(new Date).Format("yyyy-MM-dd hh:mm:ss");if(0==(i=n,s=r,new Date(Date.parse(s.replace("-","/")))<new Date(Date.parse(i.replace("-","/")))))return void u.warning("您选择的时间小于当前时间",{});t[0].nextExecutionTime=new Date(a),t[0].nextExecutioner=l.executioner,l.update(t,function(e){e&&(u.success("保存成功",{}),window.history.back())})}var i,s;e.close()}},{label:"取消",action:function(e){e.close()}}]})}else u.warning("请选择任务执行人",{});else u.warning("您选择的时间小于当前时间",{})}})};l.$watch(t.ngModel,function(r,e,t){var i=[];s++,0<r.length?l.$evalAsync(function(){for(var e in r){var t={};if(t.title=r[e].name,r[e].nextExecutionTime){var a=new Date(r[e].nextExecutionTime);t.start=a.Format("yyyy-MM-dd hh:mm:ss")}0==r[e].operationStatus?(t.backgroundColor="#3c8dbc",t.borderColor="#3c8dbc"):1==r[e].operationStatus?(t.backgroundColor="#f39c12",t.borderColor="#f39c12"):2==r[e].operationStatus?(t.backgroundColor="#00c0ef",t.borderColor="#00c0ef"):3==r[e].operationStatus&&(t.backgroundColor="#dd4b39",t.borderColor="#dd4b39"),4!=r[e].operationStatus&&i.push(t)}if(2==s)o(i);else{for(var n in d.fullCalendar("removeEvents"),i)d.fullCalendar("renderEvent",i[n],!0);d.fullCalendar("unselect")}}):2==s?o(i):d.fullCalendar("removeEvents")})})}}}])});
//# sourceMappingURL=../../../map/app-oc/js/directives/maintenance-dom.js.map
