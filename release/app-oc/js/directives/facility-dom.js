define(["directives/directives","bootstrap-dialog","datatables.buttons.html5","jszip","datatables.net-select"],function(i,t,e,n){"use strict";i.initDirective("facilityInfoTable",["$timeout","$compile","$filter","growl","weatherService","actionService",function(t,c,u,e,a,m){return{restrict:"A",controller:["$scope","$element","$attrs",function(i,t,e){var s,d=t;window.JSZip=n,i.$on(Event.CMDBINFOSINIT+"_facility",function(t,e){s&&(s.destroy(),d.empty());var a=[],n=[],o=[];i.baseConfig.customerConfig.display&&!i.userInfo.subDomain&&(a.push({data:"customerId",title:i.menuitems.S12&&i.menuitems.S12.label?i.menuitems.S12.label:"客户",orderable:!1}),n.push({targets:a.length-1,data:"customerId",render:function(t,e,a){var n="";if(0!=t&&""!=t&&null!=t){var r=i.customersList;for(var o in r)if(r[o].id==t){n=r[o].text;break}}return n}})),i.baseConfig.projectConfig.display&&(a.push({data:"projectId",orderable:!1,title:i.menuitems.S13&&i.menuitems.S13.label?i.menuitems.S13.label:"项目"}),n.push({targets:a.length-1,data:"projectId",render:function(t,e,a){var n="";if(0!=t&&""!=t&&null!=t){var r=i.projectsList;for(var o in r)if(r[o].id==t){n=r[o].text;break}}return n}})),a.push({data:"modelId",orderable:!1,title:"设备模板"}),n.push({targets:a.length-1,data:"modelId",render:function(t,e,a){var n="";return""!=t&&null!=t&&(null!=i.rootModelDic[t]&&(n=i.rootModelDic[t].label),i.menuitems.A01_S02&&(n="<a href='#/lookModel/"+t+"'>"+n+"</a>")),n}}),a.push({data:"label",orderable:!1,title:"设备名称"}),n.push({targets:a.length-1,data:"label",render:function(t,e,a){return i.menuitems.A05_S02?"<a href='#/facility_detail/DETAIL/"+a.gatewayId+"/"+a.id+"'>"+t+"</a>":t}}),a.push({data:"sn",orderable:!1,title:"设备序列号"}),n.push({targets:a.length-1,data:"sn",render:function(t,e,a){return escape(t)}}),a.push({data:"onlineStatus",orderable:!1,title:"在线状态"}),n.push({targets:a.length-1,data:"onlineStatus",render:function(t,e,a){var n="无数据",r="bg-gray";return 0==t?(n="离线",r="label-warning"):1==t&&(n="在线",r="label-primary"),"<span class='label "+r+"'  style='color: #ffffff !important;'>"+n+"</span>"}}),a.push({data:"severity",orderable:!1,title:"故障状态"}),n.push({targets:a.length-1,data:"severity",render:function(t,e,a){var n="无数据",r="bg-gray";return 4==t?(n="严重",r="bg-alarm-critical"):3==t?(n="重要",r="bg-alarm-major"):2==t?(n="次要",r="bg-alarm-minor"):1==t?(n="警告",r="bg-alarm-warning"):t<1&&(n="正常",r="progress-bar-success"),"<span class='label "+r+"' style='color: #ffffff !important;'>"+n+"</span>"}}),a.push({data:"domainPath",orderable:!1,title:"管理域"}),n.push({targets:a.length-1,data:"domainPath",render:function(t,e,a){var n="";return null!=i.domainListDic[t]&&i.domainListDic[t]&&(n=i.domainListDic[t].name),n}});var l=null;i.queryKeyValue&&i.queryKeyValue.forEach(function(r){"numberic"==r.dataType&&r.values&&"1"==r.values.calculate&&(l||(l={}),l[a.length]=r,l[a.length].total=0),a.push({data:"values."+r.name,title:r.label}),n.push({targets:a.length-1,render:function(t,e,a){var n="";return a.values[r.name]&&(n="datetime"==r.dataType?u("date")(a.values[r.name],"yyyy-MM-dd HH:mm:ss"):"date"==r.dataType?u("date")(a.values[r.name],"yyyy-MM-dd"):a.values[r.name]),n}})}),a.push($.ProudSmart.datatable.optionCol2),n.push({targets:a.length-1,data:"option",render:function(t,e,a){var n="<div class='btn-group btn-group-sm'>";return i.menuitems.A05_S02&&(n+="<button id='edit-btn'   class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 查看</span></button>"),(i.menuitems.A06_S02||i.menuitems.A03_S02||i.menuitems.A04_S02||i.menuitems.A02_S02)&&(n+="<button type='button'  class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>"),n+="<ul class='dropdown-menu' role='menu'>",i.menuitems.A06_S02&&(n+="<li><a role='button' href='#/facility_panel/[{\"modelId\":"+a.modelId+',"resourceId":'+a.id+"}]'>仪表板</a></li>"),i.menuitems.A03_S02&&(n+="<li><a role='button' href='#/emcsView/"+a.id+"'>数据监测</a></li>"),i.menuitems.A02_S02&&(n+="<li><a role='button' href='#/configAlert/"+a.id+"/node'>告警查看</a></li>"),i.menuitems.A04_S02&&(n+="<li><a role='button' href='#/alertRules/"+a.id+"'>告警规则</a></li>"),n+=m.addmenu("facility",a),n+="</ul></div>"}}),a.push({data:"createTime",orderable:!1,visible:!1});for(var r=0;r<a.length-2;r++)o.push(r);s=d.DataTable({dom:'<"row"<"col-sm-6 margin-bottom-10">>'+$.ProudSmart.datatable.footerdom,language:$.ProudSmart.datatable.language,processing:!0,serverSide:!0,aaSorting:[[a.length-1,"desc"]],ajax:i.pipeline(),columns:a,columnDefs:n,pageLength:i.selLength,rowCallback:function(t,e,a){c(t)(i)},drawCallback:function(t){var e=this.api();if(0<e.data().length){var a="";for(var n in l)l[n].total=0;if(l){for(var n in a="<span class='pull-right'><b>统计数据:</b>",e.data().each(function(t){for(var e in l){var a=t.values[l[e].name];l[e].total+="string"==typeof(n=a)?1*n.replace(/[\$,]/g,""):"number"==typeof n?n:0}var n}),l){var r=l[n].total.toString().split(".");1<r.length&&4<r[1].length?a+="【"+l[n].label+":"+l[n].total.toFixed(4)+"】":a+="【"+l[n].label+":"+l[n].total+"】"}a+="</span>"}$(".footerdom").show(),$(".dataTables_wrapper .col-sm-6").show(),$(".dataTables_wrapper .col-sm-6").empty(),null!=t._buttons&&(t._buttons=""),new $.fn.dataTable.Buttons(s,{buttons:[{extend:"excel",title:"设备信息导出",text:'<i class="fa fa-download"></i><span class="hidden-xs"> 导出查询结果</span>',exportOptions:{columns:o}}]}),s.buttons().container().appendTo(".dataTables_wrapper .col-sm-6 "),a&&$(".dataTables_wrapper .col-sm-6").append(a)}else $(".footerdom").hide(),$(".dataTables_wrapper .col-sm-6").hide()}}),d.on("click","#edit-btn",function(t){t.preventDefault();var e=$(this).closest("tr"),a=s.row(e);i.look(a.data())}),d.on("length.dt",function(t,e,a){i.selLength=a}),i.fnData=function(t){s.settings()[0].ajax.data=i.socketList,s.ajax.reload()}})}]}}]),i.initDirective("gatewayAccessTable",["$timeout","$compile","growl",function(t,o,e){return{restrict:"A",controller:["$scope","$element","$attrs",function(n,t,e){var r,a=t;n.$on(Event.UNITTYPEINIT+"_gateway",function(t,e){r&&r.destroy(),!1,r=a.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:i.datatable.language,data:e.data,rowCallback:function(t,e,a){o(t)(n)},columns:[{title:"测点",data:"label"},{title:"远程设备地址",data:"deviceAddress"},{title:"寄存器类型",data:"registerType"},{title:"开始位置",data:"startPoint"},{title:"长度",data:"length"},{title:"字节顺序",data:"byteOrder"},{title:"读表达式",data:"readExpression"},{title:"写表达式",data:"writeExpression"}],columnDefs:[{targets:0,data:"label",render:function(t,e,a){return t}},{targets:1,data:"deviceAddress",render:function(t,e,a){return"<input class='form-control col-xs-6' id='deviceAddress'  name='deviceAddress'  type='text'  maxlength='20'  style='width: 100%;' >"}},{targets:2,data:"registerType",render:function(t,e,a){var n=[{id:"1",name:"读写线圈"},{id:"2",name:"只读寄存器"},{id:"3",name:"读写寄存器"}],r="<select id='registerType' name='registerType'  class='combobox form-control input-sm'>";for(var o in r+='<option value="">请选择...</option>',n)r+='<option value="'+n[o].id+'">'+n[o].name+"</option>";return r+="</select>"}},{targets:3,data:"startPoint",render:function(t,e,a){return"<input class='form-control col-xs-6' id='startPoint'  name='startPoint'  type='text'  maxlength='20'   style='width: 100%;'  >"}},{targets:4,data:"length",render:function(t,e,a){return"<input class='form-control col-xs-6' id='length'  name='length'  type='text'  maxlength='20'   style='width: 100%;' >"}},{targets:5,data:"byteOrder",render:function(t,e,a){var n=[{l:"大端",v:"BE"},{l:"小端",v:"LE"},{l:"高字节大端",v:"HLWBE"},{l:"高字节小端",v:"HLWBE"},{l:"低字节大端",v:"LHWLE"},{l:"低字节小端",v:"LHWLE"}],r="<select id='byteOrder' name='byteOrder'  class='combobox form-control input-sm'>";for(var o in r+='<option value="">请选择...</option>',n)r+='<option value="'+n[o].v+'">'+n[o].l+"</option>";return r+="</select>"}},{targets:6,data:"readExpression",render:function(t,e,a){return"<input class='form-control col-xs-6' id='readExpression'  name='readExpression'  type='text'  maxlength='20'  style='width: 100%;'   >"}},{targets:7,data:"writeExpression",render:function(t,e,a){return"<input class='form-control col-xs-6' id='writeExpression'  name='writeExpression'  type='text'  maxlength='20'   style='width: 100%;'  >"}}]})}),a.on("click","#cancel-btn",function(t){t.stopPropagation(),!1;var e=$(this).closest("tr"),a=r.row(e);a.data().isEdit=0,a.cells().invalidate()})}]}}]),i.initDirective("pointAccessTable",["$timeout","$compile","growl",function(t,n,o){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,e){var r,a=t;l.$on(Event.UNITTYPEINIT+"_pointAccess",function(t,e){r&&r.destroy(),!1,r=a.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:i.datatable.language,select:$.ProudSmart.datatable.select,data:e.data,rowCallback:function(t,e,a){n(t)(l)},columns:[{title:"测点",data:"label"},{title:"网关",data:"unit"},{title:"传感器",data:"unitId"},{title:"数据项",data:"isKpi"}],columnDefs:[{targets:0,data:"label",render:function(t,e,a){return t}},{targets:1,data:"unit",render:function(t,e,a){var n=l.access.allGateways,r="<select id='gateways' name='gateways' class='combobox form-control input-sm'>";for(var o in r+='<option value="">请选择...</option>',n)r+='<option value="'+n[o].id+'">'+n[o].name+"</option>",l.physical(n[o].id,0);return r+="</select>"}},{targets:2,data:"unitId",render:function(t,e,a){var n="<select id='physical"+a.id+"' name='physical"+a.id+"' class='combobox form-control input-sm'>";return n+='<option value="">请选择...</option>',n+="</select>"}},{targets:3,data:"isKpi",render:function(t,e,a){var n=l.access.allDataItems,r="<select id='registerType' name='registerType' class='combobox form-control input-sm'>";for(var o in r+='<option value="">请选择...</option>',n)r+='<option value="'+n[o].id+'">'+n[o].label+"</option>";return r+="</select>"}}]})}),a.on("click","#save-btn",function(t){t.stopPropagation();var e=$(this).closest("tr"),a=r.row(e),n=l.faultSave;null!=n&&""!=n?(a.data().fault=$("#fault").val(),l.doAction("saveFault",a.data())):o.warning("请选择故障",{})}),a.on("change","#gateways",function(t){t.stopPropagation(),!1;var e=$(this).closest("tr"),a=r.row(e),n=$(this).val();""!=n&&l.physical(n,a.data().id)}),a.on("click","#cancel-btn",function(t){t.stopPropagation(),!1;var e=$(this).closest("tr"),a=r.row(e);a.data().isEdit=0,a.cells().invalidate()})}]}}])});
//# sourceMappingURL=../../../map/app-oc/js/directives/facility-dom.js.map
