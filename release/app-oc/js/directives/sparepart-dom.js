define(["directives/directives","datatables.net","datatables.net-bs"],function(t,a){"use strict";t.initDirective("spareInfoTable",["$timeout","$compile","$filter","growl",function(t,l,a,f){return{restrict:"A",controller:["$scope","$element","$attrs",function(u,t,a){var p,e=t,m=!1,i=!1,d=!1;function o(t){var a;if(t&&2==t.isEdit)a='<table width="100%" class="table table-inner"><tr role="row"><td style="width:19%;">原始数量:</td><td><input datatype="'+t.originalNumber+'" type="number" autocomplete="off" placeholder="请输入1~9999999999的整数" style="width:75%;" class="form-control input-sm" name="originalNumber" value="'+t.originalNumber+'"></td></tr><tr role="row"><td style="width:19%;">数量上限:</td><td><input datatype="'+t.upperLimit+'" type="number" autocomplete="off" placeholder="请输入1~9999999999的整数" style="width:75%;"  class="form-control input-sm" name="upperLimit" value="'+t.upperLimit+'"></td></tr><tr role="row"><td style="width:19%;">数量下限:</td><td><input datatype="'+t.lowerLimit+'" type="number" autocomplete="off" placeholder="请输入小于数量上限的正整数" style="width:75%;" class="form-control input-sm" name="lowerLimit" value="'+t.lowerLimit+'"></td></tr><tr role="row"><td style="width:19%;">备注:</td><td><input datatype="'+t.desc+'"style="width:75%;" autocomplete="off" placeholder="请输入备注" class="form-control input-sm" name="desc" value="'+t.desc+'"></td></tr></table>';else if(t&&0==t.isEdit){for(var e in a='<table width="100%" class="table table-inner">',t)a+='<tr role="row">',"upperLimit"==e?(a+='<td style="width:19%;">数量上限:</td>',a+="<td>"+t.upperLimit+"</td>"):"lowerLimit"==e?(a+='<td style="width:19%;">数量下限:</td>',a+="<td>"+t.lowerLimit+"</td>"):"desc"==e&&(a+='<td style="width:19%;">备注:</td>',a+="<td>"+t.desc+"</td>"),a+="</tr>";a+="</table>"}else""!=t&&null!=t&&null!=t||(a='<div class="box record-box"><div class="box-body table-responsive"><div class="pull-right"><a id="close-table" class="btn btn-default btn-sm"><i class="fa fa-times"></i><span class="hidden-xs">关闭</span></a></div><table width="100%" class="table" spare-record-table></table></div></div>');return a}u.$on(Event.SPAREINFOINIT,function(t,a){i&&(i=!1),d&&(d=!1),p&&p.destroy(),m=!1,p=e.DataTable({dom:a.option[0]&&0<a.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:a.option[0],order:[[0,"asc"]],columns:[{data:"name",title:"备件编号"},{data:"label",title:"备件名称"},{data:"model",title:"备件型号"},{data:"unit",title:"备件单位"},{data:"stockNumber",title:"库存数量"},$.ProudSmart.datatable.optionCol3,{data:"id",title:"",visible:!1}],columnDefs:[{targets:0,data:"name",render:function(t,a,e){return 2==e.isEdit&&3==u.editStatus&&"display"==a?"<input maxlength='20' style='width:100%' autofocus='autofocus' autocomplete='off' placeholder='请输入备件编号' class='form-control input-sm' type='text' value='"+escape(t)+"' name = 'name'>":escape(t)}},{targets:1,data:"label",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='20' style='width:100%' autocomplete='off' placeholder='请输入备件名称' class='form-control input-sm' type='text' value='"+escape(t)+"' name = 'label'>":escape(t)}},{targets:2,data:"model",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='200' style='width:100%' autocomplete='off' placeholder='请输入备件型号' class='form-control input-sm' type='text' value='"+escape(t)+"'  name = 'model'>":escape(t)}},{targets:3,data:"unit",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='200' style='width:100%' autocomplete='off' placeholder='请输入备件单位' class='form-control input-sm' type='text' value='"+escape(t)+"' name = 'unit'>":escape(t)}},{targets:4,data:"stockNumber",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='200' style='width:100%' readonly='readonly' class='form-control input-sm' type='text' value='"+escape(t)+"' name = 'stockNumber'>":escape(t)}},{targets:5,data:"option",render:function(t,a,e){var n='<div class="btn-group btn-group-sm" style="width: 160px;">';return 2==e.isEdit?n+='<a id="save-btn" class="btn btn-primary btn-sm"><i class="fa fa-save  hidden-lg hidden-md hidden-sm "></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default btn-sm" ><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a></div>':2010==u.ifRouteParams?n+="<div class='btn-group table-option-group'><button type='button' class='btn btn-sm' style='cursor:text;'>操作</button><button type='button' class='btn btn-sm dropdown-toggle' style='cursor:text;'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button></div>":(u.menuitems.A02_S11&&(n+="<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>"),u.menuitems.A03_S11&&(n+="<button id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>"),u.menuitems.A04_S11&&(n+="<button id='showStockOrder-btn' class='btn btn-default btn-sm' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 备件记录</span></button>"),n+="</div>"),n}}],rowCallback:function(t,a,e){l(t)(u)}})}),e.on("init.dt",function(){}),e.on("click","td",function(t){t.preventDefault();var a=$(this).closest("tr"),e=p.row(a),n=e.data();if((5!=$(this).context.cellIndex||0!=e.data().isEdit)&&n)if(e.child.isShown())if(0!=e.data().isEdit||i){if(0==e.data().isEdit&&i)return;2==e.data().isEdit?a.hasClass("shown")||(a.addClass("shown"),e.child(o(e.data())).show(),l(a.next())(u),u.doActionInfo("showStockOrder",n)):i&&(e.child(o()).show(),l(a.next())(u),u.doActionInfo("showStockOrder",n))}else e.child.hide(),a.removeClass("shown");else{var s=e.data();if(2==e.data().isEdit&&(a.hasClass("shown")||(e.child(o(n)).show(),a.addClass("shown"))),i&&!d)e.child(o()).show(),l(a.next())(u),u.doActionInfo("showStockOrder",n);else{if($(".record-box").hasClass("shown"))return void e.child.hide();e.child(o(s)).show()}}}),e.on("click","#showStockOrder-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=p.row(a),n=e.data();i?f.info("请先关闭之前备件记录再打开",{}):d||(d=i=!0,e.child(o()).show(),a.addClass("bg-f5f5f5"),a.next().addClass("bg-f5f5f5"),a.addClass("shown"),$(".record-box").addClass("shown"),l(a)(u),l(a.next())(u),u.doActionInfo("showStockOrder",n))}),e.on("click","#edit-btn",function(t){t.preventDefault(),u.editStatus=2;var a=$(this).closest("tr"),e=p.row(a);if(i)f.info("请先关闭之前备件记录再打开",{});else if(m){if(0==e.data().isEdit)return void f.warning("有正编辑的备件信息",{})}else m=!0,e.data().isEdit=2,e.cells().invalidate(),l(a)(u)}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=p.row(a),n=$(this).parents("tr").children(),i=!0,s=null,d=-1,o=-1,l=-1;for(var r in e.data())"isEdit"==r&&2==e.data()[r]&&(s=e.data());if($.each(n,function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){var n=$.trim(e.children("input").val());if(n)if(0==t)if(0==u.allSpareInfos.length)$(a).removeClass("danger"),p.cell(e).data(n);else for(var s in u.allSpareInfos)if(u.allSpareInfos[s].name==n){if(3==u.editStatus)return f.warning("备件编号需要填写唯一",{}),$(a).addClass("danger"),void(i=!1)}else $(a).removeClass("danger"),p.cell(e).data(n);else $(a).removeClass("danger"),p.cell(e).data(n);else if(4!=t)return $(a).addClass("danger"),i=!1}}),s){var c=a.parent().find("input");$.each(c,function(t,a){var e=$(a).val(),n=$(a).attr("name");if("stockNumber"==n)parseInt(e);else if("upperLimit"==n){if(parseInt(e)<0||""==e)return $(a).css({"border-width":"3px","border-color":"#f2dede"}),void(i=!1);d=parseInt(e),s[n]=e}else if("lowerLimit"==n){if(parseInt(e)<0||""==e)return $(a).css({"border-width":"3px","border-color":"#f2dede"}),void(i=!1);if(o=parseInt(e),s[n]=e,d<o)return f.warning("请正确输入上下限范围",{}),void(i=!1);if(9999999999<l||9999999999<o||9999999999<d)return f.warning("请输入的数量范围控制在0~9999999999之内",{}),void(i=!1);s[n]=e}else if("name"==n){if(!e)return void(i=!1);if(0==u.allSpareInfos.length)s[n]=e;else for(var t in u.allSpareInfos){if(u.allSpareInfos[t].name==e)return i=!1;s[n]=e}}else if("originalNumber"==n){if(parseInt(e)<0||""==e||null==e)return $(a).css({"border-width":"3px","border-color":"#f2dede"}),void(i=!1);l=parseInt(e),s[n]=e}else s[n]=e}),i&&0<=(o<=(l<=d))&&(s.isEdit=0,u.editStatus=3,m=!1,u.doActionInfo("savespareInfo",s,function(t){t&&(e.cells().invalidate().draw(),e.child.hide())}))}else f.warning("请填写完整备件信息",{})}),e.on("click","#cancel-btn",function(t){if(t.stopPropagation(),m=!1,(a=p.row(".shown")).data())a.data().isEdit=0,a.child.hide(),a.cells().invalidate(),u.doActionInfo("cancel",a.data());else{var a,e=$(this).closest("tr");(a=p.row(e)).data().isEdit=0,u.doActionInfo("cancel",a.data())}}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=p.row(a);u.doActionInfo("deletespareInfo",e.data())}),e.on("click","#close-table",function(t){t.stopPropagation(),d=i=!1;var a=$(this).closest("tr"),e=p.row(a);u.doActionInfo("cancel",e.data())})}]}}]),t.initDirective("spareRecordTable",["$timeout","$compile","$filter",function(t,a,i){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,a,e){var n,s=a;t.$on(Event.SPAREINFOINIT+"record",function(t,a){n&&n.destroy(),!1,n=s.DataTable({dom:a.option[0]&&0<a.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:a.option[0],searching:!1,order:[[0,"category"]],columns:[{data:"category",title:"出入库"},{data:"sparePartNumber",title:"备件数量"},{data:"name",title:"库单编号"},{data:"handlerPerson",title:"处理人"},{data:"createTime",title:"创建时间"}],columnDefs:[{targets:0,data:"category",render:function(t,a,e){var n="";return"InStock"==t?n="入库":"OutStock"==t&&(n="出库"),n}},{targets:4,data:"createTime",render:function(t,a,e){return i("date")(t,"yyyy-MM-dd HH:mm:ss")}}]})})}]}}]),t.initDirective("spareInTable",["$timeout","$compile","$filter","growl",function(t,o,l,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(s,t,a){var n,e=t,i=!1,d=!1;s.$on(Event.SPAREININIT,function(t,a){d&&(d=!1),n&&n.destroy(),i=!1;a.option[1];n=e.DataTable({dom:a.option[0]&&0<a.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:a.option[0],order:[[0,"asc"]],columns:[{data:"name",title:"库单编号"},{data:"desc",title:"库单说明"},{data:"handlerPerson",title:"处理人"},{data:"createTime",title:"入库时间"},$.ProudSmart.datatable.optionCol3,{data:"id",title:"",visible:!1}],columnDefs:[{targets:0,data:"name",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input style='width:100%' class='form-control input-sm' autocomplete='off' placeholder='请输入库单编号' name='name' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:2,data:"handlerPerson",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input style='width:100%' class='form-control input-sm' autocomplete='off' placeholder='请输入处理人' name='handlerPerson' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"createTime",render:function(t,a,e){return 0<e.isEdit?'<input style="width:100%" type="text" class="form-control input-sm" readonly drops="down"  timepicker="true" value="'+l("date")(t,"yyyy-MM-dd HH:mm:ss")+'" autocomplete="off"  date-time-picker >':l("date")(t,"yyyy-MM-dd HH:mm:ss")}},{targets:1,data:"desc",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input style='width:100%' class='form-control input-sm' placeholder='请输入库单说明' name='desc' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:4,data:"option",render:function(t,a,e){var n='<div class="btn-group btn-group-sm">';return 2==e.isEdit?n+='<a id="save-btn" class="btn btn-primary btn-sm"><i class="fa fa-check  hidden-lg hidden-md hidden-sm "></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default btn-sm" ><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a>':2010==s.ifRouteParams?n+="<div class='btn-group table-option-group'><button type='button' class='btn btn-sm' style='cursor:text;'>操作</button><button type='button' class='btn btn-sm dropdown-toggle' style='cursor:text;'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button>":(s.menuitems.D02_A05_S11&&(n+="<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>"),s.menuitems.D03_A05_S11&&(n+="<button id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>"),s.menuitems.D04_A05_S11&&(n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>"),n+="<ul class='dropdown-menu' role='menu'>",s.menuitems.D04_A05_S11&&(n+="<li><a role='button'  id='sparelist-btn'>备件条目</a></li>"),n+="</ul>"),n+="</div>"}}],rowCallback:function(t,a,e){o(t)(s)}})}),e.on("init.dt",function(){}),e.on("click","td",function(t){t.preventDefault();var a=$(this).closest("tr");n.row(a).data()}),e.on("click","#edit-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);if(i){if(0==e.data().isEdit)return void r.warning("有正编辑的入库信息",{})}else i=!0,e.data().isEdit=2,e.cells().invalidate(),o(a)(s);0!=e.data().id||r.warning("有正编辑的入库信息",{})}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),d=n.row(a),o="",l=!0;$.each(a.children(),function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){var n=$.trim(e.children("input").val()),s=$.trim(e.children("input").attr("name"));if(!n)return $(a).addClass("danger"),l=!1;if(1==t||2==t||0==t){if(30<n.length)return r.warning("请输入少于30个字",{}),$(a).addClass("danger"),l=!1;$(a).removeClass("danger"),d.data()[s]=n}else if(3==t){var i=Date.parse(n);o=new Date(i),d.data().createTime=o,$(a).removeClass("danger")}else $(a).removeClass("danger"),d.data().createTime=n}}),l&&s.doActionIns("saveSpareIn",d.data(),function(t){0==t?d.data().isEdit=2:(d.data().isEdit=0,d.data().id=t.id,d.cells().invalidate(),i=!1)})}),e.on("click","#cancel-btn",function(t){if(t.stopPropagation(),i=!1,(a=n.row(".shown")).data())a.data().isEdit=0,a.child.hide(),a.cells().invalidate(),s.doActionIns("cancel",a.data());else{var a,e=$(this).closest("tr");(a=n.row(e)).data().isEdit=0,a.child.hide(),s.doActionIns("cancel",a.data())}}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);s.doActionIns("deleteSpareIn",e.data())}),e.on("click","#sparelist-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);d?r.info("请先关闭之前备件条目再打开",{}):(d=!0,e.child('<div class="box"><div class="box-body table-responsive"><a ng-click="addInSpareClauseItem()" ng-hide="ifSubmitIn==2010" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加条目</span></a><div class="text-center pull-right"><a class="btn btn-default btn-sm" ng-hide="ifSubmitIn==2010" ng-click="submitInCaluses();"><i class="fa fa-save"><span class="hidden-xs">提交</span></i></a><a id="close-table" class="btn btn-default btn-sm"><i class="fa fa-times"></i><span class="hidden-xs">关闭</span></a></div><table width="100%" class="table" inspare-clauses-table></table></div></div>').show(),a.addClass("shown"),a.addClass("bg-f5f5f5"),a.next().addClass("bg-f5f5f5"),o(a)(s),o(a.next())(s),s.doActionIns("showSpareList",e.data()))}),e.on("click","#close-table",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=n.row(a);d=!1,s.doActionIns("cancel",e.data())})}]}}]),t.initDirective("inspareClausesTable",["$timeout","$compile","$filter","growl",function(t,i,a,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,a){var n,e=t,s=!1;l.$on(Event.INSPARECLAUSESINIT,function(t,d){n&&n.destroy(),s=!1,n=e.DataTable({dom:d.option[0]&&0<d.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:d.option[0],order:[[0,"asc"]],columns:[{data:"sparePartName",title:"备件编号"},{data:"sparePartNumber",title:"备件数量"},{data:"desc",title:"备注"},$.ProudSmart.datatable.optionCol2],columnDefs:[{targets:0,data:"sparePartName",render:function(t,a,e){if(2!=e.isEdit||"display"!=a)return escape(t);for(var n='<select id="sparePartName" name="sparePartName" style="width:100%" class="combobox form-control"><option value="">请选择备件</option>',s=(d.option[0],l.spareInfos),i=0;i<s.length;i++)s[i].name==t?n+='<option selected="true" value="'+s[i].id+'">'+s[i].name+"</option>":n+='<option value="'+s[i].id+'">'+s[i].name+"</option>";return n+="</select>"}},{targets:1,data:"sparePartNumber",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='20' name='sparePartNumber' autocomplete='off' style='width:100%' placeholder='请输入1~9999999999的整数' class='form-control input-sm' type='number' value='"+escape(t)+"'>":escape(t)}},{targets:2,data:"desc",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='20' name='desc' autocomplete='off' style='width:100%' class='form-control input-sm' type='text' placeholder='请输入备注' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"option",render:function(t,a,e){var n="<div class='input-group'>";return 2==e.isEdit?(n+="<a id='save-btn'  class='btn btn-default btn-sm' ><i class='fa fa-save hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 保存</span></a>",n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>"):2010==l.$parent.ifSubmitIn?n+="<button  class='btn' style='cursor:text;'><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>已提交</span></button>":(n+="<a id='edit-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></a>",n+="<a id='delStock-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>"),n+="</div>"}}]})}),e.on("init.dt",function(){}),e.on("click","td",function(t){t.preventDefault();var a=$(this).closest("tr");n.row(a).data()}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),s=!1;n.row(".shown");l.$parent.doActionIn("cancel")}),e.on("click","#delStock-btn",function(t){t.preventDefault(),s=!1;n.row(".shown");var a=$(this).closest("tr"),e=n.row(a);l.$parent.doActionIn("deleteStockOrderItem",e.data())}),e.on("click","#edit-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);if(s){if(0==e.data().isEdit)return void r.warning("有正编辑的库单条目",{})}else s=!0,e.data().isEdit=2,e.cells().invalidate(),i(a)(l);0!=e.data().id||r.warning("有正编辑的库单条目",{})}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),i=n.row(a),d=!0,o=$("#sparePartName").val();$.each(a.children(),function(t,a){var e=$(a);if(0==t){if(!o)return $(a).addClass("danger"),d=!1;$(a).removeClass("danger"),i.data().sparePartId=o}if(!e.has("button").length&&e.has("input").length){var n=$.trim(e.children("input").val()),s=$.trim(e.children("input").attr("name"));if(!n)return $(a).addClass("danger"),d=!1;if(1==t){if(!/^[1-9]\d{0,9}$/.test(n))return $(a).addClass("danger"),d=!1,r.warning("请输入1~9999999999的整数",{}),!1;$(a).removeClass("danger"),i.data()[s]=n}else $(a).removeClass("danger"),i.data()[s]=n}}),d&&(i.data().isEdit=0,s=!1,l.$parent.doActionIn("saveSpareInCaluses",i.data()))})}]}}]),t.initDirective("outspareClausesTable",["$timeout","$compile","$filter","growl",function(t,i,a,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,a){var n,e=t,s=!1;l.$on(Event.OUTSPARECLAUSESINIT,function(t,d){n&&n.destroy(),s=!1,n=e.DataTable({dom:d.option[0]&&0<d.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:d.option[0],order:[[0,"asc"]],columns:[{data:"sparePartName",title:"备件编号"},{data:"sparePartNumber",title:"备件数量"},{data:"desc",title:"备注"},$.ProudSmart.datatable.optionCol2],columnDefs:[{targets:0,data:"sparePartName",render:function(t,a,e){if(2!=e.isEdit||"display"!=a)return escape(t);for(var n='<select id="sparePartName" name="sparePartName" style="width:100%" class="combobox form-control"><option value="">请选择备件</option>',s=(d.option[0],l.spareInfos),i=0;i<s.length;i++)s[i].name==t?n+='<option selected="true" value="'+s[i].id+'">'+s[i].name+"</option>":n+='<option value="'+s[i].id+'">'+s[i].name+"</option>";return n+="</select>"}},{targets:1,data:"sparePartNumber",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='20' name='sparePartNumber' autocomplete='off' placeholder='请输入1~9999999999的整数' style='width:100%' class='form-control input-sm' type='number' value='"+escape(t)+"'>":escape(t)}},{targets:2,data:"desc",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='20' name='desc' placeholder='请输入备注' autocomplete='off' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"option",render:function(t,a,e){var n="<div class='input-group'>";return 2==e.isEdit?(n+="<a id='save-btn'  class='btn btn-default btn-sm' ><i class='fa fa-save hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 保存</span></a>",n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>"):2010==l.$parent.ifSubmitOut?n+="<button  class='btn' style='cursor:text;'><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>已提交</span></button>":(n+="<a id='edit-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>修改</span></a>",n+="<a id='delStock-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'>删除</span></a>"),n+="</div>"}}]})}),e.on("init.dt",function(){}),e.on("click","td",function(t){t.preventDefault();var a=$(this).closest("tr");n.row(a).data()}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),s=!1;n.row(".shown");l.$parent.doActionOut("cancel")}),e.on("click","#delStock-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);l.$parent.doActionOut("deleteStockOrderItem",e.data())}),e.on("click","#edit-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);if(s){if(0==e.data().isEdit)return void r.warning("有正编辑的条目信息",{})}else s=!0,e.data().isEdit=2,e.cells().invalidate(),i(a)(l);0!=e.data().id||r.warning("有正编辑的条目信息",{})}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),i=n.row(a),d=!0,o=$("#sparePartName").val();$.each(a.children(),function(t,a){var e=$(a);if(0==t){if(!o)return $(a).addClass("danger"),d=!1;$(a).removeClass("danger"),i.data().sparePartId=o}if(!e.has("button").length&&e.has("input").length){var n=$.trim(e.children("input").val()),s=$.trim(e.children("input").attr("name"));if(!n)return $(a).addClass("danger"),d=!1;if(1==t){if(!/^[1-9]\d{0,9}$/.test(n))return $(a).addClass("danger"),d=!1,r.warning("请输入1~9999999999的整数",{}),!1;$(a).removeClass("danger"),i.data()[s]=n}else $(a).removeClass("danger"),i.data()[s]=n}}),d&&(i.data().isEdit=0,s=!1,l.$parent.doActionOut("saveSpareOutCaluses",i.data()))})}]}}]),t.initDirective("spareOutTable",["$timeout","$compile","$filter","growl",function(t,o,l,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(s,t,a){var n,e=t,i=!1,d=!1;s.$on(Event.SPAREOUTINIT,function(t,a){d&&(d=!1),n&&n.destroy(),i=!1,n=e.DataTable({dom:a.option[0]&&0<a.option[0].length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:a.option[0],order:[[5,"asc"]],columns:[{data:"name",title:"库单编号"},{data:"desc",title:"库单说明"},{data:"handlerPerson",title:"处理人"},{data:"createTime",title:"出库时间"},$.ProudSmart.datatable.optionCol3,{data:"id",title:"",visible:!1}],columnDefs:[{targets:0,data:"name",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input style='width:100%' class='form-control input-sm' autocomplete='off' placeholder='请输入库单编号' name='name' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:2,data:"handlerPerson",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input style='width:100%' class='form-control input-sm' autocomplete='off' placeholder='请输入处理人' name='handlerPerson' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"createTime",render:function(t,a,e){return 0<e.isEdit?'<input style="width:100%" type="text" class="form-control input-sm" readonly drops="down"  timepicker="true" value="'+l("date")(t,"yyyy-MM-dd HH:mm:ss")+'" autocomplete="off"  date-time-picker >':l("date")(t,"yyyy-MM-dd HH:mm:ss")}},{targets:1,data:"desc",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input style='width:100%' class='form-control input-sm' placeholder='请输入库单说明' name='desc' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:4,data:"option",render:function(t,a,e){var n='<div class="btn-group btn-group-sm">';return 2==e.isEdit?n+='<a id="save-btn" class="btn btn-primary btn-sm"><i class="fa fa-check  hidden-lg hidden-md hidden-sm "></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default btn-sm" ><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a>':2010==s.ifRouteParams?n+="<div class='btn-group table-option-group'><button type='button' class='btn btn-sm' style='cursor:text;'>操作</button><button type='button' class='btn btn-sm dropdown-toggle' style='cursor:text;'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button>":(s.menuitems.D02_A06_S11&&(n+="<button id='edit-btn' class='btn btn-primary btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>"),s.menuitems.D03_A06_S11&&(n+="<button id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>"),s.menuitems.D04_A06_S11&&(n+="<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>"),n+="<ul class='dropdown-menu' role='menu'>",s.menuitems.D04_A06_S11&&(n+="<li><a role='button'  id='sparelist-btn'>备件条目</a></li>"),n+="</ul>"),n}}],rowCallback:function(t,a,e){o(t)(s)}})}),e.on("init.dt",function(){}),e.on("click","td",function(t){t.preventDefault();var a=$(this).closest("tr");n.row(a).data()}),e.on("click","#edit-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);if(i){if(0==e.data().isEdit)return void r.warning("有正编辑的出库信息",{})}else i=!0,e.data().isEdit=2,e.cells().invalidate(),o(a)(s);0!=e.data().id||r.warning("有正编辑的出库信息",{})}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),d=n.row(a),o="",l=!0;$.each(a.children(),function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){var n=$.trim(e.children("input").val()),s=$.trim(e.children("input").attr("name"));if(!n)return $(a).addClass("danger"),l=!1;if(1==t||2==t||0==t){if(30<n.length)return r.warning("请输入少于30个字",{}),$(a).addClass("danger"),l=!1;$(a).removeClass("danger"),d.data()[s]=n}else if(3==t){var i=Date.parse(n);o=new Date(i),d.data().createTime=o,$(a).removeClass("danger")}else $(a).removeClass("danger"),d.data().createTime=n}}),l&&s.doAction("saveSpareOut",d.data(),function(t){0==t?d.data().isEdit=2:(i=!1,d.data().isEdit=0,d.data().id=t.id,d.cells().invalidate())})}),e.on("click","#cancel-btn",function(t){if(t.stopPropagation(),i=!1,(a=n.row(".shown")).data())a.data().isEdit=0,a.child.hide(),a.cells().invalidate(),s.doAction("cancel",a.data());else{var a,e=$(this).closest("tr");(a=n.row(e)).data().isEdit=0,a.child.hide(),a.cells().invalidate(),s.doAction("cancel",a.data())}}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);s.doAction("deleteSpareOut",e.data())}),e.on("click","#sparelist-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);if(d)r.info("请先关闭之前备件条目再打开",{});else{d=!0;e.child('<div class="box"><div class="box-body table-responsive"><a ng-click="addOutSpareClauseItem()" ng-hide="ifSubmitOut==2010" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加条目</span></a><div class="pull-right"><a id="submit-btn" class="btn btn-default btn-sm" ng-hide="ifSubmitOut==2010" ng-click="submitOutCaluses();"><i class="fa fa-save"><span class="hidden-xs">提交</span></i></a><a id="close-table" class="btn btn-default btn-sm"><i class="fa fa-times"></i><span class="hidden-xs">关闭</span></a></div><table width="100%" class="table" outspare-clauses-table></table></div></div>').show(),a.addClass("shown"),a.addClass("bg-f5f5f5"),a.next().addClass("bg-f5f5f5"),o(a)(s),o(a.next())(s),s.doAction("showSpareList",e.data())}}),e.on("click","#close-table",function(t){t.preventDefault();var a=$(this).closest("tr"),e=n.row(a);d=!1,s.doAction("cancel",e.data())})}]}}])});
//# sourceMappingURL=../../../map/app-oc/js/directives/sparepart-dom.js.map
