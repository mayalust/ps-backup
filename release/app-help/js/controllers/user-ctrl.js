define(["controllers/controllers"],function(e){"use strict";e.controller("loginCtr",["$scope","$rootScope","Info","userLoginUIService",function(t,r,e,a){t.user={username:"",password:""},t.errorMsg="",t.slide="1",t.$watch("user.username",function(e,i){t.errorStatus=0}),t.$watch("user.password",function(e,i){t.errorStatus=0}),t.loginClick=function(e){var i=window.event?e.keyCode:e.which;if(13==i||null==i){if(""==t.user.username)return t.errorStatus=1,void(t.errorMsg="登录名不能为空");if(""==t.user.password)return t.errorStatus=2,void(t.errorMsg="密码不能为空");""!=t.user.username&&""!=t.user.password?a.login(t.user.username,t.user.password):(t.errorMsg="请输入用户名或密码",t.errorStatus=1)}},t.checkClick=function(){"checked"==$("#checkServe").attr("checked")?($("#checkServe").show(),$("#checkName").hide(),$("#checkServe").attr("checked",!1)):($("#checkServe").hide(),$("#checkName").show(),$("#checkServe").attr("checked",!0))},t.homeClick=function(){window.open("http://www.proudsmart.com")},r.indexShow=!1,r.personalShow=!0;var n=function(){var e=a.user.industry;e&&0!=e?0==a.user.loginTimes?window.location.href="../password.html":window.location.href="app/index.html":a.user.appData?0==a.user.loginTimes?window.location.href="../password.html":window.location.href="app/index.html":0==a.user.loginTimes?window.location.href="../password.html":window.location.href="apps.html"};a.user.isAuthenticated?n():t.$on("loginStatusChanged",function(e,i){a.user.isAuthenticated?(r.staffName=a.user.userName,t.userInfo=a.user,n()):(t.errorMsg=a.result.message,t.errorStatus=1)})}]),e.controller("personalController",["$scope","userEnterpriseService","growl","Info","userLoginUIService","$rootScope","userIdentifyService","modelDefinitionService","resourceUIService","userUIService",function(o,i,t,e,r,a,n,s,d,c){o.userEdit="",o.provinces="",o.districts="",o.citys="",o.loginname="",o.editUser="";var l=function(){d.getSimpleDistricts(function(e){if(0==e.code){for(var i in o.provinces=e.data,o.provinces)if(o.provinces[i].label==o.userEdit.enterprise.province){if("北京市"==o.userEdit.enterprise.province||"天津市"==o.userEdit.enterprise.province||"上海市"==o.userEdit.enterprise.province||"重庆市"==o.userEdit.enterprise.province){var t=o.provinces[i].children;for(var r in t)t[r].label==o.userEdit.enterprise.province&&(o.citys=t[r].children)}else o.citys=o.provinces[i].children;o.districts=[]}for(var a in o.citys)o.citys[a].label==o.userEdit.enterprise.city&&(o.districts=o.citys[a].children)}})};r.user.isAuthenticated?(a.staffName=r.user.userName,o.userInfo=r.user,o.userEdit=r.user,o.editUser=r.user.loginName,l()):o.$on("loginStatusChanged",function(e,i){r.user.isAuthenticated?(a.staffName=r.user.userName,o.userInfo=r.user,o.userEdit=r.user,o.editUser=r.user.loginName,l()):window.location.href="login.html"}),o.proChang=function(){l()},o.userEdit=r.user,o.editData={},s.findAllIndustry(function(e){for(var i=e.data,t=e.data,r=[],a=0;a<i.length;a++)for(var n=0;n<t.length;n++)i[a].id==t[n].parentModelId&&r.push(t[n]);o.belongList=r});e.get("localdb/info.json",function(e){o.provinceList=e.cityList,o.durationArr=e.durationList,o.scaleArr=e.scaleList});o.editClick=function(){o.editData.officePhone=o.userEdit.officePhone,o.editData.userID=o.userEdit.userID,o.editData.userName=o.userEdit.userName,o.editData.loginName=o.userEdit.loginName,void 0!==o.userEdit.officePhone&&void 0!==o.userEdit.loginName&&"error"!=o.loginname&&""!=o.userEdit.loginName&&null!=o.userEdit.loginName&&(o.editUser!=o.userEdit.loginName?4<=o.userEdit.loginName.length&&c.checkLoginName(o.userEdit.loginName,function(e){if(0==e.code){if(0==e.data)return void(o.loginname="error");u(o.editData)}}):u(o.editData))};var u=function(e){c.modifyUser(e,function(e){0==e.code?t.success("保存成功",{}):t.error("保存失败",{})})};o.$watch("userEdit.loginName",function(e,i,t){o.loginname=""}),o.editEnterpriseEClick=function(){var e={};e.enterpriseSize=o.userEdit.enterprise.enterpriseSize,e.duration=o.userEdit.enterprise.duration,e.name=o.userEdit.enterprise.name,e.enterpriseID=o.userEdit.enterpriseID,e.province=o.userEdit.enterprise.province,e.city=o.userEdit.enterprise.city,e.district=o.userEdit.enterprise.district,e.address=o.userEdit.enterprise.address,e.website=o.userEdit.enterprise.website,e.contact=o.userEdit.enterprise.contact,e.contactEmail=o.userEdit.enterprise.contactEmail?o.userEdit.enterprise.contactEmail:"",e.contactPhone=o.userEdit.enterprise.contactPhone?o.userEdit.enterprise.contactPhone:"",i.modifyEnterpriseInfo(e,function(e){0==e.code?(r.user.enterprise=e.data,t.success("保存成功",{})):t.error("保存失败",{})})},a.indexShow=!1,a.personalShow=!0}]),e.controller("passwordController",["$scope","$rootScope","userLoginUIService","userIdentifyService",function(t,e,r,i){t.passwordEdit=r.user,t.pwdList={emailAddress:"",newPwd:"",configPwd:"",regPwd:""},t.imgCode="",t.confirmShow="0",t.codeMessage="",t.emailAddress="",t.identifyName="",t.configError="",t.userId="",t.$on("loginStatusChanged",function(e,i){r.user.isAuthenticated&&(t.userId=r.user.userID)}),t.emailAddress=r.user.emailAddress,i.getIdentify(function(e){0==e.code&&(t.imgCode=e.data)}),t.blindClick=function(){t.imgCode=null,i.getIdentify(function(e){0==e.code&&(t.imgCode=e.data)})},t.$watch("pwdList.regPwd",function(e,i){e!=t.pwdList.newPwd?t.confirmShow=1:t.confirmShow=0}),t.$watch("identifyName",function(e,i){t.confirmShow=0}),t.$watch("pwdList.newPwd",function(e,i){}),t.$watch("pwdList.configPwd",function(e,i){t.confirmShow=0}),"personal"==document.location.href.split("/")[5]&&r.logout(),t.initPwd=function(){if(""!=t.emailAddress){if(""==t.pwdList.configPwd)return void(t.confirmShow=1010);if(""==t.pwdList.newPwd)return void(t.confirmShow=1011);if(""==t.pwdList.regPwd)return void(t.confirmShow=1016);if(""==t.identifyName)return void(t.confirmShow=1017);if(2022==t.configError)return;i.identifyNum(t.identifyName,function(e){0==e.code&&1==e.data?t.pwdList.regPwd==t.pwdList.newPwd?(""!=t.userId&&null!=t.userId||(t.userId=r.user.userID),r.modifyPassword(t.userId,t.pwdList.configPwd,t.pwdList.newPwd,function(e){if(0==e.code&&1==e.data)r.logout();else{if(0==e.data)return t.confirmShow="2011",void t.blindClick();t.confirmShow="10010",t.blindClick(),t.codeMessage=e.message}})):t.confirmShow=1:t.confirmShow=3})}else window.location.href="login.html"}}]),e.controller("registerCtrl",["$scope","$rootScope","Info","userUIService","modelDefinitionService","userIdentifyService","$interval",function(o,t,e,r,i,a,n){o.regShow="1",o.confirmPassword="",o.confirmShow="false",o.statusShow="1",o.emailOnly="0",o.imgCode="",o.identifyName="",o.safeMsg=!1,o.phoneEmail="1001",o.editData={},o.formData={emailAddress:"",password:"",roleID:"1",mobilePhone:"",userName:"",countryRegion:"中国大陆",address:"",industry:"",city:"北京",province:"北京",business:"",mail_num:""},o.enterpriseManager={name:""},o.show=!1;var s,d=location.href.split("?");e.get("localdb/info.json",function(e){o.areaList=e.areaList,o.provinceList=e.cityList});a.getIdentify(function(e){0==e.code&&(o.imgCode=e.data)}),i.findAllIndustry(function(e){for(var i=e.data,t=e.data,r=[],a=0;a<i.length;a++)for(var n=0;n<t.length;n++)i[a].id==t[n].parentModelId&&r.push(t[n]);o.belongList=r}),o.blindClick=function(){a.getIdentify(function(e){0==e.code&&(o.imgCode=e.data)})},o.$watch("formData.emailAddress",function(e,i){o.emailOnly="0"}),o.$watch("identifyName",function(e,i){o.emailOnly="0"}),o.$watch("formData.industry",function(e,i){o.emailOnly="0"}),o.$watch("formData.password",function(e,i){o.emailOnly="0"}),o.$watch("formData.mobilePhone",function(e,i){o.emailOnly="0"}),o.$watch("formData.userName",function(e,i){o.emailOnly="0"}),o.$watch("confirmPassword",function(e,i){o.emailOnly="0",e!=o.formData.password?o.confirmShow=1:o.confirmShow=0}),o.onMouseOver=function(e,i){o.show=!0},o.renewal=function(){window.location.reload()},o.statusClick=function(e){1==e?o.statusShow=1:2==e&&(o.statusShow=2)},o.noEmail=function(){"重新发送邮件"==$("#emailBtn").text()&&a.sendEmail(o.formData.emailAddress,o.formData.password,function(e){0==e.code&&1==e.data&&(o.time=60,n.cancel(),s=n(function(){o.time--,0==o.time?($("#emailBtn").text("重新发送邮件"),o.time=60,n.cancel(s)):$("#emailBtn").text(o.time+"秒后，重新获取")},1e3)),o.regShow=2})},o.phoneCode=function(){""!=o.formData.emailAddress?""!=o.statusCheck?""!=o.formData.password?null!=o.formData.password&&"发送验证码"==$("#phoneCode").text()&&($("#phoneCode").attr({disabled:"disabled"}),a.sendSMS(o.formData.emailAddress,function(e){0==e.code&&1==e.data?(o.timeCode=60,n.cancel(),s=n(function(){o.timeCode--,0==o.timeCode?($("#phoneCode").text("发送验证码"),$("#phoneCode").removeAttr("disabled"),o.timeCode=60,n.cancel(s)):$("#phoneCode").text(o.timeCode+"秒后，重新获取")},1e3)):10017==e.code&&(o.emailOnly=1,$("#phoneCode").removeAttr("disabled"))})):o.emailOnly="pass10":o.emailOnly="1003":o.emailOnly=11};var c=5,l=function(){0<--c?($("#sec").text(c),u()):window.location.href="index.html"},u=function(){setTimeout(l,1e3)};if(o.phoneSumbit=function(){""!=o.formData.userName?null!=o.formData.userName&&("phone"==o.statusCheck?(o.formData1={password:o.formData.password,mobilePhone:o.formData.emailAddress,userName:o.formData.userName,countryRegion:"中国大陆",address:o.formData.address,city:"北京",business:o.formData.business,province:"北京"},o.editData.name=o.formData.business,o.editData.address=o.formData.address,o.editData.contactPhone=o.formData.emailAddress):(o.formData1={password:o.formData.password,emailAddress:o.formData.emailAddress,userName:o.formData.userName,countryRegion:"中国大陆",address:o.formData.address,city:"北京",business:o.formData.business,province:"北京"},o.editData.name=o.formData.business,o.editData.address=o.formData.address,o.editData.contactEmail=o.formData.emailAddress),r.individualUser(o.editData,o.formData1,function(e){0==e.code?(o.regShow="4","phone"==o.statusCheck&&o.$on("loginStatusChanged",function(e,i){userLoginUIService.user.isAuthenticated?(t.staffName=userLoginUIService.user.userName,o.userInfo=userLoginUIService.user):window.location.href="login.html"}),u(),$("#barvader").css("width","100%"),$(".steps >ol >li:eq(2)").addClass("active")):-3==e.code&&(o.emailOnly="2")})):o.emailOnly="01012"},o.emailHref=function(e){var i=e.split("@")[1].split(".")[0];window.open("http://mail."+i+".com/")},o.passCheck=function(e){var i=""+e.currentTarget.value;""==i?o.emailOnly="pass10":i.match(/^(?![^a-zA-Z]+$)(?!\D+$).{6,20}$/)||(o.emailOnly="pass11")},o.identCheck=function(e){""==""+e.currentTarget.value&&(o.emailOnly="30001")},o.userCheck=function(e){""==""+e.currentTarget.value&&(o.emailOnly="01012")},o.modeCheck=function(){var e=o.formData.emailAddress;e.match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)?(o.phoneEmail=1002,o.statusCheck="email"):e.match(/^((1[3,5,8][0-9])|(14[5,7])|(17[0,6,7,8]))\d{8}$/)?(o.phoneEmail=1001,o.statusCheck="phone"):o.statusCheck=(o.emailOnly=""==e?11:"1003","")},o.checkClick=function(){o.emailOnly="0","checked"==$("#regCheck").attr("checked")?$("#regCheck").attr("checked",!1):$("#regCheck").attr("checked",!0)},o.nextStep=function(i){""!=o.formData.emailAddress?""!=o.formData.password?""!=o.identifyName?2==i&&("checked"==$("#regCheck").attr("checked")?"phone"==o.statusCheck?r.checkMobilePhone(o.formData.emailAddress,function(e){0==e.code&&1==e.data?a.identifySMS(o.identifyName,function(e){0==e.code&&1==e.data?(o.regShow="20000",$("#barvader").css("width","50%"),$(".steps >ol >li:eq(1)").addClass("active")):o.emailOnly=2}):o.emailOnly=1}):"email"==o.statusCheck&&a.repeatEmail(o.formData.emailAddress,function(e){0==e.code&&1==e.data?a.identifyNum(o.identifyName,function(e){0==e.code&&1==e.data?a.sendEmail(o.formData.emailAddress,o.formData.password,function(e){o.regShow=i}):(o.emailOnly=2,a.getIdentify(function(e){0==e.code&&(o.imgCode=e.data)}))}):o.emailOnly=1}):o.emailOnly=2099):o.emailOnly="30001":o.emailOnly="pass10":o.emailOnly=11},null!=d[1]){var f=d[1];a.identifyEmail(f.split("=")[1],function(i){0==i.code?a.repeatEmail(i.data.emailAddress,function(e){0==e.code&&0==e.data?(o.regShow=6,$(".steps").hide()):(o.formData.emailAddress=i.data.emailAddress,o.formData.password=i.data.countryRegion,$(".steps >ol >li:eq(1)").addClass("active"),$("#barvader").css("width","50%"),o.regShow="20000")}):o.regShow=5})}}]),e.controller("forgetCtrl",["$scope","userIdentifyService","userUIService","$interval",function(t,r,i,a){var n;t.forgetClick="1",t.emailOnly="",t.forgetList={emailAddress:"",verify:"",verifyEmail:"",newPwd:"",confimPwd:""},t.hideValidate="",t.phoneEmail="",t.verify="",t.statusCheck="",t.verifySuccess="0",t.$watch("forgetList.confimPwd",function(e,i){e!=t.forgetList.newPwd?t.emailOnly=4:t.emailOnly=0}),t.$watch("forgetList.newPwd",function(e,i){t.emailOnly=null==e?333:0}),t.$watch("forgetList.verify",function(e,i){t.emailOnly=0}),t.$watch("forgetList.verifyEmail",function(e,i){t.emailOnly=0}),r.getIdentify(function(e){0==e.code&&(t.imgCode=e.data)}),t.codeCheck=function(){var e=t.forgetList.verify;5==e.length?r.identifyNum(e,function(e){0==e.code&&1==e.data?(t.verify="success",t.emailOnly="0",t.verifySuccess="1"):(t.emailOnly=2,t.verify="error",t.verifySuccess="0",r.getIdentify(function(e){0==e.code&&(t.imgCode=e.data)}))}):(t.emailOnly=2,t.verifySuccess="0",t.verify="error")},t.modeCheck=function(){var e=t.forgetList.emailAddress;e.match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)?r.repeatEmail(t.forgetList.emailAddress,function(e){t.statusCheck="email",0==e.code&&0==e.data?t.phoneEmail="":(t.phoneEmail=1001,t.emailOnly=1)}):e.match(/^((1[3,5,8][0-9])|(14[5,7])|(17[0,6,7,8]))\d{8}$/)?i.checkMobilePhone(t.forgetList.emailAddress,function(e){t.statusCheck="phone",0==e.code&&1==e.data?(t.emailOnly=1,t.phoneEmail=1002):t.phoneEmail=""}):t.phoneEmail=(t.statusCheck=(t.emailOnly=""==e?11:"111",""),"")},t.blindClick=function(){t.imgCode=null,r.getIdentify(function(e){0==e.code&&(t.imgCode=e.data)})},t.t=60,t.$watch("forgetList.emailAddress",function(e,i){t.emailOnly="0"}),t.emailSend=function(){""!=t.forgetList.emailAddress?""!=t.statusCheck?1002!=t.phoneEmail&&1001!=t.phoneEmail?""!=t.forgetList.verify?"error"!=t.verify?"获取验证码"==$("#charge").text()&&($("#charge").attr({disabled:"disabled"}),"phone"==t.statusCheck?r.sendPasswordSMS(t.forgetList.emailAddress,function(e){0==e.code&&1==e.data?(t.time=60,a.cancel(),n=a(function(){t.time--,0==t.time?($("#charge").removeAttr("disabled"),$("#charge").text("获取验证码"),t.time=60,a.cancel(n)):$("#charge").text(t.time+"秒后，重新获取验证码")},1e3)):10008==e.code&&(t.emailOnly="1")}):"email"==t.statusCheck&&r.sendEmailPassword(t.forgetList.emailAddress,function(e){0==e.code&&1==e.data&&(t.time=60,a.cancel(),n=a(function(){t.time--,0==t.time?($("#charge").text("获取验证码"),$("#charge").removeAttr("disabled"),t.time=60,a.cancel(n)):$("#charge").text(t.time+"秒后，重新获取验证码")},1e3))})):t.emailOnly="2":t.emailOnly="200":t.emailOnly="1":t.emailOnly="111":t.emailOnly=11},t.forgetAjax=function(){""!=t.forgetList.newPwd?null!=t.forgetList.newPwd&&(""!=t.forgetList.confimPwd?null!=t.forgetList.confimPwd&&4!=t.emailOnly&&(t.forgetList.newPwd==t.forgetList.confimPwd?r.forgetPassword(t.forgetList.emailAddress,t.hideValidate,t.forgetList.newPwd,function(e){0==e.code&&1==e.data&&(t.forgetClick="4",$("#barvader").css("width","100%"),$(".steps >ol >li:eq(2)").addClass("active"),s())}):t.emailOnly=4):t.emailOnly=312):t.emailOnly=311};var e=5,o=function(){0<--e?($("#sec").text(e),s()):window.location.href="../#/index"},s=function(){setTimeout(o,1e3)};t.forgetStep=function(i){if(2==i){if(""==t.forgetList.emailAddress)return void(t.emailOnly=11);if(""==t.statusCheck)return void(t.emailOnly="111");if(1002==t.phoneEmail||1001==t.phoneEmail)return void(t.emailOnly="1");if(""==t.forgetList.verify)return void(t.emailOnly="200");if("error"==t.verify)return void(t.emailOnly="2");null!=t.forgetList.verifyEmail&&""!=t.forgetList.verifyEmail?"phone"==t.statusCheck?r.identifyPasswordSMS(t.forgetList.verifyEmail,function(e){0==e.code?(t.hideValidate=e.data,$(".steps >ol >li:eq(1)").addClass("active"),$("#barvader").css("width","50%"),t.forgetClick="2"):t.emailOnly=3}):"email"==t.statusCheck&&r.emailCheckPassword(t.forgetList.verifyEmail,function(e){0==e.code?(t.hideValidate=e.data,t.forgetClick=i,$(".steps >ol >li:eq(1)").addClass("active"),$("#barvader").css("width","50%"),t.forgetClick="2"):t.emailOnly=3}):t.emailOnly=30001}else 3==i&&userLoginUIService.emailCheckPassword(t.forgetList.verifyEmail,function(e){0==e.code?(t.hideValidate=e.data,t.forgetClick=i,$(".mod-sub-nav > li").removeClass("list2-active"),$(".mod-sub-nav > li:eq(2)").addClass("list3-active")):t.emailOnly=3})}}])});
//# sourceMappingURL=../../../map/app-help/js/controllers/user-ctrl.js.map
