define(["controllers/controllers","bootstrap-dialog"],function(s,c){"use strict";s.controller("AllMessageCtrl",["$scope","$location","userLoginUIService","psMessageService","growl",function(i,t,s,e,a){i.msgStatus="全部消息",i.statusMsg="0",i.messageList="",i.readMsgStatus=t.path(),i.msgGridData={columns:[{title:'<input type="checkbox" id="allClick" name="allClick" style="width: 19px;height: 25px;" class="minimal" />',data:"message.messageId"},{title:"消息标题",data:"message.title"},{title:"接收时间",data:"message.insertTime"},{title:"消息类型",data:"message.msgType"}],columnDefs:[{targets:0,data:"message.messageId",render:function(s,e,a){return'<input type="checkbox" id="msgClick" name="msgClick" style="width: 19px;height: 25px;" class="minimal msg"  value="'+s+'" />'}},{targets:1,data:"message.title",render:function(s,e,a){return 0==a.status?'<dt><a href class="hov-slide" style="color: #444;" >'+s+"</a></dt>":'<span class="contacts-list-msg"><a  href style="color: #999;"   class="hov-slide"  >'+s+"</a></span>"}},{targets:2,data:"message.insertTime",render:function(s,e,a){return 0==a.status?"<dt>"+newDateJson(s).Format(GetDateCategoryStrByLabel())+"</dt>":'<span class="contacts-list-msg">'+newDateJson(s).Format(GetDateCategoryStrByLabel())+"</span>"}},{targets:3,data:"message.msgType",render:function(s,e,a){var t="";"ticket_message"==s?t="工单任务":"maintenance_message"==s?t="维保":"bulletin_message"==s?t="系统公告":"payment_message"==s?t="缴费":"energyconsume_message"==s&&(t="能耗结构");return 0==a.status?"<dt>"+t+"</dt>":'<span class="contacts-list-msg">'+t+"</span>"}}]};var n=function(s){"all"==s?r():"order"==s?g("ticket_message"):"bulletin"==s?g("bulletin_message"):"payment"==s?g("payment_message"):"maintenance"==s&&g("maintenance_message ")},g=function(n){"/message"==t.path()?e.queryMessageByUserID(function(s){if(0==s.code){i.msgGridData.data=s.data,i.messageList=s.data;var e=i.messageList,a=[];for(var t in e)e[t].message.msgType==n&&a.push(e[t]);i.msgGridData.data=a,i.$broadcast(Event.USERCENTERINIT+"_msg",i.msgGridData)}}):"/unread"==t.path()?e.queryMessageByStatusAndUserID("0",function(s){if(0==s.code){i.msgGridData.data=s.data,i.messageList=s.data;var e=i.messageList,a=[];for(var t in e)e[t].message.msgType==n&&a.push(e[t]);i.msgGridData.data=a,i.$broadcast(Event.USERCENTERINIT+"_msg",i.msgGridData)}}):"/read"==t.path()&&e.queryMessageByStatusAndUserID("1",function(s){if(0==s.code){i.msgGridData.data=s.data,i.messageList=s.data;var e=i.messageList,a=[];for(var t in e)e[t].message.msgType==n&&a.push(e[t]);i.msgGridData.data=a,i.$broadcast(Event.USERCENTERINIT+"_msg",i.msgGridData)}})};$('a[data-toggle="tab"]').on("shown.bs.tab",function(s){var e=$(s.target).attr("name");n(e)});var m=function(s){e.queryMessageByStatusAndUserID(s,function(s){0==s.code&&(i.msgGridData.data=s.data,i.messageList=s.data,i.$broadcast(Event.USERCENTERINIT+"_msg",i.msgGridData))})},r=function(){"/message"==t.path()?(i.msgStatus="全部消息",i.statusMsg="0",o()):"/unread"==t.path()?(i.msgStatus="未读消息",i.statusMsg="0",m("0")):"/read"==t.path()&&(i.msgGridData={columns:[{title:"消息标题",data:"message.title"},{title:"提交时间",data:"message.insertTime"},{title:"消息类型",data:"message.msgType"}],columnDefs:[{targets:0,data:"message.title",render:function(s,e,a){return 0==a.status?'<dt><a href class="hov-slide" style="color: #444;" >'+s+"</a></dt>":'<span class="contacts-list-msg"><a  href style="color: #999;"   class="hov-slide"  >'+s+"</a></span>"}},{targets:1,data:"message.insertTime",render:function(s,e,a){return 0==a.status?"<dt>"+newDateJson(s).Format(GetDateCategoryStrByLabel())+"</dt>":'<span class="contacts-list-msg">'+newDateJson(s).Format(GetDateCategoryStrByLabel())+"</span>"}},{targets:2,data:"message.msgType",render:function(s,e,a){var t="";"ticket_message"==s?t="工单任务":"maintenance_message"==s?t="维保":"bulletin_message"==s?t="系统公告":"payment_message"==s?t="缴费":"energyconsume_message"==s&&(t="能耗结构");return 0==a.status?"<dt>"+t+"</dt>":'<span class="contacts-list-msg">'+t+"</span>"}}]},i.msgStatus="已读消息",m("1"),i.statusMsg="1")},o=function(){e.queryMessageByUserID(function(s){0==s.code&&(i.msgGridData.data=s.data,i.messageList=s.data,i.$broadcast(Event.USERCENTERINIT+"_msg",i.msgGridData))})};i.statusUpdate=function(a){e.modifyMsgStatus([a.message.messageId],function(s){if(0==s.code)if("ticket_message"==a.message.msgType){var e=$.trim(a.message.content).split("任务ID：")[1];location.href="../app-oc/index.html#/orderdetail/"+e.split(",")[0]+t.path()+"/notdeal"}else"bulletin_message"==a.message.msgType?location.href="#/messageDetail/"+a.message.messageId:"payment_message"==a.message.msgType&&($("#info").css("display","none"),$("#exp").css("display","block"),location.href="../app-uc/index.html#/expenses")})},r(),i.deleteMsg=function(s){i.messageInfo=[];$("input[name='msgClick']").each(function(){$(this).is(":checked")&&($(this).val()+",",i.messageInfo.push($(this).val()))}),"1"==s?0<i.messageInfo.length?c.show({title:"提示",closable:!1,message:"您确认要删除选中的"+i.messageInfo.length+"条消息吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(s){e.deleteMessageUser(i.messageInfo,function(s){0==s.code&&(a.success("删除消息成功",{}),r())}),s.close()}},{label:"取消",action:function(s){s.close()}}]}):a.warning("请选择要删除的消息",{}):"2"==s&&(0<i.messageInfo.length?c.show({title:"提示",closable:!1,message:"您确认要标记选中的"+i.messageInfo.length+"条消息为已读吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(s){e.modifyMsgStatus(i.messageInfo,function(s){0==s.code&&(a.success("消息标记已读成功",{}),n($("#message  .active  a ").attr("name")))}),s.close()}},{label:"取消",action:function(s){s.close()}}]}):a.warning("请选择要标记为已读的消息",{}))}}]),s.controller("messageDetailCtrl",["$scope","$sce","$routeParams","$location","userLoginUIService","psMessageService","growl",function(e,a,s,t,n,i,g){var m=s.msgId;e.detailMessage="",e.TrustAsHtml=function(s){return a.trustAsHtml(s)},i.queryMessageByID(m,function(s){0==s.code&&(e.detailMessage=s.data)})}])});
//# sourceMappingURL=../../../map/app-help/js/controllers/message-ctrl.js.map
