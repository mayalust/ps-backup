define(["commonMethod"],function(commonMethod){return function(data){var self=new commonMethod(data),regExp=/\{item\:(\w+)\}/,getValue=function getValue(str,item){if(regExp.test(str))var val=$$.runRegExp(str,regExp,1);else var val=str;return val?eval("item."+val):val},autoload=!0,resourceUIService=data.resourceUIService,dictionaryService=data.dictionaryService,global=data.global,element=data.element,timeout=data.timeout,serviceCenterService=data.serviceCenterService,resourceUIService=data.resourceUIService,userLoginUIService=data.userLoginUIService,customMethodService=data.customMethodService,viewFlexService=data.viewFlexService,wrap=$("<div></div>").addClass("input-group btn-group"),addOn=$("<button></button>").addClass("btn btn-default").css("padding","6px 12px"),b=$("<b></b>").addClass("glyphicon glyphicon-refresh");addOn.append(b);var select=$("<select></select>").addClass("multiselect"),condition,expression;wrap.append(select),$$.runExpression(element.advance.condition,function(e){if("0"!=e.code)throw new Error(e.message);var t=e.data;condition=(condition="function"==typeof t?t(data):t)||{}}),$$.runExpression(element.advance.expression,function(e){if("0"==e.code){var t=e.data;expression=(expression="function"==typeof t?t(data):t)||{}}else expression={}}),self.getResources=function(t){resourceUIService.getResources(function(e){0==e.code&&t(e.data)})},self.getKpisByModelId=function(e,t){resourceUIService.getKpisByModelId(e,function(e){0==e.code&&t(e.data)})},self.getCurrentProjects=function(t){resourceUIService.getDomainsByFilter({modelId:302},function(e){0==e.code&&t(e.data)})},expression&&(autoload=expression.$attr("formatter/autoload"),null==autoload&&(autoload=!0)),"multiple"==expression.$attr("type")?select.attr("multiple","multiple"):select.removeAttr("multiple"),element.style&&wrap.css(element.style);var method=element.$attr("advance/getMultiSelect");return element.setCondition=function(e){condition=e},element.renderData=function(){var e,t=[];for(var n in condition)t.push("function"==typeof(e=condition[n])?e({global:global,tools:data,ui:element}):e);var o=function(e){var t=expression.$attr("on/init");if("function"==typeof t)try{t({global:global,target:element,self:self,tools:e,ui:element})}catch(e){}else element.render(e)};"models"==method?resourceUIService.getModels(function(e){if(0==e.code){o([{id:"",label:"全部"}].concat(e.data))}}):"devices"==method?resourceUIService.getDevices(function(e){0==e.code&&o(e.data)}):"projects"==method?resourceUIService.getDomainsByFilter({modelId:302},function(e){0==e.code&&o(e.data)}):"domains"==method?resourceUIService.getDomainsByFilter({modelId:300},function(e){0==e.code&&o(e.data)}):"enterprises"==method?resourceUIService.getEnterpriseDomainsByFilter({modelId:303,layer:2},function(e){0==e.code&&(e.data.unshift({id:"",label:"请选择"}),o(e.data))}):"industrys"==method?dictionaryService.getAllDicts(function(e){if(0==e.code){var t=[];e.data.forEach(function(e){"industryShortType"==e.dictCode&&(e.id=e.label,t.push(e))}),t.unshift({id:0,label:"请选择",param:"请选择"}),o(t)}}):"energys"==method&&dictionaryService.getAllDicts(function(e){if(0==e.code){var t=[];e.data.forEach(function(e){"energyType"==e.dictCode&&(e.id=e.label,t.push(e))}),t.unshift({id:0,label:"请选择"}),o(t)}})},self.getViewByProjectId=function(n,o){viewFlexService.getViewsOnlyPublishedByTypeAndDomainPath("configure",userLoginUIService.user.domainPath,function(e){var t=e.data.find(function(e){return!(!e.template||"project"!=e.template.resourceType||e.template.resourceId!=n)});t?viewFlexService.getViewById(t.viewId,function(e){0==e.code&&o(e.data)}):o(null)})},element.render=function(i){var o=function(){var r=[];return wrap.find("ul.dropdown-menu li.active").each(function(e,t){var n=$(t).find("input"),o=i.find(function(e){return e.id==n.attr("value")});r.push(o)}),r};element.getSelect=o;var e=function(e){var t=expression.$attr("formatter");if(t)var n=getValue(t.label,e),o=getValue(t.value,e);return $("<option></option>").attr("value",o).text(n)};for(var t in select.children().remove(),i)select.append(e(i[t]));timeout(function(){$$.loadExternalJs(["bootstrap-multiselect"],function(e){select.multiselect("destroy"),select.multiselect({buttonWidth:wrap.parent().width(),buttonText:function(e){if(0==e.length)return"无做出任何选择";if(1<e.length)return"已选择"+e.length+"个";var t="";return e.each(function(){t+=$(this).text()+", "}),t.substr(0,t.length-2)},onChange:function(e,t){var n=expression.$attr("on/change");if("function"==typeof n)try{n({target:element,element:element,global:global,tools:i,self:self,values:o(),ui:{values:o()}})}catch(e){}}})})})},self.render=element.render,autoload&&element.renderData(),wrap}});
//# sourceMappingURL=../../map/toolkit/component/multiselect.js.map
