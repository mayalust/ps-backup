define([],function(){return function(n){var s=n.element,l=n.previewMode,a=n.global,o=(n.timeout,$("<div></div>")),p=$("<div></div>");return s.style&&p.css(s.style),p.attr("id","baidumap"),p.attr("class","baidu-maps"),$$.runExpression(s.$attr("advance/expression"),function(t){if("0"==t.code){var e=t.data;("function"==typeof e?e(n,system):e)||{}}else!function(t){s.setSelfDom(o);var r=s.runExpression(s.$attr("parameters/mapStyle"));t.$attr("on/click");s.convertor=function(r,l){e(function(){for(var t=new window.BMap.Convertor,a=[],o=[],i=Math.ceil(r.length/10),e=0;e<r.length;e++){var n=new window.BMap.Point(r[e][0],r[e][1]);a.push(n),10==a.length&&function(n){t.translate(a,1,5,function(t){if(0===t.status){i--;for(var e=0;e<10;e++)o[n-9+e]=t.points[e];0==i&&l(o)}}),a=[]}(e)}0<a.length&&t.translate(a,1,5,function(t){if(0===t.status){i--;for(var e=0;e<a.length;e++)o[r.length-a.length+e]=t.points[e];0==i&&l(o)}})})};var e=function(a){null==window.BMap?require(["baiduMap","bmap"],function(t,e){var n=0;!function t(){{if(!(n<20))throw new Error("百度视图获取失败!!");n+=1,setTimeout(function(){null==window.BMap?t():a(window.BMap)})}}()},function(){a()}):a()};s.convertorByApi=function(r,l){e(function(){for(var t=window.location.protocol+"//api.map.baidu.com/geoconv/v1/?from=1&to=5&ak=eMekSXxqG1j2wLM57RFN61l8T6eB1EDx&coords=",a=0,o=[],e="",i=Math.ceil(r.length/80),n=0;n<r.length;n++)e+=r[n][0]+","+r[n][1]+";",80==++a&&(e=e.substring(0,e.length-1),function(n){jQuery.ajax({type:"GET",url:t+e,dataType:"jsonp",jsoncallback:"callBack",success:function(t){if(0===t.status){i--;for(var e=0;e<80;e++)o[n-79+e]=new window.BMap.Point(t.result[e].x,t.result[e].y);0==i&&l(o)}},error:function(t){}}),a=0,e=""}(n));0<a&&(e=e.substring(0,e.length-1),jQuery.ajax({type:"GET",url:t+e,dataType:"jsonp",jsoncallback:"callBack",success:function(t){if(0===t.status){i--;for(var e=0;e<a;e++)o[r.length-a+e]=new window.BMap.Point(t.result[e].x,t.result[e].y);0==i&&l(o)}},error:function(t){}}))})};s.getSampleData=function(){return{icon:{url:"../images/ouke/oukeIcon1.svg",width:30,height:30},lng:116.404,lat:39.915,infoWindow:{html:"项目名称1<br><hr />告警总数:12<br>"},title:"标题1",rotation:0,minZoom:0,maxZoom:10}},s.render=function(o,i){$$.loadExternalJs(["BMapLib"],function(e){function t(t){var e=t.html,l=t.data,n=$(e).find("button");n.on("click",function(t){var e=$(this).attr("id");if("device"==e){var n=l.data.modelId,a=l.data.id,o={modelId:n,resourceId:a};s.linkTo("../app-freeboard/index.html#/template/device/dashboard/"+JSON.stringify(o))}else if("model"==e){var n=l.data.modelId,o={modelId:n};s.linkTo("../app-freeboard/index.html#/template/model/dashboard/"+JSON.stringify(o))}else if("project"==e){var i=l.data.projectId,o={projectId:i};s.linkTo("../app-freeboard/index.html#/template/project/dashboard/"+JSON.stringify(o))}else if("customer"==e){var r=l.data.customerId,o={customerId:r};s.linkTo("../app-freeboard/index.html#/template/customer/dashboard/"+JSON.stringify(o))}})}function n(t){e.enableScrollWheelZoom(!0),e.centerAndZoom(o.center,o.zoom),o.markers&&e.addMarkers(o.markers),o.polygons&&e.addPolygons(o.polygons),o.symbols&&e.addSymbols(o.symbols),e.render(),s.setZoom=function(t){e.setZoom(t)},s.setCenter=function(t){e.setCenter(t)},s.setHighlightByMakerId=function(t){e.setHighlightByMakerId(t)},s.setMapStyle=function(t){t&&e.setMapStyle(t)},s.getBMapLibMap=function(){return e._map}}function a(t){var e=t.data;if(l){var n=e.$attr("on/click");if("function"==typeof n)try{n(t)}catch(t){}}else{var a=function(t){var e=$("<div>"+t.$attr("data/label")+"仪表板配置</div>");return e.append($("<hr/>")),"device"==t.type?(e.append($("<button id='model' class='btn btn-default'><span class='glyphicon glyphicon-cog' style='margin-right:5px;'></span>配置设备仪表板</button>")),e.append($("<br/>")),e.append($("<button id='device' class='btn btn-default'><span class='glyphicon glyphicon-cog' style='margin-right:5px;'></span>配置单设备视图</button>"))):"project"==t.type?e.append($("<button id='project' class='btn btn-default'><span class='glyphicon glyphicon-cog' style='margin-right:5px;'></span>配置项目仪表板</button>")):"customer"==t.type?e.append("<button id='customer' class='btn btn-default'><span class='glyphicon glyphicon-cog' style='margin-right:5px;'></span>配置客户仪表板</button>"):e.append("无下钻"),e[0]};if(e.type)e.infoWindow.html=a(e);else{var n=e.$attr("on/click");if("function"==typeof n)try{n(t)}catch(t){}}}}setTimeout(function(){new e({mapDom:p,popupTrigger:l?"mouseover":"click",init:n,click:a,infoWindowOpen:t,mapStyle:i||r})})})};var n=t.$attr("on/init");if("function"==typeof n)try{n({target:s,global:a})}catch(t){}window.fnOK=function(t){var e=s.getLibMapObj,n=parseInt((new Date).getTime()/1e3),a=n-345600,o=new commonMethod;new BMapLib,window.BMap;o.getShipTrack(""+t,a,n,function(t){0<t.length&&function(t,e,n,a){for(var o=[],i=0;i<e.length;i++){var r=1e-6*e[i].lon,l=e[i].lat/1e6;o.push({fix:{lng:r.toFixed(6),lat:l.toFixed(6)},time:e[i]})}var s=[],p=[],c=[];for(var d in o)p.push(new BMap.Point(o[d].fix.lng,o[d].fix.lat)),s.push(o[d]),c.push(o[d]);var f=new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE,{scale:5,strokeWeight:1,fillColor:"#ffffff",strokeColor:"rgb(49, 73, 181)",fillOpacity:.8}),u=new BMap.Polyline(p,{strokeColor:"#1869AD",strokeWeight:1,strokeOpacity:1});t.addOverlay(u);var g=new BMap.Size(40,70),m=(new BMap.Size(0,13),new BMap.Size(27,42)),h=new BMap.Icon("../images/map/start.png",g,{imageSize:m,imageOffset:new BMap.Size(8,-1)}),y=new BMap.Icon("../images/map/end.png",g,{imageSize:m,imageOffset:new BMap.Size(8,-1)}),f=new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE,{scale:5,strokeWeight:1,fillColor:"#ffffff",strokeColor:"rgb(49, 73, 181)",fillOpacity:.8}),b=[];for(var v in s){var w=new BMap.Point(s[v].fix.lng,s[v].fix.lat),M=s.length-1;0==v?h:v==M?y:f;var B=new BMap.Marker(w,{icon:f}),k=new BMap.Label($$.getDateTime(s[v].time.utc),{offset:new BMap.Size(15,-25)});k.setStyle({width:"120px",background:"transparent",borderRadius:"5px",textAlign:"center",borderWidth:"1px",borderColor:"#1869AD",borderStyle:"solid",height:"20px",lineHeight:"20px"}),B.setLabel(k),B.setTitle($$.getDateTime(s[v].time.utc)),0==v?B.setShadow(h):v==M&&B.setShadow(y),b.push(B),t.addOverlay(B)}}(e,t)})},o.append(p)}({})}),o}});
//# sourceMappingURL=../../map/toolkit/component/baidumap.js.map
