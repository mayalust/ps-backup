define([],function(){return function(b,n,a){var c=n.nodesDes,o=n.kpisDes,m=n.q;n.resourceUIService;var r=function(){var n=new BMap.Map("container"),k=new BMap.LocalSearch(n),t=b.reduce(function(n,e){return-1==n.indexOf(e.instance)&&n.push(e.instance),n},[]);!function(n,i,e){var p=[],h=[],r=[],a=function(l){var v={ci:l,children:[]},n=function(d){var n=function(n){var e,i,r,a,u,t,c,o,f=m.defer(),s={kpi:d,instance:n};p.push((e=l,i=d,r=n,a=s,u=f,t={},c=m.defer(),o=b.find(function(n){return n.kpiCode==i.id&&n.nodeId==e.id&&n.instance==r}),c.id=r,c.find=o,t.id=r,u.id=r,o?(k.search(o.instance),k.setSearchCompleteCallback(function(n){var e=n.keyword,i=h.find(function(n){return n.id==e}),r=n.vr[0].point;v.children.find(function(n){return n.instance==e}).value=[r.lng,r.lat,i.find.value],i.resolve("success")})):(a.value="-",c.resolve("success")),h.push(c),c.promise.id=r,c.promise)),v.children.push(s)};for(var e in t)n(t[e])};for(var e in i)n(i[e]);return v};for(var u in n)r.push(a(n[u]));m.all(p).then(function(){e(r)})}(c,o,function(n){var u=n,e=function(n){var e=[],i=function(n){var e={name:n.ci.label,data:[]},i=function(n){return{name:n.instance,value:n.value}};for(var r in n.children)e.data.push(i(n.children[r]));return e};for(var r in u)e.push(i(u[r]));return e},i=function(r){var a=[],n=function(e){var n=function(n){return"function"==typeof r?r({ci:e.ci.label,kpi:n.kpi.label,value:n.value}):e.ci.label+"-"+n.kpi.label};for(var i in e.children)a.push(n(e.children[i]))};for(var e in u)n(u[e]);return a},r={getSeries:e,getLegend:i,data:{nodes:c,kpis:o,legend:i(),series:e()}};a(r)})};require(["baiduMap","bmap"],function(n,e){var i=0;!function n(){{if(!(i<20))throw new Error("百度视图获取失败!!");i+=1,setTimeout(function(){null==window.BMap?n():r()})}}()},function(){r()})}});
//# sourceMappingURL=../../../map/toolkit/component/explainer/denuo_ci_map.js.map
