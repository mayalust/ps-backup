define(["commonMethod","configs"],function(t){return function(e){var u,a=e.route,y=e.element,k=e.SwSocket,n=(e.previewMode,e.alertService,e.userLoginUIService),r=e.growl,i=(e.serviceCenterService,e.dictionaryService,e.resourceUIService,e.ticketTaskService,e.projectUIService,e.kpiDataService,e.window,y.advance.getfunction,y.$attr("advance/getListTable")),c=e.global,p=y.$attr("parameters/listbottom"),v=y.$attr("parameters/col")||1,f=y.$attr("parameters/pageSize"),m={dark:{text:{color:"#fff"},header:{"background-color":"rgba(250,250,250,.5)","line-color":"rgba(250,250,250,.2)"}}};Object.defineProperty(y,"dataSource",{enumerable:!1});var t=$("<div></div>");t.css("width","100%"),t.css("overflow","auto");var b,g=$("<table></table>").addClass("table table-hover");t.append(g),$$.runExpression(y.$attr("advance/expression"),function(t){if("0"==t.code){var a=t.data;b=(b="function"==typeof a?a(e,system):a)||{}}else b={}});var C=b.theme||"default",h=b.format;e.q;y.setFilter=function(t){},y.setFormat=function(t){h=t},y.render=function(l){$$.loadExternalJs(["datatables.net","datatables.net-bs","datatables.net-select"],function(t){setTimeout(function(){for(var x,a=[],e=[],n=function(t,C,h,u){a.push({data:0!=C?u.value+"_$"+C:u.value,title:u.name,render:function(o,t,g){var n,a,e,r,i,d,s,l=function(t){var a=y.getParameter("resourceId"),e="";0!=C&&(e="_$"+C);var n=t["params"+e]?t["params"+e][0].id:"",r=$("<div></div>"),i=$("<span></span>");i.attr("fmtInx",h),1==u.websocket&&i.attr("webSocket",a+","+n);var d=u.style;return d&&i.css(d),i.text(o||"-"),r.append(i),r.html()};return"text"==(t=u.type)?l(g):"date"==t?function(){var t=$("<div></div>"),a=$("<span></span>");a.attr("fmtInx",h);var e=u.style;return e&&a.css(e),a.css("display","inline-block"),o?a.text(new Date(o).FormatByString("年月日时分秒")):a.text("-"),t.append(a),t.html()}():"link"==t?(d=$("<div></div>"),(s=$("<a></a>").text(o||"")).attr("fmtInx",h),s.css("text-decoration","underline"),s.css("cursor","pointer"),d.append(s),d.html()):"progressbar"==t?function(){var t=$("<div></div>"),a=$("<div></div>").addClass("progress sm");a.attr("fmtInx",h);var e=$("<div></div>").addClass("progress-bar").css("width",o||0);switch(a.append(e),!0){case 100==o:e.addClass("progress-bar-aqua");break;case 90<o:e.addClass("progress-bar-green");break;case 80<o:case 70<o:e.addClass("progress-bar-yellow");break;case 60<o:e.addClass("progress-bar-red");break;default:e.addClass("progress-bar-danger")}return t.append(a),t.html()}():"priority"==t?(r=$("<div></div>"),(i=$("<span></span>").addClass("label")).attr("fmtInx",h),1==o?i.text("警告").addClass("alerts-warning"):2==o?i.text("次要").addClass("alerts-minor"):3==o?i.text("重要").addClass("alerts-major"):4==o?i.text("严重").addClass("alerts-critical"):i.text("正常").addClass("alerts-normal").css("background-color","#2eb473"),r.append(i),r.html()):"button"==t?(n=g,a=$("<div></div>"),(e=$("<button></button>").addClass("btn btn-primary").text("全部发送").attr("id","sentAllCommand_"+n.id)).attr("fmtInx",h),$("button[id*=sentAllCommand_"+n.id+"]").on("click",function(t){t.stopPropagation();var a={};for(var e in g.params)a[n.params[e].name]=n.params[e].$value;y.sendItemDirByValue(g.id,a)}),a.append(e),a.html()):"directiveSingle"==t?function(t,a){var e=y.getParameter("resourceId"),n="";if(0!=C&&(n="_$"+C),t["params"+n]){var r=t["params"+n][0].id,i=$("<div></div>"),d=$("<span></span>"),o=$("<div></div>").css("position","relative"),s=$("<div></div>").addClass("input-group"),l=$("<div></div>").addClass("btn btn-default").text(t.name),u=$("<div></div>").addClass("input-group-btn"),c=$("<input />").addClass("form-control").attr("id","inputAll_"+g["id"+n]),p=$("<div></div>").addClass("input-group-btn"),v=$("<button></button>").addClass("btn btn-primary").text("发送").attr("id","sendBtnAll_"+g["id"+n]),f=$("<div></div>").attr("id","ulWrap_"+g["id"+n]).css("display","none");return n="",0!=C&&(n="_$"+C),c.attr("webSocket",e+","+r),o.attr("fmtInx",h),d.addClass("input-group-addon"),d.text("500"),s.css("width","100%"),s.append(c),s.append(p),u.append(l),p.append(v),o.append(s),o.append(f),i.append(o),i.html()}return""}(g):"directiveInput"==t?function(n,t){var r="";0!=C&&(r="_$"+C);var a=$("<div></div>"),e=$("<div></div>").css("position","relative"),i=$("<div></div>").addClass("input-group"),d=$("<div></div>").addClass("btn btn-default").text(n.name),o=$("<div></div>").addClass("input-group-btn"),s=$("<input />").addClass("form-control").attr("id","inputAll_"+g["id"+r]),l=$("<div></div>").addClass("input-group-btn"),u=$("<span></span>").addClass("glyphicon glyphicon-plus-sign").attr("id","icon_"+g["id"+r]),c=$("<button></button>").addClass("btn btn-default").attr("id","plusBtn_"+g["id"+r]),p=$("<button></button>").addClass("btn btn-default").text("发送").attr("id","sendBtnAll_"+g["id"+r]);$("button[id*=sendBtnAll_"+g["id"+r]+"]").on("click",function(t){t.stopPropagation();var a={};for(var e in n.params)a[n.params[e].name]=$("input[id*=inputAll_"+g["id"+r]+"]").val();y.sendItemDirByValue(g.id,a)});var v=$("<div></div>").attr("id","ulWrap_"+g["id"+r]).css("display","none"),f=$("<ul></ul>").css("width","auto").css("box-shadow","1px 1px 10px 1px rgba(0,0,0,.5)").css("border","1px solid #ddd").css("position","absolute").css("list-style","none").css("background-color","#ddd").css("margin",0).css("padding","0px").css("z-index","99999"),m=function(n){var t=y.getParameter("resourceId"),a=n.id,e=$("<li></li>").css("margin","10px"),r=$("<div></div>").addClass("input-group"),i=$("<div></div>").addClass("input-group-addon"),d=$("<div></div>").attr("id","add_"+n.id).addClass("input-group-addon").text("-"),o=$("<div></div>").addClass("input-group-btn"),s=$("<span></span>").text(n.label),l=$("<input />").addClass("form-control").attr("id","input_"+n.id),u=$("<button></button>").addClass("btn btn-primary").text("发送").attr("id","sendBtn_"+n.id);l.css("min-width","60px"),y.getKpiValueCi([t],[a],function(t){$("[id*=add_"+n.id+"]").text(t[0].value)});var c={ciid:[t].toString(),kpi:[a].toString()},p=Math.uuid();k.unregister(p);var v="register";return k.register(p,v,function(t){$("[id*=add_"+n.id+"]").text(t.data.value)}),k.send(p,v,"kpi",c),$("input[id*=input_"+n.id).on("change",function(t){n.$value=$(this).val()}),$("input[id*=input_"+n.id).on("click",function(t){t.stopPropagation()}),$("button[id*=sendBtn_"+n.id).on("click",function(t){x(),t.stopPropagation();var a=$("input[id*=input_"+n.id).val(),e={};e[n.name]=a,y.sendItemDirByValue(g.id,e)}),i.append(s),o.append(u),r.append(i).append(d).append(l).append(o),e.append(r),e};$("div[id*=ulWrap_"+g["id"+r]+"]").on("click",function(t){t.stopPropagation()});r="";for(var b in 0!=C&&(r="_$"+C),n["params"+r])f.append(m(n["params"+r][b]));return e.attr("fmtInx",h),i.append(s),i.append(l),o.append(d),c.append(u),l.append(c),l.append(p),v.append(f),e.append(i),e.append(v),a.append(e),a.html()}(g):l()}}),e.push({targets:t,global:c,data:0!=C?u.value+"_$"+C:u.value})},t=function(t){for(var a in h)n(t*h.length+parseInt(a),t,a,h[a])},r=0;r<v;r++)t(r);var i=function(t){var a,e,n,r,i=[];for(var d in t)e=t[a=d],n=Math.floor(a/v),r=a%v,i[n]||(i[n]={}),function(t,a){for(var e in a)t[e]=a[e]}(i[n],function(t,a){var e={};for(var n in t)e[n+(0!=a?"_$"+a:"")]=t[n];return e}(e,r));return i}(l),d="";d="standard"==p?$.ProudSmart.datatable.footerdom:"none"==p?"":"pageAndTotal"==p?'<"row"<"clo-lg-12">>t<"row footerdom"<"col-lg-4"l><"col-lg-8"p>>':'<"row"<"clo-lg-12">>t<"row footerdom"<"col-lg-12"p>>';var o,s={ordering:v<2,dom:d,language:$.ProudSmart.datatable.language,rowCallback:function(e,n,t){var i=function(d){var o=[],t={};for(var a in d)-1==a.indexOf("_$")&&(t[a]=d[a]);return o.push(t),function t(a){var e={},n="_$"+a,r=!1;for(var i in d)-1!=i.indexOf(n)&&(e[i.split("_$")[0]]=d[i],r=!0);r&&(o.push(e),t(++a))}(1),o}(n);$(e).children().each(function(){var d,t,a,o,e,n=$(this).children();if(0<n.size()){var r=n.attr("fmtInx");"directiveSingle"==h[r].type&&(d=n.find("input"),t=n.find("button"),a=d.attr("id").split("inputAll_")[1],o=i.find(function(t){return t.id==a}),e=h[r].$attr("on/change"),d.val(o.value),d.on("change",function(t){"function"==typeof e&&e({target:y,data:o,value:d.val()})}),t.on("click",function(t){var a=o.params[0].name,e=o.id,n=d.val(),r={};r[a]=n;var i=y.getParameter("resourceId");y.sendDirective(i,e,r,function(t){})}))}}),$(e).off("click"),$(e).on("click",function(t){g.find("tr").removeClass("selected"),$(e).addClass("selected");var a=b.$attr("on/click");a&&a({target:y,global:c,data:n})})},initComplete:function(){var r=[],i=[];g.find("[webSocket]").each(function(t,a){var e=parseInt($(this).attr("webSocket").split(",")[0]),n=parseInt($(this).attr("webSocket").split(",")[1]);-1==r.indexOf(e)&&r.push(e),-1==i.indexOf(n)&&i.push(n)}),y.webSocket(r,i,function(t){var a=t.nodeId,e=t.kpiCode;g.find("span[webSocket*='"+a+","+e+"']").text(t.value);var n=l.find(function(t){if(t.params)return t.params[0].id==e}),r=b.$attr("on/webSocketReturn");if(r)try{r({target:y,global:c,data:n})}catch(t){}})},pageLength:f,data:i,columns:a,columnDefs:e};u&&(u.destroy(),g.empty()),u=g.DataTable(s),m[C]&&g.find("<table></table>").css("color",m[C].$attr("text/color")),x=function(t,a,e){var n=$("[id*=ulWrap]"),r=$("#icon_"+e);n.css("display","none"),r.removeClass("glyphicon-minus-sign").addClass("glyphicon-plus-sign"),$("body").off("click.btn"),setTimeout(function(){$("#plusBtn_"+e).on("click",o)})},o=function(t){t.stopPropagation();var a=$(this).attr("id").split("plusBtn_")[1],e=$("#ulWrap_"+a),n=$("#icon_"+a);e.css("display","block"),$(this).off("click"),n.removeClass("glyphicon-plus-sign").addClass("glyphicon-minus-sign"),setTimeout(function(){$("body").on("click.btn",function(t){x(t,name,a)})})},$("[id*=plusBtn_]").on("click",o),g.css("width","100%")})})};var d=b.$attr("on/init");if("function"==typeof d)try{d({target:y,global:c})}catch(t){"freeStyleCtrl"==a.current.$$route.controller&&r.error("组件［列表］的初始化表达式配置发生错误！")}else!function(){if("simulate"==i){var t=b.$attr("simulate");null==t?t={size:4,formatter:[{label:"label",value:function(t,a){return"设备列表"+t}},{label:"data1",value:function(t,a){return a.random([0,100])}},{label:"data2",value:function(t,a){return a.random([0,100])}},{label:"data3",value:function(t,a){return a.random([0,1])}}]}:null==t.formatter&&(t.formatter=[{label:"label",value:function(t,a){return"设备列表"+t}},{label:"data1",value:function(t,a){return a.random([0,100])}},{label:"data2",value:function(t,a){return a.random([0,100])}},{label:"data3",value:function(t,a){return a.random([0,1])}}]),y.getSimulateList(t,function(t){y.render(t)})}else if("alert"==i)y.getAllAlerts(function(t){y.render(t)});else if("newdevice"==i){var a={domainPath:n.user.domains};y.getDevicesByCondition(a,function(t){y.render(t)})}else"energyType"==i?y.energyTypeList(function(t){y.render(t)}):"currentDirectiveByDevice"==i?y.currentDirective(function(t){y.render(t)}):"currentAlertByDevice"==i?y.getCurrentAlert(function(t){y.render(t)}):"currentDevicesByProject"==i&&y.getCurrentDevices(function(t){y.render(t)})}();return t}});
//# sourceMappingURL=../../map/toolkit/component/dataTable2.js.map
