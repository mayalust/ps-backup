function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["commonMethod"],function(commonMethod){return function(data){var alertView,elemData=data,element=data.element,SwSocket=data.SwSocket,previewMode=data.previewMode,alertService=data.alertService,timeout=data.timeout,serviceCenterService=data.serviceCenterService,resourceUIService=data.resourceUIService,ticketTaskService=data.ticketTaskService,projectUIService=data.projectUIService,kpiDataService=data.kpiDataService,window=data.window,fun=element.advance.getfunction,$controller=data.route.current.$$route.controller,global=data.global,condition;element.getParameter=function(e){if(elemData.routeParam.parameter){var t=JSON.parse(elemData.routeParam.parameter);return t[t.length-1].$attr(e)}return null},Object.defineProperty(element,"dataSource",{enumerable:!1}),$$.runExpression(element.advance.condition,function(funRes){if("0"!=funRes.code)throw new Error(funRes.message);var fnResult=funRes.data;if("function"==typeof fnResult)condition=fnResult(data);else{if(Array.isArray(fnResult))for(key in fnResult[0]){var fnResultAry=fnResult[0][key].split("::");1<fnResultAry.length&&(fnResult[0][key]=eval(fnResultAry[0]).apply(null,[fnResultAry[1]]))}condition=fnResult}condition=condition||{}}),element.getWarningsByProjectId=function(e,n){resourceUIService.getResourceById(e,function(e){if(0==e.code){var t=e.data.domains;alertService.queryFromDb({domain:t},function(e){0==e.code&&n(e.data)})}})},element.getDirectivesByTypeAndRole=function(e,t,n,r){var a={};element.getManagedViewsByTypeAndRole(e,t,n,function(e){JSON.parse(e.content).cells.forEach(function(e){e.directiveIds&&e.directiveIds.forEach(function(e){"string"==typeof e?a[e.split(":")[1]]=!0:a[e]=!0})}),element.getDirectivesByModelId(n,function(e){var t=[];e.forEach(function(e){a[e.id]&&t.push(e)}),t.sort(doubleCompare(["values","index"],"desc")),r(t)})})},element.getResourcesByProjectId=function(e,t){resourceUIService.getDevicesByCondition({projectId:e},function(e){0==e.code&&t(e.data)})},element.getDirectivesByModelId=function(e,t){resourceUIService.getDirectivesByModelId(e,function(e){0==e.code&&t(e.data)})};var innerContent=$("<table></table>").addClass("table table-hover"),expression;$$.runExpression(element.$attr("advance/expression"),function(e){if("0"!=e.code)throw new Error(e.message);var t=e.data;expression=(expression="function"==typeof t?t(data,system):t)||{}});var emptyMsg=expression.emptyMsg,header=$("<thead></thead>"),tbody=$("<tbody></tbody>"),tr=$("<tr></tr>"),q=data.q,getValue=function(e){return"item."+e},getRandom=function(e){var t=/\((\d+),(d+\))/;$$.runRegExp(e,t,1),$$.runRegExp(e,t,2);return parseInt(100*Math.random())+""},getAlertView=function(t){var n=q.defer();return serviceCenterService.views.getAll().then(function(e){alertView=e.find(function(e){return"configAlert"==e.viewType}),n.resolve("alertView."+t)}),n.promise},regExps=[{regExp:/\{item\:(.*)\}/,explainer:getValue},{regExp:/\{random\:(.*)\}/,explainer:getRandom},{regExp:/\{alertView\:(.*)}/,explainer:getAlertView}],addEvents=function(n,r,e,a){var t=function(e,t){previewMode&&("freeBoardCtrl"!=$controller&&n.css("cursor","pointer"),("freeBoardCtrl"!=$controller||expression.event)&&n.on(e,function(e){t({$index:r,jquery:e,global:global,tools:data,ui:element,target:element,data:a})}))};for(var o in e)t(o,e[o])},calculeExp=function calculeExp(str,item){var defer=q.defer();if("string"==typeof str){var defers=[],loop=function(e){var t=q.defer(),n=e.regExp,r=(0,e.explainer)($$.runRegExp(str,n,1));if("object"==_typeof(r)){r.then(function(e){t.resolve("success"),str=str.replace(n,e)})}else t.resolve("success"),str=str.replace(n,r);return t.promise};for(var i in regExps)loop(regExps[i]);q.all(defers).then(function(data){var val=eval(str);defer.resolve(val)})}else{if(null!=str)throw new Error(_typeof(str)+" is not a avaliable type");defer.resolve("")}return defer.promise};element.setFilter=function(o){var e=element.dataSource.filter(function(e){var t,n,r=!1;for(var a in o)n=o[t=a],-1!=e[t].indexOf(n)&&(r=!0);return r});element.render(e,!0)},element.render=function(e,t){1!=t&&(element.dataSource=e),tbody.children().remove(),tr.children().remove();var n;for(var r in expression.format)tr.append((n=expression.format[r],$("<th></th>").text(n.name)));var a,o,s,x=expression.$attr("on/click"),i=function(y,b){var e=$("<tr></tr>"),t=function(e){var t,n,r,a,o,s,i,l,d,c,p,u,f,v,g,m=$("<td></td>");return"text"==e.type?m.append((f=b,v=e,g=$("<span></span>"),calculeExp(v.value,f).then(function(e){g.text(e)}),g)):"date"==e.type?m.append((c=b,p=e,u=$("<span></span>"),calculeExp(p.value,c).then(function(e){if(e){var t=p.style,n=new Date(e),r=n.getMonth()+1,a=n.getFullYear()+"-"+r+"-"+n.getDate()+"  "+(9<n.getHours()?n.getHours():"0"+n.getHours())+":"+(9<n.getMinutes()?n.getMinutes():"0"+n.getMinutes())+":"+(9<n.getSeconds()?n.getSeconds():"0"+n.getSeconds());"object"==_typeof(t)&&u.css(t),u.text(a)}else u.text("")}),u)):"progress"==e.type?m.append(function(e,t){var n=calculeExp(t.value),r=$("<div></div>").addClass("progress sm"),a=$("<div></div>").addClass("progress-bar").css("width",n);switch(r.append(a),!0){case 100==n:a.addClass("progress-bar-aqua");break;case 90<n:a.addClass("progress-bar-green");break;case 80<n:case 70<n:a.addClass("progress-bar-yellow");break;case 60<n:a.addClass("progress-bar-red");break;default:a.addClass("progress-bar-danger")}return r}(0,e)):"status"==e.type?m.append((i=b,l=e,d=$("<span></span>").addClass("label label-info"),calculeExp(l.value,i).then(function(e){return 0==e?d.text("新产生").addClass("label-info"):5==e?d.text("已确认").addClass("label-primary"):10==e?d.text("处理中").addClass("label-warning"):20==e?d.text("已解决").addClass("label-success"):d.text("已忽略").addClass(""),d}),d)):"priority"==e.type?m.append((r=b,a=e,o=$("<span></span>").addClass("label"),s=a.style,calculeExp(a.value,r).then(function(e){return 1==e?o.text("警告").addClass("alerts-warning"):2==e?o.text("次要").addClass("alerts-minor"):3==e?o.text("重要").addClass("alerts-major"):4==e&&o.text("严重").addClass("alerts-critical"),o}),"object"==_typeof(s)&&o.css(s),o)):"input"==e.type?m.append($("<input type='text'>").addClass("form-control input-sm")):"button"==e.type?m.append((t=b,(n=$("<button type='button'>全部发送</button>").addClass("btn btn-default btn-sm")).on("click",function(e){e.stopPropagation(),x&&x({target:element,clickType:"inline-button",ui:e,data:t})}),n)):"multiCheckList"==e.type&&m.append(function(v,e){var t=$("<div></div>").css("position","relative"),n=$("<div></div>").addClass("input-group"),r=$("<div></div>").addClass("btn btn-default").text(v.name),a=$("<div></div>").addClass("input-group-btn"),o=$("<input />").addClass("form-control"),s=$("<div></div>").addClass("input-group-btn"),i=$("<span></span>").addClass("glyphicon glyphicon-plus-sign"),l=$("<button></button>").addClass("btn btn-default"),d=$("<button></button>").addClass("btn btn-default").text("发送");d.on("click",function(e){e.stopPropagation(),x&&x({target:element,clickType:"outterBtn",ui:e,data:v,value:o.val()})});var g,c,p=$("<div></div>").css("display","none"),u=$("<ul></ul>").css("width","auto").css("box-shadow","1px 1px 10px 1px rgba(0,0,0,.5)").css("border","1px solid #ddd").css("position","absolute").css("list-style","none").css("background-color","#ddd").css("margin",0).css("padding","0px").css("z-index","99999"),f=function(t){var e=element.getParameter("resourceId"),n=t.id,r=$("<li></li>").css("margin","10px"),a=$("<div></div>").addClass("input-group"),o=$("<div></div>").addClass("input-group-addon"),s=$("<div></div>").addClass("input-group-addon").text("-"),i=$("<div></div>").addClass("input-group-btn"),l=$("<span></span>").text(t.label),d=$("<input />").addClass("form-control"),c=$("<button></button>").addClass("btn btn-primary").text("发送");d.css("min-width","60px"),element.getKpiValueCi([e],[n],function(e){e[0]?s.text(e[0].value):s.text("-")});var p={ciid:[e].toString(),kpi:[n].toString()},u=Math.uuid();SwSocket.unregister(u);var f="register";return SwSocket.register(u,f,function(e){s.text(e.data.value)}),SwSocket.send(u,f,"kpi",p),d.on("change",function(e){t.$value=d.val()}),c.on("click",function(e){g(),e.stopPropagation(),x&&x({clickType:"innerBtn",target:element,ui:e,data:v,param:t,value:d.val()})}),o.append(l),i.append(c),a.append(o).append(s).append(d).append(i),r.append(a),r};for(var m in p.on("click",function(e){e.stopPropagation()}),g=function(e){p.css("display","none"),i.removeClass("glyphicon-minus-sign").addClass("glyphicon-plus-sign"),$("body").off("click.btn"),timeout(function(){l.on("click.btn",c)})},c=function(e){p.css("display","block"),l.off("click.btn"),i.removeClass("glyphicon-plus-sign").addClass("glyphicon-minus-sign"),timeout(function(){$("body").on("click.btn",g)})},l.on("click.btn",c),v.params)u.append(f(v.params[m]));return n.append(o),n.append(s),a.append(r),l.append(i),s.append(l),s.append(d),p.append(u),t.append(n),t.append(p),t}(b)),addEvents(m,y,e.on,b),m};for(var n in expression.format)e.append(t(expression.format[n]));return addEvents(e,y,expression.on,b),previewMode&&expression.$attr("on/click")&&"freeBoardCtrl"!=$controller&&e.css("cursor","pointer"),e};if(0==e.length)0!=emptyMsg&&tbody.append((a=$("<tr></tr>"),o=expression.format.length,s=$("<td></td>").text("没有符合条件的记录。").attr("colspan",o).css("text-align","center").css("line-height","40px"),a.append(s),a));else for(r=0;r<e.length;r++){var l=!0;"function"==typeof expression.filter&&(l=expression.filter({global:global,tools:e},e[r])),l&&tbody.append(i(r,e[r]))}},header.append(tr),innerContent.css("width","calc( 100% - 20px)"),element.style&&innerContent.css(element.style),innerContent.append(header).append(tbody);var start=function(){var e=element.$attr("advance/getListTable");"newdevice"==e?element.getLatestDevices(function(e){element.render(e)}):"workorder"==e?element.getTicketsByStatus(function(e){element.render(e)}):"allprojects"==e?element.getCurrentProjectsByCustom(function(e){element.render(e)}):"allprojectsbydomain"==e?element.getCurrentProjects(function(e){element.render(e)}):"alert"==e?element.getAlerts(function(e){element.render(e)}):"currentDirectiveByDevice"==e?element.currentDirective(function(e){element.render(e)}):"currentAlertByDevice"==e?element.getCurrentAlert(function(e){element.render(e)}):"currentAlertByProject"==e&&element.getCurrentAlertByProject(function(e){element.render(e)})},initFn=expression.$attr("on/init");return"function"==typeof initFn?initFn({target:element,self:element,global:global,tools:elemData}):start(),innerContent}});
//# sourceMappingURL=../../map/toolkit/component/listTable.js.map
