define([],function(){var s,u,l,f,o=function(o){var r=this,a=o.mapDom,p=o.mapStyle;f=o.$attr("popupTrigger"),s=o.$attr("init"),u=o.$attr("click"),l=o.$attr("infoWindowOpen");var e;e=function(i){setTimeout(function(){var n,t,o=a.attr("id"),e=new i.Map(o);e.setMapStyle({styleJson:p}),(r._map=e).addEventListener("zoomend",function(o){r.renderMarkers(),r.renderPolygons()}),"function"==typeof s&&s({target:a}),n=function(){a.find(".anchorBL").remove()},t=0,function o(){t+=1,setTimeout(function(){t<200&&a.find(".anchorBL").size()<2?o():n()})}()})},require(["baiduMap","bmap"],function(o,n){var t=0;!function o(){if(!(t<20))throw new Error("百度视图获取失败!!");t+=1,setTimeout(function(){null==window.BMap?o():e(window.BMap)})}()},function(){e()}),this._markGroup=[],this._polygonGroup=[],this._symbolGroup=[]};return o.prototype.centerAndZoom=function(o,n){var t=this._map;o=new BMap.Point(o[0],o[1]);t.centerAndZoom(o,n)},o.prototype.enableScrollWheelZoom=function(o){this._map.enableScrollWheelZoom(o)},o.prototype.setZoom=function(o){var n=this._map;setTimeout(function(){n.closeInfoWindow()}),n.setZoom(o)},o.prototype.setCenter=function(o){var n=this._map,t=new BMap.Point(o[0],o[1]);n.setCenter(t)},o.prototype.openInfoWindow=function(o){var n=new BMap.Point(o.lng,o.lat),t=this._map,e=(o.infoWindow||{}).html,i={width:o.infoWindow.width?o.infoWindow.width:150,height:o.infoWindow.height?o.infoWindow.height:180,title:o.infoWindow.title?o.infoWindow.title:"信息窗口",offset:new BMap.Size(5,-30)},r=new BMap.InfoWindow(e,i);t.openInfoWindow(r,n),setTimeout(function(){"function"==typeof l&&l({data:o,html:r.getContent()})})},o.prototype.setMapStyle=function(o){this._map.setMapStyle({styleJson:o})},o.prototype.addSquare=function(o){var n=this,t=this._map,e=(o=new BMap.Point(o.lng,o.lat),new BMap.Point(o.lng,o.lat)),i=new BMap.Icon("../images/baidumap/sqare.png",new BMap.Size(50,50)),r=new BMap.Marker(e,{icon:i,enableClicking:!0,enableMassClear:!0});n._maskGroup=n._maskGroup||[],n._maskGroup.push(r);for(var a=0;a<n._maskGroup.length;a++)t.removeOverlay(n._maskGroup[a]);t.addOverlay(r)},o.prototype.addMarker=function(n){var t=this,e=this._map,o=new BMap.Point(n.lng,n.lat),i=n.$attr("icon/normal")||null,r=n.$attr("symbol/normal")||null,a={};if(i){var p=new BMap.Size(i.width,i.height),s={size:p,imageSize:new BMap.Size(i.width,i.height)};a=new BMap.Icon(i.url,p,s)}else if(r){var l={rotation:r.rotate||0,fillColor:"yellow",strokeColor:"#000",strokeWeight:1,fillOpacity:1};a=new BMap.Symbol(function(o){var n,t,e="";for(var i in o)t=o[n=i],0==n?e+="M"+t[0]+" "+t[1]+" ":n==o.length-1?e+="L"+t[0]+" "+t[1]+" Z":e+="L"+t[0]+" "+t[1]+" ";return"d='"+e+"'"}([[-10,15],[10,15],[0,-15],[-10,15]]),l)}var m={};m.title=n.title,m.icon=a,m.rotation=n.rotation;var d=new BMap.Marker(o,m);d.id=n.id,d.minZoom=n.minZoom,d.maxZoom=n.maxZoom,d.iconObj=n.icon,d.symbolObj=n.symbol,d._point=n,d.setZIndex(0);var h=function(){e.closeInfoWindow()};d.addEventListener("mouseover",function(){"mouseover"==f&&t.openInfoWindow(n)}),d.addEventListener("click",function(o){if(u)try{u({data:n})}catch(o){}"mouseover"==f?h():"click"==f&&(void e.getInfoWindow()?h():t.openInfoWindow(n))}),this._markGroup.push(d),this.renderMarkers()},o.prototype.addPolygon=function(n){var t=this,e=this._map,o=new BMap.Point(n.lng,n.lat),i=new BMap.Polygon(o,{fillColor:"yellow",strokeColor:"#000",strokeWeight:1,fillOpacity:1});i.minZoom=n.minZoom,i.maxZoom=n.maxZoom,i._point=n,i.setPath(function(o,n,t,e){var i,r,a,p,s,l=e/180*Math.PI,m=[];for(var d in t)m.push((i=t[d],r=.7*i[0],a=1.4*i[1],p=r*Math.cos(l)+a*Math.sin(l),s=a*Math.cos(l)-r*Math.sin(l),new BMap.Point(o+p,n+s)));return m}(n.lng,n.lat,n.path,n.rotate)),this._polygonGroup.push(i),i.addEventListener("mouseover",function(o){t.openInfoWindow(n)}),i.addEventListener("mouseout",function(){}),i.addEventListener("click",function(o){if(e.closeInfoWindow(),u)try{u({data:n})}catch(o){}}),this.renderPolygons()},o.prototype.setHighlightByMakerId=function(s){var l=this,m=0;!function o(n){var t=l._markGroup[n];if(t){var e=t.id==s?"highlight":"normal";if(t.iconObj){var i=t.iconObj[e]||null,r=new BMap.Size(i.width,i.height),a={size:r,imageSize:new BMap.Size(i.width,i.height)},p=new BMap.Icon(i.url,r,a);t.setIcon(p),"highlight"==e?(t.setZIndex(l._markGroup.length),l.openInfoWindow(t._point)):(t.setZIndex(m),m++),o(++n)}else t.symbolObj&&("highlight"==e&&setTimeout(function(){l.openInfoWindow(t._point),l._map.setCenter(t.point)}),o(++n))}}(0),this.render()},o.prototype.render=function(){this.renderPolygons(),this.renderMarkers(),this.renderSymbols()},o.prototype.addMarkers=function(o){for(var n in o)this.addMarker(o[n])},o.prototype.addPolygons=function(o){for(var n in o)this.addPolygon(o[n])},o.prototype.addSymbols=function(o){for(var n in o)this.addSymbol(o[n])},o.prototype.renderPolygons=function(){var o,n,t=this,e=this._map;for(var i in this._polygonGroup)o=this._polygonGroup[i],void 0,(n=t._map.getZoom())>o.minZoom&&n<=o.maxZoom?e.addOverlay(o):e.removeOverlay(o)},o.prototype.renderMarkers=function(){var o,n,t=this,e=this._map;for(var i in this._markGroup)o=this._markGroup[i],void 0,(n=t._map.getZoom())>o.minZoom&&n<=o.maxZoom?e.addOverlay(o):e.removeOverlay(o)},o.prototype.renderSymbols=function(){var o,n,t=this,e=this._map;for(var i in this._symbolGroup)o=this._symbolGroup[i],void 0,(n=t._map.getZoom())>o.minZoom&&n<=o.maxZoom?e.addOverlay(o):e.removeOverlay(o)},o});
//# sourceMappingURL=../../map/toolkit/component/BMapLib.js.map
