define(["commonMethod","configs"],function(t){return function(e){var l,t=e,a=e.route,y=e.element,k=e.SwSocket,n=(e.previewMode,e.alertService,e.userLoginUIService),r=(e.growl,e.serviceCenterService,e.dictionaryService,e.resourceUIService,e.ticketTaskService,e.projectUIService,e.kpiDataService,e.window,y.advance.getfunction,y.$attr("advance/getListTable")),p=e.global,u=y.$attr("parameters/listbottom"),c=y.$attr("parameters/col")||1,v=y.$attr("parameters/pageSize");Object.defineProperty(y,"dataSource",{enumerable:!1});var i=$("<div></div>");i.css("width","100%"),i.css("overflow","auto");var f,m=$("<table></table>").addClass("table table-hover");i.append(m),$$.runExpression(y.$attr("advance/expression"),function(t){if("0"==t.code){var a=t.data;f=(f="function"==typeof a?a(e,system):a)||{}}else f={}});var b=f.format;e.q;y.setFilter=function(t){},y.setFormat=function(t){b=t},y.render=function(o){$$.loadExternalJs(["datatables.net","datatables.net-bs","datatables.net-select"],function(t){setTimeout(function(){for(var h,a=[],e=[],n=function(t,C,x,f){a.push({data:0!=C?f.value+"_$"+C:f.value,title:f.name,render:function(s,t,g){var a,e,n,r,i,d,o,l,p,u,c,v=function(t){var a=y.getParameter("resourceId"),e="";0!=C&&(e="_$"+C);var n=t["params"+e]?t["params"+e][0].id:"",r=$("<div></div>"),i=$("<span></span>");i.attr("fmtInx",x),1==f.websocket&&i.attr("webSocket",a+","+n);var d=f.style;return d&&i.css(d),i.text(s||"-"),r.append(i),r.html()};return"text"==(t=f.type)?v(g):"date"==t?function(){var t=$("<div></div>"),a=$("<span></span>");a.attr("fmtInx",x);var e=f.style;return e&&a.css(e),a.css("display","inline-block"),s?a.text(new Date(s).FormatByString("年月日时分秒")):a.text("-"),t.append(a),t.html()}():"link"==t?(u=$("<div></div>"),(c=$("<a></a>").text(s||"")).attr("fmtInx",x),c.css("text-decoration","underline"),c.css("cursor","pointer"),u.append(c),u.html()):"progressbar"==t?function(){var t=$("<div></div>"),a=$("<div></div>").addClass("progress sm");a.attr("fmtInx",x);var e=$("<div></div>").addClass("progress-bar").css("width",s||0);switch(a.append(e),!0){case 100==s:e.addClass("progress-bar-aqua");break;case 90<s:e.addClass("progress-bar-green");break;case 80<s:case 70<s:e.addClass("progress-bar-yellow");break;case 60<s:e.addClass("progress-bar-red");break;default:e.addClass("progress-bar-danger")}return t.append(a),t.html()}():"status"==t?(l=$("<div></div>"),(p=$("<span></span>").addClass("label")).attr("fmtInx",x),0==s?p.text("新产生").addClass("label-info"):5==s?p.text("已确认").addClass("label-primary"):10==s?p.text("处理中").addClass("label-warning"):20==s?p.text("已解决").addClass("label-success"):p.text("已忽略").addClass(""),l.append(p),l.html()):"priority"==t?(d=$("<div></div>"),(o=$("<span></span>").addClass("label")).attr("fmtInx",x),1==s?o.text("警告").addClass("alerts-warning"):2==s?o.text("次要").addClass("alerts-minor"):3==s?o.text("重要").addClass("alerts-major"):4==s?o.text("严重").addClass("alerts-critical"):o.text("正常").addClass("alerts-normal").css("background-color","#2eb473"),d.append(o),d.html()):"button"==t?(n=g,r=$("<div></div>"),(i=$("<button></button>").addClass("btn btn-primary").text("全部发送").attr("id","sentAllCommand_"+n.id)).attr("fmtInx",x),$("button[id*=sentAllCommand_"+n.id+"]").on("click",function(t){t.stopPropagation();var a={};for(var e in g.params)a[n.params[e].name]=n.params[e].$value;y.sendItemDirByValue(g.id,a)}),r.append(i),r.html()):"alarmSource"==t?(a=$("<div></div>"),(e=$("<span></span>").addClass("label")).attr("fmtInx",x),1==s?e.text("在线预警").addClass("alerts-major"):2==s?e.text("智能诊断").addClass("alerts-minor"):3==s?e.text("大数据分析").addClass("alerts-warning"):4==s&&e.text("离线诊断").addClass("alerts-critical"),a.append(e),a.html()):"directiveSingle"==t?function(t,a){var e=y.getParameter("resourceId"),n="";if(0!=C&&(n="_$"+C),t["params"+n]){var r=t["params"+n][0].id,i=$("<div></div>"),d=$("<span></span>"),s=$("<div></div>").css("position","relative"),o=$("<div></div>").addClass("input-group"),l=$("<div></div>").addClass("btn btn-default").text(t.name),p=$("<div></div>").addClass("input-group-btn"),u=$("<input />").addClass("form-control").attr("id","inputAll_"+g["id"+n]),c=$("<div></div>").addClass("input-group-btn"),v=$("<button></button>").addClass("btn btn-primary").text("发送").attr("id","sendBtnAll_"+g["id"+n]),f=$("<div></div>").attr("id","ulWrap_"+g["id"+n]).css("display","none");return n="",0!=C&&(n="_$"+C),u.attr("webSocket",e+","+r),s.attr("fmtInx",x),d.addClass("input-group-addon"),d.text("500"),o.css("width","100%"),o.append(u),o.append(c),p.append(l),c.append(v),s.append(o),s.append(f),i.append(s),i.html()}return""}(g):"directiveInput"==t?function(n,t){var r="";0!=C&&(r="_$"+C);var a=$("<div></div>"),e=$("<div></div>").css("position","relative"),i=$("<div></div>").addClass("input-group"),d=$("<div></div>").addClass("btn btn-default").text(n.name),s=$("<div></div>").addClass("input-group-btn"),o=$("<input />").addClass("form-control").attr("id","inputAll_"+g["id"+r]),l=$("<div></div>").addClass("input-group-btn"),p=$("<span></span>").addClass("glyphicon glyphicon-plus-sign").attr("id","icon_"+g["id"+r]),u=$("<button></button>").addClass("btn btn-default").attr("id","plusBtn_"+g["id"+r]),c=$("<button></button>").addClass("btn btn-default").text("发送").attr("id","sendBtnAll_"+g["id"+r]);$("button[id*=sendBtnAll_"+g["id"+r]+"]").on("click",function(t){t.stopPropagation();var a={};for(var e in n.params)a[n.params[e].name]=$("input[id*=inputAll_"+g["id"+r]+"]").val();y.sendItemDirByValue(g.id,a)});var v=$("<div></div>").attr("id","ulWrap_"+g["id"+r]).css("display","none"),f=$("<ul></ul>").css("width","auto").css("box-shadow","1px 1px 10px 1px rgba(0,0,0,.5)").css("border","1px solid #ddd").css("position","absolute").css("list-style","none").css("background-color","#ddd").css("margin",0).css("padding","0px").css("z-index","99999"),m=function(n){var t=y.getParameter("resourceId"),a=n.id,e=$("<li></li>").css("margin","10px"),r=$("<div></div>").addClass("input-group"),i=$("<div></div>").addClass("input-group-addon"),d=$("<div></div>").attr("id","add_"+n.id).addClass("input-group-addon").text("-"),s=$("<div></div>").addClass("input-group-btn"),o=$("<span></span>").text(n.label),l=$("<input />").addClass("form-control").attr("id","input_"+n.id),p=$("<button></button>").addClass("btn btn-primary").text("发送").attr("id","sendBtn_"+n.id);l.css("min-width","60px"),y.getKpiValueCi([t],[a],function(t){$("[id*=add_"+n.id+"]").text(t[0].value)});var u={ciid:[t].toString(),kpi:[a].toString()},c=Math.uuid();k.unregister(c);var v="register";return k.register(c,v,function(t){$("[id*=add_"+n.id+"]").text(t.data.value)}),k.send(c,v,"kpi",u),$("input[id*=input_"+n.id).on("change",function(t){n.$value=$(this).val()}),$("input[id*=input_"+n.id).on("click",function(t){t.stopPropagation()}),$("button[id*=sendBtn_"+n.id).on("click",function(t){h(),t.stopPropagation();var a=$("input[id*=input_"+n.id).val(),e={};e[n.name]=a,y.sendItemDirByValue(g.id,e)}),i.append(o),s.append(p),r.append(i).append(d).append(l).append(s),e.append(r),e};$("div[id*=ulWrap_"+g["id"+r]+"]").on("click",function(t){t.stopPropagation()});r="";for(var b in 0!=C&&(r="_$"+C),n["params"+r])f.append(m(n["params"+r][b]));return e.attr("fmtInx",x),i.append(o),i.append(l),s.append(d),u.append(p),l.append(u),l.append(c),v.append(f),e.append(i),e.append(v),a.append(e),a.html()}(g):v()}}),e.push({targets:t,global:p,data:0!=C?f.value+"_$"+C:f.value})},t=function(t){for(var a in b)n(t*b.length+parseInt(a),t,a,b[a])},r=0;r<c;r++)t(r);var i,d=function(t){var a,e,n,r,i=[];for(var d in t)e=t[a=d],n=Math.floor(a/c),r=a%c,i[n]||(i[n]={}),function(t,a){for(var e in a)t[e]=a[e]}(i[n],function(t,a){var e={};for(var n in t)e[n+(0!=a?"_$"+a:"")]=t[n];return e}(e,r));return i}(o),s={dom:"standard"==u?$.ProudSmart.datatable.footerdom:"none"==u?"":"pageAndTotal"==u?'<"row"<"clo-lg-12">>t<"row footerdom"<"col-lg-4"l><"col-lg-8"p>>':'<"row"<"clo-lg-12">>t<"row footerdom"<"col-lg-12"p>>',language:$.ProudSmart.datatable.language,rowCallback:function(e,n,t){var i=function(d){var s=[],t={};for(var a in d)-1==a.indexOf("_$")&&(t[a]=d[a]);return s.push(t),function t(a){var e={},n="_$"+a,r=!1;for(var i in d)-1!=i.indexOf(n)&&(e[i.split("_$")[0]]=d[i],r=!0);r&&(s.push(e),t(++a))}(1),s}(n);$(e).children().each(function(){var d,t,a,s,e,n=$(this).children();if(0<n.size()){var r=n.attr("fmtInx");"directiveSingle"==b[r].type&&(d=n.find("input"),t=n.find("button"),a=d.attr("id").split("inputAll_")[1],s=i.find(function(t){return t.id==a}),e=b[r].$attr("on/change"),d.val(s.value),d.on("change",function(t){"function"==typeof e&&e({target:y,data:s,value:d.val()})}),t.on("click",function(t){var a=s.params[0].name,e=s.id,n=d.val(),r={};r[a]=n;var i=y.getParameter("resourceId");y.sendDirective(i,e,r,function(t){})}))}}),$(e).off("click"),$(e).on("click",function(t){m.find("tr").removeClass("selected"),$(e).addClass("selected");var a=f.$attr("on/click");a&&a({target:y,global:p,data:n})})},initComplete:function(){var r=[],i=[];m.find("[webSocket]").each(function(t,a){var e=parseInt($(this).attr("webSocket").split(",")[0]),n=parseInt($(this).attr("webSocket").split(",")[1]);-1==r.indexOf(e)&&r.push(e),-1==i.indexOf(n)&&i.push(n)}),y.webSocket(r,i,function(t){var a=t.nodeId,e=t.kpiCode;m.find("span[webSocket*='"+a+","+e+"']").text(t.value);var n=o.find(function(t){if(t.params)return t.params[0].id==e}),r=f.$attr("on/webSocketReturn");if(r)try{r({target:y,global:p,data:n})}catch(t){}})},pageLength:v,data:d,columns:a,ordering:!1,columnDefs:e};l&&(l.destroy(),m.empty()),l=m.DataTable(s),h=function(t,a,e){var n=$("[id*=ulWrap]"),r=$("#icon_"+e);n.css("display","none"),r.removeClass("glyphicon-minus-sign").addClass("glyphicon-plus-sign"),$("body").off("click.btn"),setTimeout(function(){$("#plusBtn_"+e).on("click",i)})},i=function(t){t.stopPropagation();var a=$(this).attr("id").split("plusBtn_")[1],e=$("#ulWrap_"+a),n=$("#icon_"+a);e.css("display","block"),$(this).off("click"),n.removeClass("glyphicon-plus-sign").addClass("glyphicon-minus-sign"),setTimeout(function(){$("body").on("click.btn",function(t){h(t,name,a)})})},$("[id*=plusBtn_]").on("click",i),m.css("width","100%")})})};var d=f.$attr("on/init");if("function"==typeof d)try{d({target:y,global:p,tools:t})}catch(t){a.current.$$route.controller}else!function(){if("simulate"==r){var t=f.$attr("simulate");null==t?t={size:4,formatter:[{label:"label",value:function(t,a){return"设备列表"+t}},{label:"data1",value:function(t,a){return a.random([0,100])}},{label:"data2",value:function(t,a){return a.random([0,100])}},{label:"data3",value:function(t,a){return a.random([0,1])}}]}:null==t.formatter&&(t.formatter=[{label:"label",value:function(t,a){return"设备列表"+t}},{label:"data1",value:function(t,a){return a.random([0,100])}},{label:"data2",value:function(t,a){return a.random([0,100])}},{label:"data3",value:function(t,a){return a.random([0,1])}}]),y.getSimulateList(t,function(t){y.render(t)})}else if("alert"==r)y.getAllAlerts(function(t){y.render(t)});else if("newdevice"==r){var a={domainPath:n.user.domains};y.getDevicesByCondition(a,function(t){y.render(t)})}else"energyType"==r?y.energyTypeList(function(t){y.render(t)}):"currentDirectiveByDevice"==r?y.currentDirective(function(t){y.render(t)}):"currentAlertByDevice"==r?y.getCurrentAlert(function(t){y.render(t)}):"currentDevicesByProject"==r&&y.getCurrentDevices(function(t){y.render(t)})}();return i}});
//# sourceMappingURL=../../map/toolkit/component/dataTable.js.map
