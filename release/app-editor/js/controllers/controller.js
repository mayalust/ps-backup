function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["app","dom","codeMirrorEditor","profile","commonlib"],function(e,U,_,J,M){e.controller("loginController",["$scope","$rootScope","loginManagement",function(e,t,n){t.loading=void 0,e.loginList=[{name:"18701650256",password:"@WSX3edc"},{name:"15652797278",password:"@WSX3edc"},{name:"zhaoyanping@proudsmart.com",password:"@WSX3edc"},{name:"standard",password:"abc123"},{name:"394160008@qq.com",password:"@WSX3edc"},{name:"zhangjiang79@qq.com",password:"1q2w3e4r"},{name:"adomain@test.com",password:"1q2w3e4r"},{name:"1203538033@qq.com",password:"lin664181"},{name:"18611560122",password:"abc123"}],e.sitem=e.loginList[0],e.login=function(e){n.login(e)}}]),e.controller("mainController",["$scope","$rootScope","$window","$timeout","styleList","timeformatList","toolBarList","optionType","loginManagement","dataManagement","userInfo","units","viewFlexService","solutionUIService","resourceUIService",function(m,e,t,c,n,p,o,i,a,g,r,l,d,v,h){var k,y,s,u,f;function S(e,t){var n=(k=e).modelId,o=$(t.target).val(),i=m.modelSelect.kpis.getData().filter(function(e){return e.checked}),a=m.resources.filter(function(e){return e.id==o});D({formatStr:m.timeformat.formatStr,format:m.timeformat.value,category:m.category,dataType:m.dataType,modelId:n,timespan:parseInt(m.timespan),_option_:k.baseOption,data:{nodes:a,kpis:i}})}function b(){var o=U.saveData();if(m.solutionId&&(o.solutionId=m.solutionId,o.groupId=m.groupId,o.smodelId=m.smodelId),o.errorMsg){m.msg={title:"未绑定数据",content:"有视图未绑定数据",btnlist:[{text:"关闭",fn:function(){m.msg="",U.setFocus()}}]}}else{if(function(e){var t=o.title;for(var n in m.allMyView)if(t==m.allMyView[n].viewTitle&&y!=m.allMyView[n].viewId)return!0;return!1}()){m.msg={title:"视图重名",content:"当前视图名称已被占用，请修改",btnlist:[{text:"关闭",fn:function(){m.msg="",U.setFocus()}}]}}else{m.saveloading=!0,null==y?g.saveData(o,function(e){0==e.code?(c(function(){m.saveloading=!1,m.callbackmsg="数据保存成功",m.dirty=!1,c(function(){m.callbackmsg=void 0},1e3)},1e3),y=e.data.viewId):10020==e.code?(alert("需要用户登录才能使用"),t.location.href=e.data):c(function(){m.saveloading=!1,m.callbackmsg=e.message,c(function(){m.callbackmsg=void 0},1e3)},1e3)}):g.updateView(y,o,function(e){0==e.code?(y=e.data.viewId,c(function(){m.saveloading=!1,m.callbackmsg="数据更新成功",m.dirty=!1,c(function(){m.callbackmsg=void 0},1e3)},1e3)):10020==e.code?(alert("需要用户登录才能使用"),t.location.href=e.data):c(function(){m.saveloading=!1,m.callbackmsg=e.message,c(function(){m.callbackmsg=void 0},1e3)},1e3)})}}}function I(){var e={title:"title",elements:U.saveData().data};v.saveModelDashboardViewContent(m.solutionId,m.groupId,m.smodelId,JSON.stringify(e),function(e){t.location.href="../app-ac/index.html#/myView"})}function w(){m.selectData=[];var n,e=m.modelShow;for(var t in e.resources)for(var o in e.kpis)if(e.resources[t].checked&&e.kpis[o].checked){var i=e.resources[t].label+"("+e.kpis[o].label+")";6<i.length&&(i=i.slice(0,4)+"...");for(var a=1;n=i,function(e){for(var t in e)if(e[t].value==n)return!0;return!1}(m.selectData);){var r=i.slice(-3,-2),c=i.slice(-1);if("("==r&&")"==c){var l=i.slice(0,-3);i=l+="("+a+")"}else i+="("+a+")";a++}m.selectData.push({nodeId:e.resources[t].id,name:e.kpis[o].name,kpiId:e.kpis[o].id,value:i})}switch(m.mainTitle=m.modelShow.label,m.type){case"line":m.subTitle="线状视图";break;case"bar":m.subTitle="柱状视图";break;case"pie":m.subTitle="饼状视图";break;case"gauge":m.subTitle="告警视图"}}function D(e){var t=e.data.nodes;t&&(!t instanceof Array||0==t.length)&&(t=void 0);var n=e.data.kpis,o=e.formatStr,i=e.format,a=e.category,r=e.modelId,c=e.timespan,l=e.dataType,d=e._option_,s=function(e){var t=[];for(var n in e)t.push(e[n].id);return t}(t),u=function(e){var t=[];for(var n in e)t.push(e[n].id);return t}(n),f=m.resources.filter(function(e){return e.modelId==r});k.setNodeKpiList({formatStr:o,category:a,modelId:r,nodes:s,kpis:u,resources:f,timespan:c}),k.startloading(),g.getOptionData(l,a,i,d,t,n,60*c*1e3,function(e){k.stoploading(),function(e){e.legend&&"false"==e.legend.show&&delete e.legend;k.changeOption(e,m.theme,!0)}(e.option)})}function O(e,t,n){if(k&&e){var o=JSON.parse(JSON.stringify(e));o.legend&&"false"==o.legend.show&&delete o.legend,k.changeOption(o,n.theme,!0)}}function T(e,t,n){e.legend&&"false"==e.legend.show&&delete e.legend,t.changeOption(e,m.theme,!0,n)}function C(e,t,n){if(k&&e){var o=JSON.parse(JSON.stringify(e));o.legend&&"false"==o.legend.show&&delete o.legend,k.changeOption(o,n.theme,!0)}}function N(e,t,n){k&&e&&k.changeTheme(e,n.option)}e.loading=!1,m.callbackmsg="获取资源列表",m.toolbarDetail="",m.modelShow="",m.mainTitle="",m.subTitle="",m.oldNodeId=void 0,m.oldUnit=void 0,m.selectData=[],m.chartTab="MAIN",m.callbackmsg=!1,m.dirty=!1,m.select=!1,m.psetting=!1,m.newopen=!1,m.codeView=!1,m.errorMsg=function(e,t){var n,o="",i="";t&&t.limit&&(n=t.limit.ci,t.limit.kpi);modelnum=function(e){var t=0;if(e)for(var n in e.resources)1==e.resources[n].checked&&t++;return t}(e),kpinum=function(e){var t=0;if(e)for(var n in e.kpis)1==e.kpis[n].checked&&t++;return t}(e),0<modelnum?n&&(o=n==modelnum?"":" [ 此视图需要"+n+"个设备 ] "):o=" [ 设备不能为空 ] ";0<kpinum?n&&(i=n==kpinum?"":" [ 此视图需要"+n+"个指标 ] "):i=" [ 指标不能为空 ] ";return""!=o&&""!=i?o+","+i:""==o&&""!=i?i:""!=o&&""==i?o:""},m.toolBarList=o,m.optionEdit=i,m.subList=i[0].sub,m.content=i[0].sub[0].content,m.timeformat=p[0],m.timeformatList=p,m.styleList=n,m.settingClick=function(){U.pagesetting(),m.psetting=!0},m.submitDataChange=function(){var e=JSON.parse(_.getValue());U.enableScroll(),m.codeSource=e,m.codeView=!1},m.cancelDataChange=function(){U.enableScroll(),m.codeView=!1},m.toolbarClick=function(e){m.toolbarDetail=e},m.chartPop_click=function(){m.toolbarDetail=""},m.clickMainTitle=function(e){m.mainTitle=e.id,m.subList=e.sub,m.subTitle=0,m.content=m.subList[0].content},m.clickSubTitle=function(e){m.subTitle=e.id,m.content=e.content},m.testClick=function(){m.option.title.text="asdasd"},m.subresourceClick=function(e){e.checked=!e.checked||!e.checked},m.filterByType=function(e){return!m.type||-1!=e.display.indexOf(m.type)},m.back=function(){if(m.dirty){var n=U.saveData();U.disableScroll(),m.msg={title:"当前视图尚未保存",content:"是否不保存，直接退出！",btnlist:[{text:"取消",fn:function(){m.msg=void 0}},{text:"保存退出",fn:function(){function e(){function e(e){m.msg=void 0,a.back()}function t(e){m.msg=void 0,a.back()}m.solutionId?I():null==y?g.saveData(n,e):g.updateView(y,n,t)}m.msg={loading:"数据保存中请稍后"},c(e,1e3)}},{text:"直接退出",fn:function(){m.solutionId?t.location.href="../app-ac/index.html#/myView":a.back(),m.msg=""}}]}}else m.solutionId?t.location.href="../app-ac/index.html#/myView":a.back()},m.resourceClick=function(e){e.checked?e.checked=!1:e.checked=!0;var t=m.modelSelect.resources.getData().filter(function(e){return e.checked}),n=m.modelSelect.kpis.getData().filter(function(e){return e.checked});0<t.length&&0<n.length&&D({formatStr:m.timeformat.formatStr,format:m.timeformat.value,category:m.category,dataType:m.dataType,modelId:m.modelSelect.id,timespan:parseInt(m.timespan),_option_:JSON.parse(JSON.stringify(m.baseOption)),data:{nodes:t,kpis:n}});w()},m.modelClick=function(e){m.modelSelect=e;var t=m.modelSelect.kpis.getData().filter(function(e){return e.checked});0<t.length&&D({formatStr:m.timeformat.formatStr,format:m.timeformat.value,category:m.category,dataType:m.dataType,modelId:e.id,timespan:parseInt(m.timespan),_option_:JSON.parse(JSON.stringify(m.baseOption)),data:{kpis:t}})},m.kpiClick=function(t,e,n){if(1==e){m.oldUnit&&m.oldUnit!=t.unit?(m.callbackmsg="请选择相同单位数据",c(function(){m.callbackmsg=void 0},1e3)):(t.checked=!t.checked,m.oldUnit=t.unit);var o=function(e){for(var t in e)for(var n in e[t].kpis)if(e[t].kpis[n].checked)return e[t]}(m.resources);m.oldNodeId=o?(m.oldUnit=m.oldUnit?m.oldUnit:t.unit,o.nodeId):void(m.oldUnit=void 0),w()}else{m.oldUnit&&m.oldUnit!=t.unit?(m.callbackmsg="单位不同，原先选择将被重置。",m.modelSelect.kpis.each(function(e){t!=e?e.checked=!1:(e.checked=!0,m.oldUnit=e.unit)}),c(function(){m.callbackmsg=void 0},1e3)):(t.checked=!t.checked,m.oldUnit=t.unit),w(),nodes=m.modelSelect.resources.getData().filter(function(e){return e.checked});var i=m.modelSelect.kpis.getData().filter(function(e){return e.checked});0<nodes.length&&0<i.length&&D({formatStr:m.timeformat.formatStr,format:m.timeformat.value,category:m.category,dataType:m.dataType,modelId:m.modelSelect.id,timespan:parseInt(m.timespan),_option_:JSON.parse(JSON.stringify(m.baseOption)),data:{nodes:nodes,kpis:i}})}},m.kpiClickByModel=function(e,t,n){if(1==t){m.oldUnit&&m.oldUnit!=e.unit?(m.callbackmsg="请选择相同单位数据",c(function(){m.callbackmsg=void 0},1e3)):e.checked=!e.checked;var o=function(e){for(var t in e)for(var n in e[t].kpis)if(e[t].kpis[n].checked)return e[t]}(m.resources);m.oldNodeId=o?(m.oldUnit=m.oldUnit?m.oldUnit:e.unit,o.nodeId):void(m.oldUnit=void 0),w()}else{if(m.oldUnit&&m.oldUnit!=e.unit)for(var i in m.oldUnit=e.unit,m.callbackmsg="单位不同，已勾选项将被清除。",c(function(){m.callbackmsg=void 0},1e3),m.modelSelect.kpis.getData())(a=m.modelSelect.kpis.getData()[i]).id==e.id?(a.checked=!0,m.oldUnit=e.unit):a.checked=!1;else e.checked=!e.checked,m.oldUnit=e.unit;w()}var a;var r=m.modelSelect.kpis.getData().filter(function(e){return e.checked});0<r.length&&D({formatStr:m.timeformat.formatStr,format:m.timeformat.value,category:m.category,dataType:m.dataType,modelId:n.id,timespan:parseInt(m.timespan),_option_:JSON.parse(JSON.stringify(m.baseOption)),data:{kpis:r}})},m.checkSelected=function(e,t){var n,o,i,a;t&&t.limit&&(n=t.limit.ci,o=t.limit.kpi);modelnum=function(e){var t=0;if(e)for(var n in e.resources)1==e.resources[n].checked&&t++;return t}(e),kpinum=function(e){var t=0;if(e)for(var n in e.kpis)1==e.kpis[n].checked&&t++;return t}(e),i=!n||modelnum==n;a=!o||kpinum==o;return!(i&&a&&0<modelnum&&0<kpinum)},m.applyChart=function(e){var t,n=[],o=[];for(var i in e){var a=!1;for(var r in e[i].kpis)e[i].kpis[r].checked&&(a=!0,t=e[i].modelId,o.push({id:e[i].kpis[r].id,name:e[i].kpis[r].name,label:e[i].kpis[r].label,units:e[i].kpis[r].unit}));a&&n.push({modelId:e[i].modelId,id:e[i].id,label:e[i].label})}for(var i in m.sub_resources)m.sub_resources[i].checked&&n.push({modelId:m.sub_resources[i].modelId,id:m.sub_resources[i].id,label:m.sub_resources[i].label});D({formatStr:m.timeformat.formatStr,format:m.timeformat.value,category:m.category,dataType:m.dataType,modelId:t,timespan:parseInt(m.timespan),_option_:JSON.parse(JSON.stringify(m.baseOption)),data:{nodes:n,kpis:o}})},m.selectNum=function(e,t){var n=0;if(e)if(0==t)for(var o in e.resources)1==e.resources[o].checked&&n++;else if(1==t)for(var o in e.kpis)1==e.kpis[o].checked&&n++;return n},m.tabClick=function(e){m.substep=e},m.newProfile=function(){m.newopen=!m.newopen},m.themeClick=function(e){"customer"!=e?m.theme=e:m.chartTab="DETAIL"},m.returnBtnClick=function(){m.chartTab="MAIN"},m.renderToolbarIcon=function(e){var t={};return t["background-image"]="url(images/icons/"+e+".svg)",t},m.renderToolbarIcon_class=function(e){var t={};return t["background-image"]="url(images/icons/"+e+".svg)",t},m.toolDetailClick=function(e,t,n){U.createChart(e,t,n),m.toolbarDetail=""},m.docClick=function(){m.newopen=!1},m.newfile=function(){a.newProf()},m.openfile=function(){m.newopen=!1,m.select=!0},m.newFileclose=function(){m.select=!1},m.openTo=function(e){a.openProf(e),m.select=!1},m.pageCloseBtn=function(){m.psetting=!1},m.psetting_close_click=function(){m.psetting=!1},m.applyPage=function(){m.psetting=!1,U.applyPage()},m.previewClick=function(){var e=[],t=U.saveData();for(var n in t.data){var o=t.data[n].layout.row,i=t.data[n].layout.col;e[o]||(e[o]={},e[o].children=[]),e[o].children[i]=t.data[n]}m.domData=e,U.disableScroll(),U.renderPreview(e)},m.domPos=function(e,t){return{width:e+"%",height:1200*e/100*t+"px"}},m.previewClose=function(){m.domData=void 0,U.enableScroll()},m.resourceClass=function(e,t){var n="",o=e.id;m.resourceSelect&&o==m.resourceSelect.id&&(n+="current ");(function(e){for(var t in e)if(e[t].checked)return!0;return!1})(e.kpis)&&(n+="active ");return n},m.substep=0,m.datasettingClick=function(){m.substep=0==m.substep?1:0},m.checkTab=function(e,t,n){{if("object"!=_typeof(t)||null==t)return!1;var o=n?1:0,i=o+function(e){var t=0;for(var n in e)e[n].checked&&t++;return t}(e);return!!t.limit&&(!!t.limit.ci&&i!=t.limit.ci)}},m.checkKpiTab=function(e,t){{if("object"!=_typeof(t)||null==t)return!1;var n=function(e){var t=0;for(var n in e)e[n].checked&&t++;return t}(e);return!!t.limit&&(!!t.limit.kpi&&n!=t.limit.kpi)}},m.kpiClassFun=function(e,t,n,o){if(null!=o)if(o.limit)var i=o.limit.kpi?o.limit.kpi:1/0;else var i=1/0;else var i=1/0;var a=function(e){var t=0;for(var n in e)e[n].checked&&t++;return t}(n);if(e.checked)return"";if(i<=a)return"disabled";if(t&&e.unit!=t)return"disabled";return""},m.checkEnabled=function(e,t){var n,o,i=0,a=0;t&&t.limit&&(n=t.limit.kpi,o=t.limit.ci);for(var r in m.resources)!function(e){for(var t in e.kpis)e.kpis[t].checked&&i++}(m.resources[r]);{if(!(0<i))return!0;a++}for(var c in e)e[c].checked&&a++;if(n&&i!=n)return!0;if(o&&a!=o)return!0;return!1},m.refreshGraph=function(){var e,t,n;t=m.solutionId?(e=m.modelSelect.id,m.modelSelect.kpis.getData().filter(function(e){return e.checked})):(0<(n=m.modelSelect.resources.getData().filter(function(e){return e.checked})).length&&(e=n[0].modelId),m.modelSelect.kpis.getData().filter(function(e){return e.checked}));var o={formatStr:m.timeformat.formatStr,format:m.timeformat.value,category:m.category,dataType:m.dataType,modelId:e,timespan:parseInt(m.timespan),_option_:JSON.parse(JSON.stringify(m.baseOption)),data:{nodes:n,kpis:t}};null!=n&&0!=n.length||delete o.data.nodes;D(o)},m.dropdownChange=function(e){m.modelPanelData.children.each(function(e){e.resources&&e.resources.each(function(e){e.checked=!1}),e.kpis.each(function(e){e.checked=!1})}),m.modelSelect=e,m.oldUnit=void 0},m.modelKeyword={},g.getAllModels().then(function(e){!function(e){if(m.callbackmsg=void 0,m.solutionId=e.solutionId,m.groupId=e.groupId,m.smodelId=e.smodelId,m.allMyView=e.views,e.viewId){y=parseInt(e.viewId);var t=m.allMyView.find(function(e){return e.viewId==y});t&&(t.JSON=JSON.parse(t.content))}m.solutionId?m.savefile=I:m.savefile=b;m.modelPanelData=(n=e.modelStructure.root,o={label:"企业",children:n},o),m.resources=(e.modelStructure,i=[],e.modelStructure.traverse.each(function(e){var t=e.id,n=e.label,o=e.kpis;e.resources&&e.resources.each(function(e){e.modelId=t,e.modelLabel=n,e.kpis=JSON.parse(JSON.stringify(o.getData())),i.push(e)})}),i),m.modelShow="",m.timespan=(m.modelShow&&null!=m.modelShow.timespan?m.modelShow.timespan:2592e3)/60/1e3;var i;var n,o;var c=[],a=function(e){for(var t in e){var n=e[t].viewTitle,o=n.indexOf("新建运营分析视图");if(-1!=o){var i=n.split("新建运营分析视图")[1],a=i.indexOf("(");if(-1!=a){var r=parseInt(i.split("(")[1].split(")")[0]);c.push(r)}else c.push(0)}}return 0<(c=c.sort()).length?"新建运营分析视图("+(c[c.length-1]+1)+")":"新建运营分析视图"}(m.allMyView);if(m.solutionId)v.getModelDashboardViewContent(m.solutionId,m.groupId,m.smodelId,function(e){var t=[];if(null!=e.data){var n=JSON.parse(e.data);for(var o in n.elements){var i=n.elements[o].layout?n.elements[o].layout.row:o+1,a=n.elements[o].layout?n.elements[o].layout.col:1;t[i]||(t[i]={},t[i].children=[]),t[i].children[a]=n.elements[o]}U.renderGraphList(n.elements.title,t,function(n){var t;n.startloading();var o=n.option,i=n.dataType,a=n.category,r=p.find(function(e){return e.formatStr==n.formatStr}),c=n.timespan,e=0==m.smodelId?m.groupId:m.smodelId,l=m.modelPanelData.children.find("id",e);null==l?(l={id:e},h.getKpisByModelId(e,function(e){e.code})):function(){l.resources&&(t=l.resources.getData().filter(function(e){return n.nodes instanceof Array&&-1!=n.nodes.indexOf(e.id)}));var e=l.kpis.getData().filter(function(e){return!!n.kpis&&-1!=n.kpis.indexOf(e.id)});t&&(!t instanceof Array||0==t.length)&&(t=void 0);g.getOptionData(i,a,r?r.value:"hh:mm",o,t,e,60*c*1e3,function(e,t){n.stoploading(),T(e.option,n,t)})}()})}});else if(null!=e.viewList){var r=[],l=e.viewList;for(var d in e.viewList);for(var s in l){var u=l[s].layout?l[s].layout.row:s+1,f=l[s].layout?l[s].layout.col:1;r[u]||(r[u]={},r[u].children=[]),r[u].children[f]=l[s]}U.renderGraphList(e.viewTitle,r,function(n){n.startloading();var o=n.option,i=[],a=n.dataType,r=n.category,c=p.find(function(e){return e.formatStr==n.formatStr}),l=n.timespan,t=n.modelId,d=m.modelPanelData.children.find("id",t);function s(){d.resources&&(i=d.resources.getData().filter(function(e){return n.nodes instanceof Array&&-1!=n.nodes.indexOf(e.id)}));var e=d.kpis.getData().filter(function(e){return-1!=n.kpis.indexOf(e.id)});if(0==i.length)if(d.resources){var t=d.resources.first();i=t?[d.resources.first()]:void 0}else i=void 0;g.getOptionData(a,r,c.value,o,i,e,60*l*1e3,function(e,t){n.stoploading(),T(e.option,n,t)})}null==d?(d={id:t},h.getResourceByModelId(t,function(e){0==e.code&&(h.getKpisByModelId(t,function(e){0==e.code&&(d.kpis=new M.ArrayHandler(e.data),s())}),d.resources=new M.ArrayHandler(e.data))})):s()})}else U.addNewLabel(a)}(e)},function(e){}),m.$watch("msg",function(e,t,n){e?U.disableBodyScroll():U.enableBodyScroll()}),m.$watch("dataType",function(e,t,n){if(e){var o=[];for(var i in e.category){var a;a="time"==i?"时间":"ci"==i?"设备":i,o.push({name:a,value:i})}n.timeCat=o}}),c(function(){U.fn(o),U.on("optionUpdated",function(e){function t(){s&&s(),u&&u(),k=e.target,m.option=JSON.parse(JSON.stringify(e.option)),m.type=e.type,m.theme=e.theme}m.$apply(t),s=m.$watch("theme",N,!0),u=m.$watch("option",O,!0)}),U.on("resBtn_click",function(d){function e(){m.option=void 0;var e=d.timespan,t=d.nodes,n=d.kpis,o=d.modelId,i=[];if("MODEL",m.baseOption=d.baseOption,m.type=d.type,m.theme=d.theme,m.step="",m.substep=0,m.timespan=e||360,m.category=d.category,m.dataType=d.dataType,m.step="MODEL",m.oldNodeId=t?t[0]:void 0,m.oldUnit=void 0,m.solutionId)0!=m.smodelId?(m.modelSelect={id:m.smodelId},h.getKpisByModelId(m.smodelId,function(e){"0"==e.code&&(m.modelSelect.kpis=new M.ArrayHandler(e.data),m.modelSelect.kpis.each(function(t){var e;n instanceof Array&&(e=n.some(function(e){return e==t.id})),t.checked=!!e}))})):0!=m.groupId&&(m.modelSelect={id:m.groupId},h.getKpisByModelId(m.groupId,function(e){"0"==e.code&&(m.modelSelect.kpis=new M.ArrayHandler(e.data),m.modelSelect.kpis.each(function(t){var e=n.some(function(e){return e==t.id});t.checked=!!e}))}));else if(t instanceof Array&&0<t.length){m.modelSelect=m.modelPanelData.children.getData().find(function(e){return e.id==o}),m.modelKeyword.setCurrentSelect(m.modelSelect),m.modelSelect=m.modelSelect?m.modelSelect:m.modelPanelData.children.first(),m.modelSelect.resources.each(function(e){e.checked=!1}),m.modelSelect.kpis.each(function(e){e.checked=!1});var a=m.modelSelect.resources.getData().filter(function(e){return-1!=t.indexOf(e.id)}),r=m.modelSelect.kpis.getData().filter(function(e){return-1!=n.indexOf(e.id)});for(var c in a)a[c].checked=!0;for(var l in r)r[l].checked=!0;0<r.length?m.oldUnit=m.oldUnit?m.oldUnit:r[0].unit:m.oldUnit=void 0}else if(null!=o&&null!=o&&""!=o){if(n instanceof Array&&0<n.length){n[0];m.oldUnit=n[0]}else delete m.oldUnit;m.modelSelect=m.modelPanelData.children.getData().find(function(e){return e.id==o}),m.modelSelect.kpis.each(function(t){var e=n.some(function(e){return e==t.id});t.checked=!!e})}else if(m.solutionId)for(var c in m.modelSelect=void 0,m.modelPanelData.children.getData())m.modelPanelData.children.getData()[c].kpis.each(function(e){e.checked=!1});else m.modelSelect=m.modelPanelData.children.first(),m.modelSelect.resources&&m.modelSelect.resources.each(function(e){e.checked=!1}),m.modelSelect.kpis.each(function(e){e.checked=!1});m.sub_resources=0<i.length?i:void 0,w(),k=d.target,m.type=d.type,m.datasource=d.option}m.$apply(e)}),U.on("codeBtn_click",function(e){function t(){f&&f(),U.disableScroll(),m.codeView=!0,m.theme=e.theme,k=e.target,m.codeSource=JSON.parse(JSON.stringify(e.option)),_.setValue(m.codeSource)}m.$apply(t),f=m.$watch("codeSource",C,!0)}),U.on("saveImage",function(o,e){function t(){function e(){m.msg=void 0}function t(){m.msg=void 0,c(n,1e3);var e,t=o.option.toolbox.feature.saveAsImage.type||"png";function n(){function e(){m.callbackmsg=""}m.callbackmsg="视图保存成功",c(e,1e3)}"png"!=t&&"jpeg"!=t&&(t="png"),e=o.myChart.isConnected()?o.myChart.getConnectedDataURL(t):o.zr.toDataURL("image/"+t,o.option.backgroundColor&&"rgba(0,0,0,0)"===o.option.backgroundColor.replace(" ","")?"#fff":o.option.backgroundColor),U.openImage(e)}m.msg={title:"是否保存此视图",content:"点击确认，则在新页面开启图片，之后请用右键另存为保存图片。点击取消，放弃保存。",btnlist:[{text:"取消",fn:e},{text:"保存",fn:t}]}}m.$apply(t)}),U.on("resourceChanged",S),J.on("chartChanged",function(e){m.dirty=!0}),J.on("onError",function(e){function t(){m.msg={title:e.errorMsg,content:e.error.message,btnlist:[{text:"关闭",fn:function(){m.msg=void 0}}]}}m.$apply(t)}),m.userInfo=r.getUserInfo()})}]),e.controller("prevController",["$scope","$rootScope","$route",function(e,t,n){var o=[],i=JSON.parse(n.current.pathParams.viewData);for(var a in i.data){var r=i.data[a].layout.row,c=i.data[a].layout.col;o[r]||(o[r]={},o[r].children=[]),o[r].children[c]=i.data[a]}e.domData=o,e.calculatePos=function(e,t){return{width:e+"%",height:"100px"}}}])});
//# sourceMappingURL=../../../map/app-editor/js/controllers/controller.js.map
