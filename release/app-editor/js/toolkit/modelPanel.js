function replaceChar(t){return t.replace("/","dash").replace("%","qmark")}define(["jquery","jquery-ui"],function(t,e){var a={},d="",p="",n=function(){};function o(t,e,a,i,r){var n=$("#resourceTitle"),s=$("#modelPanel").find(".leftContent"),l=$("#kpislist"),d=$("#nodelist"),p=(t=t,e=e,i=i,r=r,s.find("[gauge]"));for(var o in n.text(t).attr({resourceId:e,nodelabel:t}),s.css("display","block"),$("#compare").css("display","none"),d.html(""),l.html(""),p.html(""),i){var c=$("<li id='kpiItem_"+o+"' class='dragBox'>\t\t\t\t<div>\t\t\t\t"+i[o].label+" ("+i[o].unit+")\t\t\t\t</div>\t\t\t</li>");if(c.find("div").attr({kpiId:i[o].id,kpiname:i[o].name,kpiunit:replaceChar(i[o].unit),kpiunit_char:i[o].unit,label:i[o].label}),null!=r){var u=r.indexOf(i[o].id);-1!=u&&c.css("display","none")}l.append(c)}l.find("[id*=kpiItem_]").each(function(t,e){var a=$(e).attr("id");$("#"+a).draggable({revert:"invalid",cursor:"pointer",cursorAt:{top:15,left:50},helper:function(t){var e=$(t.currentTarget).find("div");return $("<div class='draghelper'></div>").text(e.attr("label"))}})});var b=$("<div class='wrap'></div>"),v=$("<div class='big' template><table><td></td></table></div>"),f=$("<div class='big' template><table><td></td></table></div>"),m=$("<div class='big' template><table><td></td></table></div>"),h=$('<div class="btn-group" role="toolbar" aria-label="..." style="margin-left : 80px;"> \t\t\t<div id="n_1" class="btn btn-default" role="group">1</div>  \t\t\t<div id="n_2" class="btn btn-default" role="group">2</div>  \t\t\t<div id="n_3" class="btn btn-default" role="group">3</div>\t\t</div>');p.append($("<div class='title'>请选择图表个数</div>")).append(h).append(b),h.find("[id*=n_]").on("click",function(t){g($(t.currentTarget).attr("id").split("n_")[1])}),g(""+(r&&0<r.length?r.length:1));var k=0;function g(t){function e(t){return{greedy:t||!1,tolerance:"pointer",accept:".dragBox",activeClass:"active-highlight",hoverClass:"hover-cls",drop:y}}switch(t){case"1":b.html("").append(v),v.removeClass().addClass("big").css("margin","6px 0 0 70px").droppable(e()),f.removeElement(),m.removeElement(),C();break;case"2":b.html("").append(v).append(f),v.removeClass().addClass("middle").css("margin","12px 0 0 30px").droppable(e()),f.removeClass().addClass("middle").css("margin","12px 0 0 140px").droppable(e(!0)),m.removeElement(),C();break;case"3":b.html("").append(v).append(m).append(f),v.removeClass().addClass("small").css("margin","26px 0 0 10px").droppable(e()),f.removeClass().addClass("middle").css("margin","16px 0 0 85px").droppable(e(!0)),m.removeClass().addClass("small").css("margin","26px 0 0 180px").droppable(e())}}function y(t,e){var a=$(e.draggable).find("div"),i={label:a.attr("label"),kpiid:a.attr("kpiid"),name:a.attr("kpiname"),unit:a.attr("kpiunit_char")};$(this).attr(i).find("td").text(a.attr("label")),C()}function C(){l.find("[id*=kpiItem_]").css("display","block"),b.find("div").each(function(t,e){var a=$(e).attr("kpiid");l.find("[id*=kpiItem_] [kpiid="+a+"]").parent().css("display","none")})}$("[template]").each(function(t,e){if(null!=r){var a=r[k];u=function(t){for(var e in i)if(i[e].id==t)return i[e]}(a),$(e).find("td").text(u.label)}k++})}function c(t,e,a,i){$("#compare").css("display","block");var r=$("#resourceTitle"),n=$("#modelPanel").find(".leftContent"),s=$("#kpislist"),l=$("#nodelist");t=t,e=e,a=a,i=i;for(var d in e,n.css("display","block"),r.text(t).attr("resourceId",e).attr("nodelabel",t),s.html(""),l.html(""),a){if(e!=a[d].id)(p=$("<li id='resourceItem' class='checkbox'>\t\t\t\t\t  <label>\t\t\t\t\t    <input type='checkbox'>\t\t\t\t\t    "+a[d].label+"\t\t\t\t\t  </label>\t\t\t\t\t</li>")).find("input:checkbox").attr({name:"resources",resourceId:a[d].id,nodelabel:a[d].label}),l.append(p)}for(var d in i){var p;(p=$("<li id='kpiItem' class='checkbox'>\t\t\t\t  <label>\t\t\t\t    <input type='checkbox'>\t\t\t\t    "+i[d].label+" ("+i[d].unit+")\t\t\t\t  </label>\t\t\t\t</li>")).find("input:checkbox").attr({name:"kpis",kpiId:i[d].id,kpiname:i[d].name,kpiunit:replaceChar(i[d].unit),kpiunit_char:i[d].unit,label:i[d].label}),s.append(p)}$("input[name*=kpis]").on("change",function(t){var e=$(t.currentTarget),a=(e.attr("kpiId"),$(t.currentTarget).attr("kpiUnit"));$("input[name*=kpis]");e.val()&&($("input[name='kpis'][kpiunit!="+a+"]").removeAttr("checked"),$("input[name='kpis'][kpiunit!="+a+"]").parent().parent().removeClass("avaliable"),$("input[name='kpis'][kpiunit*="+a+"]").parent().parent().addClass("avaliable"))})}function u(t){var e=[],i=[],a=$("#resourceTitle");e.push({nodeId:parseInt(a.attr("resourceid")),label:a.attr("nodelabel")}),$("[gauge]").find("[template]").each(function(t,e){var a={kpiId:parseInt($(e).attr("kpiId")),name:$(e).attr("name"),label:$(e).attr("label"),units:$(e).attr("unit")};i.push(a)}),n({category:p,data:{nodes:e,kpis:i}})}function b(t){var i=[],r=[],e=$("#resourceTitle");i.push({nodeId:parseInt(e.attr("resourceid")),label:e.attr("nodelabel")}),$("#nodelist").find("input").each(function(t,e){if($(e).is(":checked")){var a={nodeId:parseInt($(e).attr("resourceId")),label:$(e).attr("nodelabel")};i.push(a)}}),$("#kpislist").find("input").each(function(t,e){if($(e).is(":checked")){var a={kpiId:parseInt($(e).attr("kpiId")),name:$(e).attr("kpiName"),label:$(e).attr("label"),units:$(e).attr("kpiunit_char")};r.push(a)}}),n({category:p,data:{nodes:i,kpis:r}})}return a.renderModel=function(t){var e=t,a=$("#rightContent");(function t(e,a){if(e.sub)for(var i in e.sub)if(e.sub[i].label){if(e.sub[i].sub)var r=$("<div id='modelId_"+e.sub[i].id+"' class='model_item folder show'><span class='glyphicon glyphicon-folder-open'></span><span class='innerTxt'>"+e.sub[i].label+"</span></div>");else{var n=e.sub[i].resources;if(null!=n){var r=$("<div >\t\t\t\t\t\t\t\t\t\t<span class='glyphicon glyphicon-zoom-out'></span>\t\t\t\t\t\t\t\t\t\t<span class='innerTxt'>"+e.sub[i].label+"<span>\t\t\t\t\t\t\t\t\t</div>").attr({id:"modelId_"+e.sub[i].id}).addClass("model_item show");for(var s in n){var l=$("<div>\t\t\t\t\t\t\t\t\t\t<span class='glyphicon glyphicon-briefcase'></span>\t\t\t\t\t\t\t\t\t\t<span class='innerTxt'>"+n[s].label+"<span>\t\t\t\t\t\t\t\t\t</div>").attr({id:"resourcesId_"+n[s].id,label:n[s].label,resources:JSON.stringify(n),kpis:JSON.stringify(e.sub[i].kpis)}).addClass("model_item show");a.append(l)}}else var r=$("<div id='modelId_"+e.sub[i].id+"' class='model_item'>"+e.sub[i].label+"</div>")}t(e.sub[i],r)}else t(e.sub[i],a)})(e,a),$("[id*=resourcesId_]").on("click",function(t){switch(t.stopPropagation(),d){case"pie":case"line":case"bar":var e=$(t.currentTarget).attr("label"),a=$(t.currentTarget).attr("id").split("_")[1],i=JSON.parse($(t.currentTarget).attr("resources")),r=JSON.parse($(t.currentTarget).attr("kpis"));c(e,a,i,r);break;case"gauge":var e=$(t.currentTarget).attr("label"),a=$(t.currentTarget).attr("id").split("_")[1],i=JSON.parse($(t.currentTarget).attr("resources")),r=JSON.parse($(t.currentTarget).attr("kpis"));o(e,a,i,r)}}),$("[id*=modelId_]").on("click",function(t){t.stopPropagation();var e=$(t.currentTarget),a=$(e).children(".model_item"),i=$(e).children("span.glyphicon");a.hasClass("show")?(a.removeClass("show"),i.hasClass("glyphicon-folder-open")&&i.removeClass("glyphicon-folder-open").addClass("glyphicon-folder-close")):(a.addClass("show"),i.hasClass("glyphicon-folder-close")&&i.removeClass("glyphicon-folder-close").addClass("glyphicon-folder-open"))})},a.updateModel=function(t){var r=t.nodes,n=t.kpis;switch(d=t.type){case"line":case"bar":p="time";break;case"pie":case"gauge":p="ci"}"gauge"==d?($("[gauge]").css({display:"block"}),$("#applyBtn").off("click").on("click",u)):($("[gauge]").css({display:"none"}),$("#applyBtn").off("click").on("click",b));r?(e=r[0],a=$("#rightContent"),i=a.find("[id=resourcesId_"+e+"]").attr("label"),s=JSON.parse(a.find("[id=resourcesId_"+e+"]").attr("resources")),l=JSON.parse(a.find("[id=resourcesId_"+e+"]").attr("kpis")),"gauge"==d?o(i,e,s,l,n):(c(i,e,s,l),function(){for(var t in $(".leftContent").css("display","block"),$("ul#nodelist input[name=resources]").removeAttr("checked"),$("ul#kpislist input[name=kpis]").removeAttr("checked"),r){var e=r[t];$("ul#nodelist input[name=resources][resourceid="+e+"]").prop("checked","checked")}for(var a in n){var i=n[a];$("ul#kpislist input[name=kpis][kpiId="+i+"]").prop("checked","checked")}}())):$(".leftContent").css("display","none");var e,a,i,s,l},a.on=function(t,e){switch(t){case"onNodeSelect":n=e}},$.fn.extend({removeElement:function(){$(this).find("td").text(""),$(this).removeAttr("label"),$(this).removeAttr("kpiid")}}),a});
//# sourceMappingURL=../../../map/app-editor/js/toolkit/modelPanel.js.map
