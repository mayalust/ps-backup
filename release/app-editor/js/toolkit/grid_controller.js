define(["jquery","jquery-ui"],function($){var grid={},callback=[];function rearrangeEmpty(e){$("li.inner.empty").remove(),e.gridReceiver("option","add")}function addDefaultItem(a){var d=$("<li class='inner_li'></li>"),e=$("<div class='li_handler'></div>"),r=$("<div class='li_close'><span class='glyphicon glyphicon-remove'></span></div>"),i=$("<div class='li_content'></div>"),n={containment:"#grid_receiver",minWidth:50,create:function(e,a){d.find(".ui-resizable-e").css("background-color","rgba(0,0,0,.1)"),d.find(".ui-resizable-e").addClass("cursorMove"),d.find(".ui-resizable-s").css("display","block"),d.find(".ui-resizable-se").css("display","none")},resize:function(r,e){var a=$(r.target).parent().width()-5,i=$(r.target).parent().find("li.inner_li"),n=0,t=$(r.target).width(),l=0,c=($.each(i,function(e,a){$(a).attr("id")==$(r.target).attr("id")?o="":null==o?n+=$(a).width():(""==o?o=$(a):n+=$(a).width(),l++)}),o);var o;d.resizable({maxWidth:0<l?a-n-50:void 0}),c&&50<a-n&&c.width(a-(n+t));callback[1]()}};return e.append(r),d.append(e),d.append(i),d.attr("id","li_"+randomString(32)),r.on("mousedown",function(e){e.stopPropagation()}),r.on("click",function(e){e.stopPropagation(),callback[2]([d]),d.remove(),calculateBlockPos(a),callback[1]()}),d.resizable(n),d}function add(r,e,a){var i,l;if(r.id++,e)l=$(n=e).find(".inner_ul");else{if(a)var n=$("<li class='inner'></li>");else n=$("<li class='inner empty'></li>");var t=$("<div class='out_close'><span class='glyphicon glyphicon-remove'></span></div>"),c=$("<div class='inner_handler'></div>"),o=$("<div class='inner_content_wrap'></div>");(l=$("<ul class='inner_ul'></ul>")).attr("id","ul_"+randomString(32)),n.append(c).append(o),o.append(l),c.append(t),r.find("ul.all").append(n),t.on("mousedown",function(e){e.stopPropagation()}),t.on("click",function(e){e.stopPropagation();var r=[];n.find("li.inner_li").each(function(e,a){r.push($(a))}),callback[2](r),n.remove()}),l.sortable({scroll:!1,cursor:"move",handle:".li_handler",connectWith:".inner_ul",placeholder:"li_placeholder",tolerance:"pointer",cursorAt:{top:20,left:0},start:function(e,a){var r=0;$.each($(e.target).find("li.inner_li:not(.ui-sortable-helper)"),function(e,a){"none"!=$(a).css("display")&&r++});var i=$(e.target).find("li.li_placeholder").length,n=100/(r+i-1);$(e.target).find(".inner_li").css("width",l.width()*n/100+"px"),$(a.helper).css("width",l.width()*n/100+"px"),$(e.target).find("li.li_placeholder").css("width",l.width()*n/100-2+"px)")},update:function(e,a){$(e.target).find(".ui-sortable-helper").remove();$(e.target).parents().height();var r=$(e.target).find(".inner_li:not(.ui-sortable-helper)").length;if(r){var i=100/r;$(e.target).find(".inner_li").css({width:l.width()*i/100+"px"})}},over:function(e,a){var r=0,i=$(e.target).parents().height();$.each($(e.target).find("li.inner_li:not(.ui-sortable-helper)"),function(e,a){"none"!=$(a).css("display")&&r++});var n=$(e.target).find("li.li_placeholder").length,t=100/(r+n);e.stopPropagation(),$(e.target).find(".inner_li").css("width",l.width()*t/100+"px"),$(a.helper).css({width:l.width()*t/100+"px",height:l.height()+"px","background-color":"transparent",border:"1px dashed #444"}),$(e.target).find("li.li_placeholder").css("display","block"),$(e.target).find("li.li_placeholder").css("width",l.width()*t/100-2+"px"),$(e.target).find("li.li_placeholder").height(i),callback[1]()},out:function(e,n){$.each($(".inner_ul"),function(e,a){var r=0;$.each($(a).find("li.inner_li:not(.ui-sortable-helper)"),function(e,a){"none"!=$(a).css("display")&&r++});var i=100/r;$(a).find(".inner_li").css("width",l.width()*i/100+"px"),$(a).find("li.li_placeholder").css("width",l.width()*i/100+"px"),$(n.helper).css("width",l.width()*i/100+"px")}),$(e.target).find("li.li_placeholder").css("display","none"),callback[1]()},stop:function(e,a){calculateBlockPos(r),callback[1]()},create:function(e,a){},deactivate:function(e,a){},activate:function(e,a){},receive:function(e,a){},opacity:.8}),n.resizable({containment:"#grid_receiver",minHeight:50,create:function(e,a){n.find(".ui-resizable-s").css("background-color",i),n.find(".ui-resizable-s").addClass("cursorMove_s"),n.find(".ui-resizable-e").css("display","block"),n.find(".ui-resizable-se").css("display","block")},resize:function(){callback[1]()}})}return i=a?(l.append(a),"rgba(0,0,0,.1)"):"transparent",n}function calculateBlockPos(o){var d=$("ul.all").width()-20;$("ul.all").find("li.inner").each(function(e,a){var r,i=e,n=[];$(a).find("ul.inner_ul").find(".toolBox").each(function(e,a){var r=addDefaultItem(o),i=$(a);$(a).after(r),$(a).remove(),callback[0](i,r)}),$(a).find("ul.inner_ul").find(".inner_li.ui-sortable-helper").remove(),$(a).find("ul.inner_ul").find(".inner_li:not(.ui-sortable-helper)").each(function(e,a){r=e,"none"!=$(a).css("display")&&($(a).attr({row:i,col:r}),n.push(a))});var t=n.length;if(0<t){var l=100/t;$(a).find("ul.inner_ul").find(".inner_li").css("width",d*l/100-1+"px")}else $(a).remove();var c=$(a).height();$(a).css("height",c+"px"),$(a).removeClass("empty")}),add(o),$(".all").find()}function randomString(e){e=e||32;var a="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",r=a.length,n="";for(i=0;i<e;i++)n+=a.charAt(Math.floor(Math.random()*r));return n}return $.fn.extend({connect:"",id:0,gridCreator:function gridCreator(param1,param2,param3){var current=this;"option"==param1?param3?eval(param2)(current,param3):eval(param2+"(current)"):$.each(current.find(".toolBox"),function(e,a){$(a).draggable({tolerance:"pointer",helper:"clone",connectToSortable:".inner_ul"})})},gridReceiver:function gridReceiver(param1,param2,param3,param4){var current=this;current.attr("gridReceiver","gr_"+randomString(32));var current=this;if("option"==param1){if(param4)return eval(param2)(current,param3,param4);if(!param3)return eval(param2+"(current)");eval(param2)(current,param3)}else add(current),$("ul#all").sortable({scroll:!1,tolerance:"pointer",placeholder:"inner_placeholder",handle:".inner_handler",stop:function(e,a){calculateBlockPos(current)}}),callback[0]=param1.stop,callback[1]=param1.change,callback[2]=param1.delete},lineCreator:function lineCreator(param1,param2,param3){var current=this;"option"==param1&&(param3?eval(param2+"(current,"+param3+")"):eval(param2+"(current)"))},boxCreator:function boxCreator(param1,param2,param3){var current=this;"option"==param1&&(param3?eval(param2+"(current,"+param3+")"):eval(param2+"(current)"))}}),grid});
//# sourceMappingURL=../../../map/app-editor/js/toolkit/grid_controller.js.map
