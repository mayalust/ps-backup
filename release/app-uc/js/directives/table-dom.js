define(["directives/directives","bootstrap-dialog","datatables.net","datatables.net-bs","datatables.net-select"],function(e,t,a){"use strict";e.directive("approveTable",["$timeout","$compile","growl",function(e,o,s){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,e,a){var r,n=e;l.$on(Event.APPROVEINIT,function(e,t){r&&(r.destroy(),n.empty()),r=n.DataTable({dom:t.data&&0<t.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:t.data,columns:t.columns,rowCallback:function(e,t,a){o(e)(l)},aaSorting:[[0,"desc"]],columnDefs:t.columnDefs})}),l.$on("table-search-handle",function(e,t){t.name==a.name&&r.search(t.value).draw()}),n.on("init.dt",function(){var e=$(".special-btn").parent();e.html('<a ng-click="addProve()" class="pull-right btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新增</span></a>'),o(e)(l)}),n.on("click","#save-btn",function(e){e.stopPropagation();var t=$(this).closest("tr"),a=r.row(t),o=!0,n=$("#protocols").find("option:selected").val(),s=$("#version").find("option:selected").val();return"请选择..."==n||""==n?($("#protocols").parent("td").addClass("danger"),o=!1):(a.data().protocol=n,$("#protocols").parent("td").removeClass("danger"),"请选择..."==s||""==s?($("#version").parent("td").addClass("danger"),!1):(a.data().protocolVersion=s,$("#version").parent("td").removeClass("danger"),$.each(t.children(),function(e,t){var a=$(t);if(!a.has("button").length&&a.has("input").length){var n=$.trim(a.children("input").val());if(n)$(t).removeClass("danger"),r.cell(a).data(n);else if(2==e||3==e)return r.cell(a).data(n),$(t).addClass("danger"),o=!1}}),void(o&&l.doAction("save",a.data()))))}),n.on("click","#protocols",function(e){$(this).closest("tr");var t=$("#protocols  option:selected").val(),a=($("#version option").length,l.protocolVersions);if(""!=t)for(var n in $("#version").html(""),a)a[n].protocol==t&&$("#version").append('<option  value="'+a[n].protocolVersion+'" selected = "selected" >'+a[n].protocolVersion+"</option>");else $("#version").html(""),$("#version").append('<option  value="" selected = "selected" >请选择...</option>')}),n.on("click","#cancel-btn",function(e){e.stopPropagation(),l.doAction("cancel")}),n.on("click","#edit-btn",function(e){e.preventDefault();var t=!1;$(this).parents("tbody").children();if(!t){for(var a in l.approveGridData.data)if(2==l.approveGridData.data[a].isEdit||3==l.approveGridData.data[a].isEdit)return void s.warning("请保存后再操作！",{});t=!0;var n=$(this).closest("tr"),o=r.row(n);o.data();o.data().isEdit=2,o.cells().invalidate()}}),n.on("click","#del-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=r.row(t);l.doAction("delete",a.data())})}]}}]),e.directive("recordTable",["$timeout","$compile",function(e,s){return{restrict:"A",controller:["$scope","$element","$attrs",function(t,e,a){var n,o=e;t.$on(Event.USERINFOSINIT+"_record",function(e,t){n&&(n.destroy(),o.empty()),!1,n=o.DataTable({dom:t.data&&0<t.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,data:t.data,columns:t.columns,aaSorting:[[5,"asc"]],columnDefs:t.columnDefs})}),o.on("init.dt",function(){var e=$(".special-btn").parent();e.html('<a  href="#/renew" class="btn btn-default btn-sm"><i  style="float: left;margin-top: 4px;margin-right: 3px;" class="proudsmart ps-renewal"></i><span class="hidden-xs"> 缴费</span></a>'),s(e)(t)}),o.on("click","#price-btn",function(e){var t=$(this).closest("tr"),a=n.row(t).data();location.href="#/renew/"+a.orderNo})}]}}]),e.directive("messageTable",["$timeout","$compile",function(e,o){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,e,a){var r,n=e;l.$on(Event.USERCENTERINIT+"_msg",function(e,t){r&&(r.destroy(),n.empty()),r=n.DataTable({dom:t.data&&0<t.data.length?$.ProudSmart.datatable.footerdom:"",language:$.ProudSmart.datatable.language,select:$.ProudSmart.datatable.select,order:[[2,"desc"]],data:t.data,columns:t.columns,columnDefs:t.columnDefs,rowCallback:function(e,t,a){t.selected?$(e).addClass("selected"):$(e).removeClass("selected"),o(e)(l)}})}),l.$on("table-search-handle",function(e,t){t.name==a.name&&r.search(t.value).draw()}),n.on("change","#allselect-btn",function(e){if(e.stopPropagation(),e.target.checked){r.rows().select();for(var t=r.rows({selected:!0}),a=0;a<t.nodes().length;a++){r.row(t.nodes()[a]).data().selected=!0}r.rows().invalidate().draw(!1)}else{for(t=r.rows({selected:!0}),a=0;a<t.nodes().length;a++){r.row(t.nodes()[a]).data().selected=!1}r.rows().deselect(),r.rows().invalidate().draw(!1)}}),n.on("change",".itemCheckBox",function(e){var t=$(this).closest("tr"),a=r.row(t);e.target.checked?a.data().selected=!0:a.data().selected=!1;var n=r.rows({selected:!0});n.count()!=r.rows()[0].length?($("#allselect-btn").attr("checked",!1),$("#allselect-btn").prop("checked",!1)):n.count()==r.rows()[0].length&&($("#allselect-btn").attr("checked",!0),$("#allselect-btn").prop("checked",!0))}),n.on("click","th:eq(0)",function(e){var t=$("input[name='allClick']").is(":checked");$("input[name='msgClick']").prop("checked",t)}),n.on("click","#msgClick",function(e){for(var t=$("input[name='allClick']").is(":checked"),a=document.getElementsByName("msgClick"),n=0,o=0,s=0;s<a.length;s++)1==a[s].checked&&n++,0==a[s].checked&&o++;n==a.length&&$("input[name='allClick']").prop("checked",!0),0<o&&1==t&&$("input[name='allClick']").attr("checked",!1)}),n.on("click","td:nth-child(2)",function(e){var t,a,n=$(this).closest("tr"),o=r.row(n),s=o.data();"/read"!=l.readMsgStatus&&"ticket_service_message"!=s.message.msgType&&l.statusUpdate(s),"ticket_service_message"==s.message.msgType&&(0==s.status&&l.statusUpdate(s),o.child.isShown()?(o.child.hide(),n.removeClass("shown")):o.child((t=o.data(),a="",a+="<div>"+t.message.content+"</div>")).show())}),n.on("click","td:nth-child(1)",function(e){if("/read"==l.readMsgStatus){var t=$(this).closest("tr"),a=r.row(t).data();l.statusUpdate(a)}})}]}}])});
//# sourceMappingURL=../../../map/app-uc/js/directives/table-dom.js.map
