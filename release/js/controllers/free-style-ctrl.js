function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["controllers/controllers","Array"],function(e){"use strict";function t(v,m,b,h,w,o,t,I,e,S,n,C){var x,a,L=S.page?S.page:"index",O=S.parameter;a=S.viewId,v.naviClick=function(e,t){o.location.href="../app-free-style/index.html#/"+a+"/"+e+"/"+encodeURIComponent(JSON.stringify(t))},v.exportImage=function(){html2canvas($("#export"),{taintTest:!1,useCORS:!0,onrendered:function(e){e.id="mycanvas";var t=e.toDataURL("image/png").replace("image/png","image/octet-stream"),n=(new Date).getTime(),a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",n+".png");var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,o,0,0,0,0,0,!1,!1,!0,!1,0,null),a.dispatchEvent(r)}})},m.setCurrentTab=function(e){},v.bgColorFn=function(e){return{"background-color":e||"#eee"}},v.instance={};var r=function(o){if($$.runExpression(o.setting,function(e){if("0"==e.code){var t=e.data;v.setting="function"==typeof t?t(data,system):t,v.setting=v.setting?v.setting:{}}else v.setting={}}),o.hasOwnProperty("groups")){var t,i,e=L.split("|");i=O?JSON.parse(O):[],0<e.length?t=e[e.length-1]:e=[t=L];var s="",c=[],n=function(e,t){var n=o.groups.find(function(e){return t==e.path});if(n){s=""==s?t:s+"|"+t;var a,r=i[e];"object"==_typeof(r)&&null!=r&&(a=r.tabLabel),c.push({label:a||n.label,link:s,param:i.slice(0,parseInt(e)+1)})}};for(var a in e)n(a,e[a]);v.navigation=c;var r={};if(S.parameter&&(r=(y=JSON.parse(S.parameter))[y.length-1]),m.parameter=r,"panel"==t){var u,l,d=r.modelId,f=r.resourceId;v.navigation=v.navigation.concat({label:r.tabLabel?r.tabLabel:"设备仪表板",link:s+"|panel"});b.getManagedViewsByTypeAndRole("dashboard",function(e){0==e.code?(u=e.data,b.getDefaultView(d,function(e){if("0"==e.code){var t=e.data.find(function(e){return!!e.template&&e.template.resourceId==d}),n=u.find(function(e){var t=e.viewId;return!!e.template&&e.template.resourceId==d&&C.user.roleResList.some(function(e){return e.resId==t&&21==e.resType})});n?l=n:t&&(l=t),l?b.getViewById(l.viewId,function(e){var r,o;if("0"==e.code){var i=e.data.content;h.getModelByIds([d],function(e){"0"==e.code&&(r=e.data[0]);var a=function(e){if("0"==e.code&&(o=e.data,null!=i)){var t=JSON.parse(i),n={layout:t.data?t.data:t.layout,setting:t.setting};delete t.data;var a=new I.replaceCiKpi(n,function(){w(function(){v.instance.setMode(!0),v.instance.renderLayout(a,null,v)})},{model:r,resource:o},t)}};f?h.getResourceById(f,a):h.getResources(function(e){0==e.code&&(v.resources=e.data,v.resource=v.resources[0],v.itemchange=function(e){var t=e.id.split("number:")[1],n=v.resources.find(function(e){return e.id==t});n&&a({code:0,data:n})},a({code:0,data:v.resources[0]}))})})}}):v.error="没有找到相应的设备仪表板视图，点击<a href='#/views/dashboard' style='cursor:pointer; text-decoration: underline;'>Dashboard管理</a>创建设备仪表板"}else v.error="视图列表为空，请联系系统管理员"})):v.error="获取视图列表发生错误，请联系系统管理员"})}else if("json:"==t);else{var p=o.groups.find(function(e){return t==e.path});v.tabIndex=p?o.groups.indexOf(p):0,v.tabs=o.groups,x={layout:o.groups[v.tabIndex].layout,setting:o.setting};var g=new I.replaceCiKpi(x,function(){w(function(){v.instance.setMode(!0),v.instance.renderLayout(g,null,v)})},null,o,v)}}else if(o.hasOwnProperty("data")){v.navigation=[{label:"运营首页"}],x={layout:o.data,setting:o.setting};g=new I.replaceCiKpi(x,function(){w(function(){v.instance.setMode(!0),v.instance.renderLayout(g,null,v)})},null,o,v)}else if(o.hasOwnProperty("layout")){v.navigation=[{label:"运营首页"}],x={layout:o.layout,setting:o.setting};g=new I.replaceCiKpi(x,function(){w(function(){v.instance.setMode(!0),v.instance.renderLayout(g,null,v)})},null,o,v)}var y},i=function(e){if(0==e.code&&null!=e.data){var t=e.data.content,n=JSON.parse(t);r(n)}else v.error="此用户无配置首页视图"+(e.message?","+e.message:"")},s=function(){if(/\d+/g.test(a))b.getViewById(a,i);else{var e="../localdb/echartTemplate/"+a+".json";t.get(e,function(e){r(e)})}};v.selectEditDataGroup=function(e){v.tabIndex=e.id,x={layout:e.layout,setting:v.editData.setting},v.editData=new I.replaceCiKpi(x,function(){w(function(){v.editData.renderBoard(!0,!0)})})},C.user.isAuthenticated?s():v.$on("loginStatusChanged",function(e,t){C.user.isAuthenticated&&s()})}e.controller("freeStyleCtrl",t),t.$inject=["$scope","$rootScope","viewFlexService","resourceUIService","$timeout","$window","Info","freeboardservice","growl","$routeParams","freeboardBaseService","userLoginUIService"]});
//# sourceMappingURL=../../map/js/controllers/free-style-ctrl.js.map
