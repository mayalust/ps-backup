function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["controllers/controllers","Array"],function(e){"use strict";function t(w,e,t,n,I,h,S,r,o,C,a,x,i,D,s){var O=x.page?x.page:"index",$=function(e){if($)return decodeURIComponent(x.parameter)}();w.signClick=function(){r.location.href="../app-freeboard/index.html#/service/view/scenter"},w.naviClick=function(e,t){r.location.href="../app-oc/index.html#/dashboard/"+e+"/"+encodeURIComponent(JSON.stringify(t))},n.setCurrentTab=function(e){console.log("asd"+e)},w.bgColorFn=function(e){return{"background-color":e||"#eee"}},console.log(w.$parent,n);var c,l,u,d=function(e){if(0==e.code){var t=e.data.viewId;w.instance={};I.getViewById(t,function(e){if(0==e.code&&null!=e.data){e.data;var t,n=e.data.content,a=JSON.parse(n);if("string"==typeof a.setting&&(a.setting=JSON.parse(a.setting)),w.setting=a.setting,a.setting&&(w.bgColor=a.setting.color),a.hasOwnProperty("groups")){var r,i,o=O.split("|");i=$?JSON.parse($):[],0<o.length?r=o[o.length-1]:o=[r=O];var s="",c=[],l=function(e,t){var n=a.groups.find(function(e){return t==e.path});if(n){s=""==s?t:s+"|"+t;var r,o=i[e];"object"==_typeof(o)&&null!=o&&(r=o.tabLabel),c.push({label:r||n.label,link:s,param:i.slice(0,parseInt(e)+1)})}};for(var u in o)l(u,o[u]);if(w.navigation=c,"panel"==r){var d,f,p=(m=JSON.parse(x.parameter))[m.length-1],g=p.modelId,y=p.resourceId;w.navigation=w.navigation.concat({label:p.tabLabel?p.tabLabel:"设备仪表板",link:s+"|panel"}),I.getManagedViewsByTypeAndRole("dashboard",function(e){0==e.code?(d=e.data,I.getDefaultView(g,function(e){if("0"==e.code){var t=e.data.find(function(e){return!!e.template&&e.template.resourceId==g}),n=d.find(function(e){var t=e.viewId;return!!e.template&&e.template.resourceId==g&&D.user.roleResList.some(function(e){return e.resId==t&&21==e.resType})});n?f=n:t&&(f=t),f?I.getViewById(f.viewId,function(e){var o,a;if("0"==e.code){var i=e.data.content;h.getModelByIds([g],function(e){"0"==e.code&&(o=e.data[0]);var r=function(e){if("0"==e.code&&(a=e.data,null!=i)){var t=JSON.parse(i),n={layout:t.data?t.data:t.layout,setting:t.setting};delete t.data;var r=new C.replaceCiKpi(n,function(){S(function(){w.instance.setMode(!0),w.instance.renderLayout(r,null,w)})},{model:o,resource:a},t)}};y?h.getResourceById(y,r):h.getResources(function(e){0==e.code&&(w.resources=e.data,w.resource=w.resources[0],w.itemchange=function(e){var t=e.id.split("number:")[1],n=w.resources.find(function(e){return e.id==t});n&&r({code:0,data:n})},r({code:0,data:w.resources[0]}))})})}}):w.error="没有找到相应的设备仪表板视图，点击<a href='#/views/dashboard' style='cursor:pointer; text-decoration: underline;'>Dashboard管理</a>创建设备仪表板"}else w.error="视图列表为空，请联系系统管理员"})):w.error="获取视图列表发生错误，请联系系统管理员"})}else{var v=a.groups.find(function(e){return r==e.path});w.tabIndex=v?a.groups.indexOf(v):0,w.tabs=a.groups,t={layout:a.groups[w.tabIndex].layout,setting:a.setting};var b=new C.replaceCiKpi(t,function(){S(function(){w.instance.setMode(!0),w.instance.renderLayout(b,null,w)})},null,a,w)}}else a.hasOwnProperty("data")?(w.navigation=[{label:"运营首页"}],t={layout:a.data,setting:a.setting},b=new C.replaceCiKpi(t,function(){S(function(){w.instance.setMode(!0),w.instance.renderLayout(b,null,w)})},null,a,w)):a.hasOwnProperty("layout")&&(w.navigation=[{label:"运营首页"}],t={layout:a.layout,setting:a.setting},b=new C.replaceCiKpi(t,function(){S(function(){w.instance.setMode(!0),w.instance.renderLayout(b,null,w)})},null,a,w))}else w.error="此用户无配置首页视图"+(e.message?","+e.message:"");var m})}else w.error=e.message;w.selectEditDataGroup=function(e){w.tabIndex=e.id;var t={layout:e.layout,setting:w.editData.setting};w.editData=new C.replaceCiKpi(t,function(){S(function(){console.log(w.editData),w.editData.renderBoard(!0,!0)})})}},f="object"!=_typeof(c=D.user)?null:"string"!=typeof c.roleID?null:c.roleID.split(",")[0];f?(l=f,u=t.defer(),e.queryEnterpriseRole(function(e){if(0==e.code){var t=e.data.find(function(e){return e.roleID==l});u.resolve(t)}else u.reject(e)}),u.promise).then(function(e){var t,n,r;if(t=e.description,n=new RegExp("^\\{.*\\}$","g"),r=new RegExp("^\\[.*\\]$","g"),n.test(t)||r.test(t)?JSON.parse(t):null){d({code:0,data:{viewId:22426504462e4}})}else s.getViewByFunctionName("运营首页",d)}):s.getViewByFunctionName("运营首页",d),w.toolbars=[{id:"1",name:"工具1"},{id:"2",name:"工具2"},{id:"3",name:"工具3"},{id:"4",name:"工具4"},{id:"5",name:"工具5"}]}e.registerController("Dashboard_ver3Ctrl",t),t.$inject=["$scope","userEnterpriseService","$q","$rootScope","viewFlexService","resourceUIService","$timeout","$window","Info","freeboardservice","growl","$routeParams","freeboardBaseService","userLoginUIService","roleViewService"]});
//# sourceMappingURL=../../map/js/controllers/dashboard-ver3-ctrl.js.map
