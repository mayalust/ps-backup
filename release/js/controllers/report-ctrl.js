define(["controllers/controllers","bootstrap-dialog"],function(e,t){"use strict";e.initController("ReportTreeCtrl",["$scope","$location","unitService","$routeParams","jacquardMachineStateUIService","kpiDataService","resourceUIService","$timeout","userLoginUIService","Info","userEnterpriseService","growl",function(r,e,t,a,i,n,o,u,l,d,s,c){r.nodeList={};r.reportList=[],r.searchName="",r.searchShow="yes",r.showTab="",r.showMainTab="start",r.filterSum=0,r.objSize=0;var m=a.type,f=a.value;function h(){r.yieldGridData.datalist=[],i.getRunTimeStat(function(e){if(0==e.code){if(null==e.data||0==e.data.length)r.yieldGridData.totaldata=[],r.yieldGridData.datalist=[];else{r.yieldGridData.totaldata=e.data[e.data.length-1];for(var t=0;t<e.data.length-1;t++)r.yieldGridData.datalist.push(e.data[t])}u(function(){r.$broadcast(Event.REPORTTREEINIT+"_yield2",r.yieldGridData)})}})}function g(e){i.getCurrentDateStateByCustomerId(e,function(e){if(0==e.code)for(var t=0;t<e.data.length;t++){var a=e.data[t].how_long_to_finish;e.data[t].how_long_to_finish=parseInt(a/3600)+"小时"+parseInt(parseInt(a%3600)/60)+"分钟",r.report2customer.push(e.data[t])}})}function p(e){i.getCurrentDateStateByfigureName(e,function(e){if(0==e.code)for(var t=0;t<e.data.length;t++){var a=e.data[t].how_long_to_finish;e.data[t].how_long_to_finish=parseInt(a/3600)+"小时"+parseInt(parseInt(a%3600)/60)+"分钟",r.report2figure.push(e.data[t])}})}r.search=function(e,t,a){""!=e&&null!=e?(r.searchName=e,1e3==(r.showTab=t)?g(e):p(e)):r.showTab="0"},m&&f&&(1e3==m?g(f):p(f)),r.closeTable=function(){r.showTab="0"},r.durationGridData={columns:[{title:"机台编号",data:" externalDevId"},{title:"当日产量(米)",data:"figure_day_output"},{title:"花样名称",data:"figure_name"},{title:"生产任务(米)",data:"tasks_number"},{title:"累计产量(米)",data:"number_produced"},{title:"剩余小时(小时)",data:"how_long_to_finish"},{title:"客户编号",data:"customer_id"}],columnDefs:[{targets:0,render:function(e,t,a){return escape(a.externalDevId)}},{targets:2,render:function(e,t,a){return null==a.figure_name||null==a.figure_name?(a.figure_name="",a.figure_name):'<a id="designname" style="cursor:pointer">'+a.figure_name+"</a>"}},{targets:6,render:function(e,t,a){return null==a.customer_id||null==a.customer_id?(a.customer_id="",a.customer_id):'<a id="clientnum" style="cursor:pointer">'+a.customer_id+"</a>"}}]},r.yieldGridData={columns:[{title:"机台编号",data:" externalDevId"},{title:"当日开机时长",data:"dayRunTime"},{title:"本周时长",data:" weekRunTime"},{title:"本月开机时长",data:"monthRunTime"},{title:"本月开机率(%)",data:"monthBootRate"}],columnDefs:[{targets:0,render:function(e,t,a){return escape(a.externalDevId)}},{targets:2,render:function(e,t,a){return escape(a.weekRunTime)}}]},r.report2customer=[],r.report2figure=[];var _=function(){h(),v()},v=function(){$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){r.showTab="0";var t=$(e.target).attr("name");"start"==(r.showMainTab=t)?h():"day"==t&&(r.durationGridData.datalist=[],i.getCurrentDateState(function(e){if(0==e.code){if(null==e.data||0==e.data.length)r.durationGridData.totaldata=[],r.durationGridData.datalist=[];else{r.durationGridData.totaldata=e.data[e.data.length-1];for(var t=0;t<e.data.length-1;t++){var a=e.data[t].how_long_to_finish;e.data[t].how_long_to_finish=parseInt(a/3600)+"小时"+parseInt(parseInt(a%3600)/60)+"分钟",r.durationGridData.datalist.push(e.data[t])}}u(function(){r.$broadcast(Event.REPORTTREEINIT+"_duration",r.durationGridData)})}}))})};l.user.isAuthenticated?(_(),m&&f&&(r.showTab=m,r.searchName=f,r.searchShow="")):r.$on("loginStatusChanged",function(e,t){l.user.isAuthenticated&&(_(),m&&f&&(r.showTab=m,r.searchName=f,r.searchShow=""))})}]),e.initController("reportLookCtrl",["$scope","$location","ngDialog","unitService","$routeParams","reportUIService","kpiDataService","resourceUIService","$timeout","userLoginUIService","Info","userUIService","growl",function(a,e,t,r,i,n,o,u,l,d,s,c,m){a.queryParam={reportName:"",startTime:"",endTime:""},a.url=c.uploadFileUrl,a.goClear=function(){a.queryParam.reportName="",a.queryParam.startTime="",a.queryParam.endTime=""},a.goSearch=function(){n.getReportInfo(a.queryParam,function(e){0==e.code&&a.$broadcast("reportLook",e.data)})},d.user.isAuthenticated?a.goSearch():a.$on("loginStatusChanged",function(e,t){d.user.isAuthenticated&&a.goSearch()})}]),e.initController("reportRuleCtrl",["$scope","$location","ngDialog","unitService","$routeParams","jacquardMachineStateUIService","kpiDataService","resourceUIService","$timeout","userLoginUIService","Info","userEnterpriseService","growl",function(t,e,a,r,i,n,o,u,l,d,s,c,m){t.queryDitem={statelabel:"",state:0,name:"",emailTemplate:0,templateId:null,templateName:null,receiverType:null,receiverId:null},t.goSearch=function(){t.queryDitem.name=0==t.queryDitem.state?t.queryDitem.name:null,t.queryDitem.emailTemplate=1==t.queryDitem.state?t.queryDitem.emailTemplate:null,t.queryDitem.templateId=2==t.queryDitem.state?t.queryDitem.templateId:null};var f=function(){c.queryEnterpriseUser(function(e){0==e.code&&t.$broadcast("reportRule",e.data)})};t.dialog=function(){a.open({template:"../partials/dialogue/add_report_rule.html",scope:t,className:"ngdialog-theme-plain"})},d.user.isAuthenticated?f():t.$on("loginStatusChanged",function(e,t){d.user.isAuthenticated&&f()})}])});
//# sourceMappingURL=../../map/js/controllers/report-ctrl.js.map
