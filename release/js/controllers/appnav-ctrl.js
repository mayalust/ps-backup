function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["controllers/controllers","bootstrap-dialog"],function(e,o){"use strict";e.controller("AppNavCtrl",["$scope","$state","ngDialog","$location","Info","alertService","userLoginUIService","viewFlexService","unitService","configUIService","resourceUIService","dictionaryService","ticketTaskService","$route","$timeout","$rootScope","growl","userDomainService","userUIService","userEnterpriseService","$q","$registerService","psTreeData","psUiRouterHandler","commonMethodService","commonMethodService2","psConfig","projectUIService","psStore",function(c,t,e,n,o,i,r,s,a,l,u,d,f,m,p,g,w,b,h,v,D,y,I,N,C,S,A,M,_){var T,L=!1;runtime.init();new C;c.criticalCount=0,c.orderCount=0,c.myOptions,c.myOptionDic,c.myDicts,c.provinces,c.citys,c.districts,c.cityDics,c.districtDics,c.alertView=[],c.designView=[],c.enterpriseType=0,c.treeviewIndex="",c.oldTreeviewIndex="",c.loadingShow=!1,c.currentMenuCode=null,c.firstMenuCode=null,c.localMenuCode="F01",c.showMenu=!1,c.menuitems={},c.getAllUserInfo,c.getAllDeviceInfo,c.$on("$routeChangeSuccess",function(){r.rootHandler(c,n),c.detailshow=m&&"detail"==m.$attr("current/params/mode")}),c.closeDialog=function(){e.close()},_.add("getAllDicts");function x(n){var a=c.$watch("baseConfig",function(e,o,t){var n,i;"object"===_typeof(e)&&("app-sc"!==(n=window.location.pathname,(i=/\/(app\-[\w-]+)\//.exec(n))?i[1]:null)||e.openSidebar||($(".sidebar-toggle").css("display","none"),$(".main-sidebar").css("display","none"),$(".sidebar-mini.sidebar-collapse .content-wrapper").css("cssText","margin-left: 0px!important")),a())});v.queryEnterpriseRole(function(e){if(0==e.code){if(c.index=window.location.hash.split("/")[4]-0,c.roles=e.data?e.data.filter(function(e){return"100"!=e.roleID&&(-1!=n.roleID.indexOf(e.roleID)&&e.values)}):[],c.roleInfo=c.roles.find(function(e){return e.roleID==r.user.currentRoleID}),"undefinded"==typeof c.roleInfo)throw new Error("role cannot be found on current user");A.setRoleValues(c.roleInfo.values);try{console.log("render Tabs",((new Date-window.__loadedTime__)/1e3).toFixed(3)+"s"),g.tabs=JSON.parse(c.roleInfo.values).children}catch(e){return g.tabs=[],void console.error(e)}}}),g.$on("main_active_index",function(e,o){c.index=o,g.main_active_index=o}),c.navToPage=function(e,o){g.main_active_index=o,c.index=e.index,N(e).then(function(e){t.go.apply(t,e)})},c.$on("PS_MENU_BUTTON_CLICKED",function(e,o){c.$broadcast("PS_MENU_BUTTON_CLICKED_DONE",o)}),c.$on("PS_MENU_LIST_ITEM_CLICKED",function(e,o){N(o.parameter).then(function(e){t.go.apply(t,e)})}),c.changeRole=function(e){r.user.usercurrentRoleID=e.roleID+"",r.user.currentRoleID=e.roleID,A.updateRoleValues(e.values).then(function(e){e.children[0];g.tabs=e.children,S.navigateTo(0)})},c.loginNames.forEach(function(e,o,t){e.account==n.loginName&&(c.loginName=c.loginNames[o])}),"baowu_admin"!=n.loginName&&"013346"!=n.loginName&&"045400"!=n.loginName&&"171171"!=n.loginName&&"013346"!=n.loginName||sessionStorage.setItem("loginNames",n),sessionStorage.getItem("loginNames")?c.isShowSelect=!0:c.isShowSelect=!1}o.get("../localdb/info.json",function(e){c.baseConfig?(delete e.customerConfig,delete e.projectConfig,c.baseConfig=jQuery.extend(!0,c.baseConfig,e)):c.baseConfig=e}),o.get("../localdb/icon.json",function(e){c.kpiIconList=e.kpiIcon});var F,O=[{userName:"决策者虚拟工作台",account:"baowu_admin",password:"abc123"},{userName:"报警管理虚拟工作台  ",account:"baowu_bj",password:"abc123"},{userName:"诊断管理虚拟工作台   ",account:"baowu_fx",password:"abc123"},{userName:"协同管理虚拟工作台   ",account:"baowu_xt",password:"abc123"},{userName:"审核管理虚拟工作台   ",account:"baowu_sh",password:"abc123"},{userName:"点检管理虚拟工作台   ",account:"baowu_dj",password:"abc123"},{userName:"产线管理虚拟工作台   ",account:"baowu_cx",password:"abc123"},{userName:"检修管理虚拟工作台   ",account:"baowu_jx",password:"abc123"},{userName:"孟坤荫",account:"170628",password:"abc123"},{userName:"乐海滨",account:"041048",password:"abc123"},{userName:"沈政",account:"171211",password:"abc123"},{userName:"宋明中",account:"080231",password:"abc123"},{userName:"陈黎敏",account:"190625",password:"abc123"},{userName:"沈嘉麟",account:"170373",password:"abc123"},{userName:"廖勇",account:"190712",password:"abc123"},{userName:"陈红琳",account:"170307",password:"abc123"},{userName:"张骏骋",account:"174079",password:"abc123"},{userName:"腾威",account:"171352",password:"abc123"},{userName:"张君",account:"170381",password:"abc123"},{userName:"陈弘",account:"171163",password:"abc123"},{userName:"审核专家",account:"baowu_shzj",password:"abc123"},{userName:"宋小佩",account:"190494",password:"abc123"},{userName:"沈亮",account:"190426",password:"abc123"},{userName:"炼铁厂(产内)",account:"baowu_lt",password:"abc123"},{userName:"万欣(测试新框架)",account:"170616",password:"abc123"},{userName:"智能诊断工程师",account:"190747",password:"abc123"},{userName:"葛申剑",account:"190747",password:"abc123"},{userName:"经营服务人员",account:"baowu_jyfw",password:"abc123"},{userName:"工艺工程师",account:"baowu_gygc",password:"abc123"},{userName:"作业实施人员",account:"baowu_zyss",password:"abc123"},{userName:"质量工程师",account:"baowu_zlgc",password:"abc123"}];function B(e){var n,i,a;(n=function(o,t){var e,n;e=o,n=function(e){t(e.map(function(e){return-1!=o&&(e.modelId=-1!=o),e}))},u.getKpisByModelId(e,function(e){0==e.code&&n(e.data)})},i=e,a=[],function o(t){var e=t.shift();e?n(e,function(e){[].push.apply(a,e),o(t)}):i(a)})([300,301,302,-1])}function E(){var o,t;o=function(){r.initMenus(c,n)},l.getConfigsByGroupName("EnterpriseConfig",function(e){0==e.code&&(e.data&&0<e.data.length?e.data.forEach(function(e){try{c.baseConfig?c.baseConfig=jQuery.extend(!0,c.baseConfig,JSON.parse(e.value)):c.baseConfig=JSON.parse(e.value),c.baseConfig&&(c.baseConfig.title?$("title").html(c.baseConfig.title):$("title").html(""),c.baseConfig.shortcut?$("link[rel='shortcut icon']").attr("href",c.baseConfig.shortcut+"?"+(new Date).getTime()):$("link[rel='shortcut icon']").attr("href","../login/images/shortcut_null.png?"+(new Date).getTime()))}catch(e){}}):($("title").html(""),$("link[rel='shortcut icon']").attr("href","../login/images/shortcut_null.png?"+(new Date).getTime())),o())}),t=function(){g.rootModelsDic={300:{},301:{},302:{}},u.rootModelsDic=g.rootModelsDic,u.getModelsByCondition({},function(e){0==e.code&&(e.data.forEach(function(e){g.rootModelsDic[e.id]||(g.rootModelsDic[e.id]={}),g.rootModelsDic[e.id].model=e}),B(function(e){e.forEach(function(e){if(g.rootModelsDic[e.modelId]){if(g.rootModelsDic[e.modelId].kpiDic=g.rootModelsDic[e.modelId].kpiDic||{},c.myOptionDic[e.unit]&&(e.unitLabel=c.myOptionDic[e.unit]),e.range){var o=/\{|\[.*\}|\]/.test(e.range),t=[];if(o)try{t=o?JSON.parse(e.range):[]}catch(e){}(e.rangeAry=t)instanceof Array?2==(e.rangeAry=t).length&&(e.min=t[0],e.max=t[1]):t instanceof Object&&(e.rangeObj=t)}g.rootModelsDic[e.modelId].kpiDic[e.id]=e}}),u.modelLoader(g.rootModelsDic)}),u.getAllAttrs(function(e){0==e.code&&e.data.forEach(function(e){g.rootModelsDic[e.modelId]&&(g.rootModelsDic[e.modelId].attrs||(g.rootModelsDic[e.modelId].attrs=[]),g.rootModelsDic[e.modelId].attrs.push(e))})}),u.getDirectivesByModelId(-1,function(e){0==e.code&&e.data.forEach(function(e){g.rootModelsDic[e.modelId]&&(g.rootModelsDic[e.modelId].directives||(g.rootModelsDic[e.modelId].directives=[]),g.rootModelsDic[e.modelId].directives.push(e))})}))})},a.getAllUnits(function(e){if(0==e.code){for(var o in a.units=e.data,c.myOptions=e.data,a.unitDics={},c.myOptions)a.unitDics[c.myOptions[o].unitCode]=c.myOptions[o].unitName,"NA"!=c.myOptions[o].unitCode&&"Number"!=c.myOptions[o].unitCode||(a.unitDics[c.myOptions[o].unitCode]="");c.myOptionDic=a.unitDics,t&&t(),u.unitLoader(c.myOptionDic)}}),d.getAllDicts(function(e){if(0==e.code){d.dicts=e.data,c.myDicts=e.data;var o={};for(var t in e.data){var n=e.data[t];o[n.dictCode]||(o[n.dictCode]=[]),o[n.dictCode].push(n)}for(var i in o)c.myDicts[i]=o[i];_.commit("getAllDicts",c.myDicts)}}),h.queryUserByCondition({},function(e){if(0==e.code){var o=e.data;for(var t in o)o[o[t].loginName]=o[t].userName,o[o[t].userID]=o[t].userName;c.getAllUserInfo=o}}),u.deviceLoader().then(function(e){var o={};for(var t in e)o[e[t].id]=e[t],o[e[t].externalDevId]=e[t];c.getAllDeviceInfo=o}),u.hasOwnProperty("provinces")||u.getSimpleDistricts(function(e){0==e.code&&(u.provinces=e.data,c.provinces=e.data,c.cityDics={},c.districtDics={},c.provinces.forEach(function(e){c.cityDics[e.id]=e.children,e.children.forEach(function(e){c.districtDics[e.id]=e.children})}))}),u.getAllDataTypes(function(e){0==e.code&&(c.allDataTypes=e.data)}),c.alertView=[],c.designView=[],c.dashboardView=[],s.getAllMyViews(function(e){if(0==e.code){for(var o=e.data,t=[],n=0;n<o.length;n++){var i=o[n];if(i){t.push(i);var a={};if("string"==typeof i.description&&/^\{(.|\n)*\}$/.test(i.description)&&(a=JSON.parse(i.description)),"designView"==i.viewType){var r={title:i.viewTitle.split("?")[0],url:"#/"+i.viewType+"/"+i.viewId,viewId:i.viewId,view:i,status:a.status,statusBg:1==a.status?"bg-red":2==a.status?"bg-green":"",statusLab:1==a.status?"授权":2==a.status?"购买":"",icon:"fa fa-area-chart"};c.designView.push(r)}else"configAlert"==i.viewType?"全部告警"==(r={title:i.viewTitle.split("?")[0],url:"#/"+i.viewType+"/"+i.viewId,viewId:i.viewId,view:i,status:a.status,statusBg:1==a.status?"bg-red":2==a.status?"bg-green":"",statusLab:1==a.status?"授权":2==a.status?"购买":"",icon:"fa fa-warning"}).title?c.alertView.splice(0,0,r):c.alertView.push(r):"dashboard"==i.viewType&&(i.label=i.viewTitle,i.show=!0,c.dashboardView.push(i))}}s.viewLoadFinished=!0,s.viewList=t,c.viewList=t,c.$broadcast("viewLoadFinished")}}),u.getRootDomain(function(e){0==e.code&&(e.data?c.rootCi=e.data.id:w.error("当前用户不存在rootCi，请联系客服处理。",{}))}),function(){if(L){var e={states:"0"};i.countFromCache(e,function(e){0==e.code&&(c.criticalCount=e.data.criticalCount)}),f.getTicketsByStatus(100,function(e){0==e.code&&(c.orderCount=e.data.length)})}}(),u.getKpiTypeByFilter({},function(e){if(0==e.code){var o=[];e.data.forEach(function(e){e.text=e.label,o.push(e)}),c.defaultKpiList=o}}),function(){for(var e=r.user.domains.split("/"),t={},o=2;o<e.length-1;o++)u.getResourceById([e[o]],function(e){t[e.data.domainPath]=e.data,t[e.data.id]=e.data});u.getDomainsByFilter({},function(e){for(var o in e.data)t[e.data[o].domainPath]=e.data[o],t[e.data[o].id]=e.data[o];g.domainListDic=t,u.domainsLoader(t)})}(),u.getResourceByModelId(301,function(e){var n=e.data;u.getResourceByModelId(302,function(e){for(var a=e.data,o=0;o<a.length;o++)for(var t=0;t<n.length;t++)a[o].parentID==n[t].id&&(a[o].customerLabel=n[t].label);u.getDevicesByCondition({},function(e){for(var o=e.data,t=0;t<o.length;t++)for(var n=0;n<a.length;n++)o[t].projectId==a[n].id&&(o[t].customerLabel=a[n].customerLabel,o[t].projectLabel=a[n].label);var i={};o.forEach(function(e){i[e.id]=e}),g.deviceDicArr=o,g.deviceDic=i,u.deviceObjLoader(g.deviceDic)})},"includeFields=label,id,parentID")},"includeFields=label,id")}c.loginNames=(F=window.location.host)&&-1!=F.search("localhost")&&F.search("127.0.0.1")?O.concat([{userName:"汤霄炯",account:"190520",password:"abc123"},{userName:"环保管理员",account:"baowu_huanbao",password:"abc123"},{userName:"废水",account:"baowu_fs",password:"abc123"}]):O,c.loginFun=function(e){r.loginCallback(e.account,e.password,function(e){if(0==e.code){for(var o in sessionStorage)"loginNames"!=o&&sessionStorage.removeItem(o);window.location.href="index.html"}})},c.gotoHomePage=function(){"0"!=r.user.enterprise.logoStatus&&(location.href="http://www.proudsmart.com")},c.gotoAppPage=function(){location.href="index.html"},c.showMenuFun=function(){c.showMenu=!c.showMenu},c.logout=function(){sessionStorage.clear(),r.logout()},c.onViewLoad=function(){},c.menusFilter=function(e){return"S"===e.functionCode.charAt(0)},c.publicTableSearch=function(e,o){c.$broadcast("table-search-handle",{name:e,value:o})},c.$on("loginStatusChanged",function(e,o){r.user.isAuthenticated?(T&&T.close(),c.userInfo=r.user,c.lastLoginTime=newDateJson(r.user.lastLoginTime).Format(GetDateCategoryStrByLabel()),r.user.enterprise&&(c.enterpriseType=r.user.enterprise.enterpriseType),E(),x(c.userInfo)):(c.userInfo={},c.lastLoginTime="")})}]),e.controller("AppUploadCtrl",["$scope","growl","FileUploader",function(i,a,e){i.fileMaxSize=i.fileMaxSize?i.fileMaxSize:1,i.fileFormat=i.fileFormat?i.fileFormat:"jpg、png、jpeg、bmp、gif、svg",i.queueLimit=i.queueLimit?i.queueLimit:1;var r=i.uploader=new e({url:i.serviceOrigin,withCredentials:!0,removeAfterUpload:!0});r.fileBelongDic={},r.filters.push({name:"fileFilter",fn:function(e,o){var t=e.name.split("."),n=t[t.length-1];return-1==i.fileFormat.indexOf(n)?(a.warning("文件格式仅支持"+i.fileFormat+"文件，请重新选择",{}),!1):!(e.size/1024>1e3*i.fileMaxSize)||(a.warning("您选择的文件大于"+i.fileMaxSize+"M，请重新选择",{}),!1)}}),r.onWhenAddingFileFailed=function(e,o,t){console.info("onWhenAddingFileFailed",e,o,t)},r.onAfterAddingFile=function(e){r.queue.length>i.queueLimit&&r.removeFromQueue(r.queue.length.length-1),console.info("onAfterAddingFile",e)},r.onAfterAddingAll=function(e){r.fileBelongId&&(r.fileBelongDic[r.fileBelongId]=e),i.$broadcast("onAfterAddingAll",{addedFileItems:e}),console.info("onAfterAddingAll",e)},r.onBeforeUploadItem=function(e){Array.prototype.push.apply(e.formData,r.formData),console.info("onBeforeUploadItem",e)},r.onProgressItem=function(e,o){console.info("onProgressItem",e,o)},r.onProgressAll=function(e){console.info("onProgressAll",e)},r.onSuccessItem=function(e,o,t,n){console.info("onSuccessItem",e,o,t,n)},r.onErrorItem=function(e,o,t,n){a.warning("上传文件失败",{}),i.loadingShow=!1,console.info("onErrorItem",e,o,t,n)},r.onCancelItem=function(e,o,t,n){console.info("onCancelItem",e,o,t,n)},r.onCompleteItem=function(e,o,t,n){console.info("onCompleteItem",e,o,t,n),r.formData=[],o?(0==o.code?i.$broadcast("uploadTemplate",{state:!0,response:o}):a.error(o.message,{}),i.loadingShow=!1):a.error("操作异常了，尝试重新刷新",{})},r.onCompleteAll=function(){console.info("onCompleteAll")},r.uplaodHandler=function(){r.uploadAll(),scope.loadingShow=!0,r.fileBelongDic={},r.fileBelongId=""},r.clearHandler=function(){r.clearQueue(),r.fileBelongDic={},r.fileBelongId=""},r.growl=function(e){a.info(e,{})}}])});
//# sourceMappingURL=../../map/js/controllers/appnav-ctrl.js.map
