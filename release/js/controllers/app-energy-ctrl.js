define(["controllers/controllers","bootstrap-dialog"],function(e,t){"use strict";e.controller("AppDenuoCtrl",["$scope","ngDialog","$location","Info","alertService","userLoginUIService","viewFlexService","unitService","resourceUIService","dictionaryService","$route","$timeout","$rootScope","growl",function(r,e,t,i,n,o,c,s,a,u,d,l,p,f){var w;r.criticalCount=0,r.myOptions,r.myOptionDic={},r.myDicts,r.provinces,r.citys,r.districts,r.cityDics,r.districtDics,r.alertView=[],r.designView=[],r.enterpriseType=0,r.treeviewIndex="",r.oldTreeviewIndex="",r.currentMenuCode=null,r.firstMenuCode=null,r.localMenuCode="F01",r.showMenu=!1,r.menuitems={},r.$on("$routeChangeSuccess",function(){o.rootHandler(r,t),"detail"==d.current.params.mode?r.detailshow=!0:r.detailshow=!1}),r.closeDialog=function(){e.close()};i.get("../localdb/info.json",function(e){}),i.get("../localdb/icon.json",function(e){r.kpiIconList=e.kpiIcon}),r.gotoHomePage=function(){"0"!=o.user.enterprise.logoStatus&&(location.href="http://www.proudsmart.com")},r.gotoAppPage=function(){location.href="index.html"},r.showMenuFun=function(){r.showMenu=!r.showMenu},r.logout=function(){o.logout()},r.onViewLoad=function(){};function v(){o.initMenus(r,t),s.getAllUnits(function(e){if(0==e.code){for(var t in s.units=e.data,r.myOptions=e.data,r.myOptions)r.myOptionDic[r.myOptions[t].unitCode]=r.myOptions[t].unitName,"NA"!=r.myOptions[t].unitCode&&"Number"!=r.myOptions[t].unitCode||(r.myOptionDic[r.myOptions[t].unitCode]="");s.unitDics=r.myOptionDic}}),u.getAllDicts(function(e){if(0==e.code){u.dicts=e.data,r.myDicts=e.data;var t={};for(var i in e.data){var n=e.data[i];t[n.dictCode]||(t[n.dictCode]=[]),t[n.dictCode].push(n)}for(var o in t)r.myDicts[o]=t[o]}}),a.hasOwnProperty("provinces")||a.getSimpleDistricts(function(e){0==e.code&&(a.provinces=e.data,r.provinces=e.data,r.cityDics={},r.districtDics={},r.provinces.forEach(function(e){r.cityDics[e.id]=e.children,e.children.forEach(function(e){r.districtDics[e.id]=e.children})}))}),a.getAllDataTypes(function(e){0==e.code&&(r.allDataTypes=e.data)}),r.alertView=[],r.designView=[],c.getAllMyViews(function(e){if(0==e.code){for(var t=e.data,i=[],n=0;n<t.length;n++){var o=t[n];if(o){i.push(o);var s={};if("string"==typeof o.description&&/^\{(.|\n)*\}$/.test(o.description)&&(s=JSON.parse(o.description)),"designView"==o.viewType){var a={title:o.viewTitle.split("?")[0],url:"#/"+o.viewType+"/"+o.viewId,viewId:o.viewId,view:o,status:s.status,statusBg:1==s.status?"bg-red":2==s.status?"bg-green":"",statusLab:1==s.status?"授权":2==s.status?"购买":"",icon:"fa fa-area-chart"};r.designView.push(a)}else"configAlert"==o.viewType&&("全部告警"==(a={title:o.viewTitle.split("?")[0],url:"#/"+o.viewType+"/"+o.viewId,viewId:o.viewId,view:o,status:s.status,statusBg:1==s.status?"bg-red":2==s.status?"bg-green":"",statusLab:1==s.status?"授权":2==s.status?"购买":"",icon:"fa fa-warning"}).title?r.alertView.splice(0,0,a):r.alertView.push(a))}}for(n=0;n<20;n++)a={title:"viewmenus"+n,url:"#",viewId:n,icon:"fa fa-warning",view:{viewId:123}},r.alertView.push(a);c.viewLoadFinished=!0,c.viewList=i,r.viewList=i,r.$broadcast("viewLoadFinished")}}),a.getRootDomain(function(e){0==e.code&&(e.data?r.rootCi=e.data.id:f.error("当前用户不存在rootCi，请联系客服处理。",{}))}),a.getKpiTypeByFilter({},function(e){if(0==e.code){var t=[];e.data.forEach(function(e){e.text=e.label,t.push(e)}),r.defaultKpiList=t}})}r.menusFilter=function(e){return"S"===e.functionCode.charAt(0)},r.publicTableSearch=function(e,t){r.$broadcast("table-search-handle",{name:e,value:t})},r.$on("loginStatusChanged",function(e,t){o.user.isAuthenticated?(w&&w.close(),r.userInfo=o.user,r.lastLoginTime=newDateJson(o.user.lastLoginTime).Format(GetDateCategoryStrByLabel()),o.user.enterprise&&(r.enterpriseType=o.user.enterprise.enterpriseType),v()):(r.userInfo={},r.lastLoginTime="")})}])});
//# sourceMappingURL=../../map/js/controllers/app-energy-ctrl.js.map
