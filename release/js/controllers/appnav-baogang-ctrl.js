function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["controllers/controllers","bootstrap-dialog"],function(e,o){"use strict";e.controller("AppNavCtrl",["$scope","$state","ngDialog","$location","Info","alertService","userLoginUIService","viewFlexService","unitService","configUIService","resourceUIService","dictionaryService","ticketTaskService","$route","$timeout","$rootScope","growl","userDomainService","userUIService","userEnterpriseService","$q","$registerService","psTreeData","psUiRouterHandler","commonMethodService","commonMethodService2","psConfig","projectUIService","psStore",function(r,t,e,n,o,i,s,a,c,l,u,d,f,p,m,g,h,D,w,b,v,y,I,A,N,S,C,M,_){var T;h.error=function(e){console.error(e)};runtime.init();new N;var x=new Date;r.criticalCount=0,r.orderCount=0,r.myOptions,r.myOptionDic,r.myDicts,r.provinces,r.citys,r.districts,r.cityDics,r.districtDics,r.alertView=[],r.designView=[],r.enterpriseType=0,r.treeviewIndex="",r.oldTreeviewIndex="",r.loadingShow=!1,r.currentMenuCode=null,r.firstMenuCode=null,r.localMenuCode="F01",r.showMenu=!1,r.menuitems={},r.getAllUserInfo,r.getAllDeviceInfo,r.closeDialog=function(){e.close()},_.add("getAllDicts");function O(n){var a=r.$watch("baseConfig",function(e,o,t){var n,i;"object"===_typeof(e)&&("app-sc"!==(n=window.location.pathname,(i=/\/(app\-[\w-]+)\//.exec(n))?i[1]:null)||e.openSidebar||($(".sidebar-toggle").css("display","none"),$(".main-sidebar").css("display","none"),$(".sidebar-mini.sidebar-collapse .content-wrapper").css("cssText","margin-left: 0px!important")),a())});b.queryEnterpriseRole(function(e){if(0==e.code){r.index=window.location.hash.split("/")[4]-0,r.roles=e.data?e.data.filter(function(e){return"100"!=e.roleID&&(-1!=n.roleID.indexOf(e.roleID)&&e.values)}):[],r.roleInfo=r.roles.find(function(e){return e.roleID==s.user.currentRoleID})||r.roles[0],C.setRoleValues(r.roleInfo.values);try{console.log("render Tabs",((new Date-window.__loadedTime__)/1e3).toFixed(3)+"s"),g.tabs=JSON.parse(r.roleInfo.values).children}catch(e){return g.tabs=[],void console.error(e)}}}),g.$on("main_active_index",function(e,o){r.index=o,g.main_active_index=o}),r.navToPage=function(e,o){g.main_active_index=o,r.index=e.index,A(e).then(function(e){t.go.apply(t,e)})},r.$on("PS_MENU_BUTTON_CLICKED",function(e,o){r.$broadcast("PS_MENU_BUTTON_CLICKED_DONE",o)}),r.$on("PS_MENU_LIST_ITEM_CLICKED",function(e,o){A(o.parameter).then(function(e){t.go.apply(t,e)})}),r.changeRole=function(e){s.user.usercurrentRoleID=e.roleID+"",s.user.currentRoleID=e.roleID,localStorage.setItem("roleId",e.roleID),C.updateRoleValues(e.values).then(function(e){e.children[0];g.tabs=e.children,S.navigateTo(0)})},r.loginNames.forEach(function(e,o,t){e.account==n.loginName&&(r.loginName=r.loginNames[o])}),"baowu_admin"!=n.loginName&&"013346"!=n.loginName&&"045400"!=n.loginName&&"171171"!=n.loginName&&"013346"!=n.loginName||sessionStorage.setItem("loginNames",n),sessionStorage.getItem("loginNames")?r.isShowSelect=!0:r.isShowSelect=!1}o.get("../localdb/info.json",function(e){r.baseConfig?(delete e.customerConfig,delete e.projectConfig,r.baseConfig=jQuery.extend(!0,r.baseConfig,e)):r.baseConfig=e}),o.get("../localdb/icon.json",function(e){r.kpiIconList=e.kpiIcon});var U,E=[{userName:"决策者虚拟工作台",account:"baowu_admin",password:"abc123"},{userName:"报警管理虚拟工作台  ",account:"baowu_bj",password:"abc123"},{userName:"诊断管理虚拟工作台   ",account:"baowu_fx",password:"abc123"},{userName:"协同管理虚拟工作台   ",account:"baowu_xt",password:"abc123"},{userName:"审核管理虚拟工作台   ",account:"baowu_sh",password:"abc123"},{userName:"点检管理虚拟工作台   ",account:"baowu_dj",password:"abc123"},{userName:"产线管理虚拟工作台   ",account:"baowu_cx",password:"abc123"},{userName:"检修管理虚拟工作台   ",account:"baowu_jx",password:"abc123"},{userName:"孟坤荫",account:"170628",password:"abc123"},{userName:"乐海滨",account:"041048",password:"abc123"},{userName:"沈政",account:"171211",password:"abc123"},{userName:"宋明中",account:"080231",password:"abc123"},{userName:"陈黎敏",account:"190625",password:"abc123"},{userName:"沈嘉麟",account:"170373",password:"abc123"},{userName:"廖勇",account:"190712",password:"abc123"},{userName:"陈红琳",account:"170307",password:"abc123"},{userName:"张瑞菊",account:"170147",password:"abc123"},{userName:"张骏骋",account:"174079",password:"abc123"},{userName:"腾威",account:"171352",password:"abc123"},{userName:"张君",account:"170381",password:"abc123"},{userName:"陈弘",account:"171163",password:"abc123"},{userName:"审核专家",account:"baowu_shzj",password:"abc123"},{userName:"宋小佩",account:"190494",password:"abc123"},{userName:"沈亮",account:"190426",password:"abc123"},{userName:"炼铁厂(产内)",account:"baowu_lt",password:"abc123"},{userName:"万欣(测试新框架)",account:"170616",password:"abc123"},{userName:"智能诊断工程师",account:"190747",password:"abc123"},{userName:"葛申剑",account:"190747",password:"abc123"},{userName:"经营服务人员",account:"baowu_jyfw",password:"abc123"},{userName:"工艺工程师",account:"baowu_gygc",password:"abc123"},{userName:"作业实施人员",account:"baowu_zyss",password:"abc123"},{userName:"质量工程师",account:"baowu_zlgc",password:"abc123"}];function F(e){var n,i,a;(n=function(o,t){var e,n;e=o,n=function(e){t(e.map(function(e){return-1!=o&&(e.modelId=-1!=o),e}))},u.getKpisByModelId(e,function(e){0==e.code&&n&&n.call(this,e.data)})},i=e,a=[],function o(t){var e=t.shift();e?n(e,function(e){[].push.apply(a,e),o(t)}):i(a)})([300,301,302,-1])}function B(){this.events={},this.promises={}}r.loginNames=(U=window.location.host)&&-1!=U.search("localhost")&&U.search("127.0.0.1")?E.concat([{userName:"汤霄炯",account:"190520",password:"abc123"},{userName:"环保管理员",account:"baowu_huanbao",password:"abc123"},{userName:"废水",account:"baowu_fs",password:"abc123"},{userName:"郑建刚",account:"048428",password:"abc123"}]):E,r.loginFun=function(e){s.loginCallback(e.account,e.password,function(e){if(0==e.code){for(var o in sessionStorage)"loginNames"!=o&&sessionStorage.removeItem(o);window.location.href="index.html"}})},r.gotoHomePage=function(){"0"!=s.user.enterprise.logoStatus&&(location.href="http://www.proudsmart.com")},r.gotoAppPage=function(){location.href="index.html"},r.showMenuFun=function(){r.showMenu=!r.showMenu},r.logout=function(){sessionStorage.clear(),s.logout()},r.onViewLoad=function(){},B.prototype.on=function(e,o){this.promises[e]().then(o)},B.prototype.init=function(e){this.cacheOneByOne([{fn:this.getEnterpriseConfigs,eventHandler:"getEnterpriseConfigs"},{fn:this.getAllDicts,eventHandler:"getAllDicts"},{fn:this.getAllUnits,eventHandler:"getAllUnits"},{fn:this.getAllDevice,eventHandler:"getAllDevice"},{fn:this.domainTreeQuery,eventHandler:"domainTreeQuery"},{fn:this.getAllModelDeviceKpiDef,eventHandler:"getAllModelDeviceKpiDef"},{fn:this.getAllUserInfo,eventHandler:"getAllUserInfo"},{fn:this.getSimpleDistricts,eventHandler:"getSimpleDistricts"},{fn:this.getAllAttrs,eventHandler:"getAllAttrs"},{fn:this.getAllDirectives,eventHandler:"getAllDirectives"},{fn:this.getRootDomain,eventHandler:"getRootDomain"},{fn:this.getAllDataTypes,eventHandler:"getAllDataTypes"},{fn:this.getDefaultKpis,eventHandler:"getDefaultKpis"}],e)},B.prototype.cacheOneByOne=function(e,r){var s=this,c=e.length;this.promises=e.reduce(function(e,o){var t;return e[o.eventHandler]=(t=v.defer(),function(e){if(null==e)return t.promise;t.resolve(e)}),e},{}),function o(t){var e,n,i=t.shift(),a=c-t.length;if(i)return e=i.fn,n=i.eventHandler,e.call(this,function(e){console.info(a+") "+e+" - "+Math.round(a/c*100)+"%, 用时 : "+(new Date-x)/1e3+"s"),s.promises[n]("success"),o(t)});r&&r.call(this)}(e.slice())},B.prototype.getAllDevice=function(n){u.deviceLoader().then(function(e){var o={};for(var t in e)o[e[t].id]=e[t],o[e[t].externalDevId]=e[t];r.getAllDeviceInfo=o,n&&n.call(this,"缓存全部设备完成")})},B.prototype.getAllDicts=function(a){d.getAllDicts(function(e){if(0==e.code){d.dicts=e.data,r.myDicts=e.data;var o={};for(var t in e.data){var n=e.data[t];o[n.dictCode]||(o[n.dictCode]=[]),o[n.dictCode].push(n)}for(var i in o)r.myDicts[i]=o[i];_.commit("getAllDicts",r.myDicts),a&&a.call(this,"缓存全部字典表完成")}})},B.prototype.getAllUserInfo=function(n){w.queryUserByCondition({},function(e){if(0==e.code){var o=e.data;for(var t in o)o[o[t].loginName]=o[t].userName,o[o[t].userID]=o[t].userName;r.getAllUserInfo=o,n&&n.call(this,"缓存全部用户信息完成")}})},B.prototype.getSimpleDistricts=function(o){u.hasOwnProperty("provinces")?o&&o.call(this,"缓存所有的地图信息"):u.getSimpleDistricts(function(e){0==e.code&&(u.provinces=e.data,r.provinces=e.data,r.cityDics={},r.districtDics={},r.provinces.forEach(function(e){r.cityDics[e.id]=e.children,e.children.forEach(function(e){r.districtDics[e.id]=e.children})}),o&&o.call(this,"缓存所有的地图信息"))})},B.prototype.getAllDataTypes=function(o){u.getAllDataTypes(function(e){0==e.code&&(r.allDataTypes=e.data,o&&o.call(this,"缓存全部数据类型信息完成"))})},B.prototype.getAllUnits=function(t){c.getAllUnits(function(e){if(0==e.code){for(var o in c.units=e.data,r.myOptions=e.data,c.unitDics={},r.myOptions)c.unitDics[r.myOptions[o].unitCode]=r.myOptions[o].unitName,"NA"!=r.myOptions[o].unitCode&&"Number"!=r.myOptions[o].unitCode||(c.unitDics[r.myOptions[o].unitCode]="");r.myOptionDic=c.unitDics,u.unitLoader(r.myOptionDic),t&&t.call(this,"缓存全部单位字典表完成")}})},B.prototype.getRootDomain=function(o){u.getRootDomain(function(e){0==e.code&&(e.data?(r.rootCi=e.data.id,o&&o.call(this,"缓存rootCi完成")):h.error("当前用户不存在rootCi，请联系客服处理。",{}))})},B.prototype.getAllAttrs=function(o){u.getAllAttrs(function(e){0==e.code&&(e.data.forEach(function(e){g.rootModelsDic[e.modelId]&&(g.rootModelsDic[e.modelId].attrs||(g.rootModelsDic[e.modelId].attrs=[]),g.rootModelsDic[e.modelId].attrs.push(e))}),o&&o.call(this,"缓存全部设备属性完成"))})},B.prototype.getAllDirectives=function(o){u.getDirectivesByModelId(-1,function(e){0==e.code&&(e.data.forEach(function(e){g.rootModelsDic[e.modelId]&&(g.rootModelsDic[e.modelId].directives||(g.rootModelsDic[e.modelId].directives=[]),g.rootModelsDic[e.modelId].directives.push(e))}),o&&o.call(this,"缓存全部指令完成"))})},B.prototype.getDefaultKpis=function(t){u.getKpiTypeByFilter({},function(e){if(0==e.code){var o=[];e.data.forEach(function(e){e.text=e.label,o.push(e)}),r.defaultKpiList=o,t&&t.call(this,"缓存全部默认指标类型完成")}})},B.prototype.getAllModelDeviceKpiDef=function(o){g.rootModelsDic={300:{},301:{},302:{}},u.rootModelsDic=g.rootModelsDic,u.getModelsByCondition({},function(e){0==e.code&&(e.data.forEach(function(e){g.rootModelsDic[e.id]||(g.rootModelsDic[e.id]={}),g.rootModelsDic[e.id].model=e}),F(function(e){e.forEach(function(e){if(g.rootModelsDic[e.modelId]){g.rootModelsDic[e.modelId].kpiDic=g.rootModelsDic[e.modelId].kpiDic||{},r.myOptionDic[e.unit]&&(e.unitLabel=r.myOptionDic[e.unit]);if(e.range){var o=/\{|\[.*\}|\]/.test(e.range),t=[];if(o)try{t=o?JSON.parse(e.range):[]}catch(e){}(e.rangeAry=t)instanceof Array?2==(e.rangeAry=t).length&&(e.min=t[0],e.max=t[1]):t instanceof Object&&(e.rangeObj=t)}g.rootModelsDic[e.modelId].kpiDic[e.id]=e}}),u.modelLoader(g.rootModelsDic),o&&o.call(this,"缓存全部模型、设备、指标完成")}))})},B.prototype.domainTreeQuery=function(t){for(var e=s.user.domains.split("/"),n={},o=2;o<e.length-1;o++)u.getResourceById([e[o]],function(e){n[e.data.domainPath]=e.data,n[e.data.id]=e.data});u.getDomainsByFilter({},function(e){for(var o in e.data)n[e.data[o].domainPath]=e.data[o],n[e.data[o].id]=e.data[o];g.domainListDic=n,u.domainsLoader(n),t&&t.call(this,"缓存管理域名（兼容性保留）")})},B.prototype.getEnterpriseConfigs=function(o){l.getConfigsByGroupName("EnterpriseConfig",function(e){0==e.code&&(e.data&&0<e.data.length?e.data.forEach(function(e){try{r.baseConfig?r.baseConfig=jQuery.extend(!0,r.baseConfig,JSON.parse(e.value)):r.baseConfig=JSON.parse(e.value),r.baseConfig&&(r.baseConfig.title?$("title").html(r.baseConfig.title):$("title").html(""),r.baseConfig.shortcut?$("link[rel='shortcut icon']").attr("href",r.baseConfig.shortcut+"?"+(new Date).getTime()):$("link[rel='shortcut icon']").attr("href","../login/images/shortcut_null.png?"+(new Date).getTime()))}catch(e){}}):($("title").html(""),$("link[rel='shortcut icon']").attr("href","../login/images/shortcut_null.png?"+(new Date).getTime())),s.initMenus(r,n),o&&o.call(this,"缓存基础配置信息完成"))})},r.menusFilter=function(e){return"S"===e.functionCode.charAt(0)},r.publicTableSearch=function(e,o){r.$broadcast("table-search-handle",{name:e,value:o})},r.$on("loginStatusChanged",function(e,o){s.user.isAuthenticated?(T&&T.close(),r.userInfo=s.user,r.lastLoginTime=newDateJson(s.user.lastLoginTime).Format(GetDateCategoryStrByLabel()),s.user.enterprise&&(r.enterpriseType=s.user.enterprise.enterpriseType),s.initMenus(r,n),g.cacheAllData=new B,g.cacheAllData.init(function(){console.log("全部数据缓存完成 - 用时 : "+(new Date-x)/1e3+"s")}),O(r.userInfo)):(r.userInfo={},r.lastLoginTime="")})}]),e.controller("AppUploadCtrl",["$scope","growl","FileUploader",function(i,a,e){i.fileMaxSize=i.fileMaxSize?i.fileMaxSize:1,i.fileFormat=i.fileFormat?i.fileFormat:"jpg、png、jpeg、bmp、gif、svg",i.queueLimit=i.queueLimit?i.queueLimit:1;var r=i.uploader=new e({url:i.serviceOrigin,withCredentials:!0,removeAfterUpload:!0});r.fileBelongDic={},r.filters.push({name:"fileFilter",fn:function(e,o){var t=e.name.split("."),n=t[t.length-1];return-1==i.fileFormat.indexOf(n)?(a.warning("文件格式仅支持"+i.fileFormat+"文件，请重新选择",{}),!1):!(e.size/1024>1e3*i.fileMaxSize)||(a.warning("您选择的文件大于"+i.fileMaxSize+"M，请重新选择",{}),!1)}}),r.onWhenAddingFileFailed=function(e,o,t){console.info("onWhenAddingFileFailed",e,o,t)},r.onAfterAddingFile=function(e){r.queue.length>i.queueLimit&&r.removeFromQueue(r.queue.length.length-1),console.info("onAfterAddingFile",e)},r.onAfterAddingAll=function(e){r.fileBelongId&&(r.fileBelongDic[r.fileBelongId]=e),i.$broadcast("onAfterAddingAll",{addedFileItems:e}),console.info("onAfterAddingAll",e)},r.onBeforeUploadItem=function(e){Array.prototype.push.apply(e.formData,r.formData),console.info("onBeforeUploadItem",e)},r.onProgressItem=function(e,o){console.info("onProgressItem",e,o)},r.onProgressAll=function(e){console.info("onProgressAll",e)},r.onSuccessItem=function(e,o,t,n){console.info("onSuccessItem",e,o,t,n)},r.onErrorItem=function(e,o,t,n){a.warning("上传文件失败",{}),i.loadingShow=!1,console.info("onErrorItem",e,o,t,n)},r.onCancelItem=function(e,o,t,n){console.info("onCancelItem",e,o,t,n)},r.onCompleteItem=function(e,o,t,n){console.info("onCompleteItem",e,o,t,n),r.formData=[],o?(0==o.code?i.$broadcast("uploadTemplate",{state:!0,response:o}):a.error(o.message,{}),i.loadingShow=!1):a.error("操作异常了，尝试重新刷新",{})},r.onCompleteAll=function(){console.info("onCompleteAll")},r.uplaodHandler=function(){r.uploadAll(),scope.loadingShow=!0,r.fileBelongDic={},r.fileBelongId=""},r.clearHandler=function(){r.clearQueue(),r.fileBelongDic={},r.fileBelongId=""},r.growl=function(e){a.info(e,{})}}])});
//# sourceMappingURL=../../map/js/controllers/appnav-baogang-ctrl.js.map
