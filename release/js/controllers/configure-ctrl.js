define(["controllers/controllers","bootstrap-dialog"],function(e,D){"use strict";e.controller("ConfigureCtrl",["$scope","$rootScope","$location","$timeout","growl","userLoginUIService","resourceUIService","viewFlexService","userDomainService","solutionUIService","unitService","configUIService",function(c,a,i,e,o,t,r,n,s,d,l,u){if(""==location.hash||-1<location.hash.search("#/index"))location.href="../app-oc/index.html#/configureview";else{c.errorMsg="",c.slide="1",c.treeAry=[],c.configureView=[],c.echartView=[],c.configViewBg=[],c.configCustoms=[],c.configCommons=[],c.myOptions,c.treeviewIndex="",c.oldTreeviewIndex="",c.defaultRoute="../app-oc/index.html#/configureview",c.currentMenuCode=null,c.firstMenuCode=null,c.localMenuCode="F01",c.showMenu=!1,c.menuitems={},c.$on("$routeChangeSuccess",function(){t.rootHandler(c,i)}),c.alertLevels=[{label:"正常",id:0},{label:"警告",id:1},{label:"次要",id:2},{label:"重要",id:3},{label:"严重",id:4}],c.stateDisplayModel=[{label:"不显示",id:0,type:"basic.Text,basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image"},{label:"仅背景",id:1,type:"basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon"},{label:"仅文字",id:2,type:"basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image"},{label:"全显示",id:3,type:"basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon"}],c.stateTypeModel=[{label:"默认",id:0,type:"basic.Text,basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image"},{label:"呼吸灯",id:1,type:"basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image"},{label:"气泡",id:2,type:"basic.Circle"},{label:"呼吸灯(忽略透明)",id:3,type:"basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image"},{label:"气泡(忽略透明)",id:4,type:"basic.Circle"}],c.selectTypes=[{label:"按域选择",id:0},{label:"按设备类型选择",id:1}],c.unitTypes=[{label:"不显示",id:0},{label:"显示",id:1}],c.homeClick=function(e){1==e?location.href="../app-oc/index.html#/dashboard":1==a.dirty?D.show({title:"提示",closable:!1,message:"视图尚未保存，要在退出前保存吗？",buttons:[{label:"保存退出",cssClass:"btn-success",action:function(o){a.save4Json(function(e){o.close(),location.href="../app-oc/index.html#/views/configure"})}},{label:"退出",action:function(e){location.href="../app-oc/index.html#/views/configure"}},{label:"取消",action:function(e){e.close()}}]}):location.href="../app-oc/index.html#/views/configure"},a.indexShow=!1,a.personalShow=!0,c.routePathNodes={};var f=function(e,o){e.count=0;var i,t,a,n,c,s;Math.random();return e.icon=e.icon?e.icon:"fa fa-building-o",e.alertlv="bg-green",e.isLoaded=0,e.type=0,e.text=e.label,e.name=e.label,"Device"==(i=e).type?r.getManagedDevicesByModelId(i.id,function(e){0==e.code&&(i.resources=[{id:0,label:"无"}].concat(e.data),t&&t())}):r.getResourceByModelId(i.id,function(e){0==e.code&&(i.resources=[{id:0,label:"无"}].concat(e.data),t&&t())}),a=e,r.getAttrsByModelId(a.id,function(e){0==e.code&&(a.attrs=e.data,a.isLoaded=a.isLoaded+1,n&&n())}),c=e,r.getDataItemsByModelId(c.id,function(e){0==e.code&&(c.kpis=[{id:0,label:"无"}].concat(e.data))}),s=e,r.getDirectivesByModelId(s.id,function(e){0==e.code&&(s.directives=e.data)}),e},h=function(e){d.getGroupModels(function(o){0==o.code&&r.getModels(function(e){e.data=e.data.concat(o.data),function(e){if(0==e.code){r.rootModelDic={};var o=e.data;for(var i in o){var t=o[i];c.routePathNodes[t.parentModelId]||(c.routePathNodes[t.parentModelId]=[]),c.routePathNodes[t.parentModelId].push(t),c.routePathNodes[t.id]||(c.routePathNodes[t.id]=[]),r.rootModelDic[t.id]=t,f(t)}var a=function e(o){for(var i in c.routePathNodes)if(i==o.id){for(var t in o.nodes=c.routePathNodes[i],o.nodes)e(o.nodes[t]);0==o.nodes.length&&(o.nodes=null)}};for(var n in a(r.rootModel),c.routePathNodes)if(n!=r.rootModel.id&&!r.rootModelDic[n])for(var i in c.routePathNodes[n])a(c.routePathNodes[n][i]),r.rootModel.nodes||(r.rootModel.nodes=[]),r.rootModel.nodes.push(c.routePathNodes[n][i]);r.rootModelDic[r.rootModel.id]=r.rootModel,c.rootModelDic=r.rootModelDic,c.rootModel=r.rootModel,c.treeAry=[{id:0,label:"请选择"}].concat(o),c.typeAry=[{id:0,label:"普通"},{id:1,label:"模板"},{id:2,label:"项目"}]}}(e)})})};c.sidebarMenuClick=function(e,o){c.selectDashboard==e&&0!=e.viewId||(0==(c.selectDashboard=e).viewId?window.open("../app-freeboard/index.html#/freeboard/view/dashboard","_blank"):o?window.open("../app-freeboard/index.html#/freeboard/view/dashboard/"+e.viewId+"/0","_blank"):c.$broadcast("CHANGEDASHBOARDVIEWS",{data:c.selectDashboard}))},c.logout=function(){t.logout()},c.domains=[];var b=function(){s.queryDomainTree(t.user.userID,function(e){c.domainListTree=e.domainListTree,c.domainListDic=e.domainListDic;var o=[{domainPath:"",text:"无"}];!function o(e,i,t){e.forEach(function(e){e.text=function(e){for(var o="",i=0;i<e;i++)o+="*";return o}(i)+e.text,t.push(e),e.nodes&&o(e.nodes,i+2,t)})}(c.domainListTree,0,o),c.domains=o})},g=!1,p=function(){g||(g=!0,r.getRootModel(function(e){0==e.code&&(e.data.name=e.data.label,e.data.text=e.data.label,r.rootModel=e.data,c.selectedParentitem=e.data,h())}))},m=function(o){u.getConfigsByGroupName("EnterpriseConfig",function(e){0==e.code&&(e.data&&0<e.data.length?e.data.forEach(function(e){try{c.baseConfig?c.baseConfig=jQuery.extend(!0,c.baseConfig,JSON.parse(e.value)):c.baseConfig=JSON.parse(e.value),c.baseConfig&&(c.baseConfig.title?$("title").html(c.baseConfig.title):$("title").html(""),c.baseConfig.shortcut?$("link[rel='shortcut icon']").attr("href",c.baseConfig.shortcut+"?"+(new Date).getTime()):$("link[rel='shortcut icon']").attr("href","../login/images/shortcut_null.png?"+(new Date).getTime()))}catch(e){}}):($("title").html(""),$("link[rel='shortcut icon']").attr("href","../login/images/shortcut_null.png?"+(new Date).getTime())),o())}),u.getConfigsByGroupName("ConfigurationViewBG",function(e){0==e.code&&e.data.forEach(function(e){c.configViewBg.push({label:e.label,url:e.value})})}),u.getConfigsByGroupName("ConfigurationCustom",function(e){0==e.code&&e.data.forEach(function(e){try{var o=JSON.parse(e.value);o.attrs.text.text=e.label,c.configCustoms.push(o)}catch(e){}})}),u.getConfigsByGroupName("ConfigurationCommon",function(e){0==e.code&&e.data.forEach(function(e){var o;e.keyDesc=e.keyDesc||"";var i=e.keyDesc.search("{"),t=e.keyDesc.search("}");0==i&&t==e.keyDesc.length-1&&((o=JSON.parse(e.keyDesc)).width=o.width?o.width:128,o.height=o.height?o.height:128);var a={type:"basic.Image",size:{width:60,height:60},attrs:{image:{width:o?o.width:128,height:o?o.height:128,"xlink:href":e.value},text:{text:e.label,"font-size":12,stroke:"#000000",display:"block","stroke-width":0,fill:"#000000","ref-dy":10,"font-family":"Microsoft YaHei"}}};c.configCommons.push(a)})})},y=function(){a.rootModelsDic={},r.rootModelsDic=a.rootModelsDic,r.getModelsByCondition({},function(e){0==e.code&&e.data.forEach(function(t){r.getKpisByModelId(t.id,function(e){0==e.code&&(a.rootModelsDic[t.id]||(a.rootModelsDic[t.id]={}),e.data.forEach(function(e){a.rootModelsDic[t.id].kpiDic||(a.rootModelsDic[t.id].kpiDic={}),c.myOptionDic[e.unit]&&(e.unitLabel=c.myOptionDic[e.unit]);if(e.range){var o=/\{|\[.*\}|\]/.test(e.range),i=[];if(o)try{i=o?JSON.parse(e.range):[]}catch(e){}(e.rangeAry=i)instanceof Array?2==(e.rangeAry=i).length&&(e.min=i[0],e.max=i[1]):i instanceof Object&&(e.rangeObj=i)}a.rootModelsDic[t.id].kpiDic[e.id]=e}))}),r.getDirectivesByModelId(t.id,function(e){0==e.code&&(a.rootModelsDic[t.id]||(a.rootModelsDic[t.id]={}),a.rootModelsDic[t.id].directives=e.data)})})})};t.user.isAuthenticated?(b(),w(function(){y()}),p(),v(),m(function(){t.initMenus(c,i)})):c.$on("loginStatusChanged",function(e,o){t.user.isAuthenticated?(a.staffName=t.user.userName,c.userInfo=t.user,b(),w(function(){y()}),p(),v(),m(function(){t.initMenus(c,i)})):(c.errorMsg=t.result.message,c.errorStatus=1)})}function v(){c.configureView=[{viewId:0,viewTitle:"不可下钻"},{viewId:1,viewTitle:"可下钻，无子视图"}],c.echartView=[{viewId:0,viewTitle:"无"}],c.dashboardView=[],c.selectDashboard=null,n.getAllMyViews(function(e){if(0==e.code){var o=[];e.data.forEach(function(e){"configure"==e.viewType&&c.configureView.push(e),"designView"==e.viewType&&c.echartView.push(e),"dashboard"==e.viewType&&(e.icon="proudsmart ps-yunyingshouye",e.show=!0,o.push(e))}),(o=o.sort(function(e,o){return e.releaseStatus<o.releaseStatus}))[0].show=!1,c.selectDashboard||(c.selectDashboard=o[0]),o.push({viewTitle:"添加自定义工作台",viewId:0,icon:"fa fa-plus-square"}),c.dashboardView=o,c.$broadcast("RAPPIDVIEWS",{data:c.configureView})}})}function w(i){l.getAllUnits(function(e){if(0==e.code){for(var o in l.units=e.data,c.myOptions=e.data,l.unitDics={},c.myOptions)l.unitDics[c.myOptions[o].unitCode]=c.myOptions[o].unitName,"NA"!=c.myOptions[o].unitCode&&"Number"!=c.myOptions[o].unitCode||(l.unitDics[c.myOptions[o].unitCode]="");c.myOptionDic=l.unitDics,i&&i()}})}}])});
//# sourceMappingURL=../../map/js/controllers/configure-ctrl.js.map
