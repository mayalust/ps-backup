define(["controllers/controllers","Array"],function(e){"use strict";e.initController("RappidViewsCtrl",["$scope","viewFlexService","$timeout","growl","dialogue",function(c,s,e,u,d){s.getAllMyViews(function(e){if(0==e.code){var t=e.data.filter(function(e){return"configure"==e.viewType});c.viewlist={source:t,header:[{label:"新建组态视图",icon:"fa fa-plus",type:"button",class:"btn btn-primary btn-sm",style:{margin:"2px"},events:{click:function(){event;var t="新建组态视图",i=t,e=c.viewlist.source.some(function(e){return t==e.viewTitle});if(e)for(var n=1;e;)i=t+n,n++,e=c.viewlist.source.some(function(e){return i==e.viewTitle});var l=[{label:"创建组态视图",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(e){var t={viewType:"configure",viewTitle:e.input[0].value,viewHierarchy:e.input[1].value,description:e.input[2].value};s.addView(t,function(e){0==e.code&&(u.success("复制组态视图["+e.data.viewTitle+"]成功",{}),d.close(),location.href="../app-configure/index.html#/configure/"+e.data.viewId)})}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){d.close()}}];d.open({title:{label:"新建组态视图"},input:[{value:i,composory:!0,type:"input",label:"组态视图名称",placeholder:"组态视图名称",onChange:function(e){var t=this.value,i=c.viewlist.source.find(function(e){return e.viewTitle==t});l[0].disabled=i?(e.error="此视图名已被占用，请更换.",!0):""==t?(e.error="视图名不可为空.",!0):(e.error=null,!1)}},{value:"",type:"input",composory:!1,label:"视图层级",placeholder:"层级结构，例如 0/1"},{value:"描述信息",type:"textarea",composory:!1,label:"描述信息",placeholder:"新视图名称"}],fnlist:l})}}},{label:"删除",icon:"fa fa-plus",type:"button",visible:function(e){return!e.some(function(e){return 1==e.selected})},class:"btn btn-default btn-sm",style:{margin:"2px"},events:{click:function(e){var i=e,t=e.map(function(e){return e.viewId}),n=e.map(function(e){return e.viewTitle}),l=[{label:"是",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){d.close(),s.deleteViews(t,function(e){if(0==e.code)for(var t in u.success("组态视图 [ "+n.toString()+" ] 删除成功",{}),i)i[t].remove()})}},{label:"否",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){d.close()}}];d.open({title:{label:"删除组态视图"},description:{label:"确认要删除组态视图   [ "+n.toString()+" ]  吗？"},fnlist:l})}}}],columnDefs:[{label:"视图名称",data:"viewTitle",type:"text",filterable:!0,sortable:!0},{label:"视图层级",data:"viewHierarchy",type:"text",filterable:!0,sortable:!0},{label:"视图描述",data:"description",type:"text",format:function(e){return null==e?"-":e},filterable:!0,sortable:!0},{label:"创建时间",data:"createTime",type:"date",format:"yy-mm-dd, hh:nn:ss",filterable:!1,sortable:!0},{label:"更新时间",data:"updateTime",type:"date",format:"yy-mm-dd, hh:nn:ss",filterable:!1,sortable:!0},{label:"操作",width:141,type:"buttonGroup",filterable:!1,sortable:!1,options:[{label:"设计",type:"button",class:"btn btn-primary",events:{click:function(e){location.href="../app-configure/index.html#/configure/"+e.viewId}}},{label:"查看",type:"button",events:{click:function(e){location.href="../app-configure/index.html#/display/"+e.viewId}}},{label:"编辑",type:"button",events:{click:function(e){var i=e,n=[{label:"编辑组态视图",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(e){var t={viewType:"configure",viewId:i.viewId,viewTitle:e.input[0].value,viewHierarchy:e.input[1].value,description:e.input[2].value};s.updateView(t,function(e){0==e.code&&(u.success("更新组态视图["+e.data.viewTitle+"]成功",{}),d.close(),i.description=e.date.description,i.hierarchy=e.date.hierarchy)})}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){d.close()}}];d.open({title:{label:"编辑视图信息"},input:[{value:e.viewTitle,composory:!0,type:"input",label:"组态视图名称",placeholder:"组态视图名称",onChange:function(t){var i=this.value,e=c.viewlist.source.find(function(e){return e.viewTitle==i&&e.viewTitle!=t.viewTitle});n[0].disabled=e?(t.error="名已被占用，请更换.",!0):""==i?(t.error="视图名不可为空.",!0):(t.error=null,!1)}},{value:e.viewHierarchy,type:"input",composory:!1,label:"视图层级",placeholder:"层级结构，例如 0/1"},{value:e.description,type:"textarea",composory:!1,label:"描述信息",placeholder:"新视图名称"}],fnlist:n})}}},{label:"删除",type:"button",events:{click:function(e){var t=e,i=e.viewId,n=e.viewTitle,l=[{label:"是",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){d.close(),s.deleteViews([i],function(e){0==e.code&&(u.success("组态视图 [ "+n+" ] 删除成功",{}),t.remove())})}},{label:"否",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){d.close()}}];d.open({title:{label:"删除组态视图"},description:{label:"确认要删除组态视图   [ "+n+" ]  吗？"},fnlist:l})}}},{label:"复制",type:"button",events:{click:function(e){var i=e,t=e.viewTitle+"_复制",n=t,l=e.content,o=c.viewlist.source.some(function(e){return n==e.viewTitle});if(o)for(var r=1;o;)n=t+r,r++,o=c.viewlist.source.some(function(e){return n==e.viewTitle});var a=[{label:"创建",icon:"btn btn-success",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(e){var t={viewType:"configure",viewTitle:e.input[0].value,content:l};s.addView(t,function(e){0==e.code&&(u.success("复制组态视图["+e.data.viewTitle+"]成功",{}),d.close(),i.insertAfter(e.data))})}},{label:"取消",icon:"btn btn-default",style:{width:"50%","border-radius":0,"font-size":"18px","font-weight":"bold",padding:10},fn:function(){d.close()}}];d.open({title:{label:"复制视图"},input:[{value:n,composory:!0,label:"新视图名称",placeholder:"新视图名称",onChange:function(e){var t=this.value,i=c.viewlist.source.find(function(e){return e.viewTitle==t});a[0].disabled=i?(e.error="此视图名已被占用，请更换.",!0):""==t?(e.error="视图名不可为空.",!0):(e.error=null,!1)}}],fnlist:a})}}}]}]}}})}])});
//# sourceMappingURL=../../map/js/controllers/rappid-views-ctrl.js.map
