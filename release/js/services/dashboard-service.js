define(["../services/services.js"],function(e){"use strict";function t(e,o,a,t,l,c,i,r,n,u,s,d,f){var v={};o.defer();v.$rootDomain=Object.create({get:function(){var t=this,a=o.defer();return t.valueCached?a.resolve(t.valueCached):l.getRootDomain(function(e){try{if(!e.data)throw"rootCi is undefined !!";t.valueCached=e.data,a.resolve(e.data)}catch(e){a.reject(e)}},function(e){}),a.promise}}),v.$units=Object.create({get:function(){var t=this,a=o.defer();return t.valueCached?a.resolve(t.valueCached):i.getAllUnits(function(e){try{if(!e.data)throw"rootCi is undefined !!";t.valueCached=e.data,a.resolve(e.data)}catch(e){a.reject(e)}},function(e){}),a.promise}}),v.$resources=Object.create({get:function(){var a=this,i=o.defer();return a.valueCached?i.resolve(a.valueCached):v.$rootDomain.get().then(function(t){l.getResources(function(e){try{if(!e.data)throw"data is undefined !!";t.label="企业",a.valueCached=[t],a.valueCached=a.valueCached.concat(e.data),i.resolve(a.valueCached)}catch(e){i.reject(e)}},function(e){})},function(e){}),i.promise},getCurrent:function(){var t=this,a=o.defer();if(t.valueCached){var e=t.valueCached.slice(1);a.resolve(e)}else l.getResources(function(e){try{if(!e.data)throw"data is undefined !!";rootCi.label="企业",t.valueCached=[e.data],a.resolve(t.valueCached)}catch(e){a.reject(e)}},function(e){});return a.promise},getModelIdByNodeId:function(t){var e=this.valueCached.filter(function(e){return e.id==t});if(0<e.length)return e[0].modelId},getAttrByNodeId:function(a){var n=o.defer();return this.get().then(function(e){var r=e.filter(function(e){return e.id==a});0<r.length&&(r[0].attributes?n.resolve(r[0].attributes):l.getResourceByIds([a],function(e){try{if(!e)throw"data is undefined !!";var i=e[a].values,t=r[0].modelId;l.getAttrsByModelId(t,function(e){try{if(!e.data)throw"data is undefined !!";for(var t in r.attributes=e.data,r.attributes)(a=r.attributes[t]).value=i[a.name];n.resolve(e.data)}catch(e){n.reject(e)}var a},function(e){n.reject(e)})}catch(e){n.reject(e)}},function(e){n.reject(e)}))}),n.promise}}),v.$kpis=Object.create({models:[],valueCached:[],getByKpiIds:function(e){var i=this,r=o.defer(),n=[],a=[];return function(){for(var e in arguments)!function(t){var e=i.valueCached.filter(function(e){return t==e.id});0<e.length?n.push(e[0]):a.push(t)}(arguments[e])}.apply(null,e),0<a.length?l.getKpisByKpiIds(a,function(e){try{if(!e)throw"data is undefined !!";var t=[];for(var a in delete e.minTimespan,e)t.push(e[a]),i.valueCached.push(e[a]);r.resolve(n.concat(t))}catch(e){r.reject(e)}},function(e){}):r.resolve(n),r.promise},getBymodelId:function(a){var i=this,r=o.defer();if(-1!=i.models.indexOf(a)){var e=i.valueCached.filter(function(e){return e.modelId==a});r.resolve(e)}else l.getKpisByModelId([a],function(e){try{if(!e.data)throw"data is undefined !!";for(var t in e.data)e.data[t].modelId=a;i.models.push(a),i.valueCached=i.valueCached.filter(function(e){return e.modeId!=a}),i.valueCached=i.valueCached.concat(e.data),r.resolve(e.data)}catch(e){r.reject(e)}},function(e){});return r.promise}}),v.$rootKpis={get:function(){var a=this,i=o.defer();return v.$rootDomain.get().then(function(e){var t=e.modelId;v.$kpis.getBymodelId(t).then(function(e){a.valueCached=e,i.resolve(e)},function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise}},v.$resources.get().then(function(e){v.resources=e},function(e){}),v.$rootKpis.get().then(function(e){v.kpis=e},function(e){});(function(){for(var e in arguments)t=arguments[e],v[t.label]=[Object.create(null,{id:{enumerable:!1,writable:!1,id:$randomString(32)},type:{enumerable:!0,writable:!1,value:t.label},attributes:{enumerable:!0,writable:!0,value:{}}})];var t}).apply(v,[{label:"totalItems"},{label:"progress"},{label:"downTab"},{label:"attrTab"},{label:"header"},{label:"map"}]),v.listone=[Object.create(null,{id:{enumerable:!1,writable:!1,value:$randomString(32)},type:{enumerable:!0,writable:!1,value:"listone"},attributes:{enumerable:!0,writable:!0,value:{fun:"resourceUIService.getLatestDevices"}}})],v.resetClick=function(){"function"==typeof v.changeView&&v.changeView(JSON.parse(JSON.stringify(d)))},v.listtwo=[Object.create(null,{id:{enumerable:!1,writable:!1,value:$randomString(32)},type:{enumerable:!0,writable:!1,value:"listtwo"},attributes:{enumerable:!0,writable:!0,value:{fun:"ticketTaskService.getTicketsByStatus"}}})];function p(e,t,a,i){var r=o.defer(),n=["kpi",{category:a,isRealTimeData:!0,timePeriod:"time"==a?i:0,nodeIds:e,kpiCodes:t,startTime:null,endTime:null,timeRange:"",statisticType:"psiot",condList:[]}];return c.getValueList(n,function(e){try{if(0!=e.code)throw"cannot get value list!";if(!e.data)throw"event.data is undefined!";r.resolve(e.data)}catch(e){r.reject(e)}}),r.promise}return function(){var e,t=this;for(var a in arguments)e=arguments[a],t[e.label]=[Object.create(null,{id:{enumerable:!1,writable:!1,value:$randomString(32)},type:{enumerable:!0,writable:!1,value:e.label},attributes:{enumerable:!0,writable:!0,value:{}},kpiObjects:{enumerable:!0,writable:!0,value:[]}})]}.apply(v,[{label:"basicline"},{label:"basicpie"}]),v.alertcommon=[Object.create(null,{id:{enumerable:!1,writable:!1,value:$randomString(32)},type:{enumerable:!0,writable:!1,value:"alertcommon"},attributes:{enumerable:!0,writable:!0,value:{type:"alert"}},kpiObjects:{enumerable:!0,writable:!0,value:[]}})],v.sparkline=[Object.create(null,{id:{enumerable:!1,writable:!1,value:$randomString(32)},type:{enumerable:!0,writable:!1,value:"sparkline"},attributes:{enumerable:!0,writable:!0,value:{}},kpiObjects:{enumerable:!0,writable:!0,value:[]}})],v.removeKpi=function(t,e){e.kpiObjects=e.kpiObjects.filter(function(e){return e!=t});var a=[];for(var i in e.kpiObjects)a.push(e.kpiObjects[i].id);e.attributes.kpi=a},v._EDITMODE_="editmode",v._VIEWMODE_="viewmode",v.layouts=[{id:$randomString(32),type:"layout",cols:[{col:12}]},{id:$randomString(32),type:"layout",cols:[{col:6},{col:6}]},{id:$randomString(32),type:"layout",cols:[{col:8},{col:4}]},{id:$randomString(32),type:"layout",cols:[{col:4},{col:8}]},{id:$randomString(32),type:"layout",cols:[{col:2},{col:4},{col:6}]},{id:$randomString(32),type:"layout",cols:[{col:4},{col:4},{col:4}]},{id:$randomString(32),type:"layout",cols:[{col:3},{col:3},{col:3},{col:3}]},{id:$randomString(32),type:"layout",freeStyle:!0,cols:[{col:2},{col:4},{col:6}]}],v.getViews=function(e){var n=o.defer();v.dashboardView=n.promise,e?s.getManageViewContent(e,function(e){var t,r;"0"==e.code&&(t=null!=e.data&&null!=e.data?e.data:void 0,r=t,a.getAllMyViews(function(e){var t=new $Array(e.data),a=new $Array(t.findAll("viewType","designView")),i=[];if(a.each(function(e){var t,a=e.content;a&&(t=JSON.parse(a)),i.push({id:$randomString(32),type:"designView",content:t,view:e})}),null!=r&&null!=r)try{if(!r)throw"dashboardView is empty!!";JSON.parse(r),n.resolve({data:JSON.parse(r)})}catch(e){n.reject(e)}else v.$rootDomain.get().then(function(e){e.id,n.resolve({data:JSON.parse(JSON.stringify(d))})});v.designViews=i}))}):a.getManageDashboard(function(e){var r;r=null==e.data?solutionDashboard:e.data,a.getAllMyViews(function(e){var t=new $Array(e.data),a=new $Array(t.findAll("viewType","designView")),i=[];if(a.each(function(e){var t,a=e.content;a&&(t=JSON.parse(a)),i.push({id:$randomString(32),type:"designView",content:t,view:e})}),null!=r&&null!=r&&"dashboard"==r.viewType)try{if(!r.content)throw"dashboardView is empty!!";JSON.parse(r.content),n.resolve({viewId:r.viewId,data:JSON.parse(r.content)})}catch(e){n.reject(e)}else null!=r&&null!=r&&"designView"!=r.viewType||v.$rootDomain.get().then(function(e){e.id,n.resolve({data:JSON.parse(JSON.stringify(d))})});v.designViews=i})})},v.getValueByRootKpi=function(t){var a=o.defer();return v.$rootDomain.get().then(function(e){p([e.id],[t],"ci",0).then(function(e){e[0]?a.resolve(e[0].value):a.resolve(0)},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},v.getValueListByRootKpis=function(t){var a=o.defer();return v.$rootDomain.get().then(function(e){p([e.id],t,"time",6048e5).then(function(e){e[0]?a.resolve(e):a.resolve([])},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},v.getValueByCiKpi=function(e,t){var a=o.defer();return p([e],[t],"ci",0).then(function(e){e[0]?a.resolve(e[0].value):a.resolve(0)},function(e){a.reject(e)}),a.promise},v}e.factory("basicline",function(){var e={},t={title:"title",elements:[{category:"time",dataType:{type:"line",limit:{onlyDifferentKpi:!1},category:{time:{replace:!0,category:"time",series:{model:"linear",value:"ci"},xAxis:!0,legend:!0}}},option:{animation:!1,grid:{left:"0%",top:"15%",width:"90%",height:"80%",containLabel:!0},title:{text:"",subtext:""},tooltip:{trigger:"axis"},legend:{data:["室内温度","室外温度"]},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:["4/19","4/20","4/21","4/22","4/23","4/24","4/25"]}],yAxis:[{type:"value",axisLabel:{formatter:"{value}"}}],series:[{name:"室内温度",type:"line",data:function(){for(var e=[],t=0;t<7;t++)e.push(parseInt(100*Math.random()))}(),markPoint:{data:[{type:"max",name:"最大值"}]},markLine:{data:[{type:"max",name:"最大标准值"},{type:"min",name:"最小标准值"}]}}]},type:"line",formatStr:"月日",nodes:[],theme:"macarons",timespan:parseInt(6912e5),layout:{width:100,widthheightPortion:.6,row:0,col:0}}]};return e.getOption=function(){var e=JSON.parse(JSON.stringify(t));return 0,e},e}),e.factory("basicpie",function(){var e={},t={title:"title",elements:[{category:"ci",dataType:{type:"pie",limit:{onlyDifferentKpi:!1},category:{ci:{replace:!0,category:"ci",series:{model:"linear",value:"ci"},xAxis:!1,legend:!1}}},option:{title:{text:"",subtext:"",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:["提花机A－产量","提花机B－产量","提花机C－产量","提花机D－产量","提花机E－产量"]},calculable:!0,series:[{name:"访问来源",type:"pie",radius:"60%",center:["50%","50%"],data:[{value:335,name:"提花机A－产量"},{value:310,name:"提花机B－产量"},{value:234,name:"提花机C－产量"},{value:135,name:"提花机D－产量"},{value:1548,name:"提花机E－产量"}]}]},type:"line",nodes:[],theme:"macarons",timespan:0,layout:{width:100,widthheightPortion:.6,row:0,col:0}}]};return e.getOption=function(){return JSON.parse(JSON.stringify(t))},e}),e.factory("variables",t),t.$inject=["$rootScope","$q","viewFlexService","Info","resourceUIService","kpiDataService","unitService","ticketService","growl","$route","solutionUIService","defaultDashboard","userLoginUIService"]});
//# sourceMappingURL=../../map/js/services/dashboard-service.js.map
