function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["../services/services.js"],function(e){"use strict";e.factory("freeboardBaseService",["$rootScope","serviceProxy","SwSocket","userDomainService","weatherService","kqiManagerUIService","customMethodService","dictionaryService","energyConsumeUIService","serviceCenterService","userLoginUIService","viewFlexService","$q","$timeout","$route","$routeParams","resourceUIService","Info","growl","chartOptionService","angular-style","ticketTaskService","alertService","kpiDataService","ngDialog","projectUIService","thridPartyApiService","$compile","$controller","FileUploader","ajax","psTopo",function(Z,ee,te,re,ae,ne,oe,ie,de,ce,se,le,pe,ve,ue,fe,me,be,ye,$e,ge,he,we,xe,Se,ke,Ie,Ce,t,r,De,je){return function(e){var a=e,z={},X={},B=!1,W=!0,G={greedy:!0,drop:function(e,t){z.onDrop({event:e,ui:t,before:!1})}},R=0;function H(e,t){$("#drawarea").css("overflow-y","hidden");var r=$(e.target).attr("id");$("#"+r+".empty").addClass("hideElement"),$("#"+r+".row").addClass("hideElement")}function V(e,t){$("#drawarea").css("overflow-y","auto");var r=$(e.target).attr("id");$("#"+r+".empty").removeClass("hideElement"),$("#"+r+".row").removeClass("hideElement")}function K(e,t){z.onDrop({event:e,ui:t,before:!0})}function Q(e,t){$(e.target).attr("id")!=t.draggable.attr("id")&&$(e.target).addClass("hover")}function Y(e,t){$(e.target).removeClass("hover")}return Z.fileFormat="xls、xlsx、pdf、doc、docx、jpg、png、jpeg、bmp、gif、svg、pptx、ppt|DOCX|PNG|JPEG|DOC|JPG|XLX|XLSX",Z.fileMaxSize=10,Z.serviceOrigin="/api/rest/upload/resourceFileUIService/uploadResourceFile",t("AppUploadCtrl",{$scope:Z,growl:ye,FileUploader:r}),X.renderLayout=function(A,e,L){var r;if($("body").find("#popup_background").remove(),X.rootTarget=A,$$.runExpression(A.setting,function(e){if("0"==e.code){var t=e.data;r=(r="function"==typeof t?t(data,system):t)||{}}else r={}}),0==$("link[href*=\\.\\.\\/css\\/theme\\/"+(r.theme||"default")+"\\.css]").size()){var t=$("<link />");t.attr("href","../css/theme/"+(r.theme||"default")+".css"),t.attr("rel","stylesheet"),$("head").append(t)}$(".drawarea").css(r.style||{padding:"15px"}),function(e){$(a).children().remove();var t=$("<div class='wrap'></div>");function q(t,r,a,n){for(var o in r){var i,e=r[o].col,d=(e="object"==_typeof(e)?e:[e,0])[0]+(e[1]?"-"+e[1]:"");if(r[o].allNum>r[o].maxNum){var c="",s=r[o].allNum%r[o].maxNum;Math.floor(r[o].allNum/r[o].maxNum),"up"==r[o].updown&&o==s-1&&(0==o?c="margin-right:40%":1==o&&(c="margin-right:20px"))}a?"tabItem"==r[o].type?(i=$("<div tabId='tabId_"+o+"' class='col-md-12'></div>")).addClass("tab-content"):e&&(i=$('<div style="'+c+'" class="col-md-'+d+'"></div>')):"tabItem"==r[o].type?(i=$("<div tabId='tabId_"+o+"' class='col-md-12'></div>")).addClass("tab-content"):i=$("<div class='col-md-"+r[o].col+" column'></div>"),"ROW"==r[o].$attr("parent/parent/source")&&"float"==r[o].$attr("parent/parent/parameters/alignment")&&i.css("width","auto");var l=$("<div class='wrap'></div>"),p=function(e){i&&(t.append(i),a||(i.append(l),i.attr("id",r[o].id)),F(e,r[o].children,a,n))};a?"tabItem"==r[o].type?r.parent&&(null!=r.parent.tabInx?o==r.parent.tabInx&&r[o].children&&0<r[o].children.length&&p(i):r[o].default&&p(i)):r[o].children&&0<r[o].children.length&&p(i):"tabItem"==r[o].type?r.parent&&(null!=r.parent.tabInx?o==r.parent.tabInx&&p(i):r[o].default&&p(i)):p(l)}}function J(e,t){if(e){var r=document.createElement("style");return r.setAttribute("type","text/css"),r.innerHTML=e,document.body.appendChild(r),ve(function(){r&&(r.onload=function(e){t&&t(e)})}),function(){r.remove(),r=null}}}function T(e,t){var r="",a="#item_"+e+".box-header .box-title {";for(var n in t)"background-color"!=n?a+=n+":"+t[n]+";":r=n+":"+t[n]+";";return a+="} ",a+="#item_"+e+".box-header {",a+=r,a+="} ",X[e]=a,X[e]}function F(P,U,_,O){F.promises=F.promises||[];var e=$("<div class='emptyEnd'></div>"),N=!1;for(var t in $(P).attr("id")?e.attr("id",$(P).attr("id")):e.attr("id",$(P).parent().attr("id")),U)!function(a,n){var o,i,e,t=n.id,d=$("<div class='wrap'></div>"),r=$("<div class='btn'><span class='proudsmart ps-edit'></span></div>"),c=$("<div id='move' class='btn move'><span class='proudsmart ps-move'></span></div>"),s=$("<div id='data' class='btn'><span class='proudsmart ps-linked-data'></span></div>"),l=$("<div id='beforeDom' class='empty'></div>"),p=$("<div class='btn'><span class='proudsmart ps-delete'></span></div>"),v=$("<button class='btn'><span class='glyphicon glyphicon-duplicate'></span></button>"),u=$("<div class='btn'><span class='glyphicon glyphicon-duplicate'></span></div>"),f=$("<div class='btn'><span class='glyphicon glyphicon-scissors'></span></div>"),m=$("<div class='tool'></div>"),b=$("<div></div>").text(n.label).css("padding","0 15px").css("color","#fff").css("background-color","#3c8dbc").css("float","left").css("font-weight","bold"),y=$("<div class='tabWrap'></div>"),g=$("<h3 class='box-title'>标题标题</h3>"),h=$('<div class="box-tools pull-right">\t\t\t\t\t\t\t\t\t\t<button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>\t\t\t\t\t\t\t\t\t</div>');if(m.append(b),m.append(p),m.append(v),m.append(f),"box"==n.type){g.css("width","100%"),m.append(r);var w=$("<div id='item_"+t+"' class='box-header with-border'></div>");w.append(g),X[t]&&X[t]();var x={"font-size":n.parameters["font-size"]||"12px","text-align":n.parameters["text-align"]||"left","font-weight":n.parameters["font-weight"]||"bold","background-color":n.parameters["background-color"]||"transparent"};X[t]=J(T(t,x)),(i=$("<div class='row column'></div>")).append(w),_?w.append(h):i.append(m)}else"box-body"==n.type?((e=$("<div class='instruct'></div>")).text("内容区"),_?i=$("<div></div>"):(i=$("<div class='row column'></div>")).append(e)):"box-footer"==n.type?((e=$("<div class='instruct'></div>")).text("注释区"),_?i=$("<div></div>"):(i=$("<div class='row column'></div>")).append(e)):"block"==n.type?_?i=$("<div class='row block'></div>"):(i=$("<div class='row column block'></div>")).append(m):"tab"==n.type?(_?i=$("<div class='row'></div>"):(i=$("<div class='row column'></div>")).append(m),n.style&&i.css(n.style),i.append(y)):_?i=$("<div class='row'></div>"):(i=$("<div class='row column'></div>")).append(m);var S,k,I=$("<div></div>");S=_?P:d,(k=I)&&S.append(k),o=$("<div></div>"),n.parameters&&g.text(n.parameters.title);var C,D,j=(C=pe.defer(),D=R,C.id=D,$$.loadExternalJs(["../toolkit/component/data-switch.js"],function(e){var t=e(n),r="toolkit/component/"+t.type;"column"!=t.type&&"tabItem"!=t.type&&$$.loadExternalJs([r],function(e){console.assert("function"==typeof e,r+"加载失败！"+_typeof(e));var t=e({Info:be,global:A.layout,location:location,window:window,index:a,element:n,scope:L||Z,rootScope:Z,compile:Ce,ngDialog:Se,wholeJSON:A,serviceCenterService:ce,chartOptionService:$e,projectUIService:ke,thridPartyApiService:Ie,userLoginUIService:se,angularStyle:ge,traverseRow:F,timeout:ve,target:_?i:d,tabWrap:y,customMethodService:oe,energyConsumeUIService:de,dictionaryService:ie,targetDom:P,coldomInner:d,kqiManagerUIService:ne,growl:ye,defer:C,tElement:o,rowDom:i,ajax:De,psTopo:je,userDomainService:re,weatherService:ae,serviceProxy:ee,viewFlexService:le,previewMode:_,resourceUIService:me,ticketTaskService:he,buttonEnabled:W,alertService:we,onTabClick:z.onTabClick,SwSocket:te,kpiDataService:xe,route:ue,routeParam:fe,q:pe,imageslist:ge.getParameters().imgSrc.options.map(function(e){return e.value}),traverseColumn:q})||{};"function"==typeof O&&O(n,t),t.underWatch||C.resolve("not under watch!!"),I.after(t),I.remove()})}),C.promise.$$state.dom=n,C.promise.id=D,R++,C.promise);if(F.promises.push(j),m.append(r),m.append(c),_||(i.append(d),i.attr("id",n.id),i.draggable({cursor:"move",revert:!0,handle:c,start:H,stop:V,cursorAt:{right:30},helper:function(e){var t=$("<div class='colDrag row'><div class='col-xs-12'><div class='row title'>移动一个区块去其它位置</div><div class='row' id='grid'></div></div></div>");return t},appendTo:$(".drawarea"),containment:$(".drawarea"),revertDuration:0,zIndex:999})),"whole"!=P.attr("id")&&0<U.length&&l.attr({id:n.id}),!B){"function"==typeof l.contextMenu&&l.contextMenu("myMenu1",{bindings:{paste:function(e){var t=$(e).attr("id");z.onInsert({id:t})},json:function(e){var t=$(e).attr("id");z.onInsertJSON({id:t})}}}),p.attr({id:n.id}),p.on("click",function(e,t){Z.$apply(function(){z.onDelete({event:e,ui:t})})}),f.attr({id:n.id}),f.on("click",function(e,t){Z.$apply(function(){z.onCut({event:e,ui:t})})});var E=n.$clone();delete E.$index,delete E.id,delete E.template,E.hasOwnProperty("url")||(E.url="images/map/map1.png"),v.attr({id:n.id,"data-clipboard-text":JSON.stringify(E,null,2)}),$$.loadExternalJs(["clipboard"],function(e){var t=new e(v[0]);t.on("success",function(e){Z.$apply(function(){e.id=n.id,z.onCopy({event:e})}),ye.success("成功复制到剪切版"),e.clearSelection()}),t.on("error",function(e){console.error("Action:",e.action),console.error("Trigger:",e.trigger)})}),u.attr({id:n.id}),r.attr({id:n.id}),s.attr({id:n.id}),r.on("click",function(e,t){Z.$apply(function(){z.onSetting({event:e,ui:{element:o}})})}),s.on("click",function(e,t){Z.$apply(function(){z.onDataChange({event:e,ui:t})})})}"box-body"!=n.type&&"box-footer"!=n.type?_||P.append(l):N=!0,_&&"col"!=n.type&&"row"!=n.type&&"box"!=n.type&&"box-body"!=n.type&&"box-footer"!=n.type&&"block"!=n.type&&"tab"!=n.type||P.append(i);var M=G.$clone();M.over=Q,M.out=Y,M.drop=K,"function"==typeof l.droppable?l.droppable(M):require(["jquery-ui"],function(){l.droppable(M)}),_?"box"==n.type?F(i,n.children,_,O):"repeater"!=n.type&&"injector"!=n.type&&n.children&&0<n.children.length&&q(i,n.children,_,O):"box"==n.type?F(d,n.children,_,O):"repeater"!=n.type&&"injector"!=n.type&&n.children&&0<n.children.length&&q(d,n.children,_,O)}(t,U[t]);var r=G.$clone();return r.over=Q,r.out=Y,"function"==typeof e.droppable?e.droppable(r):require(["jquery-ui"],function(){e.droppable(r)}),N||_||(P.append(e),$$.loadExternalJs(["contextmenu"],function(){e.contextMenu("myMenu1",{bindings:{paste:function(e){var t=$(e).attr("id");z.onPaste({id:t})},json:function(e){var t=$(e).attr("id");z.onPasteJSON({id:t})}}})})),F.promises}e.fire=function(a,n){ve(function(){e.traveseByChild(function(t){var r;if(t&&t.advance&&t.advance.expression&&$$.runExpression(t.advance.expression,function(e){0==e.code&&(t.source,r=(r=e.data)||{})}),r){var e=r.$attr("on/"+a);e&&e({target:t,element:t,global:A.layout,params:n})}})})},e.variable=function(t){var r=null;return null==window.variable&&(window.variable={}),window.variable[t]?r=window.variable[t]:e.traveseByChild(function(e){e.$attr("advance/variable")==t&&(r=e,window.variable[t]=e)}),r},e.traverse(function(e,t){t.hasOwnProperty("__onChange__")&&(t.oldValue=t.value)}),B||($(a).attr("id",e.id),"function"==typeof t.droppable?t.droppable({greedy:!0}):require(["jquery-ui"],function(){t.droppable({greedy:!0})})),B?F($(a),e.children,B):($(a).append(t),F(t,e.children,B))}(A.layout)},X.setMode=function(e){B=e},X.setButtonDisable=function(e){W=!1},X.addEvents=function(e){for(var t in e)a=e[r=t],z[r]=a;var r,a},X}}])});
//# sourceMappingURL=../../map/js/services/free-board-base-service.js.map
