define(["../services/services.js"],function(i){"use strict";i.factory("kpiDataService",["serviceProxy",function(c){var i={},l="kpiDataFlexService",u="includeFields="+["arisingTime","granularityUnit","instance","kpiCode","modelId","nodeId","value"].toString();return i.getRealTimeKpiData=function(i,e,t,n,a,s){a||(a=u);var r=["kpi",{isRealTimeData:!0,timePeriod:0,nodeIds:i,kpiCodes:e,includeInstance:n}];c.get(l,"getKpiValueList",r,t,s,a)},i.queryDeviceData=function(i,e,t){t||(t=u);var n=["kpi",i];c.get(l,"getKpiValueList",n,e,null,t)},i.getRealTimeKpiDataWithKpiInfo=function(i,e,t){var n=["kpi",{category:"ci",isRealTimeData:!0,timePeriod:0,nodeIds:i,kpiCodes:e,startTime:null,endTime:null,timeRange:"",statisticType:"psiot",condList:[]}];c.get(l,"getKpiHierarchyValueList",n,t)},i.getKpiHierarchyValueList=function(i,e){c.get(l,"getKpiHierarchyValueList",i,e)},i.exportKpiValueList=function(i,e){c.get(l,"exportKpiValueList",i,e)},i.getValueList=function(i,e,t){t||(t=u),c.get(l,"getKpiValueList",i,function(i){e(i)},null,t)},i.getKpiValList=function(i,e,t){t||(t=u);var n={category:"time",isRealTimeData:!0,timePeriod:0,nodeIds:[],kpiCodes:[],startTime:null,endTime:null,timeRange:"",statisticType:"psiot",condList:[]};n=function(i,e){for(var t in e)i[t]=e[t];return i}(n,i),c.get(l,"getKpiValueList",["kpi",n],function(i){e(i)},null,t)},i.getKpiValueList=function(s,r,i){i||(i=u);var o={code:0,data:{recordList:[]},source:null,nodesDic:{},kpisDic:{},kpisNDic:{},insDic:{}},d=function(i,e){var t=o.data.recordList[o.data.recordList.length-1],n=newDateJson(i.arisingTime).getTime();if(0==t.milliseconds&&(t.milliseconds=n,t.arisingTime=i.arisingTime,t.time=i.arisingTime),n<t.milliseconds+e.kpisDic.minTimespan)i.instance?(o.insDic[i.instance]=i.instance,t[i.nodeId+"?"+i.kpiCode+"?"+i.instance]=i.value):t[i.nodeId+"?"+i.kpiCode]=i.value;else{var a={milliseconds:n,arisingTime:i.arisingTime,time:i.arisingTime};i.instance?(o.insDic[i.instance]=i.instance,a[i.nodeId+"?"+i.kpiCode+"?"+i.instance]=i.value):a[i.nodeId+"?"+i.kpiCode]=i.value,o.data.recordList.push(a)}};c.get(l,"getKpiValueList",s,function(i){if(0==i.code){o.source=i.data;var e=s[1];if(0<i.data.length&&0<e.timePeriod)newDateJson(i.data[0].arisingTime).getTime(),newDateJson(i.data[i.data.length-1].arisingTime).getTime(),e.kpisDic.minTimespan;for(var t in i.data){var n=i.data[t];if(o.nodesDic[n.nodeId]=e.nodesDic[n.nodeId].label,o.kpisDic[n.kpiCode]=e.kpisDic[n.kpiCode].label,o.kpisNDic[e.kpisDic[n.kpiCode].name]=n.kpiCode,0==o.data.recordList.length&&o.data.recordList.push({milliseconds:0}),0==e.timePeriod){var a=o.data.recordList[0];a[n.nodeId+"?"+n.kpiCode]=n.value,a.arisingTime=n.arisingTime,a.time=n.arisingTime}else d(n,e)}}r(o)},null,i)},i.getChartProperty=function(i,e){for(var t in i.properties.item){var n=i.properties.item[t];if(n.name==e)return n}},i.getKpisInfo=function(i){var e=[],t={},n=i.dataSource.displayKpiSet.displayKpi;if(jQuery.isArray(n))for(var a in n){var s=n[a];e.push(Number(s.code)),t[s.code]=s.name}else e.push(Number(n.code)),t[n.code]=n.name;return[e,t]},i.getNodesInfo=function(i){var e,t=[];for(var n in i.dataSource.filters.filter){var a=i.dataSource.filters.filter[n];if("ci"==a.type){var s=a.nodeIds.split(",");for(var r in s)t.push(Number(s[r]))}else"time"==a.type&&(e=60*Number(a.timePeriod)*1e3)}return[t,e]},i.mergeKpiHandler=function(i,e,t){var n=t.data.recordList[t.data.recordList.length-1],a=newDateJson(i.arisingTime).getTime();if(a<n.milliseconds+e.kpisDic.minTimespan)i.instance?(t.insDic[i.instance]=i.instance,n[i.nodeId+"?"+i.kpiCode+"?"+i.instance]=i.value):n[i.nodeId+"?"+i.kpiCode]=i.value;else{var s={milliseconds:a,arisingTime:i.arisingTime,time:i.arisingTime};i.instance?(t.insDic[i.instance]=i.instance,s[i.nodeId+"?"+i.kpiCode+"?"+i.instance]=i.value):s[i.nodeId+"?"+i.kpiCode]=i.value,t.data.recordList.push(s)}return t},i}])});
//# sourceMappingURL=../../map/js/services/kpidata-flex-service.js.map
