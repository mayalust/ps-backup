define(["directives/directives"],function(e){"use strict";e.initDirective("aeditTable",["$timeout","$compile",function(e,i){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,e,t){var d,r,c,a=e,n=!1,p=!1,u=!1,b="";l.$on(Event.ALERTEDITINIT,function(e,t){d&&d.destroy(),u=!1,r=t.data,n=!1,d=a.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:$.ProudSmart.datatable.language,data:r.alerts,columns:[{data:"name",title:"告警名称"},{data:"label",title:"显示名称"},{data:"description",title:"描述"},{data:"option",orderable:!1,title:"操作"}],columnDefs:[{targets:0,data:"name",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%' class='form-control' type='text' value='"+e+"'>":e}},{targets:1,data:"name",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%'  class='form-control' type='text' value='"+e+"'>":e}},{targets:2,data:"name",render:function(e,t,a){return 2==a.isEdit&&"display"==t?"<input style='width:100%'   class='form-control' type='text' value='"+e+"'>":e}},{targets:3,data:"option",render:function(e,t,a){var n="<div class='input-group'>";return a.canEdit?2==a.isEdit?(n+="<a id='save-btn' class='btn btn-default btn-sm' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",a.isNew?n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>":n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>"):(n+="<a id='edit-btn' class='btn btn-default btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></a>",n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>"):n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>",a.isNew||(n+="<a id='threshold-btn' class='btn btn-default btn-sm'><i class='fa fa-gear hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 阈值</span></a>"),n+="</div>"}}]})}),a.on("init.dt",function(){if(l.selectedDitem&&l.selectedDitem.canEdit){var e=$(".special-btn").parent();e.html('<a ng-click="addModelSubItem()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加告警</span></a>'),i(e)(l)}}),a.on("click","#save-btn",function(e){e.stopPropagation();var t=$(this).closest("tr"),i=d.row(t);if(2==i.data().isEdit){var a=$(this).parents("tr").children(),s=!0;$.each(a,function(e,t){var a=$(t);if(0==e||1==e){if(!(n=a.children("input").val()))return $(t).addClass("danger"),s=!1,i.data().isEdit=2,i.cells().invalidate(),!1;$(t).removeClass("danger")}if(3==e)return i.cell(a).invalidate(),!0;var n=a.children("input").val();a.html(n),d.cell(a).data(n)}),s&&l.doAction("alert-save",i.data(),function(e){0==e?i.data().isEdit=2:(i.data().id=e.id,i.data().isEdit=0,i.data().isNew=!1,i.cells().invalidate(),n=!1)})}}),a.on("click","#edit-btn",function(e){if(e.preventDefault(),3==d.row(t).data().isEdit)return l.doAction("thresholdMessage","当前有正在设置的阈值！"),void(p=!0);if(n)l.doAction("thresholdMessage","当前有修改中的指标，请先完成该操作");else{n=!0;var t=$(this).closest("tr"),a=d.row(t);a.data().isEdit=2,a.cells().invalidate()}}),a.on("click","#cancel-btn",function(e){if(e.preventDefault(),n){n=!1;var t=$(this).closest("tr"),a=d.row(t);a.data().isEdit=0,a.cells().invalidate()}}),a.on("click","#del-btn",function(e){if(e.preventDefault(),3==d.row(t).data().isEdit)return l.doAction("thresholdMessage","请先关闭阈值设置！"),void(p=!0);var t=$(this).closest("tr"),a=d.row(t);a.data().isDel=!0,l.doAction("kpi-delete",rowData,function(e){e&&a.remove().draw(!1)})}),a.on("click","#threshold-btn",function(e){if(e.preventDefault(),void 0===d.row(t).data().isEdit||2!=d.row(t).data().isEdit){if(!n){p=n=!1;var t=$(this).closest("tr");d.row(t).data().isEdit=3}}else l.doAction("thresholdMessage","请先完成告警编辑！")}),a.on("click","#threshold-btn",function(e){e.stopPropagation(),e.preventDefault();var t=$(this).closest("tr"),a=d.row(t),n=a.data();if(n&&3==n.isEdit&&!p)if(a.child.isShown())a.child.hide(),t.removeClass("shown"),n.isEdit=0,u=!1;else if(!u){var s=[{name:"警告告警",value:"1"},{name:"次要告警",value:"2"},{name:"重要告警",value:"3"},{name:"严重告警",value:"4"}],l=[{name:"大于",value:"compare(value,refValue)>0"},{name:"大于等于",value:"compare(value,refValue)>=0"},{name:"小于",value:"compare(value,refValue)<0"},{name:"小于等于",value:"compare(value,refValue)<0"},{name:"表达式",value:""}];b=n.id;for(var i=[],o=0;o<r.thresholds.length;o++)if(r.thresholds[o].alertCode==b){i=r.thresholds[o].thresholdsData;break}a.child(function(e){var t;if(null!=e)return e.hasOwnProperty("isEdit")&&0<e.isEdit&&(t='<table id="threshold-table" width="780px"></table><div style="width:100%;text-align:left"><button id="addThreshold" type="button" class="btn btn-default">&nbsp;&nbsp;添加&nbsp;&nbsp;</button>&nbsp;&nbsp;&nbsp;&nbsp;<button id="saveThreshold" type="button" class="btn btn-primary">&nbsp;&nbsp;保存&nbsp;&nbsp;</button></div>'),t}(n)).show(),t.addClass("shown"),c=$("#threshold-table").DataTable({language:{lengthMenu:"显示 _MENU_ 项结果",zeroRecords:"没有匹配结果",info:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",infoEmpty:"显示第 0 至 0 项结果，共 0 项",infoFiltered:"(由 _MAX_ 项结果过滤)",loadingRecords:"载入中...",processing:"处理中...",search:"搜索:",paginate:{first:"首页",last:"末页",next:"下页",previous:"上页"}},paging:!1,info:!1,ordering:!1,footer:!1,searching:!1,data:i,fnDrawCallback:function(e){$(e.nTHead).hide()},columns:[{data:"kpiCode",title:"指标类型"},{data:"condition",title:"阈值条件"},{data:"refValue",title:"阈值"},{data:"severity",title:"告警级别"},{data:"enable",title:"启用"},{data:"id",title:"删除"}],columnDefs:[{targets:0,data:"kpiCode",render:function(e,t,a,n){var i="";if(void 0!==e)for(var s in i='<select id="kpiCode" name="kpiCode-name" class="combobox form-control"><option value="" selected disabled>KPI类型...</option>',r.kpis)e==r.kpis[s].id?i+='<option value="'+r.kpis[s].id+'" selected>'+r.kpis[s].label+"</option>":i+='<option value="'+r.kpis[s].id+'">'+r.kpis[s].label+"</option>";else for(var s in i='<select id="kpiCode" name="kpiCode-name" class="combobox form-control"><option value="" selected disabled>指标类型...</option>',r.kpis)i+='<option value="'+r.kpis[s].id+'">'+r.kpis[s].label+"</option>";return i+="</select>&nbsp;&nbsp;&nbsp;&nbsp;"}},{targets:1,data:"condition",render:function(e,t,a){var n="";if(void 0!==e){for(var i in n='<select id="condition" name="condition-name" class="combobox form-control"><option value="" selected disabled>计算条件...</option>',l)e==l[i].value?n+='<option value="'+l[i].value+'" selected>'+l[i].name+"</option>":n+='<option value="'+l[i].value+'">'+l[i].name+"</option>";n+="</select>&nbsp;&nbsp;&nbsp;&nbsp;"}else{for(var i in n='<select id="condition" name="condition-name" class="combobox form-control"><option value="" selected disabled>计算条件...</option>',l)n+='<option value="'+l[i].value+'">'+l[i].name+"</option>";n+="</select>&nbsp;&nbsp;&nbsp;&nbsp;"}return n}},{targets:2,data:"refValue",render:function(e,t,a){return void 0===e?"<input id ='refValue' name='refValue-name' class='form-control' type='text' value='' placeholder='参考值'>&nbsp;&nbsp;&nbsp;&nbsp;":"<input id ='refValue' name='refValue-name' onkeyup='validatorNUM(this)' class='form-control' type='text' value='"+e+"'>&nbsp;&nbsp;&nbsp;&nbsp;"}},{targets:3,data:"severity",render:function(e,t,a){var n="";if(void 0===e){for(var i in n='<select id="severity" name="severity-name" class="combobox form-control"><option value="" selected disabled>告警级别...</option>',s)n+='<option value="'+s[i].value+'">'+s[i].name+"</option>";n+="</select>&nbsp;&nbsp;&nbsp;&nbsp;"}else{for(var i in n='<select id="severity" name="severity-name" class="combobox form-control"><option value="" selected disabled>告警级别...</option>',s)e==s[i].value?n+='<option value="'+s[i].value+'" selected>'+s[i].name+"</option>":n+='<option value="'+s[i].value+'">'+s[i].name+"</option>";n+="</select>&nbsp;&nbsp;&nbsp;&nbsp;"}return n}},{targets:4,data:"enable",render:function(e,t,a){void 0===e&&(e=1);var n="<label>启用:&nbsp;&nbsp;</label>";return 0==e?(n+="<a id='unable-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-square-o'></i></a>",n+="<input type='checkbox' id='tEnable' style='display:none'/>"):(n+="<a id='enable-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-check-square-o'></i></a>",n+="<input type='checkbox' id='tEnable' checked='checked' style='display:none'/>"),n}},{targets:5,data:"id",render:function(e,t,a){var n="<a id='delete-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-trash-o'></i></a>";return n+=void 0!==e?"<input  id='tid' type='text' style='display:none' value='"+e+"'/>":"<input  id='tid' type='text' style='display:none' value=''/>"}}]}),0==r.thresholds.length&&c.row.add([]).draw(!1),n.isEdit=3,u=!0}}),a.on("click","#addThreshold",function(e){e.stopPropagation(),c.row.add([]).draw(!1)}),a.on("click","#saveThreshold",function(e){e.stopPropagation();for(var t=!0,a=0;a<c.$("input, select").length;a++)if(null==$(c.$("input, select")[a]).val()||""==$(c.$("input, select")[a]).val()){if("tid"==c.$("input, select")[a].id)break;if("condition"==c.$("input, select")[a].id&&""==$(c.$("input, select")[a]).val())break;$(c.$("input, select")[a]).css("background-color","#f2dede"),l.doAction("thresholdMessage","当前有未填写阈值"),t=!1;break}if(t){var n=[];n[0]=r.id,n[1]=b,n[2]=[];var i={};for(a=0;a<=c.$("input, select").length&&0!=c.$("input, select").length&&(0==a||a%6!=0||(n[2].push(i),i={},a!=c.$("input, select").length));a++)"kpiCode"==c.$("input, select")[a].id&&(i.kpiCode=$(c.$("input, select")[a]).val()),"condition"==c.$("input, select")[a].id&&(i.condition=$(c.$("input, select")[a]).val()),"refValue"==c.$("input, select")[a].id&&(i.refValue=$(c.$("input, select")[a]).val()),"severity"==c.$("input, select")[a].id&&(i.severity=$(c.$("input, select")[a]).val()),"tEnable"==c.$("input, select")[a].id&&(void 0===$(c.$("input, select")[4]).attr("checked")?i.enable=0:i.enable=1),"tid"==c.$("input, select")[a].id&&(""==$(c.$("input, select")[a]).val()?i.id=0:i.id=$(c.$("input, select")[a]).val());l.saveThresholds(r,b,n)}}),a.on("change","#threshold-table select",function(e){e.stopPropagation(),null!=$(e.target).val()&&$(e.target).css("background-color","white")}),a.on("change","#condition",function(e){if(e.stopPropagation(),null!=$(e.target).val()&&""!=$(e.target).val()){/^\d*$/.test($($(e.target).parent().siblings()[1]).children().val())||($($(e.target).parent().siblings()[1]).children().css("background-color","#f2dede"),$($(e.target).parent().siblings()[1]).children().val(""),$($(e.target).parent().siblings()[1]).children().attr("placeholder","请输入正确数字"))}else $($(e.target).parent().siblings()[1]).children().css("background-color","white"),$($(e.target).parent().siblings()[1]).children().attr("placeholder","参考值")}),a.on("change","#threshold-table input",function(e){e.stopPropagation(),""!=$(e.target).val()&&$(e.target).css("background-color","white")}),a.on("change","#refValue",function(e){if(e.stopPropagation(),""!=$(e.target).val())if(null!=$($(e.target).parent().siblings()[1]).children().val()&&""!=$($(e.target).parent().siblings()[1]).children().val()){/^\d*$/.test($(e.target).val())?$(e.target).css("background-color","white"):($(e.target).css("background-color","#f2dede"),$(e.target).val(""),$(e.target).attr("placeholder","请输入正确数字"))}else $(e.target).css("background-color","white")}),a.on("click","#unable-btn",function(e){e.stopPropagation();$(this).closest("td").html("<label>启用:&nbsp;&nbsp;</label><a id='enable-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-check-square-o'></i></a><input type='checkbox' id='tEnable' checked='checked' style='display:none'/>")}),a.on("click","#enable-btn",function(e){e.stopPropagation();$(this).closest("td").html("<label>启用:&nbsp;&nbsp;</label><a id='unable-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-square-o'></i></a><input type='checkbox' id='tEnable' style='display:none'/>")}),a.on("click","#delete-btn",function(e){e.stopPropagation();var t=$(this).closest("tr");c.row(t).remove().draw(!1)})}]}}])});
//# sourceMappingURL=../../map/js/directives/alert-dom.js.map
