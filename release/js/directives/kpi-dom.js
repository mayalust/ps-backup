define(["directives/directives"],function(t){"use strict";t.initDirective("kpieditTable",["$timeout","$compile",function(t,n){return{restrict:"A",controller:["$scope","$element","$attrs","growl",function(c,t,a,o){var l,i=t,d=!1;c.$on(Event.KPIEDITINIT,function(t,a){l&&l.destroy(),d=!1,l=i.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:$.ProudSmart.datatable.language,data:a.data,rowCallback:function(t,a,i){n(t)(c)},order:[[9,"asc"]],columns:[{data:"name",title:"名称"},{data:"label",title:"显示名称"},{data:"unit",title:"单位"},{data:"range",title:"取值范围"},{data:"number",title:"是否数值"},{data:"granularity",title:"采集频率"},{data:"granularityUnit",title:"采集频率单位"},{data:"icon",title:"图标"},{data:"option",orderable:!1,title:"操作",width:"100px"},{data:"uid",visible:!1}],columnDefs:[{targets:0,data:"name",render:function(t,a,i){return 2==i.isEdit&&0==i.id&&"display"==a?"<input maxlength='20' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:1,data:"label",render:function(t,a,i){return 2==i.isEdit&&"display"==a?"<input maxlength='20' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:2,data:"unit",render:function(t,a,i){if(2==i.isEdit&&"display"==a){var n="<select class='combobox form-control input-sm'>";for(var e in n+='<option value="">请选择...</option>',c.myOptions)c.myOptions[e].unitCode==t?n+='<option selected="true" value="'+c.myOptions[e].unitCode+'">'+c.myOptions[e].unitName+"</option>":n+='<option value="'+c.myOptions[e].unitCode+'">'+c.myOptions[e].unitName+"</option>";return n+="</select>"}for(var e in c.myOptions)if(c.myOptions[e].unitCode==t)return c.myOptions[e].unitName;return t}},{targets:3,data:"range",render:function(t,a,i){return 2==i.isEdit&&"display"==a?"<input maxlength='100' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:4,data:"number",render:function(t,a,i){var n;return 2==i.isEdit&&"display"==a?(n="<select class='combobox form-control input-sm'>",1==t||"true"==t?(n+="<option value='true' selected>是</option>",n+="<option value='false'>否</option>"):(n+="<option value='true'>是</option>",n+="<option value='false' selected>否</option>"),n+="</select>"):n=1==t||"true"==t?"是":"否"}},{targets:5,data:"granularity",render:function(t,a,i){return 2==i.isEdit&&"display"==a?"<input style='width:100%' class='form-control input-sm' type='number' value='"+t+"'>":t}},{targets:6,data:"granularityUnit",render:function(t,a,i){if(2==i.isEdit&&"display"==a){var n="<select class='combobox form-control input-sm'>";for(var e in n+='<option value="">请选择...</option>',c.myDicts.KqiGranularityUnit)c.myDicts.KqiGranularityUnit[e].valueCode==t?n+='<option selected="true" value="'+c.myDicts.KqiGranularityUnit[e].valueCode+'">'+c.myDicts.KqiGranularityUnit[e].label+"</option>":n+='<option value="'+c.myDicts.KqiGranularityUnit[e].valueCode+'">'+c.myDicts.KqiGranularityUnit[e].label+"</option>";return n+="</select>"}var s="";for(var e in c.myDicts.KqiGranularityUnit)if(c.myDicts.KqiGranularityUnit[e].valueCode==t){s=c.myDicts.KqiGranularityUnit[e].label;break}return s}},{targets:7,data:"icon",render:function(t,a,i){var n="";if(2==i.isEdit&&"display"==a){for(var e in n="<select class='combobox form-control input-sm'>",n+='<option value="">请选择...</option>',c.kpiIconList)c.kpiIconList[e].icon==t?n+='<option selected="true" value="'+c.kpiIconList[e].icon+'">'+c.kpiIconList[e].title+"</option>":n+='<option value="'+c.kpiIconList[e].icon+'">'+c.kpiIconList[e].title+"</option>";n+="</select>"}else t&&(n='<div class="btn btn-social-icon btn-bitbucket btn-sm" ><i class="'+t+'"></i></div>');return n}},{targets:8,data:"option",render:function(t,a,i){var n="<div class='btn-group btn-group-sm'>";return 2==i.isEdit?(n+="<a id='save-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",i.isNew?n+="<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>":n+="<a id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>"):n+="<div class='btn-group table-option-group'><button type='button' class='btn btn-default btn-sm'>操作</button><button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button><ul class='dropdown-menu' role='menu'><li><a href='javascript:void(0);' id='edit-btn' >修改</a></li><li><a href='javascript:void(0);' id='del-btn' >删除</a></li><li><a href='javascript:void(0);' id='data-btn' >接入数据定义</a></li></ul></div>",n+="</div>"}}]})}),i.on("init.dt",function(){if(c.selectedDitem){var t=$(".special-btn").parent();t.html('<select class="form-control" style="min-width:200px" selectdata="kpiList" itemchange="kpichangehandler" select2></select>'),n(t)(c)}}),i.on("click","#data-btn",function(t){if(t.stopPropagation(),l.$("tr.shown").length<1){var a=$(this).closest("tr");a.addClass("shown");var i=l.row(a);$(".open>.dropdown-menu").css("display","none"),i.child(function(t){var a=c.initListDate.allDataItems,i=c.initListDate.allDataTypes,n="",e="",s=t.dataItemId,o=t.dataTypeId;if(null==t.instance)var l=0;else l=t.instance;for(var d in a)a[d].id==s?n+="<option value='"+a[d].id+"' selected>"+a[d].label+"</option>":n+="<option value='"+a[d].id+"'>"+a[d].label+"</option>";for(var r in i)i[r].id==o?e+="<option value='"+i[r].id+"' selected>"+i[r].name+"</option>":e+="<option value='"+i[r].id+"'>"+i[r].name+"</option>";if(null!=t)return'<table width="60%"  class="table table-hover"><tr><td >数据编码:</td><td><select id="dataCode" name="dataCode" class="combobox form-control input-sm"><option>请选择</option>'+n+'</select></td><td >数据类型:</td><td ><select id="dataType" name="dataType" class="combobox form-control input-sm"><option>请选择</option>'+e+'</select></td></tr><tr><td>实例编号:</td><td  ><input id="instance" name="instance" class="form-control input-sm" type="text"   value="'+l+'"/></td></tr><tr><td ><div class="input-group"><a id="data-save-btn" class="btn btn-default btn-sm" style="margin-right: 15px;"><i class="fa fa-check"></i><span class="hidden-xs ng-binding">保存</span></a><a id="data-cancel-btn" class="btn btn-default btn-sm"><i class="fa fa-close"></i><span class="hidden-xs ng-binding">取消</span></a></div></td></tr></table>'}(i.data())).show()}else o.warning("您正在操作，请先保存或者取消再进行此操作",{})}),i.on("click","#data-save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),i=l.row(a),n=l.row(".shown"),e=n.data();4<$("#instance").val().length?o.warning("您输入的实例编号过长，最多只能输入4位",{}):"请选择"!=$("#dataCode").val()?"请选择"!=$("#dataType").val()?(n.data().dataItemId=$("#dataCode").val(),n.data().dataTypeId=$("#dataType").val(),n.data().instance=$("#instance").val(),c.doAction("kpi-data-save",e,function(t){0==t?i.data().isEdit=2:(n.data().id=t.id,n.data().uid=t.uid,n.data().isEdit=0,n.data().isNew=!1,d=!1,c.doAction("data-cancel"))})):o.warning("数据类型是必填项，请选择",{}):o.warning("数据编码是必填项，请选择",{})}),i.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=l.row(a);if(2==e.data().isEdit){var i=$(this).parents("tr").children(),s=!0;$.each(i,function(t,a){var i=$(a);if((0==t||1==t)&&0<i.children("input").length){var n=i.children("input").val();if(!jQuery.trim(n))return $(a).addClass("danger"),s=!1,e.data().isEdit=2,o.warning("该字段不能为空!",{}),!1;$(a).removeClass("danger")}if(2==t)return(n=$(a).children("select").val())?($(a).removeClass("danger"),i.html(n),l.cell(i).data(n),!0):($(a).addClass("danger"),e.data().isEdit=2,s=!1,o.warning("请选择一个单位!",{}),!1);if(4==t||6==t||7==t){n=$(a).children("select").val();return i.html(n),l.cell(i).data(n),!0}if(8==t)return e.cell(i).invalidate(),!0;n=i.children("input").val();i.html(n),l.cell(i).data(n)}),s&&(a.removeClass("shown"),c.doAction("kpi-save",e.data(),function(t){0==t?e.data().isEdit=2:(e.data().id=t.id,e.data().uid=t.uid,e.data().isEdit=0,e.data().isNew=!1,e.cells().invalidate(),d=!1)}))}}),i.on("click","#edit-btn",function(t){if(t.preventDefault(),l.$("tr.shown").length<1)if(d)c.doAction("thresholdMessage","当前有修改中的指标，请先完成该操作");else{d=!0;var a=$(this).closest("tr");a.addClass("shown");var i=l.row(a);i.data().isEdit=2,i.cells().invalidate()}else o.warning("您正在操作，请先保存或者取消再进行此操作",{})}),i.on("click","#cancel-btn",function(t){if(t.preventDefault(),d){d=!1;var a=$(this).closest("tr"),i=l.row(a);i.data().isEdit=0,a.removeClass("shown"),i.cells().invalidate()}}),i.on("click","#data-cancel-btn",function(t){t.preventDefault();var a=$(this).closest("tr");l.row(a).invalidate().draw(),a.removeClass("shown"),c.doAction("data-cancel")}),i.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),i=l.row(a);i.data().isDel=!0;var n=i.data();c.doAction("kpi-delete",n,function(t){t&&i.remove().draw(!1)})})}]}}])});
//# sourceMappingURL=../../map/js/directives/kpi-dom.js.map
