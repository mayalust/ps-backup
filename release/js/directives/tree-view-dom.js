define(["directives/directives"],function(s){"use strict";s.initDirective("treeView",["$timeout","$compile",function(O,s){return{restrict:"A",scope:{source:"=",formatter:"=",mark:"=",checkbox:"="},link:function(z,a,s){var I=$("<div></div>").css("z-index",1999).css("background-color","#fff").css("box-shadow","1px 1px 10px rgba(0,0,0,.3)").css("padding","15px 20px").css("margin","-5px 0 0 25px").css("display","block").css("width","300px").css("position","fixed"),P=$("<p></p>").text("").css("color","#666").css("margin",0).css("line-height","16px").css("font-size","12px").css("font-weight","normal"),c=$("<div></div>").append($("<span class='close'>x</span>")),e=$("<p></p>").text("描述 :").css("font-weight","bold").css("color","#333").css("margin","10px auto").css("line-height","16px").css("font-size","12px");I.append(c).append(e).append(P);O(function(){$(a).css("position","relative"),$(a).css("border","1px solid #eee"),$(a).css("box-shadow","1px 1px 5px rgba(0,0,0,.1)");var w=function(s){var o=[],c=function s(c){if(o.push(c),c[z.mark])for(var e in c[z.mark])s(c[z.mark][e])};for(var e in s[z.mark])c(s[z.mark][e]);return o};z.$watch("source",function(s,c,e){null!=s&&(function(s,C,c){$(a).children().remove();var e=function s(c,i,e,o,a,n,p){var r;e++,i.depth=e;var t=$("<div></div>").css("border-bottom","1px solid #ddd").css("position","relative").css("overflow","hidden").css("opacity",0).css("max-height",0).css("line-height","30px"),l=$("<button></button>").css("line-height","12px").css("padding","4px 4px 6px 5px").css("color","#fff").css("border","0").css("background-color","#009dea").css("float","left").css("margin","4px 10px 0px 3px"),d=$("<span></span>").addClass("glyphicon glyphicon-minus").css("font-size","10px").css("paddin","0 0 0 1px"),h=$("<span></span>").addClass("glyphicon glyphicon-th-list").css("margin","0 15px 0 5px").css("color","#ccc"),x=$("<span></span>").css("font-size","12px").css("margin-left",10).text(i.name),k=$("<button></button>").css("line-height","12px").css("font-size","5px").css("padding","3px 4px 3px 4px").css("border","1px solid #ddd").css("margin","2px 0px 0px 2px").addClass("checkbox"),m=$("<span></span>").addClass(" glyphicon glyphicon-ok"),g=$("<span></span>").addClass("glyphicon glyphicon-question-sign").css("cursor","pointer").css("font-size","16px").css("color","#ccc").css("margin-left","20px"),f=function(s){s.stopPropagation(),$("body").off(),I.remove()},u=$("<div></div>").css("margin-left",("search"!=C?20*e:0)+"px");if(l.append(d),i.ui={checkbox:k,checkIcon:m},g.on("click",function(s){s.stopPropagation(),I.remove();var c=$(s.target).offset();I.css({opacity:0,top:c.top-20,left:c.left+5}),P.text(i.description),$("body").prepend(I),I.animate({opacity:1},300),$("body").on("click.infoleave",f)}),p||t.css("background-color","#eee"),k.append(m),k.on("click",function(){var n;n=0==i[z.checkbox]?1:0,function s(c){if(0==(c[z.checkbox]=n)?(c.ui.checkbox.removeClass().addClass("checkbox"),c.ui.checkIcon.removeClass().addClass("glyphicon glyphicon-empty")):(c.ui.checkbox.removeClass().addClass("checkbox"),c.ui.checkIcon.removeClass().addClass("glyphicon glyphicon-ok")),c.hasOwnProperty(z.mark))for(var e in c[z.mark])s(c[z.mark][e])}(i),i.parent&&function s(c){var e,o,a=w(c);1<a.length?(o=a.every(function(s){return 1==s[z.checkbox]}),e=a.some(function(s){return 1==s[z.checkbox]})):1==a.length?0==i[z.checkbox]?e=!0:o=!0:e=!(o=!0),0==n?o?(c[z.checkbox]=1,c.ui.checkbox.removeClass().addClass("checkbox"),c.ui.checkIcon.removeClass().addClass("glyphicon glyphicon-ok")):e?(c[z.checkbox]=1,c.ui.checkbox.removeClass().addClass("checkbox part"),c.ui.checkIcon.removeClass().addClass("glyphicon glyphicon-ok")):(c[z.checkbox]=0,c.ui.checkbox.removeClass().addClass("checkbox"),c.ui.checkIcon.removeClass().addClass("glyphicon glyphicon-empty")):(c[z.checkbox]=n,o?c.ui.checkbox.removeClass().addClass("checkbox"):c.ui.checkbox.removeClass().addClass("checkbox part"),c.ui.checkIcon.removeClass().addClass("glyphicon glyphicon-ok")),c.hasOwnProperty("parent")&&s(c.parent)}(i.parent)}),c.append(t),u.append(l).append(h),null!=z.checkbox){var v;u.append(k);var b=w(i);v=!(0<b.length)||b.every(function(s){return 1==s[z.checkbox]}),i[z.checkbox]?(v?k.removeClass().addClass("checkbox"):k.removeClass().addClass("checkbox part"),m.removeClass().addClass("glyphicon glyphicon-ok")):(k.removeClass().addClass("checkbox"),m.removeClass().addClass("glyphicon glyphicon-empty"))}if(u.append(x),t.animate({opacity:1,"max-height":"50px"},300),i.hasOwnProperty(z.mark))if(null!=i[z.mark]){for(var y in h.css("display","none"),l.css("display","block"),t.css("font-weight","bold"),(i.show=!1)&&t.css("max-height",0),r=$("<div></div>").css("overflow","hidden"),1<e&&(r.css("max-height",0),d.removeClass().addClass("glyphicon glyphicon-plus")),c.append(r),i[z.mark])i[z.mark][y].parent=i,s(r,i[z.mark][y],e,0,0,0,i[z.mark]);l.on("click",function(s){"0px"==r.css("max-height")?O(function(){d.removeClass().addClass("glyphicon glyphicon-minus"),r.animate({"max-height":2e3,opacity:1},300)}):O(function(){d.removeClass().addClass("glyphicon glyphicon-plus"),r.animate({"max-height":0,opacity:0},300)})})}else h.css("display","inline"),l.css("display","none");else h.css("display","inline"),l.css("display","none");t.append(u)};if(s instanceof Array)for(var o in s)s[o].parent=s,e($(a),s[o],-1);else e($(a),s,-1)}(s),s.getCheckNode=function(){var o=[];return function s(c){if(1==c[z.checkbox]&&o.push(c),c.hasOwnProperty(z.mark))for(var e in c[z.mark])s(c[z.mark][e])}(s),o})})})}}}])});
//# sourceMappingURL=../../map/js/directives/tree-view-dom.js.map
