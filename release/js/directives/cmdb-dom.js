define(["directives/directives","datatables.net","datatables.net-bs","bootstrap-daterangepicker"],function(p,t,a){"use strict";p.initDirective("cmdbTable",["$timeout","$compile","$filter",function(t,s,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(o,t,a){var l,d,e=t,n=!1;function i(t){var a;if(0<t.isEdit){for(var e in a='<table width="100%" class="table table-inner">',d){if(a+='<tr role="row"><td class="col-xs-3">'+(s=d[e]).label+":</td>","numberic"==s.dataType)a+='<td><input datatype="'+s.dataType+'" class="form-control input-sm" type="number" name="'+s.name+'" value="'+(t.values.hasOwnProperty(s.name)?t.values[s.name]:"")+'"></td>';else if("icon"==s.dataType){var n="";for(var e in t.values.hasOwnProperty(s.name)&&(n=t.values[s.name]),a+='<td><div name="'+s.name+'" datatype="'+s.dataType+'" class="col-sm-12 no-padding iconSelect"><select class="combobox form-control input-sm iconShow"><option value="">请选择...</option>',o.iconList)o.iconList[e].icon==n?a+='<option selected="true" value="'+o.iconList[e].icon+'">'+o.iconList[e].title+"</option>":a+='<option value="'+o.iconList[e].icon+'">'+o.iconList[e].title+"</option>";a+="</select>",a+="</div></td>"}else if("standardAddress"==s.dataType){var i=[];for(var e in t.values.hasOwnProperty(s.name)&&(i=t.values[s.name].split(",")),a+='<td><div name="'+s.name+'" datatype="'+s.dataType+'" class="col-sm-12 no-padding selectList"><select class="combobox form-control input-sm province"><option value="">请选择...</option>',o.provinces)0<i.length&&o.provinces[e].label==i[0]?(o.citys=o.provinces[e].children,a+='<option selected="true" value="'+o.provinces[e].id+'">'+o.provinces[e].label+"</option>"):a+='<option value="'+o.provinces[e].id+'">'+o.provinces[e].label+"</option>";for(var e in a+="</select>",a+='<select class="combobox form-control input-sm city '+(1<i.length?"":"ng-hide")+'"><option value="">请选择...</option>',o.citys)1<i.length&&o.citys[e].label==i[1]?(o.districts=o.citys[e].children,a+='<option selected="true" value="'+o.citys[e].id+'">'+o.citys[e].label+"</option>"):a+='<option value="'+o.citys[e].id+'">'+o.citys[e].label+"</option>";for(var e in a+="</select>",a+='<select class="combobox form-control input-sm district '+(2<i.length?"":"ng-hide")+'"><option value="">请选择...</option>',o.districts)3==i.length&&o.districts[e].label==i[2]?a+='<option selected="true" value="'+o.districts[e].id+'">'+o.districts[e].label+"</option>":a+='<option value="'+o.districts[e].id+'">'+o.districts[e].label+"</option>";a+="</select>",a+="</div></td>"}else"datetime"==s.dataType?a+='<td><input datatype="'+s.dataType+'" class="form-control input-sm" type="text" name="'+s.name+'" value="'+(t.values.hasOwnProperty(s.name)?r("date")(t.values[s.name],"yyyy-MM-dd HH:mm:ss"):"")+'"></td>':"date"==s.dataType?a+='<td><input datatype="'+s.dataType+'" class="form-control input-sm" type="text" name="'+s.name+'" value="'+(t.values.hasOwnProperty(s.name)?r("date")(t.values[s.name],"yyyy-MM-dd"):"")+'"></td>':a+='<td><input datatype="'+s.dataType+'" class="form-control input-sm" type="text" name="'+s.name+'" value="'+(t.values.hasOwnProperty(s.name)?t.values[s.name]:"")+'"></td>';a+="</tr>"}a+='<tr><td><div class="btn-group btn-group-sm"><a id="save-btn" class="btn btn-default"><i class="fa fa-check  hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default"><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a></div></td></tr></table>'}else{for(var e in a='<table width="100%" class="table table-inner">',d){var s;a+='<tr role="row"><td class="col-xs-3">'+(s=d[e]).label+":</td>","datetime"==s.dataType?a+="<td>"+(t.values.hasOwnProperty(s.name)?r("date")(t.values[s.name],"yyyy-MM-dd hh:mm:ss"):"")+"</td>":"date"==s.dataType?a+="<td>"+(t.values.hasOwnProperty(s.name)?r("date")(t.values[s.name],"yyyy-MM-dd"):"")+"</td>":a+="<td>"+(t.values.hasOwnProperty(s.name)?t.values[s.name]:"")+"</td>",a+="</tr>"}a+="</table>"}return a}o.$on(Event.CMDBINFOSINIT,function(t,a){l&&l.destroy(),n=!1,d=a.option[1],l=e.DataTable({order:[[0,"desc"]],dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:p.datatable.language,data:a.option[0],columns:[{data:"createTime",title:"上线时间"},{data:"externalDevId",title:"设备地址"},{data:"label",title:"名称"},{data:"onlineStatus",title:"在线状态"},{data:"health",title:"健康度"},{data:"option",orderable:!1,title:"操作"}],columnDefs:[{targets:0,data:"createTime",render:function(t,a,e){return r("date")(t,"yyyy-MM-dd HH:mm:ss")}},{targets:2,data:"label",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='20' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"onlineStatus",render:function(t,a,e){return"<span class='label "+("online"==t?"label-primary":"label-warning")+"'>"+("online"==t?"在线":"离线")+"</span>"}},{targets:4,data:"health",render:function(t,a,e){return"<div class='progress progress-xs progress-striped active'><div class='progress-bar "+(90<t?"progress-bar-success":79<t?"progress-bar-warning":59<t?"progress-bar-minor":39<t?"progress-bar-major":"progress-bar-red")+"' style='width:"+t+"%'></div></div>"}},{targets:5,data:"option",render:function(t,a,e){return 2==e.isEdit?'<div class="btn-group  btn-group-sm"><a id="save-btn" class="btn btn-default" ><i class="fa fa-check  hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default" ><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a></div>':"<div class='btn-group  table-option-group btn-group-sm'><button type='button' class='btn btn-default'>操作</button><button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button><ul class='dropdown-menu' role='menu'><li><a href='#/configAlert/"+e.id+"/node'>告警</a></li><li><a href='#/emcsView/"+e.id+"'>性能</a></li><li><a href='#/directiveview/"+e.data.modelId+"/"+e.id+"'>发送指令</a></li><li><a href id='export-btn'>导出模板</a></li><li><a href id='edit-btn'>编辑</a></li></ul></div>"}}],rowCallback:function(t,a,e){a.selected&&(t.className="success"),s(t)(o)}})}),e.on("click","td",function(t){var a=$(this).closest("tr"),e=l.row(a);if(e.data()){if(5==$(this).context.cellIndex&&0==e.data().isEdit)return;e.child.isShown()?0==e.data().isEdit?(e.child.hide(),a.removeClass("shown")):2!=e.data().isEdit&&3!=e.data().isEdit||(e.child(i(e.data())).show(),a.addClass("shown")):(e.child(i(e.data())).show(),a.addClass("shown")),2==e.data().isEdit&&$(".selectList").each(function(){var e,a=$(this).find(".province"),n=$(this).find(".city"),i=$(this).find(".district"),s=function(){e='<option value="">请选择...</option>';var t=n.get(0).selectedIndex;0==t?i.addClass("ng-hide"):(o.districts=o.citys[t-1].children,i.removeClass("ng-hide"),$.each(o.districts,function(t,a){e+="<option value='"+a.id+"'>"+a.label+"</option>"}),i.html(e))};a.change(function(){!function(){e='<option value="">请选择...</option>';var t=a.get(0).selectedIndex;0==t?n.addClass("ng-hide"):(o.citys=o.provinces[t-1].children,n.removeClass("ng-hide"),$.each(o.citys,function(t,a){e+="<option value='"+a.id+"'>"+a.label+"</option>"}),n.html(e),s())}()}),n.change(function(){s()})})}else{t.stopPropagation(),t.preventDefault();var n=$(this).find("input");$.each(n,function(t,a){"datetime"==$(a).attr("datatype")?($(a).daterangepicker({singleDatePicker:!0,showDropdowns:!0,timePicker:!0,minDate:"2000-01-01 00:00:00",maxDate:"2025-12-31 23:59:59",locale:{format:"YYYY-MM-DD HH:mm:ss",applyLabel:"确定",cancelLabel:"取消",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1}},function(t,a,e){}),$(a).attr("datatype",""),$(a).click()):"date"==$(a).attr("datatype")&&($(a).daterangepicker({singleDatePicker:!0,showDropdowns:!0,timePicker:!1,minDate:"2000-01-01",maxDate:"2025-12-31",locale:{format:"YYYY-MM-DD",applyLabel:"确定",cancelLabel:"取消",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1}},function(t,a,e){}),$(a).attr("datatype",""),$(a).click())})}}),e.on("click","#export-btn",function(t){var a=$(this).closest("tr"),e=l.row(a);o.doAction("export",e.data())}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),i=!0,s=null;for(var e in l.rows(".shown").data())2==l.rows(".shown").data()[e].isEdit&&(s=l.rows(".shown").data()[e]);$.each($(".shown").children(),function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){var n=e.children("input").val();if(n)$(a).removeClass("danger"),l.cell(e).data(n);else if(1==t||2==t)return $(a).addClass("danger"),i=!1}});var n=a.parent().find("input");$.each(n,function(t,a){var e=$(a).val(),n=$(a).attr("name");s.values[n]=e}),$(".iconSelect").each(function(){var t=$(this).find(".iconShow"),a=$(t).val(),e=$(this).attr("name");s.values[e]=a}),$(".selectList").each(function(){var t=$(this).find(".province"),a=$(this).find(".city"),e=$(this).find(".district"),n=$(e).val();n||(n=$(a).val()),n||(n=$(t).val());var i=$(this).attr("name");s.values[i]=n}),i&&(s.isEdit=0,o.doAction("save",s))}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),n=!1;var a=l.row(".shown");a&&(a.data().isEdit=0,a.child.hide(),a.cells().invalidate())}),e.on("click","#edit-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);n?0==e.data().isEdit&&o.doAction("eidterror"):(n=!0,e.data().isEdit=2,e.cells().invalidate())}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);o.doAction("delete",e.data())}),e.on("click","#change-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);o.doAction("change",e.data())}),e.on("click","#dir-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);o.doAction("directive",e.data())})}]}}]),p.initDirective("shadowsTable",["$timeout","$compile","$filter",function(t,i,a){return{restrict:"A",controller:["$scope","$element","$attrs",function(o,t,a){var l,e=t,n=!1;o.$on(Event.CMDBINFOSINIT+"_shadows",function(t,a){l&&l.destroy(),n=!1,l=e.DataTable({order:[[0,"desc"]],dom:'<"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:p.datatable.language,data:a.option,columns:[{data:"physicalDeviceDomain",title:"客户名称"},{data:"label",title:"设备名称"},{data:"externalDevId",title:"设备地址"},{data:"createTime",title:"上线时间"},{data:"onlineStatus",title:"在线状态"},{data:"modelId",title:"设备模板"},{data:"domainPath",title:"所属域"},{data:"health",title:"健康度"},{data:"option",orderable:!1,title:"操作"}],columnDefs:[{targets:3,data:"createTime",render:function(t,a,e){return"<date-label value="+t+" format='yyyy-MM-dd HH:mm:ss'>"}},{targets:4,data:"onlineStatus",render:function(t,a,e){return"<span class='label "+("online"==t?"label-primary":"label-warning")+"'>"+("online"==t?"在线":"离线")+"</span>"}},{targets:7,data:"health",render:function(t,a,e){return"<div class='progress progress-xs progress-striped active'><div class='progress-bar "+(90<t?"progress-bar-success":79<t?"progress-bar-warning":59<t?"progress-bar-minor":39<t?"progress-bar-major":"progress-bar-red")+"' style='width:"+t+"%'></div></div>"}},{targets:0,data:"physicalDeviceDomain",render:function(a,t,e){var n="";return o.userGridData.forEach(function(t){t.domainPath==a&&(n=t.customerName)}),n}},{targets:6,data:"domainPath",render:function(t,a,e){var n="";if(2==e.isEdit&&"display"==a){if(null!=t&&""!=t&&o.domainListDic){var i=o.domainListDic[t].name;i&&(n+='<input name="domainPath" domain-Picker class="form-control domainClass" type="text" value="'+i+'" gatewayDomainPath="'+e.gatewayDomainPath+'" domainPath="'+t+'" model="">')}n||(n+="<input  name='domainPath'  domain-Picker class='form-control domainClass' type='text' gatewayDomainPath='"+e.gatewayDomainPath+"' domainPath='' value='请选择...'>")}else n+=o.domainListDic[t].name;return n}},{targets:5,data:"modelId",render:function(t,a,e){var n="";if(2==e.isEdit&&"display"==a){if(null!=t&&""!=t&&o.rootModelDic){var i=o.rootModelDic[t];i&&(n+='<input name="modelId" model-Picker class="form-control domainClass" type="text" value="'+i.label+'" modelId="'+t+'" model="">')}n||(n+="<input  name='modelId'  model-Picker class='form-control domainClass' type='text' modelId='' value='请选择...'>")}else o.rootModelDic&&o.rootModelDic[t]?n+=o.rootModelDic[t].name:n+="无法识别模型";return n}},{targets:8,data:"option",render:function(t,a,e){return"<div class='btn-group table-option-group'><button type='button' class='btn btn-default btn-sm'>操作</button><button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button><ul class='dropdown-menu' role='menu'><li><a href='#/configAlert/"+e.id+"/node'>告警</a></li><li><a href='#/emcsView/"+e.id+"'>性能</a></li></ul></div>"}}],rowCallback:function(t,a,e){a.selected&&(t.className="success"),i(t)(o)}})}),e.on("click","td",function(t){}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),i=!0,s=null;for(var e in l.rows(".shown").data())2==l.rows(".shown").data()[e].isEdit&&(s=l.rows(".shown").data()[e]);$.each($(".shown").children(),function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){var n=e.children("input").val();if(n)$(a).removeClass("danger"),l.cell(e).data(n);else if(1==t)return $(a).addClass("danger"),i=!1}});var n=a.parent().find("input");$.each(n,function(t,a){var e=$(a).val(),n=$(a).attr("name");s.values[n]=e}),$(".iconSelect").each(function(){var t=$(this).find(".iconShow"),a=$(t).val(),e=$(this).attr("name");s.values[e]=a}),$(".selectList").each(function(){var t=$(this).find(".province"),a=$(this).find(".city"),e=$(this).find(".district"),n=$(e).val();n||(n=$(a).val()),n||(n=$(t).val());var i=$(this).attr("name");s.values[i]=n}),i&&(s.isEdit=0,o.doAction("save",s))}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),n=!1;var a=l.row(".shown");a&&(a.data().isEdit=0,a.child.hide(),a.cells().invalidate())}),e.on("click","#edit-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);n?0==e.data().isEdit&&o.doAction("eidterror"):(n=!0,e.data().isEdit=1)}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);o.doAction("delete",e.data())}),e.on("click","#change-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);o.doAction("change",e.data())}),e.on("click","#dir-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);o.doAction("directive",e.data())})}]}}]),p.initDirective("cmdbGroupTable",["$timeout","$compile","$filter",function(t,s,l,c){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,t,a){var r,o,e=t,n=!1;function i(t){var a;if(0<t.isEdit){for(var e in a='<table width="100%" class="table table-inner">',o){if(a+='<tr role="row"><td class="col-xs-3">'+(s=o[e]).label+":</td>","numberic"==s.dataType)a+='<td><input datatype="'+s.dataType+'" class="form-control input-sm" type="number" name="'+s.name+'" value="'+(t.values.hasOwnProperty(s.name)?t.values[s.name]:"")+'"></td>';else if("icon"==s.dataType){var n="";for(var e in t.values.hasOwnProperty(s.name)&&(n=t.values[s.name]),a+='<td><div name="'+s.name+'" datatype="'+s.dataType+'" class="col-sm-12 no-padding iconSelect"><select class="combobox form-control input-sm iconShow"><option value="">请选择...</option>',d.iconList)d.iconList[e].icon==n?a+='<option selected="true" value="'+d.iconList[e].icon+'">'+d.iconList[e].title+"</option>":a+='<option value="'+d.iconList[e].icon+'">'+d.iconList[e].title+"</option>";a+="</select>",a+="</div></td>"}else if("standardAddress"==s.dataType){var i=[];for(var e in t.values.hasOwnProperty(s.name)&&(i=t.values[s.name].split(",")),a+='<td><div name="'+s.name+'" datatype="'+s.dataType+'" class="col-sm-12 no-padding selectList"><select class="combobox form-control input-sm province"><option value="">请选择...</option>',d.provinces)0<i.length&&d.provinces[e].label==i[0]?(d.citys=d.provinces[e].children,a+='<option selected="true" value="'+d.provinces[e].id+'">'+d.provinces[e].label+"</option>"):a+='<option value="'+d.provinces[e].id+'">'+d.provinces[e].label+"</option>";for(var e in a+="</select>",a+='<select class="combobox form-control input-sm city '+(1<i.length?"":"ng-hide")+'"><option value="">请选择...</option>',d.citys)1<i.length&&d.citys[e].label==i[1]?(d.districts=d.citys[e].children,a+='<option selected="true" value="'+d.citys[e].id+'">'+d.citys[e].label+"</option>"):a+='<option value="'+d.citys[e].id+'">'+d.citys[e].label+"</option>";for(var e in a+="</select>",a+='<select class="combobox form-control input-sm district '+(2<i.length?"":"ng-hide")+'"><option value="">请选择...</option>',d.districts)3==i.length&&d.districts[e].label==i[2]?a+='<option selected="true" value="'+d.districts[e].id+'">'+d.districts[e].label+"</option>":a+='<option value="'+d.districts[e].id+'">'+d.districts[e].label+"</option>";a+="</select>",a+="</div></td>"}else"datetime"==s.dataType?a+='<td><input datatype="'+s.dataType+'" class="form-control input-sm" type="text" name="'+s.name+'" value="'+(t.values.hasOwnProperty(s.name)?l("date")(t.values[s.name],"yyyy-MM-dd HH:mm:ss"):"")+'"></td>':"date"==s.dataType?a+='<td><input datatype="'+s.dataType+'" class="form-control input-sm" type="text" name="'+s.name+'" value="'+(t.values.hasOwnProperty(s.name)?l("date")(t.values[s.name],"yyyy-MM-dd"):"")+'"></td>':a+='<td><input datatype="'+s.dataType+'" class="form-control input-sm" type="text" name="'+s.name+'" value="'+(t.values.hasOwnProperty(s.name)?t.values[s.name]:"")+'"></td>';a+="</tr>"}a+='<tr><td><div class="btn-group btn-group-sm"><a id="save-btn" class="btn btn-default"><i class="fa fa-check  hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default" ><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a></div></td></tr></table>'}else{for(var e in a='<table width="100%" class="table table-inner">',o){var s;a+='<tr role="row"><td class="col-xs-3">'+(s=o[e]).label+":</td>","datetime"==s.dataType?a+="<td>"+(t.values.hasOwnProperty(s.name)?l("date")(t.values[s.name],"yyyy-MM-dd hh:mm:ss"):"")+"</td>":"date"==s.dataType?a+="<td>"+(t.values.hasOwnProperty(s.name)?l("date")(t.values[s.name],"yyyy-MM-dd"):"")+"</td>":a+="<td>"+(t.values.hasOwnProperty(s.name)?t.values[s.name]:"")+"</td>",a+="</tr>"}a+="</table>"}return a}d.$on(Event.CMDBINFOSINIT,function(t,a){r&&r.destroy(),n=!1,o=a.option[1],r=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:p.datatable.language,data:a.option[0],order:[[4,"asc"]],columns:[{data:"label",title:"名称"},{data:"onlineStatus",title:"在线状态"},{data:"health",title:"健康度"},{data:"domainPath",title:"资源域"},{data:"id",title:"编码",visible:!0},{data:"option",orderable:!1,title:"操作"}],columnDefs:[{targets:0,data:"label",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input maxlength='20' style='width:100%' class='form-control input-sm' type='text' value='"+escape(t)+"'>":escape(t)}},{targets:1,data:"onlineStatus",render:function(t,a,e){return"<span class='label "+("online"==t?"label-primary":"label-warning")+"'>"+("online"==t?"在线":"离线")+"</span>"}},{targets:2,data:"health",render:function(t,a,e){return"<div class='progress progress-xs progress-striped active'><div class='progress-bar "+(90<t?"progress-bar-success":79<t?"progress-bar-warning":59<t?"progress-bar-minor":39<t?"progress-bar-major":"progress-bar-red")+"' style='width:"+t+"%'></div></div>"}},{targets:3,data:"domainPath",render:function(t,a,e){var n="",i=d.domainListDic[t].name;return 2==e.isEdit&&"display"==a?(n+="<input name='domainPath' domain-Picker class='form-control input-sm' type='text' value='"+i+"' domainPath='"+t+"'>")||(n+="<input name='domainPath'  domain-Picker class='form-control input-sm' type='text' domainPath='' value='请选择...'>"):n+=i,n}},{targets:5,data:"option",render:function(t,a,e){return 2==e.isEdit?'<div class="btn-group  btn-group-sm"><a id="save-btn" class="btn btn-default"><i class="fa fa-check  hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">保存</span></a><a id="cancel-btn" class="btn btn-default" ><i class="fa fa-close hidden-lg hidden-md hidden-sm"></i><span class="hidden-xs ng-binding">取消</span></a></div>':"<div class='btn-group  table-option-group btn-group-sm'><button type='button' class='btn btn-default'>操作</button><button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button><ul class='dropdown-menu' role='menu'><li><a href='#/configAlert/"+e.id+"/node'>告警</a></li><li><a href='#/emcsView/"+e.id+"'>性能</a></li><li><a href id='edit-btn'>编辑</a></li><li><a href id='del-btn'>删除</a></li></ul></div>"}}],rowCallback:function(t,a,e){s(t)(d)}})}),e.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addIns()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加设备组</span></a>'),s(t)(d)}),e.on("click","td",function(t){var a=$(this).closest("tr"),e=r.row(a);if(e.data()){if(5==$(this).context.cellIndex&&0==e.data().isEdit)return;e.child.isShown()?0==e.data().isEdit?(e.child.hide(),a.removeClass("shown")):2!=e.data().isEdit&&3!=e.data().isEdit||(e.child(i(e.data())).show(),a.addClass("shown")):(e.child(i(e.data())).show(),a.addClass("shown")),2==e.data().isEdit&&$(".selectList").each(function(){var e,a=$(this).find(".province"),n=$(this).find(".city"),i=$(this).find(".district"),s=function(){e='<option value="">请选择...</option>';var t=n.get(0).selectedIndex;0==t?i.addClass("ng-hide"):(d.districts=d.citys[t-1].children,i.removeClass("ng-hide"),$.each(d.districts,function(t,a){e+="<option value='"+a.id+"'>"+a.label+"</option>"}),i.html(e))};a.change(function(){!function(){e='<option value="">请选择...</option>';var t=a.get(0).selectedIndex;0==t?n.addClass("ng-hide"):(d.citys=d.provinces[t-1].children,n.removeClass("ng-hide"),$.each(d.citys,function(t,a){e+="<option value='"+a.id+"'>"+a.label+"</option>"}),n.html(e),s())}()}),n.change(function(){s()})})}else{t.stopPropagation(),t.preventDefault();var n=$(this).find("input");$.each(n,function(t,a){"datetime"==$(a).attr("datatype")?($(a).daterangepicker({singleDatePicker:!0,showDropdowns:!0,timePicker:!0,minDate:"2000-01-01 00:00:00",maxDate:"2025-12-31 23:59:59",locale:{format:"YYYY-MM-DD HH:mm:ss",applyLabel:"确定",cancelLabel:"取消",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1}},function(t,a,e){}),$(a).attr("datatype",""),$(a).click()):"date"==$(a).attr("datatype")&&($(a).daterangepicker({singleDatePicker:!0,showDropdowns:!0,timePicker:!1,minDate:"2000-01-01",maxDate:"2025-12-31",locale:{format:"YYYY-MM-DD HH:mm:ss",applyLabel:"确定",cancelLabel:"取消",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1}},function(t,a,e){}),$(a).attr("datatype",""),$(a).click())})}}),e.on("click","#export-btn",function(t){var a=$(this).closest("tr"),e=r.row(a);d.doAction("export",e.data())}),e.on("click","#save-btn",function(t){if(t.stopPropagation(),!$("save-btn").attr("disabled")){var i=$(this).closest("tr"),s=!0,o=null;for(var a in r.rows(".shown").data())2==r.rows(".shown").data()[a].isEdit&&(o=r.rows(".shown").data()[a]);if($.each($(".shown").children(),function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){if(0!=t&&3!=t)return;var n=e.children("input").val();3==t&&(n=e.children("input").attr("domainPath"),l=n),n?($(a).removeClass("danger"),r.cell(e).data(n),$(i).removeClass("danger"),s=!0):($(a).addClass("danger"),s=!1,0==t&&c.warning("请输入名称",{}),3==t&&c.warning("请选择一个设备域",{}))}}),!o){var e=r.row(i);o=e.data();var l=$(i).find('input[name="domainPath"]').attr("domainPath");$(i).find('input[name="domainPath"]').val();if(!l)return $(i).addClass("danger"),s=!1,void c.warning("请选择一个设备域",{});$(i).removeClass("danger"),s=!0}if(s){var n=i.parent().find("input");$.each(n,function(t,a){var e=$(a).val(),n=$(a).attr("name");o.values[n]=e}),$(".iconSelect").each(function(){var t=$(this).find(".iconShow"),a=$(t).val(),e=$(this).attr("name");o.values[e]=a}),$(".selectList").each(function(){var t=$(this).find(".province"),a=$(this).find(".city"),e=$(this).find(".district"),n=$(e).val();n||(n=$(a).val()),n||(n=$(t).val());var i=$(this).attr("name");o.values[i]=n})}s&&($("save-btn").attr("disabled",!0),d.doAction("save",o))}}),e.on("click","#cancel-btn",function(t){if(t.stopPropagation(),n=!1,(a=r.row(".shown")).data())a.data().isEdit=0,a.child.hide(),a.cells().invalidate(),d.doAction("cancel",a.data());else{var a,e=$(this).closest("tr");(a=r.row(e)).data().isEdit=0,a.child.hide(),a.cells().invalidate(),d.doAction("cancel",a.data())}}),e.on("click","#edit-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=r.row(a);n?0==e.data().isEdit&&d.doAction("eidterror"):(n=!0,e.data().isEdit=2,e.cells().invalidate(),s(a)(d))}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=r.row(a);d.doAction("delete",e.data())}),e.on("click","#change-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=r.row(a);d.doAction("change",e.data())}),e.on("click","#dir-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=r.row(a);d.doAction("directive",e.data())})}]}}])});
//# sourceMappingURL=../../map/js/directives/cmdb-dom.js.map
