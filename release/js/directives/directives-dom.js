define(["directives/directives"],function(t){"use strict";t.initDirective("directiveTable",["$timeout","$compile","growl",function(t,i,r){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,t,a){var l,e=t,n=!1;d.$on(Event.DIRECTIVESINIT,function(t,a){l&&l.destroy(),n=!1,l=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:$.ProudSmart.datatable.language,data:a.data,columns:[{data:"name",title:"指令名称"},{data:"commandCode",title:"指令编码"},{data:"description",title:"描述"},{data:"option",title:"操作",orderable:!1}],columnDefs:[{targets:0,data:"name",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input class='form-control input-sm' style='border: 1px solid #F18282;width: 100%;' type='text'  value='"+t+"'>":t}},{targets:1,data:"commandCode",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input class='form-control input-sm' style='border: 1px solid #F18282;width: 100%;' type='number'  value='"+t+"'>":t}},{targets:2,data:"description",render:function(t,a,e){return 2==e.isEdit&&"display"==a?"<input class='form-control input-sm'  type='text' value='"+(t||"")+"'>":t}},{targets:3,data:"option",render:function(t,a,e){var n="<div class='btn-group btn-group-sm'>";return e.canEdit&&(2==e.isEdit?(n+="<a id='save-btn' class='btn btn-default btn-sm' ><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",e.isNew?n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>":n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>"):n+="<div class='btn-group table-option-group' ><button type='button' class='btn btn-default btn-sm'>操作</button><button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button><ul class='dropdown-menu' role='menu'><li><a  href='' id='edit-btn'>修改</a></li><li><a  href='' id='del-btn'>删除</a></li><li><a  href='' id='point-btn'>设置测点</a></li></ul></div>"),n+="</div>"}}]})}),e.on("init.dt",function(){if(d.selectedDitem&&d.selectedDitem.canEdit){var t=$(".special-btn").parent();t.html('<a ng-click="addModelSubItem()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加指令</span></a>'),i(t)(d)}}),e.on("click","#point-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);a.hasClass("time-color")?a.removeClass("time-color"):(l.$("tr.time-color").removeClass("time-color"),a.addClass("time-color")),d.devicePointInit(e.data(),"point")}),e.on("click","#save-btn",function(t){t.stopPropagation(),t.preventDefault();var a=$(this).closest("tr"),i=l.row(a);if(2==i.data().isEdit){var e=$(this).parents("tr").children(),s=!0;$.each(e,function(t,a){var e=$(a);if(0==t||1==t){if(!(n=e.children("input").val()))return $(a).addClass("danger"),s=!1,i.data().isEdit=2,i.cells().invalidate(),!1;if(1==t&&4<n.length)return r.warning("您输入任务编码超过了4位数字!",{}),$(a).addClass("danger"),s=!1;$(a).removeClass("danger")}if(3==t)return i.cell(e).invalidate(),!0;var n=e.children("input").val();e.html(n),l.cell(e).data(n)}),s&&d.doAction("directive-save",i.data(),function(t){0==t?i.data().isEdit=2:(i.data().id=t.id,i.data().isEdit=0,i.data().isNew=!1,i.cells().invalidate(),n=!1)})}}),e.on("click","#edit-btn",function(t){if(t.preventDefault(),n)d.doAction("thresholdMessage","当前有修改中的指令，请先完成该操作");else{n=!0;var a=$(this).closest("tr"),e=l.row(a);e.data().isEdit=2,e.cells().invalidate()}}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);e.data().isDel=!0;var n=e.data();d.doAction("directive-delete",n,function(t){t&&e.remove().draw(!1)})}),e.on("click","#cancel-btn",function(t){if(t.preventDefault(),n){n=!1;var a=$(this).closest("tr"),e=l.row(a);e.data().isEdit=0,e.cells().invalidate()}}),e.on("click","#params-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),i=l.row(a);if(2==i.data().isEdit){var e=$(this).parents("tr").children(),s=!0;$.each(e,function(t,a){var e=$(a);if(2==t){if(!(n=e.children("input").val()))return $(a).addClass("danger"),s=!1;if($(a).removeClass("danger"),s){var n=e.children("input").val();l.cell(e).data(n),d.doAction("directive-params",i.data())}}})}else d.doAction("directive-params",i.data())})}]}}])});
//# sourceMappingURL=../../map/js/directives/directives-dom.js.map
