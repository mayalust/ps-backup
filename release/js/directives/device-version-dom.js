define(["directives/directives","datatables.net"],function(o,t){"use strict";o.initDirective("faultTable",["$timeout","$compile","growl",function(t,n,d){return{restrict:"A",controller:["$scope","$element","$attrs",function(s,t,a){var i,e=t,l=!1;s.$on(Event.UNITTYPEINIT+"_fault",function(t,a){i&&i.destroy(),l=!1,i=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:o.datatable.language,data:a.data,rowCallback:function(t,a,e){n(t)(s)},columns:[{title:"故障编码",data:"faultNo"},{title:"故障分类",data:"category"},{title:"故障名称",data:"label"},{title:"操作",orderable:!1,data:"option"}],columnDefs:[{targets:0,data:"faultNo",render:function(t,a,e){return"<a href='#faultKnowledge/"+t+"'>"+t+"</a>"}},{targets:1,data:"category",render:function(t,a,e){return null==t?"":t}},{targets:2,data:"label",render:function(t,a,e){return null==t?"":t}},{targets:3,data:"option",render:function(t,a,e){var n="<div class='btn-group btn-group-sm'>";return 2==e.isEdit?(n+="<a id='save-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",n+="<a id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>"):n+="<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>",n+="</div>"}}]})}),e.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<select class="form-control" style="min-width:200px" selectdata="faultList" itemchange="addFault" select2></select>'),n(t)(s)}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=i.row(a),n=s.faultSave;null!=n&&""!=n&&"-1"!=n?(e.data().fault=n,s.doActionFault("saveFault",e.data(),function(t){e.data().isEdit=0,e.cells().invalidate(),l=!1})):d.warning("请选择故障",{})}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=i.row(a);e.data().isDel=!0;var n=e.data();s.doActionFault("faultDelete",n,function(t){t&&e.remove().draw(!1)})}),e.on("click","#cancel-btn",function(t){if(t.stopPropagation(),t.preventDefault(),l){l=!1;var a=$(this).closest("tr"),e=i.row(a);e.data().isEdit=0,e.cells().invalidate()}})}]}}]),o.initDirective("technicalTable",["$timeout","$compile","growl",function(t,n,a){return{restrict:"A",controller:["$scope","$element","$attrs",function(i,t,a){var l,e=t;i.$on(Event.UNITTYPEINIT+"_technical",function(t,a){l&&l.destroy(),!1,l=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:o.datatable.language,data:a.data,columns:[{title:"项目",data:"project"},{title:"参数",data:"parameter"},{title:"备注",data:"remark"},{title:"操作",orderable:!1,data:"option"}],columnDefs:[{targets:0,data:"project",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'   type='text'  maxlength='20'  style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:1,data:"parameter",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'   type='text'  maxlength='100'  style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:2,data:"remark",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'   type='text'  maxlength='20'  style='width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"option",render:function(t,a,e){var n="<div class='btn-group btn-group-sm'>";return 0<e.isEdit?(n+="<a id='save-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",e.id?n+="<a id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>":n+="<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>"):(n+="<a id='update-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></a>",n+="<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>"),n+="</div>"}}]})}),e.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addTechnical()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加技术参数</span></a>'),n(t)(i)}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=l.row(a),s=!0;$.each(a.children(),function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){var n=$.trim(e.children("input").val());if(n&&"请选择..."!=n)$(a).removeClass("danger"),l.cell(e).data(n);else if(0==t||1==t)return l.cell(e).data(n),$(a).addClass("danger"),s=!1}}),s&&i.doActionTechnical("save",e.data(),function(t){t&&(e.data().id=t.id,e.data().isEdit=0,e.cells().invalidate(),!1)})}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),t.preventDefault(),!1;var a=$(this).closest("tr"),e=l.row(a);e.data().isEdit=0,e.cells().invalidate()}),e.on("click","#update-btn",function(t){!0;var a=$(this).closest("tr"),e=l.row(a);e.data().isEdit=2,e.invalidate().columns.adjust().draw(!1,!0)}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);e.data().isDel=!0;var n=e.data();i.doActionTechnical("delete",n,function(t){t&&e.remove().draw(!1)})})}]}}]),o.initDirective("majorTable",["$timeout","$compile","growl",function(t,n,d){return{restrict:"A",controller:["$scope","$element","$attrs",function(i,t,a){var l,e=t;i.$on(Event.UNITTYPEINIT+"_major",function(t,a){l&&l.destroy(),!1,l=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:o.datatable.language,data:a.data,columns:[{title:"部件名称",data:"name"},{title:"规格",data:"specification"},{title:"数量",data:"num"},{title:"备注",data:"remark"},{title:"操作",orderable:!1,data:"option"}],columnDefs:[{targets:0,data:"name",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'  placeholder='请输入部件名称'  type='text'  maxlength='20'  style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:1,data:"specification",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'  placeholder='请输入规格'  type='text'  maxlength='20'  style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:2,data:"num",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'  placeholder='数量只能输入数字' type='number'  maxlength='20'  style='border: 1px solid #F18282;width: 100%;' value='"+t+"'>":t}},{targets:3,data:"remark",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'   placeholder='请输入备注' type='text'  maxlength='20'  style='width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:4,data:"option",render:function(t,a,e){var n="<div class='btn-group btn-group-sm'>";return 0<e.isEdit?(n+="<a id='save-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",e.id?n+="<a id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>":n+="<a id='del-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>"):n+="<button type='button' class='btn btn-default btn-sm'>操作</button><button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button><ul class='dropdown-menu' role='menu'><li><a  href='javascript:(0);' id='update-btn'>修改</a></li><li><a  href='' id='del-btn'>删除</a></li><li><a  href='' id='spare-btn'>关联备件</a></li></ul>",n+="</div>"}}]})}),e.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addMajor()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加主要部件</span></a>'),n(t)(i)}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=l.row(a),s=!0;$.each(a.children(),function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){var n=$.trim(e.children("input").val());if(n&&"请选择..."!=n){if(2==t&&!/^[1-9][0-9]*$/.test(n))return d.warning("数量不能为负数!",{}),$(a).addClass("danger"),s=!1;$(a).removeClass("danger"),l.cell(e).data(n)}else if(0==t||1==t||2==t)return l.cell(e).data(n),$(a).addClass("danger"),s=!1}}),s&&i.doActionMajor("save",e.data(),function(t){2!=e.data().isEdit&&(e.data().id=t.id),e.data().isEdit=0,e.cells().invalidate(),!1})}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),t.preventDefault(),!1;var a=$(this).closest("tr"),e=l.row(a);e.data().isEdit=0,e.cells().invalidate()}),e.on("click","#update-btn",function(t){!0;var a=$(this).closest("tr"),e=l.row(a);e.data().isEdit=2,e.cells().invalidate()}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);e.data().isDel=!0;var n=e.data();i.doActionMajor("delete",n,function(t){t&&e.remove().draw(!1)})}),e.on("click","#spare-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);a.hasClass("time-color")?a.removeClass("time-color"):(l.$("tr.time-color").removeClass("time-color"),a.addClass("time-color")),i.devicePointInit(e.data(),"spare")})}]}}]),o.initDirective("taskModelTable",["$timeout","$compile","growl",function(t,n,d){return{restrict:"A",controller:["$scope","$element","$attrs",function(s,t,a){var l,e=t;s.$on(Event.UNITTYPEINIT+"_task",function(t,a){l&&l.destroy(),!1,l=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:o.datatable.language,data:a.data,columns:[{title:"任务名称",data:"name"},{title:"任务编码",data:"taskCode"},{title:"任务周期(秒)",data:"taskTime"},{title:"操作",orderable:!1,data:"option"}],columnDefs:[{targets:0,data:"name",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'   type='text'  maxlength='20' placeholder='输入任务名称'  style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:1,data:"taskCode",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'  type='number' size='4'  min='1'  max='10000' placeholder='只能输入1~4位数字' style='border: 1px solid #F18282;width: 100%;' value='"+t+"'>":t}},{targets:2,data:"taskTime",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6'   type='number'  max ='5' placeholder='输入任务周期(秒)'  style='border: 1px solid #F18282;width: 100%;' value='"+escape(t)+"'>":escape(t)}},{targets:3,data:"option",render:function(t,a,e){var n="<div class='btn-group table-option-group' >";return 2==e.isEdit||3==e.isEdit?(n+="<a id='save-btn' class='btn btn-default btn-sm'><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",e.id?n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 取消</span></a>":n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 删除</span></a>"):n+="<div class='btn-group table-option-group'><button type='button' class='btn btn-default btn-sm'>操作</button><button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button><ul class='dropdown-menu' role='menu'><li><a id='edit-btn' >修改</a></li><li><a href id='del-btn' >删除</a></li><li><a href id='point-btn' >设置测点</a></li></ul></div>",n+="</div>"}}]})}),e.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addTask()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加任务</span></a>'),n(t)(s)}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=l.row(a),i=!0;$.each(a.children(),function(t,a){var e=$(a);if(!e.has("button").length&&e.has("input").length){var n=$.trim(e.children("input").val());if(n&&"请选择..."!=n){var s=/^[0-9]*$/;if(1==t){if(!s.test(n))return d.warning("任务编码不能为负数!",{}),$(a).addClass("danger"),i=!1;if(4<n.length)return d.warning("您输入任务编码超过了4位数字!",{}),$(a).addClass("danger"),i=!1}if(2==t){if(0==n)return d.warning("任务周期必须大于0的整数!",{}),$(a).addClass("danger"),i=!1;if(!s.test(n))return d.warning("任务周期不能为负数!",{}),$(a).addClass("danger"),i=!1}$(a).removeClass("danger"),l.cell(e).data(n)}else if(0==t||1==t||2==t)return l.cell(e).data(n),$(a).addClass("danger"),i=!1}}),i&&s.doActionTask("save",e.data(),function(t){e.data().id=t.id,e.data().isEdit=0,e.cells().invalidate(),!1})}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),t.preventDefault(),!1;var a=$(this).closest("tr"),e=l.row(a);e.data().isEdit=0,e.cells().invalidate()}),e.on("click","#edit-btn",function(t){!0;var a=$(this).closest("tr"),e=l.row(a);e.data().isEdit=2,e.cells().invalidate()}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);e.data().isDel=!0;var n=e.data();s.doActionTask("delete",n,function(t){t&&e.remove().draw(!1)})}),e.on("click","#point-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=l.row(a);a.hasClass("time-color")?a.removeClass("time-color"):(l.$("tr.time-color").removeClass("time-color"),a.addClass("time-color")),s.devicePointInit(e.data(),"task")})}]}}]),o.initDirective("documentTable",["$timeout","$compile","growl",function(t,n,l){return{restrict:"A",controller:["$scope","$element","$attrs",function(s,t,a){var i,e=t;s.$on(Event.UNITTYPEINIT+"_document",function(t,a){i&&i.destroy(),!1,i=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:o.datatable.language,data:a.data,columns:[{title:"文档名称",data:"name"},{title:"文档路径",data:"qualifiedName"},{title:"操作",orderable:!1,data:"option"}],columnDefs:[{targets:0,data:"name",render:function(t,a,e){return 0<e.isEdit?"<input class='form-control col-xs-6' id='docName' name='docName'  type='text'  maxlength='80' placeholder='请输入文档名称'  style='border: 1px solid #F18282;width: 100%;' value='"+escape(decodeURIComponent(t))+"'>":escape(decodeURIComponent(t))}},{targets:1,data:"qualifiedName",render:function(t,a,e){return 0<e.isEdit?'<input type="file" nv-file-select uploader="uploader"/>':escape(t)}},{targets:2,data:"option",render:function(t,a,e){var n="<div class='btn-group table-option-group' >";return 3==e.isEdit?(n+="<button id='save-btn' class='btn btn-default btn-sm'  ng-disabled='uploader.queue.length == 0'><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 上传</span></button>",e.id?n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 取消</span></a>":n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 删除</span></a>"):(n+="<a id='dow-btn' class='btn btn-default btn-sm'><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 下载</span></a>",n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 删除</span></a>"),n+="</div>"}}],rowCallback:function(t,a,e){n(t)(s)}})}),e.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addDocument()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 新建文档</span></a>'),n(t)(s)}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=i.row(a),n=$("#docName").val();null!=n&&""!=n?s.UploadFile(n,s.selectedDitem.id,function(t){t&&(e.data().isEdit=0,e.data().name=t.name,e.data().qualifiedName=t.qualifiedName,e.data().id=t.id,e.cells().invalidate(),!1)}):l.warning("文档名称不能为空",{})}),e.on("click","#uploadImg",function(t){t.preventDefault(),$("#fileUp").trigger("click")}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),t.preventDefault(),!1;var a=$(this).closest("tr"),e=i.row(a);e.data().isEdit=0,e.cells().invalidate()}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=i.row(a);e.data().isDel=!0;var n=e.data();s.doActionDocument("delete",n,function(t){t&&e.remove().draw(!1)})}),e.on("click","#dow-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=i.row(a),n=s.dowLoadUrl+e.data().qualifiedName;window.open(n)})}]}}]),o.initDirective("directivesPointTable",["$timeout","$compile",function(t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,t,a){var i,e=t;d.$on(Event.DIRECTIVESINIT+"_point",function(t,a){i&&i.destroy(),!1,i=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:o.datatable.language,data:a.data,ordering:!1,columns:[{title:"测点名称",data:"label"},{title:"数据类型",data:"dataTypeId"},{title:"操作",data:"option"}],columnDefs:[{targets:0,data:"name",render:function(t,a,e){var n="";if(3==e.isEdit){var s=d.initListDate.kpiList,i="<select id='selKpi' name='selKpi' class='combobox form-control input-sm'>";for(var l in i+='<option value="">请选择...</option>',s)i+='<option value="'+s[l].id+'">'+s[l].label+"</option>";n=i+="</select>"}else n=t;return n}},{targets:1,data:"dataTypeId",render:function(t,a,e){var n=d.initListDate.allDataTypes,s="";if(""!=t&&null!=t)for(var i in n)if(n[i].id==t){s=n[i].name;break}return s}},{targets:2,data:"option",render:function(t,a,e){var n="<div class='btn-group ' >";return 3==e.isEdit?(n+="<a id='save-btn' class='btn btn-default btn-sm' style='margin-right: 10px;'><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 取消</span></a>"):(n+="<a id='move-btn' class='btn btn-default btn-sm' style='margin-right: 10px;'><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 上移</span></a>",n+="<a id='down-btn' class='btn btn-default btn-sm'  style='margin-right: 10px;'><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 下移</span></a>",n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 删除</span></a>"),n+="</div>"}}]})}),e.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addStation()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 选择测点</span></a>'),n(t)(d)}),e.on("click","#move-btn",function(t){var a=i.row($(this).parents("tr")).index();if(0!=$(this).parents("tr").index()){var e=i.data();i.clear(),e.splice(a-1,0,e.splice(a,1)[0]),i.rows.add(e).draw()}}),e.on("click","#down-btn",function(t){var a=i.row($(this).parents("tr")).index(),e=$(this).parents("tr"),n=$(".down-btn").length;if(e.index()!=n-1){var s=i.data();i.clear(),s.splice(a+1,0,s.splice(a,1)[0]),i.rows.add(s).draw()}}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=(i.row(a).data(),d.selectedDitem.kpis),n=$("#selKpi option:selected").val();if(""!=n||null!=n)for(var s in e)if(e[s].id==n){d.doActionStation("save",e[s]);break}}),e.on("click","#cancel-btn",function(t){t.stopPropagation();var a=$(this).closest("tr");i.row(a).remove().draw(!1)}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=i.row(a);e.data().isDel=!0;var n=e.data();d.doActionStation("removeDomain",n,function(t){t&&e.remove().draw(!1)})})}]}}]),o.initDirective("majorAttachmentTable",["$timeout","$compile",function(t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(l,t,a){var i,e=t;l.$on(Event.DIRECTIVESINIT+"_attachment",function(t,a){i&&i.destroy(),!1,i=e.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:o.datatable.language,data:a.data,order:[0,"asc"],columns:[{title:"",data:"id",visible:!1},{title:"备件编号",data:"name"},{title:"备件名称",data:"label"},{title:"当前数量",data:"stockNumber"},{title:"操作",orderable:!1,data:"option"}],columnDefs:[{targets:1,data:"name",render:function(t,a,e){var n="";if(3==e.isEdit){var s=l.initListDate.allSpareParts;for(var i in n+='<select id="allSpare" name="allSpare" class="combobox form-control input-sm">',n+='<option value="">请选择...</option>',s)n+="<option value='"+s[i].id+"' >"+s[i].label+"</option>";n+="</select>"}else n="<a href='#sparepartInfo/"+e.id+"'>"+t+"</a>";return n}},{targets:2,data:"label",render:function(t,a,e){return t}},{targets:3,data:"stockNumber",render:function(t,a,e){return t}},{targets:4,data:"option",render:function(t,a,e){var n="<div class='btn-group ' >";return 3==e.isEdit?(n+="<a id='save-btn' class='btn btn-default btn-sm' style='margin-right: 10px;'><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",n+="<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 取消</span></a>"):n+="<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 删除</span></a>",n+="</div>"}}]})}),e.on("init.dt",function(){var t=$(".special-btn").parent();t.html('<a ng-click="addAttachment()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 选择备件</span></a>'),n(t)(l)}),e.on("click","#save-btn",function(t){t.stopPropagation();var a=$(this).closest("tr"),e=(i.row(a).data(),l.initListDate.allSpareParts),n=$("#allSpare option:selected").val();if(""!=n||null!=n)for(var s in e)if(e[s].id==n){l.doActionStation("save",e[s]);break}}),e.on("click","#cancel-btn",function(t){t.stopPropagation(),t.preventDefault();var a=$(this).closest("tr");i.row(a).remove().draw(!1)}),e.on("click","#del-btn",function(t){t.preventDefault();var a=$(this).closest("tr"),e=i.row(a);e.data().isDel=!0;var n=e.data();l.doActionStation("delAttachment",n,function(t){t&&e.remove().draw(!1)})})}]}}])});
//# sourceMappingURL=../../map/js/directives/device-version-dom.js.map
