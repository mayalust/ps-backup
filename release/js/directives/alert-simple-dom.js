define(["directives/directives"],function(e){"use strict";e.initDirective("aeditTable",["$timeout","$compile",function(e,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,e,t){var c,o,a=e,r=[{name:"警告告警",value:"1"},{name:"次要告警",value:"2"},{name:"重要告警",value:"3"},{name:"严重告警",value:"4"}],u=[{name:"大于",value:"compare(value,refValue)>0"},{name:"大于等于",value:"compare(value,refValue)>=0"},{name:"小于",value:"compare(value,refValue)<0"},{name:"小于等于",value:"compare(value,refValue)<=0"},{name:"表达式",value:""}];d.$on(Event.ALERTEDITINIT,function(e,t){c&&c.destroy(),!1,o=t.data,!1,c=a.DataTable({dom:'<"row"<"col-sm-6"<"special-btn">><"col-sm-6"f>><"row"<"clo-sm-12">>t<"row"<"col-sm-2"i><"col-sm-2"l><"col-sm-8"p>>',language:$.ProudSmart.datatable.language,data:o.alerts,order:[[4,"desc"]],rowCallback:function(e,t,a){n(e)(d)},columns:[{data:"label",title:"告警名称",width:"200px"},{data:"thresholds",title:"告警规则"},{data:"enabled",title:"启用",width:"30px"},{data:"option",orderable:!1,title:"操作",width:"100px"},{data:"id",title:"",visible:!1}],columnDefs:[{targets:0,data:"label",render:function(e,t,a){return a.instance?"":2==a.isEdit&&"display"==t?"<input style='width:100%' maxlength='100' class='form-control input-sm' type='text' value='"+escape(e)+"'>":escape(e)}},{targets:1,data:"thresholds",orderable:!1,render:function(e,t,a){var n,s="";if(void 0!==e&&null!=e&&0!=e.length&&(n=e[0]),2==a.isEdit&&"display"==t){if(n){if(n.nodeIds&&null==n.nodeIdsforSelect)n.nodeIdsforSelect=[],n.nodeIds.split(",").forEach(function(e){n.nodeIdsforSelect.push("number:"+e)}),n.nodeIdsforSelect=n.nodeIdsforSelect.toString();for(var l in s='<select name="kpiCode-name" class="combobox form-control input-sm"><option value="NaN" selected disabled>指标类型...</option>',o.kpis)n.kpiCode==o.kpis[l].id?s+='<option value="'+o.kpis[l].id+'" selected>'+o.kpis[l].label+"</option>":s+='<option value="'+o.kpis[l].id+'">'+o.kpis[l].label+"</option>";for(var l in s+="</select>&nbsp;",s+='<select name="condition-name" class="combobox form-control input-sm"><option value="NaN" selected disabled>计算条件...</option>',u)n.condition==u[l].value?s+='<option value="'+u[l].value+'" selected>'+u[l].name+"</option>":s+='<option value="'+u[l].value+'">'+u[l].name+"</option>";for(var l in s+="</select>&nbsp;",s+="<input name='refValue-name' class='form-control input-sm' type='text' value='"+escape(n.refValue)+"'>&nbsp;",s+="<input class='form-control input-sm' type='text' style='display:none' value='"+n.id+"'/>",s+='<select name="severity-name" class="combobox form-control input-sm"><option value="NaN" selected disabled>告警级别...</option>',r)n.severity==r[l].value?s+='<option value="'+r[l].value+'" selected>'+r[l].name+"</option>":s+='<option value="'+r[l].value+'">'+r[l].name+"</option>";s+="</select>&nbsp;",d.selectedDitem&&d.selectedDitem.resources&&0<d.selectedDitem.resources.length?s+="<select buttonclass='btn btn-default btn-sm' multiple='multiple' numberdisplayed='0' bootstrap-multiselect nonselectedtext='所有设备...' optionclass='disabled' ng-model='threshold.nodeIds"+(new Date).getTime()+"' selectvalues='"+n.nodeIdsforSelect+"' ng-options='item.id as item.label for item in selectedDitem.resources'></select>":s+="<select disabled='true' class='combobox form-control input-sm'><option value=''>无设备...</option></select>"}else{for(var l in s='<select name="kpiCode-name" class="combobox form-control input-sm"><option value="NaN" selected disabled>指标类型...</option>',o.kpis)s+='<option value="'+o.kpis[l].id+'">'+o.kpis[l].label+"</option>";for(var l in s+="</select>&nbsp;",s+='<select name="condition-name" class="combobox form-control input-sm"><option value="NaN" selected disabled>计算条件...</option>',u)s+='<option value="'+u[l].value+'">'+u[l].name+"</option>";for(var l in s+="</select>&nbsp;",s+="<input name='refValue-name' class='form-control input-sm' type='text' value='' placeholder='参考值'>&nbsp;",s+="<input class='form-control input-sm' type='text' style='display:none' value=''/>",s+='<select name="severity-name" class="combobox form-control input-sm"><option value="NaN" selected disabled>告警级别...</option>',r)s+='<option value="'+r[l].value+'">'+r[l].name+"</option>";s+="</select>&nbsp;",d.selectedDitem&&d.selectedDitem.resources&&0<d.selectedDitem.resources.length?s+="<select ng-disabled='!selectedDitem.resources || selectedDitem.resources.length == 0' buttonclass='btn btn-default btn-sm' multiple='multiple' numberdisplayed='0' bootstrap-multiselect nonselectedtext='所有设备...' optionclass='disabled' ng-model='threshold.nodeIds' selectvalues='' ng-options='item.id as item.label for item in selectedDitem.resources'></select>":s+="<select disabled='true' class='combobox form-control input-sm'><option value=''>无设备...</option></select>"}return s}if(n){if(n.nodeIds){var i=[];n.nodeIds.split(",").forEach(function(e){for(var t in o.resources)if(e==o.resources[t].id){i.push(o.resources[t].label);break}}),(i=i.toString())&&(s=i+"的")}for(var l in o.kpis)if(n.kpiCode==o.kpis[l].id){s+=o.kpis[l].label;break}for(var l in u)if(n.condition==u[l].value){"表达式"==u[l].name?s+="满足条件：":s+=u[l].name;break}for(var l in s+=n.refValue+"时，进行",r)if(n.severity==r[l].value){s+=r[l].name;break}return void 0!==n.enabled&&(a.enabled=n.enabled),s+="。<span class='text-right'><a id='instance-btn' href=''>点击添加阈值</a><span>"}return[]}},{targets:2,data:"enabled",orderable:!1,render:function(e,t,a){var n="<div class='text-center'>";return n+=e?"<a id='enable-btn' class='btn btn-social-icon btn-sm'><i class='fa fa-check-square-o'></i></a>":"<a id='unable-btn' class='btn btn-social-icon btn-sm'><i class='fa fa-square-o'></i></a>",n+="</div>"}},{targets:3,data:"option",render:function(e,t,a){var n="<div class='btn-group btn-group-sm'>";return a.canEdit&&(2==a.isEdit?(n+="<a id='save-btn' class='btn btn-default' ><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>",a.isNew?n+="<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>":n+="<a id='cancel-btn' class='btn btn-default' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>"):(n+="<a id='edit-btn' class='btn btn-default' ><i class='fa fa-edit  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></a>",n+="<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>")),n+="</div>"}}]})}),a.on("init.dt",function(){var e=$(".special-btn").parent();e.html('<a ng-click="addModelSubItem()" class="btn btn-default btn-sm"><i class="fa fa-plus"></i><span class="hidden-xs"> 添加告警</span></a>'),n(e)(d)}),a.on("click","#instance-btn",function(e){e.stopPropagation();var t=$(this).closest("tr"),a=c.row(t),n=c.rows()[0].length;if(d.doAction("alert-instance",a.data()),c){for(var s=c.page.info(),l=c.rows(),i=0,o=0;;o++)if(l[0][o]==n){i=Math.floor(o/s.length);break}0<i&&c.page(i).draw("page")}}),a.on("click","#save-btn",function(e){if(e.stopPropagation(),!$("#save-btn").attr("disabled")){var t=$(this).closest("tr"),l=c.row(t);if(2==l.data().isEdit){var a=$(this).parents("tr").children(),i=!0;if($.each(a,function(e,t){var a=$(t);if(0==e&&!l.data().instance){if(!(s=a.children("input").val())||""==s)return $(t).addClass("danger"),i=!1,!(l.data().isEdit=2);$(t).removeClass("danger")}if(1==e)for(var n=0;n<a.children("input, select").length;n++)if(3!=n&&5!=n){var s=$(a.children("input,select")[n]).val();if(1!=n&&(!s||"NaN"==s)||1==n&&"NaN"==s)return $(a.children("input,select")[n]).css("background-color","#f2dede"),i=!1,!(l.data().isEdit=2);$(a.children("input,select")[n]).css("background-color","#fffff")}}),i){var n=[],o={};$.each(a,function(e,t){var a=$(t);if(0==e){var n=a.children("input").val();l.data().name=n,l.data().label=n}if(1==e){o.kpiCode=$(a.children("input, select")[0]).val(),o.condition=$(a.children("input, select")[1]).val(),o.refValue=$(a.children("input, select")[2]).val(),o.id=$(a.children("input, select")[3]).val(),o.severity=$(a.children("input, select")[4]).val(),o.nodeIds=[];var s=$(a.children("input, select")[5]).val();s&&0<s.length&&s.forEach(function(e){var t=e.split(":");o.nodeIds.push(t[t.length-1])}),o.nodeIds=o.nodeIds.toString()}2==e&&(0==a.find("#enable-btn").length?o.enabled=!1:o.enabled=!0)}),n.push(o),l.data().thresholds=n,d.doAction("alert-save",l.data(),function(e){0==e?l.data().isEdit=2:(l.data().id=e.id,l.data().isEdit=0,l.data().isNew=!1,l.cells().invalidate().draw(!1),!1)})}}}}),a.on("click","#edit-btn",function(e){e.preventDefault(),!0;var t=$(this).closest("tr"),a=c.row(t);a.data().isEdit=2,a.cells().invalidate().draw(!1)}),a.on("click","#cancel-btn",function(e){e.preventDefault();var t=$(this).parents("tr").children(),a=$(this).closest("tr"),n=c.row(a);n.data().isEdit=0,n.cells().invalidate().draw(!1),$.each(t,function(e,t){$(t).removeClass("danger")}),0==n.data().thresholds[0].id&&d.doAction("alert-cancel",n.data(),function(e){e&&n.remove().draw(!1)})}),a.on("click","#del-btn",function(e){e.preventDefault();var t=$(this).closest("tr"),a=c.row(t);a.data().isDel=!0,d.doAction("alert-delete",a.data(),function(e){e&&a.remove().draw(!1)})}),a.on("change","[name=condition-name]",function(e){if(e.stopPropagation(),null!=$(e.target).val()&&""!=$(e.target).val()){/^[-]?([0]\.[0-9]+|[1-9]+[0-9]*\.?[0-9]+)?$/.test($($(e.target).siblings()[1]).val())||($($(e.target).siblings()[1]).css("background-color","#f2dede"),$($(e.target).siblings()[1]).val(""),$($(e.target).siblings()[1]).attr("placeholder","请输入正确数字"))}else $($(e.target).siblings()[1]).css("background-color","white"),$($(e.target).siblings()[1]).attr("placeholder","参考值")}),a.on("click","#unable-btn",function(e){e.stopPropagation();var t,a=$(this).closest("tr"),n=c.row(a);if(void 0!==n.data().thresholds&&null!=n.data().thresholds&&0!=n.data().thresholds.length){var s=$(this).closest("td"),l="<div class='text-center'><a id='enable-btn' class='btn btn-social-icon btn-sm' data-toggle='tooltip' ><i class='fa fa-check-square-o'></i></a></div>";2==n.data().isEdit?s.html(l):(n.data().enabled=!0,n.data().thresholds[0].enabled=!0,t=s,d.doAction("alert-enable",n.data(),function(e){e&&t.html("<div class='text-center'><a id='enable-btn' class='btn btn-social-icon btn-sm' data-toggle='tooltip' ><i class='fa fa-check-square-o'></i></a></div>")}))}}),a.on("click","#enable-btn",function(e){e.stopPropagation();var t,a=$(this).closest("tr"),n=c.row(a);if(void 0!==n.data().thresholds&&null!=n.data().thresholds&&0!=n.data().thresholds.length){var s=$(this).closest("td"),l="<div class='text-center'><a id='unable-btn' class='btn btn-social-icon btn-sm'><i class='fa fa-square-o'></i></a></div>";2==n.data().isEdit?s.html(l):(n.data().enabled=!1,n.data().thresholds[0].enabled=!1,t=s,d.doAction("alert-enable",n.data(),function(e){e&&t.html("<div class='text-center'><a id='unable-btn' class='btn btn-social-icon btn-sm'><i class='fa fa-square-o'></i></a></div>")}))}})}]}}])});
//# sourceMappingURL=../../map/js/directives/alert-simple-dom.js.map
