function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["directives/directives"],function(directives){"use strict";var arrayLike=[/^\[.*/,/.*\]$/],objectLike=[/^\{.*/,/.*\}$/],functionLike=[/^function\(.*\)\{/,/.*\}$/],test=function(e,t){var n=!0;for(var i in t)n=n&&t[i].test(e);return n};function isArrayLike(e){return test(e,arrayLike)}function isObjectLike(e){return test(e,objectLike)}function isFunctionLike(e){return test(e,functionLike)}var objToString=function(e){return"function"==typeof e?e.toString():"object"==_typeof(e)?JSON.stringify(e,null,2):e+""},stringToObj=function stringToObj(string){var rs;try{rs=isArrayLike(string)||isFunctionLike(string)?eval(string):isObjectLike(string)?JSON.parse(string):string}catch(e){}finally{return rs}};directives.initDirective("fbTitle",["$q","$timeout",function(e,t){var n={restrict:"A",link:function(e,t,n){var i=$("<div></div>");$(t).css("position","relative"),i.css("position","absolute"),i.css("background-color","rgba(0,0,0,.7)"),i.css("padding","5px"),i.css("color","#fff"),i.css("border-radius","3px"),i.css("left","0px"),i.css("top","40px"),i.text("scope.fbTitle"),i.css("pointer-events","none"),i.text(n.fbTitle),$(t).on("mouseenter",function(){$(t).append(i)}),$(t).on("click",function(){i.remove()}),$(t).on("mouseleave",function(){i.remove()})}};return n}]),directives.initDirective("buttonGroup",["$q","$timeout",function(e,r){var t={scope:{label:"=",click:"&",options:"="},restrict:"A"};return t.link=function(n,e,t){var o,i=$("<div></div>").addClass("btn-group btn-group-sm"),a=$("<button></button>").addClass("btn btn-default"),c=$("<button></button>").addClass("btn btn-default dropdown-toggle"),l=$("<span></span>").addClass("caret"),s=$("<ul></ul>").addClass("dropdown-menu");c.append(l),i.append(a).append(c).append(s),$(e).append(i),c.on("click",function(e){i.hasClass("open")?i.removeClass("open"):i.addClass("open")}),a.on("click",function(e){n.$apply(function(){n.click({type:o})})});r(function(){n.$watch("label",function(t,e,n){if(t){var i=n.options.find(function(e){return e.value==t});o=i.value,a.text("添加"+i.name+"样式")}}),function(){var e=function(t){var e=$("<li></li>"),n=$("<a></a>").text(t.name);return e.append(n),e.on("click",function(e){i.removeClass("open"),o=t.value,a.text("添加"+t.name+"样式")}),e};for(var t in n.options)s.append(e(n.options[t]))}()})},t}]),directives.initDirective("selectTwo",["$q","$window","$timeout",function(e,t,n){var l=[{id:0,text:"加载中，请稍后。。。"}];return{replace:!0,scope:{ngModule:"=",options:"=",placeholder:"=",noresults:"=",init:"&",change:"&"},restrict:"A",link:function(i,e,t){var n,o=$(e),a=new c;function c(){}c.prototype.loading=function(){this.create(l)},c.prototype.create=function(e){(n=$("<select></select>")).css("width","100%"),n.css("display","none"),o.append(n),i.init({view:e[0]});var t={language:{noResults:function(){return i.noresults||"没有该匹配项"}},placeholder:i.placeholder||"请选择...",data:e};$$.loadExternalJs(["select2"],function(){o.css("border",0),o.css("padding",0),n.select2(t),n.on("select2:select",function(e){var t=e.params.data.id,n=i.options.find(function(e){return e.id==t});i.$apply(function(){i.change({view:n})})})})},c.prototype.destroy=function(){return"object"==_typeof(n)&&n.select2&&(n.select2("destroy"),n=null),o.children().remove(),this},i.$watch("options",function(e,t,n){var i;"object"==_typeof(i=e)&&i instanceof Array&&0<i.length&&(a.destroy(),a.create(e))})}}}]),directives.initDirective("ngThumb",["$q","$window","$timeout",function(e,t,n){var l=!(!t.FileReader||!t.CanvasRenderingContext2D),s=function(e){return angular.isObject(e)&&e instanceof t.File},r=function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)};return{restrict:"A",template:"<canvas/>",link:function(e,t,n){if(l){var i=e.$eval(n.ngThumb);if(s(i.file)&&r(i.file)){var o=t.find("canvas"),a=new FileReader;a.onload=function(e){var t=new Image;t.onload=c,t.src=e.target.result},a.readAsDataURL(i.file)}}function c(){var e=i.width||this.width/this.height*i.height,t=i.height||this.height/this.width*i.width;o.attr({width:e,height:t}),o[0].getContext("2d").drawImage(this,0,0,e,t)}}}}]),directives.initDirective("fileInput",["$q","$timeout","FileUploader","configUIService","growl",function(e,n,l,s,r){var t={scope:{ngModel:"=",fileFormat:"="},restrict:"A",template:'<div  ng-if="uploader" style="border:1px solid #ddd; background-color:#eee; padding : 5px;"><input id="nv-file-select" class="form-control" type="file" nv-file-select uploader="uploader"><table class="table" style="margin-bottom: 0;" ng-show="uploader.queue.length > 0"><thead><tr> <th width="50%">图片名称</th><th ng-show="uploader.isHTML5">尺寸</th><th>操作</th> </tr> </thead><tbody> <tr ng-repeat="item in uploader.queue"> <td><strong>{{ item.file.name }}</strong><div ng-show="uploader.isHTML5" ng-thumb="{ file: item._file, height: 70 }"></div></td><td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024/1024|number:2 }} MB</td></td><td nowrap><button type="button" class="btn btn-success btn-xs" ng-click="item.upload()" ng-disabled="item.isReady || item.isUploading || item.isSuccess"><span class="glyphicon glyphicon-upload"></span> 上传 </button></td></tr></tbody> </table></div>',link:function(c,e,t){require(["angular-file-upload"],function(){n(function(){var n={domainPath:"",groupName:"dashboardImage",id:0,invalid:!1,key:"",keyDesc:"",label:"",value:""},o=c.fileFormat&&c.fileFormat.fileFormat?c.fileFormat.fileFormat:"|jpg|png|jpeg|bmp|gif|svg|",e=c.fileFormat&&c.fileFormat.queueLimit?c.fileFormat.queueLimit:1,a=c.fileFormat&&$scope.fileFormat.fileMaxSize?$scope.fileFormat.fileMaxSize:1,i=c.uploader=new l({url:s.origin+"/api/rest/uploadConfig/configUIService/uploadConfigFile",withCredentials:!0});i.filters.push({name:"imageFilter",fn:function(e,t){var n=e.name.split("."),i=n[n.length-1];return-1==o.indexOf(i)?(r.warning("文件格式仅支持"+o+"文件，请重新选择",{}),!1):!(e.size/1024>1e3*a)||(r.warning("您选择的文件大于"+a+"M，请重新选择",{}),!1)}}),i.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},i.onAfterAddingFile=function(t){if(i.queue.length>e)return i.removeFromQueue(e),void r.info("已达上传图片张数",{});n.label=t.file.name,s.saveConfig(n,function(e){c.ngModel.trigger("imageFileUploaded",e.data),0==e.code&&(n.id=e.data.id,t.formData.push({value:"images/dashboardImage",id:n.id}))})},i.onAfterAddingAll=function(e){},i.onBeforeUploadItem=function(e){},i.onProgressItem=function(e,t){},i.onProgressAll=function(e){},i.onSuccessItem=function(e,t,n,i){},i.onErrorItem=function(e,t,n,i){},i.onCancelItem=function(e,t,n,i){},i.onCompleteItem=function(e,t,n,i){if(console.info("onCompleteItem",t),t)if(0==t.code){var o=t.data;c.ngModel=o,r.success("图片上传成功",{})}else r.error(t.message,{});else r.error("操作异常了，尝试重新刷新",{})},i.onCompleteAll=function(){}})})}};return t}]),directives.initDirective("selectImage",["$q","$timeout","FileUploader","configUIService","fuploader","growl",function(e,t,n,f,v,g){var i={scope:{ngModel:"=",options:"=",format:"=",change:"&"},restrict:"A",link:function(d,u,e){var p=d.format||{label:"label",value:"value"};t(function(){var l={},t=function(e,t){l[e]=t},s=function(e){t("updated",function(){s(e)})},r=function(e){t("toolLoaded",function(){r(e)})};$$.loadExternalJs(["toolkit/single-select","toolkit/image-drag"],function(e,t){var n=$("<div></div>"),i=$("<div></div>"),o=$("<div></div>"),a=e.init(n,p);r=function(e){a.setOption(e),a.setValue(d.ngModel),i.imageprev()},s=function(e){i.imageprev("option","changeSrc",f.origin+"/"+e)},"function"==typeof l.toolLoaded&&l.toolLoaded(),"function"==typeof l.updated&&l.updated();var c=t.init(o);$(u).children().remove(),$(u).append(n).append(i).append(o),c.on("submit",function(e){v.uploadFile(e,function(e){r(d.options.concat({label:e.data.label,value:e.data.value})),d.ngModel=e.data.value,a.setValue(e.data.value),o.css("display","none"),i.css("display","block"),i.imageprev("option","changeSrc",f.origin+"/"+e.data.value),c.reset()})}),c.on("change",function(e){g.success("图片更新后需要点击上传按钮保存后才可使用！")}),a.on("click",function(e){"upload"!=e?(d.$apply(function(){d.ngModel=e}),i.css("display","block"),o.css("display","none")):(i.css("display","none"),o.css("display","block"))})}),d.$watch("ngModel",function(e,t,n){e&&s(e)}),d.$watch("options",function(e,t,n){e&&("upload"!=e[0].value&&e.unshift({label:"上传图片",value:"upload"}),r(e))})})}};return i}]),directives.initDirective("selectSingle",["$q","$timeout",function(e,t){var n={scope:{ngModel:"=",options:"=",format:"=",change:"&"},restrict:"A"};return n.link=function(a,n,e){t(function(){$$.loadExternalJs(["toolkit/single-select"],function(e){var t=a.format||{label:"label",value:"value"},o=e.init(n,t);o.on("click",function(e){a.$apply(function(){a.ngModel=e})});a.$watch("options",function(e,t,n){var i;e&&(i=e,o.setOption(i),o.setValue(a.ngModel))})})})},n}]),directives.initDirective("copyButton",["$q","$timeout","growl",function(e,t,c){var n={scope:{ngModel:"="},restrict:"E",link:function(e,t,n){var i=$("<button></button>").addClass("btn btn-primary"),o=$("<span></span>"),a=$("<span></span>").text("复制到剪切版");o.addClass("glyphicon glyphicon-copy"),i.append(o),i.append(a),t.append(i),$$.loadExternalJs(["clipboard"],function(e){var t=new e(i[0]);t.on("success",function(e){c.success("成功复制到剪切版"),e.clearSelection()}),t.on("error",function(e){console.error("Action:",e.action),console.error("Trigger:",e.trigger)})}),e.$watch("ngModel",function(e,t,n){i.attr("data-clipboard-text",e)})}};return n}]),directives.initDirective("timeselect",["$q","$timeout",function(e,i){var t={scope:{ngModel:"=",change:"&"},restrict:"E",template:"      <div class='row'>        <div class='col-md-6'>          <input ng-model='ngModel.value' class='form-control'/>        </div>        <div class='col-md-6'>          <div class='btn-group btn-group-sm' role='group'>            <a ng-repeat='unit in units'              ng-click = 'selectClick(unit)'              class='btn btn-default'              ng-class='{true : \"active\", false : \"\"}[ngModel.unit==unit.value]'              ng-bind='unit.label'>            </a>          </div>        </div>      </div>",link:function(t,e,n){i(function(){t.units=[{label:"月",value:"month"},{label:"天",value:"day"},{label:"小时",value:"hour"},{label:"分钟",value:"minute"},{label:"秒",value:"second"}],t.selectClick=function(e){t.change(),t.ngModel.unit=e.value}})}};return t}]),directives.initDirective("evalinput",["$q","$timeout",function(e,i){var t={restrict:"A",scope:{ngModel:"=",change:"&"},link:function(n,t,e){i(function(){var e=$("<input class='form-control' />");e.val(objToString(n.ngModel)),e.on("change",function(e){var t=this;n.$apply(function(){n.change(),n.ngModel=$(t).val()})}),$(t).append(e)})}};return t}]),directives.initDirective("fbToggle",["$q","$timeout",function(e,i){var t={restrict:"A",template:"<div class='toggle-wrap' ng-click='toggleClick();$event.stopPropagation();'><div class='toggle-inner'></div></div>",scope:{ngModel:"=",change:"&"},link:function(t,n,e){i(function(){var e=function(){t.ngModel?$(n).find(".toggle-wrap").addClass("active"):$(n).find(".toggle-wrap").removeClass("active")};e(),t.toggleClick=function(){t.ngModel=!t.ngModel,t.change({value:t.ngModel}),e()}})}};return t}]),directives.initDirective("autoMultiselect",["$q","$timeout",function(e,n){var t={restrict:"A",scope:{ngModel:"=",multiple:"=",options:"=",config:"=",change:"&"},link:function(r,t,e){var d=$("<select class='multiselect' multiple='multiple'></select>");null==r.ngModel&&(r.ngModel=[]),n(function(){$$.loadExternalJs(["bootstrap-multiselect"],function(e){n(function(){var c,l="label",s="id";0==r.multiple?d.removeAttr("multiple"):d.attr("multiple","multiple");r.config&&(l=r.config.disp,s=r.config.id,c=r.config.valueOnly);$(t).append(d),r.$watch("options",function(e,t,n){function i(t,e){var n=r.options.find(function(e){return c?t==e[s]:t[s]==e[s]});e(n?c?t:t[s]:null)}if(e){d.children().remove();var o=function(e){return $("<option value='"+e[s]+"'>"+e[l]+"</option>")};if(0==r.options.length)d.multiselect("rebuild"),d.multiselect("disable");else{for(var a in r.options)d.append(o(r.options[a]));for(var a in d.multiselect("rebuild"),r.options)d.multiselect("deselect",r.options[a].id);for(var a in 0==r.multiple&&0==r.ngModel.length&&(r.ngModel=c?[r.options[0].id]:[r.options[0]]),r.ngModel)i(r.ngModel[a],function(e){e?d.multiselect("select",e):r.ngModel.$remove(function(e,t){return e==a})})}}});d.multiselect({selectAll:!0,enableFiltering:!0,buttonWidth:"100%",buttonText:function(e){{if(0==e.length)return"没有选择";if(1<e.length)return"已选择"+e.length+"个";var t="";return e.each(function(){t+=$(this).text()+", "}),t.substr(0,t.length-2)}},onChange:function(t,i){r.$apply(function(){var n=$(t).val();if(i){var e=r.options.find(function(e){return e[s]==n});0==r.multiple?r.ngModel=c?[e.id]:[e]:c?r.ngModel.push(e[s]):r.ngModel.push(e)}else c?r.ngModel.$remove(function(e,t){return t==n}):r.ngModel.$remove(function(e,t){return t.id==n})})}})})})})}};return t}]),directives.initDirective("select",["$timeout",function(e){var t={};return t.scope={ngModel:"=",options:"=",change:"&"},t.template="    <div class='btn-group btn-group-sm' role='group'>      <a ng-repeat='value in options'        ng-click = 'selectClick(value)'        class='btn btn-default'        ng-class='{true : \"active\", false : \"\"}[ngModel==value.value]'        ng-bind='value.label'>      </a>    </div>",t.restrict="A",t.link=function(t,e,n){t.selectClick=function(e){t.ngModel=e.value,t.change()}},t}]),directives.initDirective("excel",["$timeout",function(o){var e={};return e.scope={ngModel:"="},e.restrict="A",e.link=function(t,e,n){var i=$("<div></div>");o(function(){e.append(i),$(e).css("overflow","auto"),$(e).css("margin","5px auto"),$(e).css("height","100px"),$(e).css("background-color","#eee"),$$.loadExternalJs(["handsontable"],function(e){i.handsontable({data:t.ngModel,rowHeaders:!0,colHeaders:!0,manualColumnResize:!0,manualRowResize:!0,minSpareCols:1,minSpareRows:1})})})},e}]),directives.initDirective("excelPrev",["$timeout",function(o){var e={};return e.scope={source:"="},e.restrict="A",e.link=function(t,e,n){var i=$("<div></div>");o(function(){e.append(i),$(e).css("overflow","auto"),$(e).css("margin","5px auto"),$(e).css("height","100px"),$(e).css("background-color","#eee"),$$.loadExternalJs(["handsontable"],function(e){window.Handsontable=e,i.handsontable({data:[],rowHeaders:!0,colHeaders:!0,manualColumnResize:!0,manualRowResize:!0,minSpareCols:0,minSpareRows:0}),t.$watch("source",function(e,t,n){e&&i.handsontable("loadData",e)})})})},e}]),directives.initDirective("codeMirrorEditor",["$timeout","growl","commonMethodService",function(e,t,l){var n={};return n.scope={ngModel:"=",options:"=",target:"=",show:"=",style:"="},n.restrict="A",n.link=function(i,e,t){i.height=t.height;var o,c=$("<div></div>");$(e).append(c),c.css("position","relative"),c.css("width","100%"),i.height?c.css("height",i.height):c.css("height","250px");c.css("border","1px solid #ddd"),c.css("overflow","auto"),require(["ace","ace-language"],function(e,t){var a=[{caption:"target",value:"target",metal:"local"},{caption:"event",value:"event",metal:"local"}];for(var n in l.prototype)a.push({caption:n,value:n,metal:"local"});t&&"function"==typeof t.addCompleter&&t.addComplete({getCompletions:function(e,t,n,i,o){o(null,a)}}),(o=e.edit(c[0])).session.setMode("ace/mode/html"),o.setTheme("ace/theme/tomorrow"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),o.session.setMode("ace/mode/javascript"),i.ngModel&&o.insert(i.ngModel),o.on("change",function(e){i.$apply(function(){i.ngModel=o.getValue()})})})},n}]),directives.initDirective("codeMirror",["$timeout","growl","$rootScope","commonMethodService",function(e,t,n,k){var i={};return i.scope={ngModel:"=",options:"=",target:"=",show:"=",config:"=",change:"&",open:"&",rootTarget:"="},i.restrict="A",i.link=function(x,i,e){var w,y,t=$("<div></div>").addClass("input-group"),n=$("<div></div>").addClass("input-group-btn"),o=$("<button></button>").addClass("btn btn-default").text("预览"),a=$("<button></button>").addClass("btn btn-primary").text("编辑"),c=$("<button></button>").addClass("btn btn-default").text("复制代码"),l=($("<button></button>").addClass("btn btn-default").text("粘贴代码"),$("<input />").addClass("form-control").css("pointer-events","none"));c.on("click",function(e){}),x.target&&(x.target.open=function(){a.trigger("click")});n.append(a),$(i).append(t),t.append(l),t.append(n),x.$watch("ngModel",function(e,t,n){if(e){var i=objToString(e);l.val(i)}}),x.$watch("show",function(e,t,n){null!=e&&$(i).css("display",e?"block":"none")});var s=function(t){var l,e=objToString(x.ngModel),n=$("<button></button>"),i=$("<button></button>"),o=($("<div></div>").css("padding","10px 40px").css("color","red").css("display","none").text("代码输入错误！"),$("<button></button>").addClass("btn btn-default").text("复制代码"),$("<button></button>").addClass("btn btn-default").text("粘贴代码"),$("<div></div>").addClass("btn-group btn-group-sm")),a=$("<button></button>").addClass("btn btn-primary").text("运行");o.css("position","absolute"),o.css("right","20px"),o.css("top","30px"),o.css("z-index",1),n.addClass("btn btn-default"),n.text("关闭"),i.addClass("btn btn-primary"),i.text("应用(ctrl+o)");var c=$("<button><i class='fa fa-align-left'></i>整理代码</button>").addClass("btn btn-primary");c.click(function(){require(["jsToBeautify"],function(e){var t=e(x.ngModel);w.session.setValue(""),w.insert(t)})}),o.append(c),o.append(a),o.append(i);var s=$("<div></div>").css("position","fixed").css("z-index",99999),r=$("<div></div>").text("prev"==t?"预览代码":"编辑代码").css("font-size","16px").css("line-height","50px").css("font-weight","bold").css("text-align","center").css("width","100%"),d=$("<pre></pre>").css("margin","0px 10px"),u=$("<div></div>").css("height","1px").css("width","100%"),p=$("<div></div>").css("width","calc(100vw - 20px)").css("height","calc(100vh - 20px)").css("position","relative").css("margin","10px 10px 0 10px").css("background-color","#fff").css("border","1px solid #eee"),f=$("<div></div>").css("background-color","rgba(0,0,0,.8)").css("width","100vw").css("height","100vh"),v=$("<div id='echartContent' style='padding: 30px 20px 0; position:relative; overflow:hidden;'></div>"),g=$("<div></div>"),b=$("<div id='editor'></div>");b.css("width","100%"),b.css("height","90%"),b.css("border","1px solid #ddd"),d.text(e),s.append(f),f.append(u),f.append(o),f.append(p),p.append(r),p.append(u),p.append(b);var h=function(){v.width(width),$$.loadExternalJs(["../../toolkit/component/"+x.rootTarget.type],function(e){var t=x.rootTarget.getAdvance(),n=x.rootTarget.getStyle(),i=x.rootTarget.getSource(),o=x.rootTarget.getParameters();g.find("#echartContent").children().remove();var a=new k({advance:t.data,style:n.data,parameter:o.data,data:i.data});l={element:a},g.find("#echartContent").append(e(l))})},m=function(){if("prev"==t)p.append(d);else{var e=$("<div></div>");g.css({width:"60%",height:"calc(90% - 2px)",background:"#f3f3f3","z-index":"30",position:"absolute",right:"0",top:"52px"}),e.css({width:"2px",height:"100%","padding-top":"60px",cursor:"col-resize",background:"#ccc"}),e.append(v),g.append(e),p.append(g);var c=g[0],e=e[0];v.parent().parent().width();e.onmousedown=function(e){var t=e||event,i=t.clientX,o=c.offsetWidth,a=c.offsetLeft+c.offsetWidth;return document.onmousemove=function(e){var t,n=e||event;c.style.width=o-(n.clientX-i)+"px",c.style.left=a-c.offsetWidth+"px",c.offsetWidth<=400?(c.style.width="400px",c.style.left=a-c.offsetWidth+"px"):(t=v.parent().parent().width()-30,v.width(t),"function"==typeof l.element.resize&&l.element.resize())},document.onmouseup=function(){document.onmousedown=null,document.onmousemove=null},h(),!1}}};return i.on("click",function(){y.remove()}),n.on("click",function(){y.remove()}),a.on("click",h),setTimeout(function(){x.rootTarget&&m(),require(["ace","ace-language"],function(e,t){var a=[{caption:"target",value:"target",metal:"local"},{caption:"event",value:"event",metal:"local"}];for(var n in k.prototype)a.push({caption:n,value:n,metal:"local"});t&&"function"==typeof t.addCompleter&&t.addComplete({getCompletions:function(e,t,n,i,o){o(null,a)}}),(w=e.edit(b[0])).session.setMode("ace/mode/html"),w.setTheme("ace/theme/tomorrow"),w.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),w.on("change",function(e){var t=w.getValue();$$.runExpression(t,function(e){0!=e.code&&console.error(e)}),x.$apply(function(){x.change(),x.ngModel=w.getValue()})}),w.session.setMode("ace/mode/javascript"),x.ngModel=x.ngModel||"","object"==_typeof(x.ngModel)?w.insert(JSON.stringify(x.ngModel,null,2)):w.insert(x.ngModel)})}),s};o.on("click",function(e){y=s("prev"),$("body").prepend(y)}),a.on("click",function(e){y=s("edit"),$("body").prepend(y)})},i}]),directives.initDirective("kpiSelector",["$timeout","growl",function(t,e){var n={};return n.scope={ngModel:"=",options:"=",target:"=",show:"=",config:"="},n.restrict="A",n.link=function(d,l,e){t(function(){var e,t,n,i,o=$("<div></div>"),a=$("<div></div>");o.css("width","100%"),o.css("border","1px solid #ddd"),o.append((e=$("<div></div>"),t=$("<div></div>"),n=$("<div></div>"),(i=$("<div></div>")).css("height","1px"),i.css("clear","both"),t.text("变量名"),t.css("width","50px"),t.css("float","left"),t.css("text-align","center"),t.css("line-height","30px"),t.css("background-color","#eee"),t.css("padding","2px"),n.css("width","calc(100% - 50px)"),n.css("float","left"),n.css("line-height","30px"),n.text("对应KPI指标"),n.css("text-align","center"),n.css("background-color","#eee"),n.css("padding","2px"),e.append(t),e.append(n),e.append(i),e)),o.append(a),$(l).append(o);var c=function(){a.children().remove();var e=function(n,e){var t,i=$("<div></div>"),o=$("<div></div>"),a=$("<div></div>"),c=$("<select></select>"),l=function(e){var t=$("<option></option>");return t.text(e.label),t.attr("value",e.id),t};for(var s in e||c.append(((t=$("<option></option>")).text("--请选择--"),t.attr("value",0),t)),d.options)c.append(l(d.options[s]));var r=$("<div></div>");return r.css("height","1px"),r.css("clear","both"),c.addClass("form-control"),c.attr("id","kpi_"+e.id),o.text(n),o.css("width","50px"),o.css("float","left"),o.css("text-align","center"),o.css("line-height","30px"),o.css("padding","2px"),a.css("width","calc(100% - 50px)"),a.css("float","left"),a.css("padding","2px"),a.append(c),i.append(o),i.append(a),i.append(r),e&&c.val(e),c.on("change",function(e){var t=c.find("option[value=0]");t.remove(),d.$apply(function(){d.ngModel[n]=$(e.target).val()})}),i};for(var t in d.ngModel)a.append(e(t,d.ngModel[t]))};d.$watch("ngModel",function(e,t,n){o.append(c())}),d.$watch("options",function(e,t,n){o.append(c())})})},n}]),directives.initDirective("exceloneline",["$timeout",function(o){var e={};return e.scope={ngModel:"="},e.restrict="A",e.link=function(t,e,n){var i=$("<div></div>");o(function(){e.append(i),$(e).css("overflow","auto"),$(e).css("margin","5px auto"),$(e).css("height","100px"),$(e).css("background-color","#eee"),$$.loadExternalJs(["handsontable"],function(e){window.Handsontable=e,i.handsontable({data:[t.ngModel],rowHeaders:!0,colHeaders:!0,manualColumnResize:!0,manualRowResize:!0,minSpareCols:1,maxRows:1})})})},e}]),directives.initDirective("cronGen",["$timeout",function(v){var e={};return e.scope={ngModel:"=",options:"=",target:"=",show:"=",config:"="},e.restrict="A",e.link=function(p,i,e){var f,t=$("<div></div>").addClass("input-group"),n=$("<div></div>").addClass("input-group-btn"),o=$("<button></button>").addClass("btn btn-default").text("预览"),a=$("<button></button>").addClass("btn btn-primary").text("编辑"),c=$("<button></button>").addClass("btn btn-default").text("复制代码"),l=($("<button></button>").addClass("btn btn-default").text("粘贴代码"),$("<input />").addClass("form-control").css("pointer-events","none"));c.on("click",function(e){}),n.append(a),$(i).append(t),t.append(l),t.append(n),p.$watch("ngModel",function(e,t,n){if(e){var i=objToString(e);l.val(i)}}),p.$watch("show",function(e,t,n){null!=e&&$(i).css("display",e?"block":"none")});var s=function(e){var t=objToString(p.ngModel),n=$("<div></div>"),i=$("<button></button>"),o=$("<button></button>"),a=$("<div></div>").addClass("btn-group btn-group-sm");a.css("position","absolute"),a.css("right","27px"),a.css("top","20px"),a.css("z-index",1),i.addClass("btn btn-default"),i.text("关闭"),o.addClass("btn btn-primary"),o.text("应用"),a.append(o);var c=$("<div></div>").css("position","fixed").css("z-index",99999),l=$("<div></div>").text("编辑CRON表达式").css("font-size","16px").css("line-height","50px").css("font-weight","bold").css("text-align","center").css("width","100%"),s=$("<pre></pre>").css("margin","0px 10px"),r=$("<div></div>").css("height","1px").css("width","100%"),d=$("<div></div>").css("width","980px").css("height","750px").css("position","relative").css("margin","10px auto").css("background-color","#eee").css("border","1px solid #fff").css("border-radius","3px"),u=$("<div></div>").css("background-color","rgba(0,0,0,.8)").css("width","100vw").css("height","100vh");return s.text(t),c.append(u),u.append(r),u.append(d),d.append(a),d.append(l),d.append(r),"prev"==e?d.append(s):(d.append(n),v(function(){n.css("position","relative"),n.css("width","100%"),n.css("border","1px solid #ddd"),n.css("overflow","auto"),$$.loadExternalJs(["cronGen"],function(){n.cronGen({value:p.ngModel,change:function(e){p.$apply(function(){p.ngModel=e.value})}})})})),o.on("click",function(){f.remove()}),i.on("click",function(){f.remove()}),c};o.on("click",function(e){f=s("prev"),$("body").prepend(f)}),a.on("click",function(e){f=s("edit"),$("body").prepend(f)})},e}]),directives.initDirective("numberInput",["$timeout",function(n){var e={};return e.scope={ngModel:"=",ngMaxlength:"=",numberInput:"="},e.restrict="A",e.link=function(e,i,t){n(function(){var n=e.numberInput;$(i).on({keydown:function(e){var t=e.keyCode;(t<37&&8!=t&&9!=t||40<t&&t<48||57<t&&t<96||105<t)&&e.preventDefault(),0<n&&$(i).val().length>n&&e.preventDefault()},change:function(e){0<n&&$(i).val().length>n&&$(i).val($(i).val().slice(0,n))}})})},e}]),directives.initDirective("colorPicker",["$timeout",function(e){var t={restrict:"A",scope:{ngModel:"=",change:"&"},link:function(n,i,e){function t(){n.$watch("ngModel",function(e,t,n){e&&$(i).spectrum("set",e)}),$(i).spectrum({allowEmpty:!0,showPalette:!0,showInput:!0,hideAfterPaletteSelect:!0,color:null,change:function(e){var t;null!=e?(t=e.toRgbString(),$(".block.active").css("background-color",t),$(".block.active").css("border-color",t)):t=e,n.$apply(function(){n.ngModel=t})},palette:[[null,"#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]]})}null==$(i).spectrum?require(["spectrum"],function(){t()}):t()}};return t}]),directives.initDirective("numberMax",["$timeout",function(o){var e={};return e.scope={},e.restrict="A",e.link=function(t,n,e){var i=$$.switchToNumber(e.numberMax);0<i&&o(function(){$(n).on({keydown:function(e){var t=e.keyCode;$(n).val().length>i&&(48<=t&&t<57||65<=t&&t<90||96<=t&&t<117)&&e.preventDefault()},change:function(e){$(n).val().length>i&&$(n).val($(n).val().slice(0,i)),t.ngModel=$(n).val().slice(0,i)}})})},e}]),directives.initDirective("scrollableDiv",["$timeout",function(d){var e={};return e.scope={},e.template="<div class='scrollable-div'><div class='scrollable-div-wrap'><div class='scrollable-div-scroll-x'></div><div class='scrollable-div-scroll-y'><div class='scrollable-div-handler'></div></div></div><div class='scrollable-div-wrap-content'><div ng-transclude class='scrollable-div-content'></div></div></div>",e.transclude=!0,e.restrict="A",e.link=function(e,c,t){var l,s,r,n,i;function o(){n=$(c).find(".scrollable-div-wrap-content").scrollTop(),l=$(c).parent().height(),s=$(c).find(".scrollable-div-content").height(),$(c).find(".scrollable-div").css("height",l),l<s?(i=n/(s-l)*(l-(r=l*l/s)),$(c).find(".scrollable-div-handler").css({height:r,top:i}),$(c).find(".scrollable-div-handler").draggable({containment:$(c).find(".scrollable-div-scroll-y"),axis:"y",cursor:"pointer",drag:a})):$(c).find(".scrollable-div-scroll-y").css("display","none")}function a(e,t){var n=$(c).offset().top,i=t.offset.top,o=l-r,a=i-n;$(c).find(".scrollable-div-wrap-content").css("overflow","scroll").scrollTop(a/o*(s-l)).css("overflow","hidden")}d(o),$(window).on("resize",o)},e}])});
//# sourceMappingURL=../../map/js/directives/fb-tools-dom.js.map
