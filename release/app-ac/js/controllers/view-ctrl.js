define(["controllers/controllers","bootstrap-dialog"],function(e,v){"use strict";e.initController("myViewCtrl",["$scope","$rootScope","$q","Info","solutionUIService","userLoginUIService","marketplaceUIService","modelDefinitionService","userUIService","growl","userInitService",function(o,a,e,t,i,s,n,u,c,l,r){o.placeList="",o.userStatus="",o.industryDic={};var d=function(){i.getSolutionsByStatus(10,function(e){for(var t=e.data,i=[],s=0;s<t.length;s++){var n={};n.id=t[s].id,n.label=t[s].label,n.creator=t[s].creator,null!=t[s].createTime&&""!=t[s].createTime?n.createTime=newDateJson(t[s].createTime):n.createTime=t[s].createTime,n.viewIds=t[s].viewIds,n.modelIds=t[s].modelIds,n.industry=t[s].industry,o.industryDic[n.industry]=!0,n.status=t[s].status,n.icon=t[s].icon,n.desc=t[s].desc,i.push(n)}o.placeList=i,a.placeList=i})},f=function(){if(o.industries)return a.industries=o.industries,void d();var t=e.defer();return u.findAllIndustry(function(e){0==e.code&&(o.industries=e.data,a.industries=e.data,t.resolve())}),t.promise}();f&&f.then(function(){d()}),o.viewUse=function(t){s.user.isAuthenticated?v.show({title:"提示",closable:!1,message:"确认应用 "+escape(t.label)+" 吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){r.applySolution(s.user,t.id,function(e){0==e.code&&l.success("应用该服务方案成功",{})}),e.close()}},{label:"取消",action:function(e){e.close()}}]}):window.location.href="#/myView"},s.user.isAuthenticated?(o.userStatus="yes",o.industryUser=s.user.industry):o.$on("loginStatusChanged",function(e,t){s.user.isAuthenticated?(o.userStatus="yes",o.industryUser=s.user.industry):o.userStatus="no"})}]),e.initController("queryAllCtrl",["$scope","$rootScope","$routeParams","solutionUIService","userLoginUIService","growl",function(i,e,t,s,n,o){i.queryplaceList=[],i.selectedIndustry={},t.industryId&&(e.placeList.forEach(function(e){e.industry==t.industryId&&i.queryplaceList.push(e)}),e.industries.forEach(function(e){e.id==t.industryId&&(i.selectedIndustry=e)})),i.viewUse=function(t){n.user.isAuthenticated?v.show({title:"提示",closable:!1,message:"确认应用 "+escape(t.label)+" 吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){s.buySolution(t.id,function(e){0==e.code&&o.success("应用该服务方案成功",{})}),e.close()}},{label:"取消",action:function(e){e.close()}}]}):window.location.href="#/myView"},n.user.isAuthenticated?(i.userStatus="yes",i.industryUser=n.user.industry):i.$on("loginStatusChanged",function(e,t){n.user.isAuthenticated?(i.userStatus="yes",i.industryUser=n.user.industry):i.userStatus="no"})}]),e.initController("userAppControllers",["$scope","$rootScope","Info","solutionUIService","userLoginUIService","marketplaceUIService","userUIService","growl","ngDialog","viewFlexService",function(c,s,e,t,i,n,o,a,u,l){c.placeList=[],s.placeList=[];e.get("localdb/solution.json",function(e){c.solutionIcons=e.solutionIcons,c.serviceViews=e.serviceViews,c.managedByGroups=e.managedByGroups});function r(){var u=[];l.getAllMyViews(function(e){if(0==e.code){for(var t=e.data,i=[],s=0;s<t.length;s++){var n=t[s];if(n){i.push(n);var o={};if("string"==typeof n.description){/^\{(.|\n)*\}$/.test(n.description)&&(o=JSON.parse(n.description))}if("dashboard"==n.viewType){var a={title:n.viewTitle.split("?")[0],label:n.viewTitle.split("?")[0],url:"#/"+n.viewType+"/"+n.viewId,viewId:n.viewId,id:n.viewId,view:n,status:o.status,statusBg:1==o.status?"bg-red":2==o.status?"bg-green":"",statusLab:1==o.status?"授权":2==o.status?"应用":"",icon:"fa fa-area-chart"};"1"==n.releaseStatus&&u.push(a)}}}c.designView=u,l.viewLoadFinished=!0,l.viewList=i,c.viewList=i}})}var d=null;c.changeViewModel=function(e){d=e},c.confirmView=function(){d?l.getViewById(d,function(e){0==e.code&&t.saveManageViewContent(w.id,e.data.content,function(e){0==e.code&&(a.success("操作成功",{}),callback&&callback())})}):a.warning("请选择一个视图",{})};var f,p=function(){c.placeList=[],s.placeList=[],t.getSolutions(function(e){0==e.code&&e.data.forEach(function(e){c.placeList.push(e),s.placeList.push(e)})})};c.newSolution={},c.confirm=function(){c.newSolution.label?c.newSolution.serviceViewId?0==c.newSolution.managedByGroup||1==c.newSolution.managedByGroup?c.newSolution.icon?t.saveSolution(c.newSolution,function(e){0==e.code&&(c.newSolution.id||(s.placeList.push(e.data),c.placeList.push(e.data)),f.close(),f=null)}):a.warning("方案图标不能为空",{}):a.warning("方案类型不能为空",{}):a.warning("方案模板不能为空",{}):a.warning("方案名称不能为空",{})},c.addSolution=function(){c.newSolution={},f=u.open({template:"partials/solution-info.html",scope:c})};var w=null;c.dashboardEdit=function(e){w=e,f=u.open({template:"partials/views-info.html",scope:c})},c.solutionEdit=function(e){c.newSolution=e,f=u.open({template:"partials/solution-info.html",scope:c})},c.solutionDesgin=function(e){1==(s.selectedSolution=e).managedByGroup?location.href="#/modelsGroup":location.href="#/models"},c.solutionDelete=function(i){v.show({title:"提示",closable:!1,message:"确认删除 "+escape(i.label)+" 吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){t.deleteSolution(i.id,function(e){if(0==e.code){for(var t in c.placeList)if(c.placeList[t].id==i.id)return void c.placeList.splice(t,1);s.placeList=c.placeList}}),e.close()}},{label:"取消",action:function(e){e.close()}}]})},c.solutionPublish=function(i){if(!(0<i.status)){v.show({title:"提示",closable:!1,message:"确认发布 "+escape(i.label)+" 吗？",buttons:[{label:"确定",cssClass:"btn-success",action:function(e){i.status=10,t.saveSolution(i,function(e){if(0==e.code){for(var t in c.placeList)if(c.placeList[t].id==i.id)return void(c.placeList[t].status=i.status);s.placeList=c.placeList}}),e.close()}},{label:"取消",action:function(e){e.close()}}]})}},i.user.isAuthenticated?(p(),r()):c.$on("loginStatusChanged",function(e,t){i.user.isAuthenticated&&(p(),r())})}])});
//# sourceMappingURL=../../../map/app-ac/js/controllers/view-ctrl.js.map
