define(["controllers/controllers","../../../../node_modules/ps-ultility/ps-ultility"],function(e,V){"use strict";e.initController("viewDashboardCtrl",["$scope","$rootScope","$state","$stateParams","userEnterpriseService","$rootScope","$routeParams","resourceUIService","$timeout","growl","$q","$window","$location","viewFlexService","freeboardservice","userLoginUIService","roleViewService","commonMethodService","serviceProxy","commonMethodService2",function(s,e,n,a,t,r,i,o,u,c,l,d,f,v,p,g,h,w,m,y){var S=w(void 0,s);s.instance={};var $=s.$root.viewId=a.viewId,I=a.index;g.user;y.getCurrentParents().then(function(e){var n="device"==function(e){if("string"==typeof e)return e.toLowerCase()}(e[e.length-1].category)&&e[e.length-1].externalDevId,t=e.map(function(e){return e.label}).join(" > ");n&&(t+=" ( "+n+" ) "),r&&(r.treeStr=t)}).catch(function(e){console.error(e.message)}),s.$emit("main_active_index",a.main_active_index);var x,b,C,j,L,M=a.showTree;function O(e,n,t){var r=l.defer();return m.get(e,n,t,function(e){0==e.code?r.resolve(e.data||[]):r.reject(e)},function(e){r.reject(e)}),r.promise}function P(e){if(0==e.code&&null!=e.data){var n,t=(o=e.data.content,"string"==typeof(c=JSON.parse(o)).setting&&(c.setting=JSON.parse(c.setting)),s.setting=c.setting,c.setting&&(s.bgColor=c.setting.color),c);if(t.hasOwnProperty("groups")){var r=t.groups.find(function(e){return a.index==e.path});s.tabIndex=r?t.groups.indexOf(r):0,s.tabs=t.groups,n={layout:t.groups[s.tabIndex].layout,setting:t.setting};var i=new p.replaceCiKpi(n,function(){u(function(){s.instance.setMode(!0),s.instance.renderLayout(i,null,s)})},null,t,s)}else if(t.hasOwnProperty("layout")){s.navigation=[{label:"服务中心"}],n={layout:t.layout,setting:t.setting};i=new p.replaceCiKpi(n,function(){u(function(){s.instance.setMode(!0),s.instance.renderLayout(i,null,s)})},null,t,s)}}else s.error="获取此此用户角色的服务视图发生错误"+(e.message?","+e.message:"");var o,c}s.$root.showTree=0!=M,(x=$,j=l.defer(),L=V.urlparser(d.location.href),/\d+/.test(x+"")?["localhost","127.0.0.1"].some((C=L.address,function(e){return e===C}))&&8080==L.port?(b=x,O("inspectionService","getlisteners",b)).then(function(e){-1!==e.indexOf(x)?(r.stopInspection=function(){var e;(e=x,O("inspectionService","end",e)).then(function(e){c.success("结束本地监听视图 : "+x),d.location.reload()}).catch(function(e){c.error("移除监听故障 : "+x)})},r.saveView=function(){var e;(e=x,O("inspectionService","save",e)).then(function(e){c.success("成功保存视图 : "+x)}).catch(function(e){c.error("不能保存视图 : "+x)})},delete r.startInspection):(r.startInspection=function(){var e;(e=x,O("inspectionService","start",e)).then(function(e){c.success("开始本地监听视图 : "+x),d.location.reload()}).catch(function(e){c.error("监听故障 : "+x)})},delete r.stopInspection,delete r.saveView),void 0!==x&&psrequire(["../app-views/build/"+x+"."+I],function(e){var n=new p.replaceCiKpi(e,function(){u(function(){s.instance.setMode(!0),s.instance.renderLayout(n,null,s)})},null,null,s);j.resolve("user local")},function(e){j.reject("user server")})}):j.reject("user server"):j.reject("not a number"),j.promise).then(function(e){}).catch(function(e){isNaN($)?S.getView({path:"viewCtrl:"+$,item:{}},function(e){var n=new p.replaceCiKpi(e,function(){u(function(){s.instance.setMode(!0),s.instance.renderLayout(n,null,s)})},null,null,s)}):v.getViewById($,P)})}])});
//# sourceMappingURL=../../../map/app-sc/js/controllers/view-dashboard-ctrl.js.map
