{"version":3,"sources":["app-help/js/directives/table-dom.js"],"names":["define","directives","directive","$timeout","$compile","restrict","controller","$scope","$element","$attrs","table","domMain","$on","Event","APPROVEINIT","event","args","destroy","DataTable","dom","language","datatable","data","columns","rowCallback","nRow","aData","iDataIndex","aaSorting","columnDefs","on","parentDom","$","parent","html","e","stopPropagation","tr","this","closest","row","checkPass","protocol","find","val","version","addClass","removeClass","each","children","j","val1","jqob1","has","length","txt","trim","cell","doAction","name","versions","protocolVersions","i","append","protocolVersion","preventDefault","isEditing","parents","isEdit","cells","invalidate","tds","tr1","row1","undefined","eq","remove","ipts","valInp","replaceWith","USERINFOSINIT","rowData","location","href","orderNo","USERCENTERINIT","msgStatus","is","prop","ck2","o","document","getElementsByName","count","num","checked","attr","readMsgStatus","statusUpdate"],"mappings":"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","file":"app-help/js/directives/table-dom.js","sourcesContent":["define(['directives/directives'], function (directives) {\n  'use strict';\n\n  directives.directive('approveTable', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        $scope.$on(Event.APPROVEINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-12\"<\"special-btn\">><\"col-sm-12\">><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: directives.datatable.language,\n            data: args.data,\n            columns: args.columns,\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            },\n            \"aaSorting\": [[0, \"desc\"]],\n            columnDefs: args.columnDefs\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"addProve()\" class=\"pull-right btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 新增</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var checkPass = true;\n          var protocol = $(\"#protocols\").find(\"option:selected\").val();\n          var version = $(\"#version\").find(\"option:selected\").val();\n\n          if (protocol != '请选择...' && protocol != '') {\n            row.data()[\"protocol\"] = protocol;\n            $(\"#protocols\").parent(\"td\").removeClass('danger');\n          } else {\n            $(\"#protocols\").parent(\"td\").addClass('danger');\n            checkPass = false;\n            return false;\n          }\n\n          if (version != '请选择...' && version != '') {\n            row.data()[\"protocolVersion\"] = version;\n            $(\"#version\").parent(\"td\").removeClass('danger');\n          } else {\n            $(\"#version\").parent(\"td\").addClass('danger');\n            return false;\n          }\n\n          $.each(tr.children(), function (j, val1) {\n            var jqob1 = $(val1); //把input变为字符串\n\n            if (!jqob1.has('button').length && jqob1.has('input').length) {\n              var txt = $.trim(jqob1.children(\"input\").val());\n\n              if (txt) {\n                //if (j == 2) {\n                //\n                //    var reg = /^[\\u4e00-\\u9fa5a-zA-Z][u4e00-\\u9fa5a-za-zA-Z0-9_]{1,30}$/;\n                //    if (!reg.test(txt)) {\n                //        $(val1).addClass('danger');\n                //        checkPass = false\n                //        return false;\n                //    }\n                //}\n                //if (j == 3) {\n                //\n                //    var reg = /^[a-za-zA-Z0-9_]{1,30}$/;\n                //    if (!reg.test(txt)) {\n                //        $(val1).addClass('danger');\n                //        checkPass = false\n                //        return false;\n                //    }\n                //}\n                $(val1).removeClass('danger');\n                table.cell(jqob1).data(txt); //修改DataTables对象的数据\n              } else {\n                if (j == 2 || j == 3) {\n                  table.cell(jqob1).data(txt);\n                  $(val1).addClass('danger');\n                  checkPass = false;\n                  return false;\n                }\n              }\n            }\n          });\n\n          if (checkPass) {\n            $scope.doAction('save', row.data());\n          }\n        });\n        domMain.on(\"click\", '#protocols', function (e) {\n          var tr = $(this).closest('tr');\n          var name = $(\"#protocols  option:selected\").val();\n          var count = $(\"#version option\").length;\n          var versions = $scope.protocolVersions;\n\n          if (name != '') {\n            $(\"#version\").html(\"\");\n\n            for (var i in versions) {\n              if (versions[i].protocol == name) {\n                $(\"#version\").append('<option  value=\"' + versions[i].protocolVersion + '\" selected = \"selected\" >' + versions[i].protocolVersion + '</option>');\n              }\n            }\n          } else {\n            $(\"#version\").html(\"\");\n            $(\"#version\").append('<option  value=\"\" selected = \"selected\" >请选择...</option>');\n          }\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.stopPropagation();\n          $scope.doAction('cancel');\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n          var isEditing = false;\n          var tds = $(this).parents(\"tbody\").children();\n\n          if (!isEditing) {\n            isEditing = true;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            var row1 = row.data();\n            row.data().isEdit = 2;\n            row.cells().invalidate();\n          }\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tds = $(this).parents(\"tbody\").children();\n          $.each(tds, function (i, val) {\n            var tr1 = $(val).closest('tr');\n            var row1 = table.row(tr1);\n\n            if (row1.data() == undefined) {\n              tds.eq(i).remove();\n            }\n\n            if (row1.data() != undefined) {\n              var ipts = tds.eq(i).find('input');\n              $.each(ipts, function (j, valInp) {\n                var txt = $(valInp).val();\n                $(valInp).replaceWith(txt);\n              });\n            }\n          });\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.doAction('delete', row.data());\n        });\n      }]\n    };\n  });\n  directives.directive('recordTable', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        $scope.$on(Event.USERINFOSINIT + \"_record\", function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: directives.datatable.language,\n            data: args.data,\n            columns: args.columns,\n            \"aaSorting\": [[5, \"asc\"]],\n            columnDefs: args.columnDefs\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a  href=\"#/renew\" class=\"btn btn-default btn-sm\"><i  style=\"float: left;margin-top: 4px;margin-right: 3px;\" class=\"proudsmart ps-renewal\"></i><span class=\"hidden-xs\"> 缴费</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', \"#price-btn\", function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          location.href = '#/renew/' + rowData.orderNo + '';\n        });\n      }]\n    };\n  });\n  directives.directive('messageTable', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        $scope.$on(Event.USERCENTERINIT + '_msg', function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-12\"<\"special-btn\">><\"col-sm-12\">><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: directives.datatable.language,\n            data: args.data,\n            columns: args.columns,\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            },\n            columnDefs: args.columnDefs\n          });\n        });\n        domMain.on('click', \"th:eq(0)\", function (e) {\n          var msgStatus = $(\"input[name='allClick']\").is(':checked');\n          $(\"input[name='msgClick']\").prop(\"checked\", msgStatus);\n        });\n        domMain.on('click', \"#msgClick\", function (e) {\n          //var ck=$(this).is(':checked')\n          var ck2 = $(\"input[name='allClick']\").is(':checked');\n          var o = document.getElementsByName(\"msgClick\");\n          var count = 0;\n          var num = 0;\n\n          for (var i = 0; i < o.length; i++) {\n            if (o[i].checked == true) {\n              count++;\n            }\n\n            if (o[i].checked == false) {\n              num++;\n            }\n          }\n\n          if (count == o.length) {\n            //o[0].checked=true;\n            $(\"input[name='allClick']\").prop(\"checked\", true);\n          }\n\n          if (num > 0) {\n            if (ck2 == true) {\n              //o[0].checked=false;\n              $(\"input[name='allClick']\").attr(\"checked\", false);\n            }\n          }\n        });\n        domMain.on('click', \"td:nth-child(2)\", function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n\n          if ($scope.readMsgStatus != \"/read\") {\n            $scope.statusUpdate(rowData);\n          } //orderdetail/2016062914233500001/manage/doing\n\n        });\n        domMain.on('click', \"td:nth-child(1)\", function (e) {\n          if ($scope.readMsgStatus == \"/read\") {\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            var rowData = row.data();\n            $scope.statusUpdate(rowData);\n          } //orderdetail/2016062914233500001/manage/doing\n\n        });\n      }]\n    };\n  });\n});"],"sourceRoot":"/source/"}