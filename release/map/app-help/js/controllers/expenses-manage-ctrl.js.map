{"version":3,"sources":["app-help/js/controllers/expenses-manage-ctrl.js"],"names":["define","controllers","BootstrapDialog","controller","$scope","$sce","chargeUIService","kpiDataService","userLoginUIService","resourceUIService","psMessageService","growl","orderUser","node","rootCi","device","gather","pass","client","kpiValues","kpiList","category","isRealTimeData","timePeriod","nodeIds","kpiCodes","startTime","endTime","timeRange","statisticType","condList","getValueList","returnObj","code","i","data","kpiCode","value","getCurrentUserProduct","res","undefined","getRootDomain","returnObj1","id","userEnterpriseService","recordGridData","columns","title","orderable","columnDefs","targets","render","type","row","str","resourceType","durationUnit","num","del","o","parseFloat","toFixed","substring","replace","test","match","e","alert","RetainedDecimalPlaces","newDateJson","Format","GetDateCategoryStrByLabel","state","getCurrentUserOrder","$broadcast","Event","USERINFOSINIT","$routeParams","product","unit","codeMoney","CouponList","orderNo","orderList","duration","resourceCount","totalAmount","balanceAmount","price","netAmount","getAllPrice","payUser","getOrderByOrderNo","$watch","newValue","oldValue","scope","item","couponType","amount","orderPrice","discount","emptyRecord","typeClick","promoCode","getCouponByPromoCode","netPrice","warning","dict","timeOpen","banPrice","subAjax","pay","saveOrder","success","location","href","TrustAsHtml","post","trustAsHtml","length"],"mappings":"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","file":"app-help/js/controllers/expenses-manage-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict'; //预览\n\n  controllers.controller('expensesPreviewCtrl', ['$scope', \"$sce\", 'chargeUIService', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'psMessageService', 'growl', function ($scope, $sce, chargeUIService, kpiDataService, userLoginUIService, resourceUIService, psMessageService, growl) {\n    $scope.orderUser = '';\n    var node = $scope.rootCi;\n    $scope.device = '0';\n    $scope.gather = '0';\n    $scope.pass = '0';\n    $scope.client = '0';\n\n    var kpiValues = function kpiValues() {\n      var kpiList = [\"kpi\", {\n        \"category\": \"ci\",\n        \"isRealTimeData\": true,\n        \"timePeriod\": 0,\n        \"nodeIds\": [node],\n        \"kpiCodes\": [3001, 3002, 3022],\n        \"startTime\": null,\n        \"endTime\": null,\n        \"timeRange\": \"\",\n        \"statisticType\": \"psiot\",\n        \"condList\": []\n      }];\n      kpiDataService.getValueList(kpiList, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            if (returnObj.data[i].kpiCode == 3001) {\n              $scope.device = returnObj.data[i].value;\n            } else if (returnObj.data[i].kpiCode == 3002) {\n              $scope.gather = returnObj.data[i].value;\n            } else if (returnObj.data[i].kpiCode == 3022) {\n              $scope.client = returnObj.data[i].value;\n            }\n          }\n        }\n      });\n    };\n\n    chargeUIService.getCurrentUserProduct(function (res) {\n      if (res.code == 0) {\n        $scope.orderUser = res.data;\n      }\n    });\n\n    if (node == undefined) {\n      resourceUIService.getRootDomain(function (returnObj1) {\n        if (returnObj1.code == 0) {\n          node = returnObj1.data.id;\n          kpiValues();\n        }\n      });\n    } else {\n      kpiValues();\n    }\n  }]); //缴费记录\n\n  controllers.controller('expensesRecordCtrl', ['$scope', 'chargeUIService', 'userLoginUIService', 'userEnterpriseService', 'growl', 'resourceUIService', function ($scope, chargeUIService, userLoginUIService, userEnterpriseService, growl, resourceUIService) {\n    var RetainedDecimalPlaces = function RetainedDecimalPlaces(num, del, o) {\n      try {\n        num += \"\";\n        num = parseFloat(num).toFixed(del); //保留小数并四舍五入\n\n        var str = \"\";\n\n        if (!o) {\n          if (num.substring(0, 1) == \"-\") str = \"-\";\n        } //清除字符串中的非数字 非.字符\n\n\n        num = num.replace(/[^0-9|\\.]/g, \"\"); //清除字符串开头的0\n\n        if (/^0+/) num = num.replace(/^0+/, \"\"); //为整数字符串在末尾添加.0000\n\n        if (!/\\./.test(num)) num += \".0000\"; //字符以.开头时，在开头添加0\n\n        if (/^\\./.test(num)) num = \"0\" + num;\n        num += \"0000\"; //在字符串末尾补零\n\n        if (del == 2) num = num.match(/\\d+\\.\\d{2}/)[0];\n        if (del == 4) num = num.match(/\\d+\\.\\d{4}/)[0]; //千位符\n\n        while (/\\d{4}(\\.|,)/.test(num)) {\n          //符合条件则进行替换\n          num = num.replace(/(\\d)(\\d{3}(\\.|,))/, \"$1,$2\");\n        } //每隔3位添加一个\n\n\n        return str + num;\n      } catch (e) {\n        alert(e);\n      }\n    }; //用户管理\n\n\n    $scope.recordGridData = {\n      columns: [{\n        title: \"资费方式\",\n        data: \"resourceType\"\n      }, {\n        title: \"付费模式\",\n        data: \"durationUnit\"\n      }, {\n        title: \"数量\",\n        data: \"resourceCount\"\n      }, {\n        title: \"开通时长\",\n        data: \"duration\"\n      }, {\n        title: \"价格\",\n        data: \"netAmount\"\n      }, {\n        title: \"状态\",\n        data: \"state\"\n      }, {\n        title: \"订单提交时间\",\n        data: \"createDate\"\n      }, {\n        title: \"操作\",\n        orderable: false,\n        data: \"option\"\n      }],\n      columnDefs: [{\n        targets: 0,\n        render: function render(data, type, row) {\n          var str = \"\";\n\n          if (data == 1) {\n            str = '接入设备数量';\n          } else if (data == 2) {\n            str = '采集监控点数量';\n          } else if (data == 3) {\n            str = '交互消息数量';\n          }\n\n          return str;\n        }\n      }, {\n        targets: 1,\n        render: function render(data, type, row) {\n          var str = '';\n\n          if (data == 1) {\n            str = '月';\n          } else if (data == 2) {\n            str = '年';\n          }\n\n          return str;\n        }\n      }, {\n        targets: 2,\n        render: function render(data, type, row) {\n          var str = '';\n\n          if (row.resourceType == 1 || row.resourceType == 2) {\n            str = data + '个';\n          } else if (row.resourceType == 3) {\n            str = data + '条';\n          }\n\n          return str;\n        }\n      }, {\n        targets: 3,\n        render: function render(data, type, row) {\n          var str = '';\n\n          if (row.durationUnit == 1) {\n            str = '月';\n          } else if (row.durationUnit == 2) {\n            str = '年';\n          }\n\n          return '' + data + '' + str + '';\n        }\n      }, {\n        targets: 4,\n        render: function render(data, type, row) {\n          var str = '0元';\n\n          if (data != '' && data != null) {\n            str = '' + RetainedDecimalPlaces(data, 2, true) + '元';\n          }\n\n          return str;\n        }\n      }, {\n        targets: 5,\n        render: function render(data, type, row) {\n          return \"<span class='label \" + (data == 1 ? \"label-warning\" : \"label-info\") + \"'>\" + (data == 2 ? \"已支付\" : \"未支付\") + \"</span>\";\n          ;\n        }\n      }, {\n        targets: 6,\n        render: function render(data, type, row) {\n          var str = '';\n\n          if (data != '' && data != null) {\n            str = newDateJson(data).Format(GetDateCategoryStrByLabel());\n          }\n\n          return str;\n        }\n      }, {\n        targets: 7,\n        render: function render(data, type, row) {\n          var str = '';\n\n          if (row.state == 1) {\n            //str = \"待支付\";\n            str += \"<a id='price-btn' class='btn btn-default btn-sm'><i class='proudsmart ps-pay  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 支付</span></a>\";\n          } else if (row.state == 2) {\n            str = \"已购买\";\n          }\n\n          return str;\n        }\n      }]\n    };\n    chargeUIService.getCurrentUserOrder(function (res) {\n      if (res.code == 0) {\n        $scope.recordGridData.data = res.data;\n        $scope.$broadcast(Event.USERINFOSINIT + \"_record\", $scope.recordGridData);\n      }\n    });\n  }]); //续费\n\n  controllers.controller('expensesRenewCtrl', ['$scope', \"$sce\", '$routeParams', 'chargeUIService', 'userLoginUIService', 'resourceUIService', 'psMessageService', 'growl', function ($scope, $sce, $routeParams, chargeUIService, userLoginUIService, resourceUIService, psMessageService, growl) {\n    //初始化数量+价格下拉列表\n    $scope.product = ''; //初始化付费模式\n\n    $scope.unit = '月'; //优惠券对应model\n\n    $scope.code = ''; //优惠之后的价格\n\n    $scope.codeMoney = ''; //根据id进来的时候保存整个集合，购买的时候使用了优惠券保存优惠券结合\n\n    $scope.CouponList = ''; //标记通过哪种方式进来\n\n    $scope.orderUser = ''; //获取进来的订单号\n\n    $scope.orderNo = $routeParams.orderNo; //初始化购买集合\n\n    $scope.orderList = {\n      'duration': '',\n      'durationUnit': '1',\n      'resourceType': '1',\n      'resourceCount': '0',\n      'totalAmount': '',\n      'balanceAmount': '',\n      'price': '',\n      'netAmount': ''\n    };\n    /*四舍五入并且截取\n     * num  值\n     * del  保留小数\n     */\n\n    var RetainedDecimalPlaces = function RetainedDecimalPlaces(num, del, o) {\n      try {\n        num += \"\";\n        num = parseFloat(num).toFixed(del); //保留小数并四舍五入\n\n        var str = \"\";\n\n        if (!o) {\n          if (num.substring(0, 1) == \"-\") str = \"-\";\n        } //清除字符串中的非数字 非.字符\n\n\n        num = num.replace(/[^0-9|\\.]/g, \"\"); //清除字符串开头的0\n\n        if (/^0+/) num = num.replace(/^0+/, \"\"); //为整数字符串在末尾添加.0000\n\n        if (!/\\./.test(num)) num += \".0000\"; //字符以.开头时，在开头添加0\n\n        if (/^\\./.test(num)) num = \"0\" + num;\n        num += \"0000\"; //在字符串末尾补零\n\n        if (del == 2) num = num.match(/\\d+\\.\\d{2}/)[0];\n        if (del == 4) num = num.match(/\\d+\\.\\d{4}/)[0]; //千位符\n\n        while (/\\d{4}(\\.|,)/.test(num)) {\n          //符合条件则进行替换\n          num = num.replace(/(\\d)(\\d{3}(\\.|,))/, \"$1,$2\");\n        } //每隔3位添加一个\n\n\n        return str + num;\n      } catch (e) {\n        alert(e);\n      }\n    }; //获取所有价格定义\n\n\n    chargeUIService.getAllPrice(function (res) {\n      if (res.code == 0) {\n        $scope.product = res.data;\n\n        if ($scope.orderNo != null) {\n          payUser();\n        }\n      }\n    }); //根据订单id查订单详情\n\n    var payUser = function payUser() {\n      chargeUIService.getOrderByOrderNo($scope.orderNo, function (res) {\n        if (res.code == 0) {\n          $scope.CouponList = res.data;\n          $scope.orderList.resourceType = res.data.resourceType;\n          $scope.orderList.durationUnit = res.data.durationUnit;\n          $scope.orderList.duration = res.data.duration;\n          $scope.orderList.resourceCount = res.data.resourceCount;\n          $scope.orderList.totalAmount = RetainedDecimalPlaces(res.data.price, 2, true);\n          $scope.orderList.netAmount = RetainedDecimalPlaces(res.data.netAmount, 2, true);\n          $scope.orderUser = \"order\";\n        }\n      });\n    }; //监听数量下拉框的变化并且实时更新数据\n\n\n    $scope.$watch('orderList.resourceCount', function (newValue, oldValue, scope) {\n      if ($scope.orderUser != 'order') {\n        if (newValue != undefined && newValue != null) {\n          var item = \"\";\n\n          for (var i in $scope.product) {\n            if ($scope.product[i].resourceCount == newValue && $scope.product[i].resourceType == $scope.orderList.resourceType && $scope.product[i].durationUnit == $scope.orderList.durationUnit) {\n              item = $scope.product[i];\n              break;\n            }\n          }\n\n          if (item != \"\") {\n            //默认一个月\n            $scope.orderList.duration = \"1\";\n            $scope.orderList.totalAmount = RetainedDecimalPlaces(item.price, 2, true);\n\n            if ($scope.codeMoney != \"\") {\n              if ($scope.CouponList.couponType == 1) {\n                var price = item.price * $scope.orderList.duration;\n\n                if (price > $scope.CouponList.amount) {\n                  var orderPrice = price - $scope.CouponList.amount;\n                  $scope.orderList.netAmount = RetainedDecimalPlaces(orderPrice, 2, true);\n                } else {\n                  $scope.orderList.netAmount = '0.00';\n                }\n              } else if ($scope.CouponList.couponType == 2) {\n                var orderPrice = item.price * $scope.orderList.duration * $scope.CouponList.discount;\n                $scope.orderList.netAmount = RetainedDecimalPlaces(orderPrice, 2, true);\n              }\n            } else {\n              $scope.orderList.netAmount = RetainedDecimalPlaces(item.price, 2, true);\n            }\n          }\n        } else {\n          emptyRecord();\n        }\n      }\n    }); //资费方式变更的时候查询初始化\n\n    $scope.typeClick = function () {\n      emptyRecord();\n    };\n\n    var emptyRecord = function emptyRecord() {\n      $scope.orderList.duration = '';\n      $scope.orderList.resourceCount = '';\n      $scope.orderList.totalAmount = '';\n      $scope.orderList.price = '';\n      $scope.orderList.netAmount = '';\n      $scope.codeMoney = '';\n      $scope.code = '';\n    }; //优惠券兑换\n\n\n    $scope.promoCode = function () {\n      if ($scope.orderList.totalAmount != '') {\n        if ($scope.code != '') {\n          chargeUIService.getCouponByPromoCode($scope.code, function (res) {\n            if (res.code == 0 && res.data != null) {\n              if (res.data.couponType == 1) {\n                $scope.codeMoney = '-' + RetainedDecimalPlaces(res.data.amount, 2, true) + '元';\n                var price = $scope.orderList.totalAmount.replace(\",\", \"\") * $scope.orderList.duration;\n\n                if (price > res.data.amount) {\n                  var netPrice = price - res.data.amount;\n                  $scope.orderList.netAmount = RetainedDecimalPlaces(netPrice, 2, true);\n                } else {\n                  $scope.orderList.netAmount = '0.00';\n                }\n              } else if (res.data.couponType == 2) {\n                $scope.codeMoney = res.data.discount + '折';\n                var netPrice = $scope.orderList.totalAmount.replace(\",\", \"\") * $scope.orderList.duration * res.data.discount;\n                $scope.orderList.netAmount = RetainedDecimalPlaces(netPrice, 2, true);\n              }\n\n              $scope.CouponList = res.data;\n            } else {\n              $scope.codeMoney = '';\n            }\n          });\n        } else {\n          growl.warning(\"请输入优惠券\", {});\n        }\n      } else {\n        growl.warning(\"请先选择套餐\", {});\n      }\n    };\n\n    $scope.dict = \"个\"; //资费方式单位变更\n\n    $scope.$watch('orderList.resourceType', function (newValue, oldValue, scope) {\n      if (newValue == 1) {\n        $scope.dict = '个';\n      } else if (newValue == 2) {\n        $scope.dict = '个';\n      } else if (newValue == 3) {\n        $scope.dict = '条';\n      }\n    }); //付费方式变更以及数据更新\n\n    $scope.$watch('orderList.durationUnit', function (newValue, oldValue, scope) {\n      if ($scope.orderUser != 'order') {\n        $scope.orderList.netAmount = '';\n        $scope.orderList.resourceCount = \"0\";\n        $scope.orderList.totalAmount = \"\";\n        $scope.orderList.duration = \"\";\n      }\n\n      if (newValue == 1) {\n        $scope.unit = \"月\";\n      } else if (newValue == 2) {\n        $scope.unit = \"年\";\n      }\n    }); //开通时长输入校验以及数据更新\n\n    $scope.timeOpen = function () {\n      if (!/^[0-9]*[1-9][0-9]*$/.test($scope.orderList.duration)) {\n        $scope.orderList.duration = '';\n      } else {\n        //时长*单价\n        var banPrice = $scope.orderList.duration * $scope.orderList.totalAmount.replace(\",\", \"\");\n\n        if ($scope.codeMoney != \"\") {\n          if ($scope.CouponList.couponType == 1) {\n            if (banPrice > $scope.CouponList.amount) {\n              $scope.orderList.netAmount = RetainedDecimalPlaces(banPrice - $scope.CouponList.amount, 2, true);\n            } else {\n              $scope.orderList.netAmount = '0.00';\n            }\n          } else if ($scope.CouponList.couponType == 2) {\n            $scope.orderList.netAmount = RetainedDecimalPlaces(banPrice * $scope.CouponList.discount, 2, true);\n          }\n        } else {\n          $scope.orderList.netAmount = RetainedDecimalPlaces(banPrice, 2, true);\n        }\n      }\n    };\n\n    $scope.subAjax = ''; //付费提交数据\n\n    var pay = function pay(orderList) {\n      chargeUIService.saveOrder($scope.orderList, function (res) {\n        if (res.code == 0) {\n          if (res.data == \"true\") {\n            growl.success(\"续费成功\", {});\n            location.href = '#/expenses';\n          } else if (res.data == \"false\") {\n            growl.success(\"续费失败\", {});\n            location.href = '#/record';\n          } else {\n            $scope.subAjax = res.data;\n          }\n        }\n      });\n    };\n\n    $scope.TrustAsHtml = function (post) {\n      return $sce.trustAsHtml(post);\n    }; //支付之前校验\n\n\n    $scope.saveOrder = function () {\n      if ($scope.orderList.resourceCount == \"\" || $scope.orderList.resourceCount == null) {\n        growl.warning(\"请选择数量\");\n        return;\n      }\n\n      if ($scope.orderList.duration <= 0 || $scope.orderList.duration == \"\") {\n        growl.warning(\"开通时长大于0且不能为空\");\n        return;\n      }\n\n      if ($scope.orderNo != null) {\n        $scope.orderList = $scope.CouponList;\n        pay($scope.orderList);\n      } else {\n        if ($scope.codeMoney != \"\") {\n          $scope.orderList['couponList'] = [$scope.CouponList];\n        }\n\n        if ($scope.orderList.netAmount.length > 6) {\n          $scope.orderList.netAmount = $scope.orderList.netAmount.replace(\",\", \"\");\n        }\n\n        if ($scope.orderList.netAmount <= 200000) {\n          if ($scope.orderList.totalAmount.length > 6) {\n            $scope.orderList.price = $scope.orderList.totalAmount.replace(\",\", \"\");\n          } else {\n            $scope.orderList.price = $scope.orderList.totalAmount;\n          }\n\n          var amount = $scope.orderList.price * $scope.orderList.duration;\n          $scope.orderList.totalAmount = amount;\n          pay($scope.orderList);\n        } else {\n          growl.warning(\"单笔支付不能超过20万\", {});\n        }\n      }\n    };\n  }]);\n});"],"sourceRoot":"/source/"}