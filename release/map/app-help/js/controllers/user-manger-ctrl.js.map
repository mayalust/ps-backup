{"version":3,"sources":["app-help/js/controllers/user-manger-ctrl.js"],"names":["define","controllers","controller","$scope","$location","Info","configUIService","userLoginUIService","viewFlexService","growl","dialogInstance","treeviewIndex","oldTreeviewIndex","currentMenuCode","firstMenuCode","localMenuCode","showMenu","menuitems","$on","rootHandler","get","info","messages","alertView","designView","gotoHomePage","user","enterprise","logoStatus","location","href","gotoAppPage","showMenuFun","logout","onViewLoad","initUserObjects","callbackFun","initMenus","getConfigsByGroupName","returnObj","code","data","length","forEach","item","baseConfig","jQuery","extend","JSON","parse","value","title","$","html","shortcut","attr","Date","getTime","e","evt","d","isAuthenticated","close","userInfo","lastLoginTime","newDateJson","Format","GetDateCategoryStrByLabel"],"mappings":"AAAAA,OAAO,CAAC,2BAA4B,SAAUC,GAC5C,aAEAA,EAAYC,WAAW,iBAAkB,CAAC,SAAU,YAAa,OAAQ,kBAAmB,qBAAsB,kBAAmB,QAAS,SAAUC,EAAQC,EAAWC,EAAMC,EAAiBC,EAAoBC,EAAiBC,GACrO,IAAIC,EACJP,EAAOQ,cAAgB,YAEvBR,EAAOQ,cAAgB,GACvBR,EAAOS,iBAAmB,GAC1BT,EAAOU,gBAAkB,KAEzBV,EAAOW,cAAgB,KAEvBX,EAAOY,cAAgB,MAEvBZ,EAAOa,UAAW,EAClBb,EAAOc,UAAY,GACnBd,EAAOe,IAAI,sBAAuB,WAChCX,EAAmBY,YAAYhB,EAAQC,KAqC9BC,EAAKe,IAAI,oBAAqB,SAAUC,GACjDlB,EAAOmB,SAAWD,EAAKC,SAIvBnB,EAAOoB,UAAY,GACnBpB,EAAOqB,WAAa,KAGtBrB,EAAOsB,aAAe,WACiC,KAAjDlB,EAAmBmB,KAAKC,WAAWC,aACrCC,SAASC,KAAO,8BAIpB3B,EAAO4B,YAAc,WACnBF,SAASC,KAAO,eAGlB3B,EAAOa,UAAW,EAElBb,EAAO6B,YAAc,WACnB7B,EAAOa,UAAYb,EAAOa,UAG5Bb,EAAO8B,OAAS,WACd1B,EAAmB0B,UAmBrB9B,EAAO+B,WAAa,aA+BpB,SAASC,IA7Be,IAA2BC,EAAAA,EAmC/B,WAChB7B,EAAmB8B,UAAUlC,EAAQC,IAnCvCE,EAAgBgC,sBAAsB,mBAAoB,SAAUC,GAC5C,GAAlBA,EAAUC,OACRD,EAAUE,MAAgC,EAAxBF,EAAUE,KAAKC,OACnCH,EAAUE,KAAKE,QAAQ,SAAUC,GAC/B,IACMzC,EAAO0C,WACT1C,EAAO0C,WAAaC,OAAOC,QAAO,EAAM5C,EAAO0C,WAAYG,KAAKC,MAAML,EAAKM,QAE3E/C,EAAO0C,WAAaG,KAAKC,MAAML,EAAKM,OAGlC/C,EAAO0C,aAEL1C,EAAO0C,WAAWM,MAAOC,EAAE,SAASC,KAAKlD,EAAO0C,WAAWM,OAAYC,EAAE,SAASC,KAAK,IACvFlD,EAAO0C,WAAWS,SAAUF,EAAE,6BAA6BG,KAAK,OAAQ,MAAQpD,EAAO0C,WAAWS,SAAW,KAAM,IAAIE,MAAOC,WAAgBL,EAAE,6BAA6BG,KAAK,OAAQ,yCAA+C,IAAIC,MAAOC,YAE1P,MAAOC,QAGXN,EAAE,SAASC,KAAK,IAChBD,EAAE,6BAA6BG,KAAK,OAAQ,yCAA+C,IAAIC,MAAOC,YAGxGrB,OAiBNjC,EAAOe,IAAI,qBAAsB,SAAUyC,EAAKC,GAC1CrD,EAAmBmB,KAAKmC,iBACtBnD,GACFA,EAAeoD,QAGjB3D,EAAO4D,SAAWxD,EAAmBmB,KACrCvB,EAAO6D,cAAgBC,YAAY1D,EAAmBmB,KAAKsC,eAAeE,OAAOC,6BACjFhC,MAEAhC,EAAO4D,SAAW,GAClB5D,EAAO6D,cAAgB","file":"app-help/js/controllers/user-manger-ctrl.js","sourcesContent":["define(['controllers/controllers'], function (controllers) {\n  'use strict';\n\n  controllers.controller('userMangerCtrl', ['$scope', '$location', 'Info', 'configUIService', 'userLoginUIService', 'viewFlexService', 'growl', function ($scope, $location, Info, configUIService, userLoginUIService, viewFlexService, growl) {\n    var dialogInstance;\n    $scope.treeviewIndex = '/personal'; //    $scope.powers = {};\n\n    $scope.treeviewIndex = \"\";\n    $scope.oldTreeviewIndex = \"\";\n    $scope.currentMenuCode = null; //当前的菜单编码\n\n    $scope.firstMenuCode = null; //第一层的菜单编码\n\n    $scope.localMenuCode = \"F01\"; //判断使用哪一个服务中心，用来替代localIndex\n\n    $scope.showMenu = false;\n    $scope.menuitems = {};\n    $scope.$on('$routeChangeSuccess', function () {\n      userLoginUIService.rootHandler($scope, $location);\n    });\n\n    var showLogin = function showLogin() {\n      // location.href = \"login.html\";\n      return;\n      dialogInstance = BootstrapDialog.show({\n        title: '欢迎来到普奥的世界',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: function message(dialog) {\n          var $message = $('<div></div>');\n          var pageToLoad = dialog.getData('pageToLoad');\n          $message.load(pageToLoad);\n          return $message;\n        },\n        data: {\n          'pageToLoad': 'login.html'\n        },\n        buttons: [{\n          label: '登录',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            var userInput = document.getElementById('username');\n            var psdInput = document.getElementById('password');\n            userLoginUIService.login(userInput.value, psdInput.value);\n          }\n        }, {\n          label: '退出',\n          action: function action(dialogRef) {\n            dialogRef.close();\n            location.href = \"index.html\";\n          }\n        }]\n      });\n    };\n\n    var info = Info.get(\"localdb/info.json\", function (info) {\n      $scope.messages = info.messages; //      $scope.tasks = info.tasks;\n      //      $scope.alerts = info.alerts;\n      //      $scope.menuitems = info.menuitems;\n\n      $scope.alertView = [];\n      $scope.designView = [];\n    });\n\n    $scope.gotoHomePage = function () {\n      if (userLoginUIService.user.enterprise.logoStatus != '0') {\n        location.href = \"http://www.proudsmart.com\";\n      }\n    };\n\n    $scope.gotoAppPage = function () {\n      location.href = \"#dashboard2\";\n    };\n\n    $scope.showMenu = false;\n\n    $scope.showMenuFun = function () {\n      $scope.showMenu = !$scope.showMenu;\n    };\n\n    $scope.logout = function () {\n      userLoginUIService.logout();\n    }; //    var setPower = function(pow, len) {\n    //      pow = pow.substring(0, len);\n    //      $scope.powers[pow] = true;\n    //      if(len > 5) {\n    //        setPower(pow, len - 2);\n    //      }\n    //    }\n    //    var initPower = function() {\n    //      for(var i in userLoginUIService.user.functionCodeSet) {\n    //        var funCode = userLoginUIService.user.functionCodeSet[i];\n    //        $scope.powers[funCode] = true;\n    //        if(funCode.length > 5) {\n    //          setPower(funCode, funCode.length - 2);\n    //        }\n    //      }\n    //    }\n\n\n    $scope.onViewLoad = function () {};\n\n    var initConfigManager = function initConfigManager(callbackFun) {\n      configUIService.getConfigsByGroupName(\"EnterpriseConfig\", function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data && returnObj.data.length > 0) {\n            returnObj.data.forEach(function (item) {\n              try {\n                if ($scope.baseConfig) {\n                  $scope.baseConfig = jQuery.extend(true, $scope.baseConfig, JSON.parse(item.value));\n                } else {\n                  $scope.baseConfig = JSON.parse(item.value);\n                }\n\n                if ($scope.baseConfig) {\n                  //拥有企业设置\n                  if ($scope.baseConfig.title) $(\"title\").html($scope.baseConfig.title);else $(\"title\").html(\"\");\n                  if ($scope.baseConfig.shortcut) $(\"link[rel='shortcut icon']\").attr(\"href\", \"../\" + $scope.baseConfig.shortcut + \"?\" + new Date().getTime());else $(\"link[rel='shortcut icon']\").attr(\"href\", \"../../login/images/shortcut_null.png\" + \"?\" + new Date().getTime());\n                }\n              } catch (e) {}\n            });\n          } else {\n            $(\"title\").html(\"\");\n            $(\"link[rel='shortcut icon']\").attr(\"href\", \"../../login/images/shortcut_null.png\" + \"?\" + new Date().getTime());\n          }\n\n          callbackFun();\n        }\n      });\n    };\n\n    function initUserObjects() {\n      // initUnit();\n      // initViews();\n      // initRootDomain();\n      // initCount();\n      //      initPower();\n      initConfigManager(function () {\n        userLoginUIService.initMenus($scope, $location);\n      });\n    }\n\n    ;\n    $scope.$on('loginStatusChanged', function (evt, d) {\n      if (userLoginUIService.user.isAuthenticated) {\n        if (dialogInstance) {\n          dialogInstance.close();\n        }\n\n        $scope.userInfo = userLoginUIService.user;\n        $scope.lastLoginTime = newDateJson(userLoginUIService.user.lastLoginTime).Format(GetDateCategoryStrByLabel());\n        initUserObjects();\n      } else {\n        $scope.userInfo = {};\n        $scope.lastLoginTime = \"\";\n        showLogin();\n      }\n    });\n\n    function initViews() {\n      $scope.alertView = [];\n      $scope.designView = [];\n      viewFlexService.getAllMyViews(function (returnObj) {\n        if (returnObj.code == 0) {\n          var v = returnObj.data;\n          var viewList = [];\n\n          for (var i = 0; i < v.length; i++) {\n            var view = v[i];\n\n            if (view) {\n              viewList.push(view);\n              var description = {};\n\n              if (view.description) {\n                description = JSON.parse(view.description);\n              }\n\n              if (view.viewType == \"designView\") {\n                var viewmenus = {\n                  \"title\": view.viewTitle.split(\"?\")[0],\n                  \"url\": \"#/\" + view.viewType + \"/\" + view.viewId,\n                  \"viewId\": view.viewId,\n                  \"view\": view,\n                  \"status\": description['status'],\n                  \"statusBg\": description[\"status\"] == 1 ? 'bg-red' : description[\"status\"] == 2 ? 'bg-green' : '',\n                  \"statusLab\": description[\"status\"] == 1 ? '授权' : description[\"status\"] == 2 ? '购买' : '',\n                  \"icon\": \"fa fa-area-chart\"\n                };\n                $scope.designView.push(viewmenus);\n              } else if (view.viewType == \"configAlert\") {\n                var viewmenus = {\n                  \"title\": view.viewTitle.split(\"?\")[0],\n                  \"url\": \"#/\" + view.viewType + \"/\" + view.viewId,\n                  \"viewId\": view.viewId,\n                  \"view\": view,\n                  \"status\": description[\"status\"],\n                  \"statusBg\": description[\"status\"] == 1 ? 'bg-red' : description[\"status\"] == 2 ? 'bg-green' : '',\n                  \"statusLab\": description[\"status\"] == 1 ? '授权' : description[\"status\"] == 2 ? '购买' : '',\n                  \"icon\": \"fa fa-warning\"\n                };\n                $scope.alertView.push(viewmenus);\n              }\n            }\n          }\n\n          viewFlexService.viewLoadFinished = true;\n          viewFlexService.viewList = viewList;\n          $scope.viewList = viewList;\n          $scope.$broadcast('viewLoadFinished');\n        }\n      });\n    }\n  }]);\n});"],"sourceRoot":"/source/"}