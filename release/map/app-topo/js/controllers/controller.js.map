{"version":3,"sources":["app-topo/js/controllers/controller.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","angular","module","controller","scope","rootScope","lm","loading","undefined","loginList","name","password","sitem","login","item","userLoginUIService","getviews","loc","deleteViews","unregisterDevice","route","userInfo","user","then","event","result","i","data","viewType","innerData","JSON","parse","content","clone","stringify","push","viewList","error","getLocation","viewClick","view","selectView","elements","addNewTopo","path","deleteChart","viewId","gatewayId","deviceId","backTolist","renderImage","unit","background-image","elemCLick","elem","selectedElement","elePos","top","left","popPos","popClose","timeout","kpiDataService","getSimpleDistricts","window","q","resourceUIService","viewFlexService","solutionUIService","serviceCenterService","deferred","promise","localSearch","currentView","solutionId","id","$modelGroup","cur","this","defer","resource","arguments","attributesDes","getAttrsByModelId","code","message","Object","defineProperty","enumerable","attribute","value","province","city","district","arr","split","$Address","all","find","element","label","children","setPosition","resolve","err","reject","step","saveloading","require","Bmap","editResource","model","resources","getBymodelId","getAllGateways","remap","map","gateways","concat","openResourceSelect","receive","modelId","models","resourceSelect","resourcesArray","filter","kpiArray","some","kpi","show","selectResource","resourceClose","onChange","changeProvince","changeCity","changeDistrict","equipment","modelGroup","keyword","search","setSearchCompleteCallback","searchResult","$apply","wr","lat","point","lng","latitude","longitude","$models","getAll","cached","getModels","$DeviceGroupModels","get","getDeviceGroupModels","lib","dropDeviceGroup","ui","offset","draggable","$","attr","kpiId","resourceId","object","create","remove","receivedList","received","kpiSource","title","writable","instance","dropDevice","rArrList","dropDeviceGroupModel","kpiArrays","run","params","current","DeviceMode","mode","onDrop","parseInt","back","backsolution","backService","flag","getAllMyViews","Array","dt","nodeId","bgImgId","saveAndExit","updateAsDevice","runAsDevice","call","saveAsDevice","saveAsDeviceModel","runAsDeviceModel","updateAsDeviceGroup","runAsDeviceGroup","saveAsDeviceGroup","saveAsDeviceGroupModel","runAsDeviceGroupModel","icon","saveServiceViewContent","location","href","temlateView","getServiceViewMap","getResource","getResourceById","device","test","getModelByIds","returnObj","getKpisByModelId","forEach","res","fold","used","userkpi","index","isArray","length","deviceModelId","getServiceViewContent","kpis","deviceGroupModelId","getModelsByGroupId","unfold","bool","j","deviceGroupId","attrsFn","modelGroups","values","nextStep","defers","callback","ele","findRes","param","viewTitle","viewName","addView","originalViewId","updateView","saveDataFn","attrName","val","deviceGroup","saveDeviceGroup","deviceToGroup","saveDeviceToGroups","hasEmpty","msg","btnlist","text","fn","kpiIcon","channelType","sensorIcon","prevStep_Btn","accomplished","open","bgSel_click","createNewGraph","reload","renderBgImg","bgSelect","backgroundImage","$on"],"mappings":"AAAA,SAASA,QAAQC,GAAwT,OAAtOD,QAArD,mBAAXE,QAAoD,iBAApBA,OAAOC,SAAmC,SAAiBF,GAAO,cAAcA,GAA2B,SAAiBA,GAAO,OAAOA,GAAyB,mBAAXC,QAAyBD,EAAIG,cAAgBF,QAAUD,IAAQC,OAAOG,UAAY,gBAAkBJ,IAAyBA,GAExVK,OAAO,CAAC,WAAY,SAAUC,GAC5B,IAAIC,EAASD,EAAQC,OAAO,SAC5BA,EAAOC,WAAW,kBAAmB,CAAC,SAAU,aAAc,kBAAmB,SAAUC,EAAOC,EAAWC,GAC3GD,EAAUE,aAAUC,EACpBJ,EAAMK,UAAY,CAAC,CACjBC,KAAQ,4BACRC,SAAY,UACX,CACDD,KAAQ,YACRC,SAAY,WACX,CACDD,KAAQ,mBACRC,SAAY,YACX,CACDD,KAAQ,sBACRC,SAAY,YACX,CACDD,KAAQ,mBACRC,SAAY,YACX,CACDD,KAAQ,oBACRC,SAAY,aACX,CACDD,KAAQ,cACRC,SAAY,WAEdP,EAAMQ,MAAQR,EAAMK,UAAU,GAE9BL,EAAMS,MAAQ,SAAUC,GACtBR,EAAGO,MAAMC,OAGbZ,EAAOC,WAAW,qBAAsB,CAAC,SAAU,qBAAsB,aAAc,WAAY,YAAa,cAAe,mBAAoB,SAAU,SAAUC,EAAOW,EAAoBV,EAAWW,EAAUC,EAAKC,EAAaC,EAAkBC,GACzPf,EAAUE,SAAU,EACpBH,EAAMiB,SAAWN,EAAmBO,KACpCN,EAASO,KAAK,SAAiBC,GAC7B,IAAIC,EAAS,GAEb,IAAK,IAAIC,KAAKF,EAAMG,KAClB,GAA8B,YAA1BH,EAAMG,KAAKD,GAAGE,SAAwB,CACxC,IAAIC,EAAYC,KAAKC,MAAMP,EAAMG,KAAKD,GAAGM,SACrCC,EAAQH,KAAKC,MAAMD,KAAKI,UAAUV,EAAMG,KAAKD,KACjDO,EAAMD,QAAUH,EAChBJ,EAAOU,KAAKF,GAIhB7B,EAAMgC,SAAWX,GAChB,SAAeY,MAClBjC,EAAMkC,iBAAc9B,EACpBJ,EAAMmC,UAsDN,SAAmBC,GACjBpC,EAAMqC,WAAaD,EAAKR,QAAQU,UAtDlCtC,EAAMuC,WA6DN,WACE1B,EAAI2B,KAAK,cA7DXxC,EAAMyC,YAgEN,SAAqBC,EAAQC,EAAWC,GACtC9B,EAAY,CAAC4B,IAASvB,KAAK,SAAiBC,GAC1CL,EAAiB4B,EAAWC,GAAUzB,KAAK,SAAiBC,GAC1DR,EAASO,KAAK,SAAiBC,GAC7B,IAAIC,EAAS,GAEb,IAAK,IAAIC,KAAKF,EAAMG,KACY,YAA1BH,EAAMG,KAAKD,GAAGE,UAChBH,EAAOU,KAAKX,EAAMG,KAAKD,IAI3BtB,EAAMgC,SAAWX,GAChB,SAAeY,SAEnB,SAAeA,OA9EpBjC,EAAM6C,WAuDN,SAAoBT,GAClBpC,EAAMqC,gBAAajC,GAvDrBJ,EAAM8C,YA4BN,SAAqBC,GACnB,OAAQA,GACN,IAAK,SAML,IAAK,cAML,QACE,MAAO,CACLC,mBAAoB,6CA3C5BhD,EAAMiD,UAuBN,SAAmBC,GACjBlD,EAAMmD,gBAAkBD,GAvB1BlD,EAAMoD,OAQN,SAAgBC,EAAKC,GACnB,MAAO,CACLD,IAAKA,EAAM,KACXC,KAAMA,EAAO,OAVjBtD,EAAMuD,OAcN,SAAgBF,EAAKC,GACnB,MAAO,CACLD,IAAKA,EAAM,IAAM,KACjBC,KAAMA,EAAO,GAAK,OAhBtBtD,EAAMwD,SAEN,WACExD,EAAMmD,qBAAkB/C,MAyE5BN,EAAOC,WAAW,iBAAkB,CAAC,SAAU,qBAAsB,aAAc,WAAY,YAAa,iBAAkB,qBAAsB,UAAW,KAAM,SAAU,oBAAqB,kBAAmB,oBAAqB,uBAAwB,SAAUC,EAAOW,EAAoBV,EAAWwD,EAAS5C,EAAK6C,EAAgBC,EAAoBC,EAAQC,EAAG7C,EAAO8C,EAAmBC,EAAiBC,EAAmBC,GAC7a,IAAIC,EAAUC,EAASC,EAAaC,EAAaC,EAAYC,EAsC7D,SAASC,IACP,IAAIC,EAAMC,KACNR,EAAWL,EAAEc,QACbC,EAAWC,UAAU,GAyEzB,OAvEKJ,EAAIK,eACPhB,EAAkBiB,kBAAkBN,EAAIF,GAAI,SAAUnD,GACpD,IACE,GAAkB,GAAdA,EAAM4D,KA4DR,MAAM5D,EAAM6D,QAnDZ,GARAR,EAAIK,cAAgB1D,EAAMG,KAC1B2D,OAAOC,eAAeV,EAAK,gBAAiB,CAC1CW,YAAY,IAEdF,OAAOC,eAAeV,EAAK,KAAM,CAC/BW,YAAY,IAGVR,EACF,IAAK,IAAItD,KAAKmD,EAAIK,eAChB,SAAWxE,EAAM+E,GAGf,GAFAA,EAAUC,MAAQV,EAAWA,EAAStE,GAAQ,GAElC,mBAARA,EAA2B,CAC7B,IACIiF,EACAC,EACAC,EAHAC,EAAMd,EAAWA,EAAStE,GAAMqF,MAAM,KAAO,GAK7CD,EAAI,KACNH,EAAWvF,EAAM4F,SAASC,IAAIC,KAAK,SAAUC,GAC3C,OAAOA,EAAQC,OAASN,EAAI,MAI5BA,EAAI,MACNF,EAAOD,EAASU,SAASH,KAAK,SAAUC,GACtC,OAAOA,EAAQC,OAASN,EAAI,QAI5BF,EAAOD,EAASU,SAAS,KAIzBP,EAAI,MACND,EAAWD,EAAKS,SAASH,KAAK,SAAUC,GACtC,OAAOA,EAAQC,OAASN,EAAI,QAI5BD,EAAWD,EAAKS,SAAS,KAI7BjG,EAAM4F,SAASM,YAAYX,EAAUC,EAAMC,OAC1B,kBAARnF,GACLsE,GAC2B,iBAAlBA,EAAStE,KAClB+E,EAAUC,MAAQV,EAAWA,EAAStE,GAAMqF,MAAM,KAAK,GAAK,IAvCpE,CA2CGlB,EAAIK,cAAcxD,GAAGhB,KAAMmE,EAAIK,cAAcxD,IAIpD4C,EAASiC,QAAQ1B,GAInB,MAAO2B,GACPlC,EAASmC,OAAOD,MAKflC,EAASC,QAhHlBlE,EAAUE,SAAU,EACpBF,EAAUqG,KAAO,EACjBtG,EAAMuG,aAAc,EACpBvG,EAAMiB,SAAWN,EAAmBO,KACpCgD,EAAWL,EAAEc,QACbR,EAAUD,EAASC,QAEnBqC,QAAQ,CAAC,YAAa,SAAUC,GAC9BA,EAAK,SAAUrF,GACA,SAATA,EACF8C,EAASiC,QAAQ/E,GAEjB8C,EAASmC,OAAOjF,OAKtBpB,EAAM0G,aAAe,SAAUC,GAC7B1C,EAAqB2C,UAAUC,aAAaF,EAAMpC,IAAIpD,KAAK,SAAUI,OAGvEuC,EAAkBgD,eAAe,SAAU1F,GACzC,IAII2F,EAAQ3F,EAAMG,KAAKyF,IAAI,SAAUjB,GACnC,MAAO,CACLxB,GAAIwB,EAAQxB,GACZjE,KAAMyF,EAAQzF,QAGlBN,EAAMiH,SAVM,CAAC,CACX1C,GAAI,GACJjE,KAAM,SAQe4G,OAAOH,GAC9B/G,EAAM2C,UAAY,KAoFpB3C,EAAMmH,mBAAqB,SAAUC,GACnC,IAAIC,EAAUD,EAAQT,MAAMpC,GACxBoC,EAAQ3G,EAAMsH,OAAOxB,KAAK,SAAUC,GACtC,OAAOA,EAAQxB,IAAM8C,IAEvBrH,EAAMuH,eAAiBZ,EAAMa,eAAeC,OAAO,SAAU1B,GAI3D,OAHeA,EAAQ2B,SAASC,KAAK,SAAUC,GAC7C,OAAmB,GAAZA,EAAIC,SAKf7H,EAAM8H,eAAiB,SAAUlD,GAE/B,IAAIgD,GADJR,EAAQxC,SAAWA,GACA8C,SAAS5B,KAAK,SAAUC,GACzC,OAAOqB,EAAQQ,IAAIrD,IAAMwB,EAAQxB,KAGf,UAAhBjF,QAAQsI,IAA2B,MAAPA,IAC9BA,EAAIC,MAAO,UAGN7H,EAAMuH,sBACNvH,EAAM8H,iBAIjB9H,EAAM+H,cAAgB,kBACb/H,EAAM8H,sBACN9H,EAAMuH,gBAGfvH,EAAM4F,SAAW,CACfM,YAAa,SAAqBX,EAAUC,EAAMC,GAChD,IAAIhB,EAAMC,KAENa,IACFd,EAAIc,SAAWA,EAMXd,EAAIgB,SAJJD,GACFf,EAAIe,KAAOA,EAEPC,GAGahB,EAAIe,KAAKS,SAAS,KAGnCxB,EAAIe,KAAOD,EAASU,SAAS,GACdxB,EAAIe,KAAKS,SAAS,KAIjCxB,EAAIuD,UACNvD,EAAIuD,SAASvD,EAAIc,SAAUd,EAAIe,KAAMf,EAAIgB,WAG7CwC,eAAgB,SAAwB1C,GACtC,IAAId,EAAMC,KACVD,EAAIe,KAAOD,EAASU,SAAS,GAC7BxB,EAAIgB,SAAWhB,EAAIe,KAAKS,SAAS,GAE7BxB,EAAIuD,UACNvD,EAAIuD,SAASvD,EAAIc,SAAUd,EAAIe,KAAMf,EAAIgB,WAG7CyC,WAAY,SAAoB1C,GAC9B,IAAIf,EAAMC,KACVD,EAAIgB,SAAWD,EAAKS,SAAS,GAEzBxB,EAAIuD,UACNvD,EAAIuD,SAASvD,EAAIc,SAAUd,EAAIe,KAAMf,EAAIgB,WAG7C0C,eAAgB,SAAwB1C,GACtC,IAAIhB,EAAMC,KAEND,EAAIuD,UACNvD,EAAIuD,SAASvD,EAAIc,SAAUd,EAAIe,KAAMf,EAAIgB,WAG7CuC,SAAU,SAAkBzC,EAAUC,EAAMC,GAC1C,GAAIzF,EAAMoI,UAAUC,WAAWvD,cAAe,CAC5C,IAAIgB,EAAO9F,EAAMoI,UAAUC,WAAWvD,cAAcgB,KAAK,SAAUC,GACjE,MAAuB,mBAAhBA,EAAQzF,OAEPN,EAAMoI,UAAUC,WAAWvD,cAAcgB,KAAK,SAAUC,GAChE,MAAuB,YAAhBA,EAAQzF,OAEPN,EAAMoI,UAAUC,WAAWvD,cAAcgB,KAAK,SAAUC,GAChE,MAAuB,aAAhBA,EAAQzF,OAGjB,GAAIwF,EAAM,CACRA,EAAKR,MAAQC,EAASS,MAAQ,IAAMR,EAAKQ,MAAQ,IAAMP,EAASO,MAChE,IAAIsC,EAAU/C,EAASS,MAAQ,IAAMR,EAAKQ,MAAQ,IAAMP,EAASO,MACjE7B,EAAQhD,KAAK,SAAiBC,GAC5BgD,EAAchD,EACdpB,EAAMkC,YAAc,WACpBkC,EAAYmE,OAAOD,GACnBlE,EAAYoE,0BAA0B,SAAUC,GAC9CzI,EAAM0I,OAEN,WAGE,GAFA1I,EAAMkC,iBAAc9B,EAEhBqI,EAAaE,GAAG,GAAI,CACtB,IAAIC,EAAMH,EAAaE,GAAG,GAAGE,MAAMD,IAC/BE,EAAML,EAAaE,GAAG,GAAGE,MAAMC,IAC/BC,EAAW/I,EAAMoI,UAAUC,WAAWvD,cAAcgB,KAAK,SAAUC,GACrE,MAAuB,YAAhBA,EAAQzF,OAEjByI,EAASzD,MAAQsD,EACjB,IAAII,EAAYhJ,EAAMoI,UAAUC,WAAWvD,cAAcgB,KAAK,SAAUC,GACtE,MAAuB,aAAhBA,EAAQzF,OAEjB0I,EAAU1D,MAAQwD,QAMvB,SAAe7G,GAChBjC,EAAMkC,YAAc,YAM9B,IAAI+G,EAAU,CACZC,OAAQ,WACN,IAAIzE,EAAMC,KACNR,EAAWL,EAAEc,QAejB,OAbIF,EAAI0E,OACNjF,EAASiC,QAAQ1B,EAAI0E,QAErBrF,EAAkBsF,UAAU,SAAUhI,GAClB,KAAdA,EAAM4D,MACRP,EAAI0E,OAAS/H,EAAMG,KACnB2C,EAASiC,QAAQ/E,EAAMG,OAEvB2C,EAASmC,OAAOjF,EAAM6D,WAKrBf,EAASC,UAGhBkF,EAAqB,CACvBC,IAAK,WACH,IAAI7E,EAAMC,KACNR,EAAWL,EAAEc,QAqBjB,OAnBIF,EAAI0E,OACNjF,EAASiC,QAAQgD,QAEjBrF,EAAkByF,qBAAqB,SAAUnI,GAC/C,IACE,GAAkB,GAAdA,EAAM4D,KAMR,MAAM5D,EAAM6D,QALZR,EAAI0E,OAAS/H,EAAMG,KAGnB2C,EAASiC,QAAQ/E,EAAMG,MAIzB,MAAO6E,GACPlC,EAASmC,OAAOD,MAKflC,EAASC,UAIpBqC,QAAQ,CAAC,aAAc,SAAUgD,GAgC/B,SAASC,EAAgBC,EAAIC,GAC3B,IAAIhD,EAAO/B,EAAUgD,EACjBgC,EAAYC,EAAEH,EAAGE,WACjBvC,EAAUuC,EAAUE,KAAK,SACzBC,EAAQH,EAAUE,KAAK,OACvBE,EAAaJ,EAAUE,KAAK,aAOhClC,GAHAhD,GAHA+B,EAAQ3G,EAAMsH,OAAOxB,KAAK,SAAUa,GAClC,OAAOA,EAAMpC,IAAM8C,KAEJG,eAAe1B,KAAK,SAAUlB,GAC7C,OAAOA,EAASL,IAAMyF,KAETtC,SAAS5B,KAAK,SAAU8B,GACrC,OAAOA,EAAIrD,IAAMwF,KAEflC,MAAO,EACX,IAAIoC,EAAS/E,OAAOgF,OAAO,CACzBC,OAAQ,WACN,IAAI1F,EAAMC,KACVD,EAAImD,IAAIC,MAAO,EACf7H,EAAMoK,aAAepK,EAAMoK,aAAa3C,OAAO,SAAU4C,GACvD,OAAOA,GAAY5F,MAGtB,CACD6F,UAAW,CACThF,MAAOsC,EACPxC,YAAY,GAEdmF,MAAO,CACLjF,MAAOsC,EAAI5B,MACXZ,YAAY,EACZoF,UAAU,GAEZC,SAAU,CACRnF,MAAOsC,EAAI5B,MACXZ,YAAY,EACZoF,UAAU,GAEZ5F,SAAU,CACRU,MAAOV,EACPQ,YAAY,EACZoF,UAAU,GAEZ7D,MAAO,CACLrB,MAAOqB,EACPvB,YAAY,GAEdwC,IAAK,CACHtC,MAAOsC,EACPxC,YAAY,GAEd/B,IAAK,CACHiC,MAAOoE,EAAGC,OAAOtG,IAAMsG,EAAOtG,IAC9B+B,YAAY,GAEd9B,KAAM,CACJgC,MAAOoE,EAAGC,OAAOrG,KAAOqG,EAAOrG,KAC/B8B,YAAY,KAIZpF,EAAMoK,aACRpK,EAAMoK,aAAarI,KAAKkI,GAExBjK,EAAMoK,aAAe,CAACH,GAM1B,SAASS,EAAWhB,EAAIC,GACtB,IAAIhD,EAAO/B,EAAUgD,EACjBgC,EAAYC,EAAEH,EAAGE,WACjBvC,EAAUuC,EAAUE,KAAK,SACzBC,EAAQH,EAAUE,KAAK,OACvBE,EAAaJ,EAAUE,KAAK,YAChCnD,EAAQ3G,EAAMsH,OAAOxB,KAAK,SAAUa,GAClC,OAAOA,EAAMpC,IAAM8C,KAKrBO,GAHAhD,EAAW5E,EAAM4G,UAAUd,KAAK,SAAUlB,GACxC,OAAOA,EAASL,IAAMyF,KAETtC,SAAS5B,KAAK,SAAU8B,GACrC,OAAOA,EAAIrD,IAAMwF,KAEflC,MAAO,EACX,IAAIoC,EAAS/E,OAAOgF,OAAO,CACzBC,OAAQ,WACN,IAAI1F,EAAMC,KACVD,EAAImD,IAAIC,MAAO,EACf7H,EAAMoK,aAAepK,EAAMoK,aAAa3C,OAAO,SAAU4C,GACvD,OAAOA,GAAY5F,MAGtB,CACD6F,UAAW,CACThF,MAAOsC,EACPxC,YAAY,GAEdmF,MAAO,CACLjF,MAAOsC,EAAI5B,MACXZ,YAAY,EACZoF,UAAU,GAEZC,SAAU,CACRnF,MAAOsC,EAAI5B,MACXZ,YAAY,EACZoF,UAAU,GAEZ5F,SAAU,CACRU,MAAOV,EACPQ,YAAY,EACZoF,UAAU,GAEZ7D,MAAO,CACLrB,MAAOqB,EACPvB,YAAY,GAEdwC,IAAK,CACHtC,MAAOsC,EACPxC,YAAY,GAEd/B,IAAK,CACHiC,MAAOoE,EAAGC,OAAOtG,IAAMsG,EAAOtG,IAC9B+B,YAAY,GAEd9B,KAAM,CACJgC,MAAOoE,EAAGC,OAAOrG,KAAOqG,EAAOrG,KAC/B8B,YAAY,KAIZpF,EAAMoK,aACRpK,EAAMoK,aAAarI,KAAKkI,GAExBjK,EAAMoK,aAAe,CAACH,GAM1B,SAASU,EAASpJ,GAGhB,IAAK,IAAID,KAAKC,EAFJmD,KAGJpD,GAAKC,EAAKD,GAmBlB,SAASsJ,EAAqBlB,EAAIC,GAChC,IAAIhD,EAAOiB,EACPgC,EAAYC,EAAEH,EAAGE,WACjBvC,EAAUuC,EAAUE,KAAK,SACzBC,EAAQH,EAAUE,KAAK,QAI3BlC,GAHAjB,EAAQ3G,EAAMsH,OAAOxB,KAAK,SAAUa,GAClC,OAAOA,EAAMpC,IAAM8C,KAETwD,UAAU/E,KAAK,SAAU8B,GACnC,OAAOA,EAAIrD,IAAMwF,KAEflC,MAAO,EACX,IAAIoC,EAAS,IAAIU,EAAS,CACxBL,UAAW1C,EACX2C,MAAO3C,EAAI5B,MACXyE,SAAU7C,EAAI5B,MACdW,MAAOA,EACPiB,IAAKA,EACLvE,IAAKqG,EAAGC,OAAOtG,IAAMsG,EAAOtG,IAC5BC,KAAMoG,EAAGC,OAAOrG,KAAOqG,EAAOrG,OAG5BtD,EAAMoK,aACRpK,EAAMoK,aAAarI,KAAKkI,GAExBjK,EAAMoK,aAAe,CAACH,GAI1B,SAASa,IACP,IAAIC,EAAS/J,EAAMgK,QAAQD,OAC3B/K,EAAMoI,UAAU6C,WAAaF,EAAOG,KAEjB,eAAfH,EAAOG,KACTlL,EAAMmL,OAAS1B,EACS,oBAAfsB,EAAOG,MAA6C,eAAfH,EAAOG,KACrDlL,EAAMmL,OAASP,EACS,UAAfG,EAAOG,OAChBlL,EAAMmL,OAAST,GAGjBnG,EAAK6G,SAASL,EAAOxG,IACrBD,EAAa8G,SAASL,EAAOzG,YAEK,oBAA9BtE,EAAMoI,UAAU6C,YAAkE,eAA9BjL,EAAMoI,UAAU6C,WACtEjL,EAAMqL,KAAOC,EAEbtL,EAAMqL,KAAOE,EAGRR,EAAOS,KACdzH,EAAgB0H,cAAc,SAAUrK,GACtC,IACE,GAAkB,KAAdA,EAAM4D,KA6DR,MAAM5D,EAAM6D,QA5DR7D,EAAMG,gBAAgBmK,QACxBrH,EAAcjD,EAAMG,KAAKuE,KAAK,SAAUC,GACtC,IAAI4F,EAAK,GAOT,GALuB,MAAnB5F,EAAQnE,SAAsCxB,MAAnB2F,EAAQnE,UACrC+J,EAAKjK,KAAKC,MAAMoE,EAAQnE,UAG1BmE,EAAQrE,KAAOiK,EACP,QAAOpH,GAAKA,GAAMoH,EAAGC,UAI7BvH,IACFrE,EAAM6L,QAAUxH,EAAY3C,KAAO2C,EAAY3C,KAAKmK,aAAUzL,EAC9DJ,EAAMoI,UAAUpC,MAAQ3B,EAAY3C,KAAKsE,OAG3CrC,EAAmBxC,KAAK,SAAiBC,GACvC,GAAkB,GAAdA,EAAM4D,KAqCR,MAAM5D,EAAM6D,QApCZjF,EAAM4F,SAASC,IAAMzE,EAAMG,KAEO,UAA9BvB,EAAMoI,UAAU6C,WACd5G,GACFrE,EAAM8L,YAAcC,EACpBC,EAAYC,KAAKjM,EAAOuE,EAAIF,EAAY3C,KAAKY,YAE7CtC,EAAM8L,YAAcI,EACpBF,EAAYC,KAAKjM,EAAOuE,IAEa,eAA9BvE,EAAMoI,UAAU6C,WACrB5G,GACFrE,EAAM8L,YAAcK,EACpBC,EAAiBH,KAAKjM,EAAOuE,EAAIF,EAAY3C,KAAKY,YAElDtC,EAAM8L,YAAcK,EACpBC,EAAiBH,KAAKjM,EAAOuE,IAEQ,eAA9BvE,EAAMoI,UAAU6C,WACrB5G,GACFrE,EAAM8L,YAAcO,EACpBC,EAAiBL,KAAKjM,EAAOuE,EAAIF,EAAY3C,KAAKY,YAElDtC,EAAM8L,YAAcS,EACpBD,EAAiBL,KAAKjM,EAAOuE,IAEQ,oBAA9BvE,EAAMoI,UAAU6C,aACrB5G,GACFrE,EAAM8L,YAAcU,EACpBC,EAAsBR,KAAKjM,EAAOuE,EAAIF,EAAY3C,KAAKY,YAEvDtC,EAAM8L,YAAcU,EACpBC,EAAsBR,KAAKjM,EAAOuE,MAMvC,SAAe6B,MAIpB,MAAOA,OAIb,SAAS+F,IACP,IAAI5K,EAAO,GAEPvB,EAAMoK,wBAAwBsB,QAChCnK,EAAOvB,EAAMoK,aAAapD,IAAI,SAAUjB,GACtC,MAAO,CACL0E,SAAU1E,EAAQ0E,SAClBpH,IAAK0C,EAAQ1C,IACbC,KAAMyC,EAAQzC,KACdsE,IAAK,CACH5B,MAAOD,EAAQ6B,IAAI5B,MACnBzB,GAAIwB,EAAQ6B,IAAIrD,GAChBmI,KAAM3G,EAAQ6B,IAAI8E,KAClBd,OAAQ7F,EAAQ6B,IAAIgE,QAEtBjF,MAAO,CACLX,MAAOD,EAAQY,MAAMX,MACrBzB,GAAIwB,EAAQY,MAAMpC,QAM1B,IAAI3C,EAAU,CACZiK,QAAS7L,EAAM6L,QACfvJ,SAAUf,GAEZyC,EAAkB2I,uBAAuBrI,EAAY,EAAG5C,KAAKI,UAAUF,GAEvE,SAAkBR,GAChBwC,EAAOgJ,SAASC,KAAO,iCAM3B,SAASL,IACP,IAAIjL,EAAO,GAEPvB,EAAMoK,wBAAwBsB,QAChCnK,EAAOvB,EAAMoK,aAAapD,IAAI,SAAUjB,GACtC,MAAO,CACL0E,SAAU1E,EAAQ0E,SAClBpH,IAAK0C,EAAQ1C,IACbC,KAAMyC,EAAQzC,KACdsE,IAAK,CACH5B,MAAOD,EAAQ6B,IAAI5B,MACnBzB,GAAIwB,EAAQ6B,IAAIrD,GAChBmI,KAAM3G,EAAQ6B,IAAI8E,KAClBd,OAAQ7F,EAAQ6B,IAAIgE,QAEtBjF,MAAO,CACLX,MAAOD,EAAQY,MAAMX,MACrBzB,GAAIwB,EAAQY,MAAMpC,QAM1B,IAAI3C,EAAU,CACZiK,QAAS7L,EAAM6L,QACfvJ,SAAUf,GAEZyC,EAAkB2I,uBAAuBrI,EAAYC,EAAI,EAAG7C,KAAKI,UAAUF,GAE3E,SAAkBR,GAChBwC,EAAOgJ,SAASC,KAAO,iCAM3B,SAASb,EAAYJ,EAAQxB,GAC3B,IAAI/C,EACAyF,EACAlG,EAAY,GAuBhB,SAASmG,IACPhJ,EAAgBgJ,kBAAkB,SAAU3L,GAGxB,KAAdA,EAAM4D,OACR8H,EAAc1L,EAAMG,QAGxByL,IAGF,SAASA,IACPlJ,EAAkBmJ,gBAAgBrB,EAAQ,SAAUxK,GAClD,IACE,GAAkB,KAAdA,EAAM4D,KA8DR,MAAM5D,EAAM6D,QAlDZ,GAXAjF,EAAMoI,UAAU8E,OAAS9L,EAAMG,KAC/BqF,EAAY,CAACxF,EAAMG,MAAMyF,IAAI,SAAUjB,GACrC,MAAO,CACLxB,GAAIwB,EAAQxB,GACZ5B,UAAWoD,EAAQpD,UACnBqD,MAAOD,EAAQC,MACf6B,MAAM,KAGVR,EAAUjG,EAAMG,KAAK8F,QAEc,iBAAxByF,EAAYzF,GAAsB,CAC1B,SAEF8F,KAAKL,EAAYzF,MAC9BzF,QAAUF,KAAKC,MAAMmL,EAAYzF,KAGnCrH,EAAMoK,aAAexI,QAAQU,SAAS0E,IAAI,SAAUjB,GAClD,OAAO,IAAI4E,EAAS5E,KAEtB/F,EAAM6L,QAAUjK,QAAQiK,QAG1B/H,EAAkBsJ,cAAc,CAAC/F,GAAU,SAAUgG,GAC7B,KAAlBA,EAAUrI,OACZhF,EAAMsH,OAAS+F,EAAU9L,QAG7BuC,EAAkBwJ,iBAAiBjG,EAAS,SAAUgG,GAiBpD,IAAK,IAAI/L,KAhBa,GAAlB+L,EAAUrI,MACZ4B,EAAU2G,QAAQ,SAAUC,GAC1BA,EAAIC,MAAO,EACXD,EAAI9F,SAAW,GACf2F,EAAU9L,KAAKgM,QAAQ,SAAU3F,GAC/B,IAAI8F,EAAO1N,EAAMoK,aAAazC,KAAK,SAAUgG,GAC3C,OAAO/F,EAAIrD,IAAMoJ,EAAQ/F,IAAIrD,KAE/BqD,EAAIC,MAAQ6F,EACZF,EAAI9F,SAAS3F,KAAK6F,OAKxB5H,EAAM4G,UAAYA,EAEJ5G,EAAMoK,cAClB,SAAWwD,EAAO7H,GAChB,IAAID,EAAOc,EAAUd,KAAK,SAAU5C,GAClC,OAAO6C,EAAQnB,SAASL,IAAMrB,EAAKqB,KAGjCuB,IACFC,EAAQnB,SAAWkB,GANvB,CAUGxE,EAAGtB,EAAMoK,aAAa9I,MAM/B,MAAO8E,OApGbpG,EAAMsG,KAAO,EACbtG,EAAMoK,aAAeA,GAA8B,GACnDpK,EAAMoK,aAAepK,EAAMoK,aAAapD,IAAI,SAAUjB,GACpD,OAAO,IAAI4E,EAAS5E,KAEtBgH,IACAC,IAEInD,EAAEgE,QAAQ7N,EAAMoK,eACc,EAA5BpK,EAAMoK,aAAa0D,QACrB9N,EAAMoK,aAAeA,GAA8B,GACnDpK,EAAMoK,aAAepK,EAAMoK,aAAapD,IAAI,SAAUjB,GACpD,OAAO,IAAI4E,EAAS5E,KAEtBiH,KAKFD,IAsFJ,SAASX,EAAiB2B,GACxB/J,EAAkBgK,sBAAsB1J,EAAY,EAAGyJ,EAAe,SAAU3M,GAC9E,IAAIQ,EAAU,GAEd,GAAkB,KAAdR,EAAM4D,KAAa,CACrB,GAAyB,iBAAd5D,EAAMG,KAAkB,CAChB,SAEF4L,KAAK/L,EAAMG,QACxBK,EAAUF,KAAKC,MAAMP,EAAMG,OAI3BK,EAAQU,WACVtC,EAAMoK,aAAexI,EAAQU,SAAS0E,IAAI,SAAUjB,GAClD,OAAO,IAAI4E,EAAS5E,MAIxB/F,EAAM6L,QAAUjK,EAAQiK,WAG5B7L,EAAMsG,KAAO,EACbxC,EAAkBsJ,cAAc,CAACW,GAEjC,SAAkB3M,GAChB,IACE,GAAkB,KAAdA,EAAM4D,KAYR,MAAM5D,EAAM6D,QATZ,IAAK,IAAI3D,KAFTtB,EAAMsH,OAASlG,EAAMG,KAEPvB,EAAMsH,QAClB,SAAWsG,EAAO7H,GAChBA,EAAQ0H,MAAO,EACfxJ,EAAqBgK,KAAKpH,aAAad,EAAQxB,IAAIpD,KAAK,SAAUI,GAChEwE,EAAQ8E,UAAYtJ,IAHxB,CAKGD,EAAGtB,EAAMsH,OAAOhG,IAKvB,MAAO8E,OAqBb,SAASqG,EAAsByB,GAU7BlK,EAAkBgK,sBAAsB1J,EAAY4J,EAAoB,EAAG,SAAU9M,GACnF,IAAIQ,EAAU,GAEd,GAAkB,KAAdR,EAAM4D,KAAa,CACrB,GAAyB,iBAAd5D,EAAMG,KAAkB,CAChB,SAEF4L,KAAK/L,EAAMG,QACxBK,EAAUF,KAAKC,MAAMP,EAAMG,OAI3BK,EAAQU,WACVtC,EAAMoK,aAAexI,EAAQU,SAAS0E,IAAI,SAAUjB,GAClD,OAAO,IAAI4E,EAAS5E,MAIxB/F,EAAM6L,QAAUjK,EAAQiK,WAG5B7L,EAAMsG,KAAO,EACbtC,EAAkBmK,mBAAmB7J,EAAY4J,EAEjD,SAAkB9M,GAChB,IACE,GAAkB,KAAdA,EAAM4D,KAwBR,MAAM5D,EAAM6D,QArBZ,IAAK,IAAI3D,KAFTtB,EAAMsH,OAASlG,EAAMG,KAEPvB,EAAMsH,QAClB,SAAWsG,EAAO7H,GAChBA,EAAQ0H,KAER1H,EAAQqI,OAAS,WACf,IACIC,GADM3J,KACM+I,KAEhB,IAAK,IAAIa,KAAKtO,EAAMsH,OAClBtH,EAAMsH,OAAOgH,GAAGb,MAAO,EAJf/I,KAON+I,KAAOY,GAGbpK,EAAqBgK,KAAKpH,aAAad,EAAQxB,IAAIpD,KAAK,SAAUI,GAChEwE,EAAQ8E,UAAYtJ,IAfxB,CAiBGD,EAAGtB,EAAMsH,OAAOhG,IAKvB,MAAO8E,OAqBb,SAASkG,EAAiBiC,EAAenE,GACvC,IACIlG,EAAWL,EAAEc,QACbR,EAAUD,EAASC,QAuDvB,SAASqK,IACP,IAAI/J,EAAMC,KAEVD,EAAIuD,SAAW,WACbxD,EAAYyH,KAAKjM,EAAMoI,UAAUC,YACjCtE,EAAgBgJ,kBAAkB,SAAU3L,GAC1C,IAAIQ,EAAU,GAEd,GAAkB,KAAdR,EAAM4D,MACyB,iBAAtB5D,EAAMG,KAAKkD,EAAIF,IAAiB,CACxB,SAEF4I,KAAK/L,EAAMG,KAAKkD,EAAIF,OACjC3C,EAAUF,KAAKC,MAAMP,EAAMG,KAAKkD,EAAIF,MAGjCA,IACHvE,EAAMoK,aAAexI,EAAQU,SAAS0E,IAAI,SAAUjB,GAClD,OAAO,IAAI4E,EAAS5E,MAoBxB/F,EAAM6L,QAAUjK,EAAQiK,YA3FlC7L,EAAMoK,aAAeA,GAA8B,GACnDpK,EAAMoK,aAAepK,EAAMoK,aAAapD,IAAI,SAAUjB,GACpD,OAAO,IAAI4E,EAAS5E,KAIlBwI,EACFzK,EAAkBmJ,gBAAgBsB,EAAe,SAAUnN,GACzD,IACE,GAAkB,KAAdA,EAAM4D,KAGR,MAAM5D,EAAM6D,QAFZf,EAASiC,QAAQ/E,EAAMG,MAIzB,MAAO6E,GACPlC,EAASmC,OAAOD,MAIpBlC,EAASiC,aAAQ/F,GAGnB+D,EAAQhD,KAAK,SAAiByD,GACnBA,EACTyE,EAAmBC,MAAMnI,KAAK,SAAiBI,GAC7C,IAAK,IAAID,KAAKC,EACMwE,EAEZxE,EAAKD,GADTkN,EAAQvC,KAAKlG,GADf,IAAkBA,EAOpB,GAFA/F,EAAMyO,YAAclN,EAEJnB,MAAZwE,EAAuB,CACzB,IAAIkB,EAAO9F,EAAMyO,YAAY3I,KAAK,SAAUC,GAC1C,OAAOA,EAAQxB,IAAMK,EAASyC,SAA+BjH,MAApBwE,EAASyC,UAIlDrH,EAAMoI,UAAUC,WADdvC,GAG2B9F,EAAMyO,YAAY,GAGjDzO,EAAMoI,UAAUC,WAAWL,WAGzBhI,EAAMoI,UAAUC,YAClB7D,EAAYyH,KAAKjM,EAAMoI,UAAUC,WAAYzD,EAAWA,EAAS8J,YAAStO,GAAWe,KAAK,SAAiBkH,OAE5G,SAAejC,OACjB,SAAeA,MA+ClBpG,EAAM2O,SAAW,WACf,IAAIC,EAAS,GAcb,SAASC,EAASzN,GACZA,EAAMG,gBAAgBmK,MACxB1L,EAAMsH,OAASlG,EAAMG,KAErBvB,EAAMsH,OAAS,GAOjB,IAAK,IAAIhG,KAAKtB,EAAMoK,cAClB,SAAWwD,EAAOkB,GAChB,IAA0B,UAAtBxP,QAAQwP,EAAInI,QAAmC,MAAbmI,EAAInI,QACX,UAAzBrH,QAAQwP,EAAIlK,WAAyC,MAAhBkK,EAAIlK,SAAkB,CAC7D,IAAIoF,EAAa8E,EAAIlK,SAASL,GAC9BT,EAAkBmJ,gBAAgBjD,EAAY,SAAU5I,GACtD,GAAkB,KAAdA,EAAM4D,KAAa,CACrB,IAAIc,EAAO9F,EAAMsH,OAAOxB,KAAK,SAAUC,GACrC,OAAkB,MAAd3E,EAAMG,MACDwE,EAAQxB,IAAMnD,EAAMG,KAAK8F,UAMhCvB,IACFgJ,EAAInI,MAAQ,CACVpC,GAAIuB,EAAKvB,GACTyB,MAAOF,EAAKE,YAjB1B,CAwBG1E,EAAGtB,EAAMoK,aAAa9I,IAI3B,GAAkB,KAAdF,EAAM4D,KAAa,CACrB,IAAK,IAAI1D,KAAKtB,EAAMsH,OAAQ,CAC1B,IAAI3C,EAAQd,EAAEc,QACdiK,EAAO7M,KAAK4C,EAAMR,SAElB,SAAWyJ,EAAO7H,EAASpB,GACzB,IAAI0C,EAAUtB,EAAQxB,GACtBwB,EAAQ0H,KAER1H,EAAQqI,OAAS,WACf,IACIC,GADM3J,KACM+I,KAEhB,IAAK,IAAIa,KAAKtO,EAAMsH,OAClBtH,EAAMsH,OAAOgH,GAAGb,MAAO,EAJf/I,KAON+I,KAAOY,GAGbpK,EAAqB2C,UAAUC,aAAaQ,GAASlG,KAAK,SAAiBI,GAYzE,SAAS6M,IACP,IACIC,GADM3J,KACM+I,KAEhB,IAAK,IAAIa,KAAKvI,EAAQyB,eACpBzB,EAAQyB,eAAe8G,GAAGb,MAAO,EAJzB/I,KAON+I,KAAOY,EAnBbtI,EAAQyB,eAAiBjG,EAAKyF,IAAI,SAAUjB,GAC1C,MAAO,CACLxB,GAAIwB,EAAQxB,GACZ5B,UAAWoD,EAAQpD,UACnBqD,MAAOD,EAAQC,MACf6B,MAAM,EACN4F,MAAM,EACNW,OAAQA,KAgBZnK,EAAqBgK,KAAKpH,aAAaQ,GAASlG,KAAK,SAAiBI,GAEpE,IAAK,IAAID,KAAKyE,EAAQyB,gBACpB,SAAWoG,EAAOJ,GAChBA,EAAI9F,SAAWnG,EAAKyF,IAAI,SAAUY,GAiBhC,MAPS,CACPC,KAAkBzH,MARLJ,EAAMoK,aAAatE,KAAK,SAAUC,GAC/C,QAAIA,EAAQnB,WACHmB,EAAQnB,SAASL,IAAMiJ,EAAIjJ,IAAMwB,EAAQ6B,IAAIrD,IAAMqD,EAAIrD,MAOhEmI,KAAM9E,EAAI8E,KACVd,OAAQ4B,EAAIjJ,GACZA,GAAIqD,EAAIrD,GACRyB,MAAO4B,EAAI5B,SAIf,IAAI+I,EAAU/O,EAAMoK,aAAa3C,OAAO,SAAU1B,GAChD,QAAIA,EAAQnB,UAEHmB,EAAQnB,SAASL,IAAMiJ,EAAIjJ,KAMtC,GAAIwK,EACF,IAAK,IAAIT,KAAKS,EACZA,EAAQT,GAAG1J,SAAS8C,SAAW8F,EAAI9F,SA/BzC,CAkCGkG,EAAO7H,EAAQyB,eAAelG,IAKnCqD,EAAMwB,QAAQ,YAKb,SAAeC,OACjB,SAAeA,MAvFpB,CAwFG9E,EAAGtB,EAAMsH,OAAOhG,GAAIqD,GAGzBd,EAAEgC,IAAI+I,GAAQzN,KAAK,SAAiBI,GAElCvB,EAAMoK,aAAepK,EAAMoK,aAAa3C,OAAO,SAAU1B,GACvD,IAAIsB,EAAUtB,EAAQY,MAAMpC,GAI5B,OAHWvE,EAAMsH,OAAOK,KAAK,SAAU5B,GACrC,OAAOA,EAAQxB,IAAM8C,OAsBxB,SAAejB,OAhLtBpG,EAAMsG,KAAO,EAEK,GAAdhC,EACFR,EAAkBsF,UAAUyF,GAE5B5F,EAAQC,SAAS/H,KAAK,SAAUI,GAC9BsN,EAAS,CACP7J,KAAM,IACNzD,KAAMA,OAwLhB,SAAS2K,IACP,IAAI3K,EAAOvB,EAAMoK,aAAapD,IAAI,SAAUjB,GAC1C,MAAO,CACL0E,SAAU1E,EAAQ0E,SAClBpH,IAAK0C,EAAQ1C,IACbC,KAAMyC,EAAQzC,KACdsE,IAAK,CACH5B,MAAOD,EAAQ6B,IAAI5B,MACnBzB,GAAIwB,EAAQ6B,IAAIrD,GAChBmI,KAAM3G,EAAQ6B,IAAI8E,KAClBd,OAAQ7F,EAAQ6B,IAAIgE,QAEtBhH,SAAU,CACRoB,MAAOD,EAAQnB,SAASoB,MACxBzB,GAAIwB,EAAQnB,SAASL,OAIvB3C,EAAU,CACZgK,OAAQ5L,EAAM4G,UAAU,GAAGrC,GAC3BsH,QAAS7L,EAAM6L,QACfvJ,SAAUf,GAERyN,EAAQ,CACVC,UAAWjP,EAAM4G,UAAU,GAAGZ,MAC9BkJ,SAAU,WACV1N,SAAU,WACVI,QAASF,KAAKI,UAAUF,IAE1BmC,EAAgBoL,QAAQH,EAAO,SAAU5N,GACrB,GAAdA,EAAM4D,OACRpB,EAAOgJ,SAASC,KAAO,2CAK7B,SAASd,IACP,IAAIxK,EAAOvB,EAAMoK,aAAapD,IAAI,SAAUjB,GAC1C,MAAO,CACL0E,SAAU1E,EAAQ0E,SAClBpH,IAAK0C,EAAQ1C,IACbC,KAAMyC,EAAQzC,KACdsE,IAAK,CACH5B,MAAOD,EAAQ6B,IAAI5B,MACnBzB,GAAIwB,EAAQ6B,IAAIrD,GAChBmI,KAAM3G,EAAQ6B,IAAI8E,KAClBd,OAAQ7F,EAAQ6B,IAAIgE,QAEtBhH,SAAU,CACRoB,MAAOD,EAAQnB,SAASoB,MACxBzB,GAAIwB,EAAQnB,SAASL,OAIvB3C,EAAU,CACZgK,OAAQvH,EAAY3C,KAAKkK,OACzBC,QAAS7L,EAAM6L,QACfvJ,SAAUf,GAERyN,EAAQ,CACVtM,OAAQ2B,EAAY3B,OACpB0M,eAAgB,EAChBH,UAAWjP,EAAM4G,UAAU,GAAGZ,MAC9BkJ,SAAU,WACV1N,SAAU,WACVI,QAASF,KAAKI,UAAUF,IAE1BmC,EAAgBsL,WAAWL,EAAO,SAAU5N,GACxB,GAAdA,EAAM4D,OACRpB,EAAOgJ,SAASC,KAAO,2CAK7B,SAASN,IAyBP,SAAS+C,IACP,IAIoBvJ,EACZwJ,EAaKzF,EAAM0F,EAlBfC,EAAc,GAGlB,IAAK,IAAInO,KAFTtB,EAAMoI,UAAUC,WAAWvD,cAEb9E,EAAMoI,UAAUC,WAAWvD,cACrBiB,EAQZ/F,EAAMoI,UAAUC,WAAWvD,cAAcxD,QAPzCiO,EAAAA,EAAWxJ,EAAQzF,KAEkBF,MAArCJ,EAAMoI,UAAUC,WAAWqG,SAC7B1O,EAAMoI,UAAUC,WAAWqG,OAAS,IAGtC1O,EAAMoI,UAAUC,WAAWqG,OAAOa,GAAYxJ,EAAQT,MAM1D,IAAK,IAAIgJ,KAFTtO,EAAMoI,UAAUC,WAAWhB,QAAUrH,EAAMoI,UAAUC,WAAW9D,GAElDvE,EAAMoI,UAAUC,WACjByB,EAERwE,EAFckB,EAEXxP,EAAMoI,UAAUC,WAAWiG,GAD/BmB,EAAY3F,GAAQ0F,EAKxBxP,EAAMoK,aAAepK,EAAMoK,aAAa3C,OAAO,SAAU1B,GACvD,OAA2B3F,MAApB2F,EAAQnB,UAA6C,MAApBmB,EAAQnB,WAElD,IAAIrD,EAAOvB,EAAMoK,aAAapD,IAAI,SAAUjB,GAC1C,MAAO,CACLwE,MAAOxE,EAAQwE,MACfE,SAAU1E,EAAQ0E,SAClBpH,IAAK0C,EAAQ1C,IACbC,KAAMyC,EAAQzC,KACdqD,MAAO,CACLX,MAAOD,EAAQY,MAAMX,MACrBzB,GAAIwB,EAAQY,MAAMpC,IAEpBqD,IAAK,CACH5B,MAAOD,EAAQ6B,IAAI5B,MACnBzB,GAAIwB,EAAQ6B,IAAIrD,GAChBmI,KAAM3G,EAAQ6B,IAAI8E,KAClBd,OAAQ7F,EAAQ6B,IAAIgE,QAEtBhH,SAAU,CACRoB,MAAOD,EAAQnB,SAASoB,MACxBzB,GAAIwB,EAAQnB,SAASL,OAI3BT,EAAkB4L,gBAAgBD,EAAa,SAAUrO,GACvD,IACE,GAAkB,KAAdA,EAAM4D,KAsCR,MAAM5D,EAAM6D,QArCZ,IAAIsJ,EAAgBnN,EAAMG,KAAKgD,GAC/BoL,cAAgB3P,EAAMoK,aAAapD,IAAI,SAAUjB,GAC/C,MAAO,CACLC,MAAOD,EAAQC,MACfuI,cAAeA,EACf3L,SAAUmD,EAAQnB,SAASL,GAC3BwF,MAAOhE,EAAQ6B,IAAIrD,MAGvBT,EAAkB8L,mBAAmBrB,EAAeoB,cAAe,SAAUvO,GAC3E,IACE,GAAkB,KAAdA,EAAM4D,KAqBR,MAAM5D,EAAM6D,QApBZ,IAAIrD,EAAU,CACZoE,MAAOhG,EAAMoI,UAAUpC,MACvB4F,OAAQ2C,EACR1C,QAAS7L,EAAM6L,QACfvJ,SAAUf,GAERyN,EAAQ,CACVC,UAAW,WACXC,SAAU,WACV1N,SAAU,WACVI,QAASF,KAAKI,UAAUF,IAE1BmC,EAAgBoL,QAAQH,EAAO,SAAU5N,GACvC,GAAkB,GAAdA,EAAM4D,KAGR,MAAM5D,EAAM6D,QAFZrB,EAAOgJ,SAASC,KAAO,0CAQ7B,MAAOzG,OAKb,MAAOA,OApHbyJ,SAAW7P,EAAMoK,aAAazC,KAAK,SAAU5B,GAC3C,OAA2B3F,MAApB2F,EAAQnB,UAA6C,MAApBmB,EAAQnB,WAG9CiL,SACF7P,EAAM8P,IAAM,CACVvF,MAAO,WACP3I,QAAS,8BACTmO,QAAS,CAAC,CACRC,KAAM,KACNC,GAUN,WACEjQ,EAAM8P,SAAM1P,IAVP,CACD4P,KAAM,KACNC,GAAIX,KAIRA,IAwGJ,SAASjD,IACP,IAIoBtG,EACZwJ,EAaKzF,EAAM0F,EAlBfC,EAAc,GAGlB,IAAK,IAAInO,KAFTtB,EAAMoI,UAAUC,WAAWvD,cAEb9E,EAAMoI,UAAUC,WAAWvD,cACrBiB,EAQZ/F,EAAMoI,UAAUC,WAAWvD,cAAcxD,QAPzCiO,EAAAA,EAAWxJ,EAAQzF,KAEkBF,MAArCJ,EAAMoI,UAAUC,WAAWqG,SAC7B1O,EAAMoI,UAAUC,WAAWqG,OAAS,IAGtC1O,EAAMoI,UAAUC,WAAWqG,OAAOa,GAAYxJ,EAAQT,MAM1D,IAAK,IAAIgJ,KAFTtO,EAAMoI,UAAUC,WAAWhB,QAAUrH,EAAMoI,UAAUC,WAAW9D,GAElDvE,EAAMoI,UAAUC,WACjByB,EAERwE,EAFckB,EAEXxP,EAAMoI,UAAUC,WAAWiG,GAD/BmB,EAAY3F,GAAQ0F,EAKxBC,EAAYlL,GAAK6G,SAAS7G,GAC1B,IAAIhD,EAAOvB,EAAMoK,aAAapD,IAAI,SAAUjB,GAC1C,IAAI1E,EAAS,CACXoJ,SAAU1E,EAAQ0E,SAClBpH,IAAK0C,EAAQ1C,IACbC,KAAMyC,EAAQzC,KACdsE,IAAK,CACH5B,MAAOD,EAAQ6B,IAAI5B,MACnBzB,GAAIwB,EAAQ6B,IAAIrD,GAChBmI,KAAM3G,EAAQ6B,IAAI8E,KAClBd,OAAQ7F,EAAQ6B,IAAIgE,QAEtBhH,SAAU,CACRoB,MAAOD,EAAQnB,SAASoB,MACxBzB,GAAIwB,EAAQnB,SAASL,KAWzB,OAPIwB,EAAQY,QACVtF,EAAOsF,MAAQ,CACbX,MAAOD,EAAQY,MAAMX,MACrBzB,GAAIwB,EAAQY,MAAMpC,KAIflD,IAETyC,EAAkB4L,gBAAgBD,EAAa,SAAUrO,GACvD,IACE,GAAkB,KAAdA,EAAM4D,KAwCR,MAAM5D,EAAM6D,QAvCZ,IAAIsJ,EAAgBnN,EAAMG,KAAKgD,GAC/BoL,cAAgB3P,EAAMoK,aAAapD,IAAI,SAAUjB,GAC/C,MAAO,CACLC,MAAOD,EAAQC,MACfuI,cAAeA,EACf3L,SAAUmD,EAAQnB,SAASL,GAC3BwF,MAAOhE,EAAQ6B,IAAIrD,MAGvBT,EAAkB8L,mBAAmBrB,EAAeoB,cAAe,SAAUvO,GAC3E,IACE,GAAkB,KAAdA,EAAM4D,KAuBR,MAAM5D,EAAM6D,QAtBZ,IAAIrD,EAAU,CACZoE,MAAOhG,EAAMoI,UAAUpC,MACvB4F,OAAQ2C,EACR1C,QAAS7L,EAAM6L,QACfvJ,SAAUf,GAERyN,EAAQ,CACVtM,OAAQ2B,EAAY3B,OACpB0M,eAAgB,EAChBH,UAAW,WACXC,SAAU,WACV1N,SAAU,WACVI,QAASF,KAAKI,UAAUF,IAE1BmC,EAAgBsL,WAAWL,EAAO,SAAU5N,GAC1C,GAAkB,GAAdA,EAAM4D,KAGR,MAAM5D,EAAM6D,QAFZrB,EAAOgJ,SAASC,KAAO,0CAQ7B,MAAOzG,OAKb,MAAOA,OA+Fb,SAASmF,IACP3H,EAAOgJ,SAASC,KAAO,wCAGzB,SAASvB,IACP1H,EAAOgJ,SAASC,KAAO,+BAlzCzB7M,EAAMkQ,QAiuCN,SAAiBC,GACf,OAAQA,GACN,IAAK,cACH,MAAO,CACLnN,mBAAoB,wCAIxB,IAAK,WACH,MAAO,CACLA,mBAAoB,0CAIxB,QACE,MAAO,CACLA,mBAAoB,0CAhvC5BhD,EAAMoQ,WAsvCN,SAAoBD,GAClB,OAAQA,GACN,IAAK,cACH,MAAO,CACLnN,mBAAoB,wCAIxB,IAAK,WACH,MAAO,CACLA,mBAAoB,0CAIxB,QACE,MAAO,CACLA,mBAAoB,0CArwC5BhD,EAAMqQ,aAuzCN,WACErQ,EAAMsG,KAAO,GAvzCftG,EAAM8C,YA0wCN,SAAqByB,EAAI0J,GACvB,IAAIlL,EAEJ,IAAK,IAAIzB,KAAK2M,EACR1J,GAAM0J,EAAK3M,GAAGiD,KAChBxB,EAAOkL,EAAK3M,GAAGyB,MAInB,OAAQA,GACN,IAAK,SAML,IAAK,cACH,MAAO,CACLC,mBAAoB,2CAIxB,QACE,MAAO,KAhyCbhD,EAAMsQ,aAizCN,WACE1M,EAAO2M,KAAK,4CAA6C,UAjzC3DvQ,EAAMwQ,YAwzCN,SAAqBjR,GACnBS,EAAM6L,QAAUtM,EAAIiD,MAxzCtBxC,EAAMyQ,eAmyCN,WACE7M,EAAOgJ,SAAS8D,UAnyClB1Q,EAAM2Q,YAotCN,SAAqBnO,GACnB,OAAOA,EAAO,CACZQ,mBAAoB,UAAYR,EAAO,KACrC,IAttCNxC,EAAM4Q,SA0sCN,SAAkBpO,GAIhB,MAHU,CACRQ,mBAAoB,UAAYR,EAAO,MA3sC3CxC,EAAM6Q,gBAAkB,GACxB7Q,EAAMoI,UAAYlD,OAAOgF,OAAO,IAChClK,EAAM6Q,gBAAkB,CAAC,CACvBtM,GAAI,EACJ/B,KAAM,4BACL,CACD+B,GAAI,EACJ/B,KAAM,4BACL,CACD+B,GAAI,EACJ/B,KAAM,6BAGJxB,EAAMgK,QACRF,IAEA7K,EAAU6Q,IAAI,aAAc,WAC1BhG,MA0JJH,EAAShL,UAAUwK,OAAS,WAC1B,IAAI1F,EAAMC,KAEV1E,EAAMoK,aAAepK,EAAMoK,aAAa3C,OAAO,SAAU4C,GACvD,OAAOA,GAAY5F,IAGjBA,EAAIG,WACIH,EAAIG,SAAS8C,SAAS5B,KAAK,SAAUC,GAC7C,OAAOA,EAAQxB,IAAME,EAAImD,IAAIrD,KAEvBsD,MAAO","file":"app-topo/js/controllers/controller.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine([\"angular\"], function (angular) {\n  var module = angular.module(\"myapp\");\n  module.controller(\"loginController\", [\"$scope\", \"$rootScope\", \"loginManagement\", function (scope, rootScope, lm) {\n    rootScope.loading = undefined;\n    scope.loginList = [{\n      \"name\": \"wangxingbo@proudsmart.com\",\n      \"password\": \"abc123\"\n    }, {\n      \"name\": \"ps@ps.com\",\n      \"password\": \"abc1234\"\n    }, {\n      \"name\": \"394160008@qq.com\",\n      \"password\": \"@WSX3edc\"\n    }, {\n      \"name\": \"zhangjiang79@qq.com\",\n      \"password\": \"1q2w3e4r\"\n    }, {\n      \"name\": \"adomain@test.com\",\n      \"password\": \"1q2w3e4r\"\n    }, {\n      \"name\": \"1203538033@qq.com\",\n      \"password\": \"lin664181\"\n    }, {\n      \"name\": \"18611560122\",\n      \"password\": \"abc123\"\n    }];\n    scope.sitem = scope.loginList[0];\n\n    scope.login = function (item) {\n      lm.login(item);\n    };\n  }]);\n  module.controller(\"toposhowController\", [\"$scope\", \"userLoginUIService\", \"$rootScope\", \"getviews\", \"$location\", \"deleteViews\", \"unregisterDevice\", \"$route\", function (scope, userLoginUIService, rootScope, getviews, loc, deleteViews, unregisterDevice, route) {\n    rootScope.loading = false;\n    scope.userInfo = userLoginUIService.user;\n    getviews.then(function success(event) {\n      var result = [];\n\n      for (var i in event.data) {\n        if (event.data[i].viewType == \"topology\") {\n          var innerData = JSON.parse(event.data[i].content);\n          var clone = JSON.parse(JSON.stringify(event.data[i]));\n          clone.content = innerData;\n          result.push(clone);\n        }\n      }\n\n      scope.viewList = result;\n    }, function error(error) {});\n    scope.getLocation = undefined;\n    scope.viewClick = viewClick;\n    scope.addNewTopo = addNewTopo;\n    scope.deleteChart = deleteChart;\n    scope.backTolist = backTolist;\n    scope.renderImage = renderImage;\n    scope.elemCLick = elemCLick;\n    scope.elePos = elePos;\n    scope.popPos = popPos;\n    scope.popClose = popClose;\n\n    function popClose() {\n      scope.selectedElement = undefined;\n    }\n\n    function elePos(top, left) {\n      return {\n        top: top + \"px\",\n        left: left + \"px\"\n      };\n    }\n\n    function popPos(top, left) {\n      return {\n        top: top - 120 + \"px\",\n        left: left - 40 + \"px\"\n      };\n    }\n\n    function elemCLick(elem) {\n      scope.selectedElement = elem;\n    }\n\n    function renderImage(unit) {\n      switch (unit) {\n        case \"Amount\":\n          return {\n            \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n          };\n          break;\n\n        case \"Temperature\":\n          return {\n            \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n          };\n          break;\n\n        default:\n          return {\n            \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n          };\n          break;\n      }\n    }\n\n    function viewClick(view) {\n      scope.selectView = view.content.elements;\n    }\n\n    function backTolist(view) {\n      scope.selectView = undefined;\n    }\n\n    function addNewTopo() {\n      loc.path(\"/topology\");\n    }\n\n    function deleteChart(viewId, gatewayId, deviceId) {\n      deleteViews([viewId]).then(function success(event) {\n        unregisterDevice(gatewayId, deviceId).then(function success(event) {\n          getviews.then(function success(event) {\n            var result = [];\n\n            for (var i in event.data) {\n              if (event.data[i].viewType == \"topology\") {\n                result.push(event.data[i]);\n              }\n            }\n\n            scope.viewList = result;\n          }, function error(error) {});\n        });\n      }, function error(error) {});\n    }\n  }]);\n  module.controller(\"mainController\", [\"$scope\", \"userLoginUIService\", \"$rootScope\", \"$timeout\", \"$location\", \"kpiDataService\", \"getSimpleDistricts\", \"$window\", \"$q\", \"$route\", \"resourceUIService\", \"viewFlexService\", 'solutionUIService', 'serviceCenterService', function (scope, userLoginUIService, rootScope, timeout, loc, kpiDataService, getSimpleDistricts, window, q, route, resourceUIService, viewFlexService, solutionUIService, serviceCenterService) {\n    var deferred, promise, localSearch, currentView, solutionId, id, flag; //viewFlexService.deleteViews([10125]);\n\n    rootScope.loading = false;\n    rootScope.step = 0;\n    scope.saveloading = false;\n    scope.userInfo = userLoginUIService.user;\n    deferred = q.defer();\n    promise = deferred.promise;\n\n    require([\"baiduMap\"], function (Bmap) {\n      Bmap(function (event) {\n        if (event != 'error') {\n          deferred.resolve(event);\n        } else {\n          deferred.reject(event);\n        }\n      });\n    });\n\n    scope.editResource = function (model) {\n      serviceCenterService.resources.getBymodelId(model.id).then(function (data) {});\n    };\n\n    resourceUIService.getAllGateways(function (event) {\n      var first = [{\n        id: '',\n        name: '所有网关'\n      }];\n      var remap = event.data.map(function (element) {\n        return {\n          id: element.id,\n          name: element.name\n        };\n      });\n      scope.gateways = first.concat(remap);\n      scope.gatewayId = '';\n    });\n\n    function $modelGroup() {\n      var cur = this,\n          deferred = q.defer(),\n          resource = arguments[0];\n\n      if (!cur.attributesDes) {\n        resourceUIService.getAttrsByModelId(cur.id, function (event) {\n          try {\n            if (event.code == 0) {\n              cur.attributesDes = event.data;\n              Object.defineProperty(cur, \"attributesDes\", {\n                enumerable: false\n              });\n              Object.defineProperty(cur, \"id\", {\n                enumerable: false\n              });\n\n              if (resource) {\n                for (var i in cur.attributesDes) {\n                  (function (name, attribute) {\n                    attribute.value = resource ? resource[name] : '';\n\n                    if (name == 'standardAddress') {\n                      var arr = resource ? resource[name].split(\",\") : [],\n                          province,\n                          city,\n                          district;\n\n                      if (arr[0]) {\n                        province = scope.$Address.all.find(function (element) {\n                          return element.label == arr[0];\n                        });\n                      }\n\n                      if (arr[1]) {\n                        city = province.children.find(function (element) {\n                          return element.label == arr[1];\n                        });\n\n                        if (!city) {\n                          city = province.children[0];\n                        }\n                      }\n\n                      if (arr[2]) {\n                        district = city.children.find(function (element) {\n                          return element.label == arr[2];\n                        });\n\n                        if (!district) {\n                          district = city.children[0];\n                        }\n                      }\n\n                      scope.$Address.setPosition(province, city, district);\n                    } else if (name == 'productionDate') {\n                      if (resource) {\n                        if (typeof resource[name] == 'string') {\n                          attribute.value = resource ? resource[name].split(\"T\")[0] : '';\n                        }\n                      }\n                    }\n                  })(cur.attributesDes[i].name, cur.attributesDes[i]);\n                }\n              }\n\n              deferred.resolve(cur);\n            } else {\n              throw event.message;\n            }\n          } catch (err) {\n            deferred.reject(err);\n          }\n        });\n      }\n\n      return deferred.promise;\n    }\n\n    ;\n\n    scope.openResourceSelect = function (receive) {\n      var modelId = receive.model.id;\n      var model = scope.models.find(function (element) {\n        return element.id == modelId;\n      });\n      scope.resourceSelect = model.resourcesArray.filter(function (element) {\n        var findshow = element.kpiArray.some(function (kpi) {\n          return kpi.show == true;\n        });\n        return findshow;\n      });\n\n      scope.selectResource = function (resource) {\n        receive.resource = resource;\n        var kpi = resource.kpiArray.find(function (element) {\n          return receive.kpi.id == element.id;\n        });\n\n        if (_typeof(kpi) == 'object' && kpi != null) {\n          kpi.show = false;\n        }\n\n        delete scope.resourceSelect;\n        delete scope.selectResource;\n      };\n    };\n\n    scope.resourceClose = function () {\n      delete scope.selectResource;\n      delete scope.resourceSelect;\n    };\n\n    scope.$Address = {\n      setPosition: function setPosition(province, city, district) {\n        var cur = this;\n\n        if (province) {\n          cur.province = province;\n\n          if (city) {\n            cur.city = city;\n\n            if (district) {\n              cur.district = district;\n            } else {\n              cur.district = cur.city.children[0];\n            }\n          } else {\n            cur.city = province.children[0];\n            cur.district = cur.city.children[0];\n          }\n        }\n\n        if (cur.onChange) {\n          cur.onChange(cur.province, cur.city, cur.district);\n        }\n      },\n      changeProvince: function changeProvince(province) {\n        var cur = this;\n        cur.city = province.children[0];\n        cur.district = cur.city.children[0];\n\n        if (cur.onChange) {\n          cur.onChange(cur.province, cur.city, cur.district);\n        }\n      },\n      changeCity: function changeCity(city) {\n        var cur = this;\n        cur.district = city.children[0];\n\n        if (cur.onChange) {\n          cur.onChange(cur.province, cur.city, cur.district);\n        }\n      },\n      changeDistrict: function changeDistrict(district) {\n        var cur = this;\n\n        if (cur.onChange) {\n          cur.onChange(cur.province, cur.city, cur.district);\n        }\n      },\n      onChange: function onChange(province, city, district) {\n        if (scope.equipment.modelGroup.attributesDes) {\n          var find = scope.equipment.modelGroup.attributesDes.find(function (element) {\n            return element.name == 'standardAddress';\n          });\n          var lat = scope.equipment.modelGroup.attributesDes.find(function (element) {\n            return element.name == 'latitude';\n          });\n          var lng = scope.equipment.modelGroup.attributesDes.find(function (element) {\n            return element.name == 'longitude';\n          });\n\n          if (find) {\n            find.value = province.label + \",\" + city.label + \",\" + district.label;\n            var keyword = province.label + \" \" + city.label + \" \" + district.label;\n            promise.then(function success(event) {\n              localSearch = event;\n              scope.getLocation = \"获取地址中...\";\n              localSearch.search(keyword);\n              localSearch.setSearchCompleteCallback(function (searchResult) {\n                scope.$apply(finishApply);\n\n                function finishApply() {\n                  scope.getLocation = undefined;\n\n                  if (searchResult.wr[0]) {\n                    var lat = searchResult.wr[0].point.lat;\n                    var lng = searchResult.wr[0].point.lng;\n                    var latitude = scope.equipment.modelGroup.attributesDes.find(function (element) {\n                      return element.name == 'latitude';\n                    });\n                    latitude.value = lat;\n                    var longitude = scope.equipment.modelGroup.attributesDes.find(function (element) {\n                      return element.name == 'longitude';\n                    });\n                    longitude.value = lng;\n                  }\n\n                  ;\n                }\n              });\n            }, function error(error) {\n              scope.getLocation = \"N/A\";\n            });\n          }\n        }\n      }\n    };\n    var $models = {\n      getAll: function getAll() {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.cached) {\n          deferred.resolve(cur.cached);\n        } else {\n          resourceUIService.getModels(function (event) {\n            if (event.code == '0') {\n              cur.cached = event.data;\n              deferred.resolve(event.data);\n            } else {\n              deferred.reject(event.message);\n            }\n          });\n        }\n\n        return deferred.promise;\n      }\n    };\n    var $DeviceGroupModels = {\n      get: function get() {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.cached) {\n          deferred.resolve(cached);\n        } else {\n          resourceUIService.getDeviceGroupModels(function (event) {\n            try {\n              if (event.code == 0) {\n                cur.cached = event.data;\n                /* Group Model Defination */\n\n                deferred.resolve(event.data);\n              } else {\n                throw event.message;\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          });\n        }\n\n        return deferred.promise;\n      }\n    };\n\n    require(['commonlib'], function (lib) {\n      //scope.userInfo = userInfo.getUserInfo();\n      scope.kpiIcon = kpiIcon;\n      scope.sensorIcon = sensorIcon;\n      scope.prevStep_Btn = prevStep_Btn;\n      scope.renderImage = renderImage;\n      scope.accomplished = accomplished;\n      scope.bgSel_click = bgSel_click;\n      scope.createNewGraph = createNewGraph;\n      scope.renderBgImg = renderBgImg;\n      scope.bgSelect = bgSelect;\n      scope.backgroundImage = '';\n      scope.equipment = Object.create({});\n      scope.backgroundImage = [{\n        id: 1,\n        path: \"images/topo/topo_bg1.png\"\n      }, {\n        id: 2,\n        path: \"images/topo/topo_bg2.jpg\"\n      }, {\n        id: 3,\n        path: \"images/topo/topo_bg3.jpg\"\n      }];\n\n      if (route.current) {\n        run();\n      } else {\n        rootScope.$on(\"locChanges\", function () {\n          run();\n        });\n      }\n\n      function dropDeviceGroup(ui, offset) {\n        var model, resource, kpi;\n        var draggable = $(ui.draggable);\n        var modelId = draggable.attr(\"model\");\n        var kpiId = draggable.attr(\"kpi\");\n        var resourceId = draggable.attr(\"resource\");\n        model = scope.models.find(function (model) {\n          return model.id == modelId;\n        });\n        resource = model.resourcesArray.find(function (resource) {\n          return resource.id == resourceId;\n        });\n        kpi = resource.kpiArray.find(function (kpi) {\n          return kpi.id == kpiId;\n        });\n        kpi.show = false;\n        var object = Object.create({\n          remove: function remove() {\n            var cur = this;\n            cur.kpi.show = true;\n            scope.receivedList = scope.receivedList.filter(function (received) {\n              return received != cur;\n            });\n          }\n        }, {\n          kpiSource: {\n            value: kpi,\n            enumerable: false\n          },\n          title: {\n            value: kpi.label,\n            enumerable: true,\n            writable: true\n          },\n          instance: {\n            value: kpi.label,\n            enumerable: true,\n            writable: true\n          },\n          resource: {\n            value: resource,\n            enumerable: true,\n            writable: true\n          },\n          model: {\n            value: model,\n            enumerable: true\n          },\n          kpi: {\n            value: kpi,\n            enumerable: true\n          },\n          top: {\n            value: ui.offset.top - offset.top,\n            enumerable: true\n          },\n          left: {\n            value: ui.offset.left - offset.left,\n            enumerable: true\n          }\n        });\n\n        if (scope.receivedList) {\n          scope.receivedList.push(object);\n        } else {\n          scope.receivedList = [object];\n        }\n      }\n\n      ;\n\n      function dropDevice(ui, offset) {\n        var model, resource, kpi;\n        var draggable = $(ui.draggable);\n        var modelId = draggable.attr(\"model\");\n        var kpiId = draggable.attr(\"kpi\");\n        var resourceId = draggable.attr(\"resource\");\n        model = scope.models.find(function (model) {\n          return model.id == modelId;\n        });\n        resource = scope.resources.find(function (resource) {\n          return resource.id == resourceId;\n        });\n        kpi = resource.kpiArray.find(function (kpi) {\n          return kpi.id == kpiId;\n        });\n        kpi.show = false;\n        var object = Object.create({\n          remove: function remove() {\n            var cur = this;\n            cur.kpi.show = true;\n            scope.receivedList = scope.receivedList.filter(function (received) {\n              return received != cur;\n            });\n          }\n        }, {\n          kpiSource: {\n            value: kpi,\n            enumerable: false\n          },\n          title: {\n            value: kpi.label,\n            enumerable: true,\n            writable: true\n          },\n          instance: {\n            value: kpi.label,\n            enumerable: true,\n            writable: true\n          },\n          resource: {\n            value: resource,\n            enumerable: true,\n            writable: true\n          },\n          model: {\n            value: model,\n            enumerable: true\n          },\n          kpi: {\n            value: kpi,\n            enumerable: true\n          },\n          top: {\n            value: ui.offset.top - offset.top,\n            enumerable: true\n          },\n          left: {\n            value: ui.offset.left - offset.left,\n            enumerable: true\n          }\n        });\n\n        if (scope.receivedList) {\n          scope.receivedList.push(object);\n        } else {\n          scope.receivedList = [object];\n        }\n      }\n\n      ;\n\n      function rArrList(data) {\n        var cur = this;\n\n        for (var i in data) {\n          cur[i] = data[i];\n        }\n      }\n\n      rArrList.prototype.remove = function () {\n        var cur = this,\n            findKpi;\n        scope.receivedList = scope.receivedList.filter(function (received) {\n          return received != cur;\n        });\n\n        if (cur.resource) {\n          findKpi = cur.resource.kpiArray.find(function (element) {\n            return element.id == cur.kpi.id;\n          });\n          findKpi.show = true;\n        }\n      };\n\n      function dropDeviceGroupModel(ui, offset) {\n        var model, kpi;\n        var draggable = $(ui.draggable);\n        var modelId = draggable.attr(\"model\");\n        var kpiId = draggable.attr(\"kpi\");\n        model = scope.models.find(function (model) {\n          return model.id == modelId;\n        });\n        kpi = model.kpiArrays.find(function (kpi) {\n          return kpi.id == kpiId;\n        });\n        kpi.show = false;\n        var object = new rArrList({\n          kpiSource: kpi,\n          title: kpi.label,\n          instance: kpi.label,\n          model: model,\n          kpi: kpi,\n          top: ui.offset.top - offset.top,\n          left: ui.offset.left - offset.left\n        });\n\n        if (scope.receivedList) {\n          scope.receivedList.push(object);\n        } else {\n          scope.receivedList = [object];\n        }\n      }\n\n      function run() {\n        var params = route.current.params;\n        scope.equipment.DeviceMode = params.mode;\n\n        if (params.mode == \"deviceGroup\") {\n          scope.onDrop = dropDeviceGroup;\n        } else if (params.mode == \"deviceGroupModel\" || params.mode == \"deviceModel\") {\n          scope.onDrop = dropDeviceGroupModel;\n        } else if (params.mode == \"device\") {\n          scope.onDrop = dropDevice;\n        }\n\n        id = parseInt(params.id);\n        solutionId = parseInt(params.solutionId);\n\n        if (scope.equipment.DeviceMode == 'deviceGroupModel' || scope.equipment.DeviceMode == 'deviceModel') {\n          scope.back = backsolution;\n        } else {\n          scope.back = backService;\n        }\n\n        flag = params.flag;\n        viewFlexService.getAllMyViews(function (event) {\n          try {\n            if (event.code == '0') {\n              if (event.data instanceof Array) {\n                currentView = event.data.find(function (element) {\n                  var dt = {};\n\n                  if (element.content != null && element.content != undefined) {\n                    dt = JSON.parse(element.content);\n                  }\n\n                  element.JSON = dt;\n                  if (dt) return id ? id == dt.nodeId : false;\n                });\n              }\n\n              if (currentView) {\n                scope.bgImgId = currentView.JSON ? currentView.JSON.bgImgId : undefined;\n                scope.equipment.label = currentView.JSON.label;\n              }\n\n              getSimpleDistricts.then(function success(event) {\n                if (event.code == 0) {\n                  scope.$Address.all = event.data;\n\n                  if (scope.equipment.DeviceMode == 'device') {\n                    if (currentView) {\n                      scope.saveAndExit = updateAsDevice;\n                      runAsDevice.call(scope, id, currentView.JSON.elements);\n                    } else {\n                      scope.saveAndExit = saveAsDevice;\n                      runAsDevice.call(scope, id);\n                    }\n                  } else if (scope.equipment.DeviceMode == 'deviceModel') {\n                    if (currentView) {\n                      scope.saveAndExit = saveAsDeviceModel;\n                      runAsDeviceModel.call(scope, id, currentView.JSON.elements);\n                    } else {\n                      scope.saveAndExit = saveAsDeviceModel;\n                      runAsDeviceModel.call(scope, id);\n                    }\n                  } else if (scope.equipment.DeviceMode == 'deviceGroup') {\n                    if (currentView) {\n                      scope.saveAndExit = updateAsDeviceGroup;\n                      runAsDeviceGroup.call(scope, id, currentView.JSON.elements);\n                    } else {\n                      scope.saveAndExit = saveAsDeviceGroup;\n                      runAsDeviceGroup.call(scope, id);\n                    }\n                  } else if (scope.equipment.DeviceMode == 'deviceGroupModel') {\n                    if (currentView) {\n                      scope.saveAndExit = saveAsDeviceGroupModel;\n                      runAsDeviceGroupModel.call(scope, id, currentView.JSON.elements);\n                    } else {\n                      scope.saveAndExit = saveAsDeviceGroupModel;\n                      runAsDeviceGroupModel.call(scope, id);\n                    }\n                  }\n                } else {\n                  throw event.message;\n                }\n              }, function error(err) {});\n            } else {\n              throw event.message;\n            }\n          } catch (err) {}\n        });\n      }\n\n      function saveAsDeviceModel() {\n        var data = [];\n\n        if (scope.receivedList instanceof Array) {\n          data = scope.receivedList.map(function (element) {\n            return {\n              instance: element.instance,\n              top: element.top,\n              left: element.left,\n              kpi: {\n                label: element.kpi.label,\n                id: element.kpi.id,\n                icon: element.kpi.icon,\n                nodeId: element.kpi.nodeId\n              },\n              model: {\n                label: element.model.label,\n                id: element.model.id\n              }\n            };\n          });\n        }\n\n        var content = {\n          bgImgId: scope.bgImgId,\n          elements: data\n        };\n        solutionUIService.saveServiceViewContent(solutionId, 0, JSON.stringify(content), callback);\n\n        function callback(event) {\n          window.location.href = \"../app-ac/index.html#/myView\";\n        }\n      }\n\n      ;\n\n      function saveAsDeviceGroupModel() {\n        var data = [];\n\n        if (scope.receivedList instanceof Array) {\n          data = scope.receivedList.map(function (element) {\n            return {\n              instance: element.instance,\n              top: element.top,\n              left: element.left,\n              kpi: {\n                label: element.kpi.label,\n                id: element.kpi.id,\n                icon: element.kpi.icon,\n                nodeId: element.kpi.nodeId\n              },\n              model: {\n                label: element.model.label,\n                id: element.model.id\n              }\n            };\n          });\n        }\n\n        var content = {\n          bgImgId: scope.bgImgId,\n          elements: data\n        };\n        solutionUIService.saveServiceViewContent(solutionId, id, 0, JSON.stringify(content), callback);\n\n        function callback(event) {\n          window.location.href = \"../app-ac/index.html#/myView\";\n        }\n      }\n\n      ;\n\n      function runAsDevice(nodeId, receivedList) {\n        var modelId,\n            temlateView,\n            resources = [];\n        scope.step = 1;\n        scope.receivedList = receivedList ? receivedList : [];\n        scope.receivedList = scope.receivedList.map(function (element) {\n          return new rArrList(element);\n        });\n        getServiceViewMap();\n        getResource();\n\n        if ($.isArray(scope.receivedList)) {\n          if (scope.receivedList.length > 0) {\n            scope.receivedList = receivedList ? receivedList : [];\n            scope.receivedList = scope.receivedList.map(function (element) {\n              return new rArrList(element);\n            });\n            getResource();\n          } else {\n            getServiceViewMap();\n          }\n        } else {\n          getServiceViewMap();\n        }\n\n        function getServiceViewMap() {\n          viewFlexService.getServiceViewMap(function (event) {\n            var content = {};\n\n            if (event.code == \"0\") {\n              temlateView = event.data;\n            }\n          });\n          getResource();\n        }\n\n        function getResource() {\n          resourceUIService.getResourceById(nodeId, function (event) {\n            try {\n              if (event.code == '0') {\n                scope.equipment.device = event.data;\n                resources = [event.data].map(function (element) {\n                  return {\n                    id: element.id,\n                    gatewayId: element.gatewayId,\n                    label: element.label,\n                    show: true\n                  };\n                });\n                modelId = event.data.modelId;\n\n                if (typeof temlateView[modelId] == 'string') {\n                  var objectLike = /\\{.*\\}/;\n\n                  if (objectLike.test(temlateView[modelId])) {\n                    content = JSON.parse(temlateView[modelId]);\n                  }\n\n                  scope.receivedList = content.elements.map(function (element) {\n                    return new rArrList(element);\n                  });\n                  scope.bgImgId = content.bgImgId;\n                }\n\n                resourceUIService.getModelByIds([modelId], function (returnObj) {\n                  if (returnObj.code == \"0\") {\n                    scope.models = returnObj.data;\n                  }\n                });\n                resourceUIService.getKpisByModelId(modelId, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    resources.forEach(function (res) {\n                      res.fold = true;\n                      res.kpiArray = [];\n                      returnObj.data.forEach(function (kpi) {\n                        var used = scope.receivedList.some(function (userkpi) {\n                          return kpi.id == userkpi.kpi.id;\n                        });\n                        kpi.show = !used;\n                        res.kpiArray.push(kpi);\n                      });\n                    });\n                  }\n\n                  scope.resources = resources;\n\n                  for (var i in scope.receivedList) {\n                    (function (index, element) {\n                      var find = resources.find(function (elem) {\n                        return element.resource.id == elem.id;\n                      });\n\n                      if (find) {\n                        element.resource = find;\n                      }\n\n                      ;\n                    })(i, scope.receivedList[i]);\n                  }\n                });\n              } else {\n                throw event.message;\n              }\n            } catch (err) {}\n          });\n        }\n      }\n\n      function runAsDeviceModel(deviceModelId) {\n        solutionUIService.getServiceViewContent(solutionId, 0, deviceModelId, function (event) {\n          var content = {};\n\n          if (event.code == \"0\") {\n            if (typeof event.data == 'string') {\n              var objectLike = /\\{.*\\}/;\n\n              if (objectLike.test(event.data)) {\n                content = JSON.parse(event.data);\n              }\n            }\n\n            if (content.elements) {\n              scope.receivedList = content.elements.map(function (element) {\n                return new rArrList(element);\n              });\n            }\n\n            scope.bgImgId = content.bgImgId;\n          }\n        });\n        scope.step = 1;\n        resourceUIService.getModelByIds([deviceModelId], callback);\n\n        function callback(event) {\n          try {\n            if (event.code == \"0\") {\n              scope.models = event.data;\n\n              for (var i in scope.models) {\n                (function (index, element) {\n                  element.fold = true;\n                  serviceCenterService.kpis.getBymodelId(element.id).then(function (data) {\n                    element.kpiArrays = data;\n                  });\n                })(i, scope.models[i]);\n              }\n            } else {\n              throw event.message;\n            }\n          } catch (err) {}\n        }\n\n        ;\n        /* 2016 - 05 - 31\n         resourceUIService.getModelsByGroupId(deviceGroupModelId, callback);\n         function callback(event){\n         try {\n         if (event.code == '0') {\n         deferred.resolve(event.data)\n         } else {\n         throw event.message;\n         }\n         } catch (err) {\n          \n         }\n         }\n         */\n        //resourceUIService.getAttrsByModelId\n      }\n\n      function runAsDeviceGroupModel(deviceGroupModelId) {\n        /* 2016 - 05 - 31\n        var modelGroup = {\n        \tid : deviceGroupModelId\n        };\n        $modelGroup.call(modelGroup, undefined).then(function success(modelGroup) {\n        \tscope.equipment.modelGroup = modelGroup;\n        \t \n        });\n        */\n        solutionUIService.getServiceViewContent(solutionId, deviceGroupModelId, 0, function (event) {\n          var content = {};\n\n          if (event.code == \"0\") {\n            if (typeof event.data == 'string') {\n              var objectLike = /\\{.*\\}/;\n\n              if (objectLike.test(event.data)) {\n                content = JSON.parse(event.data);\n              }\n            }\n\n            if (content.elements) {\n              scope.receivedList = content.elements.map(function (element) {\n                return new rArrList(element);\n              });\n            }\n\n            scope.bgImgId = content.bgImgId;\n          }\n        });\n        scope.step = 1;\n        solutionUIService.getModelsByGroupId(solutionId, deviceGroupModelId, callback);\n\n        function callback(event) {\n          try {\n            if (event.code == \"0\") {\n              scope.models = event.data;\n\n              for (var i in scope.models) {\n                (function (index, element) {\n                  element.fold == true;\n\n                  element.unfold = function () {\n                    var cur = this;\n                    var bool = !cur.fold;\n\n                    for (var j in scope.models) {\n                      scope.models[j].fold = false;\n                    }\n\n                    cur.fold = bool;\n                  };\n\n                  serviceCenterService.kpis.getBymodelId(element.id).then(function (data) {\n                    element.kpiArrays = data;\n                  });\n                })(i, scope.models[i]);\n              }\n            } else {\n              throw event.message;\n            }\n          } catch (err) {}\n        }\n\n        ;\n        /* 2016 - 05 - 31\n        resourceUIService.getModelsByGroupId(deviceGroupModelId, callback);\n        function callback(event){\n        \ttry {\n        \t\tif (event.code == '0') {\n        \t\t\tdeferred.resolve(event.data)\n        \t\t} else {\n        \t\t\tthrow event.message;\n        \t\t}\n        \t} catch (err) {\n        \t\t \n        \t}\n        }\n        */\n        //resourceUIService.getAttrsByModelId\n      }\n\n      function runAsDeviceGroup(deviceGroupId, receivedList) {\n        var deviceGroupModelId;\n        var deferred = q.defer();\n        var promise = deferred.promise;\n        var curRes;\n        scope.receivedList = receivedList ? receivedList : [];\n        scope.receivedList = scope.receivedList.map(function (element) {\n          return new rArrList(element);\n        });\n        var modelIdused;\n\n        if (deviceGroupId) {\n          resourceUIService.getResourceById(deviceGroupId, function (event) {\n            try {\n              if (event.code == '0') {\n                deferred.resolve(event.data);\n              } else {\n                throw event.message;\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          });\n        } else {\n          deferred.resolve(undefined);\n        }\n\n        promise.then(function success(resource) {\n          curRes = resource;\n          $DeviceGroupModels.get().then(function success(data) {\n            for (var i in data) {\n              (function (index, element) {\n                attrsFn.call(element);\n              })(i, data[i]);\n            }\n\n            scope.modelGroups = data;\n\n            if (resource != undefined) {\n              var find = scope.modelGroups.find(function (element) {\n                return element.id == resource.modelId && resource.modelId != undefined;\n              });\n\n              if (find) {\n                scope.equipment.modelGroup = find;\n              } else {\n                scope.equipment.modelGroup = scope.modelGroups[0];\n              }\n\n              scope.equipment.modelGroup.onChange();\n            }\n\n            if (scope.equipment.modelGroup) {\n              $modelGroup.call(scope.equipment.modelGroup, resource ? resource.values : undefined).then(function success(modelGroup) {});\n            }\n          }, function error(err) {});\n        }, function error(err) {});\n\n        function attrsFn() {\n          var cur = this;\n\n          cur.onChange = function () {\n            $modelGroup.call(scope.equipment.modelGroup);\n            viewFlexService.getServiceViewMap(function (event) {\n              var content = {};\n\n              if (event.code == \"0\") {\n                if (typeof event.data[cur.id] == 'string') {\n                  var objectLike = /\\{.*\\}/;\n\n                  if (objectLike.test(event.data[cur.id])) {\n                    content = JSON.parse(event.data[cur.id]);\n                  }\n\n                  if (!id) {\n                    scope.receivedList = content.elements.map(function (element) {\n                      return new rArrList(element);\n                    });\n                  }\n                  /*\n                  for(var i in receivedList)\n                  {\n                  \tvar modelId = receivedList[i].model.id;\n                  \tvar kpiId = receivedList[i].kpi.id;\n                  \tvar find = scope.receivedList.some(function(elem){\n                  \t\t \n                  \t\treturn elem.model.id == modelId && elem.kpi.id == kpiId\n                  \t});\n                  \t\tif(!find)\n                  \t{\n                  \t\tscope.receivedList.push(receivedList[i]);\n                  \t}\n                  }\n                  */\n\n\n                  scope.bgImgId = content.bgImgId;\n                }\n              }\n            });\n          };\n        }\n\n        scope.nextStep = function () {\n          var defers = [];\n          scope.step = 1; //viewFlexService.getServiceViewMap(callback);\n\n          if (solutionId != 0) {\n            resourceUIService.getModels(callback);\n          } else {\n            $models.getAll().then(function (data) {\n              callback({\n                code: '0',\n                data: data\n              });\n            });\n          }\n\n          function callback(event) {\n            if (event.data instanceof Array) {\n              scope.models = event.data;\n            } else {\n              scope.models = [];\n            } //---------------if model does not exist, must query the model and fill into the list.----------------------\n            //---------------and remove those devices which cannot be found in the list --------------------------------\n\n\n            var clone = [];\n\n            for (var i in scope.receivedList) {\n              (function (index, ele) {\n                if (_typeof(ele.model) != \"object\" || ele.model == null) {\n                  if (_typeof(ele.resource) == \"object\" && ele.resource != null) {\n                    var resourceId = ele.resource.id;\n                    resourceUIService.getResourceById(resourceId, function (event) {\n                      if (event.code == \"0\") {\n                        var find = scope.models.find(function (element) {\n                          if (event.data != null) {\n                            return element.id == event.data.modelId;\n                          } else {\n                            return false;\n                          }\n                        });\n\n                        if (find) {\n                          ele.model = {\n                            id: find.id,\n                            label: find.label\n                          };\n                        }\n                      }\n                    });\n                  }\n                }\n              })(i, scope.receivedList[i]);\n            } //----------------------------------------------------------------------------------------------------------\n\n\n            if (event.code == \"0\") {\n              for (var i in scope.models) {\n                var defer = q.defer();\n                defers.push(defer.promise);\n\n                (function (index, element, defer) {\n                  var modelId = element.id;\n                  element.fold == false;\n\n                  element.unfold = function () {\n                    var cur = this;\n                    var bool = !cur.fold;\n\n                    for (var j in scope.models) {\n                      scope.models[j].fold = false;\n                    }\n\n                    cur.fold = bool;\n                  };\n\n                  serviceCenterService.resources.getBymodelId(modelId).then(function success(data) {\n                    element.resourcesArray = data.map(function (element) {\n                      return {\n                        id: element.id,\n                        gatewayId: element.gatewayId,\n                        label: element.label,\n                        show: true,\n                        fold: false,\n                        unfold: unfold\n                      };\n                    });\n\n                    function unfold() {\n                      var cur = this;\n                      var bool = !cur.fold;\n\n                      for (var j in element.resourcesArray) {\n                        element.resourcesArray[j].fold = false;\n                      }\n\n                      cur.fold = bool;\n                    }\n\n                    ;\n                    serviceCenterService.kpis.getBymodelId(modelId).then(function success(data) {\n                      // \n                      for (var i in element.resourcesArray) {\n                        (function (index, res) {\n                          res.kpiArray = data.map(function (kpi) {\n                            var result = {},\n                                received;\n                            var received = scope.receivedList.find(function (element) {\n                              if (element.resource) {\n                                return element.resource.id == res.id && element.kpi.id == kpi.id;\n                              } else {\n                                return false;\n                              }\n                            });\n                            result = {\n                              show: received == undefined,\n                              icon: kpi.icon,\n                              nodeId: res.id,\n                              id: kpi.id,\n                              label: kpi.label\n                            };\n                            return result;\n                          });\n                          var findRes = scope.receivedList.filter(function (element) {\n                            if (element.resource) {\n                              // \n                              return element.resource.id == res.id;\n                            } else {\n                              return false;\n                            }\n                          });\n\n                          if (findRes) {\n                            for (var j in findRes) {\n                              findRes[j].resource.kpiArray = res.kpiArray;\n                            }\n                          }\n                        })(index, element.resourcesArray[i]);\n                      } //resource.kpis = data;\n                      //Array.prototype.push.apply(resources, resource);\n\n\n                      defer.resolve(\"success\");\n                      /*\n                       resourceUIService.getCanRelatedToGroupDevicesByModelId(modelId, function(event){\n                      \t });\n                       */\n                    }, function error(err) {});\n                  }, function error(err) {});\n                })(i, scope.models[i], defer);\n              }\n\n              q.all(defers).then(function success(data) {\n                //remove Array from list which is not found in resource list.\n                scope.receivedList = scope.receivedList.filter(function (element) {\n                  var modelId = element.model.id;\n                  var find = scope.models.some(function (element) {\n                    return element.id == modelId;\n                  });\n                  return find;\n                  /*\n                  if(typeof element.resource == 'object' && element.resource != null)\n                  {\n                  \treturn element.resource.kpiArray != undefined;\n                  }\n                  else\n                  {\n                  \treturn false;\n                  }\n                  */\n                }); //scope.resources = resources;\n\n                /*\n                scope.receivedList = scope.receivedList.filter(function(element) {\n                \treturn resources.find(function(el) {\n                \t\treturn el.id == element.resource.id\n                \t});\n                });\n                */\n              }, function error(err) {});\n            }\n          }\n          /*\n          $models.getAll().then(function success(data) {\n          \tvar defers = [];\n          }, function error(err) {\n          \t \n          });\n          */\n\n        };\n      }\n      /* 2016 - 05 - 31*/\n\n\n      function saveAsDevice() {\n        var data = scope.receivedList.map(function (element) {\n          return {\n            instance: element.instance,\n            top: element.top,\n            left: element.left,\n            kpi: {\n              label: element.kpi.label,\n              id: element.kpi.id,\n              icon: element.kpi.icon,\n              nodeId: element.kpi.nodeId\n            },\n            resource: {\n              label: element.resource.label,\n              id: element.resource.id\n            }\n          };\n        });\n        var content = {\n          nodeId: scope.resources[0].id,\n          bgImgId: scope.bgImgId,\n          elements: data\n        };\n        var param = {\n          viewTitle: scope.resources[0].label,\n          viewName: \"topology\",\n          viewType: \"topology\",\n          content: JSON.stringify(content)\n        };\n        viewFlexService.addView(param, function (event) {\n          if (event.code == 0) {\n            window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n          }\n        });\n      }\n\n      function updateAsDevice() {\n        var data = scope.receivedList.map(function (element) {\n          return {\n            instance: element.instance,\n            top: element.top,\n            left: element.left,\n            kpi: {\n              label: element.kpi.label,\n              id: element.kpi.id,\n              icon: element.kpi.icon,\n              nodeId: element.kpi.nodeId\n            },\n            resource: {\n              label: element.resource.label,\n              id: element.resource.id\n            }\n          };\n        });\n        var content = {\n          nodeId: currentView.JSON.nodeId,\n          bgImgId: scope.bgImgId,\n          elements: data\n        };\n        var param = {\n          viewId: currentView.viewId,\n          originalViewId: 0,\n          viewTitle: scope.resources[0].label,\n          viewName: \"topology\",\n          viewType: \"topology\",\n          content: JSON.stringify(content)\n        };\n        viewFlexService.updateView(param, function (event) {\n          if (event.code == 0) {\n            window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n          }\n        });\n      }\n\n      function saveAsDeviceGroup() {\n        hasEmpty = scope.receivedList.some(function (element) {\n          return element.resource != undefined && element.resource != null;\n        });\n\n        if (hasEmpty) {\n          scope.msg = {\n            title: \"有未绑定数据标签\",\n            content: \"有标签未绑定数据，保存之后这些标签将被删除，是否继续？\",\n            btnlist: [{\n              text: \"取消\",\n              fn: cancelDataFn\n            }, {\n              text: \"继续\",\n              fn: saveDataFn\n            }]\n          };\n        } else {\n          saveDataFn();\n        }\n\n        function cancelDataFn() {\n          scope.msg = undefined;\n        }\n\n        function saveDataFn() {\n          var deviceGroup = {};\n          scope.equipment.modelGroup.attributesDes;\n\n          for (var i in scope.equipment.modelGroup.attributesDes) {\n            (function (index, element) {\n              var attrName = element.name;\n\n              if (scope.equipment.modelGroup.values == undefined) {\n                scope.equipment.modelGroup.values = {};\n              }\n\n              scope.equipment.modelGroup.values[attrName] = element.value;\n            })(i, scope.equipment.modelGroup.attributesDes[i]);\n          }\n\n          scope.equipment.modelGroup.modelId = scope.equipment.modelGroup.id;\n\n          for (var j in scope.equipment.modelGroup) {\n            (function (attr, val) {\n              deviceGroup[attr] = val;\n            })(j, scope.equipment.modelGroup[j]);\n          }\n\n          ;\n          scope.receivedList = scope.receivedList.filter(function (element) {\n            return element.resource != undefined && element.resource != null;\n          });\n          var data = scope.receivedList.map(function (element) {\n            return {\n              title: element.title,\n              instance: element.instance,\n              top: element.top,\n              left: element.left,\n              model: {\n                label: element.model.label,\n                id: element.model.id\n              },\n              kpi: {\n                label: element.kpi.label,\n                id: element.kpi.id,\n                icon: element.kpi.icon,\n                nodeId: element.kpi.nodeId\n              },\n              resource: {\n                label: element.resource.label,\n                id: element.resource.id\n              }\n            };\n          });\n          resourceUIService.saveDeviceGroup(deviceGroup, function (event) {\n            try {\n              if (event.code == '0') {\n                var deviceGroupId = event.data.id;\n                deviceToGroup = scope.receivedList.map(function (element) {\n                  return {\n                    label: element.label,\n                    deviceGroupId: deviceGroupId,\n                    deviceId: element.resource.id,\n                    kpiId: element.kpi.id\n                  };\n                });\n                resourceUIService.saveDeviceToGroups(deviceGroupId, deviceToGroup, function (event) {\n                  try {\n                    if (event.code == '0') {\n                      var content = {\n                        label: scope.equipment.label,\n                        nodeId: deviceGroupId,\n                        bgImgId: scope.bgImgId,\n                        elements: data\n                      };\n                      var param = {\n                        viewTitle: \"topology\",\n                        viewName: \"topology\",\n                        viewType: \"topology\",\n                        content: JSON.stringify(content)\n                      };\n                      viewFlexService.addView(param, function (event) {\n                        if (event.code == 0) {\n                          window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n                        } else {\n                          throw event.message;\n                        }\n                      });\n                    } else {\n                      throw event.message;\n                    }\n                  } catch (err) {}\n                });\n              } else {\n                throw event.message;\n              }\n            } catch (err) {}\n          });\n        }\n      }\n\n      function updateAsDeviceGroup() {\n        var deviceGroup = {};\n        scope.equipment.modelGroup.attributesDes;\n\n        for (var i in scope.equipment.modelGroup.attributesDes) {\n          (function (index, element) {\n            var attrName = element.name;\n\n            if (scope.equipment.modelGroup.values == undefined) {\n              scope.equipment.modelGroup.values = {};\n            }\n\n            scope.equipment.modelGroup.values[attrName] = element.value;\n          })(i, scope.equipment.modelGroup.attributesDes[i]);\n        }\n\n        scope.equipment.modelGroup.modelId = scope.equipment.modelGroup.id;\n\n        for (var j in scope.equipment.modelGroup) {\n          (function (attr, val) {\n            deviceGroup[attr] = val;\n          })(j, scope.equipment.modelGroup[j]);\n        }\n\n        ;\n        deviceGroup.id = parseInt(id);\n        var data = scope.receivedList.map(function (element) {\n          var result = {\n            instance: element.instance,\n            top: element.top,\n            left: element.left,\n            kpi: {\n              label: element.kpi.label,\n              id: element.kpi.id,\n              icon: element.kpi.icon,\n              nodeId: element.kpi.nodeId\n            },\n            resource: {\n              label: element.resource.label,\n              id: element.resource.id\n            }\n          };\n\n          if (element.model) {\n            result.model = {\n              label: element.model.label,\n              id: element.model.id\n            };\n          } else {}\n\n          return result;\n        });\n        resourceUIService.saveDeviceGroup(deviceGroup, function (event) {\n          try {\n            if (event.code == '0') {\n              var deviceGroupId = event.data.id;\n              deviceToGroup = scope.receivedList.map(function (element) {\n                return {\n                  label: element.label,\n                  deviceGroupId: deviceGroupId,\n                  deviceId: element.resource.id,\n                  kpiId: element.kpi.id\n                };\n              });\n              resourceUIService.saveDeviceToGroups(deviceGroupId, deviceToGroup, function (event) {\n                try {\n                  if (event.code == '0') {\n                    var content = {\n                      label: scope.equipment.label,\n                      nodeId: deviceGroupId,\n                      bgImgId: scope.bgImgId,\n                      elements: data\n                    };\n                    var param = {\n                      viewId: currentView.viewId,\n                      originalViewId: 0,\n                      viewTitle: \"topology\",\n                      viewName: \"topology\",\n                      viewType: \"topology\",\n                      content: JSON.stringify(content)\n                    };\n                    viewFlexService.updateView(param, function (event) {\n                      if (event.code == 0) {\n                        window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n                      } else {\n                        throw event.message;\n                      }\n                    });\n                  } else {\n                    throw event.message;\n                  }\n                } catch (err) {}\n              });\n            } else {\n              throw event.message;\n            }\n          } catch (err) {}\n        });\n      }\n\n      function bgSelect(path) {\n        var css = {\n          \"background-image\": \"url(../\" + path + \")\"\n        };\n        return css;\n      }\n\n      ;\n\n      function renderBgImg(path) {\n        return path ? {\n          \"background-image\": \"url(../\" + path + \")\"\n        } : {};\n      }\n\n      function kpiIcon(channelType) {\n        switch (channelType) {\n          case \"temperature\":\n            return {\n              \"background-image\": \"url(images/elementIcon/are_temp.svg)\"\n            };\n            break;\n\n          case \"humidity\":\n            return {\n              \"background-image\": \"url(images/elementIcon/area_humid.svg)\"\n            };\n            break;\n\n          default:\n            return {\n              \"background-image\": \"url(images/elementIcon/are_temp.svg)\"\n            };\n            break;\n        }\n      }\n\n      function sensorIcon(channelType) {\n        switch (channelType) {\n          case \"temperature\":\n            return {\n              \"background-image\": \"url(images/elementIcon/are_temp.svg)\"\n            };\n            break;\n\n          case \"humidity\":\n            return {\n              \"background-image\": \"url(images/elementIcon/area_humid.svg)\"\n            };\n            break;\n\n          default:\n            return {\n              \"background-image\": \"url(images/elementIcon/are_temp.svg)\"\n            };\n            break;\n        }\n      }\n\n      function renderImage(id, kpis) {\n        var unit;\n\n        for (var i in kpis) {\n          if (id == kpis[i].id) {\n            unit = kpis[i].unit;\n          }\n        }\n\n        switch (unit) {\n          case \"Amount\":\n            return {\n              \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n            };\n            break;\n\n          case \"Temperature\":\n            return {\n              \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n            };\n            break;\n\n          default:\n            return {};\n            break;\n        }\n      }\n\n      function createNewGraph() {\n        window.location.reload();\n      }\n\n      function backService() {\n        window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n      }\n\n      function backsolution() {\n        window.location.href = \"../app-ac/index.html#/myView\";\n      }\n\n      function accomplished() {\n        window.open(\"../../app/index_consumer.html#/dashboard3\", \"_self\");\n      }\n\n      function prevStep_Btn() {\n        scope.step = 0;\n      }\n\n      function bgSel_click(obj) {\n        scope.bgImgId = obj.path;\n      }\n\n      function randomString(len) {\n        len = len || 32;\n        var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';\n        var maxPos = $chars.length;\n        var pwd = '';\n\n        for (i = 0; i < len; i++) {\n          pwd += $chars.charAt(Math.floor(Math.random() * maxPos));\n        }\n\n        return pwd;\n      }\n    });\n  }]);\n});"],"sourceRoot":"/source/"}