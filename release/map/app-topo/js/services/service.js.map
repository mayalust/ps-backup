{"version":3,"sources":["app-topo/js/services/service.js"],"names":["define","angular","lib","module","run","rootScope","loc","route","$on","event","$broadcast","factory","user","setUserInfo","data","getUserInfo","gv","q","views","setviews","getviews","type","defer","then","resolve","error","reject","promise","current","params","viewsList","getViews","callback","kpiDataService","getUnits","getAllUnits","viewFlexService","getAllMyViews","resourceUIService","getSimpleDistricts","ids","deleteViews","resource","updateResource","id","getSensorChannelsByDeviceId","attrs","saveAttrs","getResourceById","list","saveSensorChannels","graphservice","getModels","getAllGateways","getAttrsByModelId","getKpisByModelId","getEmptySensorChannels","gateid","device","registerDevice","deviceid","unregisterDevice","activateDevice","userInfo","equipment","values","virtual","filter","gateway","managedStatus","gatewayid","domainId","domainPath","externalDevId","parseInt","Math","random","isEdit","label","modelId","model","onlineStatus","operationStatus","timeout","test","deferred","userLoginUIService","window","$$host","$$port","path","split","login_callback","logout_callback","login","item","name","password","e","logout","back","open","newProf","openProf","viewId","loginChecking_login","isAuthenticated","pass","location","href","loading","loginChecking_others","status"],"mappings":"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","file":"app-topo/js/services/service.js","sourcesContent":["define([\"angular\", \"commonlib\"], function (angular, lib) {\n  var module = angular.module(\"myapp\");\n  module.run([\"$rootScope\", \"$location\", \"$route\", function (rootScope, loc, route) {\n    rootScope.$on('$locationChangeSuccess', locationChangeSuccess);\n\n    function locationChangeSuccess(event) {\n      rootScope.$broadcast(\"locChanges\");\n    }\n  }]);\n  module.factory(\"userInfo\", function () {\n    var factory = {};\n    var user = '';\n    factory.setUserInfo = setUserInfo;\n    factory.getUserInfo = getUserInfo;\n\n    function setUserInfo(data) {\n      user = data;\n    }\n\n    function getUserInfo() {\n      return user;\n    }\n\n    return factory;\n  });\n  module.factory(\"viewsList\", [\"getviews\", \"$q\", \"$route\", function (gv, q, route) {\n    var factory = {};\n    var views;\n    factory.setviews = setviews;\n    factory.getviews = getviews;\n\n    function setviews() {\n      return views;\n    }\n\n    function getviews() {\n      if (views) {\n        return {\n          type: \"Array\",\n          data: views\n        };\n      } else {\n        var defer = q.defer();\n        gv.then(function success(event) {\n          views = event.data;\n          defer.resolve({\n            type: \"Promise\",\n            data: event.data\n          });\n        }, function error(error) {\n          defer.reject(error);\n        });\n        return defer.promise;\n      }\n    }\n\n    return factory;\n  }]);\n  module.factory(\"getParams\", [\"$route\", function (route) {\n    var factory = function factory() {\n      return route.current.params; //return parseInt(route.current.params.nodeId);\n    };\n\n    return factory;\n  }]);\n  module.factory(\"viewLoader\", [\"getviews\", \"$q\", \"$route\", \"viewsList\", function (getviews, q, route, viewsList) {\n    var factory = {};\n    factory.getViews = getViews;\n\n    function getViews(callback) {\n      getviews.then(function success(event) {\n        callback(event.data);\n      }, function error(error) {});\n    }\n\n    return factory;\n  }]);\n  module.factory(\"units\", [\"kpiDataService\", \"$q\", function (kpiDataService, q) {\n    var factory = {};\n    var defer = new q.defer();\n    factory.getUnits = getUnits;\n\n    function getUnits() {\n      return defer.promise;\n    }\n\n    kpiDataService.getAllUnits(function (event) {\n      defer.resolve(event);\n    });\n    return factory;\n  }]);\n  module.factory(\"getviews\", [\"viewFlexService\", \"$q\", function (viewFlexService, q) {\n    var defer = new q.defer();\n    factory = defer.promise;\n    viewFlexService.getAllMyViews(function (event) {\n      defer.resolve(event);\n    });\n    return factory;\n  }]);\n  module.factory(\"getSimpleDistricts\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var defer = new q.defer();\n    factory = defer.promise;\n    resourceUIService.getSimpleDistricts(function (event) {\n      defer.resolve(event);\n    });\n    return factory;\n  }]);\n  module.factory(\"deleteViews\", [\"kpiDataService\", \"$q\", function (kpiDataService, q) {\n    var factory = function factory(ids) {\n      var defer = new q.defer();\n      kpiDataService.deleteViews(ids, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"updateResource\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(resource) {\n      var defer = new q.defer();\n      resourceUIService.updateResource(resource, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"getSensorChannelsByDeviceId\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(id) {\n      var defer = new q.defer();\n      resourceUIService.getSensorChannelsByDeviceId(id, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"saveAttrs\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(id, attrs) {\n      var defer = new q.defer();\n      resourceUIService.saveAttrs(id, attrs, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"getResourceById\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(id) {\n      var defer = new q.defer();\n      resourceUIService.getResourceById(id, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"saveSensorChannels\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(list) {\n      var defer = new q.defer();\n      resourceUIService.saveSensorChannels(list, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"getModels\", [\"graphservice\", \"$q\", function (graphservice, q) {\n    var defer = new q.defer();\n    factory = defer.promise;\n    graphservice.getModels(function (event) {\n      defer.resolve(event);\n    });\n    return factory;\n  }]);\n  module.factory(\"getAllGateways\", ['resourceUIService', \"$q\", function (resourceUIService, q) {\n    var defer = new q.defer();\n    factory = defer.promise;\n    resourceUIService.getAllGateways(function (event) {\n      defer.resolve(event);\n    });\n    return factory;\n  }]);\n  module.factory(\"getAttrsByModelId\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(id) {\n      var defer = new q.defer();\n      resourceUIService.getAttrsByModelId(id, function (event) {\n        defer.resolve(event);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"getKpisByModelId\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(id) {\n      var defer = new q.defer();\n      resourceUIService.getKpisByModelId(id, function (event) {\n        defer.resolve(event);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"getSensorChannelsByDeviceId\", [\"resourceUIService\", \"$q\", \"getAllGateways\", function (resourceUIService, q, getAllGateways) {\n    var factory = function factory(id) {\n      var defer = new q.defer();\n      resourceUIService.getSensorChannelsByDeviceId(id, function (event) {\n        defer.resolve(event);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"getEmptySensorChannels\", [\"resourceUIService\", \"$q\", \"getAllGateways\", function (resourceUIService, q, getAllGateways) {\n    var factory = function factory() {\n      var defer = new q.defer();\n      resourceUIService.getEmptySensorChannels(function (event) {\n        defer.resolve(event);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"getAllGateways\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var defer = new q.defer();\n    factory = defer.promise;\n    resourceUIService.getAllGateways(function (event) {\n      defer.resolve(event);\n    }, function (error) {\n      defer.reject(error);\n    });\n    return factory;\n  }]);\n  module.factory(\"addNewGateway\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var defer = new q.defer();\n    factory = defer.promise;\n    ;\n    resourceUIService.getAllGateways(function (event) {\n      defer.resolve(event);\n    }, function (error) {\n      defer.reject(error);\n    });\n    return factory;\n  }]);\n  module.factory(\"registerDevice\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(gateid, device) {\n      var defer = new q.defer();\n      resourceUIService.registerDevice(gateid, device, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"unregisterDevice\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(gateid, deviceid) {\n      var defer = new q.defer();\n      resourceUIService.unregisterDevice(gateid, deviceid, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"activateDevice\", [\"resourceUIService\", \"$q\", function (resourceUIService, q) {\n    var factory = function factory(device) {\n      var defer = new q.defer();\n      resourceUIService.activateDevice(device, function (event) {\n        defer.resolve(event);\n      }, function (error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"addNewEquipment\", [\"getAllGateways\", \"registerDevice\", \"activateDevice\", \"$q\", \"userInfo\", function (getAllGateways, registerDevice, activateDevice, q, userInfo) {\n    var factory = function factory(equipment, values) {\n      var defer = new q.defer();\n      getAllGateways.then(function success(event) {\n        var virtual = event.data.filter(function (gateway) {\n          return gateway.type == \"virtual\" && gateway.managedStatus == \"active\";\n        })[0];\n\n        if (virtual) {\n          var gatewayid = virtual.id;\n          var domainpath = userInfo.getUserInfo().domainPath;\n          var device = {\n            domainId: '',\n            domainPath: domainpath,\n            externalDevId: randomNum(),\n            gatewayid: gatewayid,\n            id: 0,\n            isEdit: 2,\n            label: equipment.label,\n            managedStatus: \"deactive\",\n            modelId: equipment.model.id + \"\",\n            onlineStatus: \"offline\",\n            operationStatus: 0,\n            values: values\n          };\n          registerDevice(gatewayid, device).then(function success(event) {\n            activateDevice(event.data).then(function success(event) {\n              defer.resolve(event);\n            }, function error(error) {\n              defer.reject(error);\n            });\n          }, function error(error) {\n            defer.reject(error);\n          });\n        }\n      }, function error(error) {\n        defer.reject(error);\n      });\n      return defer.promise;\n    };\n\n    function randomNum() {\n      var result = parseInt(Math.random() * 1000000000000000);\n      return result;\n    }\n\n    return factory;\n  }]);\n  module.factory(\"ttt\", [\"$timeout\", \"$q\", function (timeout, q) {\n    var factory = {};\n\n    factory.test = function () {\n      var deferred = q.defer();\n      timeout(function () {\n        deferred.resolve(\"asdasd\");\n      }, 2000);\n      return deferred.promise;\n    };\n\n    return factory;\n  }]);\n  module.factory(\"loginManagement\", [\"$rootScope\", \"userLoginUIService\", \"$q\", \"$location\", \"$window\", \"$route\", \"userInfo\", \"$timeout\", function (rootScope, userLoginUIService, q, loc, window, route, userInfo, timeout) {\n    var factory = {};\n    var _HOST_ = loc.$$host;\n    var _PORT_ = loc.$$port;\n    var pathName = loc.path().split(\"/\")[1];\n    factory.login = login;\n    factory.logout = logout;\n    factory.back = back;\n    factory.newProf = newProf;\n    factory.openProf = openProf;\n    factory.loginChecking_login = loginChecking_login;\n    factory.loginChecking_others = loginChecking_others;\n\n    function login(item) {\n      var name = item.name;\n      var password = item.password;\n      userLoginUIService.login(name, password, login_callback, onError);\n\n      function onError(e) {}\n    }\n\n    function logout() {\n      userLoginUIService.logout(logout_callback);\n    }\n\n    function loginChecking_login() {\n      var defer = q.defer();\n\n      if (userLoginUIService.user.isAuthenticated) {\n        pass();\n      } else {\n        rootScope.$on(\"loginStatusChanged\", function (data) {\n          if (userLoginUIService.user.isAuthenticated) {\n            pass();\n          } else {\n            window.location.href = \"../app-ac/index.html#/myView\";\n          }\n        });\n      }\n\n      ;\n\n      function pass() {\n        window.location.href = \"../app-ac/index.html#/myView\";\n        /*\n        defer.resolve({\n        \tstatus: \"logined\",\n        \tdata: userLoginUIService.user\n        });\n        userInfo.setUserInfo(userLoginUIService.user);\n        */\n      }\n\n      rootScope.loading = \"没有登录\";\n      return defer.promise;\n    }\n\n    factory.test = function () {\n      var deferred = q.defer();\n      timeout(function () {\n        deferred.resolve(\"asdasd\");\n      }, 2000);\n      return deferred.promise;\n    };\n\n    function loginChecking_others() {\n      var deferred = q.defer();\n\n      if (userLoginUIService.user.isAuthenticated) {\n        pass();\n      } else {\n        rootScope.$on(\"loginStatusChanged\", function (data) {\n          if (userLoginUIService.user.isAuthenticated) {\n            //window.history.back();\n            pass();\n          } else {\n            //alert(\"no login！\")\n            window.location.href = \"../app-ac/index.html#/myView\";\n          }\n        });\n      }\n\n      ;\n\n      function pass() {\n        deferred.resolve({\n          status: \"logined\",\n          data: userLoginUIService.user\n        });\n        userInfo.setUserInfo(userLoginUIService.user);\n      }\n\n      rootScope.loading = \"载入设计器\";\n      return deferred.promise;\n    }\n\n    function login_callback(data) {\n      if (data.data) {\n        loc.path(\"/toposhow\");\n      }\n    }\n\n    function newProf() {\n      if (loc.path() == \"/topology\") {\n        window.open(\"index.html#/new/topology\", \"_self\");\n      } else {\n        window.open(\"index.html#/topology\", \"_self\");\n      }\n    }\n\n    function openProf(viewId) {\n      window.open(\"index.html#/topology/\" + viewId, \"_self\");\n    }\n\n    function back() {\n      window.open(\"../../app-oc/index.html#/designView\", \"_self\");\n    }\n\n    function logout_callback(data) {\n      loc.path(\"/\");\n    }\n\n    return factory;\n  }]);\n});"],"sourceRoot":"/source/"}