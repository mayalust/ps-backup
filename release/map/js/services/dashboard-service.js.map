{"version":3,"sources":["js/services/dashboard-service.js"],"names":["define","services","variables_service","rootScope","q","viewFlexService","Info","resourceUIService","kpiDataService","unitService","ticketService","growl","route","solutionUIService","defaultDashboard","userLoginUIService","factory","defer","$rootDomain","Object","create","get","cur","this","deferred","valueCached","resolve","getRootDomain","event","data","err","reject","promise","$units","getAllUnits","$resources","then","rootCi","getResources","label","concat","getCurrent","result","slice","getModelIdByNodeId","nodeId","find","filter","element","id","length","modelId","getAttrByNodeId","attributes","getResourceByIds","values","getAttrsByModelId","i","attribute","value","name","$kpis","models","getByKpiIds","kpis","inside","outside","arguments","kpiId","kpi","push","apply","getKpisByKpiIds","minTimespan","getBymodelId","indexOf","getKpisByModelId","modeId","$rootKpis","resources","argument","enumerable","writable","$randomString","type","listone","fun","resetClick","changeView","JSON","parse","stringify","listtwo","getValueList","nodes","category","timespan","param","isRealTimeData","timePeriod","nodeIds","kpiCodes","startTime","endTime","timeRange","statisticType","condList","code","error","kpiObjects","alertcommon","sparkline","removeKpi","target","_EDITMODE_","_VIEWMODE_","layouts","cols","col","freeStyle","getViews","solutionId","dashboardView","getManageViewContent","dbView","undefined","getAllMyViews","allviews","$Array","designViews","findAll","temp","each","designView","contentData","content","view","e","root","getManageDashboard","evnt","solutionDashboard","viewType","viewId","getValueByRootKpi","getValueListByRootKpis","getValueByCiKpi","ci","option","title","elements","dataType","limit","onlyDifferentKpi","time","replace","series","model","xAxis","legend","animation","grid","left","top","width","height","containLabel","text","subtext","tooltip","trigger","calculable","boundaryGap","yAxis","axisLabel","formatter","parseInt","Math","random","markPoint","markLine","formatStr","theme","layout","widthheightPortion","row","getOption","clone","inx","x","orient","radius","center","$inject"],"mappings":"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","file":"js/services/dashboard-service.js","sourcesContent":["define(['../services/services.js'], function (services) {\n  'use strict';\n\n  services.factory('basicline', basicline_service);\n\n  function basicline_service() {\n    var factory = {};\n    var inx = 0;\n    var option = {\n      title: 'title',\n      elements: [{\n        category: 'time',\n        dataType: {\n          type: \"line\",\n          limit: {\n            onlyDifferentKpi: false\n          },\n          category: {\n            time: {\n              replace: true,\n              category: \"time\",\n              series: {\n                model: 'linear',\n                value: 'ci'\n              },\n              xAxis: true,\n              legend: true\n            }\n          }\n        },\n        option: {\n          animation: false,\n          grid: {\n            left: '0%',\n            top: '15%',\n            width: \"90%\",\n            height: \"80%\",\n            containLabel: true\n          },\n          title: {\n            text: '',\n            subtext: ''\n          },\n          tooltip: {\n            trigger: 'axis'\n          },\n          legend: {\n            data: ['室内温度', '室外温度']\n          },\n          calculable: true,\n          xAxis: [{\n            type: 'category',\n            boundaryGap: false,\n            data: ['4/19', '4/20', '4/21', '4/22', '4/23', '4/24', '4/25']\n          }],\n          yAxis: [{\n            type: 'value',\n            axisLabel: {\n              formatter: '{value}'\n            }\n          }],\n          series: [{\n            name: '室内温度',\n            type: 'line',\n            data: function () {\n              var result = [];\n\n              for (var i = 0; i < 7; i++) {\n                result.push(parseInt(Math.random() * 100));\n              }\n            }(),\n            markPoint: {\n              data: [{\n                type: 'max',\n                name: '最大值'\n              }]\n            },\n            markLine: {\n              data: [{\n                type: 'max',\n                name: '最大标准值'\n              }, {\n                type: 'min',\n                name: '最小标准值'\n              }]\n            }\n          }]\n        },\n        type: 'line',\n        formatStr: '月日',\n        nodes: [],\n        theme: 'macarons',\n        timespan: parseInt(8 * 24 * 3600 * 1000),\n        layout: {\n          width: 100,\n          widthheightPortion: .6,\n          row: 0,\n          col: 0\n        }\n      }]\n    };\n\n    function renderColor(i) {\n      switch (i) {\n        case 0:\n          return '#d99a37';\n\n        case 1:\n          return '#c25060';\n\n        case 2:\n          return '#00c0ff';\n\n        case 3:\n          return '#25cb63';\n\n        case 4:\n          return '#91d815';\n\n        case 5:\n          return '#eea525';\n\n        case 6:\n          return '#ee3825';\n\n        default:\n          return '#c25060';\n      }\n    }\n\n    ;\n\n    factory.getOption = function () {\n      var clone = JSON.parse(JSON.stringify(option));\n      /*\n       if(clone.elements[0].option.series.length == 1)\n       {\n       clone.elements[0].option.series[0].areaStyle = {\n       normal: {}\n       }\n       clone.elements[0].option.series[0].itemStyle.normal.color = renderColor(inx);\n       clone.elements[0].option.series[0].lineStyle.normal.color = renderColor(inx);\n       clone.elements[0].option.series[0].areaStyle.normal.color = renderColor(inx);\n       }\n       else\n       {\n       for(var i in clone.elements[0].option.series)\n       {\n       delete clone.elements[0].option.series[i].areaStyle;\n       }\n       }\n       */\n\n      inx++;\n      return clone;\n    };\n\n    return factory;\n  }\n\n  ;\n  services.factory('basicpie', basicpie_service);\n\n  function basicpie_service() {\n    var factory = {};\n    var option = {\n      title: 'title',\n      elements: [{\n        category: 'ci',\n        dataType: {\n          type: \"pie\",\n          limit: {\n            onlyDifferentKpi: false\n          },\n          category: {\n            ci: {\n              replace: true,\n              category: \"ci\",\n              series: {\n                model: 'linear',\n                value: 'ci'\n              },\n              xAxis: false,\n              legend: false\n            }\n          }\n        },\n        option: {\n          \"title\": {\n            \"text\": \"\",\n            \"subtext\": \"\",\n            \"x\": \"center\"\n          },\n          \"tooltip\": {\n            \"trigger\": \"item\",\n            \"formatter\": \"{a} <br/>{b} : {c} ({d}%)\"\n          },\n          \"legend\": {\n            \"orient\": \"vertical\",\n            \"x\": \"left\",\n            \"data\": [\"提花机A－产量\", \"提花机B－产量\", \"提花机C－产量\", \"提花机D－产量\", \"提花机E－产量\"]\n          },\n          \"calculable\": true,\n          \"series\": [{\n            \"name\": \"访问来源\",\n            \"type\": \"pie\",\n            \"radius\": \"60%\",\n            \"center\": [\"50%\", \"50%\"],\n            \"data\": [{\n              \"value\": 335,\n              \"name\": \"提花机A－产量\"\n            }, {\n              \"value\": 310,\n              \"name\": \"提花机B－产量\"\n            }, {\n              \"value\": 234,\n              \"name\": \"提花机C－产量\"\n            }, {\n              \"value\": 135,\n              \"name\": \"提花机D－产量\"\n            }, {\n              \"value\": 1548,\n              \"name\": \"提花机E－产量\"\n            }]\n          }]\n        },\n        type: 'line',\n        nodes: [],\n        theme: 'macarons',\n        timespan: 0,\n        layout: {\n          width: 100,\n          widthheightPortion: .6,\n          row: 0,\n          col: 0\n        }\n      }]\n    };\n\n    factory.getOption = function () {\n      var clone = JSON.parse(JSON.stringify(option));\n      return clone;\n    };\n\n    return factory;\n  }\n\n  ;\n  services.factory('variables', variables_service);\n  variables_service.$inject = [\"$rootScope\", \"$q\", \"viewFlexService\", \"Info\", \"resourceUIService\", \"kpiDataService\", \"unitService\", \"ticketService\", \"growl\", \"$route\", \"solutionUIService\", \"defaultDashboard\", \"userLoginUIService\"];\n\n  function variables_service(rootScope, q, viewFlexService, Info, resourceUIService, kpiDataService, unitService, ticketService, growl, route, solutionUIService, defaultDashboard, userLoginUIService) {\n    var factory = {},\n        deferred = q.defer();\n    factory.$rootDomain = Object.create({\n      get: function get() {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.valueCached) {\n          deferred.resolve(cur.valueCached);\n        } else {\n          resourceUIService.getRootDomain(function success(event) {\n            try {\n              if (event.data) {\n                cur.valueCached = event.data;\n                deferred.resolve(event.data);\n              } else {\n                throw \"rootCi is undefined !!\";\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          }, function error(err) {});\n        }\n\n        return deferred.promise;\n      }\n    });\n    factory.$units = Object.create({\n      get: function get() {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.valueCached) {\n          deferred.resolve(cur.valueCached);\n        } else {\n          unitService.getAllUnits(function success(event) {\n            try {\n              if (event.data) {\n                cur.valueCached = event.data;\n                deferred.resolve(event.data);\n              } else {\n                throw \"rootCi is undefined !!\";\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          }, function error(err) {});\n        }\n\n        return deferred.promise;\n      }\n    });\n    factory.$resources = Object.create({\n      get: function get() {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.valueCached) {\n          deferred.resolve(cur.valueCached);\n        } else {\n          factory.$rootDomain.get().then(function success(rootCi) {\n            resourceUIService.getResources(function success(event) {\n              try {\n                if (event.data) {\n                  rootCi.label = '企业';\n                  cur.valueCached = [rootCi];\n                  cur.valueCached = cur.valueCached.concat(event.data);\n                  deferred.resolve(cur.valueCached);\n                } else {\n                  throw \"data is undefined !!\";\n                }\n              } catch (err) {\n                deferred.reject(err);\n              }\n            }, function error(err) {});\n          }, function error(err) {});\n        }\n\n        return deferred.promise;\n      },\n      getCurrent: function getCurrent() {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.valueCached) {\n          var result = cur.valueCached.slice(1);\n          deferred.resolve(result);\n        } else {\n          resourceUIService.getResources(function success(event) {\n            try {\n              if (event.data) {\n                rootCi.label = '企业';\n                cur.valueCached = [event.data];\n                deferred.resolve(cur.valueCached);\n              } else {\n                throw \"data is undefined !!\";\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          }, function error(err) {});\n        }\n\n        return deferred.promise;\n      },\n      getModelIdByNodeId: function getModelIdByNodeId(nodeId) {\n        var cur = this;\n        var find = cur.valueCached.filter(function (element) {\n          return element.id == nodeId;\n        });\n\n        if (find.length > 0) {\n          return find[0].modelId;\n        }\n      },\n      getAttrByNodeId: function getAttrByNodeId(nodeId) {\n        var cur = this,\n            deferred = q.defer();\n        cur.get().then(function (data) {\n          var find = data.filter(function (element) {\n            return element.id == nodeId;\n          });\n\n          if (find.length > 0) {\n            if (find[0].attributes) {\n              deferred.resolve(find[0].attributes);\n            } else {\n              resourceUIService.getResourceByIds([nodeId], function success(event) {\n                try {\n                  if (event) {\n                    var values = event[nodeId].values;\n                    var modelId = find[0].modelId;\n                    resourceUIService.getAttrsByModelId(modelId, function success(event) {\n                      try {\n                        if (event.data) {\n                          find.attributes = event.data;\n\n                          for (var i in find.attributes) {\n                            (function (attribute) {\n                              attribute.value = values[attribute.name];\n                            })(find.attributes[i]);\n                          }\n\n                          deferred.resolve(event.data);\n                        } else {\n                          throw \"data is undefined !!\";\n                        }\n                      } catch (err) {\n                        deferred.reject(err);\n                      }\n                    }, function error(err) {\n                      deferred.reject(err);\n                    });\n                  } else {\n                    throw \"data is undefined !!\";\n                  }\n                } catch (err) {\n                  deferred.reject(err);\n                }\n              }, function error(err) {\n                deferred.reject(err);\n              });\n            }\n          }\n        });\n        return deferred.promise;\n      }\n    });\n    factory.$kpis = Object.create({\n      models: [],\n      valueCached: [],\n      getByKpiIds: function getByKpiIds(kpis) {\n        var cur = this,\n            deferred = q.defer();\n        var inside = [];\n        var outside = [];\n        insideValueCached.apply(null, kpis);\n\n        function insideValueCached() {\n          for (var i in arguments) {\n            (function (kpiId) {\n              var find = cur.valueCached.filter(function (kpi) {\n                return kpiId == kpi.id;\n              });\n\n              if (find.length > 0) {\n                inside.push(find[0]);\n              } else {\n                outside.push(kpiId);\n              }\n            })(arguments[i]);\n          }\n        }\n\n        if (outside.length > 0) {\n          resourceUIService.getKpisByKpiIds(outside, function success(data) {\n            try {\n              if (data) {\n                var result = [];\n                delete data.minTimespan;\n\n                for (var i in data) {\n                  result.push(data[i]);\n                  cur.valueCached.push(data[i]);\n                }\n\n                deferred.resolve(inside.concat(result));\n              } else {\n                throw \"data is undefined !!\";\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          }, function error(err) {});\n        } else {\n          deferred.resolve(inside);\n        }\n\n        return deferred.promise;\n      },\n      getBymodelId: function getBymodelId(modelId) {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.models.indexOf(modelId) != -1) {\n          var find = cur.valueCached.filter(function (kpi) {\n            return kpi.modelId == modelId;\n          });\n          deferred.resolve(find);\n        } else {\n          resourceUIService.getKpisByModelId([modelId], function success(event) {\n            try {\n              if (event.data) {\n                var list = [];\n\n                for (var i in event.data) {\n                  event.data[i].modelId = modelId;\n                }\n\n                cur.models.push(modelId);\n                cur.valueCached = cur.valueCached.filter(function (kpi) {\n                  return kpi.modeId != modelId;\n                });\n                cur.valueCached = cur.valueCached.concat(event.data);\n                deferred.resolve(event.data);\n              } else {\n                throw \"data is undefined !!\";\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          }, function error(err) {});\n        }\n\n        return deferred.promise;\n      }\n    });\n    factory.$rootKpis = {\n      get: function get() {\n        var cur = this,\n            deferred = q.defer();\n        factory.$rootDomain.get().then(function success(data) {\n          var rootCi = data;\n          var modelId = rootCi.modelId;\n          factory.$kpis.getBymodelId(modelId).then(function success(data) {\n            cur.valueCached = data;\n            deferred.resolve(data);\n          }, function error(err) {\n            deferred.reject(err);\n          });\n        }, function error(err) {\n          deferred.reject(err);\n        });\n        return deferred.promise;\n      }\n    };\n    factory.$resources.get().then(function success(data) {\n      factory.resources = data;\n    }, function error(err) {});\n    factory.$rootKpis.get().then(function success(data) {\n      factory.kpis = data;\n    }, function error(err) {});\n    var toolslist = [{\n      label: 'totalItems'\n    }, {\n      label: 'progress'\n    }, {\n      label: 'downTab'\n    }, {\n      label: 'attrTab'\n    }, {\n      label: 'header'\n    }, {\n      label: 'map'\n    }];\n    (function () {\n      for (var i in arguments) {\n        (function (argument) {\n          factory[argument.label] = [Object.create(null, {\n            id: {\n              enumerable: false,\n              writable: false,\n              id: $randomString(32)\n            },\n            type: {\n              enumerable: true,\n              writable: false,\n              value: argument.label\n            },\n            attributes: {\n              enumerable: true,\n              writable: true,\n              value: {}\n            }\n          })];\n        })(arguments[i]);\n      }\n    }).apply(factory, toolslist);\n    factory.listone = [Object.create(null, {\n      id: {\n        enumerable: false,\n        writable: false,\n        value: $randomString(32)\n      },\n      type: {\n        enumerable: true,\n        writable: false,\n        value: 'listone'\n      },\n      attributes: {\n        enumerable: true,\n        writable: true,\n        value: {\n          fun: 'resourceUIService.getLatestDevices'\n        }\n      }\n    })];\n\n    factory.resetClick = function () {\n      if (typeof factory.changeView == 'function') {\n        factory.changeView(JSON.parse(JSON.stringify(defaultDashboard)));\n      }\n    };\n\n    factory.listtwo = [Object.create(null, {\n      id: {\n        enumerable: false,\n        writable: false,\n        value: $randomString(32)\n      },\n      type: {\n        enumerable: true,\n        writable: false,\n        value: 'listtwo'\n      },\n      attributes: {\n        enumerable: true,\n        writable: true,\n        value: {\n          fun: 'ticketTaskService.getTicketsByStatus'\n        }\n      }\n    })];\n    var chartslist = [{\n      label: 'basicline'\n    }, {\n      label: 'basicpie'\n    }];\n    (function () {\n      var cur = this;\n\n      for (var i in arguments) {\n        (function (argument) {\n          cur[argument.label] = [Object.create(null, {\n            id: {\n              enumerable: false,\n              writable: false,\n              value: $randomString(32)\n            },\n            type: {\n              enumerable: true,\n              writable: false,\n              value: argument.label\n            },\n            attributes: {\n              enumerable: true,\n              writable: true,\n              value: {}\n            },\n            kpiObjects: {\n              enumerable: true,\n              writable: true,\n              value: []\n            }\n          })];\n        })(arguments[i]);\n      }\n    }).apply(factory, chartslist);\n    factory.alertcommon = [Object.create(null, {\n      id: {\n        enumerable: false,\n        writable: false,\n        value: $randomString(32)\n      },\n      type: {\n        enumerable: true,\n        writable: false,\n        value: 'alertcommon'\n      },\n      attributes: {\n        enumerable: true,\n        writable: true,\n        value: {\n          type: 'alert'\n        }\n      },\n      kpiObjects: {\n        enumerable: true,\n        writable: true,\n        value: []\n      }\n    })];\n    factory.sparkline = [Object.create(null, {\n      id: {\n        enumerable: false,\n        writable: false,\n        value: $randomString(32)\n      },\n      type: {\n        enumerable: true,\n        writable: false,\n        value: 'sparkline'\n      },\n      attributes: {\n        enumerable: true,\n        writable: true,\n        value: {}\n      },\n      kpiObjects: {\n        enumerable: true,\n        writable: true,\n        value: []\n      }\n    })];\n\n    factory.removeKpi = function (kpi, target) {\n      target.kpiObjects = target.kpiObjects.filter(function (element) {\n        return element != kpi;\n      });\n      var result = [];\n\n      for (var i in target.kpiObjects) {\n        result.push(target.kpiObjects[i].id);\n      }\n\n      target.attributes.kpi = result;\n    };\n\n    factory._EDITMODE_ = \"editmode\";\n    factory._VIEWMODE_ = \"viewmode\";\n    factory.layouts = [{\n      id: $randomString(32),\n      type: 'layout',\n      cols: [{\n        col: 12\n      }]\n    }, {\n      id: $randomString(32),\n      type: 'layout',\n      cols: [{\n        col: 6\n      }, {\n        col: 6\n      }]\n    }, {\n      id: $randomString(32),\n      type: 'layout',\n      cols: [{\n        col: 8\n      }, {\n        col: 4\n      }]\n    }, {\n      id: $randomString(32),\n      type: 'layout',\n      cols: [{\n        col: 4\n      }, {\n        col: 8\n      }]\n    }, {\n      id: $randomString(32),\n      type: 'layout',\n      cols: [{\n        col: 2\n      }, {\n        col: 4\n      }, {\n        col: 6\n      }]\n    }, {\n      id: $randomString(32),\n      type: 'layout',\n      cols: [{\n        col: 4\n      }, {\n        col: 4\n      }, {\n        col: 4\n      }]\n    }, {\n      id: $randomString(32),\n      type: 'layout',\n      cols: [{\n        col: 3\n      }, {\n        col: 3\n      }, {\n        col: 3\n      }, {\n        col: 3\n      }]\n    }, {\n      id: $randomString(32),\n      type: 'layout',\n      freeStyle: true,\n      cols: [{\n        col: 2\n      }, {\n        col: 4\n      }, {\n        col: 6\n      }]\n    }];\n\n    factory.getViews = function (solutionId) {\n      var deferred = q.defer();\n      factory.dashboardView = deferred.promise;\n\n      if (solutionId) {\n        solutionUIService.getManageViewContent(solutionId, function (event) {\n          if (event.code == \"0\") {\n            dashboardSolution(event.data != null && event.data != undefined ? event.data : undefined);\n          }\n        });\n      } else {\n        manageDashboard();\n        /* when there is no solution ID provided, should get view from managed dashboard!!!\n        \tif(userLoginUIService.user.appData)\n        {\n        \tvar solutionId = userLoginUIService.user.appData.solutionId;\n        \tsolutionUIService.getManageViewContent(solutionId, function(event){\n        \t\tif(event.code == \"0\")\n        \t\t{\n        \t\t\tmanageDashboard((event.data != null &&  event.data != undefined)? event.data : undefined);\n        \t\t}\n        \t});\n        }\n        else\n        {\n        \trootScope.$on(\"loginStatusChanged\", function() {\n        \t\tvar solutionId = userLoginUIService.user.appData.solutionId;\n        \t\tsolutionUIService.getManageViewContent(solutionId, function(event){\n        \t\t\tif(event.code == \"0\")\n        \t\t\t{\n        \t\t\t\tmanageDashboard((event.data != null &&  event.data != undefined)? event.data : undefined);\n        \t\t\t}\n        \t\t});\n        \t});\n        }\n        */\n      }\n\n      function dashboardSolution(dbView) {\n        var dashboardView = dbView;\n        viewFlexService.getAllMyViews(function (event) {\n          var allviews = new $Array(event.data);\n          var designViews = new $Array(allviews.findAll(\"viewType\", \"designView\"));\n          var temp = [];\n          designViews.each(function (designView) {\n            var contentData;\n            var content = designView.content;\n\n            if (content) {\n              contentData = JSON.parse(content);\n            }\n\n            temp.push({\n              id: $randomString(32),\n              type: \"designView\",\n              content: contentData,\n              view: designView\n            });\n          });\n\n          if (dashboardView != null && dashboardView != undefined) {\n            try {\n              if (dashboardView) {\n                var content = JSON.parse(dashboardView);\n                deferred.resolve({\n                  data: JSON.parse(dashboardView)\n                });\n              } else {\n                throw \"dashboardView is empty!!\";\n              }\n            } catch (e) {\n              deferred.reject(e);\n            }\n          } else {\n            factory.$rootDomain.get().then(function success(root) {\n              var rootCi = root.id;\n              deferred.resolve({\n                data: JSON.parse(JSON.stringify(defaultDashboard))\n              });\n            });\n          }\n\n          factory.designViews = temp;\n        });\n      }\n\n      function manageDashboard() {\n        viewFlexService.getManageDashboard(function (evnt) {\n          var dashboardView;\n\n          if (evnt.data == null) {\n            dashboardView = solutionDashboard;\n          } else {\n            dashboardView = evnt.data;\n          }\n\n          viewFlexService.getAllMyViews(function (event) {\n            var allviews = new $Array(event.data);\n            var designViews = new $Array(allviews.findAll(\"viewType\", \"designView\"));\n            var temp = [];\n            designViews.each(function (designView) {\n              var contentData;\n              var content = designView.content;\n\n              if (content) {\n                contentData = JSON.parse(content);\n              }\n\n              temp.push({\n                id: $randomString(32),\n                type: \"designView\",\n                content: contentData,\n                view: designView\n              });\n            });\n\n            if (dashboardView != null && dashboardView != undefined ? dashboardView.viewType == \"dashboard\" : false) {\n              try {\n                if (dashboardView.content) {\n                  var content = JSON.parse(dashboardView.content);\n                  deferred.resolve({\n                    viewId: dashboardView.viewId,\n                    data: JSON.parse(dashboardView.content)\n                  });\n                } else {\n                  throw \"dashboardView is empty!!\";\n                }\n              } catch (e) {\n                deferred.reject(e);\n              }\n            } else if (dashboardView != null && dashboardView != undefined ? dashboardView.viewType == \"designView\" : true) {\n              factory.$rootDomain.get().then(function success(root) {\n                var rootCi = root.id;\n                deferred.resolve({\n                  data: JSON.parse(JSON.stringify(defaultDashboard))\n                });\n              });\n            }\n\n            factory.designViews = temp;\n          });\n        });\n      }\n    };\n\n    factory.getValueByRootKpi = function (kpi) {\n      var deferred = q.defer();\n      factory.$rootDomain.get().then(function success(data) {\n        var rootCi = data.id;\n        getValueList([rootCi], [kpi], \"ci\", 0).then(function success(data) {\n          if (data[0]) {\n            deferred.resolve(data[0].value);\n          } else {\n            deferred.resolve(0);\n          }\n        }, function error(err) {\n          deferred.reject(err);\n        });\n      }, function error(err) {\n        deferred.reject(err);\n      });\n      return deferred.promise;\n    };\n\n    factory.getValueListByRootKpis = function (kpis) {\n      var deferred = q.defer();\n      factory.$rootDomain.get().then(function success(data) {\n        var rootCi = data.id;\n        getValueList([rootCi], kpis, \"time\", 7 * 24 * 3600 * 1000).then(function success(data) {\n          if (data[0]) {\n            deferred.resolve(data);\n          } else {\n            deferred.resolve([]);\n          }\n        }, function error(err) {\n          deferred.reject(err);\n        });\n      }, function error(err) {\n        deferred.reject(err);\n      });\n      return deferred.promise;\n    };\n\n    factory.getValueByCiKpi = function (ci, kpi) {\n      var deferred = q.defer();\n      getValueList([ci], [kpi], \"ci\", 0).then(function success(data) {\n        if (data[0]) {\n          deferred.resolve(data[0].value);\n        } else {\n          deferred.resolve(0);\n        }\n      }, function error(err) {\n        deferred.reject(err);\n      });\n      return deferred.promise;\n    };\n\n    function getValueList(nodes, kpis, category, timespan) {\n      var deferred = q.defer();\n      var kpiQueryModel = {\n        category: category,\n        isRealTimeData: true,\n        timePeriod: category == \"time\" ? timespan : 0,\n        nodeIds: nodes,\n        kpiCodes: kpis,\n        startTime: null,\n        endTime: null,\n        timeRange: \"\",\n        statisticType: \"psiot\",\n        condList: []\n      };\n      var param = [\"kpi\", kpiQueryModel];\n      kpiDataService.getValueList(param, function (event) {\n        try {\n          if (event.code == 0) {\n            if (event.data) {\n              deferred.resolve(event.data);\n            } else {\n              throw \"event.data is undefined!\";\n            }\n          } else {\n            throw \"cannot get value list!\";\n          }\n        } catch (error) {\n          deferred.reject(error);\n        }\n      });\n      return deferred.promise;\n    }\n\n    ;\n    return factory;\n  }\n\n  ;\n});"],"sourceRoot":"/source/"}