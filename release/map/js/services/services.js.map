{"version":3,"sources":["js/services/services.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","global","factory","define","angular","module","exports","require","window","$services","this","allrequests","services","Search","search","addStr","authFactory","$http","$rootScope","$location","$q","growl","params","url","location","theRequest","Object","indexOf","str","substr","strs","split","i","length","unescape","getUrlParams","token","version","host","undefined","origin","protocol","loc","serviceBase","RegExp","test","port","get","service","method","param","callBack","err","extendstr","getMethod","setAttr","cancel","defer","isString","copy","JSON","stringify","route","string","config","timeout","promise","callToken","post","emptyCall","success","e","status","data","kill","code","message","dt","slice","href","console","error","then","catch","inx","splice","push","Date","getTimezoneOffset","removeAllRequest","target","fn","forEach","b","m","apply","arguments","attr","value","arr","hasOwnProperty","join","$inject"],"mappings":"AAAA,SAASA,QAAQC,GAAwT,OAAtOD,QAArD,mBAAXE,QAAoD,iBAApBA,OAAOC,SAAmC,SAAiBF,GAAO,cAAcA,GAA2B,SAAiBA,GAAO,OAAOA,GAAyB,mBAAXC,QAAyBD,EAAIG,cAAgBF,QAAUD,IAAQC,OAAOG,UAAY,gBAAkBJ,IAAyBA,IAExV,SAAWK,EAAQC,GACjB,GAAqB,mBAAVC,OACTA,OAAO,CAAC,UAAW,wCAAyCD,OACvD,CACL,IAAIE,EAAU,CACZC,OAAQ,cAG6D,WAAhD,oBAAXA,OAAyB,YAAcV,QAAQU,SACrDA,OAAOC,UACTD,OAAOC,QAAUJ,EAAQE,EAASG,QAAQ,CAAC,2BAGzCN,GAAUO,SACZA,OAAOC,UAAYP,EAAQE,EAAS,MAd5C,CAkBGM,KAAM,SAAUN,EAASF,GAC1B,aAEA,IACIS,EAAc,GACdC,EAAWR,EAAQC,OAAO,WAAY,CAAC,eAQ3C,SAASQ,EAAOC,GACdJ,KAAKK,OAAOD,GAuCd,SAASE,EAAYC,EAAOC,EAAYC,EAAWC,EAAIC,GACrD,IAAIC,EAkKJ,WACE,IAAIC,EAAMC,SAASV,OAEfW,EAAa,IAAIC,OAErB,IAAyB,GAArBH,EAAII,QAAQ,KAId,IAHA,IAAIC,EAAML,EAAIM,OAAO,GACjBC,EAAOF,EAAIG,MAAM,KAEZC,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAC/BP,EAAWK,EAAKE,GAAGD,MAAM,KAAK,IAAMG,SAASJ,EAAKE,GAAGD,MAAM,KAAK,IAIpE,OAAON,EAhLIU,GACTC,EAAQd,EAAO,MACfe,EAAUf,EAAO,QAAaA,EAAO,QAAa,KACtDpB,EAAQmC,QAAUA,EAEd7B,OAAOgB,SAASc,OAAqD,GAA7C9B,OAAOgB,SAASc,KAAKxB,OAAO,eAAmE,GAA7CN,OAAOgB,SAASc,KAAKxB,OAAO,eAAyE,GAAnDN,OAAOgB,SAASc,KAAKxB,OAAO,qBAC1JZ,EAAQoC,KAAO9B,OAAOgB,SAASc,KAEDC,MAA1B/B,OAAOgB,SAASgB,OAClBtC,EAAQsC,OAAShC,OAAOgB,SAASgB,OAEjCtC,EAAQsC,OAAS,WAAahC,OAAOgB,SAASc,KAGhB,UAA5B9B,OAAOgB,SAASiB,SAClBvC,EAAQuC,SAAW,OAEnBvC,EAAQuC,SAAW,OAMvB,IAA4BC,EAGLJ,EAFjBA,EADFK,GAAwBD,EAa1BlC,OAAOgB,SAZHc,EAAOI,EAAIJ,KAEMA,EAKLA,EAJM,IAAIM,OAAO,YAAa,KACvBC,KAAKP,IAGqB,SAAxB9B,OAAOgB,SAASsB,KAChC5C,EAAQsC,OAAS,IAEjBE,EAAIF,OAAS,KAMxBtC,EAAQ6C,IAAM,SAAUC,EAASC,EAAQC,EAAOC,EAAUC,EAAKC,GAE7D,IAAIvC,EAAS,IAAID,GADjBoC,EAASpC,EAAOyC,UAAUL,IACKnC,QAC/BmC,EAASA,EAAOA,OAChBnC,EAAOC,OAAOsC,GAED,MAATjB,GACFtB,EAAOyC,QAAQ,QAASnB,GAG1B,IAAIoB,EAASpC,EAAGqC,QAIXrD,EAAQsD,SAASR,KACpBA,EAAQ9C,EAAQuD,KAAKT,GACrBA,EAAQU,KAAKC,UAAUX,IAGzB,IAAIY,EACO,aAOTd,EANS,YAC0B,EAAxBA,EAAQrB,QAAQ,KAClB,YAEA,iBAKPJ,EAAMoB,EAAcmB,GADxBd,EAAqB,aAAXA,EAAyB,GAAKA,GACE,IAAMC,EAASnC,EAAOiD,SAE5DC,EAAS,CACXC,QAAST,EAAOU,SAEdC,EAAYlD,EAAMmD,KAAK7C,EAAK2B,EAAOc,GAEvC,SAASK,IACP,OAAO,KAKT,SAASC,EAAQC,GAIf,GAHAA,EAAgB,KAAZA,EAAEC,OAAgBD,EAAEE,KAAOF,EAC/BJ,EAAUO,KAAOL,EAED,MAAZlB,EACF,GAAc,GAAVoB,EAAEI,KACJxB,EAASoB,QAET,IAAsC,EAAlCA,EAAEK,QAAQ9D,OAAO,cAAoB,CACvC,IAAI+D,EAAKN,EAAEE,KACXI,EAAc,KAATA,EAAG,IAAaA,EAAGC,MAAM,IAAMD,EACpCrD,SAASuD,KAAO,MAAQF,EACxB1B,EAAS,CACPwB,KAAM,EACNF,KAAM,UAEU,KAATF,EAAEI,KACXK,QAAQC,MAAMV,EAAEK,QAAS,KAIzBI,QAAQC,MAAM1D,EAAK,YACnByD,QAAQC,MAAM,MAAOrB,KAAKC,UAAUX,EAAO,KAAM,IACjD8B,QAAQC,MAAM,OAASV,EAAEI,KAAO,IAAMJ,EAAEK,UAJxCzB,EAASoB,GAejB,SAASU,EAAMR,GACb,IAAIrB,EAAM,GACQA,GAAH,GAAXoB,OAAoB,gBAAkBA,OAAS,kBAA6B,eAChFL,EAAUO,MAAQL,GAAahD,EAAM4D,MAAM7B,EAAK,IAChDe,EAAUO,KAAOL,EAWnB,OAnDAF,EAAUG,SAAWH,EAAUG,QAAQA,IAAYH,EAAUe,KAAKZ,GAkClEH,EAAUc,OAASd,EAAUc,MAAMA,IAAUd,EAAUgB,MAAMF,GAW7Dd,EAAUO,KAAO,WACf,IAAIU,EAAMzE,EAAYgB,QAAQjB,MAC9BC,EAAY0E,OAAOD,EAAK,IAG1BzE,EAAY2E,KAAKnB,GACVA,IAGD,IAAIoB,MACYC,oBA2CxB,OAzCAtF,EAAQuF,iBAAmB,WAEzB,IAAK,IAAIzD,KAAKrB,EACZA,EAAYqB,GAAG0C,QAsCZxE,EAMT,OA9NAW,EAAOyC,UAAY,SAAUL,GAC3B,IAAIrB,EAAMqB,EAAOlB,MAAM,KACvB,MAAO,CACLkB,OAAQrB,EAAI,GACZd,OAAQc,EAAI,KAIhBf,EAAOb,UAAUe,OAAS,SAAUa,GAKlC,IAvBY8D,EAAQC,EAmBD,iBAAR/D,GAIDA,EAAIG,MAAM,KAChB6D,SAxBQF,EAwBKhF,KAxBGiF,EAwBG,SAAUE,GAC/B,IAAIC,EAAID,EAAE9D,MAAM,KAChBrB,KAAKoF,EAAE,IAAMA,EAAE,IAzBV,WACL,OAAOH,EAAGI,MAAML,EAAQM,eA4B5BnF,EAAOb,UAAUuD,QAAU,SAAU0C,EAAMC,GACzCxF,KAAKuF,GAAQC,GAGfrF,EAAOb,UAAU+D,OAAS,WACxB,IAAIoC,EAAM,GAEV,IAAK,IAAInE,KAAKtB,KACRA,KAAK0F,eAAepE,IACtBmE,EAAIb,KAAKtD,EAAI,IAAMtB,KAAKsB,IAI5B,MAAO,IAAMmE,EAAIE,KAAK,MA2LxBrF,EAAYsF,QA1OO,CAAC,QAAS,aAAc,YAAa,KAAM,SA2O9D1F,EAASV,QAAQ,eAAgBc,GAC1BJ","file":"js/services/services.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (global, factory) {\n  if (typeof define == \"function\") {\n    define(['angular', \"../../../js/services/service_factory\"], factory);\n  } else {\n    var angular = {\n      module: function module() {}\n    };\n\n    if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) == \"object\") {\n      if (module.exports) {\n        module.exports = factory(angular, require(['./service_factory.js']));\n      }\n    } else {\n      if (global == window) {\n        window.$services = factory(angular, {});\n      }\n    }\n  }\n})(this, function (angular, factory) {\n  'use strict';\n\n  var injectParams = ['$http', '$rootScope', '$location', '$q', 'growl'],\n      allrequests = [],\n      services = angular.module('services', ['ngResource']);\n\n  function bind(target, fn) {\n    return function () {\n      return fn.apply(target, arguments);\n    };\n  }\n\n  function Search(search) {\n    this.addStr(search);\n  }\n\n  Search.getMethod = function (method) {\n    var str = method.split(\"?\");\n    return {\n      method: str[0],\n      search: str[1]\n    };\n  };\n\n  Search.prototype.addStr = function (str) {\n    if (typeof str !== \"string\") {\n      return;\n    }\n\n    var arr = str.split(\"&\");\n    arr.forEach(bind(this, function (b) {\n      var m = b.split(\"=\");\n      this[m[0]] = m[1];\n    }));\n  };\n\n  Search.prototype.setAttr = function (attr, value) {\n    this[attr] = value;\n  };\n\n  Search.prototype.string = function () {\n    var arr = [];\n\n    for (var i in this) {\n      if (this.hasOwnProperty(i)) {\n        arr.push(i + \"=\" + this[i]);\n      }\n    }\n\n    return \"?\" + arr.join(\"&\");\n  };\n\n  function authFactory($http, $rootScope, $location, $q, growl) {\n    var params = getUrlParams();\n    var token = params[\"token\"];\n    var version = params[\"version\"] ? params[\"version\"] : \"V2\";\n    factory.version = version;\n\n    if (window.location.host && window.location.host.search('localhost') == -1 && window.location.host.search('127.0.0.1') == -1 && window.location.host.search('192.168.199.223') == -1) {\n      factory.host = window.location.host;\n\n      if (window.location.origin != undefined) {\n        factory.origin = window.location.origin;\n      } else {\n        factory.origin = \"https://\" + window.location.host;\n      }\n\n      if (window.location.protocol == \"https:\") {\n        factory.protocol = \"wss:\";\n      } else {\n        factory.protocol = \"ws:\";\n      }\n    }\n    /** 应用webpack-dev-server启动服务器暂定8080端口，代理解决开发时跨域问题 */\n\n\n    var serviceBase = function (loc) {\n      var host = loc.host;\n\n      function isLocalHost(host) {\n        var localhostLike = new RegExp(\"localhost\", \"g\");\n        return localhostLike.test(host);\n      }\n\n      if (isLocalHost(host) && window.location.port == \"63342\") {\n        return factory.origin + \"/\";\n      } else {\n        return loc.origin + \"/\";\n      }\n    }(window.location);\n    /** 应用webpack-dev-server启动服务器暂定8080端口，代理解决开发时跨域问题 */\n\n\n    factory.get = function (service, method, param, callBack, err, extendstr) {\n      method = Search.getMethod(method);\n      var search = new Search(method.search);\n      method = method.method;\n      search.addStr(extendstr);\n\n      if (token != null) {\n        search.setAttr(\"token\", token);\n      }\n\n      var cancel = $q.defer();\n\n      if (typeof callBack != \"function\") {}\n\n      if (!angular.isString(param)) {\n        param = angular.copy(param);\n        param = JSON.stringify(param);\n      }\n\n      var route = function (s) {\n        if (s == \"nodejsapi\") {\n          return \"api/node\";\n        } else if (service.indexOf(\"/\") > -1) {\n          return \"api/rest/\";\n        } else {\n          return \"api/rest/post/\";\n        }\n      }(service);\n\n      service = service == \"nodejsapi\" ? \"\" : service;\n      var url = serviceBase + route + service + \"/\" + method + search.string(); //var url = \"/api/rest/post/\" + service + \"/\" + method+(extendstr?(\"?\"+extendstr):\"\");\n\n      var config = {\n        timeout: cancel.promise\n      };\n      var callToken = $http.post(url, param, config);\n\n      function emptyCall() {\n        return null;\n      }\n\n      callToken.success && callToken.success(success) || callToken.then(success);\n\n      function success(e) {\n        e = e.status == 200 ? e.data : e;\n        callToken.kill = emptyCall;\n\n        if (callBack != null) {\n          if (e.code == 0) {\n            callBack(e);\n          } else {\n            if (e.message.search(\"需要用户登录才能使用\") > -1) {\n              var dt = e.data;\n              dt = dt[0] == \"/\" && dt.slice(1) || dt;\n              location.href = \"../\" + dt;\n              callBack({\n                code: 0,\n                data: {}\n              });\n            } else if (e.code > 9999) {\n              console.error(e.message, {}); //growl.info(e.message, {});\n\n              callBack(e);\n            } else {\n              console.error(url, \"方法调用发生错误\");\n              console.error(\"参数：\", JSON.stringify(param, null, 2));\n              console.error(\"错误编码\" + e.code + \":\" + e.message); //growl.error(\"错误编码\" + e.code + \":\" + e.message, {});\n\n              callBack(e);\n            }\n          }\n        }\n      }\n\n      ;\n      callToken.error && callToken.error(error) || callToken.catch(error);\n\n      function error(data) {\n        var err = \"\";\n        if (status == -1) err = \"(HTTP status:\" + status + \")服务器连接已中断，请刷新页面\";else err = \"网络链接异常，请刷新页面\";\n        callToken.kill == emptyCall && growl.error(err, {});\n        callToken.kill = emptyCall;\n      }\n\n      ;\n\n      callToken.kill = function () {\n        var inx = allrequests.indexOf(this);\n        allrequests.splice(inx, 1);\n      };\n\n      allrequests.push(callToken);\n      return callToken;\n    };\n\n    var d = new Date();\n    var gmtMilliseconds = d.getTimezoneOffset() * 60 * 1000;\n\n    factory.removeAllRequest = function () {\n      //  \n      for (var i in allrequests) {\n        allrequests[i].kill();\n      }\n    };\n\n    function convertDateToString(input) {\n      // Ignore things that aren't objects.\n      if (_typeof(input) !== \"object\") return input;\n\n      for (var key in input) {\n        if (!input.hasOwnProperty(key)) continue;\n        var value = input[key];\n\n        if (angular.isDate(value)) {\n          value.setMilliseconds(value.getMilliseconds() - gmtMilliseconds);\n          input[key] = value.toJSON();\n        } else if (_typeof(value) === \"object\") {\n          convertDateToString(value);\n        }\n      }\n    }\n\n    function getUrlParams() {\n      var url = location.search; //获取url中\"?\"符后的字串\n\n      var theRequest = new Object();\n\n      if (url.indexOf(\"?\") != -1) {\n        var str = url.substr(1);\n        var strs = str.split(\"&\");\n\n        for (var i = 0; i < strs.length; i++) {\n          theRequest[strs[i].split(\"=\")[0]] = unescape(strs[i].split(\"=\")[1]);\n        }\n      }\n\n      return theRequest;\n    }\n\n    return factory;\n  }\n\n  ;\n  authFactory.$inject = injectParams;\n  services.factory('serviceProxy', authFactory);\n  return services;\n});"],"sourceRoot":"/source/"}