{"version":3,"sources":["js/services/custom-method-service.js"],"names":["define","services","factory","serviceProxy","dictionaryService","resourceUIService","http","service","PROJECTTYPES","id","dictCode","valueCode","label","getAllPeriod","callback","getDictValues","event","code","data","filter","elem","random","range","min","delta","Math","round","url","get","then","getProjectsType","domains","param","modelIds","replace","getDomainsByFilter","rs","projects","some","proj","values","projectType","getProTypeByTypeId","ptypes","find","getSimulateList","size","formatter","loop","index","item","attr","obj","i","value","push"],"mappings":"AAAAA,OAAO,CAAC,2BAA4B,SAAUC,GAC5C,aAEAA,EAASC,QAAQ,sBAAuB,CAAC,eAAgB,oBAAqB,oBAAqB,QAAS,SAAUC,EAAcC,EAAmBC,EAAmBC,GAIxK,IAAIC,EAAU,GACVC,EAAe,CAAC,CAClBC,GAAM,KACNC,SAAY,cACZC,UAAa,IACbC,MAAS,QACR,CACDH,GAAM,KACNC,SAAY,cACZC,UAAa,IACbC,MAAS,QACR,CACDH,GAAM,KACNC,SAAY,cACZC,UAAa,IACbC,MAAS,QACR,CACDH,GAAM,KACNC,SAAY,cACZC,UAAa,IACbC,MAAS,QACR,CACDH,GAAM,KACNC,SAAY,cACZC,UAAa,IACbC,MAAS,QACR,CACDH,GAAM,KACNC,SAAY,cACZC,UAAa,IACbC,MAAS,SAgGX,OA7FAL,EAAQM,aAAe,SAAUC,GAC/BV,EAAkBW,cAAc,qBAAsB,SAAUC,GAC5C,GAAdA,EAAMC,OACRD,EAAME,KAAOF,EAAME,KAAKC,OAAO,SAAUC,GACvC,MAAqB,KAAdA,EAAKR,OAA8B,MAAdQ,EAAKR,OAA+B,KAAdQ,EAAKR,QAEzDE,EAASE,OAKfT,EAAQc,OAAS,SAAUC,GACzB,IAAIC,EAAMD,EAAM,GACZE,EAAQF,EAAM,GAAKA,EAAM,GAE7B,OAAOC,EADGE,KAAKC,MAAMD,KAAKJ,SAAWG,IAIvCjB,EAAQD,KAAO,SAAUqB,EAAKb,GAC5BR,EAAKsB,IAAID,GAAKE,KAAKf,IAGrBP,EAAQuB,gBAAkB,SAAUhB,EAAUiB,GAC5C,IAAIC,EAAQ,CACVC,SAAU,CAAC,MAGTF,IACFA,EAAUA,EAAQG,QAAQ,MAAO,KACjCF,EAAMD,QAAUA,GAIlB1B,EAAkB8B,mBAAmBH,EAAO,SAAUhB,GACpD,IAAIoB,EAAK,GAET,GAAkB,GAAdpB,EAAMC,KAAW,CACnB,IAAIoB,EAAWrB,EAAME,KACrBkB,EAAK5B,EAAaW,OAAO,SAAUC,GAIjC,OAHWiB,EAASC,KAAK,SAAUC,GACjC,OAAOA,EAAKC,OAAOC,aAAerB,EAAKT,cAM7CG,EAAS,CACPG,KAAM,EACNC,KAAMkB,OAKZ7B,EAAQmC,mBAAqB,SAAUjC,EAAIK,GACzCP,EAAQuB,gBAAgB,SAAUa,GAChC,IAAIC,EAAOD,EAAOzB,KAAK0B,KAAK,SAAUxB,GACpC,OAAOA,EAAKX,IAAMA,IAEpBK,EAAS,CACPG,KAAM,EACNC,KAAM0B,GAAcD,EAAOzB,KAAK,QAKtCX,EAAQsC,gBAAkB,SAAUb,EAAOlB,GAoBzC,IAnBA,IAAIsB,EAAK,GACLU,EAAOd,EAAMc,KACbC,EAAYf,EAAMe,UAElBC,EAAO,SAAcC,GACvB,IAE2CC,EACrCC,EAHFC,EAAM,GAOV,IAAK,IAAIC,KAAKN,EAL6BG,EAM3BH,EAAUM,QALpBF,EAAAA,EAAOD,EAAKtC,MAChBwC,EAAID,GAAQD,EAAKI,MAAML,EAAO1C,GAOhC,OAAO6C,GAGAC,EAAI,EAAGA,EAAIP,EAAO,EAAGO,IAC5BjB,EAAGmB,KAAKP,EAAKK,IAIfvC,EAASsB,IAGJ7B","file":"js/services/custom-method-service.js","sourcesContent":["define(['../services/services.js'], function (services) {\n  'use strict';\n\n  services.factory('customMethodService', ['serviceProxy', 'dictionaryService', 'resourceUIService', '$http', function (serviceProxy, dictionaryService, resourceUIService, http) {\n    /**\n     * 保存配置组\n     */\n    var service = {};\n    var PROJECTTYPES = [{\n      \"id\": 5701,\n      \"dictCode\": \"projectType\",\n      \"valueCode\": \"1\",\n      \"label\": \"污水处理\"\n    }, {\n      \"id\": 5702,\n      \"dictCode\": \"projectType\",\n      \"valueCode\": \"2\",\n      \"label\": \"二次供水\"\n    }, {\n      \"id\": 5703,\n      \"dictCode\": \"projectType\",\n      \"valueCode\": \"3\",\n      \"label\": \"中央空调\"\n    }, {\n      \"id\": 5704,\n      \"dictCode\": \"projectType\",\n      \"valueCode\": \"4\",\n      \"label\": \"制氧系统\"\n    }, {\n      \"id\": 5705,\n      \"dictCode\": \"projectType\",\n      \"valueCode\": \"5\",\n      \"label\": \"锅炉系统\"\n    }, {\n      \"id\": 5706,\n      \"dictCode\": \"projectType\",\n      \"valueCode\": \"6\",\n      \"label\": \"电梯监控\"\n    }];\n\n    service.getAllPeriod = function (callback) {\n      dictionaryService.getDictValues(\"KqiGranularityUnit\", function (event) {\n        if (event.code == 0) {\n          event.data = event.data.filter(function (elem) {\n            return elem.label == \"月\" || elem.label == \"季度\" || elem.label == \"年\";\n          });\n          callback(event);\n        }\n      });\n    };\n\n    service.random = function (range) {\n      var min = range[0];\n      var delta = range[1] - range[0];\n      var ran = Math.round(Math.random() * delta);\n      return min + ran;\n    };\n\n    service.http = function (url, callback) {\n      http.get(url).then(callback);\n    };\n\n    service.getProjectsType = function (callback, domains) {\n      var param = {\n        modelIds: [302]\n      };\n\n      if (domains) {\n        domains = domains.replace(/\\|/g, \"/\");\n        param.domains = domains;\n      }\n\n      ;\n      resourceUIService.getDomainsByFilter(param, function (event) {\n        var rs = [];\n\n        if (event.code == 0) {\n          var projects = event.data;\n          rs = PROJECTTYPES.filter(function (elem) {\n            var some = projects.some(function (proj) {\n              return proj.values.projectType == elem.valueCode;\n            });\n            return some;\n          });\n        }\n\n        callback({\n          code: 0,\n          data: rs\n        });\n      });\n    };\n\n    service.getProTypeByTypeId = function (id, callback) {\n      service.getProjectsType(function (ptypes) {\n        var find = ptypes.data.find(function (elem) {\n          return elem.id == id;\n        });\n        callback({\n          code: 0,\n          data: find ? find : ptypes.data[0]\n        });\n      });\n    };\n\n    service.getSimulateList = function (param, callback) {\n      var rs = [];\n      var size = param.size;\n      var formatter = param.formatter;\n\n      var loop = function loop(index) {\n        var obj = {};\n\n        var loopFormatter = function loopFormatter(item) {\n          var attr = item.label;\n          obj[attr] = item.value(index, service);\n        };\n\n        for (var i in formatter) {\n          loopFormatter(formatter[i]);\n        }\n\n        return obj;\n      };\n\n      for (var i = 0; i < size - 1; i++) {\n        rs.push(loop(i));\n      }\n\n      ;\n      callback(rs);\n    };\n\n    return service;\n  }]);\n});"],"sourceRoot":"/source/"}