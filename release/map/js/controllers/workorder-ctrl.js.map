{"version":3,"sources":["js/controllers/workorder-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","ngDialog","resourceUIService","workflowService","ticketCategoryService","alertService","SwSocket","Info","userLoginUIService","growl","$routeParams","processService","ticketTaskService","ticketService","console","info","editVisible","addOrderShow","processType","activeTab","activeListTab","type","id","seleStatus","initAddList","orderAddData","title","priorityCode","ticketNo","category","ticketCategoryId","values","deviceId","faultId","message","orderCount","doing","unpush","done","all","get","priorityData","statusData","formAryList","definitions","selectItem","process","undefined","spl","split","getWorkflowById","res","code","data","resAry","startAttributeDefinitions","i","typePro","label","name","dataType","push","initData","devicesAll","faultList","findFault","devicesDic","findFaultKnowledgeByModelId","modelId","getDoingOrderCount","getTicketsByStatusAndDeviceId","returnObj","length","obj","status","findTickets","getUnpushOrderCount","getDoneOrderCount","getAllOrderCount","getTicketsByDeviceId","getAllTickets","getOrderData","state","count","workOrderData","orderGirtData","$broadcast","Event","WORKORDERINIT","goSearch","v","loaderValue","wordCancel","getOrderProcedure","processTypeList","processTypeData","addWorkOrder","workOrderType","myDicts","open","template","scope","className","saveOrder","commitloading","warning","ticket","saveTicket","success","closeDialog","indexOf","changeWorkOrderItem","$","tab","cancelOrder","uploadOrder","commitTicket","dataList","j","splice","formatDate","str","newDateJson","Format","GetDateCategoryStrByLabel","columnDefs","targets","render","full","strIcon","menuitems","columns","ProudSmart","datatable","optionCol2","cancelTicket","show","closable","buttons","cssClass","action","dialogRef","close","resultObj","delTicket","deleteTicket","tabStatus","cancelOrderNo","on","e","target","closest","removeClass","children","addClass","aname","attr","$apply","text","relatedTarget","getTicketCategorys","arr1","arr2","arr3","arr4","processType1","processType2","processType3","processType4","getDevicesByCondition","newObj","forEach","init"],"mappings":"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","file":"js/controllers/workorder-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('WorkOrderCtrl', ['$scope', 'ngDialog', 'resourceUIService', 'workflowService', 'ticketCategoryService', 'alertService', 'SwSocket', 'Info', 'userLoginUIService', 'growl', '$routeParams', 'processService', 'ticketTaskService', 'ticketService', function ($scope, ngDialog, resourceUIService, workflowService, ticketCategoryService, alertService, SwSocket, Info, userLoginUIService, growl, $routeParams, processService, ticketTaskService, ticketService) {\n    console.info(\"切换到工单管理\");\n    var previousTab; //前一个激活的标签tab名称\n\n    $scope.editVisible = false;\n    $scope.addOrderShow = false;\n    $scope.processType = [];\n    $scope.activeTab = \"执行中\";\n    $scope.activeListTab = \"tab1\";\n    var type = $routeParams.type;\n    var id = $routeParams.id;\n    $scope.seleStatus = 100;\n\n    $scope.initAddList = function () {\n      //新增工单初始化\n      $scope.orderAddData = {\n        \"title\": \"\",\n        \"priorityCode\": \"0\",\n        \"ticketNo\": '',\n        \"category\": \"\",\n        \"ticketCategoryId\": 0,\n        \"values\": null,\n        \"deviceId\": \"\",\n        \"faultId\": \"\",\n        \"message\": \"\"\n      };\n    }; //各阶段工单数量\n\n\n    $scope.orderCount = {\n      \"doing\": 0,\n      \"unpush\": 0,\n      \"done\": 0,\n      \"all\": 0\n    };\n    var info = Info.get(\"../localdb/info.json\", function (info) {\n      $scope.priorityData = info.priorityData;\n      $scope.statusData = info.statusData; // $scope.workOrderType = info.workOrderType;\n      // $scope.workOrderType = $scope.myDicts['ticketCategory'];\n    });\n    $scope.formAryList = [];\n    $scope.definitions = {};\n    $scope.selectItem = \"\"; //根据流程查开始节点属性\n\n    $scope.process = function () {\n      if ($scope.orderAddData.ticketCategoryId != \"\" && $scope.orderAddData.ticketCategoryId != undefined && $scope.orderAddData.ticketCategoryId != null) {\n        var spl = $scope.orderAddData.ticketCategoryId.split(\":\");\n        workflowService.getWorkflowById(spl[0], function (res) {\n          if (res.code == 0) {\n            $scope.selectItem = res.data;\n            var resAry = res.data.startAttributeDefinitions;\n            $scope.formAryList = [];\n\n            for (var i in resAry) {\n              var typePro = {};\n              typePro[\"label\"] = resAry[i].label;\n              typePro[\"name\"] = resAry[i].name;\n              typePro[\"dataType\"] = resAry[i].dataType;\n              $scope.definitions[resAry[i].label] = \"\";\n              $scope.formAryList.push(typePro);\n            }\n          }\n        });\n      } else {\n        $scope.formAryList = [];\n      }\n    };\n\n    $scope.initData = {\n      \"devicesAll\": \"\",\n      \"faultList\": \"\"\n    };\n    $scope.devicesAll = \"\"; //根据工单分类初始化工单流程\n\n    var getProcedure = function getProcedure() {\n      ticketCategoryService.getTicketCategorys(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.processTypeData = returnObj.data; //展示table数据的工单流程\n\n          var arr1 = [];\n          var arr2 = [];\n          var arr3 = [];\n          var arr4 = [];\n\n          for (var i in returnObj.data) {\n            if (returnObj.data[i].category == \"10\") {\n              //告警工单\n              arr1.push(returnObj.data[i]);\n            } else if (returnObj.data[i].category == \"20\") {\n              arr2.push(returnObj.data[i]);\n            } else if (returnObj.data[i].category == \"30\") {\n              arr3.push(returnObj.data[i]);\n            } else if (returnObj.data[i].category == \"40\") {\n              arr4.push(returnObj.data[i]);\n            }\n          }\n\n          $scope.processType1 = arr1;\n          $scope.processType2 = arr2;\n          $scope.processType3 = arr3;\n          $scope.processType4 = arr4;\n          getOrderData(100);\n        }\n      });\n      $scope.devicesDic = {};\n      resourceUIService.getDevicesByCondition({}, function (res) {\n        if (res.code == 0) {\n          var newObj = [];\n          newObj.push({\n            text: '请选择',\n            label: '请选择',\n            id: '-1'\n          });\n          res.data.forEach(function (obj) {\n            if (obj.label) {\n              obj.text = obj.label;\n              $scope.devicesDic[obj.id] = obj;\n              newObj.push(obj);\n            }\n          });\n          $scope.devicesAll = newObj;\n        }\n      });\n    };\n\n    $scope.findFault = function () {\n      if ($scope.devicesDic[$scope.orderAddData.deviceId]) {\n        resourceUIService.findFaultKnowledgeByModelId($scope.devicesDic[$scope.orderAddData.deviceId].modelId, function (res) {\n          if (res.code == 0) {\n            $scope.initData.faultList = res.data;\n          }\n        });\n      }\n    };\n\n    var searchList = function searchList(obj) {\n      ticketTaskService.findTickets(obj, function (returnObj) {\n        if (returnObj.code == 0) {\n          var status = $scope.seleStatus;\n          var state = \"\";\n          var count = returnObj.data.length;\n\n          if (status == 100) {\n            $scope.orderCount.doing = count;\n            state = \"doing\"; //执行中\n\n            $scope.workOrderData[\"tab\"] = true;\n          } else if (status == 10) {\n            $scope.orderCount.unpush = count;\n            state = \"undo\"; //未发布\n\n            $scope.workOrderData[\"tab\"] = false;\n          } else if (status == 200) {\n            $scope.orderCount.done = count;\n            state = \"did\"; //已完成\n\n            $scope.workOrderData[\"tab\"] = false;\n          } //$scope.orderData = returnObj.data;\n\n\n          $scope.workOrderData.data = returnObj.data;\n          $scope.orderGirtData.data = returnObj.data;\n          $scope.workOrderData.state = state;\n\n          if (status == 10) {\n            $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n          } else {\n            $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n          }\n        }\n      });\n    }; //查询条件事件\n\n\n    $scope.goSearch = function () {\n      var v = {};\n      v[\"title\"] = $scope.loaderValue;\n      v[\"status\"] = $scope.seleStatus;\n      searchList(v);\n      /*     if($scope.queryDitem.state > 0) {\n             v[$scope.queryDitem.attributeName] = $scope.loaderValue;\n             if($scope.seleStatus > 0){\n               v[\"status\"] = $scope.seleStatus;\n             }\n             searchList(v);\n           }else {\n             v['title'] = $scope.loaderValue;\n             if($scope.seleStatus > 0){\n               v[\"status\"] = $scope.seleStatus;\n             }\n             searchList(v);\n           }*/\n    }; //未发布工单查询刷新\n\n\n    $scope.wordCancel = function () {\n      $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n    }; //根据工单分类初始化工单流程\n\n\n    $scope.getOrderProcedure = function () {\n      /*  if ($scope.orderAddData.category == 10) {\n          $scope.processType = $scope.processType1;\n        } else if ($scope.orderAddData.category == 20) {\n          $scope.processType = $scope.processType2;\n        } else if ($scope.orderAddData.category == 30) {\n          $scope.processType = $scope.processType3;\n        } else if ($scope.orderAddData.category == 40) {\n          $scope.processType = $scope.processType4;\n        } else {\n          $scope.processType = [];\n        }*/\n      //通过传值方式获取流程分类\n      var processTypeList = $scope.processTypeData;\n      var processType = [];\n\n      for (var i in processTypeList) {\n        if (processTypeList[i].category == $scope.orderAddData.category) {\n          processType.push(processTypeList[i]);\n        }\n      }\n\n      $scope.processType = processType;\n    };\n    /**\n     * 新建工单\n     */\n\n\n    $scope.addWorkOrder = function (obj) {\n      if (obj) {\n        $scope.orderAddData = obj;\n      } else {\n        $scope.initAddList();\n      }\n\n      $scope.workOrderType = $scope.myDicts['ticketCategory'];\n      ngDialog.open({\n        template: '../partials/dialogue/add_workorder.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n      /*if($scope.addOrderShow){\n        growl.warning(\"当前有未保存工单\",{});\n      }else{\n        $scope.addOrderShow = true;\n        $scope.processType = [];\n      }*/\n    };\n    /**\n     * 获取各工单count(执行中，未发布，已完成)\n     */\n\n\n    function getDoingOrderCount() {\n      var status = 100;\n\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(100, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.doing = returnObj.data.length;\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": status\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.doing = returnObj.data.length;\n          }\n        });\n      }\n    }\n\n    function getUnpushOrderCount() {\n      var status = 10;\n\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(100, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.doing = returnObj.data.length;\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": status\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.unpush = returnObj.data.length;\n          }\n        });\n      }\n    }\n\n    function getDoneOrderCount() {\n      var status = 200;\n\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(100, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.doing = returnObj.data.length;\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": status\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.done = returnObj.data.length;\n          }\n        });\n      }\n    }\n\n    function getAllOrderCount() {\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByDeviceId(id, function (res) {\n          if (res.code == 0) {\n            $scope.orderCount.all = res.data.length;\n          }\n        });\n      } else {\n        ticketTaskService.getAllTickets(function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.all = returnObj.data.length;\n          }\n        });\n      }\n    }\n    /**\n     * 获取工单数据(执行中，未发布，已完成)\n     */\n\n\n    function getOrderData(status) {\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(status, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            var state = \"\";\n            var count = returnObj.data.length;\n\n            if (status == 100) {\n              $scope.orderCount.doing = count;\n              state = \"doing\"; //执行中\n\n              $scope.workOrderData[\"tab\"] = true;\n            } else if (status == 10) {\n              $scope.orderCount.unpush = count;\n              state = \"undo\"; //未发布\n\n              $scope.workOrderData[\"tab\"] = false;\n            } else if (status == 200) {\n              $scope.orderCount.done = count;\n              state = \"did\"; //已完成\n\n              $scope.workOrderData[\"tab\"] = false;\n            } //$scope.orderData = returnObj.data;\n\n\n            $scope.workOrderData.data = returnObj.data;\n            $scope.orderGirtData.data = returnObj.data;\n            $scope.workOrderData.state = state;\n\n            if (status == 10) {\n              $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n            } else {\n              $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n            }\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": status\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            var state = \"\";\n            var count = returnObj.data.length;\n\n            if (status == 100) {\n              $scope.orderCount.doing = count;\n              state = \"doing\"; //执行中\n\n              $scope.workOrderData[\"tab\"] = true;\n            } else if (status == 10) {\n              $scope.orderCount.unpush = count;\n              state = \"undo\"; //未发布\n\n              $scope.workOrderData[\"tab\"] = false;\n            } else if (status == 200) {\n              $scope.orderCount.done = count;\n              state = \"did\"; //已完成\n\n              $scope.workOrderData[\"tab\"] = false;\n            } //$scope.orderData = returnObj.data;\n\n\n            $scope.workOrderData.data = returnObj.data;\n            $scope.orderGirtData.data = returnObj.data;\n            $scope.workOrderData.state = state;\n\n            if (status == 10) {\n              $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n            } else {\n              $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n            }\n          }\n        });\n      }\n    }\n    /**\n     * 获取所有工单数据\n     */\n\n\n    function getAllOrderData() {\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByDeviceId(id, function (res) {\n          if (res.code == 0) {\n            $scope.orderCount.all = res.data.length;\n          }\n        });\n      } else {\n        ticketTaskService.getAllTickets(function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.workOrderData.data = returnObj.data;\n            $scope.orderCount.all = returnObj.data.length;\n            $scope.workOrderData.state = 'all'; //全部\n\n            $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n          }\n        });\n      }\n    }\n    /**\n     * 发起工单必输项验证\n     * @param o\n     */\n\n\n    var requiredFiledValidation = function requiredFiledValidation(o) {\n      var m = null;\n\n      if (!o.title || o.title == \"\") {\n        m = '工单名称不能为空';\n      } else if (!String(o.priorityCode) || String(o.priorityCode) == \"\") {\n        m = '紧急度不能为空';\n      } else if (!o.category || o.category == \"\") {\n        m = '工单类型不能为空';\n      } else if (!o.ticketCategoryId || o.ticketCategoryId == \"\") {\n        m = '工单流程不能为空';\n      } else if (!o.deviceId || o.deviceId == \"\" || o.deviceId == \"-1\") {\n        m = '设备不能为空';\n      } else if (!o.message || o.message == \"\") {\n        m = '工单内容不能为空';\n      }\n\n      return m;\n    };\n    /**\n     * 保存工单\n     */\n\n\n    $scope.saveOrder = function () {\n      //校验必输项\n\n      /* var rv = requiredFiledValidation($scope.orderAddData);\n       if (rv != null) {\n         growl.warning(rv, {});\n         return;\n       }*/\n      if ($scope.commitloading) {\n        growl.warning(\"请等待，正在保存工单\", {});\n        return;\n      }\n\n      $scope.commitloading = true;\n      $scope.orderAddData.values = $scope.definitions;\n      /* var cat = $scope.orderAddData.ticketCategoryId.split(\":\");\n       $scope.orderAddData.ticketCategoryId = cat[1];*/\n\n      $scope.orderAddData.deviceId = $scope.orderAddData.deviceId;\n      var ticket = $scope.orderAddData;\n      ticketTaskService.saveTicket(ticket, function (returnObj) {\n        $scope.commitloading = false;\n\n        if (returnObj.code == 0) {\n          growl.success(\"保存工单成功\", {});\n          $scope.closeDialog();\n          $scope.initAddList();\n          getAllOrderCount(); //刷新总工单数量\n\n          getDoingOrderCount();\n          getUnpushOrderCount();\n          $scope.addOrderShow = false; //跳转到未发布\n\n          if ($scope.activeTab.indexOf(\"未发布\") > -1) {\n            changeWorkOrderItem($scope.activeTab);\n          } else {\n            $('#myTab li:eq(3) a').tab('show');\n          }\n        }\n      });\n    };\n    /**\n     * 取消工单\n     */\n\n\n    $scope.cancelOrder = function () {\n      $scope.addOrderShow = false;\n      growl.info(\"取消发布工单\", {});\n      $scope.initAddList();\n    };\n    /**\n     * 发布工单\n     */\n\n\n    $scope.uploadOrder = function () {\n      /* var r = requiredFiledValidation($scope.orderAddData);\n       if (r != null) {\n         growl.warning(r, {});\n         return;\n       }*/\n      if ($scope.commitloading) {\n        growl.warning(\"请等待，正在发布工单\");\n        return;\n      }\n\n      $scope.commitloading = true;\n      $scope.orderAddData.values = $scope.definitions;\n      /*  var temporary = $scope.orderAddData.ticketCategoryId;\n        var cat = $scope.orderAddData.ticketCategoryId.split(\":\");\n        $scope.orderAddData.ticketCategoryId = cat[1];*/\n\n      $scope.orderAddData.deviceId = $scope.orderAddData.deviceId;\n      var ticket = $scope.orderAddData; //ticket.push(obj);\n\n      ticketTaskService.commitTicket(ticket, function (returnObj) {\n        $scope.commitloading = false;\n\n        if (returnObj.code == 0) {\n          //$scope.$apply();\n          growl.success(\"发布工单成功\", {});\n          $scope.closeDialog();\n          $scope.addOrderShow = false;\n          $scope.formAryList = [];\n\n          if ($scope.orderAddData.status == 10) {\n            var dataList = $scope.orderGirtData.data;\n\n            for (var j in dataList) {\n              if (dataList[j].ticketCategoryId == returnObj.data.ticketCategoryId) {\n                $scope.orderGirtData.data.splice(j, 1);\n                break;\n              }\n            }\n\n            $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n          }\n\n          $scope.initAddList();\n          getAllOrderCount(); //刷新总工单数量\n\n          getDoingOrderCount();\n          getDoneOrderCount();\n          getUnpushOrderCount(); //跳转到执行中\n\n          if ($scope.activeTab.indexOf(\"执行中\") > -1) {\n            changeWorkOrderItem($scope.activeTab);\n          } else {\n            $('#myTab li:eq(0) a').tab('show');\n          }\n        } else {\n          $scope.commitloading = false;\n          $scope.orderAddData.ticketCategoryId = \"\";\n        }\n      });\n    }; //格式化时间\n\n\n    var formatDate = function formatDate(str) {\n      if (str) {\n        str = newDateJson(str).Format(GetDateCategoryStrByLabel());\n      }\n\n      return str;\n    };\n\n    $scope.workOrderData = {\n      \"columnDefs\": [{\n        \"targets\": 1,\n        \"data\": \"ticketNo\",\n        \"render\": function render(data, type, full) {\n          return data;\n        }\n      }, {\n        \"targets\": 2,\n        \"data\": \"ticketCategoryId\",\n        \"render\": function render(data, type, full) {\n          //返回自定义内容\n          var str = \"\";\n\n          for (var i in $scope.processTypeData) {\n            if ($scope.processTypeData[i].id == data) {\n              str = $scope.processTypeData[i].name;\n            }\n          }\n\n          return str;\n        }\n      }, {\n        \"targets\": 3,\n        \"data\": \"status\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          var str = \"\";\n          var strIcon = \"\";\n\n          if (data == 10) {\n            str = \"未发布\";\n            strIcon = \"label-primary\";\n          } else if (data == 100) {\n            str = \"处理中\";\n            strIcon = \"label-warning\";\n          } else if (data == 200) {\n            str = \"已完成\";\n            strIcon = \"label-info\";\n          } else if (data == 150) {\n            str = \"已撤销\";\n            strIcon = \"label-info\";\n          }\n\n          return \"<span class='label \" + strIcon + \"'>\" + str + \"</span>\";\n        }\n      }, {\n        \"targets\": 5,\n        \"data\": \"\",\n        \"render\": function render(data, type, full) {\n          //  返回自定义内容\n          return formatDate(data);\n        }\n      }, {\n        \"targets\": 6,\n        \"data\": \"\",\n        \"render\": function render(data, type, full) {\n          //  返回自定义内容\n          return formatDate(data);\n        }\n      }, {\n        \"targets\": 8,\n        \"data\": \"option\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          var str = \"<div class='btn-group btn-group-sm'>\";\n\n          if ($scope.menuitems['A01_S09']) {\n            str += \"<button id='history'    class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 执行历史</span></button>\";\n          }\n\n          if ($scope.activeTab == null || $scope.activeTab.indexOf(\"执行中\") > -1 && $scope.menuitems['A06_S09']) {\n            str += \"<button id='revoke'   class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 撤销</span></button>\";\n          }\n\n          str += \"</div>\";\n          return str;\n        }\n      }]\n    };\n    $scope.orderGirtData = {\n      \"columns\": [{\n        \"data\": \"title\",\n        \"title\": \"工单名称\"\n      }, {\n        \"data\": \"ticketCategoryId\",\n        \"title\": \"工单流程\"\n      }, {\n        \"data\": \"status\",\n        \"title\": \"工单状态\"\n      }, $.ProudSmart.datatable.optionCol2],\n      \"columnDefs\": [{\n        \"targets\": 0,\n        \"data\": \"title\",\n        \"render\": function render(data, type, full) {\n          return \"<span style='cursor: pointer;'>\" + data + \"</span>\";\n        }\n      }, {\n        \"targets\": 1,\n        \"data\": \"ticketCategoryId\",\n        \"render\": function render(data, type, full) {\n          var str = \"\";\n\n          for (var i in $scope.processTypeData) {\n            if ($scope.processTypeData[i].id == data) {\n              str = $scope.processTypeData[i].name;\n            }\n          }\n\n          return \"<span style='cursor: pointer;'>\" + str + \"</span>\";\n        }\n      }, {\n        \"targets\": 2,\n        \"data\": \"status\",\n        \"render\": function render(data, type, full) {\n          return \"<span style='cursor: pointer;' class='label \" + (data == 10 ? \"label-primary\" : data == 100 ? \"label-warning\" : \"label-info\") + \"'>\" + (data == 10 ? \"未发布\" : data == 100 ? \"处理中\" : \"已完成\") + \"</span>\";\n        }\n      }, {\n        \"targets\": 3,\n        \"data\": \"option\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          var str = \"<div class='btn-group btn-group-sm'>\";\n\n          if ($scope.menuitems['A07_S09']) {\n            str += \"<button id='release-btn'   class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 发布</span></button>\";\n          }\n\n          if ($scope.menuitems['A08_S09']) {\n            str += \"<button id='del-btn'   class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\";\n          }\n\n          str += \"</div>\";\n          return str;\n        }\n      }]\n    };\n\n    $scope.cancelTicket = function (ticketNo) {\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: '确认要撤销该工单？',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            dialogRef.close();\n            ticketTaskService.cancelTicket(ticketNo, function (resultObj) {\n              if (resultObj.code == 0) {\n                growl.success(\"撤销工单成功!\", {}); //changeWorkOrderItem(\"执行中\");\n\n                if (type == \"gateway\") {\n                  ticketTaskService.getTicketsByStatusAndDeviceId(100, id, function (returnObj) {\n                    if (returnObj.code == 0) {\n                      $scope.workOrderData.data = returnObj.data;\n                      $scope.orderCount.doing = returnObj.data.length;\n                      $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n                    }\n                  });\n                } else {\n                  var obj = {\n                    \"status\": 100\n                  };\n                  ticketTaskService.findTickets(obj, function (returnObj) {\n                    $scope.workOrderData.data = returnObj.data;\n                    $scope.orderCount.doing = returnObj.data.length;\n                    $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n                  });\n                } // $scope.$broadcast(Event.WORKORDERINIT+\"_order\", $scope.orderGirtData);\n\n              }\n            });\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.delTicket = function (ticketNo) {\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: '是否要删除该工单',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            ticketService.deleteTicket(ticketNo, function (resultObj) {\n              if (resultObj.code == 0) {\n                growl.success(\"删除工单成功!\", {});\n\n                if (type == \"gateway\") {\n                  ticketTaskService.getTicketsByStatusAndDeviceId(10, id, function (returnObj) {\n                    if (returnObj.code == 0) {\n                      $scope.workOrderData.data = returnObj.data;\n                      $scope.orderCount.doing = returnObj.data.length;\n                      $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n                    }\n                  });\n                } else {\n                  var obj = {\n                    \"status\": 10\n                  };\n                  ticketTaskService.findTickets(obj, function (returnObj) {\n                    $scope.orderGirtData.data = returnObj.data;\n                    $scope.orderCount.unpush = returnObj.data.length;\n                    $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n                  }); // $scope.$broadcast(Event.WORKORDERINIT+\"_order\", $scope.orderGirtData);\n                }\n              }\n            });\n            dialogRef.close();\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.tabStatus = \"false\";\n\n    var changeWorkOrderItem = function changeWorkOrderItem(activeTab) {\n      if (activeTab == null || activeTab.indexOf(\"执行中\") > -1) {\n        getOrderData(100);\n        $scope.workOrderData[\"tab\"] = true;\n        $scope.seleStatus = 100;\n      } else if (activeTab.indexOf(\"未发布\") > -1) {\n        getOrderData(10);\n        $scope.seleStatus = 10;\n      } else if (activeTab.indexOf(\"已完成\") > -1) {\n        getOrderData(200);\n        $scope.seleStatus = 200;\n        $scope.workOrderData[\"tab\"] = false;\n      } else if (activeTab.indexOf(\"全部工单\") > -1) {\n        getAllOrderData();\n        $scope.seleStatus = 0;\n        $scope.workOrderData[\"tab\"] = false;\n      }\n    };\n\n    $scope.cancelOrderNo = function () {\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(10, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.workOrderData.data = returnObj.data;\n            $scope.orderCount.doing = returnObj.data.length;\n            $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": 10\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          $scope.orderGirtData.data = returnObj.data;\n          $scope.orderCount.unpush = returnObj.data.length;\n          $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n        }); // $scope.$broadcast(Event.WORKORDERINIT+\"_order\", $scope.orderGirtData);\n      }\n    };\n    /**\n     * tab页的事件监听\n     */\n\n\n    var initEvent = function initEvent() {\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        if ($(e.target).closest(\"li.disabled\").length > 0) {\n          $(e.target).closest(\"li.disabled\").removeClass(\"active\");\n          $(e.target).closest(\"ul\").children(\"[name=\" + $scope.activeListTab + \"]\").addClass(\"active\");\n          return;\n        }\n\n        var aname = $(e.target).closest(\"li\").attr(\"name\");\n\n        if (aname) {\n          $scope.activeListTab = aname;\n          $scope.$apply();\n          $scope.initAddList(); // 获取已激活的标签页的名称\n\n          $scope.activeTab = $(e.target).text(); // 获取前一个激活的标签页的名称\n\n          previousTab = $(e.relatedTarget).text();\n          $scope.addOrderShow = false;\n          changeWorkOrderItem($scope.activeTab);\n        }\n      });\n    }; //初始化工单管理\n\n\n    function init() {\n      initEvent();\n      $scope.initAddList(); //根据状态获取工单数量\n\n      getUnpushOrderCount();\n      getDoneOrderCount(); //获取所有工单\n\n      getAllOrderCount();\n      getDoingOrderCount();\n      getProcedure();\n\n      if ($routeParams && $routeParams.state) {\n        //从工单详情返回到工单管理页面\n        var activeTab = \"\";\n        var id = null;\n\n        switch ($routeParams.state) {\n          case 'doing':\n            activeTab = \"执行中\";\n            id = 0;\n            break;\n\n          case 'did':\n            activeTab = \"已完成\";\n            id = 1;\n            break;\n\n          case 'all':\n            activeTab = \"全部工单\";\n            id = 2;\n            break;\n\n          case 'undo':\n            activeTab = \"未发布\";\n            id = 3;\n            break;\n        }\n\n        $(\"#myTab li:eq(\" + id + \") a\").tab('show');\n        changeWorkOrderItem(activeTab);\n      } else {\n        //进入工单管理页面\n        getOrderData(100); //执行中\n      }\n    }\n\n    init();\n  }]);\n});"],"sourceRoot":"/source/"}