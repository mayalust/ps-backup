{"version":3,"sources":["js/controllers/view-alert-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","$routeParams","ngDialog","userLoginUIService","alertService","SwSocket","Info","viewFlexService","alertManageFlexService","growl","ticketCategoryService","ticketService","processService","$filter","$timeout","$location","console","info","viewInfo","searchAlertData","states","alertStyle","columns","columsData","uuid","Math","priority","value","label","get","callback","evendata","length","tmp","forEach","item","alertId","data","message","title","severity","state","arisingTime","push","$broadcast","Event","ALERTINFOSINIT","option","processTypeData","getTicketCategorys","returnObj","code","getOrderProcedure","processType","processTypeList","i","category","orderData","showOrder","initHistry","open","template","className","scope","getOrderData","getAllTickets","workOrderData","getColumns","ary","col","visible","colobj","Object","dataField","headerText","checkObj","width","unshift","formatDate","str","newDateJson","Format","GetDateCategoryStrByLabel","initAlertInfo","alertReturnObj","profile","alertItme","view","jQuery","xml2json","hasOwnProperty","style","column","alertobj","claimTime","firstArisingTime","updateTime","receiveTime","path","selLength","param","viewId","unregister","operation","register","send","priorityCode","ticketCategoryId","values","deviceId","faultId","confirmActiveAlert","closeActiveAlert","selectedHandler","pageAlertList","obj","selected","$apply","ngDialogOrder","rowData","alertInfo","actionType","alertIds","target","nodeId","appName","alertDefinition","alertCode","nodeTypeList","e","faultList","doAction","type","select","callbackFun","sendClaimAction","success","recoverAll","resolved","clearOut","show","closable","buttons","cssClass","action","dialogRef","sendRecoverAction","splice","close","rv","o","m","String","warning","commitloading","cat","split","ticket","sendForwardAction","closeDialog","selectAlertList","search","searchStatus","commitItem","alertViewClick","reloadViewId","queryByView","pipeline","opts","conf","$","extend","pages","url","method","cacheLower","cacheUpper","cacheLastRequest","cacheLastJson","request","drawCallback","settings","ajax","requestStart","start","drawStart","requestLength","requestEnd","order","pop","clearCache","JSON","stringify","isFunction","d","isPlainObject","pageRequest","statCount","draw","getDevicesByPage","total","json","recordsTotal","undefined","recordsFiltered","ajaxListUpdate","queryItem","getAlertByPage","configAlert","init","myDicts","p","queryFromCache","key","$on","event","args"],"mappings":"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","file":"js/controllers/view-alert-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('ViewAlertCtrl', ['$scope', '$routeParams', 'ngDialog', 'userLoginUIService', 'alertService', 'SwSocket', 'Info', 'viewFlexService', 'alertManageFlexService', 'growl', 'ticketCategoryService', 'ticketService', 'processService', '$filter', '$timeout', '$location', function ($scope, $routeParams, ngDialog, userLoginUIService, alertService, SwSocket, Info, viewFlexService, alertManageFlexService, growl, ticketCategoryService, ticketService, processService, $filter, $timeout, $location) {\n    console.info(\"进入设备故障\");\n    var columns = [];\n    var columsData = [];\n    var viewInfo;\n    var searchAlertData;\n    var stateIndex;\n    var severityIndex;\n    var states;\n    var uuid = Math.uuid(); // $scope.commitloading = false; //发布工单，取消工单状态。目的不让多次点击提交取消\n\n    $scope.priority = [{\n      \"value\": \"0\",\n      \"label\": \"低\"\n    }, {\n      \"value\": \"100\",\n      \"label\": \"中\"\n    }, {\n      \"value\": \"200\",\n      \"label\": \"高\"\n    }];\n    var alertStyle;\n    var info = Info.get(\"../localdb/info.json\", function (info) {\n      alertStyle = info.alertStyle;\n    });\n\n    var callback = function callback(evendata) {\n      if (columsData.length > 0) {\n        var tmp = 0;\n        columsData.forEach(function (item) {\n          if (item.alertId == evendata.data.alertId) {\n            tmp = 1;\n            item.message = evendata.data.message;\n            item.title = evendata.data.title;\n            item.severity = evendata.data.severity;\n            item.state = evendata.data.state;\n            item.arisingTime = evendata.data.arisingTime;\n          }\n        });\n\n        if (tmp <= 0) {\n          columsData.push(evendata.data);\n        }\n      } else {\n        columsData.push(evendata.data);\n      }\n\n      $scope.$broadcast(Event.ALERTINFOSINIT + \"_view\", {\n        \"option\": [columsData]\n      });\n      /*var addDatas = [];\n      $scope.$broadcast('OptionStatusChange', {\n        \"data\": addDatas\n      });*/\n    };\n\n    $scope.processTypeData = [];\n\n    var getProcedure = function getProcedure() {\n      ticketCategoryService.getTicketCategorys(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.processTypeData = returnObj.data;\n          /*  var arr1 = [];\n            var arr2 = [];\n            var arr3 = [];\n            var arr4 = [];\n            var arr5 = [];\n            for(var i in returnObj.data) {\n              if(returnObj.data[i].category == 10) { //告警工单\n                arr1.push(returnObj.data[i]);\n              } else if(returnObj.data[i].category == 20) {\n                arr2.push(returnObj.data[i]);\n              } else if(returnObj.data[i].category == 30) {\n                arr3.push(returnObj.data[i]);\n              } else if(returnObj.data[i].category == 40) {\n                arr4.push(returnObj.data[i]);\n              }else if(returnObj.data[i].category == 50) {\n                arr5.push(returnObj.data[i]);\n              }\n            }\n            $scope.processType1 = arr1;\n            $scope.processType2 = arr2;\n            $scope.processType3 = arr3;\n            $scope.processType4 = arr4;\n            $scope.processType5 = arr5;*/\n        }\n      });\n    };\n\n    getProcedure();\n\n    $scope.getOrderProcedure = function () {\n      /* if($scope.orderData.category == 10) {\n        $scope.processType = $scope.processType1;\n        } else if($scope.orderData.category == 20) {\n        $scope.processType = $scope.processType2;\n        } else if($scope.orderData.category == 30) {\n        $scope.processType = $scope.processType3;\n        } else if($scope.orderData.category == 40) {\n        $scope.processType = $scope.processType4;\n        } else if($scope.orderData.category == 50) {\n        $scope.processType = $scope.processType5;\n        } else {\n        $scope.processType = [];\n        }*/\n      $scope.processType = [];\n      var processTypeList = $scope.processTypeData;\n\n      for (var i in processTypeList) {\n        if (processTypeList[i].category == $scope.orderData.category) {\n          $scope.processType.push(processTypeList[i]);\n        }\n      }\n    }; //添加工单\n\n\n    $scope.showOrder = function () {\n      initHistry();\n      ngDialog.open({\n        template: 'addOrder',\n        className: 'ngdialog-theme-plain',\n        scope: $scope\n      });\n    };\n    /**\n     * 获取工单数据\n     *\n     * orderId\n     */\n\n\n    $scope.getOrderData = function () {\n      ticketService.getAllTickets(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.workOrderData = returnObj.data;\n        }\n      });\n    };\n\n    $scope.getOrderData();\n\n    var getColumns = function getColumns(ary) {\n      for (var i in ary) {\n        var col = ary[i];\n\n        if (col.visible == true || col.visible == \"true\") {\n          var colobj = new Object();\n          colobj.data = col.dataField;\n          colobj.title = col.headerText;\n          columns.push(colobj);\n\n          if (colobj.data == \"state\") {\n            stateIndex = columns.length - 1;\n          } else if (colobj.data == \"severity\") {\n            severityIndex = columns.length - 1;\n          }\n        }\n      }\n\n      var colobj = new Object();\n      colobj.data = \"option\";\n      colobj.title = \"操作\";\n      columns.push(colobj); //告警查询添加，转工单，确认，关闭的全选\n\n      var checkObj = {};\n      checkObj.data = \"selected\";\n      checkObj.title = '<input id=\"allselect-btn\" type=\"checkbox\">';\n      checkObj.width = \"8px\";\n      columns.unshift(checkObj);\n    };\n\n    var formatDate = function formatDate(str) {\n      if (str) {\n        str = newDateJson(str).Format(GetDateCategoryStrByLabel());\n      }\n\n      return str;\n    };\n\n    var initAlertInfo = function initAlertInfo(alertReturnObj) {\n      columns = [];\n      columsData = [];\n      var alertItme = viewInfo.view;\n      var profile;\n      if (alertItme) profile = jQuery.xml2json(alertItme.profile);\n\n      if (profile != null && profile.hasOwnProperty(\"style\")) {\n        getColumns(profile.style.column);\n      } else {\n        getColumns(alertStyle);\n      } // var columnDefs = [];\n      // if (stateIndex != -1) {\n      //   columnDefs.push({\n      //     \"targets\": stateIndex + 1,\n      //     \"data\": \"state\",\n      //     \"render\": function(data, type, full) {\n      //       var stateStr;\n      //       // 返回自定义内容\n      //       if (data == 0)\n      //         stateStr = \"<span class='label label-info'>新产生</span>\";\n      //       else if (data == 5)\n      //         stateStr = \"<span class='label label-primary'>已确认</span>\";\n      //       else if (data == 10)\n      //         stateStr = \"<span class='label label-warning'>处理中</span>\";\n      //       else if (data == 20)\n      //         stateStr = \"<span class='label label-success'>已解决</span>\";\n      //       else if (data == 30)\n      //         stateStr = \"已忽略\";\n      //       else\n      //         stateStr = \"未知\";\n      //       return stateStr;\n      //     }\n      //   })\n      // }\n      // if (severityIndex != -1) {\n      //   columnDefs.push({\n      //     \"targets\": severityIndex + 1,\n      //     \"data\": \"severity\",\n      //     \"render\": function(data, type, full) {\n      //       // 返回自定义内容\n      //       var severityStr = \"未知\";\n      //       var severityBg = \"alerts-warning\";\n      //       if (data == 4) {\n      //         severityStr = \"严重\";\n      //         severityBg = \"alerts-critical\";\n      //       } else if (data == 3) {\n      //         severityStr = \"重要\";\n      //         severityBg = \"alerts-major\";\n      //       } else if (data == 2) {\n      //         severityStr = \"次要\";\n      //         severityBg = \"alerts-minor\";\n      //       } else if (data == 1) {\n      //         severityStr = \"警告\";\n      //         severityBg = \"alerts-warning\";\n      //       }\n      //       return \"<span class='label \" + severityBg + \"'>\" + severityStr + \"</span>\";\n      //     }\n      //   })\n      // }\n      // columnDefs.push({\n      //   \"targets\": 0,\n      //   \"data\": \"selected\",\n      //   \"render\": function(data, type, full) {\n      //     // 返回自定义内容\n      //     if (type == \"display\") {\n      //       if (data) {\n      //         return '<input class=\"itemCheckBox\" checked type=\"checkbox\">';\n      //       } else {\n      //         return '<input class=\"itemCheckBox\" type=\"checkbox\">';\n      //       }\n      //     }\n      //     return \"\";\n      //   }\n      // });\n      // columnDefs.push({\n      //   \"targets\": 1,\n      //   \"data\": \"title\",\n      //   \"render\": function(data, type, full) {\n      //     // 返回自定义内容\n      //     var domainstring = '';\n      //     for (var i in full.domainList) {\n      //       domainstring += full.domainList[i] + '-';\n      //     }\n      //     domainstring = domainstring.substring(0, domainstring.length - 1);\n      //     if (full.kpiCode == 0) {\n      //       var str = \"<a href='#/resource_type/\" + full.nodeTypeList[full.nodeTypeList.length - 1] + \"/fault'>\" + data + \"</a>\";\n      //     } else {\n      //       var str = \"<a href='#/resource_type/\" + full.nodeTypeList[full.nodeTypeList.length - 1] + \"/alert'>\" + data + \"</a>\";\n      //     }\n      //     return str;\n      //   }\n      // });\n      // columnDefs.push({\n      //   \"targets\": 5,\n      //   \"data\": \"arisingTime\",\n      //   \"render\": function(data, type, full) {\n      //     // 返回自定义内容\n      //     var str;\n      //     str = $filter('date')(data, 'yyyy-MM-dd HH:mm:ss');\n      //     //str = \"<span date-label value=\" + data + \" format='yyyy-MM-dd HH:mm:ss'></span>\";\n      //     return str;\n      //   }\n      // });\n      // columnDefs.push({\n      //   \"targets\": 2,\n      //   \"data\": \"message\",\n      //   \"render\": function(data, type, full) {\n      //     // 返回自定义内容\n      //     var str;\n      //     str = escape(data);\n      //     return str;\n      //   }\n      // });\n      // columnDefs.push({\n      //   \"targets\": columns.length - 1,\n      //   \"orderable\": false,\n      //   \"data\": \"option\",\n      //   \"width\": \"141px\",\n      //   \"render\": function(data, type, full) {\n      //     // 返回自定义内容\n      //     var str = \"<div class='btn-group btn-group-sm'>\";\n      //     if (full.state == 0) {\n      //       str += \"<button id='claim-btn' class='btn btn-primary' ><span class='hidden-xs'> 确认</span></button>\";\n      //       str += \"<button id='close-btn' class='btn btn-default' ><span class='hidden-xs'> 关闭</span></button>\";\n      //       str += \"<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>\";\n      //       str += \"<ul class='dropdown-menu' role='menu'>\";\n      //       str += \"<li><a role='button' id='order-btn'>转工单</a></li>\";\n      //       str += \"</ul></div>\";\n      //     }\n      //     if (full.state == 5) {\n      //       str += \"<button id='order-btn' class='btn btn-primary btn-sm'><span> 转工单</span></button>\";\n      //       str += \"<button id='close-btn' class='btn btn-default btn-sm'><span > 关闭</span></button>\";\n      //       str += \"</div>\";\n      //     }\n      //     if (full.state == 10) {\n      //       str += \"<button id='close-btn' class='btn btn-default btn-sm'><span > 关闭</span></button>\";\n      //       str += \"</div>\";\n      //     }\n      //     if (full.state == 20) { // 处理中的告警不能关？\n      //       str = \"<div class='btn-group table-option-group'>\" +\n      //         \"<button type='button' class='btn btn-sm' style='cursor:text;'>操作</button>\" +\n      //         \"<button type='button' class='btn btn-sm dropdown-toggle' style='cursor:text;'>\" +\n      //         \"<span class='caret'></span>\" +\n      //         \"<span class='sr-only'>Toggle Dropdown</span>\" +\n      //         \"</button>\" +\n      //         \"</div>\";\n      //     }\n      //     return str;\n      //   }\n      // });\n      // if (!alertReturnObj) { //原始进入页面数据为空\n      //   $timeout(function() {\n      //     $scope.$broadcast(Event.ALERTINFOSINIT, {\n      //       \"option\": [\n      //         []\n      //       ]\n      //     });\n      //   })\n      //   return;\n      // }\n\n\n      for (var i in alertReturnObj) {\n        var alertobj = alertReturnObj[i];\n        alertobj.arisingTime = alertobj.arisingTime;\n        alertobj.claimTime = formatDate(alertobj.claimTime);\n        alertobj.firstArisingTime = formatDate(alertobj.firstArisingTime);\n        alertobj.updateTime = formatDate(alertobj.updateTime);\n        alertobj.receiveTime = formatDate(alertobj.receiveTime);\n        columsData.push(alertobj);\n      }\n      /*$timeout(function() {\n        $scope.$broadcast(Event.ALERTINFOSINIT, {\n          \"option\": [columsData]\n        });\n      })*/\n\n\n      if ($location.path() == \"/configAlert\") {\n        $scope.selLength = 10;\n        $scope.$broadcast(Event.ALERTINFOSINIT + \"_view\", {\n          \"option\": [columsData]\n        });\n        var param = {\n          viewId: alertItme.viewId\n        };\n        SwSocket.unregister(uuid);\n        uuid = Math.uuid();\n        var operation = \"register\"; //考虑极端情况，一个页面有多个模块监听同一个方法\n        //但展示在页面的数据需对接收的实时监听的数据做不同处理\n\n        SwSocket.register(uuid, operation, callback); //websocket发送请求\n\n        SwSocket.send(uuid, operation, 'alertView', param);\n      } else {\n        $scope.$broadcast(Event.ALERTINFOSINIT, {\n          \"option\": []\n        });\n      }\n    };\n\n    var getAlertData = function getAlertData() {\n      alertService.queryByView(viewInfo.viewId, null, function (returnObj) {\n        if (returnObj.code == 0) {\n          initAlertInfo(returnObj.data);\n        }\n      });\n    };\n    /**\n     * 提交告警转工单对象\n     */\n\n\n    var initHistry = function initHistry() {\n      $scope.orderData = {\n        \"title\": \"\",\n        \"priorityCode\": \"0\",\n        \"category\": \"\",\n        \"ticketCategoryId\": \"\",\n        \"values\": null,\n        \"deviceId\": \"\",\n        \"faultId\": \"\",\n        \"message\": \"\"\n      };\n    };\n    /**\n     * 发起工单必输项验证\n     * @param o\n     */\n\n\n    var requiredFiledValidation = function requiredFiledValidation(o) {\n      var m = null;\n\n      if (!o.title || o.title == \"\") {\n        m = '工单名称不能为空';\n      } else if (o.priorityCode == null || !String(o.priorityCode) || String(o.priorityCode) == \"\") {\n        m = '紧急度不能为空';\n      } else if (!o.category || o.category == \"\") {\n        m = '工单类型不能为空';\n      } //  else if (!o.ticketCategoryId || o.ticketCategoryId == \"\") {\n      //   m = '工单流程不能为空';\n      // }\n      else if (!o.message || o.message == \"\") {\n          m = '工单内容不能为空';\n        }\n\n      return m;\n    };\n\n    $scope.confirmActiveAlert = [];\n    $scope.closeActiveAlert = [];\n\n    $scope.selectedHandler = function () {\n      $scope.confirmActiveAlert = [];\n      $scope.closeActiveAlert = [];\n      $scope.pageAlertList.forEach(function (obj) {\n        if (obj.selected && obj.state == 0) {\n          $scope.confirmActiveAlert.push(obj);\n          $scope.closeActiveAlert.push(obj);\n        } else if (obj.selected && (obj.state == 5 || obj.state == 10)) {\n          $scope.closeActiveAlert.push(obj);\n        }\n      });\n      $scope.$apply();\n    };\n\n    $scope.ngDialogOrder = function (rowData) {\n      $scope.alertInfo = {\n        \"actionType\": \"forward\",\n        \"alertIds\": [rowData.alertId],\n        \"severity\": 0,\n        \"target\": \"EOMS://auttest/auttest\"\n      };\n      $scope.orderData = {\n        \"title\": rowData.title,\n        \"priorityCode\": \"\",\n        \"category\": \"\",\n        \"ticketCategoryId\": \"\",\n        \"values\": null,\n        \"deviceId\": rowData.nodeId,\n        \"appName\": rowData.appName,\n        \"faultId\": \"\",\n        \"message\": rowData.message\n      };\n      $scope.alertDefinition(rowData.alertCode, rowData.nodeTypeList[rowData.nodeTypeList.length - 1], function (e) {\n        if ($scope.faultList.length > 0) {\n          $scope.orderData.faultId = $scope.faultList[0].faultId;\n        }\n      });\n      $scope.priority = [{\n        \"value\": \"0\",\n        \"label\": \"低\"\n      }, {\n        \"value\": \"100\",\n        \"label\": \"中\"\n      }, {\n        \"value\": \"200\",\n        \"label\": \"高\"\n      }];\n      var severity = rowData.severity;\n\n      if (severity == 1 || severity == 2) {\n        severity = $scope.priority[0].value;\n      } else if (severity == 3) {\n        severity = $scope.priority[1].value;\n      } else if (severity == 5 || severity == 4) {\n        severity = $scope.priority[2].value;\n      }\n\n      $scope.orderData.priorityCode = severity;\n      ngDialog.open({\n        template: '../partials/dialogue/add_order.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n    };\n\n    $scope.doAction = function (type, select, callbackFun) {\n      if (type == \"claim\") {\n        var alertInfo = {\n          actionType: \"claim\",\n          alertIds: select\n        }; // callbackFun(alertInfo);\n\n        alertManageFlexService.sendClaimAction(alertInfo, function (returnObj) {\n          if (returnObj.code == 0) {\n            growl.success(\"确认告警成功\", {});\n\n            if (callbackFun) {\n              callbackFun(true);\n            }\n          }\n        });\n      } else if (type == \"claim2\") {\n        var alertInfo = {\n          actionType: \"claim\",\n          alertIds: select\n        }; // callbackFun(alertInfo);\n\n        alertManageFlexService.sendClaimAction(alertInfo, function (returnObj) {\n          if (returnObj.code == 0) {\n            if (callbackFun) {\n              callbackFun(true);\n            }\n          }\n        });\n      } else if (type == \"close\") {\n        var alertInfo = {\n          \"actionType\": \"recover\",\n          \"alertIds\": select,\n          \"recoverAll\": true,\n          \"resolved\": true,\n          \"clearOut\": true\n        }; // callbackFun(alertInfo);\n\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认关闭告警吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              alertManageFlexService.sendRecoverAction(alertInfo, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"关闭告警成功\", {});\n\n                  for (var i = columsData.length - 1; i > -1; i--) {\n                    var delItem = columsData[i];\n\n                    if (delItem.alertId == select.alertId) {\n                      columsData.splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  ; // if (callbackFun) {\n                  // if ($location.path() == \"/configAlert/0\") {\n\n                  callbackFun(returnObj);\n                  dialogRef.close(); // } else {\n                  //   callbackFun(false)\n                  // }\n                  // }\n                }\n              });\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"close2\") {\n        var alertInfo = {\n          \"actionType\": \"recover\",\n          \"alertIds\": select,\n          \"recoverAll\": true,\n          \"resolved\": true,\n          \"clearOut\": true\n        };\n        alertManageFlexService.sendRecoverAction(alertInfo, function (returnObj) {\n          if (returnObj.code == 0) {\n            for (var i = columsData.length - 1; i > -1; i--) {\n              var delItem = columsData[i];\n\n              if (delItem.alertId == select.alertId) {\n                columsData.splice(i, 1);\n                break;\n              }\n            }\n\n            ; // if (callbackFun) {\n            // if ($location.path() == \"/configAlert/0\") {\n\n            callbackFun(true); // } else {\n            //   callbackFun(false)\n            // }\n            // }\n          } else {\n            callbackFun(false);\n          }\n        });\n      } else if (type == \"order\") {\n        $scope.alertInfo = {\n          \"actionType\": \"forward\",\n          \"alertIds\": select,\n          \"severity\": 0,\n          \"target\": \"EOMS://auttest/auttest\"\n        };\n        $scope.showOrder(); // callbackFun($scope.alertInfo);\n      } else if (type == \"submit-btn\") {\n        //校验必输项\n        var rv = requiredFiledValidation($scope.orderData);\n\n        if (rv != null) {\n          growl.warning(rv, {});\n          return;\n        }\n\n        if ($scope.commitloading) {\n          growl.warning(\"请等待，正在发布工单\");\n          return;\n        } // $scope.commitloading = true;\n\n\n        var cat = $scope.orderData.ticketCategoryId.split(\":\");\n        var ticket = {\n          \"title\": $scope.orderData.title,\n          \"category\": $scope.orderData.category,\n          \"ticketCategoryId\": cat[1],\n          \"priorityCode\": $scope.orderData.priorityCode,\n          \"faultId\": $scope.orderData.faultId,\n          \"deviceId\": $scope.orderData.deviceId,\n          \"message\": $scope.orderData.message\n        };\n        var alertInfo = $scope.alertInfo;\n        alertManageFlexService.sendForwardAction(alertInfo, ticket, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.commitloading = false;\n            $scope.closeDialog();\n            growl.success(\"已转工单\", {}); //$(\"#newtr\").css(\"display\",\"none\");\n            //这里有两种情况“设备故障”，“故障查询”\n\n            if ($routeParams && $routeParams.nodeId) {\n              //故障查询\n              var item = {\n                viewId: null,\n                nodeId: $routeParams.nodeId\n              };\n\n              if ($scope.selectAlertList.search) {\n                $scope.selectAlertList.searchStatus = true;\n                $scope.$broadcast(Event.ALERTINFOSINIT, {\n                  \"option\": []\n                });\n              } else {\n                $scope.$broadcast(\"alertViewClick\", {\n                  \"option\": item\n                });\n              }\n            } else {\n              //设备故障\n              if (callbackFun) {\n                callbackFun(true);\n              } // if($scope.commitItem) {\n              //   $scope.alertViewClick($scope.commitItem);\n              // } else {\n\n              /*if($scope.selectAlertList.search){\n                $scope.selectAlertList.searchStatus = true;\n                $scope.$broadcast(Event.ALERTINFOSINIT, {\n                  \"option\": []\n                });\n              }else {\n                $scope.$broadcast(\"alertViewClick\", {\n                  \"option\": item\n                });\n              }*/\n\n            } // }\n\n          } else {\n            $scope.commitloading = false;\n          }\n        });\n      } else if (type == \"cancel-btn\") {\n        //这里有两种情况，设备故障和故障查询\n        if ($routeParams && $routeParams.nodeId) {\n          //故障查询\n          var item = {\n            viewId: null,\n            nodeId: $routeParams.nodeId\n          };\n          $scope.$broadcast(\"alertViewClick\", {\n            \"option\": item\n          });\n        } else {\n          //设备故障\n          if ($scope.commitItem) {\n            $scope.alertViewClick($scope.commitItem);\n          } else {\n            $scope.$broadcast(\"alertViewClick\", {\n              \"option\": \"\",\n              \"states\": states\n            });\n          }\n        }\n\n        growl.success(\"取消告警转工单\", {});\n      }\n    };\n\n    $scope.reloadViewId = function () {\n      alertService.queryByView(viewInfo.viewId, null, function (returnObj) {\n        if (returnObj.code == 0) {\n          columsData = [];\n          var alertReturnObj = returnObj.data;\n\n          for (var i in alertReturnObj) {\n            var alertobj = alertReturnObj[i];\n            alertobj.arisingTime = alertobj.arisingTime;\n            alertobj.claimTime = formatDate(alertobj.claimTime);\n            alertobj.firstArisingTime = formatDate(alertobj.firstArisingTime);\n            alertobj.updateTime = formatDate(alertobj.updateTime);\n            alertobj.receiveTime = formatDate(alertobj.receiveTime);\n            columsData.push(alertobj);\n          }\n\n          $scope.selLength = 10;\n          $scope.$broadcast(Event.ALERTINFOSINIT + \"_view\", {\n            \"option\": [columsData]\n          });\n        }\n      });\n    };\n\n    $scope.pipeline = function (opts) {\n      // Configuration options\n      var conf = $.extend({\n        pages: 1,\n        // number of pages to cache\n        url: '',\n        // script url\n        data: null,\n        // function or object with parameters to send to the server\n        // matching how `ajax.data` works in DataTables\n        method: 'POST' // Ajax HTTP method\n\n      }, opts); // Private variables for storing the cache\n\n      var cacheLower = -1;\n      var cacheUpper = null;\n      var cacheLastRequest = null;\n      var cacheLastJson = null;\n      return function (request, drawCallback, settings) {\n        var ajax = false;\n        var requestStart = request.start;\n        var drawStart = request.start;\n        var requestLength = request.length;\n        var requestEnd = requestStart + requestLength; //        var sort = request.columns[request.order[0].column].data; //排序列的字段\n        //        var sortType = request.order[0].dir; //排序的方式\n\n        request.order.pop();\n\n        if (settings.clearCache) {\n          // API requested that the cache be cleared\n          ajax = true;\n          settings.clearCache = false;\n        } else if (cacheLower < 0 || requestStart < cacheLower || requestEnd > cacheUpper) {\n          // outside cached data - need to make a request\n          ajax = true;\n        } else if (JSON.stringify(request.order) !== JSON.stringify(cacheLastRequest.order) || JSON.stringify(request.columns) !== JSON.stringify(cacheLastRequest.columns) || JSON.stringify(request.search) !== JSON.stringify(cacheLastRequest.search)) {\n          // properties changed (ordering, columns, searching)\n          ajax = true;\n        } // Store the request for checking next time around\n\n\n        cacheLastRequest = $.extend(true, {}, request);\n\n        if (ajax) {\n          // Need data from the server\n          if (requestStart < cacheLower) {\n            requestStart = requestStart - requestLength * (conf.pages - 1);\n\n            if (requestStart < 0) {\n              requestStart = 0;\n            }\n          }\n\n          cacheLower = requestStart;\n          cacheUpper = requestStart + requestLength * conf.pages;\n          request.start = requestStart;\n          request.length = requestLength * conf.pages; // Provide the same `data` options as DataTables.\n\n          if ($.isFunction(conf.data)) {\n            // As a function it is executed with the data object as an arg\n            // for manipulation. If an object is returned, it is used as the\n            // data object to submit\n            var d = conf.data(request);\n\n            if (d) {\n              $.extend(request, d);\n            }\n          } else if ($.isPlainObject(conf.data)) {\n            // As an object, the data given extends the default\n            $.extend(request, conf.data);\n          }\n\n          var pageRequest = {\n            start: request.start,\n            length: request.length,\n            //            sort :sort,\n            //            sortType :sortType,\n            statCount: request.draw == 1\n          };\n          $scope.getDevicesByPage(searchAlertData, pageRequest, function (returnObj, total) {\n            //初始化选中状态\n            returnObj.forEach(function (item) {\n              item.selected = false;\n            });\n            var json = {};\n            json.data = returnObj;\n            json.draw = request.draw; // Update the echo for each response\n\n            json.recordsTotal = total != undefined ? total == -1 ? cacheLastJson.recordsTotal : total : returnObj.length;\n            json.recordsFiltered = json.recordsTotal;\n            cacheLastJson = $.extend(true, {}, json);\n\n            if (cacheLower != drawStart) {\n              json.data.splice(0, drawStart - cacheLower);\n            }\n\n            if (requestLength >= -1) {\n              json.data.splice(requestLength, json.data.length);\n            }\n\n            drawCallback(json);\n          });\n        } else {//          if($scope.ajaxListUpdate.length > 0) {\n          //            cacheLastJson.data = $scope.ajaxListUpdate\n          //          }\n          //          var json = $.extend(true, {}, cacheLastJson);\n          //          json.draw = request.draw; \n          //          json.data.splice(0, requestStart - cacheLower);\n          //          json.data.splice(requestLength, json.data.length);\n          //          $scope.ajaxListUpdate = [];\n          //          drawCallback(json);\n        }\n      };\n    };\n\n    $scope.ajaxListUpdate = [];\n\n    $scope.getDevicesByPage = function (queryItem, pageRequest, callback) {\n      alertService.getAlertByPage(queryItem, pageRequest, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.pageAlertList = returnObj.data.data;\n          callback(returnObj.data.data, returnObj.data.total);\n        }\n      });\n    }; //弹出框的关闭事件\n\n\n    $scope.closeDialog = function () {\n      ngDialog.close();\n    }; //设备告警的三个操作\n\n\n    $scope.configAlert = function (type) {\n      if (type == \"addOrder\") {\n        //转工单\n        $scope.$broadcast(\"addOrder\");\n      } else if (type == \"selectedOrder\") {\n        $scope.$broadcast(\"selectedOrder\");\n      } else if (type == \"selectedClose\") {\n        $scope.$broadcast(\"selectedClose\");\n      }\n    };\n\n    var init = function init() {\n      $scope.category = $scope.myDicts['ticketCategory'];\n      initHistry();\n\n      if (states) {\n        var p = {\n          \"states\": states\n        };\n        alertService.queryFromCache(p, function (returnObj) {\n          if (returnObj.code == 0) {\n            initAlertInfo(returnObj.data);\n          }\n        });\n      } else if ($routeParams.nodeId) {\n        if (!searchAlertData) {\n          return;\n        }\n\n        ;\n\n        if (searchAlertData) {\n          $scope.selectAlertList.searchStatus = true;\n          $scope.$broadcast(Event.ALERTINFOSINIT, {\n            \"option\": []\n          });\n        }\n      } else if (viewInfo != undefined && viewInfo[\"nodeId\"]) {\n        if (!searchAlertData) {\n          return;\n        }\n\n        var info = {};\n\n        for (var key in searchAlertData) {\n          info[key] = searchAlertData[key];\n        }\n\n        if (info) {\n          initAlertInfo();\n        }\n      } else {\n        if ($scope.selectAlertList.search && searchAlertData) {\n          $scope.selectAlertList.searchStatus = true;\n          $scope.$broadcast(Event.ALERTINFOSINIT, {\n            \"option\": []\n          });\n        } else if (viewInfo && viewInfo.viewId) {\n          getAlertData();\n        }\n      }\n    }; //查询告警\n\n\n    $scope.$on(\"searchAlertView\", function (event, args) {\n      searchAlertData = args.option;\n      init();\n    });\n    $scope.$on(\"alertViewClick\", function (event, args) {\n      viewInfo = args.option;\n      states = args.states;\n      columns = [];\n      columsData = [];\n      stateIndex = -1;\n      severityIndex = -1;\n      $scope.selectAlertList.searchStatus = false;\n      init();\n    }); //注销scope时注销方法heartBeat，回调函数callback\n\n    $scope.$on(\"$destroy\", function () {\n      SwSocket.unregister(uuid);\n    });\n\n    if ($routeParams.nodeId) {\n      initHistry();\n      var item = {\n        viewId: null,\n        nodeId: $routeParams.nodeId\n      };\n      $scope.$broadcast(\"alertViewClick\", {\n        \"option\": item\n      });\n    } // if ($routeParams.nodeId == 0 && !searchAlertData) {\n    //   initAlertInfo();\n    //   initHistry();\n    // }\n\n  }]);\n});"],"sourceRoot":"/source/"}