{"version":3,"sources":["js/controllers/rappid-base-ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","BootstrapDialog","keyboardJS","joint","initController","$scope","$routeParams","$compile","$rootScope","viewFlexService","resourceUIService","kpiDataService","SwSocket","growl","loc","timeout","configUIService","$q","ngDialog","paper","graph","paperScroller","stencil","selection","selectionView","clipboard","commandManager","navigator","snapLines","inspector","cellsDic","shiftHold","backspaceHold","displayMode","uuid","Math","deviceMap","displayModeLink","arrowheadMarkup","toolMarkup","vertexMarkup","kpiDefDic","zoomOptAry","location","hash","search","_events_","interval","promise","fn","defer","resolve","reject","getResourceById","id","res","rej","d","code","data","getValue","str","type","arr","split","length","n","success","getKpisByModelId","modelId","deviceLoader","then","rootModelDic","kpis","getDevicesByCondition","domains","returnObj","label","concat","getMeasurePointData","queue","item","rs","allObj","i","push","lessThan","num","isArray","shift","apply","name","parse","a","JSON","e","removeType","match","exec","getKpi","kpi","onEvent","eventName","callback","bind","target","tagName","selectedItem","cell","cellposition","attributes","position","embeds","get","keyCode","prop","y","forEach","subId","subCell","getCell","x","remove","models","alertIcons","selectedView","temp","domainListTree","selectedAlertConfig","selectedValueConfig","directiveList","autoSaveHandler","baseConfig","autoSave","isNaN","setInterval","checkSameName","viewTitle","run","allViews","some","elem","errorMsg","checkSm","getAllMyViews","event","sendItemDir","dir","dirNodeId","itemDirValues","value","params","show","title","closable","message","buttons","cssClass","action","dialogRef","sendDeviceDirective","Number","nodeId","close","warning","backHandler","nodeChangeHandler","ary","toString","nodes","node","domainPath","sn","model","directives","resource","sensors","values","MeasurePointLocate","sensor","physicalConfig","accessConfigs","sensorChangeHandler","$watch","o","s","dataItem","dataItems","filter","instance","sort","b","k1","find","dataItemId","k2","serial","dataItemChangeHandler","directivesChangeHandler","directiveIds","nodesChangeHandler","nodeIds","kpiChangeHandler","kpiId","kpisChangeHandler","kpiIds","subViewChangeHandler","subViewId","echartViewIdChangeHandler","echartViewId","selectTypeChangeHandler","stateIdChangeHandler","stateId","stateTypeChangeHandler","stateType","tabsInfoChangeHandler","tabsInfo","unitChangeHandler","unitType","alertlevelChangeHandler","alertLevels","alertIconChangeHandler","attrs","image","alertIcon","alertTextChangeHandler","text","alertText","valuelevelChangeHandler","valueLevels","valueIconChangeHandler","valueIcon","valueTextChangeHandler","valueText","valueDirChangeHandler","valueDirAttrChangeHandler","domainAndModelChangeHandler","initItem","absheightChanged","absheight","layoutZChangeHandler","z","extendDomainsChangeHandler","extendDomainId","fillColor","color","state","color2","colorAry","colorAry2","transition","delay","duration","valueFunction","util","interpolate","hexColor","breathFlash","opacityState","flash","el","defaultOpacity","opacity","timingFunction","timing","inout","t","abs","toFixed","jQuery","isNumeric","_","contains","getTransitions","on","path","off","setLevel","range","eval","persent","transform","height","start","end","time","bubbleFlash","r","changeIconAndText","stateDisplay","stateHandler","returnData","cellObj","showEffect","extend","cells","nodeIdAry","fillType","attrsType","fillValue","unit","kpiDef","myOptionDic","valueHandler","rangeObj","kpiCode","rootModelsDic","kpiDic","kpiIdAry","getResourceBaseState","ids","getRealTimeKpiData","getResourceState","getWebsocket","param","ciid","operation","register","send","$on","unregister","clearInterval","showViewContent","scope","viewId","clear","getViewById","$","AdminLTE","controlSidebar","activate","domainListDic","extendDomain","template","resourceType","getResourceByIds","resourceId","resourceDic","replace","getExtendDomainsByFilter","subDomainListTree","subDomainListDic","components","myCommander","save4Json","$parent","configViewBg","bgimages","configCustoms","load","layout","getGraph","getPaper","fitToContent","configCommons","shapes","customer","configItem","content","contentCellsDic","originalCellDic","scale","paperscorllerW","width","display","zoom","pop","max","$el","css","fromJSON","options","gridSize","bgimage","bgcolor","setDimensions","setGrid","scroll","echartAry","groupDic","cellsModel","textary","boxClientRect","getBoundingClientRect","size","left","top","groupDef","group","groupAry","k","modelAry","setTimeout","$apply","dirty","PatternLinkView","dia","LinkView","patternMarkup","join","render","this","arguments","listenTo","update","cancelFrame","frameId","pattern","V","patternImage","findOne","svg","defs","append","_V","connection","attr","stroke","strokeWidth","nextFrame","fillWithPattern","bbox","g","rect","moveAndExpand","points","sourcePoint","route","targetPoint","map","point","canvas","document","createElement","ctx","getContext","lineWidth","lineJoin","lineCap","pointsCount","save","gradientPoints","gradient","createLinearGradient","drawPattern","call","restore","dataUri","toDataURL","xlink:href","from","to","angle","toRad","theta","center","line","midpoint","fromPolar","PI","beginPath","moveTo","lineTo","closePath","strokeStyle","createConfigView","callbackFun","configureInfo","Date","Format","viewType","description","dialog","open","className","tree","typeContents","treeAry","getResourceByModelId","saveData","addView","href","closeDialog","window","history","back","updateCellHandler","getModel","collection","updateCell","inspectorStatus","status","$applyAsync","openOrClose","viewConfigClick","creatingLine","lineCoords","source","tempLine","tempLines","body","evt","preventDefault","stopPropagation","normalizeEvent","clientCoords","snapToGrid","clientX","clientY","x2","y2","x1","y1","addCellhandler","parentCell","embedObjs","parentCellPos","oldParentCellPos","getLastCell","MAX_VALUE","embedobj","parent","addCell","newCell","clone","unset","initialization","element","interactive","Graph","Paper","perpendicularLinks","markAvailable","defaultLink","Link",".marker-source",".marker-target",".connection","linkConnectionPoint","shapePerimeterConnectionPoint","linkView","innerWidth","outerWidth","lineColor","move","addColorStop","patternColor","ui","PaperScroller","autoResizePaper","padding","Snaplines","scroller","opt","scrollTop","GridLayout","columnWidth","columns","rowHeight","resizeToFit","dy","dx","Stencil","dropAnimation","groups","renderSearch","each","groupName","closeGroups","Backbone","Collection","SelectionView","drawStatus","createLine","stroke-width","viewport","vertices","which","tmplink","startSelecting","cancelSelection","startPanning","cellView","ctrlKey","metaKey","createSelectionBox","add","destroySelectionBox","findViewByModel","reset","without","oncontextmenu","initBatchCommand","invoke","storeBatchCommand","is","openCellTools","halo","$inspectorHolder","$inspectorHolder_text","$inspectorHolder_presentation","$inspectorHolder_geometry","subViewState","nodeState","Halo","removeHandles","dirModelId","modelIdAry","dirModel","dirSn","addHandle","icon","category","directiveId","dirObj","isSend","valueLvevel","valueDirective","valueDirectiveAttr","dirSubViewId","subViewIdAry","viewRoutes","commander","configDispaly","cloneCell","extendHalohandler","flg","cellid","toPNG","dataURL","pjson","toJSON","tmpcopy","stringify","font-size","fill","ref-dy","font-family","newconfig","key","keyDesc","invalid","canDelete","saveConfig","copyactionhandler","removeHandle","FreeTransform","selectItem","analysis","createSelectItem","selectType","inspectorDefs","inputs","commonInspectorInputs","commonInspectorGroups","extendAlertInputs","valueLevel","extendValueInputs","alertLevel","baowuAlerts","basicAttr","commonInspectorInputsKpis","commonInspectorInstance","levelInputs","domainInputs","switchInputs","openAngleInputs","Inspector","$label","Tooltip","right","direction","children","wrap","html","Array","Element","Clipboard","copyElements","translate","useLocalStorage","pasteCells","link","originalCells","baseWidth","baseHeight","backgroundImage","context","fillStyle","getGridBackgroundImage","viewjson","JSONstring","viewName","updateView","err","alert","CommandManager","cmd","redoStack","batch","lastCmdIndex","trigger","undoStack","undo","redo","configDispalySet","alignAction","align","x_offset","y_offset","toFront","toBack","embed","unembed","preview","encodeURIComponent","flip","hasOwnProperty","indexOf","windowName","uniqueId","write","loadJSON","hotkey","inputcontent","getElementById","json","viewChange","view","splice","loadcount","gotoShowView","rootModelDicWatch","nv","ov","domainListTreeWatch","myOptionDicWatch","undefined","confighome","allmyViews","dialogBox","wholeClick","treedata","navigate","navi","ta","j","$extension","currentView","findCur","traverse","lv1views","detaillist","details","lv1viewsclick","tmp","jsonObj","level","findView","$$","switchToNumber","fnlist","style","border-radius","font-weight","select","con","allViewLoaded"],"mappings":"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","file":"js/controllers/rappid-base-ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers', 'bootstrap-dialog', 'keyboardJS', 'rappid-joint', 'Array'], function (controllers, BootstrapDialog, keyboardJS, joint) {\n  'use strict';\n\n  controllers.initController('RappidBaseCtrl', ['$scope', '$routeParams', '$compile', '$rootScope', 'viewFlexService', 'resourceUIService', 'kpiDataService', 'SwSocket', 'growl', '$location', '$timeout', 'configUIService', \"$q\", 'ngDialog', function ($scope, $routeParams, $compile, $rootScope, viewFlexService, resourceUIService, kpiDataService, SwSocket, growl, loc, timeout, configUIService, $q, ngDialog) {\n    var paper, graph, paperScroller, stencil, selection, selectionView, clipboard, commandManager, navigator, snapLines, inspector;\n    var cellsDic = {}; //组件字典\n\n    var shiftHold = false; //shift按钮状态\n\n    var backspaceHold = false; //空格按钮状态\n\n    var displayMode = false; //显示模式，false为设计模式，true为展示模式\n\n    var uuid = Math.uuid();\n    var deviceMap = {}; //线条展示时，清空设计状态\n\n    var displayModeLink = {\n      'arrowheadMarkup': '<g></g>',\n      'toolMarkup': '<g></g>',\n      'vertexMarkup': '<g></g>'\n    };\n    var kpiDefDic = {}; //指标字典\n\n    var zoomOptAry = []; //缩放动作数组，用于记录缩放的动作\n    //url包含#/display时，组态进入展示模式\n\n    if (location.hash.search(\"#/display\") > -1) {\n      displayMode = true;\n    }\n\n    ; //onEvent保存状态的变更\n\n    var _events_ = {};\n\n    $scope.onEvent = function (eventName, callback) {\n      _events_[eventName] = callback;\n    }; //监听按钮\n\n\n    keyboardJS.bind('shift', function (e) {\n      shiftHold = true;\n    }, function (e) {\n      shiftHold = false;\n    });\n    keyboardJS.bind('shift', null, function (e) {\n      shiftHold = false;\n    });\n    keyboardJS.bind('backspace', function (e) {\n      backspaceHold = true;\n    }, function (e) {\n      backspaceHold = false;\n    });\n    keyboardJS.bind('backspace', null, function (e) {\n      backspaceHold = false;\n    }); //监听上下左右和删除按钮\n\n    keyboardJS.bind(['up', 'down', 'right', 'left', 'delete'], function (e) {\n      if (e.target.tagName != \"INPUT\" && $scope.selectedItem.cell) {\n        var cell = $scope.selectedItem.cell;\n        var cellposition = cell.attributes.position;\n        var embeds = cell.get(\"embeds\");\n\n        if (e.keyCode == 38) {\n          cell.prop('position/y', cellposition.y - 1);\n\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.prop('position/y', subCell.attributes.position.y - 1);\n            });\n          }\n        } else if (e.keyCode == 40) {\n          cell.prop('position/y', cellposition.y + 1);\n\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.prop('position/y', subCell.attributes.position.y + 1);\n            });\n          }\n        } else if (e.keyCode == 39) {\n          cell.prop('position/x', cellposition.x + 1);\n\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.prop('position/x', subCell.attributes.position.x + 1);\n            });\n          }\n        } else if (e.keyCode == 37) {\n          cell.prop('position/x', cellposition.x - 1);\n\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.prop('position/x', subCell.attributes.position.x - 1);\n            });\n          }\n        } else if (e.keyCode == 46) {\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.remove();\n            });\n          }\n\n          cell.remove();\n        }\n      } else if (e.target.tagName != \"INPUT\" && selection.models.length > 0) {\n        selection.models.forEach(function (cell) {\n          var cellposition = cell.attributes.position;\n\n          if (e.keyCode == 38) {\n            cell.prop('position/y', cellposition.y - 1);\n          } else if (e.keyCode == 40) {\n            cell.prop('position/y', cellposition.y + 1);\n          } else if (e.keyCode == 39) {\n            cell.prop('position/x', cellposition.x + 1);\n          } else if (e.keyCode == 37) {\n            cell.prop('position/x', cellposition.x - 1);\n          } else if (e.keyCode == 46) {\n            var embeds = cell.get(\"embeds\");\n\n            if (embeds) {\n              embeds.forEach(function (subId) {\n                var subCell = graph.getCell(subId);\n                subCell.remove();\n              });\n            }\n\n            cell.remove();\n          }\n        });\n      }\n    });\n    $scope.alertIcons = [];\n    $scope.selectedView = {\n      temp: {},\n      //临时存储Domains\n      inspector: false,\n      //控制inspector是否显示视图设置\n      domainListTree: null //管理域\n\n    }; //组态视图对象\n\n    $scope.selectedAlertConfig = {};\n    $scope.selectedValueConfig = {};\n    $scope.selectedItem = {}; //选中的组件对象\n\n    $scope.directiveList = []; //指令集合\n\n    var interval; //自动保存的计时器对象\n\n    /**\n     * 自动保存，需要在全局配置中设置\n     * @param {Object} callback\n     */\n\n    $scope.autoSaveHandler = function (callback) {\n      if ($scope.baseConfig && $scope.baseConfig.autoSave) {\n        if (isNaN($scope.baseConfig.autoSave)) {\n          $scope.baseConfig.autoSave = 15;\n        }\n\n        interval = setInterval(function () {\n          callback();\n        }, $scope.baseConfig.autoSave * 60 * 1000);\n      }\n    };\n    /**\n     * 检查当前组态视图名称是否可以用\n     * @param {Object} viewTitle\n     */\n\n\n    $scope.checkSameName = function (viewTitle) {\n      var run = function run(allViews) {\n        var some = allViews.some(function (elem) {\n          return viewTitle == elem.viewTitle;\n        });\n\n        if (some) {\n          $scope.errorMsg = \"此视图名称已被占用\";\n        } else {\n          $scope.errorMsg = null;\n        }\n\n        $scope.checkSm = some;\n      };\n\n      if ($scope.getAllMyViews) {\n        run($scope.getAllMyViews);\n      } else {\n        viewFlexService.getAllMyViews(function (event) {\n          if (event.code == 0) {\n            $scope.getAllMyViews = event.data;\n            run(event.data);\n          }\n        });\n      }\n    };\n    /**\n     * 发送指令\n     * @param {Object} dir\n     * @param {Object} dirNodeId\n     */\n\n\n    $scope.sendItemDir = function (dir, dirNodeId) {\n      var itemDirValues = {};\n\n      if (!dir.value) {\n        growl.warning(\"请输入指令参数\");\n        return;\n      }\n\n      for (var i in dir.params) {\n        var obj = dir.params[i];\n        itemDirValues[obj.name] = dir.value;\n      }\n\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        message: '您发送的指令将会在设备上执行，状态数据返回将会有一定时间，确认要发送指令吗？',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            resourceUIService.sendDeviceDirective(dirNodeId ? dirNodeId : Number($scope.selectedItem.nodeId), dir.id, itemDirValues, function (returnObj) {\n              if (returnObj.code == 0) {\n                growl.success(\"指令发送成功，请勿重复发送，状态数据返回需要一定时间！\", {});\n              }\n            });\n            dialogRef.close();\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.backHandler = function () {};\n    /**\n     * 设备单选切换时\n     */\n\n\n    function promise(fn) {\n      var defer = $q.defer();\n      fn(defer.resolve, defer.reject);\n      return defer.promise;\n    }\n\n    function getResourceById(id) {\n      return promise(function (res, rej) {\n        if (deviceMap[id]) {\n          res(deviceMap[id]);\n          return;\n        }\n\n        resourceUIService.getResourceById(id, function (d) {\n          if (d.code == \"0\") {\n            deviceMap[id] = d.data;\n            res(d.data);\n          } else {\n            rej(d);\n          }\n        });\n      });\n    }\n\n    function getValue(str) {\n      if (typeof str != \"string\") {\n        return str;\n      }\n\n      var arr = str.split(\":\"),\n          type;\n\n      if (arr.length == 1) {\n        return str;\n      }\n\n      type = arr[0];\n\n      if (type == \"string\") {\n        return arr[1] + \"\";\n      }\n\n      if (type == \"number\") {\n        var n = arr[1] - 0;\n        return n === n ? n : arr[1];\n      }\n\n      return str;\n    }\n\n    function success(d) {\n      var defer = $q.defer();\n      defer.resolve(d);\n      return defer.promise;\n    }\n\n    function getKpisByModelId(modelId) {\n      return resourceUIService.deviceLoader().then(function () {\n        var model = resourceUIService.rootModelDic[modelId];\n        return success(model.kpis);\n      });\n    }\n\n    function getDevicesByCondition(modelId, domains) {\n      var defer = $q.defer();\n      resourceUIService.getDevicesByCondition({\n        modelId: modelId,\n        domains: domains\n      }, function (returnObj) {\n        if (returnObj.code == 0) {\n          defer.resolve([{\n            label: \"无\",\n            id: 0\n          }].concat(returnObj.data));\n        }\n\n        ;\n      });\n      return defer.promise;\n    }\n\n    function getMeasurePointData(queue) {\n      var item,\n          rs = [];\n      queue = isArray(queue) ? queue : [queue];\n\n      function allObj(obj) {\n        var arr = [],\n            i;\n\n        for (i in obj) {\n          if (_typeof(obj[i]) !== \"object\") {\n            return false;\n          }\n\n          arr.push(obj[i]);\n        }\n\n        return arr;\n      }\n\n      function lessThan(num) {\n        return function (item) {\n          if (item - 0 !== item - 0) {\n            return true;\n          }\n\n          if (item < num) {\n            return true;\n          }\n\n          return false;\n        };\n      }\n\n      while (item = queue.shift()) {\n        if (isArray(item)) {\n          [].push.apply(queue, item);\n        } else {\n          var arr = allObj(item);\n\n          if (arr) {\n            [].push.apply(queue, arr);\n          } else {\n            //测点数据展示1000以下的，1000以上的离线数据\n            if (item && lessThan(1000)(item.name)) {\n              rs.push(item);\n            }\n          }\n        }\n      }\n\n      return rs;\n    }\n\n    function parse(obj) {\n      var a;\n\n      try {\n        a = JSON.parse(obj);\n      } catch (e) {\n        return;\n      }\n\n      return a;\n    }\n\n    function removeType(str) {\n      var match = /(?:[^:]*:)?([^:]*)/.exec(str);\n      return match ? match[1] : str;\n    }\n\n    $scope.nodeChangeHandler = function () {\n      var nodeId;\n\n      if ($scope.selectedItem.nodeId == null) {\n        if ($scope.selectedItem.cell.get('nodeId')) {\n          var ary = $scope.selectedItem.cell.get('nodeId').toString().split(\":\");\n          nodeId = Number(ary[ary.length - 1]);\n          $scope.selectedItem.nodeId = nodeId;\n        }\n      } else {\n        nodeId = $scope.selectedItem.nodeId;\n      }\n\n      if (nodeId) {\n        for (var i = 0; i < $scope.selectedItem.nodes.length; i++) {\n          var node = $scope.selectedItem.nodes[i];\n\n          if (node.id == nodeId) {\n            $scope.selectedItem.cell.attributes[\"nodeId\"] = \"number:\" + node.id;\n            $scope.selectedItem.cell.attributes[\"modelId\"] = \"number:\" + node.modelId;\n            $scope.selectedItem.cell.attributes[\"domainPath\"] = \"number:\" + $scope.selectedItem.domainPath;\n            $scope.selectedItem.cell.attributes[\"sn\"] = node.sn;\n            $scope.selectedItem.cell.attributes[\"attrs\"][\"text\"][\"text\"] = node.label;\n\n            if ($scope.selectedItem.modelId == 0) {\n              $scope.selectedItem.modelId = node.modelId;\n              var model = resourceUIService.rootModelDic[$scope.selectedItem.modelId]; //选中对象的modelId\n\n              if (model) {\n                //存在该模型\n                $scope.selectedItem.kpis = model.kpis;\n                $scope.selectedItem.directives = model.directives;\n              }\n            }\n\n            break;\n          }\n        }\n\n        getResourceById(nodeId).then(function (resource) {\n          $scope.selectedItem.sensors = getMeasurePointData(parse(resource.values.MeasurePointLocate));\n          $scope.selectedItem.sensor = $scope.selectedItem.cell.attributes[\"sensor\"];\n          $scope.selectedItem.physicalConfig = resource.physicalConfig.accessConfigs;\n\n          if (typeof $scope.selectedItem.sensor !== \"undefined\" && $scope.selectedItem.sensor !== null) {\n            $scope.sensorChangeHandler();\n          }\n        });\n      }\n    };\n\n    function getKpi(id) {\n      return function (kpi) {\n        return kpi.id == id;\n      };\n    }\n\n    $scope.$watch(\"selectedItem.sensor\", function (n, o, s) {\n      if (n === null) {}\n    });\n\n    $scope.sensorChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"sensor\"] = $scope.selectedItem.sensor;\n      /** dataItem 依赖 dataItems 必须同时渲染 **/\n\n      $scope.selectedItem.dataItem = $scope.selectedItem.cell.attributes[\"dataItem\"];\n      $scope.selectedItem.dataItems = $scope.selectedItem.physicalConfig.filter(function (d) {\n        return d.instance == removeType($scope.selectedItem.sensor);\n      });\n      $scope.selectedItem.dataItems.sort(function (a, b) {\n        var k1 = $scope.selectedItem.kpis.find(getKpi(a.dataItemId)),\n            k2 = $scope.selectedItem.kpis.find(getKpi(b.dataItemId));\n        return k1.serial - k2.serial;\n      });\n    };\n\n    $scope.dataItemChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"dataItem\"] = $scope.selectedItem.dataItem;\n    };\n    /**\n     * 指令切换时\n     */\n\n\n    $scope.directivesChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"directiveIds\"] = $scope.selectedItem.directiveIds;\n    };\n    /**\n     * 设备多选切换时\n     */\n\n\n    $scope.nodesChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"nodeIds\"] = $scope.selectedItem.nodeIds;\n    };\n    /**\n     * 指标切换时\n     */\n\n\n    $scope.kpiChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"kpiId\"] = \"number:\" + $scope.selectedItem.kpiId;\n    };\n    /**\n     * 复选指标切换时\n     */\n\n\n    $scope.kpisChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"kpiIds\"] = $scope.selectedItem.kpiIds;\n    };\n    /**\n     * 子视图切换时\n     */\n\n\n    $scope.subViewChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"subViewId\"] = \"number:\" + $scope.selectedItem.subViewId;\n    };\n    /**\n     * 分析视图切换时\n     */\n\n\n    $scope.echartViewIdChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"echartViewId\"] = \"number:\" + $scope.selectedItem.echartViewId;\n    };\n    /**\n     * 设备选择方式切换时（已废弃）\n     */\n\n\n    $scope.selectTypeChangeHandler = function () {\n      $scope.selectedItem.models = [];\n      $scope.selectedItem.modelId = 0;\n      $scope.selectedItem.nodeId = 0;\n      $scope.selectedItem.nodeIds = [];\n      $scope.selectedItem.directives = [];\n      $scope.selectedItem.kpis = [];\n      $scope.selectedItem.kpiId = 0;\n    };\n    /**\n     * 告警状态切换时\n     */\n\n\n    $scope.stateIdChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"stateId\"] = \"number:\" + $scope.selectedItem.stateId;\n    };\n    /**\n     * 提醒方式切换时\n     */\n\n\n    $scope.stateTypeChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"stateType\"] = \"number:\" + $scope.selectedItem.stateType;\n    };\n    /**\n     * 分组信息切换时（不常用）\n     */\n\n\n    $scope.tabsInfoChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"tabsInfo\"] = $scope.selectedItem.tabsInfo;\n    };\n    /**\n     * 指标单位切换时\n     */\n\n\n    $scope.unitChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"unitType\"] = \"number:\" + $scope.selectedItem.unitType;\n    };\n    /**\n     * 告警级别切换时\n     */\n\n\n    $scope.alertlevelChangeHandler = function () {\n      if ($scope.selectedAlertConfig) {\n        $scope.selectedItem.cell.prop('alertConfig', $scope.alertLevels);\n      }\n    };\n    /**\n     * 告警图标切换时\n     */\n\n\n    $scope.alertIconChangeHandler = function () {\n      if ($scope.selectedAlertConfig) {\n        $scope.selectedItem.cell.prop('alertConfig', $scope.alertLevels);\n\n        if ($scope.selectedAlertConfig.id == 0) {\n          $scope.selectedItem.cell.attributes.attrs.image[\"xlink:href\"] = $scope.selectedAlertConfig.alertIcon;\n        }\n      }\n    };\n    /**\n     * 告警名称切换时\n     */\n\n\n    $scope.alertTextChangeHandler = function () {\n      if ($scope.selectedAlertConfig) {\n        $scope.selectedItem.cell.prop('alertConfig', $scope.alertLevels);\n\n        if ($scope.selectedAlertConfig.id == 0) {\n          $scope.selectedItem.cell.attributes.attrs.text.text = $scope.selectedAlertConfig.alertText;\n        }\n      }\n    };\n    /**\n     * 指标图标切换时\n     */\n\n\n    $scope.valuelevelChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n      }\n    };\n    /**\n     * 指标单位切换时\n     */\n\n\n    $scope.valueIconChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n\n        if ($scope.selectedValueConfig.id == 0) {\n          $scope.selectedItem.cell.attributes.attrs.image[\"xlink:href\"] = $scope.selectedValueConfig.valueIcon;\n        }\n      }\n    };\n    /**\n     * 指标值切换时\n     */\n\n\n    $scope.valueTextChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n\n        if ($scope.selectedValueConfig.id == 0) {\n          $scope.selectedItem.cell.attributes.attrs.text.text = $scope.selectedValueConfig.valueText;\n        }\n      }\n    };\n    /**\n     * 指标指令切换时\n     */\n\n\n    $scope.valueDirChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n      }\n    };\n    /**\n     * 指标指令参数切换时\n     */\n\n\n    $scope.valueDirAttrChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n      }\n    };\n    /**\n     * 管理域／模板切换时\n     * @param {Object} initItem\n     */\n\n\n    $scope.domainAndModelChangeHandler = function (initItem) {\n      var modelId = $scope.selectedItem.modelId > 0 ? $scope.selectedItem.modelId : null;\n      var domains = $scope.selectedItem.domainPath;\n\n      if (!modelId || !domains) {\n        return;\n      }\n\n      var model = resourceUIService.rootModelDic[$scope.selectedItem.modelId]; //选中对象的modelId\n\n      if (model) {\n        //存在该模型\n        $scope.selectedItem.kpis = model.kpis;\n        $scope.selectedItem.directives = model.directives;\n        $scope.selectedItem.cell.attributes[\"modelId\"] = \"number:\" + $scope.selectedItem.modelId;\n        $scope.selectedItem.cell.attributes[\"domainPath\"] = \"number:\" + $scope.selectedItem.domainPath;\n      } else {\n        $scope.selectedItem.kpis = [];\n        $scope.selectedItem.directives = [];\n      }\n\n      if ($scope.selectedView.temp[modelId + \"_\" + domains]) {\n        $scope.selectedItem.nodes = [{\n          label: \"无\",\n          id: 0\n        }].concat($scope.selectedView.temp[modelId + \"_\" + domains]);\n\n        if (initItem) {\n          $scope.selectedItem.nodeIds = initItem.nodeIds;\n          $scope.nodesChangeHandler();\n        }\n      } else {\n        resourceUIService.getDevicesByCondition({\n          modelId: modelId,\n          domains: domains\n        }, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.selectedView.temp[modelId + \"_\" + domains] = returnObj.data;\n            $scope.selectedItem.nodes = [{\n              label: \"无\",\n              id: 0\n            }].concat(returnObj.data);\n\n            if (initItem) {\n              $scope.selectedItem.nodeIds = initItem.nodeIds;\n              $scope.nodesChangeHandler();\n            }\n          }\n\n          ;\n        });\n      }\n    };\n    /**\n     * 绝对高度切换时\n     */\n\n\n    $scope.absheightChanged = function () {\n      $scope.selectedItem.cell.attributes[\"absheight\"] = Number($scope.selectedItem.absheight);\n      $scope.selectedItem.cell.prop(\"absheight\", Number($scope.selectedItem.absheight));\n    };\n    /**\n     * 组件图层切换时\n     */\n\n\n    $scope.layoutZChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"z\"] = Number($scope.selectedItem.z);\n      $scope.selectedItem.cell.prop(\"z\", Number($scope.selectedItem.z));\n    };\n    /**\n     * 扩展域切换时，暂时用处不大\n     */\n\n\n    $scope.extendDomainsChangeHandler = function () {\n      if ($scope.selectedItem.extendDomainId) {\n        $scope.selectedItem.cell.attributes[\"extendDomainId\"] = \"number:\" + $scope.selectedItem.extendDomainId;\n        $scope.selectedItem.cell.attributes[\"nodeId\"] = \"number:\" + $scope.selectedItem.extendDomainId;\n      }\n    };\n    /**\n     * 告警状态提示方式：填充颜色\n     * @param {Object} cell 组件对象\n     * @param {Object} type 组件类型，比如rect、image、cricle等\n     * @param {Object} color 填充颜色\n     * @param {Object} state 告警状态\n     * @param {Object} color2 组件的原来颜色\n     */\n\n\n    var fillColor = function fillColor(cell, type, color, state, color2) {\n      var stateId = cell.get(\"stateId\");\n\n      if (stateId) {\n        if (state < 1) state = 0;\n        var colorAry = [color, '#25bce7', '#e1cd0a', '#ed9700', '#e7675d'];\n        var colorAry2 = [color2, '#25bce7', '#e1cd0a', '#ed9700', '#e7675d'];\n\n        if (stateId == \"number:1\" || stateId == \"number:3\") {\n          if (type) {\n            cell.transition('attrs/' + type + '/fill', colorAry[state], {\n              delay: 0,\n              duration: 500,\n              valueFunction: joint.util.interpolate.hexColor\n            });\n          }\n        }\n\n        if (stateId == \"number:2\" || stateId == \"number:3\") {\n          cell.transition('attrs/text/fill', colorAry2[state], {\n            delay: 0,\n            duration: 500,\n            valueFunction: joint.util.interpolate.hexColor\n          });\n        }\n      }\n    };\n    /**\n     * 告警状态提示方式：呼吸灯,经过优化的 zhangafa 2017-6-2\n     * @param {Object} cell 组件对象\n     * @param {Object} type 组件类型，比如rect、image、cricle等\n     * @param {Object} color 填充颜色\n     * @param {Object} state 告警状态\n     * @param {Object} opacityState 组件的透明度\n     */\n\n\n    var breathFlash = function breathFlash(cell, type, color, state, opacityState) {\n      var stateId = cell.get(\"stateId\");\n\n      var flash = function flash(el) {\n        var defaultOpacity = opacityState ? 1 : el.opacity;\n        el.transition('attrs/' + type + '/opacity', defaultOpacity, {\n          delay: 0,\n          duration: 3000,\n          timingFunction: joint.util.timing.inout,\n          valueFunction: function valueFunction(a, b) {\n            return function (t) {\n              var o = a + b * (defaultOpacity - Math.abs(defaultOpacity - 2 * defaultOpacity * t));\n              return Number(o.toFixed(2));\n            };\n          }\n        });\n      };\n\n      if (stateId) {\n        if (state < 0) state = 0;\n        var colorAry = [color, '#25bce7', '#e1cd0a', '#ed9700', '#e7675d'];\n\n        if (stateId == \"number:2\") {\n          type = \"text\";\n        }\n\n        if (type) {\n          if (!cell.opacity) {\n            cell.opacity = jQuery.isNumeric(cell.prop('attrs/' + type + '/opacity')) ? cell.prop('attrs/' + type + '/opacity') : 1;\n          }\n\n          cell.state = state;\n          cell.prop('attrs/' + type + '/opacity', 0.1);\n          cell.prop('attrs/' + type + '/fill', colorAry[state]);\n\n          if (cell.state > 0) {\n            if (_.contains(cell.getTransitions(), 'attrs/' + type + '/opacity')) return;\n            cell.on('transition:end', function (el, path) {\n              if (el.state > 0) {\n                flash(el);\n              } else {\n                el.off('transition:end');\n                el.prop('attrs/' + type + '/opacity', el.opacity);\n              }\n            });\n            flash(cell);\n          } else {\n            cell.prop('attrs/' + type + '/opacity', cell.opacity);\n          }\n        }\n      }\n    };\n    /**\n     * 液位设置\n     * @param {Object} cell 组件对象\n     * @param {Object} value 液位的数值\n     */\n\n\n    var setLevel = function setLevel(cell, value) {\n      var range = cell.attributes.range;\n\n      if (range) {\n        range = eval(range);\n      }\n\n      var persent = (value - range[0]) / (range[1] - range[0]);\n      cell.prop(\"attrs/text/text\", \"\");\n      cell.transition('attrs/rect', {\n        'transform': 'translate(0,0)',\n        'height': 60 * persent\n      }, {\n        delay: 0,\n        duration: 1000,\n        valueFunction: function valueFunction(start, end) {\n          return function (time) {\n            var height = start['height'] + (end['height'] - start['height']) * time;\n            var all = 0;\n            return {\n              'transform': 'translate(0,' + (60 - height) + ')',\n              'height': height\n            };\n          };\n        }\n      });\n    };\n    /**\n     * 告警状态提示方式：气泡，仅支持圆形\n     * @param {Object} cell 组件对象\n     * @param {Object} type 组件类型，比如rect、image、cricle等\n     * @param {Object} color 填充颜色\n     * @param {Object} state 告警状态\n     * @param {Object} opacityState 组件的透明度\n     */\n\n\n    var bubbleFlash = function bubbleFlash(cell, type, color, state, opacityState) {\n      var stateId = cell.get(\"stateId\");\n\n      var flash = function flash() {\n        cell.prop('attrs/' + type + '/r', 0);\n        cell.prop('attrs/' + type + '/opacity', opacityState ? 1 : cell.opacity);\n        cell.transition('attrs/' + type, {\n          'r': cell.r,\n          'opacity': 0\n        }, {\n          delay: 0,\n          duration: 1500,\n          valueFunction: function valueFunction(start, end) {\n            return function (time) {\n              return {\n                'r': start['r'] + (end['r'] - start['r']) * time,\n                'opacity': start['opacity'] - start['opacity'] * time\n              };\n            };\n          }\n        });\n      };\n\n      if (stateId) {\n        if (state < 0) state = 0;\n        var colorAry = [color, '#25bce7', '#e1cd0a', '#ed9700', '#e7675d'];\n\n        if (stateId == \"number:2\") {\n          type = \"text\";\n        }\n\n        if (type) {\n          if (!cell.opacity) {\n            cell.opacity = jQuery.isNumeric(cell.prop('attrs/' + type + '/opacity')) ? cell.prop('attrs/' + type + '/opacity') : 1;\n            cell.r = cell.prop('attrs/' + type + '/r');\n            cell.prop('attrs/' + type + '/opacity', opacityState ? 1 : cell.opacity);\n          }\n\n          cell.state = state;\n          cell.prop('attrs/' + type + '/fill', colorAry[state]);\n\n          if (cell.state > 0) {\n            if (_.contains(cell.getTransitions(), 'attrs/' + type)) return;\n            cell.on('transition:end', function (el) {\n              if (el.state > 0) {\n                flash();\n              } else {\n                cell.prop('attrs/' + type + '/opacity', cell.opacity);\n                cell.prop('attrs/' + type + '/r', cell.r);\n              }\n            });\n            flash();\n          } else {\n            cell.prop('attrs/' + type + '/opacity', cell.opacity);\n            cell.prop('attrs/' + type + '/r', cell.r);\n          }\n        }\n      }\n    };\n    /**\n     * 告警扩展修改图片和文字\n     * @param {Object} cell\n     * @param {Object} state\n     * @param {Object} type alertConfig：图标设置 valueConfig文字设置\n     */\n\n\n    var changeIconAndText = function changeIconAndText(cell, state, type) {\n      if (!type) type = \"alertConfig\";\n\n      if (type == \"alertConfig\") {\n        var alertIcon = cell.get(\"alertIcon\");\n\n        if (alertIcon) {\n          if (state < 1) state = 0;\n          var alertConfig = cell.get(type);\n          alertConfig.forEach(function (item) {\n            if (item.id == state) {\n              if (item.alertText) cell.prop('attrs/text/text', item.alertText);\n              if (item.alertIcon) cell.prop('attrs/image/xlink:href', item.alertIcon);\n            }\n          });\n        }\n      } else if (type == \"valueConfig\") {\n        var valueConfig = cell.get(type);\n        valueConfig.forEach(function (item) {\n          item.stateDisplay = false;\n\n          if (item.valueText == state) {\n            item.stateDisplay = true;\n            if (item.valueText) cell.prop('attrs/text/text', item.valueText);\n            if (item.valueIcon) cell.prop('attrs/image/xlink:href', item.valueIcon);\n          }\n        });\n      }\n    };\n    /**\n     * 告警状态设置\n     * @param {Object} returnData\n     */\n\n\n    var stateHandler = function stateHandler(returnData) {\n      if (cellsDic[returnData.nodeId]) {\n        cellsDic[returnData.nodeId].forEach(function (cellObj) {\n          if (cellObj[returnData.nodeId].state != returnData.value) {\n            var showEffect = true;\n            var cell = cellObj[returnData.nodeId];\n\n            if (cell.get(\"kpiId\") && cell.get(\"kpiId\") != \"number:0\") {\n              if (returnData.instance) {\n                if (\"number:\" + returnData.instance != cell.get(\"kpiId\")) {\n                  showEffect = false;\n                }\n              } else {\n                showEffect = false;\n              }\n            } else {\n              if (returnData.instance) {\n                showEffect = false;\n              }\n            }\n\n            if (!showEffect) return;\n            var extend = cellObj[returnData.nodeId].get(\"extend\");\n\n            if (extend == 'alarm') {\n              //告警扩展\n              changeIconAndText(cellObj[returnData.nodeId], returnData.value);\n            } else if (extend == \"level\") {\n              //液位扩展\n              fillColor(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, false);\n            } else {\n              if (cellObj[returnData.nodeId].get('stateType') == \"number:1\") {\n                breathFlash(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, false);\n              } else if (cellObj[returnData.nodeId].get('stateType') == \"number:2\") {\n                bubbleFlash(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, false);\n              } else if (cellObj[returnData.nodeId].get('stateType') == \"number:3\") {\n                breathFlash(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, true);\n              } else if (cellObj[returnData.nodeId].get('stateType') == \"number:4\") {\n                bubbleFlash(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, true);\n              } else {\n                fillColor(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, cellObj[returnData.nodeId + \"text_fill\"]);\n              }\n            }\n          }\n        });\n      } else {\n        graph.attributes.cells.models.forEach(function (cell) {\n          if (cell.get(\"nodeId\")) {\n            var nodeIdAry = cell.get(\"nodeId\").split(\":\");\n\n            if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] == returnData.nodeId) {\n              if (!cellsDic[returnData.nodeId]) cellsDic[returnData.nodeId] = [];\n              var cellObj = {};\n              var type = $scope.fillType[cell.get(\"type\")];\n              var showEffect = true;\n\n              if (cell.get(\"kpiId\") && cell.get(\"kpiId\") != \"number:0\") {\n                if (returnData.instance) {\n                  if (\"number:\" + returnData.instance != cell.get(\"kpiId\")) {\n                    showEffect = false;\n                  }\n                } else {\n                  showEffect = false;\n                }\n              } else {\n                if (returnData.instance) {\n                  showEffect = false;\n                }\n              }\n\n              var extend = cell.get(\"extend\");\n              var attrsType = cell.get(\"attrs\")[type];\n              if (attrsType) cellObj[returnData.nodeId + \"_fill\"] = attrsType[\"fill\"];else cellObj[returnData.nodeId + \"_fill\"] = '#fff';\n\n              if (extend != 'alarm' && extend != 'value' && extend != 'level') {\n                if (cell.get(\"attrs\")[\"text\"]) {\n                  cellObj[returnData.nodeId + \"text_fill\"] = cell.get(\"attrs\")[\"text\"][\"fill\"];\n                } else {\n                  cellObj[returnData.nodeId + \"text_fill\"] = '#000';\n                }\n\n                cellObj[returnData.nodeId + \"_type\"] = type;\n                cellObj[returnData.nodeId] = cell;\n                cellsDic[returnData.nodeId].push(cellObj);\n                if (!showEffect) return;\n\n                if (cell.get('stateType') == \"number:1\") {\n                  breathFlash(cell, type, attrsType[\"fill\"], returnData.value, false);\n                } else if (cell.get('stateType') == \"number:2\") {\n                  bubbleFlash(cell, type, attrsType[\"fill\"], returnData.value, false);\n                } else if (cell.get('stateType') == \"number:3\") {\n                  breathFlash(cell, type, attrsType[\"fill\"], returnData.value, true);\n                } else if (cell.get('stateType') == \"number:4\") {\n                  bubbleFlash(cell, type, attrsType[\"fill\"], returnData.value, true);\n                } else {\n                  fillColor(cell, type, attrsType[\"fill\"], returnData.value, cellObj[returnData.nodeId + \"text_fill\"]);\n                }\n              } else if (extend == 'alarm') {\n                cellObj[returnData.nodeId] = cell;\n                cellsDic[returnData.nodeId].push(cellObj);\n                if (!showEffect) return;\n                changeIconAndText(cell, returnData.value);\n              } else if (extend == \"level\") {\n                fillColor(cell, type, attrsType[\"fill\"], returnData.value, false);\n              }\n            }\n          }\n        });\n      }\n    };\n    /**\n     * 文本修改\n     * @param {Object} cell\n     * @param {Object} value\n     */\n\n\n    var fillValue = function fillValue(cell, value) {\n      var extend = cell.get(\"extend\");\n      if (extend == 'alarm') return;\n\n      if (extend == 'level') {\n        setLevel(cell, value);\n      } else {\n        var unit = \"\";\n\n        if (cell.get(\"unitType\") == \"number:1\") {\n          var kpiDef = kpiDefDic[cell.get(\"kpiId\")];\n\n          if (kpiDef && $scope.myOptionDic) {\n            unit = $scope.myOptionDic[kpiDef.unit];\n\n            if (unit) {\n              cell.prop('attrs/text/text', value + \"\" + unit);\n            }\n          }\n        }\n\n        if (!unit) cell.prop('attrs/text/text', value);\n      }\n    };\n    /**\n     * 组件label设置\n     * @param {Object} returnData\n     */\n\n\n    var valueHandler = function valueHandler(returnData) {\n      if (cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode]) {\n        cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode].forEach(function (cellObj) {\n          fillValue(cellObj, cellObj.rangeObj ? cellObj.rangeObj[returnData.value] : returnData.value);\n          if (cellObj.get(\"extend\") == 'value') changeIconAndText(cellObj, returnData.value, \"valueConfig\");\n        });\n      } else {\n        var rangeObj;\n        if (returnData.modelId) rangeObj = $rootScope.rootModelsDic[returnData.modelId].kpiDic[returnData.kpiCode].rangeObj;\n        graph.attributes.cells.models.forEach(function (cell) {\n          if (cell.get(\"nodeId\")) {\n            var nodeIdAry = cell.get(\"nodeId\").split(\":\");\n\n            if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] == returnData.nodeId) {\n              if (!cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode]) cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode] = [];\n\n              if (cell.get(\"kpiId\")) {\n                var kpiIdAry = cell.get(\"kpiId\").split(\":\");\n\n                if (kpiIdAry.length > 0 && kpiIdAry[kpiIdAry.length - 1] == returnData.kpiCode) {\n                  cell.rangeObj = rangeObj;\n                  cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode].push(cell);\n                  fillValue(cell, rangeObj ? rangeObj[returnData.value] : returnData.value);\n                  if (cell.get(\"extend\") == 'value') changeIconAndText(cell, returnData.value, \"valueConfig\");\n                }\n              }\n            }\n          }\n        });\n      }\n    };\n    /**\n     * 获得组件绑定的设备上基本告警状态\n     * @param {Object} ids\n     */\n\n\n    var getResourceBaseState = function getResourceBaseState(ids) {\n      kpiDataService.getRealTimeKpiData(ids, [999999], function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            stateHandler(returnObj.data[i]);\n          }\n        }\n      }, true);\n    };\n    /**\n     * 获得组件绑定的设备上KPI指标数据\n     * @param {Object} ids\n     * @param {Object} kpis\n     */\n\n\n    var getResourceState = function getResourceState(ids, kpis) {\n      kpiDataService.getRealTimeKpiData(ids, kpis, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            valueHandler(returnObj.data[i]);\n          }\n        }\n      });\n    };\n    /******** 以下为websocket处理 ********/\n\n\n    var uuid = Math.uuid();\n\n    var getWebsocket = function getWebsocket(ids, kpis) {\n      kpis.push(999999);\n      var param = {\n        ciid: ids.toString(),\n        kpi: kpis.toString()\n      };\n      var operation = \"register\"; //考虑极端情况，一个页面有多个模块监听同一个方法\n      //但展示在页面的数据需对接收的实时监听的数据做不同处理\n\n      SwSocket.register(uuid, operation, function (returnObj) {\n        if (returnObj.data.kpiCode == 999999) stateHandler(returnObj.data);else valueHandler(returnObj.data);\n      }); //websocket发送请求\n\n      SwSocket.send(uuid, operation, 'kpi', param);\n    };\n    /**\n     * 注销scope时注销方法heartBeat，回调函数callback\n     */\n\n\n    $scope.$on(\"$destroy\", function () {\n      SwSocket.unregister(uuid);\n      if (interval) clearInterval(interval);\n    });\n    /******** 以上为websocket处理 ********/\n\n    /**\n     * 通过viewId获得视图的组态内容\n     * @param {Object} scope\n     * @param {Object} viewId\n     */\n\n    var showViewContent = function showViewContent(scope, viewId) {\n      //清空原来的组件内容\n      cellsDic = {};\n\n      if (graph.attributes && graph.attributes.cells && graph.attributes.cells.models) {\n        graph.attributes.cells.models.forEach(function (cell) {\n          cell.off('transition:end');\n        });\n        graph.clear();\n      }\n\n      if (viewId != \"all\") {\n        viewFlexService.getViewById(viewId, function (returnObj) {\n          if (returnObj.code == 0) {\n            $.AdminLTE.controlSidebar.activate(); //激活控制区域\n\n            $scope.selectedView = returnObj.data;\n            $scope.selectedView.temp = {}; //临时存储Domains\n\n            $scope.selectedView.inspector = false; //控制inspector是否显示视图设置\n            //设置管理域\n\n            $scope.selectedView.domainListTree = [$scope.domainListDic[$scope.selectedView.domainPath]]; //查询扩展域（项目视图且扩展域配置为真时）\n\n            if ($scope.baseConfig && $scope.baseConfig.extendDomain && $scope.selectedView.template && $scope.selectedView.template.resourceType == 'project') {\n              resourceUIService.getResourceByIds([$scope.selectedView.template.resourceId], function (resourceDic) {\n                if (!resourceDic[$scope.selectedView.template.resourceId]) return;\n                var domains = resourceDic[$scope.selectedView.template.resourceId].domains.replace($scope.selectedView.template.resourceId + \"/\", \"\");\n                var params = {\n                  domains: domains,\n                  modelId: 301\n                };\n                resourceUIService.getExtendDomainsByFilter(params, function (returnObj) {\n                  if (returnObj.code != 0) return;\n                  $scope.selectedView.subDomainListTree = returnObj.domainListTree;\n                  $scope.selectedView.subDomainListDic = returnObj.domainListDic;\n                });\n              });\n            }\n\n            scope.data.viewTitle = $scope.selectedView.viewTitle; //设计模式下，获得背景、自定义和通用组件\n\n            if (!displayMode) {\n              $scope.autoSaveHandler(scope.components.myCommander.save4Json);\n\n              if ($scope.$parent.configViewBg.length > 0) {\n                scope.data.bgimages = scope.data.bgimages.concat($scope.$parent.configViewBg);\n              }\n\n              if ($scope.$parent.configCustoms.length > 0) {\n                scope.components.stencil.load($scope.$parent.configCustoms, \"enterprise\");\n                scope.components.layout(stencil.getGraph(\"enterprise\"));\n                scope.components.stencil.getPaper(\"enterprise\").fitToContent(1, 1, 10);\n              }\n\n              if ($scope.$parent.configCommons.length > 0) {\n                scope.components.stencil.load($scope.$parent.configCommons.concat(scope.data.stencil.shapes.customer), \"customer\");\n                scope.components.layout(stencil.getGraph(\"customer\"));\n                scope.components.stencil.getPaper(\"customer\").fitToContent(1, 1, 10);\n                $scope.$parent.configCommons.forEach(function (configItem) {\n                  configItem.label = configItem.attrs.text.text;\n                  $scope.alertIcons.push(configItem);\n                });\n              }\n            } //如果有视图内容，按照视图内容处理，否则用空的内容\n\n\n            if (returnObj.data.content) {\n              $scope.fillType = scope.data.fillType;\n              var content = JSON.parse(returnObj.data.content);\n              var contentCellsDic = {};\n              var originalCellDic = {}; //原始的单元格\n\n              var scale = (scope.data.paperscorllerW - 20) / content.width; // 展示模式下，去掉线条的控制显示和性能视图的组件存储\n\n              for (var i = content.cells.length - 1; i > -1; i--) {\n                if (content.cells[i].type == \"link\") {\n                  if (displayMode) {\n                    jQuery.extend(content.cells[i], displayModeLink);\n                    content.cells[i].attrs['.connection-wrap'] = {\n                      display: 'none'\n                    };\n                  }\n                } else if (content.cells[i].type == \"chart.Plot\") {\n                  if (displayMode) {\n                    contentCellsDic[content.cells[i].id] = content.cells[i];\n                  }\n                } else {\n                  originalCellDic[content.cells[i].id] = content.cells[i];\n                }\n              } //如果缩放操作有，进行处理\n\n\n              if (zoomOptAry.length > 0) {\n                paperScroller.zoom(-zoomOptAry.pop(), {\n                  max: 4\n                });\n                paper.$el.css('margin-left', 0);\n              }\n\n              scope.components.graph.fromJSON(content);\n              scope.components.paper.options.gridSize = Number(content.gridSize);\n              scope.components.paper.options.width = content.width;\n              scope.components.paper.options.height = content.height;\n              scope.data.bgimage = content.bgimage;\n              scope.data.bgcolor = content.bgcolor ? content.bgcolor : \"#ffffff\";\n              scope.data.width = content.width;\n              scope.data.height = content.height;\n              scope.data.originalCellDic = originalCellDic;\n              scope.components.myCommander.setDimensions();\n              scope.components.myCommander.setGrid();\n              paper.$el.css('background-position', \"center center\");\n\n              if (displayMode) {\n                // paperSroller缩放处理\n                zoomOptAry.push(scale - 1);\n                paperScroller.zoom(scale - 1, {\n                  max: 4\n                });\n                paper.$el.css('margin-right', 0);\n                scope.data.width = jQuery(\".paper\").width();\n                scope.data.height = jQuery(\".paper\").height();\n                paperScroller.scroll(0, 0); //paperScroller.$el.css('overflow-x', \"hidden\");\n\n                paperScroller.$el.css('padding-left', \"0\");\n                paperScroller.$el.css('padding-top', \"0\");\n                /** 以下处理echarts */\n\n                var echartAry = [];\n                var groupDic = {};\n\n                for (var i = graph.attributes.cells.models.length - 1; i > -1; i--) {\n                  var cellsModel = graph.attributes.cells.models[i];\n\n                  if (cellsModel.attributes.type == \"chart.Plot\") {\n                    var boxClientRect = jQuery(\"[model-id=\" + cellsModel.id + \"]\").find(\"g.background\")[0].getBoundingClientRect();\n\n                    if (!contentCellsDic[cellsModel.id + \"_extend\"]) {\n                      contentCellsDic[cellsModel.id].size.width = boxClientRect.width;\n                      contentCellsDic[cellsModel.id].size.height = boxClientRect.height;\n                      contentCellsDic[cellsModel.id].size.x = boxClientRect.left;\n\n                      if ($routeParams.type == 'service') {\n                        contentCellsDic[cellsModel.id].size.y = cellsModel.attributes.position.y * scale;\n                      } else {\n                        contentCellsDic[cellsModel.id].size.y = boxClientRect.top - 86;\n                      }\n\n                      contentCellsDic[cellsModel.id].position.width = boxClientRect.width;\n                      contentCellsDic[cellsModel.id].position.height = boxClientRect.height;\n                      contentCellsDic[cellsModel.id].position.x = boxClientRect.left;\n\n                      if ($routeParams.type == 'service') {\n                        contentCellsDic[cellsModel.id].position.y = cellsModel.attributes.position.y * scale;\n                      } else {\n                        contentCellsDic[cellsModel.id].position.y = boxClientRect.top - 86;\n                      }\n\n                      contentCellsDic[cellsModel.id + \"_extend\"] = true;\n                    }\n\n                    if (cellsModel.attributes.tabsInfo || cellsModel.attributes.attrs.text && cellsModel.attributes.attrs.text.text) {\n                      var textary;\n\n                      if (!cellsModel.attributes.tabsInfo) {\n                        textary = cellsModel.attributes.attrs.text.text.split(\"$$\");\n                      } else {\n                        textary = cellsModel.attributes.tabsInfo.split(\"$$\");\n                      }\n\n                      if (textary.length > 1) {\n                        //有group状态\n                        cellsModel.attributes.attrs.text = {\n                          text: textary[textary.length - 1]\n                        };\n                        contentCellsDic[cellsModel.id].attrs.text = cellsModel.attributes.attrs.text;\n                        var groupDef = JSON.parse(textary[0]);\n\n                        if (!groupDic[groupDef.group]) {\n                          groupDic[groupDef.group] = {\n                            name: groupDef.group,\n                            x: contentCellsDic[cellsModel.id].position.x,\n                            y: contentCellsDic[cellsModel.id].position.y,\n                            width: contentCellsDic[cellsModel.id].size.width,\n                            height: contentCellsDic[cellsModel.id].size.height,\n                            echartAry: []\n                          };\n                        }\n\n                        groupDic[groupDef.group].echartAry.push(contentCellsDic[cellsModel.id]);\n                      } else {\n                        echartAry.push(contentCellsDic[cellsModel.id]);\n                      }\n                    } else {\n                      echartAry.push(contentCellsDic[cellsModel.id]);\n                    }\n\n                    cellsModel.remove();\n                  }\n                }\n\n                scope.data.echartAry = echartAry;\n                var groupAry = [];\n\n                for (var k in groupDic) {\n                  groupAry.push(groupDic[k]);\n                }\n\n                scope.data.groupAry = groupAry;\n                /** 以上处理echarts */\n\n                var ids = [];\n                var kpis = [];\n                content.cells.forEach(function (item) {\n                  if (item.nodeId && item.type != \"chart.Plot\") {\n                    var nodeIdAry = item.nodeId.split(\":\");\n\n                    if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] != '?') {\n                      var nodeId = Number(nodeIdAry[nodeIdAry.length - 1]);\n                      if (nodeId == 0) return true;\n                      ids.push(nodeId);\n\n                      if (item.kpiId) {\n                        var kpiIdAry = item.kpiId.split(\":\");\n\n                        if (kpiIdAry.length > 0 && kpiIdAry[kpiIdAry.length - 1] != '?') {\n                          var kpiId = Number(kpiIdAry[kpiIdAry.length - 1]);\n                          if (kpiId == 0) return true;\n                          var modelAry = item.modelId.split(\":\");\n                          var modelId = Number(modelAry[modelAry.length - 1]);\n                          var model = resourceUIService.rootModelDic[modelId];\n\n                          if (model && model.kpis) {\n                            model.kpis.forEach(function (kpiDef) {\n                              if (kpiId == kpiDef.id) {\n                                kpiDefDic[item.kpiId] = kpiDef;\n                                kpis.push(kpiId);\n                                getResourceState([nodeId], [kpiId]);\n                                return false;\n                              }\n                            });\n                          }\n                        }\n                      }\n                    }\n                  }\n                });\n\n                if (ids.length > 0) {\n                  getResourceBaseState(ids);\n                  getWebsocket(ids, kpis);\n                }\n              } //              scope.components.commander.reset();\n\n            } else {\n              scope.data.bgcolor = \"#ffffff\"; //              scope.components.commander.reset();\n\n              scope.components.graph.clear();\n\n              if (displayMode) {\n                paper.$el.css('background-image', 'url(\"\"),url(\"\")');\n                paper.$el.css('margin-right', 0);\n              }\n            }\n\n            $scope.onEvent(\"graphUpdated\", function () {\n              setTimeout(function () {\n                $scope.$apply(function () {\n                  $rootScope.dirty = true;\n                });\n              });\n            });\n          }\n        });\n      }\n    }; //组态线条的处理\n\n\n    var PatternLinkView = joint.dia.LinkView.extend({\n      patternMarkup: ['<pattern id=\"pattern-<%= id %>\" patternUnits=\"userSpaceOnUse\">', '<image xlink:href=\"\"/>', '</pattern>'].join(''),\n      render: function render() {\n        joint.dia.LinkView.prototype.render.apply(this, arguments);\n\n        if (this.model && !this.model.get(\"pattern\")) {\n          return;\n        }\n\n        this.listenTo(this.model, 'change:pattern change:patternColor', this.update);\n        return this;\n      },\n      remove: function remove() {\n        joint.util.cancelFrame(this.frameId);\n        joint.dia.LinkView.prototype.remove.apply(this, arguments);\n\n        if (this.pattern) {\n          this.pattern.remove();\n          this.pattern = null;\n        }\n      },\n      update: function update() {\n        joint.dia.LinkView.prototype.update.apply(this, arguments);\n\n        if (this.model && !this.model.get(\"pattern\")) {\n          return;\n        }\n\n        if (!this.pattern) {\n          this.pattern = joint.V(_.template(this.patternMarkup)({\n            id: this.id\n          }));\n          this.patternImage = this.pattern.findOne('image');\n          joint.V(this.paper.svg).defs().append(this.pattern);\n        }\n\n        this._V.connection.attr({\n          'stroke': 'url(#pattern-' + this.id + ')'\n        });\n\n        this.strokeWidth = this._V.connection.attr('stroke-width') || 1;\n        joint.util.cancelFrame(this.frameId);\n        this.frameId = joint.util.nextFrame(_.bind(this.fillWithPattern, this));\n        return this;\n      },\n      fillWithPattern: function fillWithPattern() {\n        var strokeWidth = this.strokeWidth;\n        var bbox = joint.g.rect(joint.V(this.el).bbox(true)).moveAndExpand({\n          x: -strokeWidth,\n          y: -strokeWidth,\n          width: 2 * strokeWidth,\n          height: 2 * strokeWidth\n        });\n        var points = [].concat(this.sourcePoint, this.route, this.targetPoint);\n        points = _.map(points, function (point) {\n          return joint.g.point(point.x - bbox.x, point.y - bbox.y);\n        });\n        var canvas = document.createElement('canvas');\n        canvas.width = bbox.width;\n        canvas.height = bbox.height;\n        var ctx = canvas.getContext('2d');\n        ctx.lineWidth = strokeWidth;\n        ctx.lineJoin = \"round\";\n        ctx.lineCap = \"round\";\n\n        for (var i = 0, pointsCount = points.length - 1; i < pointsCount; i++) {\n          ctx.save();\n          var gradientPoints = this.gradientPoints(points[i], points[i + 1], strokeWidth);\n          var gradient = ctx.createLinearGradient.apply(ctx, gradientPoints);\n          this.drawPattern.call(this, ctx, points[i], points[i + 1], strokeWidth, gradient, points, i);\n          ctx.restore();\n        }\n\n        var dataUri = canvas.toDataURL('image/png');\n        this.pattern.attr(bbox);\n        this.patternImage.attr({\n          width: bbox.width,\n          height: bbox.height,\n          'xlink:href': dataUri\n        });\n      },\n      gradientPoints: function gradientPoints(from, to, width) {\n        var angle = joint.g.toRad(from.theta(to) - 90);\n        var center = joint.g.line(from, to).midpoint();\n        var start = joint.g.point.fromPolar(width / 2, angle, center);\n        var end = joint.g.point.fromPolar(width / 2, Math.PI + angle, center);\n        return [start.x, start.y, end.x, end.y];\n      },\n      drawPattern: function drawPattern(ctx, from, to, width, gradient) {\n        ctx.beginPath();\n        ctx.moveTo(from.x, from.y);\n        ctx.lineTo(to.x, to.y);\n        ctx.stroke();\n        ctx.closePath();\n        ctx.beginPath();\n        ctx.strokeStyle = \"white\";\n        ctx.lineWidth = width - 2;\n        ctx.moveTo(from.x, from.y);\n        ctx.lineTo(to.x, to.y);\n        ctx.stroke();\n        ctx.closePath();\n      }\n    });\n    /**\n     * 新建组态视图\n     * @param {Object} callbackFun\n     */\n\n    var createConfigView = function createConfigView(callbackFun) {\n      $scope.configureInfo = {\n        viewId: 0,\n        viewTitle: '新建组态视图' + new Date().Format(\"yyyy-MM-dd\"),\n        viewType: 'configure',\n        template: {\n          type: 0\n        },\n        domainPath: '',\n        description: ''\n      };\n      var dialog = ngDialog.open({\n        template: '../partials/dialogue/configure_dia.html',\n        className: 'ngdialog-theme-plain',\n        scope: $scope\n      });\n      $scope.checkSameName($scope.configureInfo.viewTitle); // 模板、项目、普通之间的切换\n\n      var typeWatcher = function typeWatcher(n, o, s) {\n        var callback = function callback(event) {\n          var tree = event.data;\n          $scope.typeContents = [].concat(tree);\n        };\n\n        if (n < 2) {\n          callback({\n            data: $scope.treeAry\n          });\n        } else if (n == 2) {\n          if ($scope.getResourceByModelId) {\n            callback($scope.getResourceByModelId);\n          } else {\n            resourceUIService.getResourceByModelId(302, function (event) {\n              $scope.getResourceByModelId = event;\n              callback(event);\n            });\n          }\n\n          ;\n        }\n      };\n\n      $scope.$watch(\"configureInfo.template.type\", typeWatcher); //保存按钮\n\n      $scope.saveData = function () {\n        if (!$scope.configureInfo.template.resourceId || $scope.configureInfo.template.resourceId == 0) {\n          $scope.configureInfo.template = null;\n        } else {\n          if ($scope.configureInfo.template.type == 1) {\n            $scope.configureInfo.template.resourceType = \"device\";\n          } else {\n            $scope.configureInfo.template.resourceType = \"project\";\n          }\n        }\n\n        viewFlexService.addView($scope.configureInfo, function (returnObj) {\n          if (returnObj.code == 0) {\n            var viewId = returnObj.data.viewId;\n\n            if (dialog) {\n              dialog.close();\n              $('#' + dialog.id).remove();\n            }\n\n            growl.success(\"保存成功\");\n            location.href = \"index.html#/configure/\" + viewId;\n            /** 不使用回调方式，直接刷新了URL\n            if(callbackFun) {\n              callbackFun(returnObj.data.viewId);\n            }\n            growl.success(\"保存成功\")\n            */\n          }\n        });\n      };\n\n      $scope.closeDialog = function () {\n        if (dialog) {\n          dialog.close();\n          $('#' + dialog.id).remove();\n          window.history.back();\n        }\n      };\n    };\n    /**\n     * 更新组件的状态\n     */\n\n\n    $scope.updateCellHandler = function () {\n      if (inspector) {\n        if (inspector.getModel().collection) {\n          inspector.updateCell();\n        }\n      }\n    };\n    /**\n     * 右边栏控制\n     * @param {Object} status\n     */\n\n\n    var inspectorStatus = function inspectorStatus(status) {\n      $scope.selectedView.inspector = false;\n      $scope.$applyAsync();\n      $.AdminLTE.controlSidebar.openOrClose(status);\n    };\n\n    $scope.viewConfigClick = function () {\n      $scope.selectedView.inspector = true;\n      $scope.$applyAsync();\n    };\n    /********以下是划线的功能********/\n\n\n    var creatingLine = false;\n    var lineCoords = {\n      source: {},\n      target: {}\n    };\n    var tempLine;\n    var tempLines = [];\n    $(document.body).on('mousemove', function (evt) {\n      if (creatingLine) {\n        evt.preventDefault();\n        evt.stopPropagation();\n        evt = joint.util.normalizeEvent(evt);\n        var clientCoords = paper.snapToGrid({\n          x: evt.clientX,\n          y: evt.clientY\n        });\n        lineCoords.x2 = clientCoords.x;\n        lineCoords.y2 = clientCoords.y;\n        var d = 'M ' + lineCoords.x1 + ' ' + lineCoords.y1 + ' L ' + lineCoords.x2 + ' ' + lineCoords.y2;\n        tempLine.attr('d', d);\n      }\n    });\n    /********以上是划线的功能********/\n\n    /**\n     * 主动添加组件的处理\n     * @param {Object} cell\n     */\n\n    var addCellhandler = function addCellhandler(cell) {\n      if (cell.get(\"extend\") == \"copy\") {\n        var parentCell = JSON.parse(cell.get(\"parentCell\"));\n        var embedObjs = JSON.parse(cell.get(\"embedObjs\"));\n        var parentCellPos = cell.get(\"position\");\n        var oldParentCellPos = parentCell.position;\n        cell.remove();\n        parentCell.id = joint.util.uuid();\n        parentCell.embeds = [];\n        parentCell.z = graph.getLastCell() ? (Number(graph.getLastCell().get('z')) || 0) + 1 : 1;\n        if (parentCell.z > Number.MAX_VALUE) parentCell.z = Number.MAX_VALUE;\n        parentCell.position = parentCellPos;\n\n        if (embedObjs) {\n          for (var i = 0; i < embedObjs.length; i++) {\n            var embedobj = embedObjs[i];\n            embedobj.id = joint.util.uuid();\n            parentCell.embeds.push(embedobj.id);\n            embedobj.parent = parentCell.id;\n            embedobj.position.x = embedobj.position.x - oldParentCellPos.x + parentCellPos.x;\n            embedobj.position.y = embedobj.position.y - oldParentCellPos.y + parentCellPos.y;\n            embedobj.z = parentCell.z + i + 1;\n            if (embedobj.z > Number.MAX_VALUE) embedobj.z = Number.MAX_VALUE;\n            graph.addCell(embedobj);\n          }\n\n          ;\n        }\n\n        graph.addCell(parentCell);\n      } else if (typeof cell.get(\"z\") == \"string\") {\n        var newCell = cell.clone();\n        newCell.unset(\"z\");\n        newCell.attributes.z = graph.getLastCell() ? (Number(graph.getLastCell().get('z')) || 0) + 1 : 1;\n        if (newCell.attributes.z > Number.MAX_VALUE) newCell.attributes.z = Number.MAX_VALUE;\n        cell.remove();\n        graph.addCell(newCell);\n      }\n    };\n    /**\n     * 组态核心功能代码区域，基于Rappid,包括\n     * initializePaper\n     * initializeStencil\n     * initializeSelection\n     * initializeHaloAndInspector\n     * initializeNavigator\n     * initializeClipboard\n     * initializeMyCommandManager\n     * initializeCommandManager\n     * toolTips\n     * initView\n     * initAlertIconfunction\n     */\n\n\n    $scope.initialization = [// Create a graph, paper and wrap the paper in a PaperScroller.\n    // 创建一个图层，页面和包裹页面的页面控制层\n    function initializePaper(scope, element) {\n      var interactive = false;\n\n      if (!displayMode) {\n        interactive = true;\n      }\n\n      $scope.graph = graph = new joint.dia.Graph();\n      /**setTimeout(function(){\n        var graphwatcher = function(n,o, s){\n           \n        }\n        $scope.$watch(\"graph\", graphwatcher, true);\n      }, 5000);*/\n\n      paper = new joint.dia.Paper({\n        //          el: $('.paper-container'),\n        width: 1200,\n        height: 700,\n        gridSize: 10,\n        perpendicularLinks: true,\n        model: graph,\n        markAvailable: true,\n        interactive: interactive,\n        defaultLink: new joint.dia.Link({\n          attrs: {\n            '.marker-source': {\n              d: 'M 10 0 L 0 5 L 10 10 z',\n              transform: 'scale(0.001)'\n            },\n            '.marker-target': {\n              d: 'M 10 0 L 0 5 L 10 10 z'\n            },\n            '.connection': {\n              stroke: 'black'\n            }\n          }\n        }),\n        linkConnectionPoint: joint.util.shapePerimeterConnectionPoint,\n        linkView: PatternLinkView.extend({\n          drawPattern: function drawPattern(ctx, from, to, width, gradient) {\n            var innerWidth = width - 4;\n            var outerWidth = width;\n            var buttFrom = joint.g.point(from).move(to, -outerWidth / 2);\n            var buttTo = joint.g.point(to).move(from, -outerWidth / 2);\n            var lineColor = \"blue\";\n\n            if (this.model.get(\"attrs\") && this.model.get(\"attrs\")[\".connection\"]) {\n              lineColor = this.model.get(\"attrs\")[\".connection\"][\"stroke\"] ? this.model.get(\"attrs\")[\".connection\"][\"stroke\"] : lineColor;\n            }\n\n            gradient.addColorStop(0.300, lineColor);\n            var patternColor = \"#ffffff\";\n\n            if (this.model.get(\"patternColor\")) {\n              patternColor = this.model.get(\"patternColor\");\n            }\n\n            gradient.addColorStop(0.500, patternColor);\n            gradient.addColorStop(0.700, lineColor);\n            ctx.beginPath();\n            ctx.lineWidth = innerWidth;\n            ctx.strokeStyle = gradient;\n            ctx.moveTo(from.x, from.y);\n            ctx.lineTo(to.x, to.y);\n            ctx.stroke();\n            ctx.closePath();\n          }\n        })\n      });\n      paperScroller = new joint.ui.PaperScroller({\n        paper: paper,\n        autoResizePaper: displayMode,\n        padding: 0\n      });\n\n      if (!displayMode) {\n        snapLines = new joint.ui.Snaplines({\n          paper: paper\n        });\n      }\n\n      ;\n      $('.paper-container', element).append(paperScroller.el);\n      scope.components.paper = paper;\n      scope.components.scroller = paperScroller;\n      scope.components.graph = graph;\n      scope.data.paperscorllerW = $('.paper-scroller').width();\n      graph.on('add', function (cell, collection, opt) {\n        addCellhandler(cell);\n      });\n\n      if ($routeParams.type == 'service') {\n        $(paperScroller.el).css(\"overflow\", \"hidden\");\n        $(paperScroller.el).css(\"width\", \"auto\");\n        $(paperScroller.el).css(\"height\", \"auto\");\n      } else {\n        $('.paper-echart-container').scroll(function () {\n          $('.paper-scroller').scrollTop($('.paper-echart-container').scrollTop());\n        });\n        $('.paper-scroller').scroll(function () {\n          $('.paper-echart-container').scrollTop($('.paper-scroller').scrollTop());\n        });\n      }\n    }, // Create stencil.\n    // 创建模板\n    function initializeStencil(scope, element) {\n      function layout(graph) {\n        joint.layout.GridLayout.layout(graph, {\n          columnWidth: (stencil.options.width - 10) / 2,\n          columns: 2,\n          rowHeight: 90,\n          resizeToFit: false,\n          dy: 10,\n          dx: 0\n        });\n      }\n\n      stencil = new joint.ui.Stencil({\n        graph: graph,\n        paper: paper,\n        width: 230,\n        dropAnimation: true,\n        groups: scope.data.stencil.groups,\n        search: scope.data.stencil.search\n      }).on('filter', layout);\n\n      stencil.renderSearch = function () {\n        return $('<div class=\"sidebar-form\"><input placeholder=\"搜索...\" type=\"search\" class=\"search form-control\"/></div>');\n      };\n\n      $('.stencil-container', element).append(stencil.render().el);\n\n      _.each(scope.data.stencil.shapes, function (shapes, groupName) {\n        stencil.load(shapes, groupName);\n        layout(stencil.getGraph(groupName));\n        stencil.getPaper(groupName).fitToContent(1, 1, 10);\n      });\n\n      stencil.closeGroups();\n      scope.components.layout = layout;\n      scope.components.stencil = stencil;\n    }, // Create Selection\n    // 创建选择\n    function initializeSelection(scope, element) {\n      selection = new Backbone.Collection();\n      selectionView = new joint.ui.SelectionView({\n        paper: paper,\n        graph: graph,\n        model: selection\n      }); // Initiate selecting when the user grabs the blank area of the paper while the Shift key is pressed.\n      // 当shift键被按下时，启动用户在页面的空白区域时开始选择。\n      // Otherwise, initiate paper pan.\n      // 否则，页面默认功能\n\n      paper.on('blank:pointerdown', function (evt, x, y) {\n        inspectorStatus(false);\n\n        if (scope.data.drawStatus) {\n          var createLine = function createLine() {\n            var d = 'M ' + x + ' ' + y + ' L ' + x + ' ' + y;\n\n            if (tempLine) {\n              tempLines.push(tempLine);\n            }\n\n            tempLine = joint.V('path', {\n              stroke: 'black',\n              'stroke-width': 1,\n              d: d\n            });\n            joint.V(paper.viewport).append(tempLine);\n\n            if (!creatingLine) {\n              lineCoords.source = {\n                x: x,\n                y: y\n              };\n            } else {\n              if (!lineCoords.vertices) lineCoords.vertices = [];\n              lineCoords.vertices.push({\n                x: x,\n                y: y\n              });\n            }\n\n            creatingLine = true;\n            lineCoords.x1 = x;\n            lineCoords.y1 = y;\n          };\n\n          if (3 != evt.which) {\n            createLine();\n          } else {\n            if (creatingLine) {\n              createLine();\n              lineCoords.target = {\n                x: x,\n                y: y\n              };\n              var tmplink = new joint.dia.Link({\n                source: lineCoords.source,\n                target: lineCoords.target,\n                vertices: lineCoords.vertices,\n                attrs: {}\n              });\n              graph.addCell([tmplink]);\n              creatingLine = false;\n              lineCoords = {\n                source: {},\n                target: {}\n              };\n              tempLines.forEach(function (line) {\n                line.remove();\n              });\n              tempLines = [];\n              tempLine = null;\n              scope.$apply(function () {\n                scope.data.drawStatus = false;\n              });\n            }\n          }\n        } else {\n          if (shiftHold) {\n            selectionView.startSelecting(evt, x, y);\n          } else {\n            selectionView.cancelSelection();\n            paperScroller.startPanning(evt, x, y);\n            /* 这里暂时取消了。因为涉及到组态对象拖动时不能变化的问题\n            if(inspector && inspector.options.cell === $scope.selectedItem.cell) {\n              if(inspector.getModel().collection) {\n                inspector.updateCell();\n              }\n              inspector.remove();\n            }\n            */\n          }\n        }\n      });\n      paper.on('cell:pointerdown', function (cellView, evt) {\n        // Select an element if CTRL/Meta key is pressed while the element is clicked.\n        // 如果Ctrl /Meta 键是被按下，当元素被点击时，添加到selectionBox中\n        if ((evt.ctrlKey || evt.metaKey) && !(cellView.model instanceof joint.dia.Link)) {\n          selectionView.createSelectionBox(cellView);\n          selection.add(cellView.model);\n        }\n      });\n      selectionView.on('selection-box:pointerdown', function (evt) {\n        // Unselect an element if the CTRL/Meta key is pressed while a selected element is clicked.\n        // 取消之前的效果\n        if (evt.ctrlKey || evt.metaKey) {\n          var cell = selection.get($(evt.target).data('model'));\n          selectionView.destroySelectionBox(paper.findViewByModel(cell));\n          selection.reset(selection.without(cell));\n        }\n      }); // Disable context menu inside the paper.\n      // 取消HTML默认页面菜单\n      // This prevents from context menu being shown when selecting individual elements with Ctrl in OS X.\n\n      paper.el.oncontextmenu = function (evt) {\n        evt.preventDefault();\n      };\n\n      keyboardJS.on('delete, backspace', function (evt) {\n        if (!$.contains(evt.target, paper.el)) {\n          // remove selected elements from the paper only if the target is the paper\n          return;\n        }\n\n        commandManager.initBatchCommand();\n        selection.invoke('remove');\n        commandManager.storeBatchCommand();\n        selectionView.cancelSelection();\n\n        if (backspaceHold && !$(evt.target).is(\"input, textarea\")) {\n          // Prevent Backspace from navigating back.\n          evt.preventDefault();\n        }\n      });\n    }, // Halo, FreeTransfrom  & Inspector\n    // 元素控制器，自由转换和属性\n    function initializeHaloAndInspector(scope, element) {\n      function openCellTools(cellView) {\n        var $inspectorHolder = $('#control-sidebar-settings-data', element);\n        var $inspectorHolder_text = $('#control-sidebar-settings-text', element);\n        var $inspectorHolder_presentation = $('#control-sidebar-settings-presentation', element);\n        var $inspectorHolder_geometry = $('#control-sidebar-settings-geometry', element);\n        var cell = cellView.model || cellView;\n        var halo;\n\n        if (displayMode) {\n          if (!cellsDic[cell.id]) cellsDic[cell.id] = jQuery.extend(true, {}, cell.attributes);\n          var subViewState = cell.get('subViewId') && cell.get('subViewId') != \"number:0\" && cell.get('subViewId') != \"?\";\n          var nodeState = cell.get('nodeId') && cell.get('nodeId') != \"number:0\" && cell.get('nodeId') != \"?\";\n\n          if (subViewState == null || nodeState == null) {\n            cell.attributes = cellsDic[cell.id];\n            subViewState = cell.get('subViewId') && cell.get('subViewId') != \"number:0\" && cell.get('subViewId') != \"?\";\n            nodeState = cell.get('nodeId') && cell.get('nodeId') != \"number:0\" && cell.get('nodeId') != \"?\";\n          }\n\n          if (subViewState || nodeState) {\n            halo = new joint.ui.Halo({\n              cellView: cellView,\n              type: 'toolbar'\n            }).render();\n            halo.removeHandles();\n          }\n\n          if (nodeState) {\n            var dirNodeId; //指令设备对象\n\n            var dirModelId; //设备对象模板\n\n            var nodeIdAry = cell.get('nodeId').toString().split(\":\");\n            if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] != '?') dirNodeId = Number(nodeIdAry[nodeIdAry.length - 1]);\n            var modelIdAry = cell.get('modelId').toString().split(\":\");\n            if (modelIdAry.length > 0 && modelIdAry[modelIdAry.length - 1] != '?') dirModelId = Number(modelIdAry[modelIdAry.length - 1]);\n            var dirModel = resourceUIService.rootModelDic[dirModelId];\n            var dirSn = cell.get('sn');\n            $scope.selectedItem[\"nodeId\"] = dirNodeId;\n            halo.addHandle({\n              name: 'alertaction',\n              position: 's',\n              icon: 'images/alert.svg'\n            });\n            halo.on('action:alertaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              window.open(\"../app-oc/index.html#/configAlert/\" + dirNodeId + \"/node\");\n            });\n            halo.addHandle({\n              name: 'chartaction',\n              position: 's',\n              icon: 'images/chart.svg'\n            });\n            halo.on('action:chartaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              window.open(\"../app-oc/index.html#/emcsView/\" + dirNodeId);\n            });\n            halo.addHandle({\n              name: 'infoaction',\n              position: 's',\n              icon: 'images/info.svg'\n            });\n            halo.on('action:infoaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              window.open(\"../app-oc/index.html#/facility/sn/\" + dirSn);\n            });\n            halo.addHandle({\n              name: 'configaction',\n              position: 's',\n              icon: 'images/config.svg'\n            });\n            halo.on('action:configaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              if (dirModel && dirModel.category == \"Device\") window.open(\"../app-oc/index.html#/resource_type/\" + dirModelId + \"/0\");else window.open(\"../app-oc/index.html#/resourcegroup/\" + dirModelId + \"/0\");\n            });\n\n            if (cell.get('directiveIds')) {\n              halo.addHandle({\n                name: 'directiveaction',\n                position: 's',\n                icon: 'images/directive.svg'\n              });\n              halo.on('action:directiveaction:pointerdown', function (evt) {\n                evt.stopPropagation();\n                inspectorStatus(true);\n                var directiveList = [];\n                cell.get('directiveIds').forEach(function (directiveId) {\n                  if (typeof directiveId != \"number\") {\n                    var ary = directiveId.split(\":\");\n                    directiveId = Number(ary[ary.length - 1]);\n                  }\n\n                  dirModel.directives.forEach(function (dirObj) {\n                    if (directiveId == dirObj.id) {\n                      directiveList.push(dirObj);\n                    }\n                  });\n                });\n                $scope.directiveList = directiveList;\n                $scope.$apply();\n              });\n            }\n\n            if (cell.get('valueConfig')) {\n              var isSend = false; //是否发送过\n\n              $scope.valueLevels = cell.get('valueConfig');\n\n              if ($scope.valueLevels && dirModel) {\n                $scope.valueLevels.forEach(function (valueLvevel) {\n                  if (valueLvevel.stateDisplay && valueLvevel.valueDirective && valueLvevel.valueDirectiveAttr) {\n                    isSend = true;\n                    dirModel.directives.forEach(function (dirObj) {\n                      if (valueLvevel.valueDirective == dirObj.id) {\n                        dirObj.value = valueLvevel.valueDirectiveAttr;\n                        $scope.sendItemDir(dirObj, dirNodeId);\n                      }\n                    });\n                  }\n                });\n\n                if (!isSend && $scope.valueLevels[0].valueDirective && $scope.valueLevels[0].valueDirectiveAttr) {\n                  dirModel.directives.forEach(function (dirObj) {\n                    if ($scope.valueLevels[0].valueDirective == dirObj.id) {\n                      dirObj.value = $scope.valueLevels[0].valueDirectiveAttr;\n                      $scope.sendItemDir(dirObj, dirNodeId);\n                    }\n                  });\n                }\n              }\n            }\n          }\n\n          if (subViewState) {\n            var dirSubViewId;\n            var subViewIdAry = cell.get('subViewId').toString().split(\":\");\n            if (subViewIdAry.length > 0 && subViewIdAry[subViewIdAry.length - 1] != '?') dirSubViewId = Number(subViewIdAry[subViewIdAry.length - 1]);\n            halo.addHandle({\n              name: 'nextaction',\n              position: 's',\n              icon: 'images/subview.svg'\n            });\n            halo.on('action:nextaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n\n              if ($routeParams.type == 'service') {\n                loc.path(\"display/\" + dirSubViewId + \"/service\");\n              } else {\n                if (dirSubViewId > 0) {\n                  SwSocket.unregister(uuid);\n                  uuid = Math.uuid();\n                  scope.data.viewRoutes.push($scope.selectedView);\n                  showViewContent(scope, dirSubViewId);\n                }\n              }\n            });\n          }\n\n          return;\n        } else {\n          if (scope.components.commander.configDispaly) inspectorStatus(true);\n          halo = new joint.ui.Halo({\n            cellView: cellView\n          }).render();\n\n          halo.options.clone = function (cell, opt) {\n            var cloneCell = cell.clone();\n            var z = (Number(graph.getLastCell().get('z')) || 0) + 1;\n            cloneCell.attributes[\"z\"] = z;\n            cloneCell.prop(\"z\", z);\n            cloneCell.unset(\"parent\");\n            return cloneCell;\n          };\n\n          if (cell.get(\"alertConfig\")) {\n            $scope.alertLevels = cell.get(\"alertConfig\");\n          } else {\n            $scope.alertLevels = [{\n              label: '正常',\n              id: 0\n            }, {\n              label: '警告',\n              id: 1\n            }, {\n              label: '次要',\n              id: 2\n            }, {\n              label: '重要',\n              id: 3\n            }, {\n              label: '严重',\n              id: 4\n            }];\n          }\n\n          if (cell.get(\"valueConfig\")) {\n            $scope.valueLevels = cell.get(\"valueConfig\");\n          } else {\n            $scope.valueLevels = [{\n              label: '第一组数据',\n              id: 0,\n              stateDisplay: true\n            }, {\n              label: '第二组数据',\n              id: 1,\n              stateDisplay: false\n            }, {\n              label: '第三组数据',\n              id: 2,\n              stateDisplay: false\n            }, {\n              label: '第四组数据',\n              id: 3,\n              stateDisplay: false\n            }, {\n              label: '第五组数据',\n              id: 4,\n              stateDisplay: false\n            }];\n          }\n\n          if (cell.attributes.embeds && cell.attributes.embeds.length > 0) {\n            halo.addHandle({\n              name: 'embedsaction',\n              position: 's',\n              icon: 'images/info.svg'\n            });\n            halo.addHandle({\n              name: 'copyaction',\n              position: 'w',\n              icon: 'images/print.png'\n            });\n\n            var extendHalohandler = function extendHalohandler(flg) {\n              var embeds = [];\n              var embedObjs = [];\n\n              if ($scope.selectedItem.cell.attributes.embeds) {\n                var parentCell = $scope.selectedItem.cell.clone();\n                parentCell.id = joint.util.uuid();\n                parentCell.attributes.id = parentCell.id;\n                parentCell.attributes.parent = \"\";\n                parentCell.attributes.z = graph.getLastCell() ? (Number(graph.getLastCell().get('z')) || 0) + 1 : 1;\n                var i = 1;\n                $scope.selectedItem.cell.attributes.embeds.forEach(function (cellid) {\n                  var cloneCell = graph.getCell(cellid).clone();\n                  cloneCell.id = joint.util.uuid();\n                  cloneCell.attributes.id = cloneCell.id;\n                  cloneCell.attributes.parent = parentCell.id;\n                  cloneCell.attributes.z = parentCell.attributes.z + i;\n                  embeds.push(cloneCell.id);\n\n                  if (flg == \"embedsaction\") {\n                    graph.addCell(cloneCell);\n                  } else if (flg == \"copyaction\") {\n                    embedObjs.push(cloneCell);\n                  }\n\n                  i++;\n                });\n                parentCell.attributes.embeds = embeds;\n\n                if (flg == \"embedsaction\") {\n                  graph.addCell(parentCell);\n                } else if (flg == \"copyaction\") {\n                  var copyactionhandler = function copyactionhandler(dataURL) {\n                    var imageWidth = 60;\n                    var imageHeight = 60;\n                    var pjson = parentCell.toJSON();\n                    var tmpcopy = {\n                      \"type\": \"basic.Image\",\n                      \"extend\": \"copy\",\n                      \"parentCell\": JSON.stringify(pjson),\n                      \"embedObjs\": JSON.stringify(embedObjs),\n                      \"size\": {\n                        \"width\": imageWidth,\n                        \"height\": imageHeight\n                      },\n                      \"attrs\": {\n                        \"image\": {\n                          \"width\": imageWidth,\n                          \"height\": imageHeight,\n                          \"xlink:href\": dataURL\n                        },\n                        \"text\": {\n                          \"text\": pjson.attrs.text.text,\n                          \"font-size\": 12,\n                          \"stroke\": \"#000000\",\n                          \"display\": \"block\",\n                          \"stroke-width\": 0,\n                          \"fill\": \"#000000\",\n                          \"ref-dy\": 10,\n                          \"font-family\": \"Microsoft YaHei\"\n                        }\n                      }\n                    };\n                    $scope.$parent.configCustoms.push(tmpcopy);\n                    scope.components.stencil.load($scope.$parent.configCustoms, \"enterprise\");\n                    scope.components.layout(stencil.getGraph(\"enterprise\"));\n                    scope.components.stencil.getPaper(\"enterprise\").fitToContent(1, 1, 10);\n                    var newconfig = {\n                      key: \"\",\n                      value: JSON.stringify(tmpcopy),\n                      groupName: \"ConfigurationCustom\",\n                      keyDesc: \"\",\n                      invalid: false,\n                      canDelete: true,\n                      domainPath: \"\",\n                      id: 0,\n                      label: pjson.attrs.text.text\n                    };\n                    configUIService.saveConfig(newconfig, function (returnObj) {});\n                  };\n\n                  paper.toPNG(function (dataURL) {\n                    copyactionhandler(dataURL);\n                  }, {\n                    padding: 0\n                  });\n                }\n              }\n            };\n\n            halo.on('action:embedsaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              extendHalohandler(\"embedsaction\");\n            });\n            halo.on('action:copyaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              extendHalohandler(\"copyaction\");\n            });\n          }\n\n          ;\n          /** 去掉Text的resize按钮 */\n\n          if (cell.get(\"type\") == \"basic.Text\") {\n            halo.removeHandle('resize');\n          }\n          /** freeTransform，halo已经具有该功能*/\n\n\n          if (cell.get(\"type\") != \"link\") {\n            var freeTransform = new joint.ui.FreeTransform({\n              cellView: cellView\n            }).render();\n          }\n        }\n\n        if ($scope.selectedItem.cell && $scope.selectedItem.cell.id == cell.id) return;\n        getAllSelectOption(createSelectItem(cell.attributes, {\n          cell: cell,\n          nodes: [],\n          kpis: [],\n          domainPath: $scope.selectedView.domainPath,\n          absheight: 100,\n          selectType: -1\n        })).then(function (selectedItem) {\n          $scope.selectedItem = jQuery.extend(true, {}, selectedItem);\n        });\n\n        function createSelectItem(attributes, options) {\n          var selectItem = options,\n              attr;\n\n          for (var i in attributes) {\n            attr = analysis(attributes[i]);\n\n            if (attr) {\n              selectItem[i] = attr;\n            }\n          }\n\n          return selectItem;\n        }\n\n        function analysis(attr) {\n          if (typeof attr == \"string\") {\n            return getValue(attr);\n          }\n\n          if (Array.isArray(attr)) {\n            return attr.map(function (d) {\n              return getValue(d);\n            });\n          }\n\n          return attr;\n        }\n        /** async load options will set node, sensor, kpi to null **/\n\n\n        function getAllSelectOption(selectedItem) {\n          var modelId = selectedItem.modelId,\n              domains = selectedItem.domainPath,\n              nodeId = selectedItem.nodeId;\n\n          if (modelId) {\n            return getDevicesByCondition(modelId, domains).then(function (nodes) {\n              selectedItem.nodes = nodes;\n              return getKpisByModelId(modelId).then(function (kpis) {\n                selectedItem.kpis = kpis;\n\n                if (nodeId) {\n                  return getResourceById(nodeId).then(function (resource) {\n                    selectedItem.sensors = getMeasurePointData(parse(resource.values.MeasurePointLocate));\n                    selectedItem.physicalConfig = resource.physicalConfig.accessConfigs;\n                    selectedItem.dataItems = selectedItem.physicalConfig.filter(function (d) {\n                      return d.instance == getValue(selectedItem.sensor);\n                    });\n                    selectedItem.domainListTree = [$scope.domainListDic[selectedItem.domainPath]];\n                    return success(selectedItem);\n                  });\n                } else {\n                  return success(selectedItem);\n                }\n              });\n            });\n          } else {\n            return success(selectedItem);\n          }\n        } // No need to re-render inspector if the cellView didn't change. 强制刷新\n\n\n        if (!inspector || inspector.options.cell !== cell || true) {\n          if (inspector) {\n            if (inspector.getModel().collection) {\n              // update cell if the model is still in the graph\n              inspector.updateCell();\n            } // Clean up the old inspector if there was one.\n\n\n            inspector.remove();\n          }\n\n          var inspectorDefs = scope.inspectorDefs[cell.get('type')];\n          var inputs = inspectorDefs ? inspectorDefs.inputs ? inspectorDefs.inputs : scope.commonInspectorInputs : scope.commonInspectorInputs;\n          var groups = inspectorDefs ? inspectorDefs.groups ? inspectorDefs.groups : scope.commonInspectorGroups : scope.commonInspectorGroups;\n\n          if (cell.get('extend') == \"alarm\") {\n            inputs = _.extend(inputs, scope.extendAlertInputs);\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"value\") {\n            inputs = _.extend(inputs, scope.extendValueInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n          } else if (cell.get('extend') == \"baowualarm\") {\n            inputs = _.extend(scope.baowuAlerts, scope.basicAttr);\n          } else if (cell.get('extend') == \"kpis\") {\n            inputs = _.extend(inputs, scope.commonInspectorInputsKpis);\n          } else if (cell.get('extend') == \"instance\") {\n            inputs = _.extend(inputs, scope.commonInspectorInstance);\n            delete inputs.domainPath;\n            delete inputs.subViewId;\n            delete inputs.directiveIds;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"level\") {\n            inputs = _.extend({}, scope.levelInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"domain\") {\n            inputs = _.extend({}, scope.domainInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"switch\") {\n            inputs = _.extend({}, scope.switchInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"openangle\") {\n            inputs = _.extend({}, scope.openAngleInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else {\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          }\n\n          inspector = new joint.ui.Inspector({\n            inputs: inputs,\n            groups: groups,\n            cell: cell\n          }).on('render', function () {\n            this.$('[data-tooltip]').each(function () {\n              var $label = $(this);\n              new joint.ui.Tooltip({\n                target: $label,\n                content: $label.data('tooltip'),\n                right: '.inspector',\n                direction: 'right'\n              });\n            });\n          });\n          var el = inspector.render().el;\n\n          for (var i = 0; i < el.children.length; i++) {\n            $(el.children[i]).wrap(\"<div class='inspector'></div>\");\n          }\n\n          $inspectorHolder_geometry.html(el.children[3]);\n          $inspectorHolder_presentation.html(el.children[2]);\n          $inspectorHolder_text.html(el.children[1]);\n          $inspectorHolder.html(el.children[0]);\n          $compile($inspectorHolder)($scope);\n          $compile($inspectorHolder_text)($scope);\n          $compile($inspectorHolder_presentation)($scope);\n          $compile($inspectorHolder_geometry)($scope);\n        } // adjust selection\n\n\n        selectionView.cancelSelection();\n        selection.reset([cellView.model]);\n      }\n\n      ;\n      paper.on('cell:pointerup', function (cellView) {\n        if (cellView.model instanceof joint.dia.Element && !selection.contains(cellView.model)) {\n          openCellTools(cellView);\n        }\n      });\n      paper.on('link:options', function (evt, cellView, x, y) {\n        openCellTools(cellView);\n      });\n    }, // Navigator\n    // 导航（没有使用）\n    function initializeNavigator(scope, element) {\n      return;\n      navigator = new joint.ui.Navigator({\n        width: 240,\n        height: 115,\n        paperScroller: paperScroller,\n        zoomOptions: {\n          max: 5,\n          min: 0.2\n        }\n      });\n      $('.navigator-container', element).append(navigator.el);\n      navigator.render();\n    }, // Clipboard\n    // 剪切板缩略显示（没有使用）\n    function initializeClipboard(scope, element) {\n      clipboard = new joint.ui.Clipboard();\n      keyboardJS.on('ctrl + shift + c', function () {\n        // Copy all selected elements and their associated links.\n        clipboard.copyElements(selection, graph, {\n          translate: {\n            dx: 20,\n            dy: 20\n          },\n          useLocalStorage: true\n        });\n      });\n      keyboardJS.on('ctrl + shift + v', function () {\n        selectionView.cancelSelection();\n        clipboard.pasteCells(graph, {\n          link: {\n            z: -1\n          },\n          useLocalStorage: true\n        }); // Make sure pasted elements get selected immediately. This makes the UX better as\n        // the user can immediately manipulate the pasted elements.\n\n        clipboard.each(function (cell) {\n          if (cell.get('type') === 'link') return; // Push to the selection not to the model from the clipboard but put the model into the graph.\n          // Note that they are different models. There is no views associated with the models\n          // in clipboard.\n\n          selection.add(graph.getCell(cell.id));\n          selectionView.createSelectionBox(paper.findViewByModel(cell));\n        });\n      });\n      keyboardJS.on('ctrl + x', function () {\n        var originalCells = clipboard.copyElements(selection, graph, {\n          useLocalStorage: true\n        });\n        commandManager.initBatchCommand();\n\n        _.invoke(originalCells, 'remove');\n\n        commandManager.storeBatchCommand();\n        selectionView.cancelSelection();\n      });\n    }, // Command Manager\n    // 个性化的命令\n    function initializeMyCommandManager(scope, element) {\n      var getGridBackgroundImage = function getGridBackgroundImage(gridSize, color) {\n        var canvas = $('<canvas/>', {\n          width: gridSize,\n          height: gridSize\n        });\n        canvas[0].width = gridSize;\n        canvas[0].height = gridSize;\n        var context = canvas[0].getContext('2d');\n        context.beginPath();\n        context.rect(1, 1, 1, 1);\n        context.fillStyle = color || '#AAAAAA';\n        context.fill();\n        return canvas[0].toDataURL('image/png');\n      };\n\n      scope.components.myCommander = {};\n\n      scope.components.myCommander.setDimensions = function () {\n        paper.setDimensions(paper.options.width, paper.options.height);\n        paperScroller.options.baseWidth = paper.options.width;\n        paperScroller.options.baseHeight = paper.options.height;\n        paperScroller.$el.css('padding-top', 0);\n        paperScroller.$el.css('padding-left', 0);\n      };\n\n      scope.components.myCommander.setGrid = function () {\n        var gridSize = paper.options.gridSize;\n        var backgroundImage = getGridBackgroundImage(gridSize);\n\n        if (scope.data.bgcolor) {\n          paper.$el.css('background-color', scope.data.bgcolor);\n        } else {\n          paper.$el.css('background-color', \"#fff\");\n        }\n\n        if (scope.data.bgimage) {\n          if (!displayMode) {\n            paper.$el.css('background-image', 'url(\"' + backgroundImage + '\"),url(\"' + scope.data.bgimage + '\")');\n          } else {\n            paper.$el.css('background-image', 'url(\"\"),url(\"' + scope.data.bgimage + '\")');\n          }\n        } else {\n          if (!displayMode) {\n            paper.$el.css('background-image', 'url(\"' + backgroundImage + '\")');\n          } else {\n            paper.$el.css('background-image', 'url(\"\"),url(\"\")');\n          }\n        }\n      };\n\n      $rootScope.save4Json = scope.components.myCommander.save4Json = function (callback) {\n        var viewjson = graph.toJSON();\n        $rootScope.dirty = false;\n\n        var callback = callback || function () {};\n\n        viewjson.gridSize = paper.options.gridSize;\n        viewjson.width = paper.options.width;\n        viewjson.height = paper.options.height;\n        viewjson.bgimage = scope.data.bgimage;\n        viewjson.bgcolor = scope.data.bgcolor;\n        var JSONstring = JSON.stringify(viewjson);\n\n        try {\n          var param = {\n            viewId: $scope.selectedView.viewId,\n            viewTitle: scope.data.viewTitle,\n            viewName: scope.data.viewTitle,\n            viewType: \"configure\",\n            content: JSONstring\n          };\n\n          if (param.viewId == 0) {\n            viewFlexService.addView(param, function (returnObj) {\n              if (returnObj.code == 0) {\n                $rootScope.dirty = false;\n                callback(\"success\");\n                growl.success(\"保存成功\");\n              }\n            });\n          } else {\n            viewFlexService.updateView(param, function (returnObj) {\n              if (returnObj.code == 0) {\n                callback(\"success\");\n                $rootScope.dirty = false;\n                growl.success(\"保存成功\");\n              }\n            });\n          }\n        } catch (err) {\n          callback(\"error\");\n          alert(err);\n        }\n      };\n    }, // Command Manager\n    // rappid内置命令\n    function initializeCommandManager(scope, element) {\n      if (displayMode) return;\n      /** 重载CommandManager类的push方法 */\n\n      joint.dia.CommandManager.prototype.push = function (cmd) {\n        if (typeof _events_['graphUpdated'] == \"function\") {\n          _events_['graphUpdated']();\n        }\n\n        ;\n        this.redoStack = [];\n\n        if (!cmd.batch) {\n          this.undoStack.push(cmd);\n          this.trigger('add', cmd);\n        } else {\n          this.lastCmdIndex = Math.max(this.lastCmdIndex, 0);\n          this.trigger('batch', cmd);\n        }\n      };\n      /** */\n\n\n      commandManager = new joint.dia.CommandManager({\n        graph: graph\n      });\n      keyboardJS.on('ctrl + z', function () {\n        commandManager.undo();\n        selectionView.cancelSelection();\n      });\n      keyboardJS.on('ctrl + y', function () {\n        commandManager.redo();\n        selectionView.cancelSelection();\n      });\n      commandManager.configDispaly = true;\n\n      commandManager.configDispalySet = function (flg) {\n        commandManager.configDispaly = flg;\n      };\n\n      commandManager.alignAction = function (flg) {\n        commandManager.initBatchCommand();\n        var align;\n        selectionView.model.models.forEach(function (cell) {\n          if (flg == \"left\") {\n            if (!align) align = cell.attributes.position.x;\n\n            if (align > cell.attributes.position.x) {\n              align = cell.attributes.position.x;\n            }\n          } else if (flg == \"right\") {\n            if (!align) align = cell.attributes.position.x + cell.attributes.size.width;\n\n            if (align < cell.attributes.position.x + cell.attributes.size.width) {\n              align = cell.attributes.position.x + cell.attributes.size.width;\n            }\n          } else if (flg == \"up\") {\n            if (!align) align = cell.attributes.position.y;\n\n            if (align > cell.attributes.position.y) {\n              align = cell.attributes.position.y;\n            }\n          } else if (flg == \"down\") {\n            if (!align) align = cell.attributes.position.y + cell.attributes.size.height;\n\n            if (align < cell.attributes.position.y + cell.attributes.size.height) {\n              align = cell.attributes.position.y + cell.attributes.size.height;\n            }\n          }\n        });\n        selectionView.model.models.forEach(function (cell) {\n          if (cell.get(\"parent\")) {\n            var parentCell = graph.getCell(cell.get(\"parent\"));\n            var x_offset = parentCell.get(\"position\").x - cell.get(\"position\").x;\n            var y_offset = parentCell.get(\"position\").y - cell.get(\"position\").y;\n\n            if (flg == \"left\") {\n              cell.prop('position/x', align - x_offset);\n            } else if (flg == \"right\") {\n              cell.prop('position/x', align - parentCell.attributes.size.width - x_offset);\n            } else if (flg == \"up\") {\n              cell.prop('position/y', align - y_offset);\n            } else if (flg == \"down\") {\n              cell.prop('position/y', align - parentCell.attributes.size.height - y_offset);\n            }\n          }\n        });\n        selectionView.model.models.forEach(function (cell) {\n          if (!cell.get(\"parent\")) {\n            if (flg == \"left\") {\n              cell.prop('position/x', align);\n            } else if (flg == \"right\") {\n              cell.prop('position/x', align - cell.attributes.size.width);\n            } else if (flg == \"up\") {\n              cell.prop('position/y', align);\n            } else if (flg == \"down\") {\n              cell.prop('position/y', align - cell.attributes.size.height);\n            }\n          }\n        });\n        commandManager.storeBatchCommand();\n      };\n\n      commandManager.toFront = function () {\n        selection.invoke('toFront');\n      };\n\n      commandManager.toBack = function () {\n        selection.invoke('toBack');\n      };\n\n      commandManager.embed = function () {\n        var parentCell;\n        selectionView.model.models.forEach(function (cell) {\n          if (!parentCell) {\n            parentCell = cell;\n          } else {\n            if (parentCell.attributes.z > cell.attributes.z) {\n              parentCell = cell;\n            }\n          }\n        });\n        selectionView.model.models.forEach(function (cell) {\n          if (parentCell.id != cell.id) {\n            parentCell.embed(cell);\n          }\n        });\n      };\n\n      commandManager.unembed = function () {\n        selectionView.model.models.forEach(function (cell) {\n          if (cell.attributes.embeds) {\n            cell.attributes.embeds.forEach(function (cellid) {\n              cell.unembed(graph.getCell(cellid));\n            });\n          }\n        });\n      };\n\n      commandManager.preview = function () {\n        var viewId = $scope.selectedView.viewId;\n        var param = [{\n          viewId: viewId\n        }];\n        window.open('../app-free-style/index.html#/topoview/index/' + encodeURIComponent(JSON.stringify(param)), '_blank');\n      };\n\n      commandManager.flip = function () {\n        selectionView.model.models.forEach(function (cell) {\n          var attrs = cell.attributes.attrs;\n\n          if (attrs.hasOwnProperty(\"image\")) {\n            var image = attrs.image;\n\n            if (image.hasOwnProperty(\"transform\")) {\n              var scale = image.transform;\n\n              if (scale.indexOf(\"scale(-1,1)\") == -1) {\n                cell.attr(\"image/transform\", \"scale(-1,1),translate(-\" + image.width + \",0)\");\n              } else {\n                cell.attr(\"image/transform\", \"scale(1,1),translate(0,0)\");\n              }\n            } else {\n              cell.attr(\"image/transform\", \"scale(-1,1),translate(-\" + image.width + \",0)\");\n            }\n          }\n        });\n      };\n\n      commandManager.toJSON = function () {\n        var windowFeatures = 'menubar=no,location=no,resizable=yes,scrollbars=yes,status=no';\n\n        var windowName = _.uniqueId('json_output');\n\n        var jsonWindow = window.open('', windowName, windowFeatures);\n        jsonWindow.document.write(JSON.stringify(graph.toJSON()));\n      };\n\n      commandManager.loadJSON = function () {\n        BootstrapDialog.show({\n          title: '导入组态内容',\n          message: $('<textarea id=\"json4configer\" class=\"form-control\" placeholder=\"输入JSON\"></textarea>'),\n          buttons: [{\n            label: '确认',\n            cssClass: 'btn-primary',\n            hotkey: 13,\n            // Enter.\n            action: function action(dialogRef) {\n              dialogRef.close();\n              var inputcontent = document.getElementById('json4configer');\n\n              if (inputcontent.value) {\n                var json = JSON.parse(inputcontent.value);\n                graph.fromJSON(json);\n              }\n            }\n          }]\n        });\n      };\n\n      scope.components.commander = commandManager;\n    }, // toolTip显示处理\n    function toolTips(scope, element) {\n      $('.toolbar-container [data-tooltip]', element).each(function () {\n        new joint.ui.Tooltip({\n          target: $(this),\n          content: $(this).data('tooltip'),\n          top: '.toolbar-container',\n          direction: 'top'\n        });\n      });\n    }, // 初始化视图\n    function initView(scope, element) {\n      if ($routeParams.type == 'service') {\n        return;\n      }\n\n      ;\n\n      if (!$routeParams.viewId) {\n        location.href = \"../app-oc/index.html#/index\";\n        return;\n      }\n\n      scope.data.viewRoutes = [];\n\n      scope.data.viewChange = function (view) {\n        SwSocket.unregister(uuid);\n        uuid = Math.uuid();\n\n        for (var i in scope.data.viewRoutes) {\n          if (scope.data.viewRoutes[i].viewId == view.viewId) {\n            scope.data.viewRoutes.splice(i, scope.data.viewRoutes.length - i);\n          }\n        }\n\n        showViewContent(scope, view.viewId);\n      };\n\n      var loadcount = 0;\n\n      var gotoShowView = function gotoShowView() {\n        if (loadcount == 3) {\n          if ($routeParams.viewId != 0) {\n            showViewContent(scope, $routeParams.viewId);\n          } else {\n            createConfigView(function (viewId) {\n              showViewContent(scope, viewId);\n            });\n          }\n        }\n      };\n\n      var rootModelDicWatch = $scope.$watch(\"rootModelDic\", function (nv, ov) {\n        if (nv && !ov || ov) {\n          loadcount++;\n          gotoShowView();\n          rootModelDicWatch();\n        }\n      });\n      var domainListTreeWatch = $scope.$watch(\"domainListTree\", function (nv, ov) {\n        if (nv && !ov || ov) {\n          loadcount++;\n          gotoShowView();\n          domainListTreeWatch();\n        }\n      });\n      var myOptionDicWatch = $scope.$watch(\"myOptionDic\", function (nv, ov) {\n        if (nv && !ov || ov) {\n          loadcount++;\n          gotoShowView();\n          myOptionDicWatch();\n        }\n      });\n    }, // 初始化告警图标的方法\n    function initAlertIconfunction(scope, element) {\n      if (scope.data.stencil && scope.data.stencil.shapes && scope.data.stencil.shapes.customer) {\n        scope.data.stencil.shapes.customer.forEach(function (item) {\n          if (item.label || item.attrs.text && item.attrs.text.text) {\n            if (!item.label) item.label = item.attrs.text.text;\n            $scope.alertIcons.push(item);\n          }\n        });\n      }\n    }];\n    /********↑↑↑↑↑↑以上是组态的核心处理对象↑↑↑↑↑↑********/\n\n    if ($routeParams.type == 'service') {\n      if ($scope.defer == undefined) {\n        $scope.defer = $q.defer();\n      }\n\n      ;\n      var promise = $scope.defer.promise;\n\n      $scope.initialization[9] = function initView(scope, element) {\n        var confighome, confighomeArr, allmyViews, currentlevel;\n        $rootScope.dialogBox = undefined;\n        scope.open = false;\n\n        scope.wholeClick = function () {\n          scope.open = false;\n        };\n\n        if (scope.defer == undefined) {\n          scope.defer = $q.defer();\n        }\n\n        var promise = scope.defer.promise;\n\n        scope.lv1viewsclick = function (item) {\n          scope.open = false;\n\n          if (graph.attributes && graph.attributes.cells && graph.attributes.cells.models) {\n            graph.attributes.cells.models.forEach(function (cell) {\n              cell.off('transition:end');\n            });\n          }\n\n          ;\n          timeout(function () {\n            location.href = \"../app-sc/index_configure.html#/display/\" + item.viewId + \"/service\";\n          });\n        };\n\n        viewFlexService.getAllMyViews(function (event) {\n          if (event.code == 0) {\n            confighome = event.data.find(function (element) {\n              return element.viewType == 'confighome';\n            });\n            confighomeArr = event.data.filter(function (element) {\n              return element.viewType == 'confighome';\n            });\n            confighomeArr = confighomeArr.map(function (element) {\n              return element.viewId;\n            });\n            var tmp = event.data.filter(function (element) {\n              return element.viewType == 'configure';\n            });\n            allmyViews = tmp.map(function (element) {\n              var jsonObj;\n\n              if (element.content != null) {\n                jsonObj = JSON.parse(element.content);\n              } else {\n                jsonObj = {};\n              }\n\n              if (jsonObj.level == undefined) {\n                jsonObj.level = 1;\n              }\n\n              var obj = {\n                viewId: element.viewId,\n                viewTitle: element.viewTitle,\n                viewType: element.viewType,\n                navigate: element.navigate,\n                JSON: jsonObj\n              };\n              return obj;\n            });\n            allViewLoaded();\n          }\n        });\n\n        function allViewLoaded() {\n          if (!$routeParams.viewId) {\n            location.href = \"../app-sc/index_configure.html#/display/edit/service\";\n            return;\n          } else if ($routeParams.viewId == 'all') {\n            if (confighome) {\n              var viewId = JSON.parse(confighome.content).viewId;\n              var currentView = allmyViews.find(function (element) {\n                return element.viewId == viewId;\n              });\n\n              if (!viewId || currentView) {\n                run(viewId);\n              } else {\n                location.href = \"../app-sc/index_configure.html#/display/edit/service\";\n              }\n            } else {\n              delete $rootScope.dialogBox;\n              location.href = \"../app-sc/index_configure.html#/display/edit/service\";\n            }\n          } else if ($routeParams.viewId == 'edit') {\n            var findView, fnhandle;\n            scope.lv1views = allmyViews.filter(function (element) {\n              return $$.switchToNumber(element.navigate) > 0;\n            });\n\n            if (confighome) {\n              findView = scope.lv1views.find(function (elem) {\n                return elem.viewId == JSON.parse(confighome.content).viewId;\n              });\n\n              fnhandle = function fnhandle() {\n                var viewId = $rootScope.dialogBox.select.value.viewId;\n                var con = {\n                  viewId: viewId\n                };\n                var param = {\n                  viewId: confighome.viewId,\n                  viewTitle: 'confighome',\n                  viewType: 'confighome',\n                  content: JSON.stringify(con)\n                };\n                viewFlexService.updateView(param, function () {\n                  delete $rootScope.dialogBox;\n                  location.href = \"../app-sc/index_configure.html#/display/all/service\";\n                });\n              };\n            } else {\n              findView = scope.lv1views[0];\n\n              fnhandle = function fnhandle() {\n                var viewId = $rootScope.dialogBox.select.value.viewId;\n                var con = {\n                  viewId: viewId\n                };\n                var param = {\n                  viewTitle: 'confighome',\n                  viewType: 'confighome',\n                  content: JSON.stringify(con)\n                };\n                viewFlexService.addView(param, function () {\n                  delete $rootScope.dialogBox;\n                  location.href = \"../app-sc/index_configure.html#/display/all/service\";\n                });\n              };\n            }\n\n            var fnlist = [{\n              label: '确定',\n              icon: 'btn btn-success',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: fnhandle\n            }];\n            $rootScope.dialogBox = {\n              title: {\n                label: '请选择服务中心默认视图'\n              },\n              description: {\n                label: ''\n              },\n              select: {\n                \"label\": '请选择展示页',\n                \"value\": findView,\n                \"options\": scope.lv1views\n              },\n              fnlist: fnlist\n            };\n          } else {\n            run($routeParams.viewId);\n          }\n        }\n\n        function run(viewId) {\n          var treedata = {};\n\n          for (var i in allmyViews) {\n            if (typeof allmyViews[i].navigate == 'string' && allmyViews[i].navigate != \"\") {\n              var navi = allmyViews[i].navigate.split(\"/\");\n              var rs = {};\n              var ta = rs;\n\n              for (var j in navi) {\n                if (j < navi.length - 1) {\n                  ta[navi[j]] = {};\n                  ta = ta[navi[j]];\n                } else {\n                  ta[navi[j]] = {\n                    data: allmyViews[i]\n                  };\n                }\n              }\n\n              ;\n              treedata.$extension(rs);\n            }\n          }\n\n          var currentView = allmyViews.find(function (element) {\n            return element.viewId == viewId;\n          });\n\n          if (currentView) {\n            var findCur;\n            treedata.traverse(function (attr, element) {\n              if (element.data) {\n                if (element.data.viewId) {\n                  if (currentView.viewId == element.data.viewId) {\n                    findCur = element;\n                    var arr = [];\n\n                    for (var k in element.parent) {\n                      if (k != 'data') {\n                        arr.push(element.parent[k].data);\n                      }\n                    }\n\n                    scope.lv1views = arr;\n                  }\n                }\n              }\n            });\n            var target,\n                detaillist = [];\n\n            if (findCur) {\n              target = findCur.parent;\n\n              while (target.parent) {\n                detaillist.push(target.data);\n                target = target.parent;\n              }\n\n              scope.details = detaillist;\n            }\n\n            scope.data.viewRoutes = [];\n\n            scope.data.viewChange = function (view) {\n              SwSocket.unregister(uuid);\n              uuid = Math.uuid();\n\n              for (var i in scope.data.viewRoutes) {\n                if (scope.data.viewRoutes[i].viewId == view.viewId) {\n                  scope.data.viewRoutes.splice(i, scope.data.viewRoutes.length - i);\n                }\n              }\n\n              showViewContent(scope, view.viewId);\n            };\n\n            showViewContent(scope, currentView.viewId);\n          } else {\n            location.href = \"../app-sc/index_configure.html#/display/edit/service\";\n          }\n        }\n      };\n    }\n  }]);\n});"],"sourceRoot":"/source/"}