{"version":3,"sources":["js/directives/workorder-dom.js"],"names":["define","directives","BootstrapDialog","datatables","initDirective","$timeout","$compile","restrict","controller","$scope","$element","$attrs","table","domMain","$on","Event","WORKORDERINIT","event","args","destroy","empty","state","DataTable","dom","data","length","$","ProudSmart","datatable","footerdom","language","order","columns","title","width","orderable","visible","rowCallback","nRow","aData","iDataIndex","columnDefs","on","e","tr","this","closest","rowData","row","cancelTicket","ticketNo","location","href","delTicket","addWorkOrder","preventDefault","parent","isEditing","removeClass","uploadOrder","css","cancelOrderNo"],"mappings":"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","file":"js/directives/workorder-dom.js","sourcesContent":["define(['directives/directives', 'bootstrap-dialog', 'datatables.net', 'datatables.net-bs', 'datatables.net-select'], function (directives, BootstrapDialog, datatables) {\n  'use strict';\n\n  directives.initDirective('workOrderTable', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        $scope.$on(Event.WORKORDERINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n            domMain.empty();\n          }\n\n          var state = args.state; //工单的具体类型（执行中，已完成，全部，未发布）\n\n          table = domMain.DataTable({\n            dom: args.data && args.data.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            order: [[9, \"desc\"]],\n            columns: [{\n              \"data\": \"title\",\n              \"title\": \"工单名称\"\n            }, {\n              \"data\": \"ticketNo\",\n              \"title\": \"工单号\"\n            }, {\n              \"data\": \"ticketCategoryId\",\n              \"title\": \"工单流程\"\n            }, {\n              \"data\": \"status\",\n              \"title\": \"工单状态\"\n            }, {\n              \"data\": \"candidateUserOrGroup\",\n              \"title\": \"当前处理人\"\n            }, {\n              \"data\": \"commitTime\",\n              \"title\": \"发起时间\"\n            }, {\n              \"data\": \"finishedTime\",\n              \"title\": \"完成时间\"\n            }, {\n              \"data\": \"creatorName\",\n              \"title\": \"工单来源\"\n            }, {\n              \"data\": \"option\",\n              \"title\": \"操作\",\n              \"width\": \"150px\",\n              \"orderable\": false //bVisible: args.tab\n\n            }, {\n              data: \"ticketNo\",\n              visible: false\n            }],\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            },\n            columnDefs: args.columnDefs\n          });\n        });\n        domMain.on('click', '#revoke', function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          $scope.cancelTicket(rowData.ticketNo);\n        });\n        domMain.on('click', '#history', function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          location.href = \"#/workOrderTimeLine/\" + rowData.ticketNo + \"\";\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          $scope.delTicket(rowData.ticketNo);\n        }); //domMain.on('click', 'td', function (e) {\n        //  e.preventDefault();\n        //  var tr = $(this).closest('tr');\n        //  var row = table.row(tr);\n        //  var rowData = row.data();\n        //  var name = $(this).text();\n        //var sear = \"撤销\";\n        //if (rowData.status == 10) {\n        //  if (name == \"删除\") {\n        //    $scope.delTicket(rowData.ticketNo);\n        //  } else {\n        //    $scope.addOrderShow = true;\n        //    $scope.orderData = rowData;\n        //    $scope.$apply();\n        //  }\n        //} else {\n        //这个是点击工单管理的时候跳转事件，暂时不让跳任务详情页，是否可以只让看进度就行\n        //if(name.indexOf(sear) == -1){\n        //  location.href = \"index.html#/orderdetail/\" + rowData.ticketNo + \"/manage\" + \"/\"+state;\n        //}\n        //}\n        //})\n      }]\n    };\n  }]);\n  directives.initDirective('orderPublishTable', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        $scope.$on(Event.WORKORDERINIT + \"_order\", function (event, args) {\n          if (table) {\n            table.destroy();\n            domMain.empty();\n          }\n\n          table = domMain.DataTable({\n            dom: args.data && args.data.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            columns: args.columns,\n            columnDefs: args.columnDefs,\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            }\n          });\n        });\n\n        function format(d) {\n          $scope.orderAddData.title = d.title;\n          $scope.orderAddData.priorityCode = d.priorityCode;\n          $scope.orderAddData.category = d.category;\n          $scope.orderAddData.message = d.message;\n          $scope.orderAddData.ticketNo = d.ticketNo;\n          $scope.orderAddData.deviceId = d.deviceId;\n          $scope.getOrderProcedure(); //          var allDevices =  $scope.initData.devicesAll;\n          //          for(var i in allDevices){\n          //            if(allDevices[i].id == d.deviceId){\n          //              $scope.orderAddData.deviceId = allDevices[i];\n          //              $scope.findFault();\n          //              break;\n          //            }\n          //          }\n\n          $scope.orderAddData.faultId = d.faultId;\n\n          for (var j in $scope.processType) {\n            if ($scope.processType[j].id == d.ticketCategoryId) {\n              $scope.orderAddData.ticketCategoryId = $scope.processType[j].workflowId + \":\" + $scope.processType[j].id;\n              break;\n            }\n          }\n\n          var returnStr;\n          returnStr = '<div class=\"tab-content\">' + '<form class=\"form-horizontal tab-pane active full-width\" >' + '<div class=\"box-body\">' + '<div class=\"form-group full-width\">' + '<label for=\"\" class=\"control-label col-sm-2  pull-left padding-left-20\">工单名称：</label>' + '<div class=\"col-sm-4\">' + '<input type=\"text\" class=\"form-control full-width\" ng-model=\"orderAddData.title\">' + '</div>' + '<label for=\"\" class=\"col-sm-2 control-label\">紧急度：</label>' + '<div class=\"col-sm-4\">' + '<select name=\"\" id=\"orderPriorityCode\" class=\"form-control full-width\" ng-model=\"orderAddData.priorityCode\" ng-options=\"x.value as x.name for x in priorityData\">' + '<option value=\"\">请选择...</option>' + '</select>' + '</div>' + '</div>' + '<div class=\"form-group full-width margin-top-15\">' + '<label class=\"pull-left col-sm-2  padding-left-20 control-label\" for=\"ds_name\">工单类型：</label>' + '<div class=\"col-sm-4\">' + '<select name=\"\" id=\"orderCategory\" ng-model=\"orderAddData.category\" ng-change=\"getOrderProcedure()\" ng-options=\"x.valueCode as x.label for x in workOrderType\" class=\"form-control full-width\"><option value=\"\">请选择...</option></select>' + '</div>' + '<label class=\"col-sm-2 control-label\" for=\"ds_username\">工单流程：</label>' + '<div class=\"col-sm-4\">' + '<select class=\"form-control full-width\" ng-model=\"orderAddData.ticketCategoryId\" ng-options=\"x.workflowId +&#39;:&#39;+ x.id  as x.name for x in processType\">' + '<option value=\"\">请选择</option>' + '</select>' + '</div>' + '</div>' + '<div class=\"form-group full-width margin-top-15\">' + '<label class=\"pull-left col-sm-2  padding-left-20 control-label\" for=\"ds_name\">设备：</label>' + '<div class=\"col-sm-4\">' + '<select class=\"form-control select2 full-width\" ng-model=\"orderAddData.deviceId\" selectdata=\"devicesAll\" itemchange=\"findFault\" select2></select>' + //'<select name=\"\" id=\"orderCategory\" ng-model=\"orderAddData.deviceId\" ng-change=\"getOrderProcedure()\" ng-options=\"x  as x.label for x in initData.devicesAll\" class=\"form-control full-width\"><option value=\"\">请选择...</option></select>' +\n          '</div>' + '<label class=\"col-sm-2 control-label\" for=\"ds_username\">故障码：</label>' + '<div class=\"col-sm-4\">' + '<select class=\"form-control full-width\" ng-model=\"orderAddData.faultId\" ng-options=\"x.id  as x.faultNo for x in initData.faultList\">' + '<option value=\"\">请选择</option>' + '</select>' + '</div>' + '</div>' + '<div class=\"form-group full-width margin-top-15\">' + '<label for=\"disabledSelect\"  class=\"pull-left col-sm-2  padding-left-20 control-label\">工单内容：</label>' + '<div class=\"col-sm-9\">' + '<textarea  id=\"discription\" ng-model=\"orderAddData.message\" class=\"col-md-12 form-control full-width\"  style=\"height:100px;resize: none;\" name=\"discription\" maxlength=\"500\"  type=\"text\" placeholder=\"最多可输入500字\"></textarea>' + '</div>' + '</div>' + '<div class=\"form-group col-sm-12 margin-top-15\">' + '<div class=\"col-sm-12 auto-margin none-float\">' + '<div class=\"col-sm-12 align-center\">' + '<a id=\"submit-btn\" class=\"btn btn-default btn-sm bg-write\"><i ng-if=\"commitloading\" class=\"fa fa-spinner fa-spin fa-fw\"></i><i ng-if=\"!commitloading\" class=\"fa fa-upload \"></i><span class=\"hidden-xs ng-binding\"> 发布</span></a>' + '<a id=\"cancel-btn\" class=\"btn btn-default btn-sm bg-write margin-left-5\"><i class=\"fa fa-times \"></i><span class=\"hidden-xs ng-binding\"> 取消</span></a>' + '</div>' + '</div>' + '</div>' + '</div>' + '</div>' + '</form>' + '</div>';\n          return returnStr;\n        }\n\n        domMain.on('click', '#del-btn', function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          $scope.delTicket(rowData.ticketNo);\n        });\n        domMain.on('click', '#release-btn', function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          $scope.addWorkOrder(rowData);\n        });\n        domMain.on('click', '#submit-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr').parent();\n          var row = table.row(tr);\n          $scope.isEditing = false;\n          tr.removeClass('shown');\n          $scope.uploadOrder();\n        });\n        domMain.on('click', \"#cancel-btn\", function (e) {\n          e.preventDefault();\n          var tr = $(\"#newtr\").closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          tr.css(\"display\", \"none\");\n          $scope.cancelOrderNo();\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}