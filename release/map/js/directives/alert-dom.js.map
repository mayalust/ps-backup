{"version":3,"sources":["js/directives/alert-dom.js"],"names":["define","directives","initDirective","$timeout","$compile","restrict","controller","$scope","$element","$attrs","table","modelData","thresholdTable","domMain","isEditing","isFromEdit","hasThresholdOpen","alertId","$on","Event","ALERTEDITINIT","event","args","destroy","data","DataTable","dom","language","$","ProudSmart","datatable","alerts","columns","title","orderable","columnDefs","targets","render","type","full","isEdit","str","canEdit","isNew","on","selectedDitem","parentDom","parent","html","e","stopPropagation","tr","this","closest","row","tds","parents","children","checkPass","each","i","val","jqob","txt","addClass","cells","invalidate","removeClass","cell","doAction","returnObj","id","preventDefault","isDel","rowData","flg","remove","draw","child","isShown","hide","severity","name","value","condition","thresholdData","thresholds","length","alertCode","thresholdsData","d","returnStr","undefined","hasOwnProperty","format","show","lengthMenu","zeroRecords","info","infoEmpty","infoFiltered","loadingRecords","processing","search","paginate","first","last","next","previous","paging","ordering","footer","searching","fnDrawCallback","oSettings","nTHead","meta","kpis","add","css","obj","push","kpiCode","refValue","attr","enable","saveThresholds","target","test","siblings"],"mappings":"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","file":"js/directives/alert-dom.js","sourcesContent":["define(['directives/directives'], function (directives) {\n  'use strict';\n\n  directives.initDirective('aeditTable', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var isFromEdit = false;\n        var hasThresholdOpen = false;\n        var modelData;\n        var thresholdTable;\n        var alertId = \"\";\n        var itemAttrs;\n        $scope.$on(Event.ALERTEDITINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          hasThresholdOpen = false;\n          modelData = args.data;\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: $.ProudSmart.datatable.language,\n            data: modelData.alerts,\n            columns: [{\n              data: \"name\",\n              title: \"告警名称\"\n            }, {\n              data: \"label\",\n              title: \"显示名称\"\n            }, {\n              data: \"description\",\n              title: \"描述\"\n            }, {\n              data: \"option\",\n              orderable: false,\n              title: \"操作\"\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"name\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && type == \"display\") return \"<input style='width:100%' class='form-control' type='text' value='\" + data + \"'>\";else return data;\n              }\n            }, {\n              targets: 1,\n              data: \"name\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && type == \"display\") return \"<input style='width:100%'  class='form-control' type='text' value='\" + data + \"'>\";else return data;\n              }\n            }, {\n              targets: 2,\n              data: \"name\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && type == \"display\") return \"<input style='width:100%'   class='form-control' type='text' value='\" + data + \"'>\";else return data;\n              }\n            }, {\n              targets: 3,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                var str = \"<div class='input-group'>\";\n\n                if (full.canEdit) {\n                  if (full.isEdit == 2) {\n                    str += \"<a id='save-btn' class='btn btn-default btn-sm' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>\";\n                    if (full.isNew) str += \"<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\";else str += \"<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>\";\n                  } else {\n                    str += \"<a id='edit-btn' class='btn btn-default btn-sm' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></a>\";\n                    str += \"<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\";\n                  }\n                } else {\n                  str += \"<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\";\n                }\n\n                if (!full.isNew) {\n                  str += \"<a id='threshold-btn' class='btn btn-default btn-sm'><i class='fa fa-gear hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 阈值</span></a>\";\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          if ($scope.selectedDitem && $scope.selectedDitem.canEdit) {\n            var parentDom = $(\".special-btn\").parent();\n            parentDom.html('<a ng-click=\"addModelSubItem()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加告警</span></a>');\n            $compile(parentDom)($scope);\n          }\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (row.data().isEdit == 2) {\n            var tds = $(this).parents(\"tr\").children();\n            var checkPass = true;\n            $.each(tds, function (i, val) {\n              var jqob = $(val);\n\n              if (i == 0 || i == 1) {\n                var txt = jqob.children(\"input\").val();\n\n                if (!txt) {\n                  $(val).addClass('danger');\n                  checkPass = false;\n                  row.data().isEdit = 2;\n                  row.cells().invalidate();\n                  return false;\n                } else {\n                  $(val).removeClass('danger');\n                }\n              }\n\n              if (i == 3) {\n                row.cell(jqob).invalidate();\n                return true;\n              }\n\n              var txt = jqob.children(\"input\").val();\n              jqob.html(txt);\n              table.cell(jqob).data(txt); //修改DataTables对象的数据\n            });\n\n            if (checkPass) {\n              $scope.doAction(\"alert-save\", row.data(), function (returnObj) {\n                if (returnObj == false) {\n                  row.data().isEdit = 2;\n                } else {\n                  row.data().id = returnObj.id;\n                  row.data().isEdit = 0;\n                  row.data().isNew = false;\n                  row.cells().invalidate();\n                  isEditing = false;\n                }\n              });\n            }\n          }\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n\n          if (table.row(tr).data().isEdit == 3) {\n            $scope.doAction(\"thresholdMessage\", \"当前有正在设置的阈值！\");\n            isFromEdit = true;\n            return;\n          }\n\n          if (!isEditing) {\n            isEditing = true;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 2;\n            row.cells().invalidate();\n          } else {\n            $scope.doAction(\"thresholdMessage\", \"当前有修改中的指标，请先完成该操作\");\n          }\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.preventDefault();\n\n          if (isEditing) {\n            isEditing = false;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 0;\n            row.cells().invalidate();\n          }\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n\n          if (table.row(tr).data().isEdit == 3) {\n            $scope.doAction(\"thresholdMessage\", \"请先关闭阈值设置！\");\n            isFromEdit = true;\n            return;\n          }\n\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data().isDel = true;\n          $scope.doAction(\"kpi-delete\", rowData, function (flg) {\n            if (flg) row.remove().draw(false);\n          });\n        });\n        domMain.on('click', '#threshold-btn', function (e) {\n          e.preventDefault();\n\n          if (typeof table.row(tr).data().isEdit != \"undefined\" && table.row(tr).data().isEdit == 2) {\n            $scope.doAction(\"thresholdMessage\", \"请先完成告警编辑！\");\n            return;\n          }\n\n          if (!isEditing) {\n            isEditing = false;\n            isFromEdit = false;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 3;\n          }\n        });\n\n        function format(d) {\n          if (d != undefined) {\n            var returnStr;\n\n            if (d.hasOwnProperty(\"isEdit\") && d.isEdit > 0) {\n              returnStr = '<table id=\"threshold-table\" width=\"780px\"></table>' + '<div style=\"width:100%;text-align:left\">' + '<button id=\"addThreshold\" type=\"button\" class=\"btn btn-default\">&nbsp;&nbsp;添加&nbsp;&nbsp;</button>&nbsp;&nbsp;&nbsp;&nbsp;' + '<button id=\"saveThreshold\" type=\"button\" class=\"btn btn-primary\">&nbsp;&nbsp;保存&nbsp;&nbsp;</button></div>';\n            } else {}\n\n            return returnStr;\n          }\n        }\n\n        domMain.on('click', '#threshold-btn', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n\n          if (rowData) {\n            if (rowData.isEdit == 3 && !isFromEdit) {\n              if (row.child.isShown()) {\n                row.child.hide();\n                tr.removeClass('shown');\n                rowData.isEdit = 0;\n                hasThresholdOpen = false;\n              } else if (!hasThresholdOpen) {\n                var severity = [{\n                  'name': '警告告警',\n                  'value': '1'\n                }, {\n                  'name': '次要告警',\n                  'value': '2'\n                }, {\n                  'name': '重要告警',\n                  'value': '3'\n                }, {\n                  'name': '严重告警',\n                  'value': '4'\n                }];\n                var condition = [{\n                  'name': '大于',\n                  'value': 'compare(value,refValue)>0'\n                }, {\n                  'name': '大于等于',\n                  'value': 'compare(value,refValue)>=0'\n                }, {\n                  'name': '小于',\n                  'value': 'compare(value,refValue)<0'\n                }, {\n                  'name': '小于等于',\n                  'value': 'compare(value,refValue)<0'\n                }, {\n                  'name': '表达式',\n                  'value': ''\n                }];\n                alertId = rowData.id;\n                var thresholdData = [];\n\n                for (var i = 0; i < modelData.thresholds.length; i++) {\n                  if (modelData.thresholds[i].alertCode == alertId) {\n                    thresholdData = modelData.thresholds[i].thresholdsData;\n                    break;\n                  }\n                }\n\n                row.child(format(rowData)).show();\n                tr.addClass('shown');\n                thresholdTable = $(\"#threshold-table\").DataTable({\n                  \"language\": {\n                    \"lengthMenu\": \"显示 _MENU_ 项结果\",\n                    \"zeroRecords\": \"没有匹配结果\",\n                    \"info\": \"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项\",\n                    \"infoEmpty\": \"显示第 0 至 0 项结果，共 0 项\",\n                    \"infoFiltered\": \"(由 _MAX_ 项结果过滤)\",\n                    \"loadingRecords\": \"载入中...\",\n                    \"processing\": \"处理中...\",\n                    \"search\": \"搜索:\",\n                    \"paginate\": {\n                      \"first\": \"首页\",\n                      \"last\": \"末页\",\n                      \"next\": \"下页\",\n                      \"previous\": \"上页\"\n                    }\n                  },\n                  paging: false,\n                  info: false,\n                  ordering: false,\n                  footer: false,\n                  searching: false,\n                  data: thresholdData,\n                  //data: [{\"kpiCode\":\"0\",\"condition\":\">\",\"refValue\":0,\"severity\":\"1\",\"enable\":0,\"id\":0}],\n                  \"fnDrawCallback\": function fnDrawCallback(oSettings) {\n                    $(oSettings.nTHead).hide();\n                  },\n                  columns: [{\n                    data: \"kpiCode\",\n                    title: \"指标类型\"\n                  }, {\n                    data: \"condition\",\n                    title: \"阈值条件\"\n                  }, {\n                    data: \"refValue\",\n                    title: \"阈值\"\n                  }, {\n                    data: \"severity\",\n                    title: \"告警级别\"\n                  }, {\n                    data: \"enable\",\n                    title: \"启用\"\n                  }, {\n                    data: \"id\",\n                    title: \"删除\"\n                  }],\n                  \"columnDefs\": [{\n                    \"targets\": 0,\n                    \"data\": \"kpiCode\",\n                    \"render\": function render(data, type, full, meta) {\n                      var str = \"\";\n\n                      if (typeof data != \"undefined\") {\n                        str = '<select id=\"kpiCode\" name=\"kpiCode-name\" class=\"combobox form-control\">' + '<option value=\"\" selected disabled>KPI类型...</option>';\n\n                        for (var i in modelData.kpis) {\n                          if (data == modelData.kpis[i][\"id\"]) {\n                            str += '<option value=\"' + modelData.kpis[i][\"id\"] + '\" selected>' + modelData.kpis[i][\"label\"] + '</option>';\n                          } else {\n                            str += '<option value=\"' + modelData.kpis[i][\"id\"] + '\">' + modelData.kpis[i][\"label\"] + '</option>';\n                          }\n                        }\n                      } else {\n                        str = '<select id=\"kpiCode\" name=\"kpiCode-name\" class=\"combobox form-control\">' + '<option value=\"\" selected disabled>指标类型...</option>';\n\n                        for (var i in modelData.kpis) {\n                          str += '<option value=\"' + modelData.kpis[i][\"id\"] + '\">' + modelData.kpis[i][\"label\"] + '</option>';\n                        }\n                      }\n\n                      str += '</select>&nbsp;&nbsp;&nbsp;&nbsp;';\n                      return str;\n                    }\n                  }, {\n                    \"targets\": 1,\n                    \"data\": \"condition\",\n                    \"render\": function render(data, type, full) {\n                      var str = \"\";\n\n                      if (typeof data != \"undefined\") {\n                        str = '<select id=\"condition\" name=\"condition-name\" class=\"combobox form-control\">' + '<option value=\"\" selected disabled>计算条件...</option>';\n\n                        for (var i in condition) {\n                          if (data == condition[i][\"value\"]) {\n                            str += '<option value=\"' + condition[i][\"value\"] + '\" selected>' + condition[i][\"name\"] + '</option>';\n                          } else {\n                            str += '<option value=\"' + condition[i][\"value\"] + '\">' + condition[i][\"name\"] + '</option>';\n                          }\n                        }\n\n                        str += '</select>&nbsp;&nbsp;&nbsp;&nbsp;';\n                      } else {\n                        str = '<select id=\"condition\" name=\"condition-name\" class=\"combobox form-control\">' + '<option value=\"\" selected disabled>计算条件...</option>';\n\n                        for (var i in condition) {\n                          str += '<option value=\"' + condition[i][\"value\"] + '\">' + condition[i][\"name\"] + '</option>';\n                        }\n\n                        str += '</select>&nbsp;&nbsp;&nbsp;&nbsp;';\n                      }\n\n                      return str;\n                    }\n                  }, {\n                    \"targets\": 2,\n                    \"data\": \"refValue\",\n                    \"render\": function render(data, type, full) {\n                      var src = \"\";\n                      /*阈值表达式需要输入大于号或小于号,此处不做HTML验证*/\n\n                      if (typeof data == \"undefined\") {\n                        src = \"<input id ='refValue' name='refValue-name' class='form-control' type='text' value='' placeholder='参考值'>&nbsp;&nbsp;&nbsp;&nbsp;\";\n                      } else {\n                        src = \"<input id ='refValue' name='refValue-name' onkeyup='validatorNUM(this)' class='form-control' type='text' value='\" + data + \"'>&nbsp;&nbsp;&nbsp;&nbsp;\"; //src = '<input ng-pattern=\"/^[0-9]{0,10}$/\" class=\"form-control\" type=\"text\" id=\"refValue\" name=\"refValue-name\" value=\"'+ data +'\" />&nbsp;&nbsp;&nbsp;&nbsp;'+\n                        //\t'<span style=\"color:red\" ng-show=\"alerts-form.refValue-name.$dirty && alerts-form.refValue-name.$invalid\">'+\n                        //\t'<span ng-show=\"alerts-form.refValue-name.$dirty && alerts-form.refValue-name.$invalid\">仅限数字</span></span>';\n                      }\n\n                      return src;\n                    }\n                  }, {\n                    \"targets\": 3,\n                    \"data\": \"severity\",\n                    \"render\": function render(data, type, full) {\n                      var str = \"\";\n\n                      if (typeof data == \"undefined\") {\n                        str = '<select id=\"severity\" name=\"severity-name\" class=\"combobox form-control\">' + '<option value=\"\" selected disabled>告警级别...</option>';\n\n                        for (var i in severity) {\n                          str += '<option value=\"' + severity[i][\"value\"] + '\">' + severity[i][\"name\"] + '</option>';\n                        }\n\n                        str += '</select>&nbsp;&nbsp;&nbsp;&nbsp;';\n                      } else {\n                        str = '<select id=\"severity\" name=\"severity-name\" class=\"combobox form-control\">' + '<option value=\"\" selected disabled>告警级别...</option>';\n\n                        for (var i in severity) {\n                          if (data == severity[i][\"value\"]) {\n                            str += '<option value=\"' + severity[i][\"value\"] + '\" selected>' + severity[i][\"name\"] + '</option>';\n                          } else {\n                            str += '<option value=\"' + severity[i][\"value\"] + '\">' + severity[i][\"name\"] + '</option>';\n                          }\n                        }\n\n                        str += '</select>&nbsp;&nbsp;&nbsp;&nbsp;';\n                      }\n\n                      return str;\n                    }\n                  }, {\n                    \"targets\": 4,\n                    \"data\": \"enable\",\n                    \"render\": function render(data, type, full) {\n                      if (typeof data == \"undefined\") {\n                        data = 1;\n                      }\n\n                      var str = \"<label>启用:&nbsp;&nbsp;</label>\";\n\n                      if (data == 0) {\n                        str += \"<a id='unable-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-square-o'></i></a>\";\n                        str += \"<input type='checkbox' id='tEnable' style='display:none'/>\";\n                      } else {\n                        str += \"<a id='enable-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-check-square-o'></i></a>\";\n                        str += \"<input type='checkbox' id='tEnable' checked='checked' style='display:none'/>\";\n                      }\n\n                      return str;\n                    }\n                  }, {\n                    \"targets\": 5,\n                    \"data\": \"id\",\n                    \"render\": function render(data, type, full) {\n                      var str = \"<a id='delete-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-trash-o'></i></a>\";\n\n                      if (typeof data != \"undefined\") {\n                        str += \"<input  id='tid' type='text' style='display:none' value='\" + data + \"'/>\";\n                      } else {\n                        str += \"<input  id='tid' type='text' style='display:none' value=''/>\";\n                      }\n\n                      return str;\n                    }\n                  }]\n                });\n\n                if (modelData.thresholds.length == 0) {\n                  thresholdTable.row.add([]).draw(false);\n                }\n\n                rowData.isEdit = 3;\n                hasThresholdOpen = true;\n              }\n            }\n          }\n        });\n        domMain.on('click', '#addThreshold', function (e) {\n          e.stopPropagation();\n          thresholdTable.row.add([]).draw(false);\n        });\n        domMain.on('click', '#saveThreshold', function (e) {\n          e.stopPropagation();\n          var checkPass = true;\n\n          for (var i = 0; i < thresholdTable.$(\"input, select\").length; i++) {\n            if ($(thresholdTable.$(\"input, select\")[i]).val() == null || $(thresholdTable.$(\"input, select\")[i]).val() == \"\") {\n              if (thresholdTable.$(\"input, select\")[i].id == \"tid\") {\n                break;\n              }\n\n              if (thresholdTable.$(\"input, select\")[i].id == \"condition\" && $(thresholdTable.$(\"input, select\")[i]).val() == \"\") {\n                break;\n              }\n\n              $(thresholdTable.$(\"input, select\")[i]).css(\"background-color\", \"#f2dede\");\n              $scope.doAction(\"thresholdMessage\", \"当前有未填写阈值\");\n              checkPass = false;\n              break;\n            }\n          }\n\n          if (checkPass) {\n            var thresholds = [];\n            thresholds[0] = modelData.id;\n            thresholds[1] = alertId;\n            thresholds[2] = [];\n            var obj = {};\n\n            for (var i = 0; i <= thresholdTable.$(\"input, select\").length; i++) {\n              if (thresholdTable.$(\"input, select\").length == 0) {\n                break;\n              }\n\n              if (i != 0 && i % 6 == 0) {\n                thresholds[2].push(obj);\n                obj = {};\n                if (i == thresholdTable.$(\"input, select\").length) break;\n              }\n\n              if (thresholdTable.$(\"input, select\")[i].id == \"kpiCode\") {\n                obj.kpiCode = $(thresholdTable.$(\"input, select\")[i]).val();\n              }\n\n              if (thresholdTable.$(\"input, select\")[i].id == \"condition\") {\n                obj.condition = $(thresholdTable.$(\"input, select\")[i]).val();\n              }\n\n              if (thresholdTable.$(\"input, select\")[i].id == \"refValue\") {\n                obj.refValue = $(thresholdTable.$(\"input, select\")[i]).val();\n              }\n\n              if (thresholdTable.$(\"input, select\")[i].id == \"severity\") {\n                obj.severity = $(thresholdTable.$(\"input, select\")[i]).val();\n              }\n\n              if (thresholdTable.$(\"input, select\")[i].id == \"tEnable\") {\n                if (typeof $(thresholdTable.$(\"input, select\")[4]).attr(\"checked\") == \"undefined\") {\n                  obj.enable = 0;\n                } else {\n                  obj.enable = 1;\n                }\n              }\n\n              if (thresholdTable.$(\"input, select\")[i].id == \"tid\") {\n                if ($(thresholdTable.$(\"input, select\")[i]).val() == \"\") {\n                  obj.id = 0;\n                } else {\n                  obj.id = $(thresholdTable.$(\"input, select\")[i]).val();\n                }\n              }\n            }\n\n            $scope.saveThresholds(modelData, alertId, thresholds);\n          }\n        });\n        domMain.on('change', \"#threshold-table select\", function (e) {\n          e.stopPropagation();\n\n          if ($(e.target).val() != null) {\n            $(e.target).css(\"background-color\", \"white\");\n          }\n        });\n        domMain.on('change', \"#condition\", function (e) {\n          e.stopPropagation();\n\n          if ($(e.target).val() != null && $(e.target).val() != \"\") {\n            var reg = /^\\d*$/;\n\n            if (!reg.test($($(e.target).parent().siblings()[1]).children().val())) {\n              $($(e.target).parent().siblings()[1]).children().css(\"background-color\", \"#f2dede\");\n              $($(e.target).parent().siblings()[1]).children().val(\"\");\n              $($(e.target).parent().siblings()[1]).children().attr(\"placeholder\", \"请输入正确数字\");\n            }\n          } else {\n            $($(e.target).parent().siblings()[1]).children().css(\"background-color\", \"white\");\n            $($(e.target).parent().siblings()[1]).children().attr(\"placeholder\", \"参考值\");\n          }\n        });\n        domMain.on('change', \"#threshold-table input\", function (e) {\n          e.stopPropagation();\n\n          if ($(e.target).val() != \"\") {\n            $(e.target).css(\"background-color\", \"white\");\n          }\n        });\n        domMain.on('change', \"#refValue\", function (e) {\n          e.stopPropagation();\n\n          if ($(e.target).val() != \"\") {\n            if (null != $($(e.target).parent().siblings()[1]).children().val() && \"\" != $($(e.target).parent().siblings()[1]).children().val()) {\n              var reg = /^\\d*$/;\n\n              if (!reg.test($(e.target).val())) {\n                $(e.target).css(\"background-color\", \"#f2dede\");\n                $(e.target).val(\"\");\n                $(e.target).attr(\"placeholder\", \"请输入正确数字\");\n              } else {\n                $(e.target).css(\"background-color\", \"white\");\n              }\n            } else {\n              $(e.target).css(\"background-color\", \"white\");\n            }\n          }\n        });\n        domMain.on('click', '#unable-btn', function (e) {\n          e.stopPropagation();\n          var td = $(this).closest('td');\n          var str = \"<label>启用:&nbsp;&nbsp;</label>\";\n          str += \"<a id='enable-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-check-square-o'></i></a>\";\n          str += \"<input type='checkbox' id='tEnable' checked='checked' style='display:none'/>\";\n          td.html(str);\n        });\n        domMain.on('click', '#enable-btn', function (e) {\n          e.stopPropagation();\n          var td = $(this).closest('td');\n          var str = \"<label>启用:&nbsp;&nbsp;</label>\";\n          str += \"<a id='unable-btn' class='btn btn-social-icon' data-toggle='tooltip' ><i class='fa fa-square-o'></i></a>\";\n          str += \"<input type='checkbox' id='tEnable' style='display:none'/>\";\n          td.html(str);\n        });\n        domMain.on('click', '#delete-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = thresholdTable.row(tr);\n          row.remove().draw(false);\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}