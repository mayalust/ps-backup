{"version":3,"sources":["js/directives/rappid-views-dom.js"],"names":["define","directives","datatables","initDirective","$timeout","$compile","$filter","growl","restrict","controller","$scope","$element","$attrs","table","domMain","isEditing","$on","event","args","destroy","DataTable","dom","language","datatable","data","order","columns","title","orderable","width","visible","selectedDitem","canEdit","columnDefs","targets","render","type","full","isEdit","escape","on","parentDom","$","parent","html","e","preventDefault","tr","this","closest","viewInfo","row","location","href","viewId","rowData","doAction","cells","invalidate","tds","parents","children","each","i","val","jqob","length","txt","warning","cell","flg","isDel","remove","draw"],"mappings":"AAAAA,OAAO,CAAC,wBAAyB,iBAAkB,qBAAsB,SAAUC,EAAYC,GAC7F,aAEAD,EAAWE,cAAc,iBAAkB,CAAC,WAAY,WAAY,UAAW,QAAS,SAAUC,EAAUC,EAAUC,EAASC,GAC7H,MAAO,CACLC,SAAU,IACVC,WAAY,CAAC,SAAU,WAAY,SAAU,SAAUC,EAAQC,EAAUC,GACvE,IACIC,EADAC,EAAUH,EAEVI,GAAY,EAEhBL,EAAOM,IAAI,cAAe,SAAUC,EAAOC,GACrCL,GACFA,EAAMM,UAGRJ,GAAY,EACZF,EAAQC,EAAQM,UAAU,CACxBC,IAAK,qHACLC,SAAUrB,EAAWsB,UAAUD,SAC/BE,KAAMN,EAAKM,KACXC,MAAO,CAAC,EAAG,QACXC,QAAS,CAAC,CACRF,KAAM,YACNG,MAAO,QACN,CACDH,KAAM,WACNG,MAAO,QACN,CACDH,KAAM,aACNG,MAAO,QACN,CACDH,KAAM,SACNI,WAAW,EACXD,MAAO,KACPE,MAAO,QACPC,QAASpB,EAAOqB,eAAiBrB,EAAOqB,cAAcC,UAExDC,WAAY,CAAC,CACXC,QAAS,EACTV,KAAM,YACNW,OAAQ,SAAgBX,EAAMY,EAAMC,GAElC,OAAmB,GAAfA,EAAKC,QAAuB,WAARF,EAA0B,8EAAgFG,OAAOf,GAAQ,KAAiBe,OAAOf,KAE1K,CACDU,QAAS,EACTV,KAAM,aACNW,OAAQ,SAAgBX,EAAMY,EAAMC,GAGlC,OADU/B,EAAQ,OAARA,CAAgBkB,EAAM,yBAGjC,CACDU,QAAS,EACTV,KAAM,WACNW,OAAQ,SAAgBX,EAAMY,EAAMC,GAElC,OAAmB,GAAfA,EAAKC,QAAuB,WAARF,EAA0B,6FAA+FG,OAAOf,GAAQ,KAAiBe,OAAOf,KAEzL,CACDU,QAAS,EACTV,KAAM,SACNW,OAAQ,SAAgBX,EAAMY,EAAMC,GAgBlC,OANmB,GAAfA,EAAKC,OACD,sVAEA,2gBAYhBxB,EAAQ0B,GAAG,UAAW,WACpB,IAAIC,EAAYC,EAAE,gBAAgBC,SAClCF,EAAUG,KAAK,4RACfvC,EAASoC,EAATpC,CAAoBK,KAEtBI,EAAQ0B,GAAG,QAAS,YAAa,SAAUK,GACzCA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MAErBC,EADMrC,EAAMsC,IAAIJ,GACDvB,OACnB4B,SAASC,KAAO,wCAA0CH,EAASI,SAErExC,EAAQ0B,GAAG,QAAS,cAAe,SAAUK,GAC3CA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MACfpC,EAAMsC,IAAIJ,GACDvB,OACnB4B,SAASC,KAAO,4CAElBvC,EAAQ0B,GAAG,QAAS,YAAa,SAAUK,GACzCA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MAErBM,EADM1C,EAAMsC,IAAIJ,GACFvB,OAClBd,EAAO8C,SAAS,YAAaD,KAE/BzC,EAAQ0B,GAAG,QAAS,YAAa,SAAUK,GACzCA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MACrBE,EAAMtC,EAAMsC,IAAIJ,GAEfhC,IACHA,GAAY,EACZoC,EAAI3B,OAAOc,OAAS,EACpBa,EAAIM,QAAQC,gBAGhB5C,EAAQ0B,GAAG,QAAS,YAAa,SAAUK,GACzCA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MACrBE,EAAMtC,EAAMsC,IAAIJ,GAChBQ,EAAUJ,EAAI3B,OAElB,GAAsB,GAAlB+B,EAAQjB,OAAa,CACvB,IAAIqB,EAAMjB,EAAEM,MAAMY,QAAQ,MAAMC,WAEhCnB,EAAEoB,KAAKH,EAAK,SAAUI,EAAGC,GACvB,IAAIC,EAAOvB,EAAEsB,GAEb,GAAS,GAALD,IACkC,EAAhCE,EAAKJ,SAAS,SAASK,UACrBC,EAAMF,EAAKJ,SAAS,SAASG,QAI/B,OADAzD,EAAM6D,QAAQ,YACP,EAKb,GAAS,GAALL,GAAe,GAALA,EAAQ,CACpB,IAAII,EAAMF,EAAKJ,SAAS,SAASG,MACjCC,EAAKrB,KAAKuB,GACVtD,EAAMwD,KAAKJ,GAAMzC,KAAK2C,MAK5BzD,EAAO8C,SAAS,YAAaD,EAAS,SAAUe,GAC1CA,IACFvD,GAAY,EACZoC,EAAI3B,OAAOc,OAAS,EACpBa,EAAIM,QAAQC,kBAIlB5C,EAAQ0B,GAAG,QAAS,cAAe,SAAUK,GAC3CA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MACrBE,EAAMtC,EAAMsC,IAAIJ,GACNI,EAAI3B,OAClBT,GAAY,EACZoC,EAAI3B,OAAOc,OAAS,EACpBa,EAAIM,QAAQC,eAEd5C,EAAQ0B,GAAG,QAAS,WAAY,SAAUK,GACxCA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MACrBE,EAAMtC,EAAMsC,IAAIJ,GACpBI,EAAI3B,OAAO+C,OAAQ,EACnB,IAAIhB,EAAUJ,EAAI3B,OAClBd,EAAO8C,SAAS,cAAeD,EAAS,SAAUe,GAC5CA,GAAKnB,EAAIqB,SAASC,MAAK","file":"js/directives/rappid-views-dom.js","sourcesContent":["define(['directives/directives', 'datatables.net', 'datatables.net-bs'], function (directives, datatables) {\n  'use strict';\n\n  directives.initDirective('rappidViewsDom', ['$timeout', '$compile', '$filter', 'growl', function ($timeout, $compile, $filter, growl) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var itemAttrs;\n        $scope.$on(\"RAPPIDVIEWS\", function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: directives.datatable.language,\n            data: args.data,\n            order: [2, \"desc\"],\n            columns: [{\n              data: \"viewTitle\",\n              title: \"视图名称\"\n            }, {\n              data: \"navigate\",\n              title: \"导航级别\"\n            }, {\n              data: \"createTime\",\n              title: \"创建时间\"\n            }, {\n              data: \"option\",\n              orderable: false,\n              title: \"操作\",\n              width: \"120px\",\n              visible: $scope.selectedDitem && $scope.selectedDitem.canEdit\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"viewTitle\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if (full.isEdit == 2 && type == \"display\") return \"<input style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 2,\n              data: \"createTime\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                var str = $filter('date')(data, 'yyyy-MM-dd HH:mm:ss');\n                return str;\n              }\n            }, {\n              targets: 1,\n              data: \"navigate\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if (full.isEdit == 2 && type == \"display\") return \"<input maxlength='20' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 3,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                //                var str = \"<div class='input-group btn-group-sm'>\";\n                //                str += \"<a id='view-btn' class='btn btn-default' ><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 查看</span></a>\"\n                //                str += \"<a id='edit-btn' class='btn btn-default' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></a>\"\n                //                str += \"<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\"\n                //                str += \"</div>\"\n                //                return str;\n                var str;\n\n                if (full.isEdit == 2) {\n                  str = '<div class=\"btn-group  btn-group-sm\">' + '<a id=\"save-btn\" class=\"btn btn-default\"><i class=\"fa fa-check  hidden-lg hidden-md hidden-sm\"></i><span class=\"hidden-xs ng-binding\">保存</span></a>' + '<a id=\"cancel-btn\" class=\"btn btn-default\" ><i class=\"fa fa-close hidden-lg hidden-md hidden-sm\"></i><span class=\"hidden-xs ng-binding\">取消</span></a></div>';\n                } else {\n                  str = \"<div class='btn-group  table-option-group btn-group-sm'>\" + \"<button type='button' class='btn btn-default'>操作</button>\" + \"<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'>\" + \"<span class='caret'></span>\" + \"<span class='sr-only'>Toggle Dropdown</span>\" + \"</button>\" + \"<ul class='dropdown-menu' role='menu'>\" + \"<li><a href id='edit-btn'>编辑</a></li>\" + \"<li><a href id='view-btn'>查看</a></li>\" + \"<li><a href id='design-btn'>设计</a></li>\" + \"<li><a href id='copy-btn'>复制</a></li>\" + \"<li><a href id='del-btn'>删除</a></li>\" + \"</ul>\" + \"</div>\";\n                }\n\n                return str;\n              }\n            }]\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<div class=\"btn-group btn-group-sm\"><a ng-click=\"addViews()\" class=\"btn btn-default\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 新建视图</span></a><a ng-click=\"managePerforms()\" class=\"btn btn-default\"><i class=\"fa fa-edit\"></i><span class=\"hidden-xs\"> 管理性能视图</span></a></div>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', '#view-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var viewInfo = row.data();\n          location.href = \"../app-configure/index.html#/display/\" + viewInfo.viewId;\n        });\n        domMain.on('click', '#design-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var viewInfo = row.data();\n          location.href = \"../app-configure/index.html#/configure/\";\n        });\n        domMain.on('click', '#copy-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          $scope.doAction(\"view-copy\", rowData);\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (!isEditing) {\n            isEditing = true;\n            row.data().isEdit = 2;\n            row.cells().invalidate();\n          }\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n\n          if (rowData.isEdit == 2) {\n            var tds = $(this).parents(\"tr\").children();\n            var checkPass = true;\n            $.each(tds, function (i, val) {\n              var jqob = $(val);\n\n              if (i == 0) {\n                if (jqob.children(\"input\").length > 0) {\n                  var txt = jqob.children(\"input\").val();\n\n                  if (!txt) {\n                    growl.warning(\"视图名称不能空\");\n                    return false;\n                  }\n                }\n              }\n\n              if (i == 0 || i == 1) {\n                var txt = jqob.children(\"input\").val();\n                jqob.html(txt);\n                table.cell(jqob).data(txt); //修改DataTables对象的数据\n              }\n            });\n          }\n\n          $scope.doAction(\"view-save\", rowData, function (flg) {\n            if (flg) {\n              isEditing = false;\n              row.data().isEdit = 0;\n              row.cells().invalidate();\n            }\n          });\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          isEditing = false;\n          row.data().isEdit = 0;\n          row.cells().invalidate();\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data().isDel = true;\n          var rowData = row.data();\n          $scope.doAction(\"attr-delete\", rowData, function (flg) {\n            if (flg) row.remove().draw(false);\n          });\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}