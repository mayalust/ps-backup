{"version":3,"sources":["app-sc/js/controllers/tglibrary-ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","tglibraryPrevCtrl","scope","q","serviceCenterService","route","userLoginUIService","location","viewFlexService","resourceUIService","timeout","window","allMyViews","$deviceGroup","solutionId","$on","event","path","changePos","user","appData","element","i","this","edit","deviceGroupId","id","detail","addResource","remove","viewId","view","deleteViews","deleteDeviceGroup","deviceGroups","filter","views","getAll","then","data","viewTitle","nodes","kpis","index","jsondata","content","slice","JSON","parse","preview","list","resource","indexOf","push","kpi","success","map","deviceGroup","result","label","find","error","err","getValues","j","elem","el","kpiCode","nodeId","value","tgeditCtrl","solutionUIService","currentDeviceGroup","currentView","handleView","$resource","$preview","$charts","$clone","$dragElement","groupId","$model","kpiChange","target","length","setValue","parseInt","init","resourceInfoLoaded","code","tg","update","saveNewDeviceGroup","stringify","deviceGroupModel","modelId","saveDeviceGroup","newdeviceGroup","JSONstring","param","viewName","viewType","addView","alert","updateNewDeviceGroup","updateView","mode","saveServiceViewContent","href","getServiceViewContent","undefined","getModelsByGroupId","allModels","drawarea","backgroundImage","charts","handleModel","call","model","cur","modelObj","getBymodelId","icon","unit","k","getResourceById","deviceGroupModels","resources","Array","getServiceViewMap","dataMap","viewContent","handleResource","successKpi","errorKpi","resourceObj","units","current","$$route","originalPath","params","alertOn","stopMove","ui","top","offset","$","left","topPortion","height","leftPortion","width","stopResize","widthPortion","heightPortion","focusOn","parametersEditor","step","exit","createNew","type","show","bar","scale","switch","bgimageOpen","bgimageClose","open","blink","bgimage","ondrop","bgBlinkImage","drawPos","position","transform","calcuRotation","-ms-transform","-moz-transform","-webkit-transform","-o-transform","saveAndExit","getData","title","hasOwnProperty","onChange","attr","attrs","add","concat","item","used","tglibraryCtrl","chartOptionService","SwSocket","uuid","blinks","showCam","allViewLoaded","dt","nodesSocket","kpisSocket","nodesCharts","kpisCharts","directives","message","comId","sendDeviceDirective","Math","ciid","toString","repeat","finalValue","_option_","series","finalTime","xAxis","random","pushData","send","webSocketOpen","allValueLoaded","getValuesListAndMergeByTime","allValueListLoaded","getAllValue","pushValue","colors","legend","ci","$attr","setOptions","timeEnd","Date","getTime","sort","name","color","track","lineChart","linechart","setTitle","setGrid","setTimeformat","setxAxis","$extension","itemStyle","normal","lineStyle","areaStyle","setSeriesByCiKpi","setOption","returnOption","health","wholeClick","panelShow","orderHandlerClick","overviewClick","equipmentClick","malfunctionClick","chartClick","unregister","panelClick","ipcam","camClick","openCam","closeCam","blinkClick","startBlink","stopBlink","initController","$inject"],"mappings":"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","file":"app-sc/js/controllers/tglibrary-ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers', 'Array'], function (controllers) {\n  'use strict';\n\n  controllers.initController(\"tglibraryPrevCtrl\", tglibraryPrevCtrl);\n  tglibraryPrevCtrl.$inject = ['$scope', '$q', 'serviceCenterService', '$route', 'userLoginUIService', '$location', 'viewFlexService', 'resourceUIService', '$timeout', '$window'];\n\n  function tglibraryPrevCtrl(scope, q, serviceCenterService, route, userLoginUIService, location, viewFlexService, resourceUIService, timeout, window) {\n    scope.$on('$locationChangeSuccess', function (event) {\n      if (location.path() == \"/servers\") {\n        userLoginUIService.changePos();\n      }\n    });\n    var allMyViews, $deviceGroup, solutionId;\n\n    if (userLoginUIService.user.appData) {\n      solutionId = userLoginUIService.user.appData.solutionId;\n    } else {\n      scope.$on(\"loginStatusChanged\", function () {\n        solutionId = userLoginUIService.user.appData.solutionId;\n      });\n    }\n\n    $deviceGroup = function $deviceGroup(element) {\n      var cur = this;\n\n      for (var i in element) {\n        cur[i] = element[i];\n      }\n    };\n\n    $deviceGroup.prototype.edit = function () {\n      var cur = this;\n      var deviceGroupId = cur.id;\n      location.path(\"tongji/edit/\" + solutionId + \"/\" + deviceGroupId);\n    };\n\n    $deviceGroup.prototype.detail = function () {\n      var cur = this;\n      var deviceGroupId = cur.id;\n      location.path(\"tongji/detail/\" + deviceGroupId);\n    };\n\n    scope.addResource = function () {\n      location.path(\"tongji/edit/\" + solutionId);\n    };\n\n    $deviceGroup.prototype.remove = function () {\n      var cur = this;\n      var deviceGroupId = cur.id;\n      var viewId = cur.view.viewId;\n      viewFlexService.deleteViews([viewId], callback);\n\n      function callback(event) {\n        resourceUIService.deleteDeviceGroup(deviceGroupId, callback);\n\n        function callback(event) {\n          scope.deviceGroups = scope.deviceGroups.filter(function (element) {\n            return element.id != deviceGroupId;\n          });\n        }\n      }\n    };\n\n    serviceCenterService.views.getAll(false).then(success, error);\n\n    function success(data) {\n      allMyViews = data.filter(function (element) {\n        return element.viewTitle == \"tongji_deviceGroup\";\n      });\n      var nodes = [];\n      var kpis = [];\n\n      for (var i in allMyViews) {\n        (function (index, element) {\n          var jsondata = {};\n          var content = element.content;\n\n          if (content.slice(0, 1) == \"{\" && content.slice(-1) == \"}\") {\n            jsondata = JSON.parse(content);\n\n            for (var i in jsondata.preview.list) {\n              (function (index, element) {\n                if (element.resource) {\n                  if (nodes.indexOf(element.resource.id) == -1) {\n                    nodes.push(element.resource.id);\n                  }\n                }\n\n                if (element.kpi) {\n                  if (nodes.indexOf(element.kpi.id) == -1) {\n                    kpis.push(element.kpi.id);\n                  }\n                }\n              })(i, jsondata.preview.list[i]);\n            }\n          }\n\n          element.JSON = jsondata;\n        })(i, allMyViews[i]);\n      }\n\n      serviceCenterService.getValues(nodes, kpis).then(allValueLoaded, error);\n\n      function allValueLoaded(data) {\n        for (var i in allMyViews) {\n          (function (index, element) {\n            for (var j in element.JSON.preview.list) {\n              (function (index, elem) {\n                var find = data.find(function (el) {\n                  if (elem.kpi && elem.resource) {\n                    return el.kpiCode == elem.kpi.id && el.nodeId == elem.resource.id;\n                  } else {\n                    return false;\n                  }\n                });\n\n                if (find) {\n                  if (find.value) {\n                    elem.value = find.value;\n                  } else {\n                    elem.value = '-';\n                  }\n                } else {\n                  elem.value = '-';\n                }\n              })(j, element.JSON.preview.list[j]);\n            }\n          })(i, allMyViews[i]);\n        }\n\n        serviceCenterService.deviceGroups.getAll(false).then(success, error);\n      }\n\n      function success(data) {\n        scope.deviceGroups = data.map(function (deviceGroup) {\n          var result = {\n            id: deviceGroup.id,\n            label: deviceGroup.label,\n            view: null\n          };\n          var find = allMyViews.find(function (view) {\n            return view.JSON.deviceGroupId == result.id;\n          });\n          result.view = find;\n          return new $deviceGroup(result);\n        });\n      }\n\n      function error(err) {}\n    }\n\n    function error(err) {}\n  }\n\n  controllers.initController(\"tgedit\", tgeditCtrl);\n  tgeditCtrl.$inject = ['$scope', '$q', 'serviceCenterService', '$route', '$location', 'viewFlexService', 'resourceUIService', 'solutionUIService', '$window', 'userLoginUIService'];\n\n  function tgeditCtrl(scope, q, serviceCenterService, route, location, viewFlexService, resourceUIService, solutionUIService, window, userLoginUIService) {\n    scope.$on('$locationChangeSuccess', function (event) {\n      if (location.path() == \"/servers\") {\n        userLoginUIService.changePos();\n      }\n    });\n    var currentDeviceGroup, currentView, handleView, $resource, $preview, $charts, $clone, $dragElement, solutionId, deviceGroupId, groupId, $model, mode, units;\n    serviceCenterService.units.getAll().then(function (data) {\n      units = data;\n    });\n\n    if (route.current) {\n      if (route.current.$$route.originalPath.indexOf('modeledit') != -1) {\n        scope.mode = 'editmodel';\n      } else if (route.current.$$route.originalPath.indexOf('edit') != -1) {\n        scope.mode = 'edit';\n      }\n\n      groupId = route.current.params.groupId;\n      deviceGroupId = route.current.params.deviceGroupId;\n      scope.solutionId = solutionId = route.current.params.solutionId;\n      init();\n    } else {\n      scope.$on(\"locationChanged\", function () {\n        groupId = route.current.params.groupId;\n        deviceGroupId = route.current.params.deviceGroupId;\n        solutionId = route.current.params.solutionId;\n\n        if (route.current.$$route.originalPath.indexOf('modeledit') != -1) {\n          scope.mode = 'editmodel';\n        } else if (route.current.$$route.originalPath.indexOf('edit') != -1) {\n          scope.mode = 'edit';\n        }\n\n        init();\n      });\n    }\n\n    scope.kpiChange = kpiChange;\n    scope.alertOn = false;\n\n    function kpiChange(target) {\n      if (target.kpi != null) {\n        if (_typeof(target.resource) == \"object\" && target.resource != null) {\n          serviceCenterService.getValues([target.resource.id], [target.kpi.id]).then(success, error);\n        }\n      }\n\n      function success(data) {\n        if (data.length > 0) {\n          if (typeof target.setValue == \"function\") {\n            target.setValue(parseInt(data[0].value));\n          } else {\n            target.value = parseInt(data[0].value);\n          }\n        } else {\n          target.value = \"-\";\n        }\n      }\n\n      function error(err) {}\n    }\n\n    ;\n\n    $dragElement = function $dragElement(data) {\n      var cur = this;\n\n      for (var i in data) {\n        cur[i] = data[i];\n      }\n    };\n\n    $dragElement.prototype.stopMove = function (ui) {\n      var cur = this;\n      var top = ui.offset.top - $(\".drawingArea\").offset().top;\n      var left = ui.offset.left - $(\".drawingArea\").offset().left;\n      cur.top = top;\n      cur.topPortion = top / $(\".drawingArea\").height();\n      cur.left = left;\n      cur.leftPortion = left / $(\".drawingArea\").width();\n    };\n\n    $dragElement.prototype.stopResize = function (ui) {\n      var cur = this;\n      cur.width = $(ui.element).width();\n      cur.widthPortion = cur.width / $(\".drawingArea\").width();\n      cur.height = $(ui.element).height();\n      cur.heightPortion = cur.height / $(\".drawingArea\").height();\n    };\n\n    $dragElement.prototype.remove = function () {\n      var cur = this;\n      scope.drawarea.list = scope.drawarea.list.filter(function (element) {\n        return element !== cur;\n      });\n    };\n\n    $dragElement.prototype.focusOn = function () {\n      var cur = this;\n      scope.parametersEditor = cur;\n    };\n\n    scope.step = 0;\n\n    scope.exit = function () {\n      if (solutionId != \"0\") {\n        window.location.href = \"../app-ac/index.html#/myView\";\n      } else {\n        userLoginUIService.changePos();\n      }\n    };\n\n    scope.createNew = {\n      type: 'bar',\n      show: true,\n      bar: {\n        scale: true,\n        width: 50,\n        height: 131\n      },\n      switch: {\n        scale: false,\n        width: 100,\n        height: 50,\n        bgimageOpen: 'images/tongji/switch_green1.png',\n        bgimageClose: 'images/tongji/switch_red1.png'\n      },\n      open: {\n        scale: true,\n        width: 80,\n        height: 80\n      },\n      blink: {\n        scale: false,\n        width: 100,\n        height: 100,\n        bgimage: 'images/tongji/tank1_red.png'\n      },\n      resource: null,\n      kpi: null\n    };\n\n    scope.ondrop = function (ui) {\n      var top = ui.offset.top - $(\".drawingArea\").offset().top;\n      var left = ui.offset.left - $(\".drawingArea\").offset().left;\n      var result = new $dragElement({\n        top: top,\n        topPortion: top / $(\".drawingArea\").height(),\n        left: left,\n        leftPortion: left / $(\".drawingArea\").width(),\n        type: scope.createNew.type,\n        scale: scope.createNew[scope.createNew.type].scale,\n        model: scope.createNew.model,\n        modelObj: scope.createNew.modelObj,\n        resource: scope.createNew.resource,\n        resourceObj: scope.createNew.resourceObj,\n        kpi: scope.createNew.kpi,\n        show: scope.createNew.show,\n        width: scope.createNew[scope.createNew.type].width,\n        widthPortion: scope.createNew[scope.createNew.type].width / $(\".drawingArea\").width(),\n        height: scope.createNew[scope.createNew.type].height,\n        heightPortion: scope.createNew[scope.createNew.type].height / $(\".drawingArea\").height(),\n        bgimageOpen: scope.createNew[scope.createNew.type].bgimageOpen,\n        bgimageClose: scope.createNew[scope.createNew.type].bgimageClose,\n        bgBlinkImage: scope.createNew[scope.createNew.type].bgimage,\n        value: scope.createNew.value\n      });\n      result[result.type] = JSON.parse(JSON.stringify(scope.createNew[scope.createNew.type]));\n\n      if (scope.drawarea.list) {\n        scope.drawarea.list.push(result);\n      } else {\n        scope.drawarea.list = [result];\n      }\n    };\n\n    scope.drawPos = function (element) {\n      var result = {};\n      result = {\n        top: element.top,\n        left: element.left,\n        width: element.width,\n        height: element.height,\n        position: \"absolute\",\n        transform: 'rotate(0deg)'\n      };\n      return result;\n    };\n\n    scope.calcuRotation = function (element) {\n      var result = {\n        'transform': 'rotate(-' + element.value + 'deg)',\n        '-ms-transform': 'rotate(-' + element.value + 'deg)',\n        '-moz-transform': 'rotate(-' + element.value + 'deg)',\n        '-webkit-transform': 'rotate(-' + element.value + 'deg)',\n        '-o-transform': 'rotate(-' + element.value + 'deg)'\n      };\n      return result;\n    };\n\n    scope.saveAndExit = function () {\n      var result = {};\n      result.preview = getData.call(scope.preview);\n      result.drawarea = getDrawarea.call(scope.drawarea);\n      result.charts = getData.call(scope.charts);\n      handleView(result);\n\n      function getData() {\n        var cur = this;\n        var result = {\n          list: cur.list.map(function (element) {\n            var result = {};\n            result.label = element.label;\n            result.type = element.type;\n\n            if (element.model) {\n              result.model = {\n                id: element.model.id,\n                label: element.model.label\n              };\n            }\n\n            if (element.resource) {\n              result.resource = {\n                id: element.resource.id,\n                label: element.resource.label\n              };\n            }\n\n            if (element[element.type]) {\n              result[result.type] = {\n                id: element[element.type].id,\n                label: element[element.type].label,\n                unit: element[element.type].unit\n              };\n\n              if (element[element.type].icon) {\n                result[result.type].icon = element[element.type].icon;\n              }\n            }\n\n            return result;\n          })\n        };\n\n        if (cur.title) {\n          result.title = cur.title;\n        }\n\n        return result;\n      }\n\n      function getDrawarea() {\n        var result,\n            cur = this;\n        result = {\n          list: cur.list.map(function (element) {\n            var result = {};\n\n            if (element.model) {\n              result.model = {\n                id: element.model.id,\n                label: element.model.label\n              };\n            }\n\n            if (element.resource) {\n              result.resource = {\n                id: element.resource.id,\n                label: element.resource.label\n              };\n            }\n\n            if (element.kpi) {\n              result.kpi = {\n                id: element.kpi.id,\n                label: element.kpi.label\n              };\n            }\n\n            result.show = element.show;\n            result.scale = element.scale;\n            result.type = element.type;\n            result.width = element.width;\n            result.widthPortion = element.widthPortion;\n            result.height = element.height;\n            result.heightPortion = element.heightPortion;\n            result.top = element.top;\n            result.topPortion = element.topPortion;\n            result.left = element.left;\n            result.leftPortion = element.leftPortion;\n\n            if (element.bgimageOpen) {\n              result.bgimageOpen = element.bgimageOpen;\n            }\n\n            if (element.bgimageClose) {\n              result.bgimageClose = element.bgimageClose;\n            }\n\n            if (element.bgBlinkImage) {\n              result.bgBlinkImage = element.bgBlinkImage;\n            }\n\n            return result;\n          })\n        };\n        result.backgroundImage = cur.backgroundImage;\n        return result;\n      }\n    };\n\n    $clone = function $clone(data) {\n      var result = {};\n\n      for (var i in data) {\n        if (i != \"$$hashKey\" && data.hasOwnProperty(i)) {\n          result[i] = data[i];\n        }\n      }\n\n      return result;\n    }; //Object used\n\n\n    $model = function $model(data) {\n      var cur = this;\n\n      for (var i in data) {\n        if (i != \"$$hashKey\" && data.hasOwnProperty(i)) {\n          if (_typeof(data[i]) == 'object' && typeof data[i] != null) {\n            cur[i] = JSON.parse(JSON.stringify(data[i]));\n          } else {\n            cur[i] = data[i];\n          }\n        }\n      }\n    };\n\n    $model.prototype.onChange = function (target) {\n      var cur = this;\n      var modelId = cur.id;\n\n      if (target != null) {\n        target.model = $clone(cur);\n      }\n\n      if (cur.kpi == undefined) {\n        serviceCenterService.kpis.getBymodelId(modelId).then(successKpi, errorKpi);\n      } else {\n        if (target != null) {\n          target.model.kpi = cur.kpi;\n        }\n      }\n\n      if (cur.attr == undefined) {\n        serviceCenterService.attrs.getBymodelId(modelId).then(successAttr, errorAttr);\n      } else {\n        if (target != null) {\n          target.model.attr = cur.attr;\n        }\n      }\n\n      function successKpi(data) {\n        cur.kpi = data.map(function (element) {\n          return {\n            id: element.id,\n            label: element.label,\n            icon: element.icon ? element.icon : 'ps-irrigation',\n            unit: element.unit\n          };\n        });\n\n        if (target != null) {\n          target.model.kpi = cur.kpi;\n        }\n      }\n\n      function errorKpi(err) {}\n\n      function successAttr(data) {\n        cur.attr = data.map(function (element) {\n          return {\n            id: element.id,\n            label: element.label\n          };\n        });\n\n        if (target != null) {\n          target.model.attr = cur.attr;\n        }\n      }\n\n      function errorAttr(err) {}\n    };\n\n    $resource = function $resource(data) {\n      var cur = this;\n      cur.id = data.id;\n      cur.label = data.label;\n      cur.modelId = data.modelId;\n    };\n\n    $resource.prototype.onChange = function (target) {\n      var cur = this;\n      var modelId = cur.modelId;\n\n      if (target != null) {\n        target.resource = $clone(cur);\n      }\n\n      if (cur.kpi == undefined) {\n        serviceCenterService.kpis.getBymodelId(modelId).then(successKpi, errorKpi);\n      } else {\n        if (target != null) {\n          target.resource.kpi = cur.kpi;\n        }\n      }\n\n      if (cur.attr == undefined) {\n        serviceCenterService.attrs.getBymodelId(modelId).then(successAttr, errorAttr);\n      } else {\n        if (target != null) {\n          target.resource.attr = cur.attr;\n        }\n      }\n\n      function successKpi(data) {\n        cur.kpi = data.map(function (element) {\n          return {\n            id: element.id,\n            label: element.label,\n            icon: element.icon ? element.icon : 'ps-irrigation',\n            unit: element.unit\n          };\n        });\n\n        if (target != null) {\n          target.resource.kpi = cur.kpi;\n        }\n      }\n\n      function errorKpi(err) {}\n\n      function successAttr(data) {\n        cur.attr = data.map(function (element) {\n          return {\n            id: element.id,\n            label: element.label\n          };\n        });\n\n        if (target != null) {\n          target.resource.attr = cur.attr;\n        }\n      }\n\n      function errorAttr(err) {}\n    };\n\n    $charts = function $charts(data) {\n      var cur = this;\n\n      for (var i in data) {\n        cur[i] = data[i];\n      }\n    };\n\n    $charts.prototype.add = function () {\n      var cur = this;\n      var newItem = {\n        kpi: null,\n        model: null,\n        resource: null,\n        label: '',\n        type: 'kpi'\n      };\n      cur.list = cur.list.concat([newItem]);\n    };\n\n    $charts.prototype.remove = function (item) {\n      var cur = this;\n      cur.list = cur.list.filter(function (element) {\n        return element != item;\n      });\n    };\n\n    $preview = function $preview(data) {\n      var cur = this;\n\n      for (var i in data) {\n        cur[i] = data[i];\n      }\n    };\n\n    $preview.prototype.add = function () {\n      var cur = this;\n      var newItem = {\n        kpi: null,\n        model: null,\n        resource: null,\n        label: '',\n        type: 'kpi'\n      };\n      cur.list = cur.list.concat([newItem]);\n    };\n\n    $preview.prototype.remove = function (item) {\n      var cur = this;\n\n      if (item.resource) {\n        item.resource.used = false;\n      }\n\n      cur.list = cur.list.filter(function (element) {\n        return element != item;\n      });\n    }; //FUNCTIONS\n\n\n    function init() {\n      if (scope.mode == 'editmodel') {\n        if (solutionId) {\n          handleView = saveServiceViewContent;\n          solutionUIService.getServiceViewContent(solutionId, groupId, 0, allViewLoaded);\n        } else {\n          if (deviceGroupId) {\n            handleView = updateNewDeviceGroup;\n            resourceUIService.getResourceById(deviceGroupId, resourceInfoLoaded);\n          } else {\n            handleView = saveNewDeviceGroup;\n            createNew();\n          }\n        }\n      } else if (scope.mode == 'edit') {\n        if (deviceGroupId) {\n          handleView = updateNewDeviceGroup;\n          resourceUIService.getResourceById(deviceGroupId, resourceInfoLoaded);\n        } else {\n          handleView = saveNewDeviceGroup;\n          viewFlexService.getServiceViewMap(function (event) {\n            createNewByMap(event.data);\n          }); //createNew();\n        }\n      }\n\n      function resourceInfoLoaded(event) {\n        if (event.code == 0) {\n          currentDeviceGroup = event.data;\n        }\n\n        serviceCenterService.views.getAll().then(function (data) {\n          var views = data;\n\n          for (var i in views) {\n            if (views[i].viewTitle == 'tongji_deviceGroup') {\n              var tg = JSON.parse(views[i].content);\n\n              if (tg.deviceGroupId == deviceGroupId) {\n                currentView = tg;\n                currentView.viewId = views[i].viewId;\n              }\n\n              update(currentDeviceGroup);\n            }\n          }\n        });\n      }\n\n      function allViewLoaded(event) {\n        if (event.code == '0') {\n          if (typeof event.data == 'string') {\n            currentView = JSON.parse(event.data);\n          }\n        }\n\n        if (solutionId) {\n          if (currentView == undefined) {\n            newSolution();\n          } else {\n            updateSolution(currentDeviceGroup);\n          }\n        } else {\n          update(currentDeviceGroup);\n        }\n      }\n\n      function saveNewDeviceGroup(data) {\n        // \n        //scope.deviceGroupModel = data;\n        var deviceGroup = JSON.parse(JSON.stringify(scope.deviceGroupModel));\n        deviceGroup.modelId = deviceGroup.id;\n        delete deviceGroup.id;\n        resourceUIService.saveDeviceGroup(deviceGroup, callback);\n\n        function callback(event) {\n          var newdeviceGroup = event.data;\n          data.deviceGroupId = newdeviceGroup.id;\n          var JSONstring = JSON.stringify(data);\n\n          try {\n            var param = {\n              viewTitle: \"tongji_deviceGroup\",\n              viewName: \"tongji_deviceGroup\",\n              viewType: \"tongji_deviceGroup\",\n              content: JSONstring\n            };\n            viewFlexService.addView(param, callback);\n          } catch (err) {\n            alert(err);\n          }\n\n          function callback(event) {\n            location.path(\"tongji/prev\");\n          }\n        }\n      }\n\n      function saveServiceViewContent(data) {\n        var JSONstring = JSON.stringify(data);\n        solutionUIService.saveServiceViewContent(solutionId, groupId, 0, JSONstring, function (event) {\n          window.location.href = \"../app-ac/index.html#/myView\";\n        });\n      }\n\n      function updateNewDeviceGroup(data) {\n        var deviceGroup = JSON.parse(JSON.stringify(currentDeviceGroup));\n        resourceUIService.saveDeviceGroup(deviceGroup, callback);\n\n        function callback(event) {\n          var newdeviceGroup = event.data;\n          data.deviceGroupId = newdeviceGroup.id;\n          var JSONstring = JSON.stringify(data);\n\n          try {\n            var param = {\n              viewId: currentView.viewId,\n              viewTitle: \"tongji_deviceGroup\",\n              viewName: \"tongji_deviceGroup\",\n              viewType: \"tongji_deviceGroup\",\n              content: JSONstring\n            };\n            viewFlexService.updateView(param, callback);\n          } catch (err) {\n            alert(err);\n          }\n\n          function callback(event) {\n            location.path(\"tongji/prev\");\n          }\n        }\n      }\n    }\n\n    ;\n\n    function newSolution() {\n      solutionUIService.getModelsByGroupId(solutionId, groupId, function (event) {\n        if (event.code == '0') {\n          scope.allModels = event.data.map(function (element) {\n            return new $model(element);\n          });\n          scope.preview = new $preview({\n            list: []\n          });\n          scope.drawarea = {\n            list: [],\n            backgroundImage: 'images/tongji/bg.png'\n          };\n          scope.charts = new $charts({\n            list: []\n          });\n        }\n      });\n    }\n\n    function updateSolution(currentDeviceGroup) {\n      solutionUIService.getModelsByGroupId(solutionId, groupId, function (event) {\n        if (event.code == '0') {\n          scope.allModels = event.data.map(function (element) {\n            return new $model(element);\n          });\n          scope.preview = new $preview(currentView.preview);\n          scope.drawarea = currentView.drawarea;\n          scope.drawarea.list = scope.drawarea.list.map(function (element) {\n            return new $dragElement(element);\n          });\n          scope.charts = new $charts(currentView.charts);\n\n          for (var i in scope.preview.list) {\n            (function (index, elem) {\n              handleModel.call(elem);\n            })(i, scope.preview.list[i]);\n          }\n\n          for (var i in scope.drawarea.list) {\n            (function (index, elem) {\n              handleModel.call(elem);\n            })(i, scope.drawarea.list[i]);\n          }\n\n          for (var i in scope.charts.list) {\n            (function (index, elem) {\n              handleModel.call(elem);\n            })(i, scope.charts.list[i]);\n          }\n        }\n\n        function handleModel() {\n          var cur = this,\n              model;\n\n          if (cur.model) {\n            model = scope.allModels.find(function (element) {\n              return cur.model.id == element.id;\n            });\n          }\n\n          cur.modelObj = model;\n\n          if (model) {\n            serviceCenterService.kpis.getBymodelId(model.id).then(successKpi, errorKpi);\n          }\n\n          function successKpi(data) {\n            cur.model.kpi = data.map(function (element) {\n              return {\n                id: element.id,\n                label: element.label,\n                icon: element.icon ? element.icon : 'ps-irrigation',\n                unit: element.unit\n              };\n            });\n            cur.kpi = cur.model.kpi.find(function (k) {\n              return k.id == cur.kpi.id;\n            });\n            kpiChange(cur);\n          }\n\n          function errorKpi(err) {}\n        }\n      });\n    }\n\n    function update(deviceGroup) {\n      serviceCenterService.resources.getAll().then(success, error);\n\n      function success(data) {\n        scope.resources = data.map(function (element) {\n          return new $resource(element);\n        });\n        serviceCenterService.deviceGroupModels.getAll().then(success, error);\n\n        function success(data) {\n          scope.deviceGroupModels = data;\n          scope.deviceGroupModel = scope.deviceGroupModels.find(function (element) {\n            return deviceGroup.modelId == element.id;\n          });\n          var preview = currentView.preview;\n          var charts = currentView.charts;\n          scope.preview = new $preview(preview);\n          scope.drawarea = currentView.drawarea;\n          scope.drawarea.list = scope.drawarea.list.map(function (element) {\n            return new $dragElement(element);\n          });\n          scope.charts = new $charts(charts);\n\n          for (var i in scope.preview.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.preview.list[i]);\n          }\n\n          for (var i in scope.drawarea.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.drawarea.list[i]);\n          }\n\n          for (var i in scope.charts.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.charts.list[i]);\n          }\n\n          function handleResource() {\n            var cur = this,\n                resource;\n\n            if (cur.resource) {\n              resource = scope.resources.find(function (element) {\n                return cur.resource.id == element.id;\n              });\n            }\n\n            cur.resourceObj = resource;\n\n            if (resource) {\n              serviceCenterService.kpis.getBymodelId(resource.modelId).then(successKpi, errorKpi);\n            }\n\n            function successKpi(data) {\n              cur.resource.kpi = data.map(function (element) {\n                return {\n                  id: element.id,\n                  label: element.label,\n                  icon: element.icon ? element.icon : 'ps-irrigation',\n                  unit: element.unit\n                };\n              });\n              cur.kpi = cur.resource.kpi.find(function (k) {\n                return k.id == cur.kpi.id;\n              });\n              kpiChange(cur);\n            }\n\n            function errorKpi(err) {}\n          }\n        }\n\n        function error(err) {}\n      }\n\n      function error(err) {}\n    }\n\n    function createNewByMap(dataMap) {\n      var viewContent;\n      serviceCenterService.deviceGroupModels.getAll().then(success, error);\n\n      function success(data) {\n        scope.deviceGroupModels = data;\n\n        if (scope.deviceGroupModels instanceof Array ? scope.deviceGroupModels.length > 0 : false) {\n          scope.deviceGroupModel = scope.deviceGroupModels[0];\n\n          if (dataMap[scope.deviceGroupModel.id]) {\n            viewContent = JSON.parse(dataMap[scope.deviceGroupModel.id]);\n          }\n        }\n\n        serviceCenterService.resources.getAll().then(success, error);\n\n        function success(data) {\n          scope.resources = data.map(function (element) {\n            return new $resource(element);\n          });\n          var preview = viewContent ? viewContent.preview : {\n            list: []\n          };\n          var charts = viewContent ? viewContent.charts : {\n            list: []\n          };\n          scope.preview = new $preview(preview);\n          scope.drawarea = viewContent ? viewContent.drawarea : {\n            list: [],\n            backgroundImage: 'images/tongji/bg.png'\n          };\n          scope.drawarea.list = scope.drawarea.list.map(function (element) {\n            return new $dragElement(element);\n          });\n          scope.charts = new $charts(charts);\n\n          for (var i in scope.preview.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.preview.list[i]);\n          }\n\n          for (var i in scope.drawarea.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.drawarea.list[i]);\n          }\n\n          for (var i in scope.charts.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.charts.list[i]);\n          }\n\n          function handleResource() {\n            var cur = this,\n                resource;\n\n            if (cur.model) {\n              resource = scope.resources.find(function (element) {\n                return cur.model.id == element.modelId;\n              });\n            }\n\n            if (resource) {\n              cur.resource = {\n                id: resource.id,\n                label: resource.label\n              };\n              cur.resourceObj = resource;\n              serviceCenterService.kpis.getBymodelId(resource.modelId).then(successKpi, errorKpi);\n            }\n\n            function successKpi(data) {\n              if (cur.resource) {\n                cur.resource.kpi = data.map(function (element) {\n                  return {\n                    id: element.id,\n                    label: element.label,\n                    icon: element.icon ? element.icon : 'ps-irrigation',\n                    unit: element.unit\n                  };\n                });\n                cur.kpi = cur.resource.kpi.find(function (k) {\n                  return k.id == cur.kpi.id;\n                });\n              }\n\n              kpiChange(cur);\n            }\n\n            function errorKpi(err) {}\n          }\n        }\n\n        function error(err) {}\n      }\n\n      function error(err) {}\n    }\n\n    function createNew() {\n      serviceCenterService.deviceGroupModels.getAll().then(success, error);\n\n      function success(data) {\n        scope.deviceGroupModels = data;\n\n        if (scope.deviceGroupModels instanceof Array ? scope.deviceGroupModels.length > 0 : false) {\n          scope.deviceGroupModel = scope.deviceGroupModels[0];\n        }\n\n        scope.preview = new $preview({\n          list: []\n        });\n        scope.drawarea = {\n          list: [],\n          backgroundImage: 'images/tongji/bg.png'\n        };\n        scope.charts = new $charts({\n          list: []\n        });\n        serviceCenterService.resources.getAll().then(success, error);\n\n        function success(data) {\n          scope.resources = data.map(function (element) {\n            return new $resource(element);\n          });\n        }\n\n        function error(err) {}\n      }\n\n      function error(err) {}\n    }\n  }\n\n  controllers.initController(\"tglibraryCtrl\", tglibraryCtrl);\n  tglibraryCtrl.$inject = ['$scope', '$q', 'serviceCenterService', '$route', '$window', '$location', 'resourceUIService', \"chartOptionService\", \"SwSocket\", '$timeout', \"solutionUIService\", \"userLoginUIService\"];\n\n  function tglibraryCtrl(scope, q, serviceCenterService, route, window, location, resourceUIService, chartOptionService, SwSocket, timeout, solutionUIService, userLoginUIService) {\n    scope.$on('$locationChangeSuccess', function (event) {\n      if (location.path() == \"/servers\") {\n        userLoginUIService.changePos();\n      }\n    });\n    var deviceGroupId,\n        currentDeviceGroup,\n        currentView,\n        blinks = [],\n        showCam = false,\n        uuid;\n    scope.health = {};\n\n    scope.wholeClick = function () {\n      scope.panelShow = false;\n    };\n\n    scope.orderHandlerClick = function () {\n      window.location.href = \"../app-oc/index.html#/workorder\";\n    };\n\n    scope.overviewClick = function () {\n      window.location.href = \"../app-oc/index.html#/dashboard\";\n    };\n\n    scope.equipmentClick = function () {\n      window.location.href = \"../app-oc/index.html#/gateways2\";\n    };\n\n    scope.malfunctionClick = function () {\n      window.location.href = \"../app-oc/index.html#/configAlert/0\";\n    };\n\n    scope.chartClick = function () {\n      window.location.href = \"../app-oc/index.html#/designView\";\n    };\n\n    scope.panelShow = false;\n    scope.$on(\"$destroy\", function () {\n      SwSocket.unregister(uuid);\n    });\n\n    scope.panelClick = function () {\n      scope.panelShow = !scope.panelShow;\n    };\n\n    scope.ipcam = {};\n\n    scope.camClick = function () {\n      if (scope.ipcam.openCam) {\n        scope.ipcam.openCam();\n      }\n\n      showCam = true;\n    };\n\n    scope.closeCam = function () {\n      if (scope.ipcam.closeCam) {\n        scope.ipcam.closeCam();\n      }\n\n      showCam = false;\n    };\n\n    scope.showCam = function () {\n      return showCam;\n    };\n\n    scope.blinkClick = function () {\n      scope.alertOn = !scope.alertOn;\n\n      if (scope.alertOn) {\n        for (var i in blinks) {\n          blinks[i].startBlink();\n        }\n\n        scope.health.startBlink();\n      } else {\n        for (var i in blinks) {\n          blinks[i].stopBlink();\n        }\n\n        scope.health.stopBlink();\n      }\n    };\n\n    scope.drawPos = function (element) {\n      var result = {};\n      result = {\n        top: element.topPortion * 100 + \"%\",\n        left: element.leftPortion * 100 + \"%\",\n        width: element.widthPortion * 100 + \"%\",\n        height: element.heightPortion * 100 + \"%\",\n        transform: 'rotate(0deg)',\n        position: \"absolute\"\n      };\n      return result;\n    };\n\n    scope.calcuRotation = function (element) {\n      var result = {\n        'transform': 'rotate(-' + element.value + 'deg)',\n        '-ms-transform': 'rotate(-' + element.value + 'deg)',\n        '-moz-transform': 'rotate(-' + element.value + 'deg)',\n        '-webkit-transform': 'rotate(-' + element.value + 'deg)',\n        '-o-transform': 'rotate(-' + element.value + 'deg)'\n      };\n      return result;\n    };\n\n    if (route.current) {\n      deviceGroupId = route.current.params.deviceGroupId;\n      init(deviceGroupId);\n    } else {\n      scope.$on(\"locationChanged\", function () {\n        deviceGroupId = route.current.params.deviceGroupId;\n        init(deviceGroupId);\n      });\n    }\n\n    function init(deviceGroupId) {\n      resourceUIService.getResourceById(deviceGroupId, resourceInfoLoaded);\n    }\n\n    function resourceInfoLoaded(event) {\n      if (event.code == 0) {\n        currentDeviceGroup = event.data;\n      }\n\n      serviceCenterService.views.getAll().then(allViewLoaded); //solutionUIService.getServiceViewContent(solutionId, groupId, allViewLoaded);\n    }\n\n    function allViewLoaded(data) {\n      for (var i in data) {\n        if (data[i].viewTitle == 'tongji_deviceGroup') {\n          var dt = JSON.parse(data[i].content);\n\n          if (dt.deviceGroupId == deviceGroupId) {\n            currentView = dt;\n          }\n        }\n      }\n\n      scope.charts = currentView.charts;\n      getAllValue();\n    }\n\n    function getAllValue() {\n      var nodes = [],\n          kpis = [],\n          nodesSocket = [],\n          kpisSocket = [],\n          nodesCharts = [],\n          kpisCharts = [];\n\n      for (var i in currentView.drawarea.list) {\n        (function (index, element) {\n          if (element.type == 'switch') {\n            element.onChange = function (value) {};\n          }\n\n          if (element.type == 'blink') {\n            blinks.push(element);\n          } else {\n            if (_typeof(element.resource) == 'object' && element.resource != null) {\n              if (nodes.indexOf(element.resource.id) == -1) {\n                nodes.push(element.resource.id);\n              }\n\n              if (element.type == \"bar\" && nodesSocket.indexOf(element.resource.id) == -1) {\n                nodesSocket.push(element.resource.id);\n              }\n\n              if (element.type == \"switch\" && nodesSocket.indexOf(element.resource.id) == -1) {\n                resourceUIService.getResourceById(element.resource.id, function (event) {\n                  if (event.data) {\n                    var modelId = event.data.modelId;\n                    serviceCenterService.directives.getBymodelId(modelId).then(function success(event) {\n                      try {\n                        if (event instanceof Array) {\n                          var comId = event[0].id;\n                          var nodeId = element.resource.id;\n\n                          element.sendDeviceDirective = function (value) {\n                            resourceUIService.sendDeviceDirective(nodeId, comId, {\n                              value: value\n                            }, function (event) {});\n                          };\n                        } else {\n                          throw event.message;\n                        }\n                      } catch (err) {}\n                    });\n                  }\n                });\n              }\n\n              if (element.type == \"open\" && nodesSocket.indexOf(element.resource.id) == -1) {\n                resourceUIService.getResourceById(element.resource.id, function (event) {\n                  if (event.data) {\n                    var modelId = event.data.modelId;\n                    serviceCenterService.directives.getBymodelId(modelId).then(function success(event) {\n                      try {\n                        if (event instanceof Array && event[0] != undefined) {\n                          var comId = event[0].id;\n                          var nodeId = element.resource.id;\n\n                          element.sendDeviceDirective = function (value) {\n                            resourceUIService.sendDeviceDirective(nodeId, comId, {\n                              value: value\n                            }, function (event) {});\n                          };\n                        } else {\n                          throw event.message;\n                        }\n                      } catch (err) {}\n                    });\n                  }\n                });\n              }\n            }\n\n            if (_typeof(element.kpi) == 'object' && element.kpi != null) {\n              if (kpis.indexOf(element.kpi.id) == -1) {\n                kpis.push(element.kpi.id);\n              }\n\n              if (kpisSocket.indexOf(element.kpi.id) == -1) {\n                kpisSocket.push(element.kpi.id);\n              }\n            }\n          }\n        })(i, currentView.drawarea.list[i]);\n      }\n\n      for (var i in currentView.charts.list) {\n        (function (index, element) {\n          if (_typeof(element.resource) == 'object' && element.resource != null) {\n            if (nodesCharts.indexOf(element.resource.id) == -1) {\n              nodesCharts.push(element.resource);\n            }\n\n            if (nodesSocket.indexOf(element.resource.id) == -1) {\n              nodesSocket.push(element.resource.id);\n            }\n          }\n\n          if (_typeof(element.kpi) == 'object' && element.kpi != null) {\n            if (nodesCharts.indexOf(element.kpi.id) == -1) {\n              kpisCharts.push(element.kpi);\n            }\n\n            if (kpisSocket.indexOf(element.kpi.id) == -1) {\n              kpisSocket.push(element.kpi.id);\n            }\n          }\n        })(i, currentView.charts.list[i]);\n      }\n\n      webSocketOpen(nodesSocket, kpisSocket);\n      serviceCenterService.getValues(nodes, kpis).then(allValueLoaded);\n      serviceCenterService.getValuesListAndMergeByTime(nodesCharts, kpisCharts, 7 * 24 * 3600 * 1000, 100 * 1000).then(allValueListLoaded);\n    }\n\n    function webSocketOpen(nodes, kpis) {\n      uuid = Math.uuid();\n      var param = {\n        ciid: nodes.toString(),\n        kpi: kpis.toString()\n      };\n      timeout(function () {\n        repeat();\n      }, 2000);\n\n      function repeat() {\n        for (var i in currentView.charts.list) {\n          var elem = currentView.charts.list[i];\n          var finalValue = elem._option_.series[0].data[elem._option_.series[0].data.length - 1];\n          var finalTime = elem._option_.xAxis.data[elem._option_.xAxis.data.length - 1];\n          finalValue = parseInt(finalValue) + parseInt(parseInt(finalValue * (Math.random() - .5) / 100)); // \n\n          currentView.charts.list[i].pushData(finalValue, parseInt(finalTime) + 100);\n          timeout(function () {\n            repeat();\n          }, 25000);\n        }\n      }\n      /*\n      SwSocket.register(uuid, \"register\", function(event){\n      \ttry{\n      \t\tif(event.data)\n      \t\t{\n      \t\t\tvar kpiId = event.data.kpiCode;\n      \t\t\tvar nodeId = event.data.nodeId;\n      \t\t\tvar findDraw = currentView.drawarea.list.find(function(element){\n      \t\t\t\tif(typeof element.resource == 'object' && element.resource != null && typeof element.kpi == 'object' && element.kpi != null)\n      \t\t\t\t{\n      \t\t\t\t\treturn element.resource.id == nodeId && element.kpi.id == kpiId\n      \t\t\t\t}\n      \t\t\t\telse\n      \t\t\t\t{\n      \t\t\t\t\treturn false;\n      \t\t\t\t}\n      \t\t\t});\n      \t\t\tvar findChart = currentView.charts.list.find(function(element){\n      \t\t\t\tif(typeof element.resource == 'object' && element.resource != null && typeof element.kpi == 'object' && element.kpi != null)\n      \t\t\t\t{\n      \t\t\t\t\t \n      \t\t\t\t\treturn element.resource.id == nodeId && element.kpi.id == kpiId\n      \t\t\t\t}\n      \t\t\t\telse\n      \t\t\t\t{\n      \t\t\t\t\treturn false;\n      \t\t\t\t}\n      \t\t\t});\n      \t\t\tif(findChart)\n      \t\t\t{\n      \t\t\t\tif(typeof findChart.pushData == 'function')\n      \t\t\t\t{\n      \t\t\t\t\tfindChart.pushData(data.value);\n      \t\t\t\t}\n      \t\t\t\telse\n      \t\t\t\t{\n      \t\t\t\t\t \n      \t\t\t\t}\n      \t\t\t}\n      \t\t\tif(findDraw)\n      \t\t\t{\n      \t\t\t\tfindDraw.value = data.value;\n      \t\t\t}\n      \t\t}\n      \t\telse\n      \t\t{\n      \t\t\tthrow 'event is undefined!!'\n      \t\t}\n      \t}\n      \tcatch(error){\n      \t\t \n      \t}\n      });\n      */\n\n\n      SwSocket.send(uuid, \"register\", 'kpi', param);\n    }\n\n    function allValueLoaded(data) {\n      for (var j in currentView.drawarea.list) {\n        (function (index, elem) {\n          pushValue.call(elem);\n        })(j, currentView.drawarea.list[j]);\n      }\n\n      start(currentView);\n\n      function pushValue() {\n        var cur = this;\n        var find = data.find(function (el) {\n          if (_typeof(cur.kpi) == 'object' && cur.kpi != null && _typeof(cur.resource) == 'object' && cur.resource != null) {\n            return el.kpiCode == cur.kpi.id && el.nodeId == cur.resource.id;\n          } else {\n            return false;\n          }\n        });\n\n        if (find) {\n          if (find.value) {\n            cur.value = find.value;\n          } else {\n            cur.value = '-';\n          }\n        } else {\n          cur.value = '-';\n        }\n      }\n    }\n\n    function allValueListLoaded(data) {\n      var colors = [\"#d99a37\", \"#c25262\", \"#39a4d9\", \"#d97c39\", \"#4ccbb4\"];\n\n      for (var i in scope.charts.list) {\n        (function (index, element) {\n          if (_typeof(element.resource) == \"object\" && element.resource != null && _typeof(element.kpi) == \"object\" && element.kpi != null) {\n            var find = data.legend.find(function (elem) {\n              return elem.ci == element.resource.label && elem.kpi == element.kpi.label;\n            });\n            var inx = data.legend.indexOf(find);\n\n            if (data.$attr('series/' + index + \"/data/length\") == 0 || data.$attr('series/' + index + \"/data/length\") == undefined) {\n              setOptions.call(element, {\n                legend: ['设备－指标'],\n                xAxis: function () {\n                  var xAxis = [];\n                  var timeEnd = new Date().getTime();\n\n                  for (var i = 0; i < 14; i++) {\n                    xAxis.push(timeEnd - 3600 * 100);\n                  }\n\n                  xAxis.sort();\n                  return xAxis;\n                }(),\n                series: function () {\n                  var series = [];\n\n                  for (var i = 0; i < 14; i++) {\n                    series.push(parseInt(Math.random() * 100));\n                  }\n\n                  return [{\n                    name: {\n                      ci: '设备',\n                      kpi: '指标'\n                    },\n                    data: series\n                  }];\n                }()\n              }, colors[index % 5], true);\n            } else {\n              setOptions.call(element, {\n                legend: [data.legend[index]],\n                xAxis: data.xAxis,\n                series: [data.series[index]]\n              }, colors[index % 5]);\n            }\n          }\n        })(i, scope.charts.list[i]);\n      }\n    }\n\n    function setOptions(data, color, track) {\n      var cur = this;\n\n      if (track) {}\n\n      var lineChart = new chartOptionService.linechart();\n      lineChart.setTitle({\n        show: false\n      });\n      lineChart.setGrid({\n        top: \"5%\",\n        left: \"5%\",\n        width: \"90%\",\n        height: \"80%\"\n      });\n      lineChart.setTimeformat(\"时分\");\n      lineChart.setxAxis({\n        data: data.xAxis\n      });\n      data.series[0].$extension({\n        itemStyle: {\n          normal: {\n            color: color\n          }\n        },\n        lineStyle: {\n          normal: {\n            color: color\n          }\n        },\n        areaStyle: {\n          type: 'default',\n          normal: {\n            color: color\n          }\n        }\n      });\n      lineChart.setSeriesByCiKpi(data.series);\n\n      if (typeof cur.setOption == 'function') {\n        cur.setOption(lineChart.returnOption());\n      }\n    }\n\n    function start(data) {\n      scope.drawarea = data.drawarea;\n    }\n  }\n});"],"sourceRoot":"/source/"}