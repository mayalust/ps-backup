{"version":3,"sources":["app-sc/js/controllers/view-machine-ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","BootstrapDialog","calculateRule","range","rs","JSON","parse","e","initController","scope","rootScope","routeParams","timeout","kpiDataService","userLoginUIService","resourceUIService","alertService","SwSocket","Info","viewFlexService","unitService","growl","userDomainService","userEnterpriseService","q","window","location","solutionUIService","serviceCenterService","kpisArray","solutionId","modelIdabsolute","$on","event","path","changePos","showBtn","alertsClass","level","editAbsoluteClick","href","alertButtonClick","bool","nodeId","renderAlertStatus","alertStatus","gotoNewResource","closeBtn","defer","getKpiValueList","nodes","kpis","callback","param","category","isRealTimeData","timePeriod","nodeIds","kpiCodes","startTime","endTime","timeRange","statisticType","condList","getValueList","getServiceViewMap_callback","resources","map","element","id","i","data","modelId","content","cont","getkpis","getAllkpisFromView","call","j","indexOf","push","resource","backgroundImage","leftBar","stringify","rightBar","midBar","preview","kpitoUsername","initResource","Array","con","k","cur","this","list","kpi","columnA","columnB","columnC","kpiValueLists","deferreds","checkVisible","key","show","find","kpiCode","value","runFormula","str","result","kpisArr","match","parseInt","slice","replace","getFormulas","arguments","attr","val","type","eval","getKpisValue","$attr","Math","random","alert","filter","length","setValue","valueType","_cur_","elem","kpiDes","undefined","rangeObj","link","calculateLinkage","regExps","getValue","exp","exec","kpiId","onClick","linkage","resolve","promise","getAttributes","attrs","getBymodelId","then","attributes","values","name","getCharts","minTimespan","sum","size","kpisData","reduce","prev","next","Object","defineProperty","enumerable","valuelist","renderOption","optionDefault","xAxis","$formatDate","Date","timeStamp","legend","series","label","reduceBytime","last","process","newDateJson","arisingTime","getTime","myDate","date","year","getYear","month","getMonth","dt","getDate","split","inx","animation","grid","top","left","width","height","containLabel","title","padding","text","textStyle","fontWeight","fontSize","tooltip","trigger","calculable","boundaryGap","axisLine","lineStyle","color","axisLabel","splitLine","axisTick","yAxis","splitNumber","min","itemStyle","normal","areaStyle","option","currentRes","showTitle","error","all","loaded","user","userName","appData","roleID","getResourceByIds","getServiceViewContent","code","msg","apply","err","getAllMyViews","viewType","getServiceViewMap","getResources","evnt","getAllKpis","allKpis","modelIds","handleView","currentView","viewId","getData","showWhenCustomerA","icon","pushData","remove","el","pushData_rb","self","open","select","linkClick","iconSelect","fronticons","iconClose","prevPanel","visible","hide","leftPartA","leftPartB","leftPartC","midPart","rightPart","bgImages","saveServiceView","saveAndExit","previewMode","previewServiceView","model","writable","icons","wholeClick","$kpis","create","models","valueCached","deferred","getKpisByModelId","modeId","concat","reject","start","getKpis","getAttr","getContent","target","saveServiceViewContent","Error","message","originalViewId","viewTitle","viewName","updateView","addView"],"mappings":"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","file":"app-sc/js/controllers/view-machine-ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers', 'bootstrap-dialog', 'Array'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  var calculateRule = function calculateRule(range) {\n    var rs = {};\n\n    try {\n      rs = JSON.parse(range);\n    } catch (e) {} finally {\n      return rs;\n    }\n  };\n\n  controllers.initController('ViewMachineCtrl', ['$scope', '$rootScope', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'SwSocket', 'Info', 'viewFlexService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', '$q', '$window', '$location', 'solutionUIService', 'serviceCenterService', function (scope, rootScope, routeParams, timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, SwSocket, Info, viewFlexService, unitService, growl, userDomainService, userEnterpriseService, q, window, location, solutionUIService, serviceCenterService) {\n    var kpisArray = [],\n        solutionId,\n\n    /* temperary only */\n    modelIdabsolute\n    /* temperary only */\n    ;\n    scope.$on('$locationChangeSuccess', function (event) {\n      if (location.path() == \"/servers\") {\n        userLoginUIService.changePos();\n      }\n    });\n    rootScope.showBtn = false;\n\n    scope.alertsClass = function (level) {\n      switch (level) {\n        case 0:\n          return 'level0';\n          break;\n\n        case 1:\n          return 'level1';\n          break;\n\n        case 2:\n          return 'level2';\n          break;\n\n        case 3:\n          return 'level3';\n          break;\n\n        case 4:\n          return 'level4';\n          break;\n\n        default:\n          return 'level0';\n          break;\n      }\n    };\n    /* temperary use !!!! */\n\n\n    scope.editAbsoluteClick = function () {\n      window.location.href = \"../app-sc/index_machine.html#/machine/absolute/\" + modelIdabsolute;\n    };\n    /* temperary use !!!! */\n\n\n    scope.alertButtonClick = function (bool) {\n      if (bool == false) {\n        location.path(\"configAlert/\" + routeParams.nodeId);\n      }\n    };\n\n    scope.renderAlertStatus = function (alertStatus) {\n      if (alertStatus < 2) {\n        return \"\";\n      } else if (alertStatus < 4) {} else if (alertStatus < 6) {}\n    };\n\n    scope.gotoNewResource = function () {\n      window.location.href = \"../app-oc/index.html#/gateways2\";\n    };\n\n    scope.closeBtn = function () {\n      location.path(\"machine\");\n    };\n\n    var defer = q.defer();\n\n    if (userLoginUIService.user.userName && userLoginUIService.user.appData) {\n      scope.roleID = userLoginUIService.user.roleID ? userLoginUIService.user.roleID : 100;\n\n      if (scope.roleID == 1000) {\n        scope.key = userLoginUIService.user.userName ? userLoginUIService.user.userName : '';\n      } else {\n        scope.key = '';\n      }\n\n      defer.resolve(\"success\");\n    } else {\n      scope.$on(\"loginStatusChanged\", function () {\n        scope.roleID = userLoginUIService.user.roleID ? userLoginUIService.user.roleID : 100;\n\n        if (scope.roleID == 1000) {\n          scope.key = userLoginUIService.user.userName ? userLoginUIService.user.userName : '';\n        } else {\n          scope.key = '';\n        }\n\n        defer.resolve(\"success\");\n      });\n    }\n\n    function getKpiValueList(nodes, kpis, callback) {\n      var kpiQueryModel = {\n        category: 'ci',\n        isRealTimeData: true,\n        timePeriod: 0,\n        nodeIds: nodes,\n        kpiCodes: kpis,\n        startTime: null,\n        endTime: null,\n        timeRange: \"\",\n        statisticType: \"psiot\",\n        condList: []\n      };\n      var param = [\"kpi\", kpiQueryModel];\n      kpiDataService.getValueList(param, function (event) {\n        callback(event);\n      });\n    }\n\n    defer.promise.then(function () {\n      if (routeParams.nodeId) {\n        resourceUIService.getResourceByIds([routeParams.nodeId], getResourceById_callback);\n      } else {\n        resourceUIService.getResources(getResources_callback);\n      }\n\n      function getResourceById_callback(event) {\n        var resource = event[routeParams.nodeId];\n        scope.resources = [resource];\n        var modelId = resource.modelId;\n\n        var modelId_back = function modelId_back(data) {\n          resource.kpisArray = data;\n\n          if (solutionId) {\n            solutionUIService.getServiceViewContent(solutionId, 0, function (event) {\n              try {\n                if (event.code == 0) {\n                  if (event.data == null) {\n                    throw \"缺少配置文件！\";\n                  } else {\n                    var cont = JSON.parse(event.data);\n                    var nodes = [resource.id];\n                    var kpis = [999999];\n                    Array.prototype.push.apply(kpis, getAllkpisFromView.call(cont));\n                    getKpiValueList(nodes, kpis, function (event) {\n                      scope.backgroundImage = cont.backgroundImage;\n                      resource.leftBar = JSON.parse(JSON.stringify(cont.leftBar));\n                      resource.rightBar = JSON.parse(JSON.stringify(cont.rightBar));\n                      resource.midBar = JSON.parse(JSON.stringify(cont.midBar));\n                      resource.preview = JSON.parse(JSON.stringify(cont.preview));\n                      resource.kpitoUsername = cont.kpitoUsername;\n                      initResource.call(resource, event.data);\n                    });\n                  }\n                } else {\n                  throw event.msg;\n                }\n              } catch (err) {\n                growl.error(err);\n              }\n            });\n          } else {\n            viewFlexService.getAllMyViews(function (event) {\n              var find = event.data.find(function (elem) {\n                if (elem.viewType == 'modelservice') {\n                  var dt = JSON.parse(elem.content);\n                  return dt.modelId == modelId;\n                } else {\n                  return false;\n                }\n              });\n\n              if (find) {\n                getServiceViewMap_callback({\n                  data: {\n                    modelId: find.content\n                  }\n                });\n              } else {\n                viewFlexService.getServiceViewMap(getServiceViewMap_callback);\n              }\n            });\n          }\n        };\n\n        serviceCenterService.kpis.getBymodelId(modelId).then(modelId_back);\n      }\n\n      function getResources_callback(evnt) {\n        var rs = [];\n        scope.resources = evnt.data.filter(function (element) {\n          return element.category != \"RootDomain\";\n        });\n\n        var getAllKpis = function getAllKpis(resource) {\n          var defer = q.defer();\n          var modelId = resource.modelId;\n\n          if (scope.allKpis == undefined) {\n            scope.allKpis = {};\n          }\n\n          if (scope.allKpis[modelId]) {\n            resource.kpisArray = allKpis[modelId];\n            defer.resolve(\"success\");\n          } else {\n            var modelBack = function modelBack(data) {\n              scope.allKpis[modelId] = data;\n              resource.kpisArray = scope.allKpis[modelId];\n              defer.resolve(\"success\");\n            };\n\n            serviceCenterService.kpis.getBymodelId(modelId).then(modelBack);\n          }\n\n          return defer.promise;\n        };\n\n        for (var i in scope.resources) {\n          rs.push(getAllKpis(scope.resources[i]));\n        }\n\n        ;\n        q.all(rs).then(function (event) {\n          if (solutionId) {\n            solutionUIService.getServiceViewContent(solutionId, 0, function (event) {\n              try {\n                if (event.code == 0) {\n                  if (event.data == null) {\n                    throw \"缺少配置文件！\";\n                  } else {\n                    var cont = JSON.parse(event.data);\n                    var nodes = scope.resources.map(function (element) {\n                      return element.id;\n                    });\n                    var kpis = [999999];\n                    Array.prototype.push.apply(kpis, getAllkpisFromView.call(cont));\n                    getKpiValueList(nodes, kpis, function (event) {\n                      for (var i in scope.resources) {\n                        (function (resource) {\n                          scope.backgroundImage = cont.backgroundImage;\n                          resource.leftBar = JSON.parse(JSON.stringify(cont.leftBar));\n                          resource.rightBar = JSON.parse(JSON.stringify(cont.rightBar));\n                          resource.midBar = JSON.parse(JSON.stringify(cont.midBar));\n                          resource.preview = JSON.parse(JSON.stringify(cont.preview));\n                          resource.kpitoUsername = cont.kpitoUsername;\n                          initResource.call(resource, event.data);\n                        })(scope.resources[i]);\n                      }\n                    });\n                  }\n                } else {\n                  throw event.msg;\n                }\n              } catch (err) {\n                growl.error(err);\n              }\n            });\n          } else {\n            viewFlexService.getAllMyViews(function (event) {\n              var filter = event.data.filter(function (elem) {\n                return elem.viewType == 'modelservice';\n              });\n\n              if (filter.length > 0) {\n                getServiceViewMap_callback({\n                  data: {\n                    modelIds: filter\n                  }\n                });\n              } else {\n                viewFlexService.getServiceViewMap(getServiceViewMap_callback);\n              }\n            });\n          }\n        });\n      }\n\n      ;\n    });\n\n    function getServiceViewMap_callback(event) {\n      var nodes = scope.resources.map(function (element) {\n        return element.id;\n      });\n      var kpis = [999999];\n\n      for (var i in event.data) {\n        (function (modelId, content) {\n          if (typeof content == 'string') {\n            var cont = JSON.parse(content);\n            var getkpis = getAllkpisFromView.call(cont);\n\n            for (var j in getkpis) {\n              if (kpis.indexOf(getkpis[j]) == -1) {\n                kpis.push(getkpis[j]);\n              }\n            }\n\n            getKpiValueList(nodes, kpis, function (event) {\n              for (var i in scope.resources) {\n                (function (resource) {\n                  scope.backgroundImage = cont.backgroundImage;\n                  resource.leftBar = JSON.parse(JSON.stringify(cont.leftBar));\n                  resource.rightBar = JSON.parse(JSON.stringify(cont.rightBar));\n                  resource.midBar = JSON.parse(JSON.stringify(cont.midBar));\n                  resource.preview = JSON.parse(JSON.stringify(cont.preview));\n                  resource.kpitoUsername = cont.kpitoUsername;\n                  initResource.call(resource, event.data);\n                })(scope.resources[i]);\n              }\n            });\n          } else if (content instanceof Array) {\n            for (var j in content) {\n              var con = JSON.parse(content[j].content);\n              var getkpis = getAllkpisFromView.call(con);\n              con;\n\n              for (var k in getkpis) {\n                if (kpis.indexOf(getkpis[k]) == -1) {\n                  kpis.push(getkpis[k]);\n                }\n              }\n\n              (function (con) {\n                getKpiValueList(nodes, kpis, function (event) {\n                  for (var i in scope.resources) {\n                    (function (resource) {\n                      if (resource.modelId == con.modelId) {\n                        scope.backgroundImage = con.backgroundImage;\n                        resource.leftBar = JSON.parse(JSON.stringify(con.leftBar));\n                        resource.rightBar = JSON.parse(JSON.stringify(con.rightBar));\n                        resource.midBar = JSON.parse(JSON.stringify(con.midBar));\n                        resource.preview = JSON.parse(JSON.stringify(con.preview));\n                        resource.kpitoUsername = con.kpitoUsername;\n                        initResource.call(resource, event.data);\n                      }\n                    })(scope.resources[i]);\n                  }\n                });\n              })(con);\n            }\n          }\n        })(i, event.data[i]);\n      }\n\n      ;\n    }\n\n    ;\n\n    function getAllkpisFromView() {\n      var kpis = [],\n          cur = this;\n      cur.rightBar = cur.rightBar ? cur.rightBar : {};\n      cur.rightBar.list = cur.rightBar.list ? cur.rightBar.list : [];\n\n      for (var i in cur.rightBar.list) {\n        if (cur.rightBar.list[i].kpi ? cur.rightBar.list[i].kpi.id : false) {\n          if (kpis.indexOf(cur.rightBar.list[i].kpi.id) == -1) {\n            kpis.push(cur.rightBar.list[i].kpi.id);\n          }\n        }\n      }\n\n      cur.midBar = cur.midBar ? cur.midBar : {};\n      cur.midBar.list = cur.midBar.list ? cur.midBar.list : [];\n\n      for (var i in cur.midBar.list) {\n        if (cur.midBar.list[i].kpi ? cur.midBar.list[i].kpi.id : false) {\n          if (kpis.indexOf(cur.midBar.list[i].kpi.id) == -1) {\n            kpis.push(cur.midBar.list[i].kpi.id);\n          }\n        }\n      }\n\n      cur.leftBar = cur.leftBar ? cur.leftBar : {};\n      cur.leftBar.columnA = cur.leftBar.columnA ? cur.leftBar.columnA : {};\n      cur.leftBar.columnA.list = cur.leftBar.columnA.list ? cur.leftBar.columnA.list : [];\n\n      for (var i in cur.leftBar.columnA.list) {\n        if (cur.leftBar.columnA.list[i].kpi ? cur.leftBar.columnA.list[i].kpi.id : false) {\n          if (kpis.indexOf(cur.leftBar.columnA.list[i].kpi.id) == -1) {\n            kpis.push(cur.leftBar.columnA.list[i].kpi.id);\n          }\n        }\n      }\n\n      cur.leftBar.columnB = cur.leftBar.columnB ? cur.leftBar.columnB : {};\n      cur.leftBar.columnB.list = cur.leftBar.columnB.list ? cur.leftBar.columnB.list : [];\n\n      for (var i in cur.leftBar.columnB.list) {\n        if (cur.leftBar.columnB.list[i].kpi ? cur.leftBar.columnB.list[i].kpi.id : false) {\n          if (kpis.indexOf(cur.leftBar.columnB.list[i].kpi.id) == -1) {\n            kpis.push(cur.leftBar.columnB.list[i].kpi.id);\n          }\n        }\n      }\n\n      cur.leftBar.columnC = cur.leftBar.columnC ? cur.leftBar.columnC : {};\n      cur.leftBar.columnC.list = cur.leftBar.columnC.list ? cur.leftBar.columnC.list : [];\n\n      for (var i in cur.leftBar.columnC.list) {\n        if (cur.leftBar.columnC.list[i].kpi ? cur.leftBar.columnC.list[i].kpi.id : false) {\n          if (kpis.indexOf(cur.leftBar.columnC.list[i].kpi.id) == -1) {\n            kpis.push(cur.leftBar.columnC.list[i].kpi.id);\n          }\n        }\n      }\n\n      cur.preview = cur.preview ? cur.preview : {};\n      cur.preview.list = cur.preview.list ? cur.preview.list : [];\n\n      for (var i in cur.preview.list) {\n        if (cur.preview.list[i].kpi ? cur.preview.list[i].kpi.id : false) {\n          if (kpis.indexOf(cur.preview.list[i].kpi.id) == -1) {\n            kpis.push(cur.preview.list[i].kpi.id);\n          }\n        }\n      }\n\n      return kpis;\n    }\n\n    function initResource(kpiValueLists) {\n      var cur = this,\n          deferreds = [];\n\n      if (routeParams.nodeId) {\n        getKpisValue.call(cur, 'leftBar', 'columnA');\n        getAttributes.call(cur, 'leftBar', 'columnA');\n        getFormulas.call(cur, 'leftBar', 'columnA');\n        getKpisValue.call(cur, 'leftBar', 'columnB');\n        getAttributes.call(cur, 'leftBar', 'columnB');\n        getFormulas.call(cur, 'leftBar', 'columnB');\n        getKpisValue.call(cur, 'rightBar');\n        getAttributes.call(cur, 'rightBar');\n        getFormulas.call(cur, 'rightBar');\n        getKpisValue.call(cur, 'midBar');\n        getAttributes.call(cur, 'midBar');\n        getFormulas.call(cur, 'midBar');\n        getCharts.call(cur, 'leftBar', 'columnC');\n        scope.currentRes = cur;\n      } else {\n        cur.show = false;\n\n        cur.onClick = function () {\n          //$(\".active.sidebar-toggle2\").css(\"pointer-events\", \"all\");\n          location.path(\"machine/detail/\" + cur.id);\n        };\n\n        checkVisible.call(cur);\n        deferreds.push(getKpisValue.call(cur, 'preview'));\n        deferreds.push(getAttributes.call(cur, 'preview'));\n        getFormulas.call(cur, 'preview');\n        runFormula.call(cur, cur.preview.title, function (data) {\n          try {\n            cur.preview.showTitle = eval(data);\n          } catch (error) {}\n        });\n        q.all(deferreds).then(function success() {\n          cur.loaded = true;\n        });\n      }\n\n      function checkVisible() {\n        var nodes = [cur.id];\n\n        if (cur.kpitoUsername) {\n          var kpis = [cur.kpitoUsername];\n\n          if (scope.key == '') {\n            cur.show = true;\n          } else {\n            var find = cur.kpisArray.find(function (element) {\n              return element.kpiCode == cur.kpitoUsername && element.nodeId == cur.id;\n            });\n\n            if (find) {\n              cur.show = scope.key == find.value;\n            } else {\n              cur.show = false;\n            }\n          }\n        } else {\n          cur.show = true;\n        }\n      }\n\n      function runFormula(str, callback) {\n        var result = str;\n        var cur = this,\n            defer = q.defer();\n        var kpis = [];\n        var nodes = [cur.id];\n        var kpiRegExp = /\\{kpi\\:\\d*\\}/g;\n\n        if (typeof str == 'string') {\n          var kpisArr = str.match(kpiRegExp);\n\n          for (var i in kpisArr) {\n            kpis.push(parseInt(kpisArr[i].slice(5, -1)));\n          }\n\n          getKpiValueList(nodes, kpis, function (event) {\n            for (var i in kpis) {\n              var find = event.data.find(function (element) {\n                return element.kpiCode == kpis[i] && element.nodeId == cur.id;\n              });\n\n              if (find) {\n                result = result.replace('{kpi:' + find.kpiCode + \"}\", find.value);\n              } else {\n                result = result.replace('{kpi:' + kpis[i] + \"}\", 0);\n              }\n\n              callback(result);\n            }\n          });\n          /*\n          \t */\n        } else {\n          callback('');\n        }\n      }\n\n      function getFormulas()\n      /*attribute*/\n      {\n        var content = arguments[1] ? cur[arguments[0]][arguments[1]] : cur[arguments[0]];\n\n        for (var i in content.list) {\n          (function (attr, val) {\n            if (val.type == 'formula') {\n              runFormula.call(cur, val[val.type], function (data) {\n                val.value = eval(data);\n              });\n            }\n          })(i, content.list[i]);\n        }\n\n        ;\n      }\n\n      function getKpisValue()\n      /*attribute*/\n      {\n        var cur = this;\n        var defer = q.defer();\n        var kpis = [];\n        var content = arguments[1] ? cur[arguments[0]][arguments[1]] : cur[arguments[0]];\n\n        for (var i in content.$attr(\"list\")) {\n          (function (attr, val) {\n            if (val.type == 'kpi' && kpis.indexOf(val.id) == -1) {\n              kpis.push(val.kpi.id);\n            }\n          })(i, content.list[i]);\n        }\n\n        ;\n        var nodes = [cur.id];\n        cur.alertStatus = parseInt(Math.random() * 4);\n        kpisArray = cur.kpisArray;\n        var kpisArr = kpiValueLists;\n        var alert = kpisArr.filter(function (kpi) {\n          return kpi.kpiCode == 999999 && cur.id == kpi.nodeId;\n        });\n\n        if (alert.length > 0) {\n          cur.alertStatus = alert[0].value;\n        } else {\n          cur.alertStatus = 0;\n        }\n\n        for (var i in content.list) {\n          (function (attr, val) {\n            if (val.type == 'kpi') {\n              setValue.call(val, kpisArr, val.valueType);\n            }\n          })(i, content.list[i]);\n        }\n\n        ;\n        defer.resolve(\"success!\");\n\n        function setValue(kpis, valueType) {\n          var _cur_ = this;\n\n          var value = kpis.filter(function (elem) {\n            return elem.kpiCode == _cur_.kpi.id && elem.nodeId == cur.id;\n          });\n\n          if (value[0]) {\n            var kpiDes = kpisArray.find(function (elem) {\n              return elem.id == _cur_.kpi.id;\n            });\n\n            if (kpiDes != undefined) {\n              var rangeObj = calculateRule(kpiDes.range);\n\n              if (_typeof(rangeObj) == \"object\" && !rangeObj instanceof Array) {\n                if (rangeObj[value[0].value]) {\n                  _cur_.value = rangeObj[value[0].value];\n                } else {\n                  _cur_.value = '-';\n                }\n              } else {\n                if (valueType == 'int') {\n                  if (value[0].value) {\n                    _cur_.value = parseInt(value[0].value);\n                  } else {\n                    _cur_.value = \"-\";\n                  }\n                } else {\n                  // \n                  if (value[0].value) {\n                    _cur_.value = value[0].value;\n                  } else {\n                    _cur_.value = \"-\";\n                  }\n                }\n              }\n              /*\n              if (rangeObj[value[0].value] == undefined)\n              {\n              \tif (valueType == 'int') {\n              \t\tif(value[0].value)\n              \t\t{\n              \t\t\t_cur_.value = parseInt(value[0].value);\n              \t\t}\n              \t\telse\n              \t\t{\n              \t\t\t_cur_.value = \"-\";\n              \t\t}\n              \t} else {\n              \t\t// \n              \t\tif(value[0].value)\n              \t\t{\n              \t\t\t_cur_.value = value[0].value;\n              \t\t}\n              \t\telse\n              \t\t{\n              \t\t\t_cur_.value = \"-\";\n              \t\t}\n              \t}\n              }\n              else\n              {\n              \t}\n              */\n\n            }\n          } else {\n            _cur_.value = '';\n          }\n\n          if (_cur_.link) {\n            var calculateLinkage = function calculateLinkage(link) {\n              var regExps = [{\n                replace: /\\{kpi\\:.*}/g,\n                value: /(?!\\{kpi\\:)\\w+\\b(?=\\})/\n              }];\n\n              function getValue(exp) {\n                var result = exp.value.exec(link);\n\n                if (result != null) {\n                  if (result[0] == 'current') {\n                    link = link.replace(exp.replace, \"'\" + _cur_.value + \"'\");\n                  } else {\n                    var kpi = result[0];\n                    var find = kpiValueLists.find(function (element) {\n                      return element.kpiId == kpi;\n                    });\n\n                    if (find) {\n                      link.replace(exp.replace, find.value);\n                    }\n                  }\n                }\n              }\n\n              ;\n\n              for (var i in regExps) {\n                getValue(regExps[i]);\n              }\n\n              location.path(eval(link));\n            };\n\n            _cur_.onClick = function () {\n              if (_cur_.value != '' && _cur_.value != undefined && _cur_.value != null) {\n                calculateLinkage(_cur_.linkage); //location.path(_cur_.linkage);\n              }\n            };\n          }\n        }\n\n        return defer.promise;\n      }\n\n      ;\n\n      function getAttributes() {\n        var cur = this,\n            defer = q.defer();\n        var content = arguments[1] ? cur[arguments[0]][arguments[1]] : cur[arguments[0]];\n        serviceCenterService.attrs.getBymodelId(cur.modelId).then(function (data) {\n          var attributes = data.map(function (element) {\n            element.value = cur.values[element.name];\n            return element;\n          });\n\n          for (var i in content.list) {\n            (function (attr, val) {\n              if (val.type == 'attr') {\n                var find = attributes.filter(function (element) {\n                  return element.id == val.attr.id;\n                });\n\n                if (find.length > 0) {\n                  val.value = find[0].value;\n                } else {\n                  val.value = '';\n                }\n              }\n            })(i, content.list[i]);\n          }\n\n          ;\n          defer.resolve(\"success!\");\n        });\n        return defer.promise;\n      }\n\n      function getCharts() {\n        var cur = this,\n            nodes = [cur.id],\n            kpis = [],\n            minTimespan,\n            sum = 0,\n            size = 0;\n\n        for (var i in cur.leftBar.columnC.list) {\n          (function (attr, val) {\n            if (kpis.indexOf(val.kpi.id) == -1) {\n              kpis.push(val.kpi.id);\n            }\n          })(i, cur.leftBar.columnC.list[i]);\n        }\n\n        ;\n        var kpiQueryModel = {\n          category: 'time',\n          isRealTimeData: true,\n          timePeriod: 8 * 24 * 3600 * 1000,\n          nodeIds: nodes,\n          kpiCodes: kpis,\n          startTime: null,\n          endTime: null,\n          timeRange: \"\",\n          statisticType: \"psiot\",\n          condList: []\n        };\n        var param = [\"kpi\", kpiQueryModel];\n        var kpisData = kpisArray.reduce(function (prev, next) {\n          var kpiCode = next.id;\n\n          if (prev[kpiCode] == undefined) {\n            prev[kpiCode] = next;\n          }\n\n          return prev;\n        }, {});\n        Object.defineProperty(kpisData, \"minTimespan\", {\n          enumerable: false\n        });\n\n        for (var i in kpisData) {\n          (function (kpi) {\n            kpi.valuelist = [];\n          })(kpisData[i]);\n        }\n\n        minTimespan = 23 * 3600 * 1000;\n        kpiDataService.getValueList(param, function (event) {\n          var myDate = [];\n\n          for (var i in kpisData) {\n            (function (kpiCode, val) {\n              for (var i = 0; i < 7; i++) {\n                var date = new Date(new Date().getTime() - (7 - i) * 24 * 3600 * 1000);\n                var year = date.getYear();\n                var month = date.getMonth();\n                var dt = date.getDate();\n                var find = event.data.find(function (element) {\n                  return function (year, month, date) {\n                    var cur = this;\n                    return cur.getYear() == year && cur.getMonth() == month && cur.getDate() == date && kpiCode == element.kpiCode;\n                  }.call(new Date(element.arisingTime.split(\"T\")[0].replace(/-/g, \"/\")), year, month, dt);\n                });\n                myDate.push({\n                  kpiCode: kpiCode,\n                  value: find ? find.value : undefined,\n                  timeStamp: date.getTime()\n                });\n              }\n\n              ;\n            })(i, kpisData[i]);\n          }\n\n          var data = myDate.reduce(process, kpisData);\n          var inx = 0;\n\n          for (var i in cur.leftBar.columnC.list) {\n            (function (attr, val) {\n              var obj = data[val.kpi.id];\n              obj.valuelist = obj.valuelist.reduce(reduceBytime, []);\n              var optionDefault = {\n                animation: true,\n                grid: {\n                  top: '10%',\n                  left: '5%',\n                  width: \"90%\",\n                  height: \"80%\",\n                  containLabel: false\n                },\n                title: {\n                  show: false,\n                  padding: 30,\n                  text: '草莓大棚温度变化',\n                  \"textStyle\": {\n                    \"fontWeight\": \"bold\",\n                    \"fontSize\": 16\n                  }\n                },\n                tooltip: {\n                  trigger: 'axis'\n                },\n                legend: {\n                  data: []\n                },\n                calculable: true,\n                xAxis: [{\n                  type: 'category',\n                  boundaryGap: false,\n                  data: ['', '', '', '', '', '', ''],\n                  \"axisLine\": {\n                    \"lineStyle\": {\n                      \"color\": \"#b0b0b0\",\n                      \"width\": 1\n                    }\n                  },\n                  axisLabel: {\n                    \"show\": false,\n                    \"textStyle\": {}\n                  },\n                  splitLine: {\n                    \"lineStyle\": {\n                      \"color\": \"rgb(239, 239, 239)\",\n                      \"width\": 1\n                    }\n                  },\n                  \"axisTick\": {\n                    \"show\": false,\n                    \"lineStyle\": {}\n                  }\n                }],\n                yAxis: [{\n                  show: true,\n                  type: 'value',\n                  splitNumber: 4,\n                  boundaryGap: true,\n                  min: 0,\n                  \"axisLine\": {\n                    \"lineStyle\": {\n                      \"color\": \"#b0b0b0\",\n                      \"width\": 1\n                    }\n                  },\n                  splitLine: {\n                    \"lineStyle\": {\n                      \"color\": \"rgb(239, 239, 239)\",\n                      \"width\": 1\n                    }\n                  },\n                  axisLabel: {\n                    \"show\": false,\n                    \"textStyle\": {}\n                  },\n                  \"axisTick\": {\n                    \"show\": false,\n                    \"lineStyle\": {}\n                  }\n                }],\n                series: [{\n                  name: '数据',\n                  type: 'line',\n                  data: [],\n                  itemStyle: {\n                    normal: {\n                      color: function () {\n                        if (inx % 2 == 0) {\n                          return \"#d99a37\";\n                        } else {\n                          return \"#c25262\";\n                        }\n                      }()\n                    }\n                  },\n                  lineStyle: {\n                    normal: {\n                      color: function () {\n                        if (inx % 2 == 0) {\n                          return \"#d99a37\";\n                        } else {\n                          return \"#c25262\";\n                        }\n                      }()\n                    }\n                  },\n                  areaStyle: {\n                    normal: {\n                      color: function (kpiCode) {\n                        if (inx % 2 == 0) {\n                          return \"#d99a37\";\n                        } else {\n                          return \"#c25262\";\n                        }\n                      }()\n                    }\n                  }\n                }]\n              };\n              val.option = renderOption.call(obj, optionDefault);\n              inx++;\n            })(i, cur.leftBar.columnC.list[i]);\n          }\n\n          ;\n        });\n\n        function renderOption(optionDefault) {\n          var cur = this;\n          optionDefault.xAxis[0].data = cur.valuelist.map(function (element) {\n            return $formatDate(new Date(element.timeStamp), '月日');\n          });\n          optionDefault.legend.data = [];\n          optionDefault.series[0].name = cur.label;\n          optionDefault.series[0].data = cur.valuelist.map(function (element) {\n            return element.value;\n          });\n          return optionDefault;\n        }\n\n        ;\n\n        function reduceBytime(prev, next) {\n          var result = prev;\n          sum += parseInt(next.value);\n          size++;\n\n          if (result.length > 0) {\n            var last = result[result.length - 1];\n\n            if (next.timeStamp - last.timeStamp > minTimespan) {\n              next.value = parseInt(sum / size);\n              sum = 0;\n              size = 0;\n              result.push(next);\n            }\n          } else {\n            sum = 0;\n            size = 0;\n            result.push(next);\n          }\n\n          return result;\n        }\n\n        ;\n\n        function process(prev, next) {\n          var kpiCode = next.kpiCode;\n          var result = prev;\n\n          if (!next.timeStamp) {\n            next.timeStamp = newDateJson(next.arisingTime).getTime();\n          }\n\n          if (result[kpiCode].valuelist) {\n            result[kpiCode].valuelist.push(next);\n          } else {\n            result[kpiCode].valuelist = [next];\n          }\n\n          return result;\n        }\n      }\n    }\n  }]);\n  controllers.initController('ViewMachineEdit', ['$scope', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'SwSocket', 'Info', 'viewFlexService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', '$q', 'solutionUIService', '$rootScope', 'serviceCenterService', function (scope, routeParams, timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, SwSocket, Info, viewFlexService, unitService, growl, userDomainService, userEnterpriseService, q, solutionUIService, rootScope, serviceCenterService) {\n    var handleView, currentView, solutionId, modelId, viewId;\n    solutionId = typeof routeParams.solutionId == \"string\" ? parseInt(routeParams.solutionId) : undefined;\n    modelId = typeof routeParams.modelId == \"string\" ? parseInt(routeParams.modelId) : undefined;\n    rootScope.showBtn = true;\n\n    scope.iconSelect = function () {\n      scope.fronticons = [{\n        label: '提花机标签',\n        value: 'images/machine/iconfont.png'\n      }, {\n        label: '压缩机标签',\n        value: 'images/machine/iconfront2.svg'\n      }];\n    };\n\n    scope.iconClose = function () {\n      delete scope.fronticons;\n    };\n\n    scope.prevPanel = {\n      visible: false,\n      show: function show() {\n        this.visible = true;\n      },\n      hide: function hide() {\n        this.visible = false;\n      }\n    };\n    scope.leftPartA = {\n      visible: false,\n      show: function show() {\n        this.visible = true;\n      },\n      hide: function hide() {\n        this.visible = false;\n      }\n    };\n    scope.leftPartB = {\n      visible: false,\n      show: function show() {\n        this.visible = true;\n      },\n      hide: function hide() {\n        this.visible = false;\n      }\n    };\n    scope.leftPartC = {\n      visible: false,\n      show: function show() {\n        this.visible = true;\n      },\n      hide: function hide() {\n        this.visible = false;\n      }\n    };\n    scope.midPart = {\n      visible: false,\n      show: function show() {\n        this.visible = true;\n      },\n      hide: function hide() {\n        this.visible = false;\n      }\n    };\n    scope.rightPart = {\n      visible: false,\n      show: function show() {\n        this.visible = true;\n      },\n      hide: function hide() {\n        this.visible = false;\n      }\n    };\n    scope.bgImages = [{\n      value: 'images/machine/machine.png',\n      label: '提花机图片'\n    }, {\n      value: 'images/machine/aineng1.png',\n      label: '艾能机械1'\n    }, {\n      value: 'images/machine/aineng.png',\n      label: '艾能机械2'\n    }];\n\n    rootScope.saveServiceView = function () {\n      scope.saveAndExit();\n    };\n\n    rootScope.previewMode = false;\n\n    rootScope.previewServiceView = function () {\n      rootScope.previewMode = !rootScope.previewMode;\n    };\n\n    scope.saveAndExit = function () {\n      try {\n        var result = {};\n\n        if (scope.kpitoUsername) {\n          result.kpitoUsername = scope.kpitoUsername.id;\n        }\n\n        result.modelId = scope.model.id;\n        result.backgroundImage = scope.backgroundImage;\n        result.preview = getData.call(scope.preview);\n        result.preview.icon = scope.preview.icon;\n        result.leftBar = {};\n        Object.defineProperty(scope.leftBar, \"title\", {\n          enumerable: false\n        });\n        result.leftBar.title = scope.leftBar.title;\n\n        for (var i in scope.leftBar) {\n          (function (attr, val) {\n            if (typeof val != 'function') {\n              result.leftBar[attr] = getData.call(val);\n            }\n          })(i, scope.leftBar[i]);\n        }\n\n        result.rightBar = getData.call(scope.rightBar);\n        result.midBar = getData.call(scope.midBar);\n        handleView(result);\n      } catch (err) {\n        alert(err);\n      }\n    };\n\n    function getData() {\n      var cur = this;\n      var result = {\n        list: cur.list.map(function (element) {\n          var result = {};\n          result.type = element.type;\n          result.label = element.label;\n\n          if (element.link) {\n            result.linkage = element.linkage;\n          }\n\n          if (element.showWhenCustomerA != undefined) {\n            result.showWhenCustomerA = element.showWhenCustomerA;\n          }\n\n          if (element.link != undefined) {\n            result.link = element.link;\n          }\n\n          if (element.icon) {\n            result.icon = element.icon;\n          }\n\n          if (result.type != 'formula') {\n            if (element[result.type] == undefined) {\n              throw '有未选项目存在，保存失败。';\n            } else {\n              result[result.type] = {\n                id: element[result.type].id,\n                label: element[result.type].label\n              };\n            }\n          } else {\n            result[result.type] = element[result.type];\n          }\n\n          return result;\n        })\n      };\n\n      if (cur.title) {\n        result.title = cur.title;\n      }\n\n      return result;\n    }\n\n    function pushData(element) {\n      var cur = this;\n\n      element.remove = function (elem) {\n        cur.list = cur.list.filter(function (el) {\n          return elem != el;\n        });\n      };\n\n      cur.list.push(element);\n    }\n\n    function pushData_rb(element) {\n      var self = this;\n      element.link = false;\n      element.showWhenCustomerA = true;\n\n      element.remove = function (elem) {\n        self.list = self.list.filter(function (el) {\n          return elem != el;\n        });\n      };\n\n      element.open = function () {\n        var cur = this;\n        cur.show = true;\n      };\n\n      element.select = function (icon) {\n        var cur = this;\n        cur.show = false;\n        cur.icon = icon;\n      };\n\n      element.linkClick = function () {\n        cur.link = !cur.link;\n      };\n\n      self.list.push(element);\n    }\n\n    scope.leftBar = {\n      columnA: {\n        list: []\n      },\n      columnB: {\n        list: []\n      },\n      columnC: {\n        list: []\n      }\n    };\n\n    for (var i in scope.leftBar) {\n      (function (attr, val) {\n        Object.defineProperty(val, \"pushData\", {\n          writable: true,\n          enumerable: false,\n          value: pushData\n        });\n      })(i, scope.leftBar[i]);\n    }\n\n    scope.icons = ['ps-edit', ' ps-back', 'ps-mushroom', 'ps-planting', 'ps-current_production', 'ps-estimated_output', 'ps-daily_output', 'ps-duration', 'ps-sandglass', 'ps-task', 'ps-current_production_p', 'ps-pattern', 'ps-number', 'ps-air-humidity', 'ps-air-temperature', 'ps-camera', 'ps-sunshine', 'ps-video-camera', 'ps-water', 'ps-fan', 'ps-electric_motor02', 'ps-electric_motor', 'ps-Co2', 'ps-soil_temperature', 'ps-soil_humidity', 'ps-irrigation', 'ps-spraying', 'ps-chart_brokenline', 'ps-userinfo', 'ps-user', 'ps-group', 'ps-center', 'ps-server', 'ps-app'];\n    scope.midBar = {\n      title: '提花机生产信息',\n      list: [],\n      pushData: pushData\n    };\n    scope.rightBar = {\n      title: '提花机生产信息',\n      list: [],\n      pushData: pushData_rb\n    };\n    Object.defineProperty(scope.rightBar, \"pushData\", {\n      writable: true,\n      enumerable: false\n    });\n    Object.defineProperty(scope.midBar, \"pushData\", {\n      writable: true,\n      enumerable: false\n    });\n\n    scope.wholeClick = function () {\n      for (var i in scope.rightBar.list) {\n        scope.rightBar.list[i].show = false;\n      }\n    };\n\n    scope.preview = {\n      title: '',\n      list: []\n    };\n    Object.defineProperty(scope.preview, \"pushData\", {\n      writable: true,\n      enumerable: false,\n      value: pushData\n    });\n    var $kpis = Object.create({\n      models: [],\n      valueCached: [],\n      getBymodelId: function getBymodelId(modelId) {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.models.indexOf(modelId) != -1) {\n          var find = cur.valueCached.filter(function (kpi) {\n            return kpi.modelId == modelId;\n          });\n          deferred.resolve(find);\n        } else {\n          resourceUIService.getKpisByModelId([modelId], function success(event) {\n            try {\n              if (event.data) {\n                var list = [];\n\n                for (var i in event.data) {\n                  event.data[i].modelId = modelId;\n                }\n\n                cur.models.push(modelId);\n                cur.valueCached = cur.valueCached.filter(function (kpi) {\n                  return kpi.modeId != modelId;\n                });\n                cur.valueCached = cur.valueCached.concat(event.data);\n                deferred.resolve(event.data);\n              } else {\n                throw \"data is undefined !!\";\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          }, function error(err) {});\n        }\n\n        return deferred.promise;\n      }\n    });\n    var $attr = Object.create({\n      models: [],\n      valueCached: [],\n      getBymodelId: function getBymodelId(modelId) {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.models.indexOf(modelId) != -1) {\n          var find = cur.valueCached.filter(function (attr) {\n            return attr.modelId == modelId;\n          });\n          deferred.resolve(find);\n        } else {\n          serviceCenterService.attrs.getBymodelId(modelId).then(function (data) {\n            var list = [];\n\n            for (var i in data) {\n              data[i].modelId = modelId;\n            }\n\n            cur.models.push(modelId);\n            cur.valueCached = cur.valueCached.filter(function (attr) {\n              return attr.modeId != modelId;\n            });\n            cur.valueCached = cur.valueCached.concat(data);\n            deferred.resolve(data);\n          });\n        }\n\n        return deferred.promise;\n      }\n    });\n\n    if (solutionId) {\n      solutionUIService.getServiceViewContent(solutionId, 0, modelId, function (event) {\n        try {\n          if (event.code == '0') {\n            currentView = event.data;\n            start();\n          } else {\n            throw new Error(event.message);\n          }\n        } catch (err) {}\n      });\n    } else {\n      viewFlexService.getAllMyViews(function (event) {\n        var find = event.data.find(function (element) {\n          if (element.viewType == 'modelservice') {\n            var dt = JSON.parse(element.content);\n            return dt.modelId == modelId;\n          } else {\n            return false;\n          }\n        });\n        viewId = find ? find.viewId : undefined;\n        currentView = find ? find.content : undefined;\n        start();\n      });\n    }\n\n    function start() {\n      scope.model = {\n        id: modelId\n      };\n      var cont,\n          deferreds = [];\n\n      if (typeof currentView == 'string') {\n        cont = JSON.parse(currentView);\n      } else {\n        cont = {};\n      }\n\n      deferreds.push(getKpis.call(scope.model));\n      deferreds.push(getAttr.call(scope.model));\n      q.all(deferreds).then(function (event) {\n        if (_typeof(scope.model) == \"object\" && scope.model != null) {\n          scope.kpitoUsername = scope.model['kpi'].find(function (element) {\n            return element.id == cont.kpitoUsername;\n          });\n        }\n\n        scope.preview = cont.preview ? cont.preview : {\n          title: '',\n          list: []\n        };\n        scope.leftBar = cont.leftBar ? cont.leftBar : {\n          columnA: {\n            title: '机台配置信息',\n            list: []\n          },\n          columnB: {\n            title: '机台配置信息',\n            list: []\n          },\n          columnC: {\n            list: []\n          }\n        };\n        scope.rightBar = cont.rightBar ? cont.rightBar : {\n          title: '',\n          list: []\n        };\n        scope.midBar = cont.midBar ? cont.midBar : {\n          title: '',\n          list: []\n        };\n        scope.backgroundImage = cont.backgroundImage ? cont.backgroundImage : 'images/machine/machine.png';\n\n        for (var i in scope.preview.list) {\n          (function (index, element) {\n            getContent.call(element, scope.preview);\n          })(i, scope.preview.list[i]);\n        }\n\n        for (var j in scope.leftBar) {\n          (function (attr, val) {\n            for (var i in val.list) {\n              (function (index, element) {\n                getContent.call(element, val);\n              })(i, val.list[i]);\n            }\n\n            ;\n\n            if (_typeof(val) == 'object') {\n              Object.defineProperty(val, \"pushData\", {\n                writable: true,\n                enumerable: false,\n                value: pushData\n              });\n            }\n          })(j, scope.leftBar[j]);\n        }\n\n        for (var k in scope.rightBar.list) {\n          (function (index, element) {\n            getContent.call(element, scope.rightBar);\n\n            element.remove = function (elem) {\n              scope.rightBar.list = scope.rightBar.list.filter(function (el) {\n                return elem != el;\n              });\n            };\n\n            element.open = function () {\n              var cur = this;\n              cur.show = true;\n            };\n\n            element.select = function (icon) {\n              var cur = this;\n              cur.show = false;\n              cur.icon = icon;\n            };\n\n            element.linkClick = function () {\n              cur.link = !cur.link;\n            };\n          })(k, scope.rightBar.list[k]);\n        }\n\n        for (var k in scope.midBar.list) {\n          (function (index, element) {\n            getContent.call(element, scope.midBar);\n\n            element.remove = function (elem) {\n              scope.midBar.list = scope.midBar.list.filter(function (el) {\n                return elem != el;\n              });\n            };\n          })(k, scope.midBar.list[k]);\n        }\n\n        function getContent(target) {\n          var cur = this;\n          var type = cur.type;\n\n          if (type != 'formula') {\n            cur[type] = scope.model[type].find(function (elem) {\n              if (cur[type]) {\n                return elem.id == cur[type].id;\n              } else {\n                return false;\n              }\n            });\n          }\n\n          cur.remove = function (elem) {\n            target.list = target.list.filter(function (el) {\n              return elem != el;\n            });\n          };\n        }\n\n        Object.defineProperty(scope.preview, \"pushData\", {\n          writable: true,\n          enumerable: false,\n          value: pushData\n        });\n        Object.defineProperty(scope.rightBar, \"pushData\", {\n          writable: true,\n          enumerable: false,\n          value: pushData_rb\n        });\n        Object.defineProperty(scope.midBar, \"pushData\", {\n          writable: true,\n          enumerable: false,\n          value: pushData_rb\n        });\n\n        if (solutionId) {\n          handleView = function handleView(data) {\n            var content = JSON.stringify(data); //solutionUIService.saveServiceViewContent(solutionId, 0, content, function(event){\n\n            solutionUIService.saveServiceViewContent(solutionId, 0, modelId, content, function (event) {\n              try {\n                if (event.code == '0') {\n                  window.open('../app-ac/index.html#/myView', '_self');\n                } else {\n                  throw new Error(event.message);\n                }\n              } catch (err) {}\n            });\n          };\n        } else {\n          handleView = function handleView(data) {\n            data.modelId = modelId;\n            var param = {\n              originalViewId: 0,\n              viewTitle: \"modelservice\",\n              viewName: \"modelservice\",\n              viewType: \"modelservice\",\n              content: JSON.stringify(data)\n            };\n\n            if (viewId) {\n              param.viewId = viewId;\n              viewFlexService.updateView(param, function (event) {\n                window.open('../app-oc/index.html#/resource_type', '_self');\n              });\n            } else {\n              viewFlexService.addView(param, function (event) {\n                window.open('../app-oc/index.html#/resource_type', '_self');\n              });\n            }\n          };\n        }\n      });\n    }\n\n    function getModels() {\n      var deferred = q.defer();\n      solutionUIService.getModelsByGroupId(solutionId, 0, function (event) {\n        try {\n          if (event.code == '0') {\n            scope.allModels = event.data.map(function (element) {\n              element.onChange = onChange;\n              return element;\n            });\n            scope.model.onChange();\n            deferred.resolve('success!!');\n          } else {\n            throw event.message;\n          }\n        } catch (err) {\n          deferred.reject(err);\n        }\n      });\n      return deferred.promise;\n    }\n\n    ;\n\n    function onChange() {\n      var cur = this;\n      getKpis.call(cur);\n      getAttr.call(cur);\n    }\n\n    ;\n\n    function getKpis() {\n      var deferred = q.defer();\n      var cur = this;\n\n      if (_typeof(cur) == \"object\" && cur != null) {\n        $kpis.getBymodelId(cur.id).then(function (data) {\n          cur.kpi = data.map(function (element) {\n            return {\n              id: element.id,\n              label: element.label\n            };\n          });\n          deferred.resolve(\"success\");\n        });\n      } else {\n        deferred.resolve(\"empty\");\n      }\n\n      return deferred.promise;\n    }\n\n    ;\n\n    function getAttr() {\n      var deferred = q.defer();\n      var cur = this;\n\n      if (_typeof(cur) == \"object\" && cur != null) {\n        $attr.getBymodelId(cur.id).then(function (data) {\n          cur.attr = data.map(function (element) {\n            return {\n              id: element.id,\n              label: element.label\n            };\n          });\n          deferred.resolve(\"success\");\n        });\n      } else {\n        deferred.resolve(\"empty\");\n      }\n\n      return deferred.promise;\n    }\n\n    ;\n  }]);\n});"],"sourceRoot":"/source/"}