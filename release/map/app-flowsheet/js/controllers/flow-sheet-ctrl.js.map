{"version":3,"sources":["app-flowsheet/js/controllers/flow-sheet-ctrl.js"],"names":["define","controllers","keyboardJS","joint","controller","$scope","workflowService","workflowDefinitionService","Info","$routeParams","$compile","$rootScope","userEnterpriseService","viewFlexService","resourceUIService","kpiDataService","SwSocket","growl","timeout","loc","paper","graph","paperScroller","stencil","selection","inspector","selectionView","commandManager","viewId","clear","displayMode","selectedView","shiftHold","backspaceHold","historyView","userGroupList","userList","userAryList","userRoleList","location","hash","search","displayModeLink","arrowheadMarkup","toolMarkup","vertexMarkup","selectedItem","cell","userIds","userGroupIds","roleIds","taskType","taskTypeParam","userType","bind","e","evenType","initialization","scope","element","interactive","dia","Graph","type","Paper","width","height","gridSize","perpendicularLinks","model","markAvailable","defaultLink","shapes","bpmn","Flow","validateConnection","cellViewS","magnetS","cellViewT","magnetT","end","linkView","LinkView","embeddingMode","frontParentOnly","validateEmbedding","childView","parentView","Pool","ui","PaperScroller","autoResizePaper","padding","$el","css","$","append","el","components","scroller","layout","GridLayout","columnWidth","options","columns","rowHeight","resizeToFit","dy","dx","Stencil","dropAnimation","groups","data","on","render","_","each","groupName","load","getGraph","getPaper","fitToContent","Backbone","Collection","SelectionView","evt","x","y","startSelecting","cancelSelection","startPanning","$apply","elementView","get","target","closest","cellView","ctrlKey","metaKey","Link","createSelectionBox","add","destroySelectionBox","findViewByModel","reset","without","oncontextmenu","preventDefault","contains","initBatchCommand","invoke","storeBatchCommand","is","$inspectorHolder","openCellTools","Halo","removeHandles","id","userIdsAry","$watch","n","o","s","prop","userTypeAry","toString","split","length","String","Number","content","contentAry","dataExtractExpression","remove","inspectorDefs","Inspector","inputs","commonInspectorInputs","commonInspectorGroups","this","$label","Tooltip","right","direction","html","Element","top","CommandManager","undo","redo","commander","setDimensions","baseWidth","baseHeight","mould","mouldType","i","fromJSON","view","setGrid","backgroundImage","getGridBackgroundImage","bgcolor","bgimage","color","canvas","context","getContext","beginPath","rect","fillStyle","fill","toDataURL","save4Json","viewjson","toJSON","validate","cells","forEach","warning","userExpression","JSONstring","JSON","stringify","param","domainPath","name","desc","viewContent","createTime","updateTime","saveWorkflowDefinition","returnObj","code","success","err","alert","windowName","uniqueId","window","open","document","write","toFront","toBack","embed","parentCell","models","attributes","z","unembed","embeds","cellid","getCell","queryEnterpriseGroup","ary","list","groupID","push","queryEnterpriseUser","userID","userName","queryEnterpriseRole","roleID","roleName","getWorkflowById","parse","jQuery","extend","attrs","display","init","getWorkflowDefinitionById"],"mappings":"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","file":"app-flowsheet/js/controllers/flow-sheet-ctrl.js","sourcesContent":["define(['controllers/controllers', 'keyboardJS', 'rappid-joint'], function (controllers, keyboardJS, joint) {\n  'use strict';\n  /**\n   * 流程图控制器\n   */\n\n  controllers.controller('flowCtrl', ['$scope', 'workflowService', 'workflowDefinitionService', 'Info', '$routeParams', '$compile', '$rootScope', 'userEnterpriseService', 'viewFlexService', 'resourceUIService', 'kpiDataService', 'SwSocket', 'growl', '$timeout', '$location', function ($scope, workflowService, workflowDefinitionService, Info, $routeParams, $compile, $rootScope, userEnterpriseService, viewFlexService, resourceUIService, kpiDataService, SwSocket, growl, timeout, loc) {\n    var paper, graph, paperScroller, stencil, selection, inspector, selectionView, clipboard, commandManager, navigator;\n    var viewId = $routeParams.viewId;\n\n    var clear = function clear() {};\n\n    $scope.selectedView = {};\n    var displayMode = false;\n    var shiftHold = false;\n    var backspaceHold = false;\n    var historyView = false;\n    $scope.userGroupList = '';\n    $scope.userList = '';\n    $scope.userAryList = '';\n    $scope.userRoleList = '';\n\n    if (location.hash.search(\"#/displayView\") > -1) {\n      displayMode = true;\n    }\n\n    ;\n\n    if (location.hash.search(\"#/historyView\") > -1) {\n      historyView = true;\n    }\n\n    ;\n    var displayModeLink = {\n      'arrowheadMarkup': '<g></g>',\n      'toolMarkup': '<g></g>',\n      'vertexMarkup': '<g></g>'\n    };\n    $scope.selectedItem = {\n      cell: null,\n      userIds: 0,\n      userGroupIds: 0,\n      roleIds: 0,\n      taskType: 0,\n      taskTypeParam: \"user\",\n      userType: \"\"\n    };\n    keyboardJS.bind('shift', function (e) {\n      shiftHold = true;\n    }, function (e) {\n      shiftHold = false;\n    });\n    keyboardJS.bind('shift', null, function (e) {\n      shiftHold = false;\n    });\n    keyboardJS.bind('backspace', function (e) {\n      backspaceHold = true;\n    }, function (e) {\n      backspaceHold = false;\n    });\n    keyboardJS.bind('backspace', null, function (e) {\n      backspaceHold = false;\n    });\n    $scope.evenType = \"start\";\n    /**\n     * 获取用户\n     */\n\n    function getUser() {\n      userEnterpriseService.queryEnterpriseUser(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data.length != 0) {\n            var list = {};\n            var ary = [];\n\n            for (var i in returnObj.data) {\n              list = {};\n              list[\"id\"] = returnObj.data[i].userID;\n              list[\"name\"] = returnObj.data[i].userName;\n              ary.push(list);\n            }\n\n            $scope.userAryList = ary;\n          } else {\n            $scope.userAryList = [];\n          }\n        }\n      });\n    }\n\n    ;\n    /**\n     * 获取角色\n     */\n\n    function getRole() {\n      userEnterpriseService.queryEnterpriseRole(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data.length != 0) {\n            var list = {};\n            var ary = [];\n\n            for (var i in returnObj.data) {\n              list = {};\n              list[\"id\"] = returnObj.data[i].roleID;\n              list[\"name\"] = returnObj.data[i].roleName;\n              ary.push(list);\n            }\n\n            $scope.userRoleList = ary;\n          } else {\n            $scope.userRoleList = [];\n          }\n        }\n      });\n    }\n\n    ;\n    /**\n     * 获取用户组\n     */\n\n    function getUserGroup() {\n      userEnterpriseService.queryEnterpriseGroup(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data.length != 0) {\n            var ary = [];\n\n            for (var i in returnObj.data) {\n              var list = {};\n              list[\"id\"] = returnObj.data[i].groupID;\n              list[\"name\"] = returnObj.data[i].groupName;\n              ary.push(list);\n            }\n\n            $scope.userGroupList = ary;\n          } else {\n            $scope.userGroupList = [];\n          }\n        }\n      });\n    }\n\n    ;\n\n    var showViewContent = function showViewContent(scope, viewId) {\n      if (historyView) {\n        workflowService.getWorkflowById(viewId, function (returnObj) {\n          if (returnObj.code == 0) {\n            scope.selectedView = returnObj.data;\n            scope.data.viewContent = $scope.selectedView.viewContent;\n            scope.selectedView[\"inspector\"] = false;\n\n            if (returnObj.data.viewContent) {\n              var content = JSON.parse(returnObj.data.viewContent);\n\n              if (displayMode) {\n                for (var i = content.cells.length - 1; i > -1; i--) {\n                  if (content.cells[i].type == \"bpmn.Flow\") {\n                    jQuery.extend(content.cells[i], displayModeLink);\n                    content.cells[i].attrs['.connection-wrap'] = {\n                      display: 'none'\n                    };\n                  }\n                }\n              }\n\n              scope.components.graph.fromJSON(content);\n              scope.components.paper.options.gridSize = content.gridSize;\n              scope.components.paper.options.width = content.width;\n              scope.components.paper.options.height = content.height;\n              scope.data.bgimage = content.bgimage;\n              scope.data.bgcolor = content.bgcolor;\n              scope.data.mouldType = \"\";\n              scope.data.width = content.width;\n              scope.data.height = content.height;\n              scope.components.commander.setDimensions();\n              scope.components.commander.setGrid();\n            } else {\n              scope.components.graph.fromJSON(scope.data.init);\n            }\n          }\n        });\n      } else {\n        workflowDefinitionService.getWorkflowDefinitionById(viewId, function (returnObj) {\n          if (returnObj.code == 0) {\n            scope.selectedView = returnObj.data;\n            scope.data.viewContent = $scope.selectedView.viewContent;\n            scope.selectedView[\"inspector\"] = false;\n\n            if (returnObj.data.viewContent) {\n              var content = JSON.parse(returnObj.data.viewContent);\n\n              if (displayMode) {\n                for (var i = content.cells.length - 1; i > -1; i--) {\n                  if (content.cells[i].type == \"bpmn.Flow\") {\n                    jQuery.extend(content.cells[i], displayModeLink);\n                    content.cells[i].attrs['.connection-wrap'] = {\n                      display: 'none'\n                    };\n                  }\n                }\n              }\n\n              scope.components.graph.fromJSON(content);\n              scope.components.paper.options.gridSize = content.gridSize;\n              scope.components.paper.options.width = content.width;\n              scope.components.paper.options.height = content.height;\n              scope.data.bgimage = content.bgimage;\n              scope.data.bgcolor = content.bgcolor;\n              scope.data.mouldType = \"\";\n              scope.data.width = content.width;\n              scope.data.height = content.height;\n              scope.components.commander.setDimensions();\n              scope.components.commander.setGrid();\n            } else {\n              scope.components.graph.fromJSON(scope.data.init);\n            }\n          }\n        });\n      }\n    };\n\n    $scope.initialization = [function initializePaper(scope, element) {\n      var interactive = false;\n\n      if (!displayMode) {\n        interactive = true;\n      }\n\n      graph = new joint.dia.Graph({\n        type: 'bpmn'\n      });\n      paper = new joint.dia.Paper({\n        width: 1200,\n        height: 700,\n        gridSize: 10,\n        perpendicularLinks: true,\n        model: graph,\n        markAvailable: true,\n        interactive: interactive,\n        defaultLink: new joint.shapes.bpmn.Flow(),\n        validateConnection: function validateConnection(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n          // don't allow loop links\n          if (cellViewS == cellViewT) return false;\n          var view = end === 'target' ? cellViewT : cellViewS; // don't allow link to link connection\n\n          if (view instanceof joint.dia.LinkView) return false;\n          return true;\n        },\n        embeddingMode: true,\n        frontParentOnly: false,\n        validateEmbedding: function validateEmbedding(childView, parentView) {\n          var Pool = joint.shapes.bpmn.Pool;\n          return parentView.model instanceof Pool && !(childView.model instanceof Pool);\n        }\n      });\n      paperScroller = new joint.ui.PaperScroller({\n        paper: paper,\n        autoResizePaper: true,\n        padding: 0\n      });\n      paperScroller.$el.css('background-color', \"hsl(0, 0%, 100%)\");\n      $('#paper-container1', element).append(paperScroller.el);\n      scope.components.paper = paper;\n      scope.components.scroller = paperScroller;\n      scope.components.graph = graph;\n    }, // 创建模板\n    function initializeStencil(scope, element) {\n      function layout(graph) {\n        joint.layout.GridLayout.layout(graph, {\n          columnWidth: stencil.options.width / 2 - 10,\n          columns: 2,\n          rowHeight: 80,\n          resizeToFit: true,\n          dy: 10,\n          dx: 10\n        });\n      }\n\n      stencil = new joint.ui.Stencil({\n        graph: graph,\n        paper: paper,\n        width: 230,\n        dropAnimation: true,\n        groups: scope.data.stencil.groups,\n        search: scope.data.stencil.search\n      }).on('filter', layout);\n      $('.stencil-container', element).append(stencil.render().el);\n\n      _.each(scope.data.stencil.shapes, function (shapes, groupName) {\n        stencil.load(shapes, groupName);\n        layout(stencil.getGraph(groupName));\n        stencil.getPaper(groupName).fitToContent(1, 1, 10);\n      });\n\n      scope.components.stencil = stencil;\n    }, // 创建选择\n    function initializeSelection(scope, element) {\n      selection = new Backbone.Collection();\n      selectionView = new joint.ui.SelectionView({\n        paper: paper,\n        graph: graph,\n        model: selection\n      }); // Initiate selecting when the user grabs the blank area of the paper while the Shift key is pressed.\n      // 当shift键被按下时，启动用户在页面的空白区域时开始选择。\n      // Otherwise, initiate paper pan.\n      // 否则，页面默认功能\n\n      paper.on('blank:pointerdown', function (evt, x, y) {\n        //          if(_.contains(keyboardJS.getContext(), 'shift')) {\n        if (shiftHold) {\n          selectionView.startSelecting(evt, x, y);\n          scope.selectedView.inspector = true;\n          scope.$apply();\n        } else {\n          selectionView.cancelSelection();\n          paperScroller.startPanning(evt, x, y);\n          scope.selectedView.inspector = false;\n          scope.$apply();\n        }\n      });\n      paper.on('element:pointerup', function (elementView, evt) {\n        var pool = elementView.model;\n\n        if (pool.get('type') === 'bpmn.Activity') {\n          var lanePath = $(evt.target).closest('.lane').data('lane-path') || 'lanes';\n        }\n      });\n      paper.on('cell:pointerdown', function (cellView, evt) {\n        // Select an element if CTRL/Meta key is pressed while the element is clicked.\n        // 如果Ctrl /Meta 键是被按下，当元素被点击时，添加到selectionBox中\n        if ((evt.ctrlKey || evt.metaKey) && !(cellView.model instanceof joint.dia.Link)) {\n          selectionView.createSelectionBox(cellView);\n          selection.add(cellView.model);\n        }\n      });\n      selectionView.on('selection-box:pointerdown', function (evt) {\n        // Unselect an element if the CTRL/Meta key is pressed while a selected element is clicked.\n        // 取消之前的效果\n        if (evt.ctrlKey || evt.metaKey) {\n          var cell = selection.get($(evt.target).data('model'));\n          selectionView.destroySelectionBox(paper.findViewByModel(cell));\n          selection.reset(selection.without(cell));\n        }\n      }); // Disable context menu inside the paper.\n      // 取消HTML默认页面菜单\n      // This prevents from context menu being shown when selecting individual elements with Ctrl in OS X.\n\n      paper.el.oncontextmenu = function (evt) {\n        evt.preventDefault();\n      };\n\n      keyboardJS.on('delete, backspace', function (evt) {\n        if (!$.contains(evt.target, paper.el)) {\n          // remove selected elements from the paper only if the target is the paper\n          return;\n        }\n\n        commandManager.initBatchCommand();\n        selection.invoke('remove');\n        commandManager.storeBatchCommand();\n        selectionView.cancelSelection();\n\n        if (backspaceHold && !$(evt.target).is(\"input, textarea\")) {\n          // Prevent Backspace from navigating back.\n          evt.preventDefault();\n        }\n      });\n    }, // 元素控制器，自由转换和属性\n    function initializeHaloAndInspector(scope, element) {\n      var $inspectorHolder = $('.inspector-container', element);\n\n      function openCellTools(cellView) {\n        var cell = cellView.model || cellView;\n        var halo;\n\n        if (displayMode) {\n          halo = new joint.ui.Halo({\n            cellView: cellView\n          }).render();\n          halo.removeHandles();\n        } else {\n          halo = new joint.ui.Halo({\n            cellView: cellView\n          }).render();\n        }\n        /** 取消freeTransform，halo已经具有该功能\n         var freeTransform = new joint.ui.FreeTransform({\n          cellView: cellView\n        }).render();\n         */\n\n\n        if ($scope.selectedItem.cell && $scope.selectedItem.cell.id == cell.id) return;\n        var selectedItem = {\n          cell: null,\n          userIds: 0,\n          userGroupIds: 0,\n          roleIds: 0,\n          taskType: 0,\n          taskTypeParam: \"user\",\n          userType: \"\"\n        };\n        clear();\n        clear = $scope.$watch(\"selectedItem.dataExtractExpression\", function (n, o, s) {\n          if (n) {\n            cell.prop(\"dataExtractExpression\", n);\n          }\n        });\n        selectedItem.cell = cell; //获得设备选择方式\n\n        if (cell.get('userType')) {\n          var userTypeAry = cell.get('userType').toString().split(\":\");\n          if (userTypeAry.length > 0 && userTypeAry[userTypeAry.length - 1] != '?') selectedItem.userType = String(userTypeAry[userTypeAry.length - 1]);\n        }\n\n        if (cell.get('userIds')) {\n          var userIdsAry = cell.get('userIds').toString().split(\":\");\n          if (userIdsAry.length > 0 && userIdsAry[userIdsAry.length - 1] != '?') selectedItem.userIds = Number(userIdsAry[userIdsAry.length - 1]);\n        }\n\n        if (cell.get('userGroupIds')) {\n          var userIdsAry = cell.get('userGroupIds').toString().split(\":\");\n          if (userIdsAry.length > 0 && userIdsAry[userIdsAry.length - 1] != '?') selectedItem.userGroupIds = Number(userIdsAry[userIdsAry.length - 1]);\n        }\n\n        if (cell.get('roleIds')) {\n          var userIdsAry = cell.get('roleIds').toString().split(\":\");\n          if (userIdsAry.length > 0 && userIdsAry[userIdsAry.length - 1] != '?') selectedItem.roleIds = Number(userIdsAry[userIdsAry.length - 1]);\n        }\n\n        if (cell.get('content')) {\n          //            var contentAry = cell.get('content').toString().split(\":\");\n          //            if (contentAry.length > 0 && contentAry[contentAry.length - 1] != '?')\n          //              selectedItem.content = String(contentAry[contentAry.length - 1]);\n          selectedItem.content = cell.get('content');\n        }\n\n        if (cell.get('taskType')) {\n          var contentAry = cell.get('taskType').toString().split(\":\");\n          if (contentAry.length > 0 && contentAry[contentAry.length - 1] != '?') selectedItem.taskTypeParam = String(contentAry[contentAry.length - 1]);\n        }\n\n        if (cell.get('type') == \"bpmn.Activity\" && cell.get('icon') == \"service\") {\n          selectedItem.taskType = \"2\";\n          selectedItem.taskTypeParam = \"service\"; //$(\".list\").css(\"display\",\"none\");\n        } else {\n          selectedItem.taskType = \"0\";\n          selectedItem.taskTypeParam = \"user\"; //$(\".list\").css(\"display\",\"block\");\n        }\n\n        selectedItem.dataExtractExpression = cell.get('dataExtractExpression');\n        $scope.selectedItem = selectedItem; //$scope.selectedItem\n        // No need to re-render inspector if the cellView didn't change.\n\n        if (!inspector || inspector.options.cell !== cell) {\n          if (inspector) {\n            //if (inspector.getModel().collection) {\n            //  // update cell if the model is still in the graph\n            //  inspector.updateCell();\n            //}\n            // Clean up the old inspector if there was one.\n            inspector.remove();\n          }\n\n          var inspectorDefs = scope.inspectorDefs[cell.get('type')];\n          inspector = new joint.ui.Inspector({\n            inputs: inspectorDefs ? inspectorDefs.inputs ? inspectorDefs.inputs : scope.commonInspectorInputs : scope.commonInspectorInputs,\n            groups: inspectorDefs ? inspectorDefs.groups ? inspectorDefs.groups : scope.commonInspectorGroups : scope.commonInspectorGroups,\n            cell: cell\n          }).on('render', function () {\n            this.$('[data-tooltip]').each(function () {\n              var $label = $(this);\n              new joint.ui.Tooltip({\n                target: $label,\n                content: $label.data('tooltip'),\n                right: '.inspector',\n                direction: 'right'\n              });\n            });\n            $compile($inspectorHolder)($scope);\n          });\n          scope.selectedView.inspector = true;\n          scope.$apply();\n          $inspectorHolder.html(inspector.render().el);\n          $compile($inspectorHolder)($scope);\n        } // adjust selection\n\n\n        selectionView.cancelSelection();\n        selection.reset([cellView.model]);\n      }\n\n      ;\n      paper.on('cell:pointerup', function (cellView) {\n        if (!displayMode) {\n          if (cellView.model instanceof joint.dia.Element && !selection.contains(cellView.model)) {\n            scope.selectedView.inspector = true;\n            scope.$apply();\n            openCellTools(cellView);\n          }\n        }\n      });\n      selectionView.on('selection-box:pointerdown', function (evt) {\n        // Unselect an element if the CTRL/Meta key is pressed while a selected element is clicked.\n        // 取消之前的效果\n        if (evt.ctrlKey || evt.metaKey) {\n          var cell = selection.get($(evt.target).data('model'));\n          selectionView.destroySelectionBox(paper.findViewByModel(cell));\n          selection.reset(selection.without(cell));\n        }\n      });\n      paper.on('link:options', function (evt, cellView, x, y) {\n        openCellTools(cellView);\n      });\n    }, function toolTips(scope, element) {\n      $('.toolbar-container [data-tooltip]', element).each(function () {\n        new joint.ui.Tooltip({\n          target: $(this),\n          content: $(this).data('tooltip'),\n          top: '.toolbar-container',\n          direction: 'top'\n        });\n      });\n    }, function initializeCommandManager(scope, element) {\n      commandManager = new joint.dia.CommandManager({\n        graph: graph\n      });\n      keyboardJS.on('ctrl + z', function () {\n        commandManager.undo();\n        selectionView.cancelSelection();\n      });\n      keyboardJS.on('ctrl + y', function () {\n        commandManager.redo();\n        selectionView.cancelSelection();\n      });\n      scope.components.commander = commandManager;\n\n      scope.components.commander.setDimensions = function () {\n        paper.setDimensions(paper.options.width, paper.options.height);\n        paperScroller.options.baseWidth = paper.options.width;\n        paperScroller.options.baseHeight = paper.options.height;\n        paperScroller.$el.css('padding-top', 0);\n      };\n\n      scope.components.commander.mould = function () {\n        if (scope.data.mouldType != \"\" && scope.data.mouldType != null) {\n          for (var i in scope.data.mould) {\n            if (scope.data.mould[i].content == scope.data.mouldType) {\n              scope.components.graph.fromJSON(scope.data.mould[i].view);\n            }\n          }\n        }\n      };\n\n      scope.components.commander.setGrid = function () {\n        var gridSize = paper.options.gridSize;\n        var backgroundImage = getGridBackgroundImage(gridSize);\n\n        if (scope.data.bgcolor) {\n          paper.$el.css('background-color', scope.data.bgcolor);\n        } else {\n          paper.$el.css('background-color', \"#fff\");\n          paper.$el.css('box-shadow', \"0 0 2px white\");\n        }\n\n        if (scope.data.bgimage) {\n          if (!displayMode) {\n            paper.$el.css('background-image', 'url(\"' + backgroundImage + '\"),url(\"' + scope.data.bgimage + '\")');\n          } else {\n            paper.$el.css('background-image', 'url(\"\"),url(\"' + scope.data.bgimage + '\")');\n            paper.$el.css('margin-right', 0);\n          }\n        } else {\n          if (!displayMode) {\n            paper.$el.css('background-image', 'url(\"' + backgroundImage + '\")');\n          } else {\n            paper.$el.css('background-image', 'url(\"\"),url(\"\")');\n            paper.$el.css('margin-right', 0);\n          }\n        }\n      };\n\n      var getGridBackgroundImage = function getGridBackgroundImage(gridSize, color) {\n        var canvas = $('<canvas/>', {\n          width: gridSize,\n          height: gridSize\n        });\n        canvas[0].width = gridSize;\n        canvas[0].height = gridSize;\n        var context = canvas[0].getContext('2d');\n        context.beginPath();\n        context.rect(1, 1, 1, 1);\n        context.fillStyle = color || '#AAAAAA';\n        context.fill();\n        return canvas[0].toDataURL('image/png');\n      };\n\n      scope.components.commander.save4Json = function () {\n        var viewjson = graph.toJSON();\n        var validate = true;\n        viewjson.cells.forEach(function (cell) {\n          if (cell.type == \"bpmn.Activity\" && cell.taskType == 'user') {\n            if (cell.userType == \"\") {\n              growl.warning(\"请选择{\" + cell.content + \"}任务的处理类型\", {});\n              validate = false;\n            }\n\n            if (cell.userType == \"user\" && !cell.userIds) {\n              growl.warning(\"请设置{\" + cell.content + \"}任务的处理用户\", {});\n              validate = false;\n            }\n\n            if (cell.userType == \"expression\" && !cell.userExpression) {\n              growl.warning(\"请设置{\" + cell.content + \"}任务的用户表达式\", {});\n              validate = false;\n            }\n\n            if (cell.userType == \"role\" && !cell.roleIds) {\n              growl.warning(\"请设置{\" + cell.content + \"}任务的处理角色\", {});\n              validate = false;\n            }\n\n            if (cell.userType == \"userGroup\" && !cell.userGroupIds) {\n              growl.warning(\"请设置{\" + cell.content + \"}任务的处理用户组\", {});\n              validate = false;\n            }\n          }\n        });\n        if (!validate) return;\n        viewjson.gridSize = paper.options.gridSize;\n        viewjson.width = paper.options.width;\n        viewjson.height = paper.options.height;\n        viewjson.bgimage = scope.data.bgimage;\n        viewjson.bgcolor = scope.data.bgcolor;\n        var JSONstring = JSON.stringify(viewjson);\n\n        try {\n          var param = {\n            id: scope.selectedView.id,\n            domainPath: \"\",\n            name: scope.selectedView.name,\n            desc: scope.selectedView.desc,\n            viewContent: JSONstring,\n            createTime: scope.selectedView.createTime,\n            updateTime: scope.selectedView.updateTime\n          };\n\n          if (param.viewId == 0) {\n            workflowDefinitionService.saveWorkflowDefinition(param, function (returnObj) {\n              if (returnObj.code == 0) {\n                growl.success(\"保存成功\");\n              }\n            });\n          } else {\n            workflowDefinitionService.saveWorkflowDefinition(param, function (returnObj) {\n              if (returnObj.code == 0) {\n                growl.success(\"保存成功\");\n              }\n            });\n          }\n        } catch (err) {\n          alert(err);\n        }\n      };\n\n      scope.components.commander.toJSON = function () {\n        var windowFeatures = 'menubar=no,location=no,resizable=yes,scrollbars=yes,status=no';\n\n        var windowName = _.uniqueId('json_output');\n\n        var jsonWindow = window.open('', windowName, windowFeatures);\n        jsonWindow.document.write(JSON.stringify(graph.toJSON()));\n      };\n\n      scope.components.commander.toFront = function () {\n        selection.invoke('toFront');\n      };\n\n      scope.components.commander.toBack = function () {\n        selection.invoke('toBack');\n      };\n\n      scope.components.commander.embed = function () {\n        var parentCell;\n        selectionView.model.models.forEach(function (cell) {\n          if (!parentCell) {\n            parentCell = cell;\n          } else {\n            if (parentCell.attributes.z > cell.attributes.z) {\n              parentCell = cell;\n            }\n          }\n        });\n        selectionView.model.models.forEach(function (cell) {\n          if (parentCell.id != cell.id) {\n            parentCell.embed(cell);\n          }\n        });\n      };\n\n      scope.components.commander.unembed = function () {\n        selectionView.model.models.forEach(function (cell) {\n          if (cell.attributes.embeds) {\n            cell.attributes.embeds.forEach(function (cellid) {\n              cell.unembed(graph.getCell(cellid));\n            });\n          }\n        });\n      };\n    }, function initView(scope, element) {\n      getUserGroup();\n      getUser();\n      getRole();\n      showViewContent(scope, viewId);\n    }];\n  }]);\n});"],"sourceRoot":"/source/"}