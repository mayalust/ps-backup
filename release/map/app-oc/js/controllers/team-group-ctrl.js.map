{"version":3,"sources":["app-oc/js/controllers/team-group-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","solutionUIService","userInitService","ngDialog","kpiDataService","viewFlexService","resourceUIService","userDomainService","$location","$routeParams","$timeout","userEnterpriseService","userLoginUIService","Info","growl","maintenanceUIService","initDeviceHistory","selectedAlertitem","domain","nodeType","id","initLinkUsers","teamId","getUsersByTeamId","returnObj","code","i","data","obj","emailAddress","mobilePhone","teamGroupList","$broadcast","Event","TEAM2USERINIT","option","activeListTab","queryGroupList","selectedGroup","formReg","name","workArea","userGridData","groupsAry","selectedTeamDevices","relatedDeviceList","teamTypes","teamType","typeName","domainListDic","domainListTree","routePathNodes","rootModel","rootModelDic","selectedDeviceIds","selectedDitem","label","types","selectedDeviceList","getAllTeams","addTeamGroup","arr","push","warning","newModel","remark","unshift","delTeamGroup","success","show","title","closable","message","buttons","cssClass","action","dialogRef","deleteTeamById","length","groupClick","error","close","saveTeamGroup","info","param","$","trim","addTeam","domainPath","updateTeam","group","getAllDevices","$watch","newValue","oldValue","undefined","newName","addGroupUser","newObj","userName","officePhone","userEmail","isEdit","userType","userTypeLabel","jobTitle","discription","edit","userID","enterpriseUser","doActions","type","select","userId","addUserToTeam","parameter","deleteUserToTeamByUserIdAndTeamId","getDeviceTypes","getGroupModels","getDevicesByTeamId","TEAM2DEVICEINIT","addDevices","open","template","className","scope","getDeviceType","getResourceByModelId","index","legnth","j","saveDevices","deviceIds","addDevicesToTeam","selectedDevices","item","doAction","deleteDeviceToTeamByDeviceIdAndTeamId","initEvent","on","e","aname","target","attr","text","$apply","queryEnterpriseUser","user","isAuthenticated","$on","evt","d","spareData","STOREINIT","demo_sparepart","coding","currentNumber","minimum","STATSINIT"],"mappings":"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","file":"app-oc/js/controllers/team-group-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('teamGroupCtrl', ['$scope', 'solutionUIService', 'userInitService', 'ngDialog', 'kpiDataService', 'viewFlexService', 'resourceUIService', 'userDomainService', '$location', '$routeParams', '$timeout', 'userEnterpriseService', 'userLoginUIService', 'Info', 'growl', 'maintenanceUIService', function ($scope, solutionUIService, userInitService, ngDialog, kpiDataService, viewFlexService, resourceUIService, userDomainService, $location, $routeParams, $timeout, userEnterpriseService, userLoginUIService, Info, growl, maintenanceUIService) {\n    $scope.activeListTab = \"tab3\";\n    $scope.queryGroupList = [];\n    $scope.selectedGroup = \"\";\n    $scope.formReg = {\n      'name': '',\n      'workArea': ''\n    };\n    $scope.teamGroupList = {};\n    $scope.userGridData = {};\n    $scope.groupsAry = [];\n    $scope.selectedTeamDevices = [];\n    $scope.relatedDeviceList = []; //用于存储关联班组的设备id组\n\n    $scope.teamTypes = [{\n      \"teamType\": \"巡检组\",\n      \"typeName\": \"巡检组\"\n    }, {\n      \"teamType\": \"保安组\",\n      \"typeName\": \"保安组\"\n    }];\n    $scope.domainListDic = {};\n    $scope.domainListTree = null;\n    $scope.routePathNodes = {};\n    $scope.rootModel = [];\n    $scope.rootModelDic = {};\n    $scope.selectedDeviceIds = []; //所选的多个设备\n\n    function initDeviceHistory() {\n      $scope.selectedAlertitem = {\n        // 根据域和模板选择设备\n        'domain': '',\n        //域\n        'nodeType': '',\n        //模板\n        'id': '' //设备id\n\n      };\n    }\n\n    $scope.selectedDitem = {\n      //所选域或模板下的所有设备\n      'label': [],\n      'types': []\n    };\n    $scope.selectedDeviceList = []; //选择关联好的多个设备\n    //获取所有班组\n\n    maintenanceUIService.getAllTeams(function (returnObj) {\n      if (returnObj.code == 0) {\n        $scope.queryGroupList = returnObj.data;\n        $scope.selectedGroup = returnObj.data[0];\n      }\n    });\n\n    $scope.addTeamGroup = function () {\n      //if ($scope.activeListTab == 'tab3') {\n      var arr = [];\n\n      for (var i in $scope.queryGroupList) {\n        var obj = $scope.queryGroupList[i];\n        arr.push(obj);\n\n        if (obj.id == 0) {\n          growl.warning(\"当前有未保存班组\", {});\n          return;\n        }\n      }\n\n      $scope.activeListTab = 'tab3';\n\n      var doAdd = function doAdd(newModelName) {\n        var newModel = {};\n        newModel.name = newModelName; //班组名称\n\n        newModel.id = 0;\n        newModel.workArea = ''; //工作区域\n\n        newModel.remark = ''; //备注\n\n        newModel.teamType = ''; //班组类型\n\n        $scope.queryGroupList.unshift(newModel);\n        $scope.selectedGroup = newModel;\n      };\n\n      doAdd(''); //} else {\n      //  growl.warning(\"请切换到用户组信息再进行新增操作\", {});\n      //}\n    };\n\n    $scope.delTeamGroup = function () {\n      if ($scope.selectedGroup.id != 0) {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认删除 ' + $scope.selectedGroup.name + ' 吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              if ($scope.selectedGroup) {\n                maintenanceUIService.deleteTeamById($scope.selectedGroup.id, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    var arr = [];\n\n                    for (var i in $scope.queryGroupList) {\n                      if ($scope.selectedGroup.id != $scope.queryGroupList[i].id) {\n                        arr.push($scope.queryGroupList[i]);\n                      }\n                    }\n\n                    $scope.queryGroupList = arr;\n                    growl.success(\"删除班组成功\", {});\n                    if (arr.length > 0) $scope.groupClick($scope.queryGroupList[0]);else $scope.selectedGroup = null;\n                  } else {\n                    growl.error(\"删除班组失败\", {});\n                  }\n                });\n                dialogRef.close();\n              }\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else {\n        var arr = [];\n\n        for (var i in $scope.queryGroupList) {\n          if ($scope.selectedGroup.id != $scope.queryGroupList[i].id) {\n            arr.push($scope.queryGroupList[i]);\n          }\n        }\n\n        $scope.queryGroupList = arr;\n        $scope.selectedGroup = $scope.queryGroupList[0];\n        growl.success(\"删除班组成功\", {});\n        return;\n      }\n    };\n\n    $scope.saveTeamGroup = function () {\n      var selectedTeam = {};\n\n      if ($scope.formReg.name == 0) {\n        if ($scope.selectedGroup.name == \"\") {\n          growl.info(\"请先填写班组名称\", {});\n          $scope.formReg[\"name\"] = \"1000\";\n          return;\n        } //如果id等于0 进行新增操作否则进行修改操作\n\n\n        if ($scope.selectedGroup.id == 0) {\n          for (var i in $scope.queryGroupList) {\n            if ($scope.selectedGroup.name == $scope.queryGroupList[i].name && $scope.queryGroupList[i].id != 0) {\n              growl.warning(\"您输入的班组名称已存在，请重新输入\", {});\n              return;\n            }\n          }\n\n          var param = {\n            'name': $.trim($scope.selectedGroup.name),\n            'workArea': $.trim($scope.selectedGroup.workArea),\n            'teamType': $scope.selectedGroup.teamType,\n            'remark': $.trim($scope.selectedGroup.remark)\n          };\n          maintenanceUIService.addTeam(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              selectedTeam = returnObj.data;\n              var arr = [];\n\n              for (var i in $scope.queryGroupList) {\n                if ($scope.queryGroupList[i].id == 0) {\n                  arr.push(returnObj.data);\n                  continue;\n                } else {\n                  arr.push($scope.queryGroupList[i]);\n                }\n              }\n\n              $scope.queryGroupList = arr;\n              $scope.groupClick(returnObj.data);\n              $scope.selectedGroup = returnObj.data;\n              growl.success(\"新增班组成功\", {});\n            } else {\n              growl.success(\"新增班组失败\", {});\n            }\n          });\n        } else {\n          for (var i in $scope.queryGroupList) {\n            if ($scope.queryGroupList[i].id != $scope.selectedGroup.id && $scope.selectedGroup.name == $scope.queryGroupList[i].name) {\n              growl.warning(\"当前有重复班组名称，请修改\", {});\n              return;\n            }\n          }\n\n          if ($scope.selectedGroup.name == \"\") {\n            $scope.formReg[\"name\"] = \"1000\";\n            return;\n          }\n\n          var param = {\n            \"domainPath\": $scope.selectedGroup.domainPath,\n            \"id\": $scope.selectedGroup.id,\n            'name': $.trim($scope.selectedGroup.name),\n            'workArea': $.trim($scope.selectedGroup.workArea),\n            'teamType': $scope.selectedGroup.teamType,\n            'remark': $.trim($scope.selectedGroup.remark)\n          };\n          maintenanceUIService.updateTeam(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              var arr = [];\n\n              for (var i in $scope.queryGroupList) {\n                if ($scope.queryGroupList[i].id == $scope.selectedGroup.id) {\n                  arr.push(returnObj.data);\n                  continue;\n                } else {\n                  arr.push($scope.queryGroupList[i]);\n                }\n              }\n\n              $scope.queryGroupList = arr;\n              $scope.selectedGroup = returnObj.data;\n              growl.success(\"修改班组成功\", {});\n            } else {\n              growl.success(\"修改班组失败\", {});\n            }\n          });\n        }\n      } else {}\n    };\n\n    $scope.groupClick = function (group) {\n      $scope.selectedGroup = group;\n      initDeviceHistory();\n      initLinkUsers($scope.selectedGroup.id);\n      getAllDevices($scope.selectedGroup.id);\n    };\n\n    $scope.$watch(\"selectedGroup.name\", function (newValue, oldValue) {\n      $scope.formReg[\"name\"] = \"0\"; //var reg = /^[\\u4e00-\\u9fa5a-zA-Z][u4e00-\\u9fa5a-za-zA-Z0-9_]{0,40}$/;\n\n      if ($scope.selectedGroup != undefined) {\n        var newName = $.trim(newValue);\n\n        if (newName != \"\" && newName != null) {//if (!reg.test(newValue)) {\n          //    $scope.formReg[\"name\"] = \"1000\";\n          //} else {\n          //    $scope.formReg[\"name\"] = \"0\";\n          //}\n        } else {\n          $scope.formReg[\"name\"] = \"0\";\n        }\n      }\n    });\n    $scope.$watch(\"selectedGroup.workArea\", function (newValue, oldValue) {\n      $scope.formReg[\"desc\"] = \"0\"; //var reg = /^[u4e00-\\u9fa5a-za-zA-Z0-9][u4e00-\\u9fa5a-za-zA-Z0-9]{0,100}$/;\n\n      if ($scope.selectedGroup != undefined) {\n        var newName = $.trim(newValue);\n\n        if (newName != \"\" && newName != null) {//if (!reg.test(newValue)) {\n          //    $scope.formReg[\"desc\"] = \"1001\";\n          //} else {\n          //    $scope.formReg[\"desc\"] = \"0\";\n          //}\n        } else {\n          $scope.formReg[\"desc\"] = \"0\";\n        }\n      }\n    }); //=========================   关联用户  ===================================\n    //根据班组Id获取对应用户信息\n\n    function initLinkUsers(teamId) {\n      // var teamId = $scope.selectedGroup.id;\n      maintenanceUIService.getUsersByTeamId(teamId, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            var obj = returnObj.data[i]; // obj.isEdit = 0;\n\n            if (obj.emailAddress == null || obj.emailAddress == \"\") {\n              obj[\"userEmail\"] = obj.mobilePhone;\n            } else {\n              obj[\"userEmail\"] = obj.emailAddress;\n            }\n          }\n\n          $scope.teamGroupList = returnObj.data;\n          $scope.$broadcast(Event.TEAM2USERINIT, {\n            \"option\": [$scope.teamGroupList]\n          });\n        }\n      });\n    } //添加用户关联班组\n\n\n    $scope.addGroupUser = function () {\n      if ($scope.selectedGroup == undefined) {\n        growl.warning(\"请选择班组，再进行以下操作\", {});\n        return;\n      }\n\n      if ($scope.selectedGroup.id == 0) {\n        growl.warning(\"请先保存新添加的班组，再进行以下操作\", {});\n        return;\n      }\n\n      var newObj = {\n        userName: '选择用户',\n        emailAddress: '',\n        mobilePhone: '',\n        officePhone: '',\n        id: 0,\n        // domainId: '',\n        userEmail: '',\n        domainPath: '',\n        isEdit: 2,\n        userType: 2,\n        userTypeLabel: \"普通用户\",\n        jobTitle: \"\",\n        discription: \"\",\n        edit: \"\",\n        userID: null\n      };\n\n      if ($scope.teamGroupList.length > 0) {\n        if ($scope.teamGroupList.length != $scope.enterpriseUser.length) {\n          for (var i in $scope.teamGroupList) {\n            if ($scope.teamGroupList[i].userID == null) {\n              growl.warning(\"请先保存用户再进行添加\", {});\n              $scope.$broadcast(Event.TEAM2USERINIT, {\n                \"option\": [$scope.teamGroupList]\n              });\n              return;\n            } else {\n              $scope.teamGroupList.unshift(newObj);\n              $scope.$broadcast(Event.TEAM2USERINIT, {\n                \"option\": [$scope.teamGroupList]\n              });\n              return;\n            }\n          }\n        } else {\n          growl.warning(\"您已经没有用户可以添加\", {});\n          return;\n        }\n      } else {\n        $scope.teamGroupList.unshift(newObj);\n        $scope.$broadcast(Event.TEAM2USERINIT, {\n          \"option\": [$scope.teamGroupList]\n        });\n        return;\n      }\n    };\n    /*\n     *dataTable 统一处理方式（用户）\n     */\n\n\n    $scope.doActions = function (type, select) {\n      if (type == \"saveTeam\") {\n        if (select != \"\" && select != null) {\n          var param = {\n            \"userId\": select,\n            \"teamId\": $scope.selectedGroup.id\n          };\n          maintenanceUIService.addUserToTeam(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              growl.success(\"添加用户到班组成功\", {});\n              initLinkUsers($scope.selectedGroup.id);\n            } else {\n              growl.warning(\"用户已经存在该班组中，添加失败\", {});\n              return;\n            }\n          });\n        } else {\n          growl.warning(\"请选择用户\", {});\n          return;\n        }\n      } else if (type == \"removeUser\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认将用户 \"' + select.userName + '\"移出\" ' + $scope.selectedGroup.name + '\" 吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              var parameter = [select.userID, $scope.selectedGroup.id];\n              maintenanceUIService.deleteUserToTeamByUserIdAndTeamId(parameter, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"用户组移出用户成功\", {});\n                  initLinkUsers($scope.selectedGroup.id);\n                } else {\n                  growl.warning(\"该用户移出失败\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"cancel\") {\n        growl.success(\"已取消添加班组用户\", {});\n        initLinkUsers($scope.selectedGroup.id);\n      }\n    }; //获取用户\n\n\n    var userListInit = function userListInit() {\n      userEnterpriseService.queryEnterpriseUser(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.enterpriseUser = returnObj.data;\n          initLinkUsers($scope.selectedGroup.id);\n        }\n      });\n    }; // =========================  设备信息  =============================\n    //添加设备\n\n\n    $scope.addDevices = function () {\n      if (!$scope.selectedAlertitem.nodeType) {\n        $scope.selectedDitem.label = [];\n      }\n\n      ngDialog.open({\n        template: 'templateId',\n        className: 'ngdialog-theme-plain',\n        scope: $scope\n      });\n    }; //通过域获取设备\n    // $scope.getDevices = function() {\n    //     var domainPath = $scope.selectedAlertitem.domain;\n    //     resourceUIService.getDevicesByDomainPath(domainPath, function(returnObj) {\n    //         if (returnObj.code == 0) {\n    //             $scope.selectedDitem.label = returnObj.data;\n    //         }\n    //     })\n    // }\n    //获取设备模板\n\n\n    function getDeviceTypes() {\n      solutionUIService.getGroupModels(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.selectedDitem.types = returnObj.data;\n        }\n      });\n    } //根据设备模板选择设备\n\n\n    $scope.getDeviceType = function (id) {\n      if (id == null || id == undefined || id == '') {\n        return;\n      }\n\n      $scope.selectedDitem.label = [];\n      resourceUIService.getResourceByModelId(id, function (returnObj) {\n        if (returnObj.code == 0) {\n          var array = [];\n\n          for (var i in returnObj.data) {\n            var index = -1;\n\n            if ($scope.selectedTeamDevices.legnth == 0) {\n              $scope.selectedDitem.label = returnObj.data;\n            } else {\n              for (var j in $scope.selectedTeamDevices) {\n                if (returnObj.data[i].id == $scope.selectedTeamDevices[j].id) {\n                  index = j;\n                }\n              }\n\n              if (index == -1) {\n                $scope.selectedDitem.label.push(returnObj.data[i]);\n              }\n            }\n          }\n\n          if ($scope.selectedDitem.label.length == 0) {\n            growl.warning(\"此模板下已没有可添加设备\", {});\n          }\n        }\n      });\n    };\n\n    $scope.saveDevices = function () {\n      if ($scope.relatedDeviceList.length == 0) {\n        growl.warning(\"请先选择设备模板\", {});\n        return;\n      }\n\n      var param = {\n        \"teamId\": $scope.selectedGroup.id,\n        \"deviceIds\": $scope.relatedDeviceList\n      };\n      maintenanceUIService.addDevicesToTeam(param, function (returnObj) {\n        if (returnObj.code == 0) {\n          growl.success(\"添加设备到班组成功\", {});\n          getAllDevices($scope.selectedGroup.id);\n          $scope.selectedAlertitem.nodeType = '';\n          $scope.selectedAlertitem.id = '';\n          ngDialog.close();\n        }\n      });\n    }; //点击多个设备关联，获取设备Id组信息\n\n\n    $scope.selectedDevices = function (item) {\n      // var arr = []; //用来存储设备，去重\n      if ($scope.selectedTeamDevices == '' || $scope.selectedTeamDevices == undefined) {\n        $scope.relatedDeviceList = item;\n      } else {\n        $scope.relatedDeviceList = [];\n\n        for (var i in $scope.selectedTeamDevices) {\n          for (var j in item) {\n            if (item[j] != $scope.selectedTeamDevices[i].id) {\n              $scope.relatedDeviceList.push(item[j]); // growl.warning(\"该设备已添加\", {});\n            }\n          }\n        }\n      }\n    }; //根据班组获取对应设备信息\n\n\n    function getAllDevices(teamId) {\n      // var teamId = $scope.selectedGroup.id;\n      maintenanceUIService.getDevicesByTeamId(teamId, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.selectedTeamDevices = returnObj.data; // var arr = [];\n          // for (var i in returnObj.data) {\n          //     arr[i] = returnObj.data[i].resource;\n          //     arr[i].device2TeamId = returnObj.data[i].deviceToTeamId;\n          // }\n\n          $scope.$broadcast(Event.TEAM2DEVICEINIT, {\n            \"data\": [$scope.selectedTeamDevices]\n          });\n        }\n      });\n    } //删除关联设备\n\n\n    $scope.doAction = function (type, select) {\n      if (type == \"removeDevice\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认将设备 \"' + select.label + '\"移出\" ' + $scope.selectedGroup.name + '\" 吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              var parameter = [select.id, $scope.selectedGroup.id];\n              maintenanceUIService.deleteDeviceToTeamByDeviceIdAndTeamId(parameter, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"班组移出设备成功\", {});\n                  getAllDevices($scope.selectedGroup.id);\n                } else {\n                  growl.warning(\"该设备移出失败\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n    /**\n     * 初始化切换事件\n     *\n     */\n\n\n    var initEvent = function initEvent() {\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        var aname = $(e.target).attr(\"name\");\n        var targetText = $(e.target).text();\n        $scope.activeListTab = aname;\n        $scope.$apply();\n\n        if (aname == \"tab4\") {\n          if ($scope.selectedGroup != undefined) {\n            if ($scope.selectedGroup.id != undefined) {\n              if ($scope.selectedGroup.id == 0) {\n                return;\n              }\n\n              userListInit();\n            } else {\n              growl.warning(\"请先添加班组再进行切换\", {});\n              $scope.teamGroupList = null;\n              return;\n            }\n          }\n        }\n\n        if (aname == \"tab5\") {\n          if ($scope.selectedGroup != undefined) {\n            if ($scope.selectedGroup.id != undefined) {\n              if ($scope.selectedGroup.id == 0) {\n                return;\n              }\n\n              getAllDevices($scope.selectedGroup.id);\n            } else {\n              growl.warning(\"请先添加班组再进行切换\", {});\n              $scope.teamGroupList = null;\n              return;\n            }\n          }\n        }\n      });\n    };\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          initEvent();\n          getDeviceTypes();\n          initDeviceHistory(); // userListInit();\n        }\n      });\n    } else {\n      initEvent();\n      getDeviceTypes();\n      initDeviceHistory(); // userListInit();\n    }\n  }]);\n  controllers.initController('sparePartCtrl', ['$scope', 'userInitService', 'ngDialog', '$location', '$routeParams', '$timeout', 'userEnterpriseService', 'userLoginUIService', 'Info', 'growl', function ($scope, userInitService, ngDialog, $location, $routeParams, $timeout, userEnterpriseService, userLoginUIService, Info, growl) {\n    // $scope.spareData = {\n    //     \"label\": '测试',\n    //     \"type\": '备件'\n    // };\n    // var path = \"../../localdb/demo_sparepart.json\";\n    // Info.get(path, function(info) {\n    //     alert(3);\n    //      \n    // });\n    // demo\n    $scope.demo_sparepart = [{\n      \"label\": \"备件1\",\n      \"coding\": 1234577899,\n      \"type\": \"备件型号1\",\n      \"currentNumber\": 43,\n      \"minimum\": 21\n    }, {\n      \"label\": \"备件2\",\n      \"coding\": 123457334459,\n      \"type\": \"备件型号2\",\n      \"currentNumber\": 73,\n      \"minimum\": 32\n    }, {\n      \"label\": \"备件3\",\n      \"coding\": 1234577439,\n      \"type\": \"备件型号3\",\n      \"currentNumber\": 443,\n      \"minimum\": 23\n    }, {\n      \"label\": \"备件4\",\n      \"coding\": 123434549,\n      \"type\": \"备件型号4\",\n      \"currentNumber\": 993,\n      \"minimum\": 22\n    }, {\n      \"label\": \"备件5\",\n      \"coding\": 12345222299,\n      \"type\": \"备件型号5\",\n      \"currentNumber\": 433,\n      \"minimum\": 28\n    }]; // end demo\n\n    function spareData() {\n      $scope.$broadcast(Event.STOREINIT, {\n        \"option\": [$scope.demo_sparepart]\n      });\n    }\n\n    var initEvent = function initEvent() {\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        var aname = $(e.target).attr(\"name\");\n\n        if (aname == \"store\") {\n          spareData(); // $scope.addUserName = \"新建用户\";\n\n          $scope.$broadcast(Event.STOREINIT, {\n            \"option\": [$scope.demo_sparepart]\n          });\n        } else if (aname == \"stats\") {\n          spareData(); // $scope.addUserName = \"新建角色\";\n\n          $scope.$broadcast(Event.STATSINIT, {\n            \"option\": [$scope.demo_sparepart]\n          });\n        }\n\n        $scope.$apply();\n      });\n    };\n\n    $timeout(domReady);\n\n    function domReady() {\n      spareData();\n    }\n\n    initEvent();\n  }]);\n});"],"sourceRoot":"/source/"}