{"version":3,"sources":["app-oc/js/controllers/mail-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","$routeParams","$sce","FileUploader","userLoginUIService","userEnterpriseService","psMessageService","growl","userRoleUIService","userFunctionService","userDomainService","marketplaceUIService","msgModel","messageId","title","content","insertTime","status","msgType","objectId","msgId","queryMessageInfo","res","code","data","TrustAsHtml","post","trustAsHtml","msgSave","productDetail","CKEDITOR","instances","editor1","getData","tit","$","trim","length","addMessage","success","location","href","modifyMessage","warning","systemGridData","columns","orderable","columnDefs","targets","render","type","full","newDateJson","Format","GetDateCategoryStrByLabel","str","deleteMessage","message","show","closable","buttons","label","cssClass","action","dialogRef","msg","initDB","close","notice","previewData","preview","$apply","addMail","window","publishMessage","messages","sendMessageToAll","queryAllMessage","obj","$broadcast","Event","USERINFOSINIT"],"mappings":"AAAAA,OAAO,CAAC,0BAA2B,oBAAqB,SAAUC,EAAaC,GAC7E,aAEAD,EAAYE,eAAe,eAAgB,CAAC,SAAU,eAAgB,OAAQ,eAAgB,qBAAsB,wBAAyB,mBAAoB,QAAS,oBAAqB,sBAAuB,oBAAqB,uBAAwB,SAAUC,EAAQC,EAAcC,EAAMC,EAAcC,EAAoBC,EAAuBC,EAAkBC,EAAOC,EAAmBC,EAAqBC,EAAmBC,GACpbX,EAAOY,SAAW,CAChBC,UAAa,GACbC,MAAS,GACTC,QAAW,GACXC,WAAc,GACdC,OAAU,GACVC,QAAW,GACXC,SAAY,IAEd,IAAIC,EAAQnB,EAAamB,MAErBA,GACFd,EAAiBe,iBAAiBD,EAAO,SAAUE,GACjC,GAAZA,EAAIC,OACNvB,EAAOY,SAAWU,EAAIE,KACtBxB,EAAOY,SAASG,QAAUO,EAAIE,KAAKT,WAKzCf,EAAOyB,YAAc,SAAUC,GAC7B,OAAOxB,EAAKyB,YAAYD,IAG1B1B,EAAO4B,QAAU,WACf,IAAIC,EAAgBC,SAASC,UAAUC,QAAQC,UAE3CC,EAAMlC,EAAOY,SAASE,MAEf,IAAPoB,GAA4B,IAAfC,EAAEC,KAAKF,IAA+B,IAAjBL,GAAgD,IAAzBM,EAAEC,KAAKP,GAC9DA,EAAcQ,OAAS,KACzBrC,EAAOY,SAASG,QAAUc,EAEO,IAA7B7B,EAAOY,SAASC,UAClBP,EAAiBgC,WAAWtC,EAAOY,SAAU,SAAUU,GACrC,GAAZA,EAAIC,OAGNhB,EAAMgC,QAAQ,UAAW,IACzBC,SAASC,KAAO,cAIpBnC,EAAiBoC,cAAc1C,EAAOY,SAAU,SAAUU,GACxC,GAAZA,EAAIC,OAGNhB,EAAMgC,QAAQ,YAAa,IAC3BC,SAASC,KAAO,eAKtBlC,EAAMoC,QAAQ,eAAgB,IAGhCpC,EAAMoC,QAAQ,aAAc,QAIlC9C,EAAYE,eAAe,aAAc,CAAC,SAAU,OAAQ,eAAgB,qBAAsB,wBAAyB,mBAAoB,QAAS,oBAAqB,sBAAuB,oBAAqB,uBAAwB,SAAUC,EAAQE,EAAMC,EAAcC,EAAoBC,EAAuBC,EAAkBC,EAAOC,EAAmBC,EAAqBC,EAAmBC,GACpZX,EAAO4C,eAAiB,CACtBC,QAAS,CAAC,CACR/B,MAAO,KACPU,KAAM,SACL,CACDV,MAAO,OACPU,KAAM,cACL,CACDV,MAAO,KACPU,KAAM,UACL,CACDV,MAAO,OACPU,KAAM,cACL,CACDV,MAAO,KACPgC,WAAW,EACXtB,KAAM,WAERuB,WAAY,CAAC,CACXC,QAAW,EACXxB,KAAQ,aACRyB,OAAU,SAAgBzB,EAAM0B,EAAMC,GASpC,OALMC,YAAY5B,GAAM6B,OAAOC,+BAOhC,CACDN,QAAW,EACXxB,KAAQ,SACRyB,OAAU,SAAgBzB,EAAM0B,EAAMC,GACpC,IAAII,EAAM,GAQV,OANY,GAAR/B,EACF+B,EAAM,KACW,GAAR/B,IACT+B,EAAM,OAGDA,IAER,CACDP,QAAW,EACXxB,KAAQ,aACRyB,OAAU,SAAgBzB,EAAM0B,EAAMC,GACpC,IAAII,EAAM,GAUV,OARmB,GAAfJ,EAAKlC,OACPsC,EAAM,GACkB,GAAfJ,EAAKlC,QACF,IAARO,GAAsB,MAARA,IAChB+B,EAAMH,YAAY5B,GAAM6B,OAAOC,8BAI5BC,IAER,CACDP,QAAW,EACXxB,KAAQ,SACRyB,OAAU,SAAgBzB,EAAM0B,EAAMC,GACpC,IAAII,EAAM,GAUV,OARmB,GAAfJ,EAAKlC,OAEPsC,GAAO,yjBACiB,GAAfJ,EAAKlC,SAEdsC,EAAM,OAGDA,MAKbvD,EAAOwD,cAAgB,SAAUC,GAC/B3D,EAAgB4D,KAAK,CACnB5C,MAAO,KACP6C,UAAU,EAEVF,QAAS,WACTG,QAAS,CAAC,CACRC,MAAO,KACPC,SAAU,cACVC,OAAQ,SAAgBC,GACtB1D,EAAiBkD,cAAcC,EAAQ5C,UAAW,SAAUoD,GAC1C,GAAZA,EAAI1C,OACN2C,IACA3D,EAAMgC,QAAQ,SAAU,OAG5ByB,EAAUG,UAEX,CACDN,MAAO,KACPE,OAAQ,SAAgBC,GACtBA,EAAUG,cAMlBnE,EAAOoE,OAAS,MAChBpE,EAAOqE,YAAc,GAErBrE,EAAOyB,YAAc,SAAUC,GAC7B,OAAOxB,EAAKyB,YAAYD,IAG1B1B,EAAOsE,QAAU,SAAUL,GACzBjE,EAAOqE,YAAcJ,EACrBjE,EAAOoE,OAAS,UAChBpE,EAAOuE,UAGTvE,EAAOwE,QAAU,WACfC,OAAOjC,SAASC,KAAO,cAGzBzC,EAAO0E,eAAiB,SAAUC,GAChCrE,EAAiBsE,iBAAiBD,EAAS9D,UAAW,SAAUS,GAC9C,GAAZA,EAAIC,OACN2C,IACA3D,EAAMgC,QAAQ,SAAU,QAK9B,IAAI2B,EAAS,WACX5D,EAAiBuE,gBAAgB,SAAUC,GACzB,GAAZA,EAAIvD,OAGNvB,EAAO4C,eAAepB,KAAOsD,EAAItD,KACjCxB,EAAO+E,WAAWC,MAAMC,cAAgB,UAAWjF,EAAO4C,oBAKhEsB","file":"app-oc/js/controllers/mail-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('sendMailCtrl', ['$scope', \"$routeParams\", \"$sce\", 'FileUploader', 'userLoginUIService', 'userEnterpriseService', 'psMessageService', 'growl', 'userRoleUIService', 'userFunctionService', 'userDomainService', 'marketplaceUIService', function ($scope, $routeParams, $sce, FileUploader, userLoginUIService, userEnterpriseService, psMessageService, growl, userRoleUIService, userFunctionService, userDomainService, marketplaceUIService) {\n    $scope.msgModel = {\n      \"messageId\": \"\",\n      \"title\": \"\",\n      \"content\": \"\",\n      \"insertTime\": \"\",\n      \"status\": \"\",\n      \"msgType\": \"\",\n      \"objectId\": \"\"\n    };\n    var msgId = $routeParams.msgId;\n\n    if (msgId) {\n      psMessageService.queryMessageInfo(msgId, function (res) {\n        if (res.code == 0) {\n          $scope.msgModel = res.data;\n          $scope.msgModel.content = res.data.content;\n        }\n      });\n    }\n\n    $scope.TrustAsHtml = function (post) {\n      return $sce.trustAsHtml(post);\n    };\n\n    $scope.msgSave = function () {\n      var productDetail = CKEDITOR.instances.editor1.getData(); // 获取产品详情\n\n      var tit = $scope.msgModel.title;\n\n      if (tit != \"\" && $.trim(tit) != \"\" && productDetail != \"\" && $.trim(productDetail) != \"\") {\n        if (productDetail.length < 10000) {\n          $scope.msgModel.content = productDetail;\n\n          if ($scope.msgModel.messageId == \"\") {\n            psMessageService.addMessage($scope.msgModel, function (res) {\n              if (res.code == 0) {\n                //$scope.msgModel.messageTitle = '';\n                //CKEDITOR.instances.editor1.setData('');\n                growl.success(\"站内信保存成功\", {});\n                location.href = \"#/system\";\n              }\n            });\n          } else {\n            psMessageService.modifyMessage($scope.msgModel, function (res) {\n              if (res.code == 0) {\n                //$scope.msgModel.messageTitle = '';\n                //CKEDITOR.instances.editor1.setData('');\n                growl.success(\"修改站内信保存成功\", {});\n                location.href = \"#/system\";\n              }\n            });\n          }\n        } else {\n          growl.warning(\"联系管理员，输入内容过长\", {});\n        }\n      } else {\n        growl.warning(\"标题或者内容不能为空\", {});\n      }\n    };\n  }]);\n  controllers.initController('systemCtrl', ['$scope', \"$sce\", 'FileUploader', 'userLoginUIService', 'userEnterpriseService', 'psMessageService', 'growl', 'userRoleUIService', 'userFunctionService', 'userDomainService', 'marketplaceUIService', function ($scope, $sce, FileUploader, userLoginUIService, userEnterpriseService, psMessageService, growl, userRoleUIService, userFunctionService, userDomainService, marketplaceUIService) {\n    $scope.systemGridData = {\n      columns: [{\n        title: \"标题\",\n        data: \"title\"\n      }, {\n        title: \"创建时间\",\n        data: \"createTime\"\n      }, {\n        title: \"状态\",\n        data: \"status\"\n      }, {\n        title: \"发布时间\",\n        data: \"insertTime\"\n      }, {\n        title: \"操作\",\n        orderable: false,\n        data: \"option\"\n      }],\n      columnDefs: [{\n        \"targets\": 1,\n        \"data\": \"createTime\",\n        \"render\": function render(data, type, full) {\n          var str = ''; //if(full.status == 0){\n          //if(data != \"\" && data != null){\n\n          str = newDateJson(data).Format(GetDateCategoryStrByLabel()); //  }\n          //}else if(full.status == 5){\n          //  str =\"\";\n          //}\n\n          return str;\n        }\n      }, {\n        \"targets\": 2,\n        \"data\": \"status\",\n        \"render\": function render(data, type, full) {\n          var str = '';\n\n          if (data == 0) {\n            str = \"草稿\";\n          } else if (data == 5) {\n            str = \"已发布\";\n          }\n\n          return str;\n        }\n      }, {\n        \"targets\": 3,\n        \"data\": \"insertTime\",\n        \"render\": function render(data, type, full) {\n          var str = '';\n\n          if (full.status == 0) {\n            str = \"\";\n          } else if (full.status == 5) {\n            if (data != \"\" && data != null) {\n              str = newDateJson(data).Format(GetDateCategoryStrByLabel());\n            }\n          }\n\n          return str;\n        }\n      }, {\n        \"targets\": 4,\n        \"data\": \"option\",\n        \"render\": function render(data, type, full) {\n          var str = '';\n\n          if (full.status == 0) {\n            //str = \"<a id='update-btn' class='btn btn-default btn-sm' style='margin-right: 10px;'>  <i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i> <span class='hidden-xs'> 修改</span></a><a id='delete-btn'  style='margin-right: 10px;' class='btn btn-default btn-sm' > <i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span>  </a><a id='publish-btn' class='btn btn-default btn-sm' > <i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 发布</span>  </a>\";\n            str += \"<div class='btn-group table-option-group' >\" + \"<button type='button' class='btn btn-default btn-sm'>操作</button>\" + \"<button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'>\" + \"<span class='caret'></span>\" + \"<span class='sr-only'>Toggle Dropdown</span>\" + \"</button>\" + \"<ul class='dropdown-menu' role='menu'>\" + \"<li><a style='cursor: pointer;' id='update-btn'>修改</a></li>\" + \"<li><a style='cursor: pointer;' id='delete-btn'>删除</a></li>\" + \"<li><a style='cursor: pointer;' id='publish-btn'>发布</a></li>\" + \"<li><a style='cursor: pointer;' id='preview-btn'>预览</a></li>\" + \"</ul>\" + \"</div>\";\n          } else if (full.status == 5) {\n            //str = \"<a id='publish-btn' class='btn btn-default btn-sm' > <i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 发布</span>  </a>\";\n            str = \"已发布\";\n          }\n\n          return str;\n        }\n      }]\n    };\n\n    $scope.deleteMessage = function (message) {\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: '确认要删除该公告',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            psMessageService.deleteMessage(message.messageId, function (msg) {\n              if (msg.code == 0) {\n                initDB();\n                growl.success(\"公告删除成功\", {});\n              }\n            });\n            dialogRef.close();\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.notice = 'tab';\n    $scope.previewData = '';\n\n    $scope.TrustAsHtml = function (post) {\n      return $sce.trustAsHtml(post);\n    };\n\n    $scope.preview = function (msg) {\n      $scope.previewData = msg;\n      $scope.notice = 'preview';\n      $scope.$apply();\n    };\n\n    $scope.addMail = function () {\n      window.location.href = \"#/mailedit\";\n    };\n\n    $scope.publishMessage = function (messages) {\n      psMessageService.sendMessageToAll(messages.messageId, function (res) {\n        if (res.code == 0) {\n          initDB();\n          growl.success(\"公告发布成功\", {});\n        }\n      });\n    };\n\n    var initDB = function initDB() {\n      psMessageService.queryAllMessage(function (obj) {\n        if (obj.code == 0) {\n          //var objList = [];\n          //var resList  = obj.data;\n          $scope.systemGridData.data = obj.data;\n          $scope.$broadcast(Event.USERINFOSINIT + \"_system\", $scope.systemGridData);\n        }\n      });\n    };\n\n    initDB();\n  }]);\n});"],"sourceRoot":"/source/"}