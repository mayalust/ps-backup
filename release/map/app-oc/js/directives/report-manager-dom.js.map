{"version":3,"sources":["app-oc/js/directives/report-manager-dom.js"],"names":["define","directives","datatables","daterangepicker","initDirective","$timeout","$compile","$filter","growl","weatherService","restrict","controller","$scope","$element","$attrs","table","domMain","$on","Event","REPORTMODULE","event","args","destroy","empty","DataTable","order","dom","data","length","$","ProudSmart","datatable","special2dom","language","columns","title","className","width","orderable","columnDefs","targets","render","type","full","str","isEdit","undefined","domainListDic","label","escape","catalogsDic","name","dataSourcesDic","existBuildPolicy","rowCallback","nRow","aData","iDataIndex","on","parentDom","parent","html","e","stopPropagation","tr","this","closest","row","rowData","attr","jQuery","trim","selectedTemplate","domainPath","catalogId","dataSourceId","tplFileName","zipFileName","obj","reportTemplates","i","id","warning","catalogName","dataSourceName","doAction","returnObj","reportParamXML","reportParams","fileName","cells","invalidate","tmp","splice","remove","draw","clearUploader","preventDefault","extend","flg","optionCol2","visible","periodListObj","self","param","target","checked","enabled","code","rows","success","prop"],"mappings":"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","file":"app-oc/js/directives/report-manager-dom.js","sourcesContent":["define(['directives/directives', 'datatables.net', 'datatables.net-bs', 'bootstrap-daterangepicker'], function (directives, datatables, daterangepicker) {\n  'use strict';\n\n  directives.initDirective('reportTemplateTable', ['$timeout', '$compile', '$filter', 'growl', 'weatherService', function ($timeout, $compile, $filter, growl, weatherService) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var itemAttrs;\n        $scope.$on(Event.REPORTMODULE + \"_template\", function (event, args) {\n          if (table) {\n            table.destroy();\n            domMain.empty();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            order: [[5, \"desc\"]],\n            dom: args.data && args.data.length > 0 ? $.ProudSmart.datatable.special2dom : '<\"margin-bottom-5\"<\"special-btn\">>',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            columns: [{\n              data: \"domainPath\",\n              title: \"管理域\"\n            }, {\n              data: \"name\",\n              className: \"td-word\",\n              title: \"模板名称\"\n            }, {\n              data: \"title\",\n              className: \"td-word\",\n              title: \"模板标题\"\n            }, {\n              data: \"catalogId\",\n              title: \"模板分类\"\n            }, {\n              data: \"dataSourceId\",\n              title: \"数据源名称\" //            }, {\n              //              data: \"domainPath\",\n              //              title: \"所属域\"\n\n            }, {\n              data: \"insertTime\",\n              title: \"创建时间\"\n            }, {\n              data: \"fileName\",\n              width: '260px',\n              title: \"模板文件\"\n            }, {\n              data: \"option\",\n              orderable: false,\n              width: '120px',\n              title: \"操作\"\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"domainPath\",\n              render: function render(data, type, full) {\n                if (type != \"display\") return \"\";\n                var str = \"\";\n\n                if (type == \"display\") {\n                  if (full.isEdit > 0) {\n                    str = '<div  class=\"dropdowntree\" placeholder=\"请选择...\" ng-model=\"selectedTemplate.domainPath\" change=\"\" key=\"domainPath\" options=\"domainListTree\" mark=\"nodes\"/>';\n                  } else {\n                    if (data && $scope.domainListDic[data] != undefined && $scope.domainListDic[data]) {\n                      str = $scope.domainListDic[data].label;\n                    }\n                  }\n                }\n\n                return str;\n              }\n            }, {\n              targets: 1,\n              data: \"name\",\n              render: function render(data, type, full) {\n                if (full.isEdit > 0 && type == \"display\") return \"<input maxlength='80' ng-model='selectedTemplate.name' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 2,\n              data: \"title\",\n              render: function render(data, type, full) {\n                if (full.isEdit > 0) return \"<input maxlength='80' ng-model='selectedTemplate.title' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 3,\n              data: \"catalogId\",\n              render: function render(data, type, full) {\n                if (full.isEdit > 0) {\n                  return '<select style=\"width:100%\" ng-model=\"selectedTemplate.catalogId\" class=\"combobox form-control input-sm\" ng-options=\"item.id as item.name for item in catalogs\"><select>';\n                } else {\n                  var str = \"\";\n\n                  if ($scope.catalogsDic[data] && $scope.catalogsDic[data].name != undefined) {\n                    str = $scope.catalogsDic[data].name;\n                  }\n\n                  return str;\n                }\n              }\n            }, {\n              targets: 4,\n              data: \"dataSourceId\",\n              render: function render(data, type, full) {\n                if (full.isEdit > 0) {\n                  return '<select style=\"width:100%\" ng-model=\"selectedTemplate.dataSourceId\" class=\"combobox form-control input-sm\" ng-options=\"item.id as item.name for item in dataSources\"><select>';\n                } else {\n                  var str = \"\";\n\n                  if ($scope.dataSourcesDic[data] && $scope.dataSourcesDic[data] != undefined) {\n                    str = $scope.dataSourcesDic[data].name;\n                  }\n\n                  return str;\n                }\n              }\n            }, {\n              //              targets: 4,\n              //              data: \"domainPath\",\n              //              render: function(data, type, full) {\n              //                if(full.isEdit > 0) {\n              //                  return \"<div class='dropdowntree select-sm' name='domainPath' key='domainPath' placeholder='请选择...' model='\" + data + \"' change='' options='domainListTree' mark='nodes' />\";;\n              //                } else {\n              //                  if($scope.domainListDic[data] != undefined && $scope.domainListDic[data]){\n              //                    return $scope.domainListDic[data].label;\n              //                  }else{\n              //                    return \"\";\n              //                  }\n              //                }\n              //              }\n              //            }, {\n              targets: 6,\n              data: \"fileName\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if ((full.isEdit == 3 || full.isEdit == 2) && type == \"display\") {\n                  //                  var str = '<input class=\"form-control input-sm\" type=\"file\" nv-file-select uploader=\"uploader\"/>'\n                  //                  str += '<button style=\"position: absolute\" type=\"button\" class=\"btn btn-success btn-sm\" ng-click=\"uploadImage('+full.id+')\" ng-disabled=\"!uploader.getNotUploadedItems().length\">'\n                  //                  str += '<span class=\"glyphicon glyphicon-upload\"></span></button>'\n                  //                  str += '</form>'\n                  return \"<uploader-div/>\";\n                } else {\n                  return data;\n                }\n              }\n            }, {\n              targets: 5,\n              data: \"insertTime\",\n              render: function render(data, type, full) {\n                return $filter('date')(data, 'yyyy-MM-dd HH:mm:ss');\n              }\n            }, {\n              targets: 7,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                var str = \"\";\n\n                if (full.isEdit > 0) {\n                  str = '<div class=\"btn-group  btn-group-sm\">' + '<a id=\"save-btn\" class=\"btn btn-default\" ><i class=\"fa fa-check  hidden-lg hidden-md hidden-sm\"></i><span class=\"hidden-xs ng-binding\">保存</span></a>' + '<a id=\"cancel-btn\" class=\"btn btn-default\" ><i class=\"fa fa-close hidden-lg hidden-md hidden-sm\"></i><span class=\"hidden-xs ng-binding\">取消</span></a></div>';\n                } else {\n                  str += \"<div class='btn-group  table-option-group btn-group-sm'>\";\n                  str += \"<button type='button' class='btn btn-default'>操作</button>\";\n                  ;\n                  str += \"<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'>\";\n                  str += \"<span class='caret'></span>\";\n                  str += \"<span class='sr-only'>Toggle Dropdown</span>\";\n                  str += \"</button>\";\n                  str += \"<ul class='dropdown-menu' role='menu'>\";\n\n                  if (full.existBuildPolicy == 0) {\n                    str += \"<li ><a href id='edit-btn'>编辑</a></li>\";\n                  }\n\n                  str += \"<li><a href id='params-btn'>参数</a></li>\";\n                  str += \"<li><a href id='del-btn'>删除</a></li>\";\n                  str += \"</ul>\";\n                  str += \"</div>\";\n                }\n\n                return str;\n              }\n            }],\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            }\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"addtemplate()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加模板</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var checkPass = true;\n          var selectRow = null;\n          var row = table.row(tr);\n          var rowData = row.data();\n          var domainSelect = $('div[name=\"domainPath\"]').attr(\"model\");\n\n          if (!jQuery.trim($scope.selectedTemplate.domainPath)) {\n            growl.warning(\"请选择管理域\", {});\n            return;\n          }\n\n          if (!jQuery.trim($scope.selectedTemplate.name)) {\n            growl.warning(\"请输入模板名称\", {});\n            return;\n          }\n\n          if (!jQuery.trim($scope.selectedTemplate.title)) {\n            growl.warning(\"请输入模板标题\", {});\n            return;\n          }\n\n          if (!$scope.selectedTemplate.catalogId) {\n            growl.warning(\"请选择模板分类\", {});\n            return;\n          }\n\n          if (!$scope.selectedTemplate.dataSourceId) {\n            growl.warning(\"请选择数据源\", {});\n            return;\n          }\n\n          if (!$scope.selectedTemplate.tplFileName && !$scope.selectedTemplate.zipFileName) {\n            growl.warning(\"请选择模板文件\", {});\n            return;\n          } //          if (!domainSelect) {\n          //            growl.warning(\"请选择数据域\", {});\n          //            return;\n          //          }\n\n\n          var obj = $scope.reportTemplates;\n\n          for (var i in obj) {\n            if (obj[i].id != $scope.selectedTemplate.id && obj[i].name == jQuery.trim($scope.selectedTemplate.name)) {\n              growl.warning(\"模板名称已存在!\", {});\n              return;\n            }\n          }\n\n          if (rowData.isEdit > 0) {\n            rowData.name = $scope.selectedTemplate.name;\n            rowData.title = $scope.selectedTemplate.title;\n            rowData.catalogId = $scope.selectedTemplate.catalogId;\n            rowData.catalogName = $scope.catalogsDic[rowData.catalogId].catalogName;\n            rowData.dataSourceId = $scope.selectedTemplate.dataSourceId;\n            rowData.dataSourceName = $scope.dataSourcesDic[rowData.dataSourceId].dataSourceName; //            rowData.domain = domainSelect;\n            //            rowData.domainPath = domainSelect;\n\n            rowData.tplFileName = $scope.selectedTemplate.tplFileName;\n            rowData.zipFileName = $scope.selectedTemplate.zipFileName;\n            rowData.domainPath = $scope.selectedTemplate.domainPath;\n            $scope.doAction('saveTemplate', rowData, function (returnObj) {\n              if (returnObj) {\n                rowData.isEdit = 0; // if(rowData.id == 0){\n\n                rowData.id = returnObj.id;\n                rowData.reportParamXML = returnObj.reportParamXML;\n                rowData.reportParams = returnObj.reportParams; // }\n\n                if ($scope.selectedTemplate) {\n                  rowData.fileName = $scope.selectedTemplate.tplFileName ? $scope.selectedTemplate.tplFileName : $scope.selectedTemplate.zipFileName;\n                }\n\n                $scope.selectedTemplate = null;\n                row.cells().invalidate();\n              }\n            });\n          }\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.stopPropagation();\n          $scope.selectedTemplate = null;\n          isEditing = false;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (row.data().isEdit == 2) {\n            row.data().isEdit = 0;\n            row.cells().invalidate();\n          } else {\n            var tmp = $scope.reportTemplates;\n\n            for (var i in tmp) {\n              if (tmp[i].id == 0) {\n                $scope.reportTemplates.splice(i, 1);\n                break;\n              }\n            }\n\n            row.data().isEdit = 0;\n            row.remove().draw(false);\n          }\n\n          $scope.clearUploader();\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n          var obj = $scope.reportTemplates;\n\n          for (var i in obj) {\n            if (obj[i].isEdit > 0) {\n              growl.warning(\"当前有未保存的数据\", {});\n              return;\n            }\n          }\n\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          isEditing = true;\n          row.data().isEdit = 2;\n          $scope.selectedTemplate = jQuery.extend(true, {}, row.data());\n          row.cells().invalidate();\n          $compile(tr)($scope);\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.doAction('deleteTemplate', row.data(), function (flg) {\n            if (flg) {\n              row.remove().draw(false);\n            }\n          });\n        });\n        domMain.on('click', '#params-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.doAction('paramsHandler', row.data());\n        });\n        domMain.on('click', '#pdf-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.doAction('pdfTemplate', row.data());\n        });\n      }]\n    };\n  }]);\n  directives.initDirective('reportPolicyTable', ['$timeout', '$compile', '$filter', 'growl', 'weatherService', function ($timeout, $compile, $filter, growl, weatherService) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var itemAttrs;\n        $scope.$on(Event.REPORTMODULE + \"_policy\", function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            order: [[7, \"desc\"]],\n            //如果没有数据的时候special-btn会为空\n            dom: args.data && args.data.length > 0 ? $.ProudSmart.datatable.special2dom : '<\"margin-bottom-5\"<\"special-btn\">>',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            columns: [{\n              data: \"domainPath\",\n              title: \"管理域\"\n            }, {\n              data: \"tplName\",\n              title: \"报表模板\"\n            }, {\n              data: \"periodTypeValue\",\n              title: \"生成周期\"\n            }, {\n              data: \"cronExp\",\n              title: \"触发时间\"\n            }, {\n              data: \"reportFileTypeList\",\n              title: \"生成格式\"\n            }, {\n              data: \"enabled\",\n              title: \"是否启用\"\n            }, $.ProudSmart.datatable.optionCol2, {\n              data: \"updateTime\",\n              title: \"\",\n              visible: false\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"domainPath\",\n              render: function render(data, type, full) {\n                var str = \"\";\n\n                if (data && $scope.domainListDic[data] != undefined && $scope.domainListDic[data]) {\n                  str = $scope.domainListDic[data].label;\n                }\n\n                return str;\n              }\n            }, {\n              targets: 1,\n              data: \"tplName\",\n              render: function render(data, type, full) {\n                return escape(data);\n              }\n            }, {\n              targets: 2,\n              data: \"periodTypeValue\",\n              render: function render(data, type, full) {\n                var str = \"\";\n\n                if ($scope.periodListObj[data] && $scope.periodListObj[data].label != undefined) {\n                  str = $scope.periodListObj[data].label;\n                }\n\n                return str;\n              }\n            }, {\n              targets: 3,\n              data: \"cronExp\",\n              render: function render(data, type, full) {\n                return data;\n              }\n            }, {\n              targets: 4,\n              data: \"reportFileTypeList\",\n              render: function render(data, type, full) {\n                return data;\n              }\n            }, {\n              targets: 5,\n              data: \"enabled\",\n              render: function render(data, type, full) {\n                if (type == \"display\") {\n                  if (data == 1) {\n                    return '<input class=\"enabledCheckBox\" checked type=\"checkbox\">';\n                  } else {\n                    return '<input class=\"enabledCheckBox\" type=\"checkbox\">';\n                  }\n                }\n\n                return \"\";\n              }\n            }, {\n              targets: 6,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                var str = \"<div class='btn-group btn-group-sm'>\";\n                str += \"<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 编辑</span></button>\";\n                str += \"<button id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\";\n                str += \"</div>\";\n                return str;\n              }\n            }],\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            }\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"policyhandler()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加策略</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var data = jQuery.extend(true, {}, row.data());\n          $scope.doAction('editpolicy', data, function (flg) {\n            if (flg) {\n              row.remove().draw(false);\n            }\n          });\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.doAction('deletepolicy', row.data(), function (flg) {\n            if (flg) {\n              row.remove().draw(false);\n            }\n          });\n        });\n        domMain.on('change', '.enabledCheckBox', function (e) {\n          var self = this;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var param = row.data();\n\n          if (e.target.checked) {\n            row.data().enabled = true;\n            param.enabled = 1;\n          } else {\n            row.data().enabled = false;\n            param.enabled = 0;\n          }\n\n          $scope.doAction(\"AlertEnable\", param, function (returnObj) {\n            if (returnObj.code == 0) {\n              table.rows().invalidate().draw(false);\n\n              if (!e.target.checked) {\n                $(self).prop(\"checked\", false);\n                growl.success(\"停用成功\", {});\n              } else {\n                $(self).attr(\"checked\", true);\n                growl.success(\"启用成功\", {});\n              }\n            } else if (!returnObj) {\n              if (!e.target.checked) {\n                row.data().enabled = true;\n                $(self).prop(\"checked\", true);\n              } else {\n                row.data().enabled = false;\n                $(self).attr(\"checked\", false);\n              }\n            }\n          }, true);\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}