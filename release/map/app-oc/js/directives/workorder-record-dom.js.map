{"version":3,"sources":["app-oc/js/directives/workorder-record-dom.js"],"names":["define","directives","BootstrapDialog","datatables","initDirective","$timeout","$compile","restrict","controller","$scope","$element","$attrs","table","domMain","state","$on","Event","WORKORDERRECORDINIT","event","args","destroy","empty","DataTable","dom","data","length","$","ProudSmart","datatable","footerdom","language","columns","order","columnDefs","on","e","tr","this","closest","dataList","row","location","href","id","preventDefault","name","text","menuitems","indexOf","herfList","rowCallback","nRow","aData","iDataIndex","title","orderable","visible","detail","taskStatus","targets","render","type","full","str","isEdit","undefined","sparePartsArray","stockNumber","stopPropagation","divs2","selectList","allSpareParts","put","val","i","saveAttachment","cancelAttach"],"mappings":"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","file":"app-oc/js/directives/workorder-record-dom.js","sourcesContent":["define(['directives/directives', 'bootstrap-dialog', 'datatables.net', 'datatables.net-bs', 'datatables.net-select'], function (directives, BootstrapDialog, datatables) {\n  directives.initDirective('workOrderRecord', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var state = \"\";\n        $scope.$on(Event.WORKORDERRECORDINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n            domMain.empty();\n          }\n\n          state = args.state;\n          table = domMain.DataTable({\n            dom: args.data && args.data.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            columns: args.columns,\n            \"order\": [6, \"desc\"],\n            columnDefs: args.columnDefs\n          });\n        });\n        domMain.on('click', '#process', function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var dataList = row.data();\n          location.href = \"../app-flowsheet/index.html#/processView/\" + dataList.id;\n        });\n        domMain.on('click', '#history', function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var dataList = row.data();\n        });\n        domMain.on('click', 'td', function (e) {\n          e.preventDefault();\n          var name = $(this).text();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var dataList = row.data();\n          var sear = '执行历史';\n\n          if (($scope.menuitems['A03_S08'] || $scope.menuitems['A02_S09']) && name.indexOf(sear) == -1) {\n            $scope.herfList(name, dataList, state);\n          }\n        });\n      }]\n    };\n  }]);\n  directives.initDirective('historyTable', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false; // $scope.$on(Event.CMDBINFOSINIT+\"_shadows\", function(event, args) {\n\n        $scope.$on(Event.WORKORDERRECORDINIT + \"_history\", function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: args.data && args.data.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            columns: args.columns,\n            columnDefs: args.columnDefs\n          });\n        });\n      }]\n    };\n  }]); //处理任务---关联备件\n\n  directives.initDirective('majorDeviceTable', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        $scope.$on(Event.WORKORDERRECORDINIT + \"_deviceTask\", function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: args.data && args.data.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            },\n            columns: [{\n              title: \"备件编号\",\n              data: \"name\",\n              orderable: false\n            }, {\n              title: \"备件名称\",\n              data: \"label\",\n              orderable: false\n            }, {\n              title: \"数量\",\n              data: \"stockNumber\",\n              orderable: false\n            }, {\n              title: \"操作\",\n              visible: $scope.detail.taskStatus != 200,\n              data: \"option\",\n              orderable: false\n            }],\n            columnDefs: [{\n              \"targets\": 0,\n              \"data\": \"name\",\n              \"render\": function render(data, type, full) {\n                // 返回自定义内容\n                var str = \"\";\n\n                if (full.isEdit == 3 && type == \"display\") {\n                  str += '<select id=\"allSpare\" name=\"allSpare\" class=\"combobox form-control input-sm\" ng-model=\"definitions.selectList\" ng-change=\"saveAttachment(definitions.selectList);\" ng-options=\"pro as pro.name for  pro in selectList.allSpareParts\">';\n                  str += '<option value=\"\">请选择...</option>';\n                  str += '</select>';\n                } else {\n                  str = \"<a href='#sparepartInfo/\" + full.id + \"'>\" + data + \"</a>\";\n                }\n\n                return str;\n              }\n            }, {\n              \"targets\": 1,\n              \"data\": \"label\",\n              \"render\": function render(data, type, full) {\n                return data;\n              }\n            }, {\n              \"targets\": 2,\n              \"data\": \"stockNumber\",\n              \"render\": function render(data, type, full) {\n                if (full.isEdit > 0 && type == \"display\") {\n                  return data;\n                } else {\n                  if ($scope.detail.taskStatus != 200) {\n                    if ($scope.sparePartsArray[full.id] != undefined) {\n                      return \"<input class='form-control col-xs-6'  name='\" + full.id + \"' id='stockName' ng-model='sparePartsArray[\" + full.id + \"].editNumber'  type='text'  maxlength='20'  value='\" + data + \"'  style='border: 1px solid #F18282;width: 100%;' placeholder='当前库存数量：\" + $scope.sparePartsArray[full.id].stockNumber + \"'>\";\n                    } else {\n                      return \"<input class='form-control col-xs-6'  name='\" + full.id + \"' id='stockName' type='text'  maxlength='20'  style='border: 1px solid #F18282;width: 100%;' placeholder='当前库存数量：\" + data + \"'>\";\n                    }\n                  } else {\n                    return data;\n                  }\n                }\n              }\n            }, {\n              \"targets\": 3,\n              \"data\": \"option\",\n              \"render\": function render(data, type, full) {\n                // 返回自定义内容\n                var str = \"<div class='btn-group ' >\"; //if (full.isEdit == 3) {\n                //  str += \"<a id='save-btn' class='btn btn-default btn-sm' style='margin-right: 10px;'><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>\";\n                //  str += \"<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 取消</span></a>\";\n                //} else {\n\n                if ($scope.detail.taskStatus != 200 && full.isEdit != 3) {\n                  str += \"<a id='del-btn' ng-show='detail.taskStatus != 200' class='btn btn-default btn-sm' ><i class='fa fa-times hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 删除</span></a>\";\n                } //}\n\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        }); ///**\n        // * 监听表格初始化后，添加按钮\n        // */\n        //domMain.on('init.dt', function () {\n        //  var parentDom = $(\".special-btn\").parent();\n        //  parentDom.html('<a ng-click=\"addAttachment()\" ng-show=\"detail.taskStatus != 200 && selectList.ticketStatus != false \" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 选择备件</span></a>');\n        //  $compile(parentDom)($scope);\n        //});\n\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          /*  var parentDom = $(\".special-btn\").parent();\n            //          parentDom.html('<a ng-click=\"addFault()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加故障</span></a>');\n            if($scope.detail.taskStatus != 200 && $scope.selectList.ticketStatus != false ){\n              parentDom.html('<select class=\"form-control\" style=\"min-width:200px\" selectdata=\"allSpareParts\" itemchange=\"saveAttachment\" select2></select>');\n            }\n            $compile(parentDom)($scope);*/\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          var divs2 = $scope.selectList.allSpareParts;\n          var put = $(\"#allSpare option:selected\").val();\n\n          if (put == \"\" && put == null) {\n            return;\n          } else {\n            for (var i in divs2) {\n              if (divs2[i].id == put) {\n                $scope.saveAttachment(divs2[i]);\n                break;\n              }\n            }\n          }\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.stopPropagation();\n          isEditing = false;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.cancelAttach(row.data());\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.stopPropagation();\n          isEditing = false;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.cancelAttach(row.data());\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}