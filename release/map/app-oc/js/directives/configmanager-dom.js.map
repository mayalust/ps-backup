{"version":3,"sources":["app-oc/js/directives/configmanager-dom.js"],"names":["define","directives","datatables","initDirective","$timeout","$compile","growl","restrict","controller","$scope","$element","$attrs","table","domMain","isEditing","$on","Event","CONFIGGROUPINIT","event","args","destroy","empty","DataTable","dom","length","$","ProudSmart","datatable","footerdom","language","data","order","columns","title","optionCol2","visible","columnDefs","targets","render","type","full","isEdit","escape","put","i","configTypes","value","label","str","isNew","menuitems","name","search","draw","on","parentDom","parent","html","e","stopPropagation","tr","this","closest","row","tds","parents","children","checkPass","each","val","jqob","txt","addClass","cells","invalidate","warning","removeClass","cell","list","configGroups","doAction","returnObj","id","preventDefault","rowData","flg","remove","isDel","groupInf","CONFIGINSINIT","width","groupName","rowCallback","nRow","aData","iDataIndex","selectVal","trim","clearUpload","configIns","splice"],"mappings":"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","file":"app-oc/js/directives/configmanager-dom.js","sourcesContent":["define(['directives/directives', 'datatables.net', 'datatables.net-bs'], function (directives, datatables) {\n  'use strict';\n\n  directives.initDirective('configGroupTable', ['$timeout', '$compile', 'growl', function ($timeout, $compile, growl) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var itemAttrs;\n        $scope.$on(Event.CONFIGGROUPINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n            domMain.empty();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: args && args.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            data: args,\n            order: [[5, \"desc\"]],\n            columns: [{\n              data: \"name\",\n              title: \"配置组名称\"\n            }, {\n              data: \"label\",\n              title: \"配置组显示名\"\n            }, {\n              data: \"type\",\n              title: \"配置组类型\"\n            }, {\n              data: \"value\",\n              title: \"配置组值\"\n            }, $.ProudSmart.datatable.optionCol2, {\n              data: \"id\",\n              visible: false\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"name\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if ((full.isEdit == 2 || full.isEdit == 3) && type == \"display\") return \"<input maxlength='50' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 1,\n              data: \"label\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if ((full.isEdit == 2 || full.isEdit == 3) && type == \"display\") return \"<input maxlength='50' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 2,\n              data: \"type\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if ((full.isEdit == 2 || full.isEdit == 3) && type == \"display\") {\n                  var put = \"<select class='combobox form-control input-sm'>\";\n                  put += '<option value=\"\">请选择...</option>';\n\n                  for (var i in $scope.configTypes) {\n                    if ($scope.configTypes[i].value == data) {\n                      put += '<option selected=\"true\" value=\"' + $scope.configTypes[i].value + '\">' + $scope.configTypes[i].label + '</option>';\n                    } else {\n                      put += '<option value=\"' + $scope.configTypes[i].value + '\">' + $scope.configTypes[i].label + '</option>';\n                    }\n                  }\n\n                  put += '</select>';\n                  return put;\n                }\n\n                for (var i in $scope.configTypes) {\n                  if ($scope.configTypes[i].value == data) {\n                    return $scope.configTypes[i].label;\n                  }\n                }\n\n                return data;\n              }\n            }, {\n              targets: 3,\n              data: \"value\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if ((full.isEdit == 2 || full.isEdit == 3) && type == \"display\") return \"<input maxlength='100' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 4,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                var str = \"<div class='btn-group btn-group-sm'>\";\n\n                if (full.isEdit == 2 || full.isEdit == 3) {\n                  str += \"<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>\";\n\n                  if (full.isNew) {\n                    if ($scope.menuitems['D03_A04_S23']) {\n                      str += \"<button id='del-btn' class='btn btn-primary' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\";\n                    }\n                  } else {\n                    str += \"<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>\";\n                  }\n                } else {\n                  if ($scope.menuitems['D02_A04_S23']) {\n                    str += \"<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></button>\";\n                  }\n\n                  if ($scope.menuitems['D03_A04_S23']) {\n                    str += \"<button id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\";\n                  }\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        });\n        $scope.$on(\"table-search-handle\", function (event, args) {\n          if (args.name == $attrs.name) table.search(args.value).draw();\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"addConfigGroup()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 新建配置组</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (row.data().isEdit == 2 || row.data().isEdit == 3) {\n            var tds = $(this).parents(\"tr\").children();\n            var checkPass = true;\n            $.each(tds, function (i, val) {\n              var jqob = $(val);\n\n              if (i == 0 || i == 1) {\n                if (jqob.children(\"input\").length > 0) {\n                  var txt = jqob.children(\"input\").val();\n\n                  if (!txt) {\n                    $(val).addClass('danger');\n                    checkPass = false;\n                    row.data().isEdit = 2;\n                    row.cells().invalidate();\n                    growl.warning(\"该字段不能为空\", {});\n                    return false;\n                  } else {\n                    $(val).removeClass('danger');\n                  }\n                }\n              }\n\n              if (i == 2) {\n                var txt = $(val).children(\"select\").val();\n                table.cell(jqob).data(txt); //修改DataTables对象的数据\n\n                return true;\n              }\n\n              if (i < 4) {\n                var txt = jqob.children(\"input\").val();\n                table.cell(jqob).data(txt); //修改DataTables对象的数据\n              }\n            });\n            var list = $scope.configGroups;\n\n            for (var i in list) {\n              if (list[i].name == row.data().name && list[i].isEdit != 2 && list[i].isEdit != 3) {\n                checkPass = false;\n                growl.warning(\"配置组名称不能重复\", {});\n                return false;\n              }\n            }\n\n            if (checkPass) {\n              $scope.doAction(\"configGroupSave\", row.data(), function (returnObj) {\n                if (returnObj == false) {\n                  row.data().isEdit = 2;\n                } else {\n                  row.data().id = returnObj.id;\n                  row.data().isEdit = 0;\n                  row.cells().invalidate();\n                  isEditing = false;\n                }\n              });\n            }\n          }\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n\n          if (!isEditing) {\n            isEditing = true;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 3;\n            row.cells().invalidate();\n          } else {\n            growl.warning(\"当前有修改中的配置组，请先完成该操作\", {});\n          }\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (isEditing) {\n            isEditing = false;\n            row.data().isEdit = 0;\n            row.cells().invalidate();\n          } else {\n            var rowData = row.data();\n            $scope.doAction(\"configGroupDelete\", rowData, function (flg) {\n              if (flg) row.remove().draw(false);\n            });\n          }\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data().isDel = true;\n          var rowData = row.data();\n          $scope.doAction(\"configGroupDelete\", rowData, function (flg) {\n            if (flg) row.remove().draw(false);\n          });\n        });\n      }]\n    };\n  }]);\n  directives.initDirective('configInsTable', ['$timeout', '$compile', 'growl', function ($timeout, $compile, growl) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var itemAttrs;\n        var groupInf;\n        $scope.$on(Event.CONFIGINSINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n            domMain.empty();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: args && args.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            data: args,\n            order: [[5, \"desc\"]],\n            columns: [{\n              data: \"groupName\",\n              title: \"配置组显示名\"\n            }, {\n              data: \"label\",\n              title: \"配置项名\"\n            }, {\n              data: \"value\",\n              title: \"配置项值\"\n            }, {\n              data: \"keyDesc\",\n              title: \"描述\",\n              width: \"200px\"\n            }, $.ProudSmart.datatable.optionCol2, {\n              data: \"id\",\n              visible: false\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"groupName\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if (full.isEdit > 0 && type == \"display\") {\n                  var put = \"<select id='group-select' class='combobox form-control input-sm'>\";\n                  put += '<option value=\"\">请选择...</option>';\n\n                  for (var i in $scope.configGroups) {\n                    if ($scope.configGroups[i].name == data) {\n                      put += '<option selected=\"true\" value=\"' + $scope.configGroups[i].name + '\">' + $scope.configGroups[i].label + '</option>';\n                    } else {\n                      put += '<option value=\"' + $scope.configGroups[i].name + '\">' + $scope.configGroups[i].label + '</option>';\n                    }\n                  }\n\n                  put += '</select>';\n                  return put;\n                }\n\n                for (var i in $scope.configGroups) {\n                  if ($scope.configGroups[i].name == data) {\n                    return $scope.configGroups[i].label;\n                  }\n                }\n\n                return data;\n              }\n            }, {\n              targets: 1,\n              data: \"label\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if (full.isEdit > 0 && type == \"display\") return \"<input maxlength='50' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 2,\n              data: \"value\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if (full.isEdit > 0 && type == \"display\") {\n                  groupInf = null;\n\n                  for (var i in $scope.configGroups) {\n                    if ($scope.configGroups[i].name == full.groupName) {\n                      groupInf = $scope.configGroups[i];\n                    }\n                  }\n\n                  if (groupInf && groupInf.type == \"file\") {\n                    //                    return '<input class=\"form-control input-sm\" type=\"file\" nv-file-select uploader=\"uploader\"/>';\n                    return '<uploader-div/>';\n                  } else {\n                    return \"<input style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";\n                  }\n                } else {\n                  // return \"<div style='width:400px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;' data-toggle='tooltip' title='\"+escape(data)+\"'>\"+escape(data)+\"</div>\";\n                  return \"<div  style='width:400px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;'>\" + escape(data) + \"</div>\";\n                }\n              }\n            }, {\n              targets: 3,\n              data: \"keyDesc\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if (full.isEdit > 0 && type == \"display\") return \"<input maxlength='100' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 4,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                var str = \"<div class='btn-group btn-group-sm'>\";\n\n                if (full.isEdit > 0) {\n                  str += \"<button id='save-btn' class='btn btn-primary' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></button>\"; // if(full.id == Number.MAX_VALUE) {\n                  //   isEditing = true;\n                  //   if ($scope.menuitems['A03_S23']) {\n                  //     str += \"<button id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\"\n                  //   }\n                  //  } else {\n\n                  str += \"<button id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></button>\"; // }\n                } else {\n                  if ($scope.menuitems['A02_S23']) {\n                    str += \"<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></button>\";\n                  }\n\n                  if ($scope.menuitems['A03_S23']) {\n                    str += \"<button id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\";\n                  }\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }],\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            }\n          });\n        });\n        $scope.$on(\"table-search-handle\", function (event, args) {\n          if (args.name == $attrs.name) table.search(args.value).draw();\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"addConfig()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 新建配置项</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('change', '#group-select', function (e) {\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var selectVal = $(this).val();\n          row.data().groupName = selectVal;\n          row.cells().invalidate();\n          $compile(tr)($scope);\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (row.data().isEdit == 2 || row.data().isEdit == 3) {\n            /** if(row.data().isEdit == 2) { */\n            var tds = $(this).parents(\"tr\").children();\n            var checkPass = true;\n            $.each(tds, function (i, val) {\n              var jqob = $(val);\n\n              if (i == 0) {\n                var txt = $(val).children(\"select\").val();\n\n                if (!txt) {\n                  growl.warning(\"请选择配置组显示名\", {});\n                  checkPass = false;\n                  return false;\n                }\n              } else if (i == 1) {\n                if (jqob.children(\"input\").length > 0) {\n                  var txt = jqob.children(\"input\").val();\n\n                  if (!$.trim(txt)) {\n                    growl.warning(\"请输入配置项名\", {});\n                    checkPass = false;\n                    return false;\n                  } else {\n                    row.data().label = txt;\n                  }\n                }\n              } else if (i == 2) {\n                var txt = jqob.children(\"input\").val();\n\n                if (groupInf && groupInf.type == \"file\") {\n                  var djob = jqob.children(\"div\");\n                  var dval = djob.children(\"input\").val();\n\n                  if (!dval && !row.data().value) {\n                    growl.warning(\"请选择一个上传文件作为配置项值\", {});\n                    checkPass = false;\n                    return false;\n                  }\n                } else {\n                  if (!txt) {\n                    growl.warning(\"请输入配置项值\", {});\n                    checkPass = false;\n                    return false;\n                  } else {\n                    table.cell(jqob).data(txt);\n                  }\n                }\n              } else if (i < 4) {\n                var txt = jqob.children(\"input\").val();\n                table.cell(jqob).data(txt); //修改DataTables对象的数据\n              }\n            });\n\n            if (checkPass) {\n              $scope.doAction(\"configSave\", row.data(), function (returnObj) {\n                if (returnObj == false) {\n                  row.data().isEdit = 2;\n                } else {\n                  row.data().id = returnObj.id;\n                  row.data().isEdit = 0;\n                  row.cells().invalidate().draw();\n                  ;\n                  isEditing = false;\n                }\n              });\n            }\n          }\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n\n          if (!isEditing) {\n            isEditing = true;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 2;\n            row.cells().invalidate();\n            $compile(tr)($scope);\n          } else {\n            growl.warning(\"当前有未保存的配置项，请先完成该操作\", {});\n          }\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          isEditing = false; //清理上传文件缓存数据\n\n          if (groupInf && groupInf.type == \"file\") {\n            $scope.clearUpload();\n          }\n\n          if (row.data().isEdit == 3) {\n            for (var i in $scope.configIns) {\n              if ($scope.configIns[i].isEdit == 3) {\n                $scope.configIns.splice(i, 1);\n              }\n            }\n\n            row.data().isEdit = 0;\n            row.remove().draw(false);\n          } else {\n            row.data().isEdit = 0;\n            row.cells().invalidate();\n          }\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          rowData.isDel = true;\n          $scope.doAction(\"configDelete\", rowData, function (flg) {\n            if (flg) {\n              isEditing = false;\n              row.remove().draw(false);\n            }\n          });\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}