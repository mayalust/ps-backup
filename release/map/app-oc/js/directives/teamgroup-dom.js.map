{"version":3,"sources":["app-oc/js/directives/teamgroup-dom.js"],"names":["define","directives","datatables","initDirective","$timeout","$compile","restrict","controller","$scope","$element","$attrs","table","domMain","$on","Event","TEAM2USERINIT","event","args","destroy","DataTable","dom","language","datatable","data","option","order","columns","title","orderable","visible","columnDefs","targets","render","type","full","isEdit","str","argData","enterpriseData","enterpriseUser","i","length","index","j","userID","userName","on","parentDom","$","parent","html","e","preventDefault","tr","this","closest","rowData","row","context","cellIndex","stopPropagation","selVal","val","doActions","$filter","TEAM2DEVICEINIT","escape","doAction"],"mappings":"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","file":"app-oc/js/directives/teamgroup-dom.js","sourcesContent":["define(['directives/directives', 'datatables.net', 'datatables.net-bs'], function (directives, datatables) {\n  'use strict';\n\n  directives.initDirective('team2userTable', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        $scope.$on(Event.TEAM2USERINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: directives.datatable.language,\n            data: args.option[0],\n            \"order\": [[4, \"asc\"]],\n            columns: [{\n              title: \"用户名称\",\n              data: \"userName\"\n            }, {\n              title: \"手机/邮箱\",\n              data: \"userEmail\"\n            }, {\n              title: \"办公电话\",\n              data: \"officePhone\"\n            }, {\n              title: \"操作\",\n              orderable: false,\n              data: \"option\"\n            }, {\n              title: \"\",\n              data: \"userID\",\n              visible: false\n            }],\n            columnDefs: [{\n              \"targets\": 0,\n              \"data\": \"userName\",\n              \"render\": function render(data, type, full) {\n                //返回自定义名字\n                if (full.isEdit == 2 && type == \"display\") {\n                  var str = '<select id=\"userDomainName\" name=\"userName\" class=\"combobox form-control\">' + '<option value=\"\">请选择用户</option>';\n                  var argData = args.option[0];\n                  var enterpriseData = $scope.enterpriseUser;\n\n                  for (var i = 0; i < enterpriseData.length; i++) {\n                    var index = -1;\n\n                    for (var j = 0; j < argData.length; ++j) {\n                      if (argData[j].userID == enterpriseData[i].userID) {\n                        index = j;\n                      }\n                    }\n\n                    if (index == -1) {\n                      str += '<option value=\"' + enterpriseData[i].userID + '\">' + enterpriseData[i].userName + '</option>';\n                    }\n                  }\n\n                  str += '</select>';\n                  return str;\n                } else {\n                  return data;\n                }\n              }\n            }, {\n              \"targets\": 3,\n              \"data\": \"option\",\n              \"render\": function render(data, type, full) {\n                var str = \"<div class='input-group'>\";\n\n                if (full.isEdit == 2) {\n                  str += \"<a id='save-btn'  class='btn btn-default btn-sm' ><i class='fa fa-save hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 保存</span></a>\";\n                  str += \"<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>\";\n                } else {\n                  str += \"<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 移出</span></a>\";\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"addGroupUser()\"  ng-disabled=\"!selectedGroup\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加班组用户</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', 'td', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n\n          if (rowData) {\n            if ($(this).context.cellIndex == 4 && rowData.isEdit == 0) {\n              return;\n            }\n\n            if (rowData.isEdit == 1) {}\n          }\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var selectRow = table.row('.shown');\n          var selVal = $(\"#userDomainName\").val();\n          $scope.doActions('saveTeam', selVal);\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.stopPropagation();\n          isEditing = false;\n          var selectRow = table.row('.shown');\n          $scope.doActions('cancel');\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.doActions('removeUser', row.data());\n        });\n        domMain.on('click', '#changeDomain-btn', function (e) {\n          e.preventDefault();\n          isEditing = false;\n\n          if (!isEditing) {\n            isEditing = true;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 1;\n          }\n        });\n        domMain.on('click', '#removeDomain-btn', function (e) {\n          //e.preventDefault();\n          isEditing = false;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var selectRow = table.row('.shown');\n          $scope.doActions('removeDomain', row.data());\n        });\n      }]\n    };\n  });\n  directives.initDirective('team2deviceTable', function ($timeout, $compile, $filter) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        $scope.$on(Event.TEAM2DEVICEINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: directives.datatable.language,\n            data: args.data[0],\n            order: [[0, \"desc\"]],\n            columns: [{\n              data: \"label\",\n              title: \"名称\" // , {\n              //     data: \"externalDevId\",\n              //     title: \"设备地址\"\n              // }\n\n            }, {\n              data: \"createTime\",\n              title: \"上线时间\"\n            }, //  {\n            //     data: \"onlineStatus\",\n            //     title: \"在线状态\"\n            // }, {\n            //     data: \"health\",\n            //     title: \"健康度\"\n            // },\n            {\n              data: \"option\",\n              orderable: false,\n              title: \"操作\"\n            }],\n            columnDefs: [{\n              targets: 1,\n              data: \"createTime\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                var str = $filter('date')(data, 'yyyy-MM-dd HH:mm:ss'); //var str = \"<date-label value=\" + data + \" format='yyyy-MM-dd HH:mm:ss'>\";\n\n                return str;\n              }\n            }, {\n              targets: 0,\n              data: \"label\",\n              render: function render(data, type, full) {\n                // 返回自定义内容    \n                if (full.isEdit == 2 && type == \"display\") return \"<input maxlength='20' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, //  {\n            //     targets: 3,\n            //     data: \"onlineStatus\",\n            //     render: function(data, type, full) {\n            //         // 返回自定义内容    \n            //         return \"<span class='label \" + (data == 'online' ? \"label-primary\" : \"label-warning\") + \"'>\" + (data == 'online' ? \"在线\" : \"离线\") + \"</span>\";\n            //     }\n            // }, {\n            //     targets: 4,\n            //     data: \"health\",\n            //     render: function(data, type, full) {\n            //         // 返回自定义内容    \n            //         return \"<div class='progress progress-xs progress-striped active'><div class='progress-bar \" + (data > 90 ? \"progress-bar-success\" : (data > 79 ? \"progress-bar-warning\" : (data > 59 ? \"progress-bar-minor\" : (data > 39 ? \"progress-bar-major\" : \"progress-bar-red\")))) + \"' style='width:\" + data + \"%'></div></div>\";\n            //     }\n            // },\n            {\n              \"targets\": 2,\n              \"data\": \"option\",\n              \"render\": function render(data, type, full) {\n                var str = \"<div class='input-group'>\";\n\n                if (full.isEdit == 2) {\n                  str += \"<a id='save-btn'  class='btn btn-default btn-sm' ><i class='fa fa-save hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 保存</span></a>\";\n                  str += \"<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>\";\n                } else {\n                  str += \"<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 移出</span></a>\";\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"addDevices()\"  ng-disabled=\"!selectedGroup\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加设备</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', 'td', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data(); // if (rowData) {\n          //     if (($(this).context.cellIndex == 4 && rowData.isEdit == 0)) {\n          //         return;\n          //     }\n          //     if (rowData.isEdit == 1) {}\n          // }\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var selectRow = table.row('.shown');\n          var selVal = $(\"#userDomainName\").val();\n          $scope.doAction('saveTeam', selVal);\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.stopPropagation();\n          isEditing = false;\n          var selectRow = table.row('.shown');\n          $scope.doAction('cancel');\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.doAction('removeDevice', row.data());\n        });\n        domMain.on('click', '#changeDomain-btn', function (e) {\n          e.preventDefault();\n          isEditing = false;\n\n          if (!isEditing) {\n            isEditing = true;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 1;\n          }\n        });\n        domMain.on('click', '#removeDomain-btn', function (e) {\n          //e.preventDefault();\n          isEditing = false;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var selectRow = table.row('.shown');\n          $scope.doAction('removeDomain', row.data());\n        });\n      }]\n    };\n  });\n});"],"sourceRoot":"/source/"}