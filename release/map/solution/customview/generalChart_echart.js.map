{"version":3,"sources":["solution/customview/generalChart_echart.js"],"names":["define","on","init","event","runtime","endTime","startTime","noSignalkpis","target","resource","global","getValue","kpiDes","alertTime","dateHandler","clone","addHour","getUTCDateString","renderEchart","renderEchartFn","a","getNoSignalKpis","id","getParameter","ci","extension","includeInstance","isRealTimeData","instance","show","kpi","map","e","dataItemId","getKpiValueList","returnData","hideLoading","console","warn","length","minDate","reduce","b","dt","arisingTime","before","series","after","rdata","filter","vdata","kpiCode","sort","dt1","Date","dt2","getTime","name","kpiName","type","symbolSize","data","elem","dh","minus","value","option","animation","title","textStyle","color","grid","containLabel","left","right","tooltip","trigger","formatter","params","c","str","i","time","val","marker","seriesIndex","d","addTimeStamp","getDateString","legend","toolbox","feature","dataZoom","restore","saveAsImage","backgroundColor","iconStyle","normal","borderColor","emphasis","xAxis","boundaryGap","max","axisLabel","yAxis","render","showNoData","showLoading","hideNoData","getKpiTypeByFilter","hasSingnal","off","dataItems","res","dateRangeTime"],"mappings":"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","file":"solution/customview/generalChart_echart.js","sourcesContent":["define({\n  on: {\n    init: function init(event) {\n      runtime(\"echart1 start!\");\n      var target = event.target;\n      var global = event.global;\n      var color = \"#ffe400\";\n      var LENGTH = 50;\n      var resource = target.getValue(\"global/resource\");\n      var kpiDes = target.getValue(\"global/kpi\");\n      var endTime;\n      var startTime;\n      var alertTime = target.getValue(\"global/alertTime\");\n\n      if (alertTime) {\n        alertTime = target.dateHandler(alertTime);\n        startTime = alertTime.clone();\n        endTime = alertTime.clone();\n        startTime.addHour(-2);\n        endTime.addHour(1);\n      } else {\n        endTime = target.dateHandler();\n        startTime = endTime.clone();\n        startTime.addHour(-2);\n      }\n\n      ;\n      startTime = startTime.getUTCDateString();\n      endTime = endTime.getUTCDateString();\n      var noSignalkpis;\n\n      var renderEchart = function renderEchartFn(a) {\n        renderEchart = function renderEchart() {};\n\n        target.showLoading();\n        target.hideNoData();\n\n        if (noSignalkpis) {\n          getNoSignalKpis();\n        } else {\n          target.getKpiTypeByFilter({\n            hasSingnal: false\n          }, function (data) {\n            noSignalkpis = data;\n            getNoSignalKpis();\n          });\n        }\n\n        function getNoSignalKpis() {\n          var id = target.getParameter(\"id\");\n          var ci = id ? [id] : [resource.id];\n          var extension = {\n            includeInstance: true,\n            isRealTimeData: false\n          };\n\n          if (kpiDes && kpiDes[0]) {\n            extension['queryInstances'] = kpiDes[0].instance; //kpiDes = [kpiDes];\n          }\n\n          if (startTime) {\n            extension['startTime'] = startTime;\n          }\n\n          if (endTime) {\n            extension['endTime'] = endTime;\n          }\n\n          var xAxis = [];\n          target.show();\n          var kpi = kpiDes && kpiDes.map(function (e) {\n            return e.dataItemId;\n          }) || [];\n          runtime(\"echart start to load AJAX!\");\n          target.getKpiValueList(ci, kpi, null, function (returnData) {\n            runtime(\"echart AJAX loaded!\");\n            target.hideLoading(); // console.warn(\"渲染上面的视图啦＝＝＝＝\");\n            // console.warn(\"渲染上面的视图啦＝＝＝＝\", extension);\n\n            kpiDes && console.warn(\"渲染上面的视图啦＝＝＝＝\", kpiDes[0]);\n\n            if (returnData.length > 0) {\n              var minDate = returnData.reduce(function (a, b) {\n                var dt = target.dateHandler(b.arisingTime);\n\n                if (a) {\n                  if (dt.before(a)) {\n                    return dt;\n                  } else {\n                    return a;\n                  }\n                } else {\n                  return dt;\n                }\n              }, null);\n              var maxDate = returnData.reduce(function (a, b) {\n                var dt = target.dateHandler(b.arisingTime);\n\n                if (a) {\n                  if (dt.after(a)) {\n                    return dt;\n                  } else {\n                    return a;\n                  }\n                } else {\n                  return dt;\n                }\n              }, null);\n              var endInx = 0;\n              var series = kpiDes.map(function (kpi) {\n                var rdata = returnData.filter(function (vdata) {\n                  var kpiCode = vdata.kpiCode;\n                  var instance = vdata.instance;\n                  return kpi.dataItemId == kpiCode && kpi.instance == instance;\n                });\n                rdata.sort(function (a, b) {\n                  var dt1 = new Date(a.arisingTime);\n                  var dt2 = new Date(b.arisingTime);\n                  return dt1.getTime() - dt2.getTime();\n                });\n                var rs = {\n                  name: kpi.kpiName,\n                  type: \"line\",\n                  symbolSize: 0,\n                  data: rdata.map(function (elem) {\n                    var dt = new Date(elem.arisingTime);\n                    var dh = target.dateHandler(dt);\n                    var D2017 = target.dateHandler(\"2017/01/01\");\n                    var result = dh.minus(minDate);\n                    return [result, elem.value];\n                  })\n                };\n                return rs;\n              });\n              var option = {\n                animation: false,\n                title: {\n                  textStyle: {\n                    color: \"#fff\"\n                  }\n                },\n                grid: {\n                  containLabel: \"true\",\n                  left: \"23px\",\n                  right: \"50px\"\n                },\n                tooltip: {\n                  trigger: 'axis',\n                  formatter: function formatter(params, b, c) {\n                    var str = \"\";\n\n                    for (var i in params) {\n                      var time = params[i].value[0];\n                      var val = params[i].value[1];\n                      var marker = params[i].marker;\n                      var seriesIndex = params[i].seriesIndex;\n                      var d = minDate.clone().addTimeStamp(time);\n\n                      if (kpi) {\n                        str += marker + kpiDes[seriesIndex].kpiName;\n                        str += \":\" + val + \"[\" + d.getDateString(\"MM/dd,hh:mm:ss\") + \"]<br>\";\n                      }\n\n                      ;\n                    }\n\n                    return str;\n                  }\n                },\n                legend: {\n                  data: kpiDes.map(function (elem) {\n                    return elem.kpiName;\n                  })\n                },\n                toolbox: {\n                  feature: {\n                    dataZoom: {},\n                    restore: {},\n                    saveAsImage: {\n                      type: \"png\",\n                      name: \"综合趋势-测点图\",\n                      backgroundColor: \"#0b2232\"\n                    }\n                  },\n                  iconStyle: {\n                    normal: {\n                      borderColor: \"#fff\"\n                    },\n                    emphasis: {\n                      borderColor: \"#fff\"\n                    }\n                  }\n                },\n                xAxis: {\n                  boundaryGap: false,\n                  type: 'value',\n                  max: \"dataMax\",\n                  axisLabel: {\n                    formatter: function formatter(params) {\n                      var d = minDate.clone().addTimeStamp(params);\n                      return d.getDateString(\"MM/dd,hh:mm:ss\");\n                    }\n                  }\n                },\n                yAxis: {\n                  type: 'value'\n                },\n                series: series\n              };\n              var ins = target.render(option);\n            } else {\n              target.showNoData();\n            }\n\n            ;\n            renderEchart = renderEchartFn;\n            runtime(\"echart rendered!\");\n          }, extension);\n        }\n      };\n\n      target.off(\"multiSelectValues.generalChart\");\n      target.on(\"multiSelectValues.generalChart\", function multiSelectValues(dataItems) {\n        kpiDes = dataItems; //  \n\n        if (resource && kpiDes) {\n          //target.show();\n          renderEchart(1);\n        } else {//target.hide();\n        }\n      });\n      target.off(\"tree_resourceChange.generalChart\");\n      target.on(\"tree_resourceChange.generalChart\", function tree_resourceChange_generalChart(res) {\n        resource = res.resource;\n\n        if (resource && kpiDes) {\n          //target.show();\n          renderEchart(2);\n        } else {//target.hide();\n        }\n      });\n\n      if (resource && kpiDes) {//target.show();\n        //renderEchart(3);\n      } else {//target.hide();\n        }\n\n      target.off(\"drawDiagnoseFeatureEchart.generalChart\");\n      target.on(\"drawDiagnoseFeatureEchart.generalChart\", function drawDiagnoseFeatureEchart(dateRangeTime) {\n        //debugger;\n        startTime = dateRangeTime[0].getUTCDateString();\n        endTime = dateRangeTime[1].getUTCDateString();\n\n        if (resource && kpiDes) {\n          //target.show();\n          renderEchart(4);\n        } else {//target.hide();\n        }\n      });\n    }\n  }\n});"],"sourceRoot":"/source/"}