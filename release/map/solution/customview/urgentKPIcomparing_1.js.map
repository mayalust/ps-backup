{"version":3,"sources":["solution/customview/urgentKPIcomparing_1.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","define","on","init","event","target","selections","kpi","instance","instanLists","kpis","kpiss","titles","resourceCache","createCache","getTitle","t","cached","val","clone","rs","i","toLowerCase","str","getPhysicalConfigById","id","callback","getResourceById","resource","sourceValue","eval","values","MeasurePointLocate","length","k","j","push","physicalConfig","accessConfigs","getDirectChild","n","l","getDomainAreaLineTree","domaintree","getRoot","then","root","traverse","inx","children","modelId","renderByDevice","device","filter","elem","render","ctrlgroup","loop","selection","_row$push","row","type","$location","class","loopElement","element","options","parent","change","sel","slice","parseInt","colSpan","name","ele","format","label","btnclass","click","trigger"],"mappings":"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","file":"solution/customview/urgentKPIcomparing_1.js","sourcesContent":["function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\ndefine({\n  on: {\n    init: function init(event) {\n      var target = event.target,\n          selections = [],\n          kpi,\n          instance,\n          instanLists = [],\n          kpis = [],\n          kpiss = [],\n          titles = ['基地', '厂区', '产线', '设备区域', '设备'],\n          resourceCache = createCache();\n\n      function getTitle(t) {\n        switch (t) {\n          case \"devicegroup\":\n            return \"虚拟大设备\";\n\n          case \"index\":\n            return \"虚拟大设备\";\n\n          case \"production\":\n            return \"设备区域\";\n\n          case \"navigate\":\n            return \"基地\";\n\n          case \"device\":\n            return \"设备\";\n\n          case \"factory\":\n            return \"厂区\";\n\n          case \"motor\":\n            return \"电机\";\n\n          case \"viewByModel\":\n            return \"设备\";\n        }\n      }\n\n      function createCache() {\n        var cached = function cached(key, val) {\n          cached[key] = val;\n        };\n\n        return cached;\n      }\n\n      function clone(obj) {\n        var rs = [];\n\n        for (var i in obj) {\n          rs[i] = obj[i];\n        }\n\n        ;\n        return rs;\n      }\n\n      function toLowerCase(str) {\n        return typeof str === \"string\" ? str.toLowerCase() : \"\";\n      }\n\n      function getPhysicalConfigById(id, callback) {\n        resourceCache[id] ? callback(resourceCache[id]) : target.getResourceById(id, function (resource) {\n          // 拼接设备下的所有测点\n          var sourceValue = eval(resource.values.MeasurePointLocate);\n\n          if (sourceValue && sourceValue.length > 0) {\n            instanLists = [];\n\n            for (var i = 0; i < sourceValue.length; i++) {\n              for (var k in sourceValue[i]) {\n                for (var j = 0; j < sourceValue[i][k].length; j++) {\n                  instanLists.push(sourceValue[i][k][j]);\n                }\n              }\n            }\n          }\n\n          resourceCache[id] = resource ? resource.physicalConfig ? resource.physicalConfig.accessConfigs : [] : [];\n          callback(resourceCache[id]);\n        });\n      } //获取数据项\n\n\n      function getDirectChild(n, i, l) {\n        return l < 2;\n      }\n\n      target.getDomainAreaLineTree(function (domaintree) {\n        domaintree.getRoot().then(function (root) {\n          function traverse(inx, children) {\n            if (children) {\n              selections[inx] = children[0];\n\n              if (selections[inx].children) {\n                return traverse(inx + 1, selections[inx].children);\n              } else if (selections[inx].modelId > 1000) {\n                return selections[inx];\n              } else {\n                return null;\n              }\n            } else {\n              return null;\n            }\n          }\n\n          function renderByDevice(device) {\n            if (device) {\n              getPhysicalConfigById(device.id, function (accessConfigs) {\n                kpis = accessConfigs.filter(function (elem) {\n                  return true;\n                }); //kpi = kpis[0] || {};\n\n                render();\n              });\n            } else {\n              render();\n            }\n          }\n\n          function render() {\n            var ctrlgroup = [];\n\n            var loop = function loop(inx, selection) {\n              var row = [{\n                type: \"label\",\n                value: getTitle(selection.$location) || titles[inx],\n                class: \"col-md-3\"\n              }];\n\n              if (selections.length > 5 && inx == 4) {\n                var loopElement = function loopElement(i, element) {\n                  row.push({\n                    type: \"select\",\n                    value: selections[i].id,\n                    options: selections[i].parent.children,\n                    class: \"col-md-3\",\n                    on: {\n                      change: function change(event) {\n                        var sel = event.value,\n                            device;\n\n                        if (sel.modelId < 1000) {\n                          selections[i] = sel;\n                          selections = selections.slice(0, i + 1);\n                          device = traverse(i + 1, sel.children);\n                          renderByDevice(device);\n                        } else {\n                          selections[i] = sel;\n                          renderByDevice(sel);\n                        }\n                      }\n                    }\n                  });\n                };\n\n                for (var i = inx; i < selections.length; i++) {\n                  loopElement(i, selections[i]);\n                }\n              } else {\n                var _row$push;\n\n                row.push((_row$push = {\n                  type: \"select\",\n                  value: selection.id,\n                  options: []\n                }, _defineProperty(_row$push, \"options\", selection.parent.children), _defineProperty(_row$push, \"class\", inx != selections.length - 1 ? \"col-md-9\" : \"col-md-6\"), _defineProperty(_row$push, \"colSpan\", 3), _defineProperty(_row$push, \"on\", {\n                  change: function change(event) {\n                    var sel = event.value,\n                        device;\n\n                    if (sel.modelId < 1000) {\n                      selections[inx] = sel;\n                      selections = selections.slice(0, inx + 1);\n                      device = traverse(inx + 1, sel.children);\n                      renderByDevice(device);\n                    } else {\n                      selections[inx] = sel;\n                      renderByDevice(sel);\n                    }\n                  }\n                }), _row$push));\n              }\n\n              ctrlgroup.push(row);\n            };\n\n            for (var i = 0; i < (selections.length > 5 ? 5 : selections.length); i++) {\n              loop(parseInt(i), selections[i]);\n            } // 测点\n\n\n            if (instanLists.length > 0) {\n              ctrlgroup.push([{\n                type: \"label\",\n                value: '测点',\n                class: \"col-md-3\"\n              }, {\n                type: \"select\",\n                value: instance,\n                options: instanLists,\n                class: \"col-md-6\",\n                colSpan: 2,\n                on: {\n                  change: function change(event) {\n                    instance = event.value.name;\n                    kpiss = kpis.filter(function (ele) {\n                      return ele.instance == instance;\n                    });\n                    render();\n                  }\n                },\n                format: {\n                  id: \"name\",\n                  label: \"label\"\n                }\n              }]);\n            }\n\n            ctrlgroup.push([{\n              type: \"label\",\n              value: '指标',\n              class: \"col-md-3\"\n            }, {\n              type: \"select\",\n              //value: kpi.dataItemId,\n              options: kpiss,\n              class: \"col-md-6\",\n              colSpan: 2,\n              on: {\n                change: function change(event) {\n                  var sel = event.value;\n                  kpi = sel; //render();\n                }\n              },\n              format: {\n                id: \"dataItemId\",\n                label: \"kpiName\"\n              }\n            }, {\n              type: \"button\",\n              value: \"加入对比\",\n              class: \"col-md-3\",\n              btnclass: \"btn btn-primary pull-right\",\n              on: {\n                click: function click(event) {\n                  target.trigger(\"addToSelection\", {\n                    selections: clone(selections),\n                    kpi: kpi\n                  });\n                }\n              }\n            }]);\n            target.render(ctrlgroup);\n          }\n\n          var a = traverse(0, root[0].children);\n          renderByDevice(a);\n        });\n      });\n    }\n  }\n});"],"sourceRoot":"/source/"}