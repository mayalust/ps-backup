{"version":3,"sources":["solution/customview/shakingAnalysis/shakingAnalysisItem.js"],"names":["define","width","on","init","event","target","global","dItem","kpi","$getCurrentResource","resource","sensor","getValue","subaccessConfigValues","deviceId","id","endDate","getEndDate","startDate","getStartDate","alertInstance","getParameter","dateRangeTime","all","success","ci","modelId","getKpiTypeByFilter","hasSingnal","kpis","CONDITIONA","value","instance","name","some","elem","dataItemId","CONDITIONB","accessConfigValues","physicalConfig","accessConfigs","condition","getAttrsByResourceId","attrs","MeasurePointLocate","triggerEvent","trigger","ins","setValue","sourceValue","eval","sourceValueArr","i","j","k","push","filter","e","length","find","kpiId","render","ctrlGroups","type","style","textAlign","class","change","options","format","label","map","indexOf","icon","dateHandler","getUTCDateString","btnclass","btnStyle","click","createPopupByViewIdPath","title","createSystemPopupByViewId","top","off","node"],"mappings":"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","file":"solution/customview/shakingAnalysis/shakingAnalysisItem.js","sourcesContent":["define({\n  width: \"auto\",\n  on: {\n    init: function init(event) {\n      var target = event.target;\n      var global = event.global;\n      var dItem, kpi;\n      target.$getCurrentResource(function (resource) {\n        var sensor = target.getValue(\"global/sensor\") || {};\n        var subaccessConfigValues;\n        var deviceId;\n\n        if (resource) {\n          deviceId = resource.id;\n        }\n\n        var endDate = target.getEndDate();\n        var startDate = target.getStartDate(); // 获取设备的测点\n\n        var alertInstance = target.getParameter(\"alertInstance\");\n        var dateRangeTime = [startDate, endDate];\n        var all = target.getValue(\"global/hasSingnal\") || [];\n\n        var success = function success() {\n          var ci = [resource.id]; // 设备 526443915616079\n\n          var modelId = [resource.modelId]; // 获取modelId\n\n          target.getKpiTypeByFilter({\n            hasSingnal: true\n          }, function (kpis) {\n            var CONDITIONA = function CONDITIONA(value) {\n              return dItem && value.instance == dItem.name && kpis.some(function (elem) {\n                return elem.id == value.dataItemId;\n              });\n            };\n\n            var CONDITIONB = function CONDITIONB(value) {\n              return value.instance == dItem.name;\n            };\n\n            var accessConfigValues = resource.physicalConfig ? resource.physicalConfig.accessConfigs : \"\";\n            condition = CONDITIONA;\n\n            if (accessConfigValues) {\n              target.getAttrsByResourceId(resource.id, function (attrs) {\n                var MeasurePointLocate = attrs['MeasurePointLocate'];\n\n                var triggerEvent = function triggerEvent() {\n                  target.trigger(\"drawDiagnoseFeatureEchart1\", {\n                    ins: dItem,\n                    kpi: kpi,\n                    dateRangeTime: dateRangeTime\n                  });\n                  target.setValue(\"featureEchart\", {\n                    ins: dItem,\n                    kpi: kpi,\n                    dateRangeTime: dateRangeTime\n                  });\n                }; // 设备的属性表达式\n\n\n                var sourceValue = eval(MeasurePointLocate) || \"\";\n                var sourceValueArr = [];\n\n                for (var i in sourceValue) {\n                  for (var j in sourceValue[i]) {\n                    for (var k in sourceValue[i][j]) {\n                      sourceValueArr.push(sourceValue[i][j][k]);\n                    }\n                  }\n                }\n\n                ;\n                sourceValueArr = sourceValueArr.filter(function (e) {\n                  return e.name.length < 4;\n                });\n                dItem = sourceValueArr.find(function (elem) {\n                  if (alertInstance) {\n                    return alertInstance == elem.name;\n                  } else {\n                    return sensor.instance == elem.name;\n                  }\n                }) || sourceValueArr[0];\n                subaccessConfigValues = accessConfigValues.filter(condition);\n                kpi = subaccessConfigValues.find(function (elem) {\n                  return elem.dataItemId == (sensor.kpiId || sensor.id);\n                }) || subaccessConfigValues[0];\n                kpi = kpi || {};\n                triggerEvent();\n\n                var render = function render() {\n                  target.setValue(\"global/hasSingnal\", all);\n                  var ctrlGroups = [[{\n                    type: \"label\",\n                    value: \"测点\",\n                    style: {\n                      width: \"40px\",\n                      textAlign: \"center\"\n                    }\n                  }, {\n                    type: \"select\",\n                    value: dItem.name,\n                    class: \"col-md-2\",\n                    on: {\n                      change: function change(elem) {\n                        dItem = elem.value;\n                        subaccessConfigValues = accessConfigValues.filter(condition);\n                        kpi = subaccessConfigValues[0] || {};\n                        triggerEvent();\n                        render();\n                      }\n                    },\n                    options: sourceValueArr,\n                    format: {\n                      \"id\": \"name\",\n                      \"label\": \"label\"\n                    }\n                  }, {\n                    type: \"label\",\n                    value: \"参数\",\n                    style: {\n                      width: \"40px\",\n                      textAlign: \"center\"\n                    }\n                  }, {\n                    type: \"select\",\n                    value: kpi.kpiId,\n                    class: \"col-md-2\",\n                    on: {\n                      change: function change(elem) {\n                        kpi = elem.value;\n                        triggerEvent();\n                      }\n                    },\n                    options: subaccessConfigValues,\n                    format: {\n                      \"id\": \"kpiId\",\n                      \"label\": \"kpiName\"\n                    }\n                  }, {\n                    type: \"checkboxlist\",\n                    value: all,\n                    style: {\n                      width: \"80px\",\n                      textAlign: \"center\"\n                    },\n                    options: [{\n                      id: 0,\n                      label: \"全部\"\n                    }],\n                    on: {\n                      change: function change(event) {\n                        all = event.value.map(function (elem) {\n                          return elem.id;\n                        });\n                        condition = event.value.length > 0 ? CONDITIONB : CONDITIONB;\n                        subaccessConfigValues = accessConfigValues.filter(condition);\n\n                        if (subaccessConfigValues.indexOf(kpi) == -1) {\n                          kpi || subaccessConfigValues[0];\n                        }\n\n                        render();\n                        triggerEvent();\n                      }\n                    }\n                  }, {\n                    id: 1,\n                    icon: \"none\",\n                    value: startDate,\n                    type: \"dateTimePicker\",\n                    style: {\n                      width: \"200px\"\n                    },\n                    on: {\n                      change: function change(elem) {\n                        startDate = target.dateHandler(elem.value.getUTCDateString);\n                        dateRangeTime[0] = startDate;\n                        triggerEvent();\n                      }\n                    }\n                  }, {\n                    type: \"label\",\n                    value: \"至\",\n                    style: {\n                      textAlign: \"center\",\n                      width: \"30px\"\n                    }\n                  }, {\n                    id: 2,\n                    icon: \"none\",\n                    value: endDate,\n                    type: \"dateTimePicker\",\n                    style: {\n                      width: \"200px\"\n                    },\n                    on: {\n                      change: function change(elem) {\n                        endDate = target.dateHandler(elem.value.getUTCDateString);\n                        dateRangeTime[1] = endDate;\n                        triggerEvent();\n                      }\n                    }\n                  }, {\n                    type: \"button\",\n                    class: \"col-md-1\",\n                    btnclass: \"btn btn-primary\",\n                    value: \"设备信息\",\n                    btnStyle: {\n                      width: \"100%\"\n                    },\n                    on: {\n                      click: function click(elem) {\n                        target.setValue(\"device\", deviceId);\n                        target.createPopupByViewIdPath(294542434560000, \"page1\", {\n                          width: \"600px\",\n                          title: \"设备信息\"\n                        });\n                      }\n                    }\n                  }, {\n                    type: \"button\",\n                    class: \"col-md-1\",\n                    btnclass: \"btn btn-primary\",\n                    value: \"信号分析\",\n                    btnStyle: {\n                      width: \"100%\"\n                    },\n                    on: {\n                      click: function click(elem) {\n                        target.trigger(\"analysisShakeNavigateTo\", 2);\n                        /**\n                         target.navigateTo(\"index\", {\n                        main : 2,\n                        sub : 0,\n                        sub2 : 2\n                        }, \"self\");*/\n                      }\n                    }\n                  }, {\n                    type: \"button\",\n                    class: \"col-md-1\",\n                    btnclass: \"btn btn-primary\",\n                    value: \"求助知识库\",\n                    btnStyle: {\n                      width: \"100%\"\n                    },\n                    on: {\n                      click: function click(elem) {\n                        target.createSystemPopupByViewId(\"174283678280002\", {\n                          width: \"80%\",\n                          top: \"140px\",\n                          title: \"知识库\"\n                        }, [\"\", deviceId]);\n                      }\n                    }\n                  }]];\n                  target.render(ctrlGroups);\n                };\n\n                render();\n              });\n            }\n          });\n        };\n\n        if (resource) {\n          success();\n        }\n\n        ;\n        target.off(\"tree_resourceChange.shaking\");\n        target.on(\"tree_resourceChange.shaking\", function (node) {\n          success();\n        });\n      });\n    }\n  }\n});"],"sourceRoot":"/source/"}