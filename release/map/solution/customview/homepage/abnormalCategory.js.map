{"version":3,"sources":["solution/customview/homepage/abnormalCategory.js"],"names":["define","on","init","event","complete","df","target","kpis","1,count","2,count","3,count","4,count","values","d","fn","rs","i","push","QueryAlert","this","resource","undefined","pieData","title","data","x","y","prototype","getChildren","callback","getDomainAreaLineTree","res","n","l","then","resources","getKpiValueList","nodeIds","map","id","getKpiValueCi","valueList","reduce","a","b","nodeId","instance","includeInstance","isRealTimeData","valueMap","queryItems","options","val","Object","keys","name","value","tooltip","trigger","formatter","legend","key","series","pie","label","setX","setY","Math","floor","getData","graphic","elements","left","top","type","style","text","fill","textAlign","textVerticalAlign","render","num","center","radius","avoidLabelOverlap","normal","show","position","emphasis","textStyle","fontSize","fontWeight","labelLine"],"mappings":"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","file":"solution/customview/homepage/abnormalCategory.js","sourcesContent":["define({\n  \"on\": {\n    \"init\": function init(event, complete, df) {\n      var target = event.target,\n          kpis = {\n        \"1,count\": '点检异常数',\n        \"2,count\": '注意告警数',\n        \"3,count\": '警告告警数',\n        \"4,count\": '危险告警数'\n      };\n\n      function values(d, fn) {\n        var rs = [];\n\n        for (var i in d) {\n          rs.push(fn(i, d[i]));\n        }\n\n        return rs;\n      }\n\n      function QueryAlert() {\n        this.resource = undefined;\n      }\n\n      QueryAlert.prototype.getChildren = function (callback) {\n        target.getDomainAreaLineTree(function (res) {\n          res.getChildren(function (n, i, l) {\n            return l < 2;\n          }).then(function (resources) {\n            this.resource = resources;\n            callback(resources);\n          });\n        });\n      };\n\n      QueryAlert.prototype.getKpiValueList = function (callback) {\n        this.getChildren(function (resource) {\n          var nodeIds = resource.map(function (d) {\n            return d.id;\n          }),\n              kpiCodes = [7203];\n          target.getKpiValueCi(nodeIds, kpiCodes, function (valueList) {\n            callback(valueList.reduce(function (a, b) {\n              a[b.nodeId] = a[b.nodeId] || {};\n              a[b.nodeId][b.instance] = b;\n              return a;\n            }, {}));\n          }, {\n            includeInstance: true,\n            isRealTimeData: true\n          });\n        });\n      };\n\n      new QueryAlert().getKpiValueList(function (valueMap) {\n        var options = makeOption(this.resource.map(function (resource) {\n          var val = valueMap[resource.id] || {};\n          resource.data = Object.keys(kpis).map(function (instance) {\n            return {\n              name: kpis[instance],\n              value: val[instance] ? val[instance].value : 0\n            };\n          });\n          return resource;\n        }));\n        target.render(options);\n      });\n\n      function makeOption(queryItems) {\n        return {\n          tooltip: {\n            trigger: 'item',\n            formatter: \"{a} <br/>{b}: {c} ({d}%)\"\n          },\n          legend: {\n            data: values(kpis, function (key, val) {\n              return val;\n            })\n          },\n          series: queryItems.map(function (d, i) {\n            var pie = new pieData(d.label, d.data);\n            pie.setX(20 + i % 3 * 30);\n            pie.setY(30 + Math.floor(i / 3) * 45);\n            return pie.getData();\n          }),\n          graphic: {\n            elements: queryItems.map(function (d, i) {\n              var left = 18 + i % 3 * 30,\n                  top = 50 + Math.floor(i / 3) * 45;\n              return {\n                type: \"text\",\n                top: top + \"%\",\n                left: left + \"%\",\n                style: {\n                  text: d.label,\n                  fill: \"white\",\n                  textAlign: \"center\",\n                  textVerticalAlign: \"middle\"\n                }\n              };\n            })\n          }\n        };\n      }\n\n      function pieData(title, data) {\n        this.title = title;\n        this.data = data;\n        this.x = undefined;\n        this.y = undefined;\n      }\n\n      pieData.prototype.setX = function (num) {\n        this.x = num + \"%\";\n      };\n\n      pieData.prototype.setY = function (num) {\n        this.y = num + \"%\";\n      };\n\n      pieData.prototype.getData = function () {\n        return {\n          name: '告警信息',\n          type: 'pie',\n          center: [this.x, this.y],\n          radius: ['25%', '35%'],\n          avoidLabelOverlap: false,\n          label: {\n            normal: {\n              show: false,\n              position: \"center\"\n            },\n            emphasis: {\n              show: true,\n              textStyle: {\n                fontSize: '12',\n                fontWeight: 'bold'\n              }\n            }\n          },\n          labelLine: {\n            normal: {\n              show: false\n            }\n          },\n          data: values(this.data, function (key, val) {\n            return {\n              name: val.name,\n              value: val.value || 0\n            };\n          })\n        };\n      };\n    }\n  }\n});"],"sourceRoot":"/source/"}