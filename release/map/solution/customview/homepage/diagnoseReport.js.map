{"version":3,"sources":["solution/customview/homepage/diagnoseReport.js"],"names":["define","on","init","event","complete","df","callback","target","children","nodeIds","params","valueListMap","kpis","7303","7304","column","concat","Object","values","map","d","id","returnData","data","reduce","a","b","kpiCode","nodeId","instance","inx","ctrlGroups","elem","type","value","class","style","text-align","domain","label","color","keys","kpi","v","val","shownumber","Math","round","render","isRealTimeData","includeInstance","kpiCodes","postService","getDomainAreaLineTree","resource","getChildren","n","i","l","then"],"mappings":"AAAAA,OAAO,CACLC,GAAM,CACJC,KAAQ,SAAcC,EAAOC,EAAUC,GACrC,IAYqBC,EAZjBC,EAASJ,EAAMI,OAYED,EAyBT,SAAUE,GACpB,IAhBwBC,EAAmBH,EACvCI,EAeAC,EAAe,GACfC,EAAO,CACTC,KAAM,UACNC,KAAM,WAEJC,EAAS,CAAC,MAAMC,OAAOC,OAAOC,OAAON,IArBjBH,EAsBPD,EAASW,IAAI,SAAUC,GACtC,OAAOA,EAAEC,KAvBgCf,EAwBzB,SAAUgB,GAC1BX,EAAeW,EAAWC,KAAKC,OAAO,SAAUC,EAAGC,GACjD,IAAIC,EAAUD,EAAEC,QACZC,EAASF,EAAEE,OAGf,OAAgB,MAFDF,EAAEG,WAMjBJ,EAAEG,GAAUH,EAAEG,IAAW,GACzBH,EAAEG,GAAQD,GAAWD,GAJZD,GAMR,IACH,IAAIK,EAAM,EACNC,EAAa,CAAChB,EAAOI,IAAI,SAAUa,GACrC,IAAIP,EAAI,CACNQ,KAAM,QACNC,MAAOF,EACPG,MAAOL,EAAa,GAAPA,EAAW,WAAa,WAAa,WAClDM,MAAO,CACLC,aAAc,WAIlB,OADAP,IACOL,KACLT,OAAOR,EAASW,IAAI,SAAUmB,GAChC,MAAO,CAAC,CACNL,KAAM,QACNC,MAAOI,EAAOC,MACdJ,MAAO,WACPC,MAAO,CACLC,aAAc,SACdG,MAAS,WAEVxB,OAAOC,OAAOwB,KAAK7B,GAAMO,IAAI,SAAUuB,GACxC,IAhFcC,EAgFVC,EAAMjC,EAAa2B,EAAOjB,KAAOV,EAAa2B,EAAOjB,IAAIqB,IAAQ,GACrE,MAAO,CACLT,KAAM,cACNY,YAAY,EACZX,OApFYS,EAoFQC,EAAIV,OAnFhCS,GAAQ,IAEEA,EACD,EAGFG,KAAKC,MAAU,IAAJJ,IA8EVR,MAAO,kBAIb5B,EAAOyC,OAAOjB,IApEZrB,EAAS,CAAC,MAAO,CACnBuC,gBAAkB,EAClBC,iBAAmB,EACnBzC,QAAWA,EACX0C,SAmBE,CAAC,KAAM,QAjBX5C,EAAO6C,YAAY,qBAAsB,kBAAmB1C,EAAQ,SAAUY,GAC5EhB,EAASgB,IACR,CACD2B,gBAAkB,EAClBC,iBAAmB,KApBrB3C,EAAO8C,sBAAsB,SAAUC,GACrCA,EAASC,YAAY,SAAUC,EAAGC,EAAGC,GACnC,OAAOA,EAAI,IACVC,KAAK,SAAUnD,GAChBF,EAASE","file":"solution/customview/homepage/diagnoseReport.js","sourcesContent":["define({\n  \"on\": {\n    \"init\": function init(event, complete, df) {\n      var target = event.target;\n\n      function toPersentage(v) {\n        v = v - 0;\n\n        if (v !== v) {\n          return 0;\n        }\n\n        return Math.round(v * 100);\n      }\n\n      function getChildren(callback) {\n        target.getDomainAreaLineTree(function (resource) {\n          resource.getChildren(function (n, i, l) {\n            return l < 2;\n          }).then(function (children) {\n            callback(children);\n          });\n        });\n      }\n\n      function getKpivValueList(nodeIds, kpiCodes, callback) {\n        var params = [\"kpi\", {\n          \"isRealTimeData\": true,\n          \"includeInstance\": true,\n          \"nodeIds\": nodeIds,\n          \"kpiCodes\": kpiCodes\n        }];\n        target.postService(\"kpiDataFlexService\", \"getKpiValueList\", params, function (returnData) {\n          callback(returnData);\n        }, {\n          \"isRealTimeData\": true,\n          \"includeInstance\": true\n        });\n      }\n\n      getChildren(function (children) {\n        var valueListMap = {},\n            kpis = {\n          7303: '综合诊断准确率',\n          7304: '智能诊断准确率'\n        },\n            column = ['区域'].concat(Object.values(kpis));\n        getKpivValueList(children.map(function (d) {\n          return d.id;\n        }), [7303, 7304], function (returnData) {\n          valueListMap = returnData.data.reduce(function (a, b) {\n            var kpiCode = b.kpiCode,\n                nodeId = b.nodeId,\n                instance = b.instance;\n\n            if (instance == null) {\n              return a;\n            }\n\n            a[nodeId] = a[nodeId] || {};\n            a[nodeId][kpiCode] = b;\n            return a;\n          }, {});\n          var inx = 0,\n              ctrlGroups = [column.map(function (elem) {\n            var a = {\n              type: \"label\",\n              value: elem,\n              class: inx ? inx == 3 ? \"col-md-4\" : \"col-md-5\" : \"col-md-2\",\n              style: {\n                \"text-align\": \"center\"\n              }\n            };\n            inx++;\n            return a;\n          })].concat(children.map(function (domain) {\n            return [{\n              type: \"label\",\n              value: domain.label,\n              class: \"col-md-2\",\n              style: {\n                \"text-align\": \"center\",\n                \"color\": \"white\"\n              }\n            }].concat(Object.keys(kpis).map(function (kpi) {\n              var val = valueListMap[domain.id] && valueListMap[domain.id][kpi] || {};\n              return {\n                type: \"progressbar\",\n                shownumber: true,\n                value: toPersentage(val.value),\n                class: \"col-md-5\"\n              };\n            }));\n          }));\n          target.render(ctrlGroups);\n        });\n      });\n    }\n  }\n});"],"sourceRoot":"/source/"}