{"version":3,"sources":["solution/customview/homepage/abnormalReport.js"],"names":["define","on","init","event","complete","df","callback","valueListMap","target","total","instanceIds","1","2","3","4","toNumber","val","propMap","obj","rs","i","push","getValueListMap","a","b","value","num","number","n","kpiCode","nodeId","instance","insId","split","console","log","Math","pow","round","setAnalysisData","domain","createItem","defaultValue","label","name","id","province","data","concat","_","index","values","children","nodeIds","params","map","d","returnData","totalNumber","reduce","error","sum","list","render","isRealTimeData","includeInstance","kpiCodes","postService","getDomainAreaLineTree","resource","getChildren","l","then"],"mappings":"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","file":"solution/customview/homepage/abnormalReport.js","sourcesContent":["define({\n  \"on\": {\n    \"init\": function init(event, complete, df) {\n      var valueListMap = {},\n          target = event.target,\n          total = 0,\n          instanceIds = {\n        1: '点检异常数',\n        2: '注意告警数',\n        3: '警告告警数',\n        4: '危险告警数'\n      };\n\n      function toFixed(n) {\n        return function (num) {\n          var number = Math.pow(10, n);\n          return Math.round(num * number) / number;\n        };\n      }\n\n      function toNumber(val) {\n        val = val - 0;\n        return val === val ? val : 0;\n      }\n\n      function propMap(obj, callback) {\n        var rs = [];\n\n        for (var i in obj) {\n          rs.push(callback(i, obj[i]));\n        }\n\n        return rs;\n      }\n\n      function getChildren(callback) {\n        target.getDomainAreaLineTree(function (resource) {\n          resource.getChildren(function (n, i, l) {\n            return l < 2;\n          }).then(function (children) {\n            callback(children);\n          });\n        });\n      }\n\n      function getKpivValueList(nodeIds, kpiCodes, callback) {\n        var params = [\"kpi\", {\n          \"isRealTimeData\": true,\n          \"includeInstance\": true,\n          \"nodeIds\": nodeIds,\n          \"kpiCodes\": kpiCodes\n        }];\n        target.postService(\"kpiDataFlexService\", \"getKpiValueList\", params, callback, {\n          \"isRealTimeData\": true,\n          \"includeInstance\": true\n        });\n      }\n\n      function sum(a) {\n        var rs = 0;\n\n        for (var i in a) {\n          rs += a[i];\n        }\n\n        return rs;\n      }\n\n      function getValueListMap(a, b) {\n        var value,\n            kpiCode = b.kpiCode,\n            nodeId = b.nodeId,\n            instance = b.instance;\n        a[nodeId] = a[nodeId] || {};\n        a[nodeId][kpiCode] = a[nodeId][kpiCode] || {};\n\n        if (kpiCode == 7203) {\n          if (instance == null) {\n            return a;\n          }\n\n          insId = instance.split(\",\")[0];\n          a[nodeId][kpiCode][insId] = b.value || 0;\n        }\n\n        if (kpiCode == 7302) {\n          value = toNumber(b.value);\n\n          if (value) {\n            console.log(\"===\" + value, kpiCode);\n          }\n\n          a[nodeId][kpiCode][\"_\"] = toFixed(2)(value / total * 100) + \"%\";\n        }\n\n        return a;\n      }\n\n      function setAnalysisData(domain) {\n        var rs = {};\n        rs.province = domain.label;\n\n        function createItem(kpiCode, defaultValue) {\n          defaultValue = defaultValue == null ? 0 : defaultValue;\n          return function (insId, label) {\n            return {\n              name: label,\n              value: valueListMap[domain.id] && valueListMap[domain.id][kpiCode] && valueListMap[domain.id][kpiCode][insId] || defaultValue\n            };\n          };\n        }\n\n        rs.data = propMap(instanceIds, createItem(7203)).concat(propMap({\n          \"_\": \"异常处理率\"\n        }, createItem(7302, \"0%\")));\n        rs.index = domain.values.number || 0;\n        return rs;\n      }\n\n      getChildren(function (children) {\n        getKpivValueList(children.map(function (d) {\n          return d.id;\n        }), [7203, 7302], function (returnData) {\n          var totalNumber = returnData.data.reduce(function (a, b) {\n            var nodeId = b.nodeId,\n                kpiCode = b.kpiCode,\n                val = toNumber(b.value);\n\n            if (kpiCode == 7302) {\n              if (a[nodeId] != null) {\n                console.error(\"nodeId : \" + nodeId + \", kpiCode : \" + kpiCode + \", instance : \" + b.instance + \", 存在重复输入情况，请联系KQI编写者修改漏洞。\");\n              }\n\n              a[nodeId] = val;\n            }\n\n            return a;\n          }, {});\n          total = sum(totalNumber);\n          valueListMap = returnData.data.reduce(getValueListMap, {});\n          var list = children.map(setAnalysisData);\n          target.render(list);\n        });\n      });\n    }\n  }\n});"],"sourceRoot":"/source/"}