{"version":3,"sources":["toolkit/component/progress.js"],"names":["define","data","element","serviceCenterService","innerContent","$","addClass","text","number","pb_wrap","pb_bar","run","getCiKpi","ci","kpi","resource","getValueList","failure","target","expression","rs","dtype","baseOption","title","series","parameters","applied","$$","runExpression","funRes","code","Error","message","fnResult","item","$attr","name","value","css","removeClass","append","renderItem","units","getAll","then","condition","method","type","getValueListBytime","undefined","defer","style"],"mappings":"AAGAA,OAAO,GAAI,WACT,OAAO,SAAUC,GACf,IAAIC,EAAUD,EAAKC,QACfC,EAAuBF,EAAKE,qBAC5BC,EAAeC,EAAE,eAAeC,SAAS,kBAEzCC,EAAOF,EAAE,iBAAiBC,SAAS,iBACnCE,EAASH,EAAE,iBAAiBC,SAAS,mBACrCG,EAAUJ,EAAE,eAAeC,SAAS,eACpCI,EAASL,EAAE,eAAeC,SAAS,gBAoEnCK,EAAM,WA8CRT,EAAQU,SA7CY,SAAuBC,EAAIC,GACzCD,EAAKX,EAAQD,KAAKc,SAAWb,EAAQD,KAAKc,SAAW,GACrDD,EAAMZ,EAAQD,KAAKa,IAAMZ,EAAQD,KAAKa,IAAM,GAmBhD,SAASE,EAAaf,GACpBU,EAAIV,GAKN,SAASgB,EAAQhB,GACfU,EAAIV,GAKN,SAASU,EAAIV,GACX,IA1DqCiB,EAAoBjB,EAJ5BiB,EAAQjB,EAKEkB,EAAYlB,EACjDmB,EAiBFC,EAuCIC,EAAa,CACfC,MAAO,GACPC,OAAQ,CAAC,KA5D0BN,EA8DvBI,EAAYpB,EAAQuB,WA9DuBxB,EA8DXA,EA3C9CoB,EAAQnB,EAAQD,KAAKyB,QAAU,OAAS,SAvBXR,EAwBvBA,EAnBiCC,EAmBXjB,EAAQD,KAAKuB,OAAOH,GAnBGpB,EAmBKA,EAjB1D0B,GAAGC,cAAcT,EAAY,SAAUU,GACrC,GAAmB,KAAfA,EAAOC,KAST,MAAM,IAAIC,MAAMF,EAAOG,SARvB,IAAIC,EAAWJ,EAAO5B,KAGpBmB,EADqB,mBAAZa,EACJA,EAAShC,GAETgC,IAd4BhC,EAoBhCmB,EAnBTF,EAAOM,OAASvB,EAxCD,SAAoBA,GACnC,IAAIiC,EAAOjC,EAAKkC,MAAM,mBAAqBlC,EAAKkC,MAAM,mBAAqB,GAM3E,OALA5B,EAAKA,KAAK2B,EAAKE,KAAOF,EAAKE,KAAO,IAClC5B,EAAOD,KAAK2B,EAAKG,MAAQH,EAAKG,MAAQ,IAAM,IAC5C3B,EAAO4B,IAAI,QAASJ,EAAKG,MAAQH,EAAKG,MAAQ,IAAM,OACpD3B,EAAO6B,eAEC,GACN,KAAmB,KAAdL,EAAKG,MACR3B,EAAOJ,SAAS,kCAChB,MAEF,KAAkB,GAAb4B,EAAKG,MACR3B,EAAOJ,SAAS,mCAChB,MAEF,KAAkB,GAAb4B,EAAKG,MAIV,KAAkB,GAAbH,EAAKG,MACR3B,EAAOJ,SAAS,oCAChB,MAEF,KAAkB,GAAb4B,EAAKG,MACR3B,EAAOJ,SAAS,iCAChB,MAEF,QACEI,EAAOJ,SAAS,oCAIpBG,EAAQ+B,OAAO9B,GACfN,EAAaoC,OAAOjC,GACpBH,EAAaoC,OAAOhC,GACpBJ,EAAaoC,OAAO/B,GAsEhBgC,CAAWnB,GA/BTpB,EAAQD,KAAKyB,QACfvB,EAAqBuC,MAAMC,SAASC,KAAK,SAAU3C,GACzCA,EACR,IACI4C,EAAY3C,EAAQiC,MAAM,qBAAuBjC,EAAQiC,MAAM,qBAAuB,GACtFW,EAAS5C,EAAQiC,MAAM,uBAAyBjC,EAAQiC,MAAM,uBAAyB,8BACvFY,EAAO7C,EAAQiC,MAAM,qBAAuBjC,EAAQiC,MAAM,qBAAuB,MACrFhC,EAAqB6C,mBAAmBnC,EAAIC,OAAKmC,OAAWA,OAAWA,EAJxD,KAI6EF,EAAMD,EAAQD,GAAWD,KAAK5B,EAAcC,KAG1IN,EAAI,OA0CV,MAZiC,mBAAtBT,EAAQD,KAAKiD,MACtBhD,EAAQD,KAAKiD,MAAM,WACjBvC,MAGFA,IAGET,EAAQiD,OACV/C,EAAakC,IAAIpC,EAAQiD,OAGpB/C","file":"toolkit/component/progress.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var element = data.element;\n    var serviceCenterService = data.serviceCenterService;\n    var innerContent = $(\"<div></div>\").addClass(\"progress-group\");\n    var units = [];\n    var text = $(\"<span></span>\").addClass(\"progress-text\");\n    var number = $(\"<span></span>\").addClass(\"progress-number\");\n    var pb_wrap = $(\"<div></div>\").addClass(\"progress sm\");\n    var pb_bar = $(\"<div></div>\").addClass(\"progress-bar\");\n\n    var renderItem = function renderItem(data) {\n      var item = data.$attr(\"series/0/data/0\") ? data.$attr(\"series/0/data/0\") : {};\n      text.text(item.name ? item.name : \"\");\n      number.text(item.value ? item.value + \"%\" : \"\");\n      pb_bar.css(\"width\", item.value ? item.value + \"%\" : \"0px\");\n      pb_bar.removeClass();\n\n      switch (true) {\n        case item.value == 100:\n          pb_bar.addClass(\"progress-bar progress-bar-aqua\");\n          break;\n\n        case item.value > 90:\n          pb_bar.addClass(\"progress-bar progress-bar-green\");\n          break;\n\n        case item.value > 80:\n          pb_bar.addClass(\"progress-bar progress-bar-yellow\");\n          break;\n\n        case item.value > 70:\n          pb_bar.addClass(\"progress-bar progress-bar-yellow\");\n          break;\n\n        case item.value > 60:\n          pb_bar.addClass(\"progress-bar progress-bar-red\");\n          break;\n\n        default:\n          pb_bar.addClass(\"progress-bar progress-bar-danger\");\n          break;\n      }\n\n      pb_wrap.append(pb_bar);\n      innerContent.append(text);\n      innerContent.append(number);\n      innerContent.append(pb_wrap);\n    };\n\n    var setSeries = function setSeries(target, data) {\n      target.series = data;\n    };\n\n    var setParameters = function setParameters(target, parameters, data) {\n      var runExpression = function runExpression(expression, data) {\n        var rs;\n        $$.runExpression(expression, function (funRes) {\n          if (funRes.code == \"0\") {\n            var fnResult = funRes.data;\n\n            if (typeof fnResult == 'function') {\n              rs = fnResult(data);\n            } else {\n              rs = fnResult;\n            }\n          } else {\n            throw new Error(funRes.message);\n          }\n        });\n        return rs;\n      };\n\n      var dtype = element.data.applied ? \"bind\" : \"manual\";\n      setSeries(target, runExpression(element.data.series[dtype], data));\n    };\n\n    var run = function run() {\n      var getCiKpi_back = function getCiKpi_back(ci, kpi) {\n        var ci = element.data.resource ? element.data.resource : [];\n        var kpi = element.data.kpi ? element.data.kpi : [];\n        var baseOption = {\n          title: {},\n          series: [{}]\n        };\n\n        if (element.data.applied) {\n          serviceCenterService.units.getAll().then(function (data) {\n            units = data;\n            var category = \"ci\";\n            var condition = element.$attr(\"advance/condition\") ? element.$attr(\"advance/condition\") : [];\n            var method = element.$attr(\"advance/getfunction\") ? element.$attr(\"advance/getfunction\") : 'kpiDataService.getValueList';\n            var type = element.$attr(\"advance/paramtype\") ? element.$attr(\"advance/paramtype\") : \"kpi\";\n            serviceCenterService.getValueListBytime(ci, kpi, undefined, undefined, undefined, category, type, method, condition).then(getValueList, failure);\n          });\n        } else {\n          run({});\n        }\n\n        function getValueList(data) {\n          run(data);\n        }\n\n        ;\n\n        function failure(data) {\n          run(data);\n        }\n\n        ;\n\n        function run(data) {\n          var baseOption = {\n            title: {},\n            series: [{}]\n          };\n          setParameters(baseOption, element.parameters, data);\n          renderItem(baseOption);\n        }\n\n        ;\n      };\n\n      element.getCiKpi(getCiKpi_back);\n    };\n\n    if (typeof element.data.defer == 'function') {\n      element.data.defer(function () {\n        run();\n      });\n    } else {\n      run();\n    }\n\n    if (element.style) {\n      innerContent.css(element.style);\n    }\n\n    return innerContent;\n  };\n});"],"sourceRoot":"/source/"}