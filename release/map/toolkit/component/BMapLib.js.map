{"version":3,"sources":["toolkit/component/BMapLib.js"],"names":["define","initFn","clickFn","infoWindowOpenFn","popupTrigger","BMapLib","obj","cur","this","mapDom","mapStyle","$attr","callback","BMap","setTimeout","count","id","attr","map","Map","setMapStyle","styleJson","_map","addEventListener","event","renderMarkers","renderPolygons","target","find","remove","wait","size","require","a","b","Error","undefined","window","_markGroup","_polygonGroup","_symbolGroup","prototype","centerAndZoom","point","level","Point","enableScrollWheelZoom","bool","setZoom","zoom","closeInfoWindow","setCenter","arr","openInfoWindow","pt","lng","lat","html","infoWindow","InfoWindowOptions","width","height","title","offset","Size","infoWnd","InfoWindow","data","getContent","addSquare","self","myIcon","Icon","polygon","Marker","icon","enableClicking","enableMassClear","_maskGroup","push","i","length","removeOverlay","addOverlay","addMarker","iconObj","symbolObj","iconOption","imageSize","url","symbolOptions","rotation","rotate","fillColor","strokeColor","strokeWeight","fillOpacity","Symbol","inx","numbers","points","createSymbol","markerOptions","marker","minZoom","maxZoom","symbol","_point","setZIndex","e","getInfoWindow","addPolygon","Polygon","setPath","x0","y0","x1","y1","angle","Math","PI","cos","sin","createPolygon","path","setHighlightByMakerId","zIndex","loopMarker","type","setIcon","render","renderSymbols","addMarkers","addPolygons","addSymbols","addSymbol","getZoom"],"mappings":"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","file":"toolkit/component/BMapLib.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  var initFn, clickFn, infoWindowOpenFn, popupTrigger;\n\n  var BMapLib = function BMapLib(obj) {\n    var cur = this;\n    /**@param obj = {\n          mapDom : mapDom,\n          on : {\n            init : function(event){\n              ;\n            },\n            click : function(event){\n              ;\n            }\n          }\n        }*/\n\n    var mapDom = obj.mapDom;\n    var mapStyle = obj.mapStyle;\n    popupTrigger = obj.$attr(\"popupTrigger\");\n    initFn = obj.$attr(\"init\");\n    clickFn = obj.$attr(\"click\");\n    infoWindowOpenFn = obj.$attr(\"infoWindowOpen\");\n\n    var baiduIconLoaded = function baiduIconLoaded(callback) {\n      var count = 0;\n      wait();\n\n      function wait() {\n        count += 1;\n        setTimeout(function () {\n          if (count < 200) {\n            if (mapDom.find(\".anchorBL\").size() < 2) {\n              wait();\n            } else {\n              callback();\n            }\n          } else {\n            callback();\n          }\n        });\n      }\n    };\n\n    var getBaiduMap = function getBaiduMap(callback) {\n      require(['baiduMap', 'bmap'], function (a, b) {\n        var count = 0;\n        wait();\n\n        function wait() {\n          if (count < 20) {\n            count += 1;\n            setTimeout(function () {\n              if (window.BMap == undefined) {\n                wait();\n              } else {\n                callback(window.BMap);\n              }\n            });\n          } else {\n            throw new Error('百度视图获取失败!!');\n          }\n        }\n      }, function error() {\n        ;\n        callback();\n      });\n    };\n\n    getBaiduMap(function (BMap) {\n      setTimeout(function () {\n        var id = mapDom.attr(\"id\");\n        var map = new BMap.Map(id);\n        map.setMapStyle({\n          styleJson: mapStyle\n        });\n        cur._map = map;\n        map.addEventListener(\"zoomend\", function (event) {\n          cur.renderMarkers();\n          cur.renderPolygons();\n        });\n        ;\n\n        if (typeof initFn == \"function\") {\n          initFn({\n            target: mapDom\n          });\n        }\n\n        baiduIconLoaded(function () {\n          mapDom.find(\".anchorBL\").remove();\n        });\n      });\n    });\n    this._markGroup = [];\n    this._polygonGroup = [];\n    this._symbolGroup = [];\n  };\n\n  BMapLib.prototype.centerAndZoom = function (point, level) {\n    var map = this._map;\n    var point = new BMap.Point(point[0], point[1]);\n    map.centerAndZoom(point, level);\n  };\n\n  BMapLib.prototype.enableScrollWheelZoom = function (bool) {\n    var map = this._map;\n    map.enableScrollWheelZoom(bool);\n  };\n\n  BMapLib.prototype.setZoom = function (zoom) {\n    var map = this._map;\n\n    var closeInfoWindow = function closeInfoWindow() {\n      map.closeInfoWindow();\n    };\n\n    setTimeout(function () {\n      closeInfoWindow();\n    });\n    map.setZoom(zoom);\n  };\n\n  BMapLib.prototype.setCenter = function (arr) {\n    var map = this._map;\n    var point = new BMap.Point(arr[0], arr[1]);\n    map.setCenter(point);\n  };\n\n  BMapLib.prototype.openInfoWindow = function (point) {\n    var pt = new BMap.Point(point.lng, point.lat);\n    var map = this._map;\n    var infoWindow = point.infoWindow || {};\n    var html = infoWindow.html;\n    var InfoWindowOptions = {\n      width: point.infoWindow.width ? point.infoWindow.width : 150,\n      // 信息窗口宽度\n      height: point.infoWindow.height ? point.infoWindow.height : 180,\n      // 信息窗口高度\n      title: point.infoWindow.title ? point.infoWindow.title : \"信息窗口\",\n      // 信息窗口标题\n      offset: new BMap.Size(5, -30)\n    };\n    var infoWnd = new BMap.InfoWindow(html, InfoWindowOptions);\n    map.openInfoWindow(infoWnd, pt);\n    setTimeout(function () {\n      if (typeof infoWindowOpenFn == \"function\") {\n        infoWindowOpenFn({\n          data: point,\n          html: infoWnd.getContent()\n        });\n      }\n\n      ;\n    });\n  };\n  /**\n   * 绘制正方形\n   */\n\n\n  BMapLib.prototype.setMapStyle = function (mapStyle) {\n    var map = this._map;\n    map.setMapStyle({\n      styleJson: mapStyle\n    });\n  };\n\n  BMapLib.prototype.addSquare = function (point) {\n    //创建正方形轮廓\n    var self = this;\n    var map = this._map;\n    var point = new BMap.Point(point.lng, point.lat);\n    var pt = new BMap.Point(point.lng, point.lat); //  备注：   \"http://5z6kbx.natappfree.cc/sqare.png\"  必须在公网的服务器部署,这个是我本机器开的公网服务器地址\n\n    var myIcon = new BMap.Icon(\"../images/baidumap/sqare.png\", new BMap.Size(50, 50));\n    var polygon = new BMap.Marker(pt, {\n      icon: myIcon,\n      enableClicking: true,\n      enableMassClear: true\n    });\n    self._maskGroup = self._maskGroup || [];\n\n    self._maskGroup.push(polygon);\n\n    for (var i = 0; i < self._maskGroup.length; i++) {\n      map.removeOverlay(self._maskGroup[i]);\n    }\n\n    map.addOverlay(polygon);\n  };\n\n  BMapLib.prototype.addMarker = function (point) {\n    var self = this;\n    var map = this._map;\n    var pt = new BMap.Point(point.lng, point.lat);\n    var iconObj = point.$attr(\"icon/normal\") || null;\n    var symbolObj = point.$attr(\"symbol/normal\") || null; //var clickFn = point.$attr(\"on/click\");\n\n    var createSymbol = function createSymbol(arr) {\n      var points = \"\";\n\n      var creatPoint = function creatPoint(inx, numbers) {\n        if (inx == 0) {\n          points += \"M\" + numbers[0] + \" \" + numbers[1] + \" \";\n        } else if (inx == arr.length - 1) {\n          points += \"L\" + numbers[0] + \" \" + numbers[1] + \" Z\";\n        } else {\n          points += \"L\" + numbers[0] + \" \" + numbers[1] + \" \";\n        }\n      };\n\n      for (var i in arr) {\n        creatPoint(i, arr[i]);\n      }\n\n      ;\n      var result = \"d='\" + points + \"'\";\n      return result;\n    };\n\n    var icon = {};\n\n    if (iconObj) {\n      var size = new BMap.Size(iconObj.width, iconObj.height);\n      var imageSize = new BMap.Size(iconObj.width, iconObj.height);\n      var iconOption = {\n        size: size,\n        imageSize: imageSize\n      };\n      icon = new BMap.Icon(iconObj.url, size, iconOption);\n    } else if (symbolObj) {\n      var symbolOptions = {\n        rotation: symbolObj.rotate || 0,\n        fillColor: \"yellow\",\n        strokeColor: \"#000\",\n        strokeWeight: 1,\n        fillOpacity: 1\n      };\n      icon = new BMap.Symbol(createSymbol([[-10, 15], [10, 15], [0, -15], [-10, 15]]), symbolOptions);\n    }\n\n    var markerOptions = {};\n    markerOptions.title = point.title;\n    markerOptions.icon = icon;\n    markerOptions.rotation = point.rotation;\n    var marker = new BMap.Marker(pt, markerOptions);\n    marker.id = point.id;\n    marker.minZoom = point.minZoom;\n    marker.maxZoom = point.maxZoom;\n    marker.iconObj = point.icon;\n    marker.symbolObj = point.symbol;\n    marker._point = point;\n    /**\n     * 1.marker的层级必须高于外边轮廓（addSquare）的层级\n     * 解决不能继续点击的问题，提高marker的层级\n     */\n\n    marker.setZIndex(0);\n\n    var closeInfoWindow = function closeInfoWindow() {\n      map.closeInfoWindow();\n    };\n\n    var getInfoWindow = function getInfoWindow() {\n      map.getInfoWindow();\n    };\n\n    marker.addEventListener(\"mouseover\", function () {\n      if (popupTrigger == \"mouseover\") {\n        self.openInfoWindow(point); //self.addSquare(point);\n      }\n    });\n    /**\n     marker.addEventListener(\"mouseout\", function(){\n      if(popupTrigger == \"mouseover\"){\n        closeInfoWindow();\n      };\n    });*/\n\n    marker.addEventListener(\"click\", function (event) {\n      if (clickFn) {\n        try {\n          clickFn({\n            data: point\n          });\n        } catch (e) {\n          ;\n        }\n      }\n\n      if (popupTrigger == \"mouseover\") {\n        closeInfoWindow();\n      } else if (popupTrigger == \"click\") {\n        if (getInfoWindow()) {\n          closeInfoWindow();\n        } else {\n          self.openInfoWindow(point);\n        }\n      }\n    });\n\n    this._markGroup.push(marker);\n\n    this.renderMarkers();\n  };\n\n  BMapLib.prototype.addPolygon = function (point) {\n    var self = this;\n    var map = this._map; //var clickFn = point.$attr(\"on/click\");\n\n    var createPolygon = function createPolygon(lng, lat, arr, rotate) {\n      var angle = rotate / 180 * Math.PI;\n      var points = [];\n\n      var creatPoint = function creatPoint(numbers) {\n        var x0 = numbers[0] * 0.7;\n        var y0 = numbers[1] * 1.4;\n        var x1 = x0 * Math.cos(angle) + y0 * Math.sin(angle);\n        var y1 = y0 * Math.cos(angle) - x0 * Math.sin(angle);\n        return new BMap.Point(lng + x1, lat + y1);\n      };\n\n      for (var i in arr) {\n        points.push(creatPoint(arr[i]));\n      }\n\n      ;\n      return points;\n    };\n\n    var pt = new BMap.Point(point.lng, point.lat);\n    var PolygonOptions = {\n      fillColor: \"yellow\",\n      strokeColor: \"#000\",\n      strokeWeight: 1,\n      fillOpacity: 1\n    };\n    var polygon = new BMap.Polygon(pt, PolygonOptions);\n    polygon.minZoom = point.minZoom;\n    polygon.maxZoom = point.maxZoom;\n    polygon._point = point;\n    polygon.setPath(createPolygon(point.lng, point.lat, point.path, point.rotate));\n\n    this._polygonGroup.push(polygon);\n\n    polygon.addEventListener(\"mouseover\", function (e) {\n      self.openInfoWindow(point);\n      /**\n       var infoWindow = point.infoWindow || {};\n       var html = infoWindow.html;\n       var InfoWindowOptions = {\n        width : point.infoWindow.width ? point.infoWindow.width : 150,     // 信息窗口宽度\n        height: point.infoWindow.height ? point.infoWindow.height : 180,     // 信息窗口高度\n        title : point.infoWindow.title ? point.infoWindow.title : \"信息窗口\" , // 信息窗口标题\n        offset : new BMap.Size(5, -30)\n      };\n       if (!point.infoWindow.options) point.infoWindow.options = InfoWindowOptions;\n       var infoWnd = new BMap.InfoWindow(html, point.infoWindow.options);\n       map.openInfoWindow(infoWnd, pt);*/\n    });\n    polygon.addEventListener(\"mouseout\", function () {//焦点离开时不关闭\n      //map.closeInfoWindow();\n    });\n    polygon.addEventListener(\"click\", function (event) {\n      map.closeInfoWindow();\n\n      if (clickFn) {\n        try {\n          clickFn({\n            data: point\n          });\n        } catch (e) {\n          ;\n        }\n      }\n    });\n    this.renderPolygons();\n  };\n\n  BMapLib.prototype.setHighlightByMakerId = function (id) {\n    var self = this;\n    var inx = 0;\n    var zIndex = 0;\n\n    var loopMarker = function loopMarker(inx) {\n      var marker = self._markGroup[inx];\n\n      if (marker) {\n        var type = marker.id == id ? \"highlight\" : \"normal\";\n\n        if (marker.iconObj) {\n          var iconObj = marker.iconObj[type] || null;\n          var size = new BMap.Size(iconObj.width, iconObj.height);\n          var imageSize = new BMap.Size(iconObj.width, iconObj.height);\n          var iconOption = {\n            size: size,\n            imageSize: imageSize\n          };\n          var icon = new BMap.Icon(iconObj.url, size, iconOption);\n          marker.setIcon(icon);\n\n          if (type == \"highlight\") {\n            marker.setZIndex(self._markGroup.length);\n            self.openInfoWindow(marker._point);\n          } else {\n            marker.setZIndex(zIndex);\n            zIndex++;\n          }\n\n          ;\n          inx++;\n          loopMarker(inx);\n        } else if (marker.symbolObj) {\n          if (type == \"highlight\") {\n            setTimeout(function () {\n              self.openInfoWindow(marker._point);\n\n              self._map.setCenter(marker.point);\n            });\n          }\n\n          inx++;\n          loopMarker(inx);\n        }\n      }\n    };\n\n    loopMarker(inx);\n    this.render();\n  };\n\n  BMapLib.prototype.render = function () {\n    this.renderPolygons();\n    this.renderMarkers();\n    this.renderSymbols();\n  };\n\n  BMapLib.prototype.addMarkers = function (points) {\n    var self = this;\n\n    for (var i in points) {\n      self.addMarker(points[i]);\n    }\n  };\n\n  BMapLib.prototype.addPolygons = function (points) {\n    var self = this;\n\n    for (var i in points) {\n      self.addPolygon(points[i]);\n    }\n  };\n\n  BMapLib.prototype.addSymbols = function (points) {\n    var self = this;\n\n    for (var i in points) {\n      self.addSymbol(points[i]);\n    }\n  };\n\n  BMapLib.prototype.renderPolygons = function () {\n    var self = this;\n    var map = this._map;\n\n    var loop = function loop(polygon) {\n      var zoom = self._map.getZoom();\n\n      if (zoom > polygon.minZoom && zoom <= polygon.maxZoom) {\n        map.addOverlay(polygon);\n      } else {\n        map.removeOverlay(polygon);\n      }\n    };\n\n    for (var i in this._polygonGroup) {\n      loop(this._polygonGroup[i]);\n    }\n  };\n\n  BMapLib.prototype.renderMarkers = function () {\n    var self = this;\n    var map = this._map;\n\n    var loop = function loop(marker) {\n      var zoom = self._map.getZoom();\n\n      if (zoom > marker.minZoom && zoom <= marker.maxZoom) {\n        map.addOverlay(marker);\n      } else {\n        map.removeOverlay(marker);\n      }\n    };\n\n    for (var i in this._markGroup) {\n      loop(this._markGroup[i]);\n    }\n  };\n\n  BMapLib.prototype.renderSymbols = function () {\n    var self = this;\n    var map = this._map;\n\n    var loop = function loop(symbol) {\n      var zoom = self._map.getZoom();\n\n      if (zoom > symbol.minZoom && zoom <= symbol.maxZoom) {\n        map.addOverlay(symbol);\n      } else {\n        map.removeOverlay(symbol);\n      }\n    };\n\n    for (var i in this._symbolGroup) {\n      loop(this._symbolGroup[i]);\n    }\n  };\n  /**\n   var getBaiduMap = function(callback){\n    require(['baiduMap', 'bmap'], function(a, b){\n      var count = 0;\n      wait();\n      function wait() {\n        if(count < 20) {\n          count += 1;\n          setTimeout(function(){\n            if(window.BMap == undefined) {\n              wait();\n            } else {\n              callback(window.BMap);\n            }\n          });\n        } else {\n          throw new Error('百度视图获取失败!!')\n        }\n      }\n    }, function error(){\n      ;\n      callback();\n    });\n  };\n   var lib = function(mapDom, callback){\n    var baiduIconLoaded = function(callback){\n      var count = 0;\n      wait();\n      function wait() {\n        count += 1;\n        setTimeout(function(){\n          if(count < 200){\n            if(mapDom.find(\".anchorBL\").size() < 2) {\n              wait();\n            } else {\n              callback();\n            }\n          } else {\n            callback();\n          }\n         });\n      }\n    };\n    getBaiduMap(function(BMap){\n      setTimeout(function(){\n        var id = mapDom.attr(\"id\");\n        var map = new BMap.Map(id);\n        var maplib = new BMapLib(map);\n        map.addEventListener(\"zoomend\", function(event){\n          maplib.renderMarkers();\n          maplib.renderPolygons();\n        });\n        baiduIconLoaded(function(){\n          //mapDom.find(\".anchorBL\").remove();//版权问题，不取消\n        });\n        callback(maplib);\n      });\n    })\n  };\n   return lib;*/\n\n\n  return BMapLib;\n});"],"sourceRoot":"/source/"}