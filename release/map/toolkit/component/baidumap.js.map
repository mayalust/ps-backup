{"version":3,"sources":["toolkit/component/baidumap.js"],"names":["define","data","element","previewMode","global","wrap","timeout","$","mapDom","style","css","attr","$$","runExpression","$attr","funRes","code","fnResult","system","expression","setSelfDom","mapStyle","convertor","inputArr","callback","getBaiduMap","window","BMap","Convertor","pointArr","returnPonitArr","loadCount","Math","ceil","length","i","point","Point","push","translate","status","j","points","undefined","require","a","b","count","wait","Error","setTimeout","convertorByApi","url","location","protocol","pointlen","coords","substring","jQuery","ajax","type","dataType","jsoncallback","success","result","error","e","getSampleData","icon","width","height","lng","lat","infoWindow","html","title","rotation","minZoom","maxZoom","render","ms","loadExternalJs","BMapLib","infoWindowOpen","event","content","button","find","on","id","this","modelId","resourceId","params","linkTo","JSON","stringify","projectId","customerId","initFn","enableScrollWheelZoom","centerAndZoom","center","zoom","markers","addMarkers","polygons","addPolygons","symbols","addSymbols","setZoom","setCenter","array","setHighlightByMakerId","setMapStyle","getBMapLibMap","_map","clickFn","createItem","dom","append","popupTrigger","init","click","target","fnOK","value","map","getLibMapObj","end","parseInt","Date","getTime","start","rs","commonMethod","getShipTrack","res","mapLib","k","lon","fix","toFixed","time","pointList","trackPoint","pointObj","sym","Symbol","BMap_Symbol_SHAPE_CIRCLE","scale","strokeWeight","fillColor","strokeColor","fillOpacity","polyline","Polyline","strokeOpacity","addOverlay","size","Size","imageSize","Icon","imageOffset","n","pSize","marker","Marker","label","Label","getDateTime","utc","offset","setStyle","background","borderRadius","textAlign","borderWidth","borderColor","borderStyle","lineHeight","setLabel","setTitle","setShadow","trail","expressionLoaded"],"mappings":"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","file":"toolkit/component/baidumap.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var element = data.element;\n    var previewMode = data.previewMode;\n    var global = data.global;\n    var timeout = data.timeout;\n    var wrap = $(\"<div></div>\");\n    var mapDom = $(\"<div></div>\");\n\n    if (element.style) {\n      mapDom.css(element.style);\n    }\n\n    ;\n    mapDom.attr(\"id\", \"baidumap\");\n    mapDom.attr(\"class\", \"baidu-maps\");\n    var expression;\n    $$.runExpression(element.$attr(\"advance/expression\"), function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n\n        if (typeof fnResult == 'function') {\n          expression = fnResult(data, system);\n        } else {\n          expression = fnResult;\n        }\n\n        expression = expression ? expression : {};\n      } else {\n        expression = {};\n        expressionLoaded(expression); //throw new Error(funRes.message);\n      }\n    });\n\n    function expressionLoaded(expression) {\n      element.setSelfDom(wrap);\n      var mapStyle = element.runExpression(element.$attr(\"parameters/mapStyle\"));\n      var clickFn = expression.$attr(\"on/click\");\n\n      var convertor = function convertor(inputArr, callback) {\n        getBaiduMap(function () {\n          var convertor = new window.BMap.Convertor();\n          var pointArr = [];\n          var returnPonitArr = [];\n          var loadCount = Math.ceil(inputArr.length / 10);\n\n          for (var i = 0; i < inputArr.length; i++) {\n            var point = new window.BMap.Point(inputArr[i][0], inputArr[i][1]);\n            pointArr.push(point);\n\n            if (pointArr.length == 10) {\n              (function (i) {\n                convertor.translate(pointArr, 1, 5, function (data) {\n                  if (data.status === 0) {\n                    loadCount--;\n\n                    for (var j = 0; j < 10; j++) {\n                      returnPonitArr[i - 9 + j] = data.points[j];\n                    }\n\n                    if (loadCount == 0) {\n                      callback(returnPonitArr);\n                    }\n                  }\n                });\n                pointArr = [];\n              })(i);\n            }\n          }\n\n          if (pointArr.length > 0) {\n            convertor.translate(pointArr, 1, 5, function (data) {\n              if (data.status === 0) {\n                loadCount--;\n\n                for (var j = 0; j < pointArr.length; j++) {\n                  returnPonitArr[inputArr.length - pointArr.length + j] = data.points[j];\n                }\n\n                if (loadCount == 0) {\n                  callback(returnPonitArr);\n                }\n              }\n            });\n          }\n        });\n      };\n\n      element.convertor = convertor;\n\n      var getBaiduMap = function getBaiduMap(callback) {\n        if (window.BMap == undefined) {\n          require(['baiduMap', 'bmap'], function (a, b) {\n            var count = 0;\n            wait();\n\n            function wait() {\n              if (count < 20) {\n                count += 1;\n                setTimeout(function () {\n                  if (window.BMap == undefined) {\n                    wait();\n                  } else {\n                    callback(window.BMap);\n                  }\n                });\n              } else {\n                throw new Error('百度视图获取失败!!');\n              }\n            }\n          }, function error() {\n            ;\n            callback();\n          });\n        } else {\n          callback();\n        }\n      };\n\n      var convertorByApi = function convertorByApi(inputArr, callback) {\n        getBaiduMap(function () {\n          var url = window.location.protocol + \"//api.map.baidu.com/geoconv/v1/?from=1&to=5&ak=eMekSXxqG1j2wLM57RFN61l8T6eB1EDx&coords=\";\n          var pointlen = 0;\n          var returnPonitArr = [];\n          var coords = \"\";\n          var loadCount = Math.ceil(inputArr.length / 80);\n\n          for (var i = 0; i < inputArr.length; i++) {\n            coords += inputArr[i][0] + \",\" + inputArr[i][1] + \";\";\n            pointlen++;\n\n            if (pointlen == 80) {\n              coords = coords.substring(0, coords.length - 1);\n\n              (function (i) {\n                jQuery.ajax({\n                  type: \"GET\",\n                  url: url + coords,\n                  dataType: \"jsonp\",\n                  jsoncallback: 'callBack',\n                  success: function success(data) {\n                    if (data.status === 0) {\n                      loadCount--;\n\n                      for (var j = 0; j < 80; j++) {\n                        returnPonitArr[i - 79 + j] = new window.BMap.Point(data.result[j][\"x\"], data.result[j][\"y\"]);\n                      }\n\n                      if (loadCount == 0) {\n                        callback(returnPonitArr);\n                      }\n                    }\n                  },\n                  error: function error(e) {\n                    ;\n                  }\n                });\n                pointlen = 0;\n                coords = \"\";\n              })(i);\n            }\n          }\n\n          if (pointlen > 0) {\n            coords = coords.substring(0, coords.length - 1);\n            jQuery.ajax({\n              type: \"GET\",\n              url: url + coords,\n              dataType: \"jsonp\",\n              jsoncallback: 'callBack',\n              success: function success(data) {\n                if (data.status === 0) {\n                  loadCount--;\n\n                  for (var j = 0; j < pointlen; j++) {\n                    returnPonitArr[inputArr.length - pointlen + j] = new window.BMap.Point(data.result[j][\"x\"], data.result[j][\"y\"]);\n                  }\n\n                  if (loadCount == 0) {\n                    callback(returnPonitArr);\n                  }\n                }\n              },\n              error: function error(e) {\n                ;\n              }\n            });\n          }\n        });\n      };\n\n      element.convertorByApi = convertorByApi;\n\n      var render = function render(data, ms) {\n        ;\n        /**@param data : Object */\n\n        /**\n         data = {\n        markers : markers\n        }*/\n\n        /** @param makers : Array */\n\n        /** @class marker\n         marker = {\n        icon : {\n          url : \"../images/ouke/oukeIcon1.svg\",\n          width : 30,\n          height : 30\n        },\n        lng : 116.404,\n        lat : 39.915,\n        infoWindow : {\n          html : \"项目名称1<br><hr />告警总数:12<br>工单总数:14<br>告警总数:12<br>工单总数:14<br>告警总数:12<br>工单总数:14\"\n        },\n        title : \"标题1\",\n        rotation : 0,\n        minZoom : 0,\n        maxZoom : 10\n        }*/\n\n        $$.loadExternalJs(['BMapLib'], function (BMapLib) {\n          var bmp;\n          setTimeout(function () {\n            bmp = new BMapLib({\n              mapDom: mapDom,\n              popupTrigger: previewMode ? \"mouseover\" : \"click\",\n              init: initFn,\n              click: clickFn,\n              infoWindowOpen: infoWindowOpen,\n              mapStyle: ms || mapStyle\n            });\n          });\n\n          function infoWindowOpen(event) {\n            var content = event.html;\n            var point = event.data;\n            var button = $(content).find(\"button\");\n            button.on(\"click\", function (event) {\n              var id = $(this).attr(\"id\");\n\n              if (id == \"device\") {\n                var modelId = point.data.modelId;\n                var resourceId = point.data.id;\n                var params = {\n                  modelId: modelId,\n                  resourceId: resourceId\n                };\n                element.linkTo(\"../app-freeboard/index.html#/template/device/dashboard/\" + JSON.stringify(params));\n              } else if (id == \"model\") {\n                var modelId = point.data.modelId;\n                var params = {\n                  modelId: modelId\n                };\n                element.linkTo(\"../app-freeboard/index.html#/template/model/dashboard/\" + JSON.stringify(params));\n              } else if (id == \"project\") {\n                var projectId = point.data.projectId;\n                var params = {\n                  projectId: projectId\n                };\n                element.linkTo(\"../app-freeboard/index.html#/template/project/dashboard/\" + JSON.stringify(params));\n              } else if (id == \"customer\") {\n                var customerId = point.data.customerId;\n                var params = {\n                  customerId: customerId\n                };\n                element.linkTo(\"../app-freeboard/index.html#/template/customer/dashboard/\" + JSON.stringify(params));\n              }\n            });\n          }\n\n          ;\n\n          function initFn(event) {\n            BMapLib.enableScrollWheelZoom(true);\n            BMapLib.centerAndZoom(data.center, data.zoom);\n\n            if (data.markers) {\n              BMapLib.addMarkers(data.markers);\n            }\n\n            ;\n\n            if (data.polygons) {\n              BMapLib.addPolygons(data.polygons);\n            }\n\n            ;\n\n            if (data.symbols) {\n              BMapLib.addSymbols(data.symbols);\n            }\n\n            ;\n            BMapLib.render();\n\n            element.setZoom = function (zoom) {\n              BMapLib.setZoom(zoom);\n            };\n\n            element.setCenter = function (array) {\n              BMapLib.setCenter(array);\n            };\n\n            element.setHighlightByMakerId = function (id) {\n              BMapLib.setHighlightByMakerId(id);\n            };\n\n            element.setMapStyle = function (mapStyle) {\n              if (mapStyle) {\n                BMapLib.setMapStyle(mapStyle);\n              }\n            };\n\n            element.getBMapLibMap = function () {\n              return BMapLib._map;\n            };\n          }\n\n          ;\n\n          function clickFn(event) {\n            var point = event.data;\n\n            if (previewMode) {\n              var clickFn = point.$attr(\"on/click\");\n\n              if (typeof clickFn == \"function\") {\n                try {\n                  clickFn(event);\n                } catch (e) {\n                  ;\n                }\n              }\n\n              ;\n            } else {\n              var createItem = function createItem(point) {\n                var dom = $(\"<div>\" + point.$attr(\"data/label\") + \"仪表板配置</div>\");\n                dom.append($(\"<hr/>\"));\n\n                if (point.type == \"device\") {\n                  dom.append($(\"<button id='model' class='btn btn-default'><span class='glyphicon glyphicon-cog' style='margin-right:5px;'></span>配置设备仪表板</button>\"));\n                  dom.append($(\"<br/>\"));\n                  dom.append($(\"<button id='device' class='btn btn-default'><span class='glyphicon glyphicon-cog' style='margin-right:5px;'></span>配置单设备视图</button>\"));\n                } else if (point.type == \"project\") {\n                  dom.append($(\"<button id='project' class='btn btn-default'><span class='glyphicon glyphicon-cog' style='margin-right:5px;'></span>配置项目仪表板</button>\"));\n                } else if (point.type == \"customer\") {\n                  dom.append(\"<button id='customer' class='btn btn-default'><span class='glyphicon glyphicon-cog' style='margin-right:5px;'></span>配置客户仪表板</button>\");\n                } else {\n                  dom.append(\"无下钻\");\n                }\n\n                ;\n                return dom[0];\n              };\n\n              if (point.type) {\n                point.infoWindow.html = createItem(point);\n              } else {\n                var clickFn = point.$attr(\"on/click\");\n\n                if (typeof clickFn == \"function\") {\n                  try {\n                    clickFn(event);\n                  } catch (e) {\n                    ;\n                  }\n                }\n\n                ;\n              }\n\n              ;\n            }\n\n            ;\n          }\n        });\n      };\n\n      element.getSampleData = function () {\n        return {\n          icon: {\n            url: \"../images/ouke/oukeIcon1.svg\",\n            width: 30,\n            height: 30\n          },\n          lng: 116.404,\n          lat: 39.915,\n          infoWindow: {\n            html: \"项目名称1<br><hr />告警总数:12<br>\"\n          },\n          title: \"标题1\",\n          rotation: 0,\n          minZoom: 0,\n          maxZoom: 10\n        };\n      };\n\n      element.render = render;\n      var initFn = expression.$attr(\"on/init\");\n\n      if (typeof initFn == \"function\") {\n        try {\n          initFn({\n            target: element,\n            global: global\n          });\n        } catch (e) {\n          ;\n        }\n      } else {}\n\n      ; //render();\n      //\n\n      var trail = function trail(map, data, zoom, mapLib) {\n        var pointArr = []; // var zoom =map.getZoom();\n\n        for (var k = 0; k < data.length; k++) {\n          var lon = data[k].lon * 0.000001;\n          var lat = data[k].lat / 1000000;\n          pointArr.push({\n            \"fix\": {\n              lng: lon.toFixed(6),\n              lat: lat.toFixed(6)\n            },\n            \"time\": data[k]\n          });\n        }\n\n        var pointList = []; // 生成坐标点\n\n        var trackPoint = [];\n        var pointObj = [];\n\n        for (var i in pointArr) {\n          trackPoint.push(new BMap.Point(pointArr[i].fix.lng, pointArr[i].fix.lat));\n          pointList.push(pointArr[i]);\n          pointObj.push(pointArr[i]);\n        } // map.centerAndZoom(trackPoint[0], 13);\n\n\n        var sym = new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {\n          scale: 5,\n          strokeWeight: 1,\n          fillColor: '#ffffff',\n          strokeColor: 'rgb(49, 73, 181)',\n          fillOpacity: 0.8\n        }); // 画线\n\n        var polyline = new BMap.Polyline(trackPoint, {\n          strokeColor: \"#1869AD\",\n          strokeWeight: 1,\n          strokeOpacity: 1\n        });\n        map.addOverlay(polyline); // 配置图片\n\n        var size = new BMap.Size(40, 70);\n        var offset = new BMap.Size(0, 13);\n        var imageSize = new BMap.Size(27, 42);\n        var start = new BMap.Icon(\"../images/map/start.png\", size, {\n          imageSize: imageSize,\n          imageOffset: new BMap.Size(8, -1)\n        });\n        var end = new BMap.Icon(\"../images/map/end.png\", size, {\n          imageSize: imageSize,\n          imageOffset: new BMap.Size(8, -1)\n        });\n        var sym = new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {\n          scale: 5,\n          strokeWeight: 1,\n          fillColor: '#ffffff',\n          strokeColor: 'rgb(49, 73, 181)',\n          fillOpacity: 0.8\n        });\n        var markers = [];\n\n        for (var n in pointList) {\n          var point = new BMap.Point(pointList[n].fix.lng, pointList[n].fix.lat);\n          var pSize = pointList.length - 1;\n          var pIcon = '';\n\n          if (n == 0) {\n            pIcon = start;\n          } else if (n == pSize) {\n            pIcon = end;\n          } else {\n            pIcon = sym;\n          }\n\n          var marker = new BMap.Marker(point, {\n            icon: sym\n          }); // 创建标注\n\n          var label = new BMap.Label($$.getDateTime(pointList[n].time.utc), {\n            offset: new BMap.Size(15, -25)\n          });\n          label.setStyle({\n            width: \"120px\",\n            background: \"transparent\",\n            borderRadius: \"5px\",\n            textAlign: \"center\",\n            borderWidth: \"1px\",\n            borderColor: \"#1869AD\",\n            borderStyle: \"solid\",\n            height: \"20px\",\n            lineHeight: \"20px\"\n          });\n          marker.setLabel(label);\n          marker.setTitle($$.getDateTime(pointList[n].time.utc));\n\n          if (n == 0) {\n            marker.setShadow(start);\n          } else if (n == pSize) {\n            marker.setShadow(end);\n          }\n\n          markers.push(marker);\n          map.addOverlay(marker);\n        }\n      };\n\n      window.fnOK = function (value) {\n        var map = element.getLibMapObj;\n        var end = parseInt(new Date().getTime() / 1000);\n        var start = end - 60 * 60 * 24 * 4;\n        var rs = new commonMethod();\n        var bm = new BMapLib();\n        var map2 = window.BMap;\n        rs.getShipTrack(\"\" + value + \"\", start, end, function (res) {\n          if (res.length > 0) {\n            trail(map, res, 12, map2);\n          }\n        });\n      };\n\n      wrap.append(mapDom);\n    }\n\n    return wrap;\n  };\n});"],"sourceRoot":"/source/"}