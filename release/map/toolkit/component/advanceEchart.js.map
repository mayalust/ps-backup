{"version":3,"sources":["toolkit/component/advanceEchart.js"],"names":["define","data","myChart","themeData","q","events","element","allLoadedPromise","defer","global","target","$scope","$","style","css","getTheme","theme","themeStr","expression","$attr","all","then","d","$$","runExpression","funRes","code","fnResult","system","initFn","clickFn","dblclickFn","$on","name","callback","$emit","showLoading","text","maskColor","textColor","hideLoading","resize","hideNoData","noDataDom","find","remove","show","hide","showNoData","attr","td","prepend","requireBack","echarts","themeObj","registerTheme","init","render","option","resolve","setOption","off","on","event","ui","linearGradient","a","b","c","e","graphic","LinearGradient","registerMap","type","mapJson","console","error","Info","th","require","runExpressionSuccess","destroy","clear","dispose","promise"],"mappings":"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","file":"toolkit/component/advanceEchart.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var myChart;\n    var q = data.q;\n    var events = {};\n    var element = data.element;\n    var allLoadedPromise = data.allLoadedPromise;\n    var themeData;\n    var defer = q.defer();\n    var global = data.global;\n    var $scope = data.$scope;\n    var target = $(\"<div></div>\");\n\n    if (element.style) {\n      target.css(element.style);\n    }\n\n    ;\n\n    if (element.getTheme) {\n      var theme = element.getTheme(themeStr);\n    } else {}\n\n    target.css(\"position\", \"relative\");\n    var themeStr = element.$attr(\"parameters/theme\");\n    var expression;\n    q.all(allLoadedPromise).then(function (d) {\n      events[\"allComponentReady\"];\n    });\n    $$.runExpression(element.$attr(\"advance/expression\"), function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n\n        if (typeof fnResult == 'function') {\n          expression = fnResult(data, system);\n        } else {\n          expression = fnResult;\n        }\n\n        expression = expression ? expression : {};\n      } else {\n        expression = {};\n        ; //throw new Error(funRes.message);\n      }\n\n      runExpressionSuccess(expression);\n    });\n\n    function runExpressionSuccess(expression) {\n      var initFn = expression.$attr(\"on/init\");\n      var clickFn = expression.$attr(\"on/click\");\n      var dblclickFn = expression.$attr(\"on/dblclick\"); // echart渲染\n\n      element.$on = function (name, callback) {\n        events[name] = callback;\n      };\n\n      element.$emit = function (name, data) {\n        typeof events[name] === \"function\" ? events[name](data) : null;\n      };\n\n      element.showLoading = function () {\n        //console.error( \"======\" + ( myChart ? myChart.id : myChart ));\n        myChart && myChart.showLoading('default', {\n          text: '计算中，请稍候...',\n          maskColor: '#164464',\n          textColor: '#fff'\n        });\n      };\n\n      element.hideLoading = function () {\n        myChart.hideLoading();\n      };\n\n      element.resize = function () {\n        myChart.resize();\n      };\n\n      element.hideNoData = function () {\n        var noDataDom = target.find(\"#noDataDom\");\n        noDataDom.remove();\n      };\n\n      element.show = function () {\n        target.css(\"display\", \"block\");\n      };\n\n      element.hide = function () {\n        target.css(\"display\", \"none\");\n      };\n\n      element.showNoData = function () {\n        target.find(\"#noDataDom\").remove();\n        var noDataDom = $(\"<table><tr><td></td></tr></table>\");\n        noDataDom.attr(\"id\", \"noDataDom\");\n        noDataDom.css(\"width\", \"100%\");\n        noDataDom.css(\"height\", \"100%\");\n        noDataDom.css(\"position\", \"absolute\");\n        noDataDom.css(\"z-index\", 1);\n        noDataDom.css(\"background-color\", \"#164464\");\n        var td = noDataDom.find(\"td\");\n        td.css(\"text-align\", \"center\");\n        td.css(\"vertical-align\", \"middle\");\n        td.text(\"暂无数据\");\n        target.prepend(noDataDom); //target.css(\"border\", \"1px solid red\");\n      };\n\n      var requireBack = function requireBack(echarts, themeObj) {\n        if (themeData) {\n          echarts.registerTheme('baogang', themeData);\n          myChart = echarts.init($(target)[0], 'baogang');\n        } else {\n          myChart = echarts.init($(target)[0], themeObj);\n        }\n\n        element.render = function (option) {\n          defer.resolve(\"echart render success!!\");\n\n          if (myChart == null) {\n            return;\n          }\n\n          myChart.setOption(option, true);\n          myChart.off(\"click\");\n          myChart.on(\"click\", function (event) {\n            if (clickFn) {\n              clickFn({\n                target: element,\n                global: global,\n                ui: event\n              });\n            }\n          });\n          myChart.off(\"dblclick\");\n          myChart.on(\"dblclick\", function (event) {\n            if (dblclickFn) {\n              dblclickFn({\n                target: element,\n                global: global,\n                ui: event\n              });\n            }\n          });\n          return myChart;\n        }; // 增加渐变的方法\n\n\n        element.linearGradient = function (a, b, c, d, e) {\n          return new echarts.graphic.LinearGradient(a, b, c, d, e);\n        };\n\n        element.registerMap = function (type, mapJson) {\n          echarts.registerMap(type, mapJson);\n        };\n\n        if (initFn) {\n          try {\n            initFn({\n              target: element,\n              global: global,\n              echarts: echarts\n            });\n          } catch (e) {\n            console.error(e);\n          }\n        }\n      };\n\n      if (theme == 'default') {\n        element.Info(\"../localdb/echartTheme/baogang.json\", function (th) {\n          themeData = th;\n\n          require(['echarts'], requireBack);\n        });\n      } else {\n        require(['echarts', theme], requireBack);\n      }\n\n      ;\n    }\n\n    element.destroy(function (e) {\n      //console.error(myChart.id + \"__删除成功( disposed )\");\n      myChart && myChart.clear();\n      myChart && myChart.dispose();\n      myChart = null;\n    });\n    target.promise = defer.promise;\n    return target;\n  };\n});"],"sourceRoot":"/source/"}