{"version":3,"sources":["toolkit/component/topo_remake.js"],"names":["define","data","elemData","newDimension","uuid","cellDiction","graph","tostring","Object","prototype","toString","extendTools","registry","self","element","viewId","all_resources","all_kpis","viewFlexService","serviceProxy","userLoginUIService","commonMethod","constructor","q","global","SwSocket","parentheight","parentwidth","json","JSON","taDom","completeCallback","complete","svgId","Math","defer","traverseRow","traverseCol","timeout","route","previewMode","openAngles","events","expression","mm","id","factory","parse","stringify","undefined","Error","isObject","obj","call","isNull","isUndefined","isArray","isNumber","isFunction","isString","isNaN","num","bind","target","fn","apply","arguments","find","arr","callback","i","length","filter","rs","push","clone","extend","a","b","each","eachProp","addCss","dom","css","elem","attr","getId","getResourceById","getKpisByModelId","origin","$$","runExpression","$attr","funRes","code","fnResult","resourceUIService","max_height","max_width","topo","$","wrap","serviceCenterService","kpiDataService","itemins","render","inputJson","cb_fun","context","getView","getViewSuccess","getViewById","view","content","waitload","setTimeout","loadJointJs","loadExternalJs","loadJointJsSuccess","reDrawImageAddress","cells","cell","type","attrs","image","substring","getExtendTools","tool","drawCell","findState","setLevel","value","range","attributes","eval","persent","prop","transition","transform","height","delay","duration","valueFunction","start","end","time","setOpenAngle","setValue","fillColor","color","state","color2","stateId","get","colorAry","colorAry2","joint","util","interpolate","hexColor","breathFlash","opacityState","flash","el","defaultOpacity","opacity","timingFunction","timing","inout","t","o","abs","Number","toFixed","jQuery","isNumeric","_","contains","getTransitions","on","path","off","bubbleFlash","r","changeIconAndText","forEach","item","alertText","alertIcon","stateDisplay","valueText","valueIcon","getFill","fill","getType","getTextFill","getAllUnit_success","units","elDom","getCell","stateType","rangeObj","unit","kpiObj","unitCode","unitType","split","resourceObj","modelId","kpiCode","y","position","unitName","getAll","then","getData_success","d","nodeId","ciKpiDefindSuccess","n","k","nodes","map","kpis","getRealTimeKpiData","getWebSocket","getCells","trigger","init","ciKpiDefination","getNumber","str","parseInt","replace","RegExp","ci","kpi","bool","returnObj","paramSocket","ciid","operation","register","event","send","promises","kpiId","getKpisSuccess","e","resolve","resource","promise","defineCell","all","clearWrap","children","remove","resetDimension","ch","cw","ph","pw","portion","persentage","scale","width","svg","linkView","dia","LinkView","patternMarkup","join","this","model","listenTo","update","cancelFrame","frameId","pattern","V","template","patternImage","findOne","paper","defs","append","_V","connection","stroke","strokeWidth","nextFrame","fillWithPattern","bbox","g","rect","moveAndExpand","x","points","concat","sourcePoint","targetPoint","point","canvas","document","createElement","ctx","getContext","lineWidth","lineJoin","lineCap","pointsCount","save","gradientPoints","gradient","createLinearGradient","drawPattern","restore","dataUri","toDataURL","xlink:href","from","to","angle","toRad","theta","center","line","midpoint","fromPolar","PI","beginPath","moveTo","lineTo","closePath","strokeStyle","innerWidth","outerWidth","lineColor","move","addColorStop","patternColor","config","defaultLink","Link",".marker-source",".marker-target",".connection","Graph","interactive","perpendicularLinks","gridSize","markAvailable","linkConnectionPoint","shapePerimeterConnectionPoint","Paper","fromJSON","bgimage","background-image","slice","background-size","background-position","background-repeat","name","controller","openAngle","ins","setPos","arrowheadMarkup","toolMarkup","vertexMarkup","display","size","echartViewId","chartWrap","ys","prepend","layout","$remapByChild","traverse","nodeIds","$remove","index","getResourceByIds","indexOf","numStr","strToNumer","getBymodelId","traveseByChild","elm","setSelfDom","$on","eventName","error","warning","font-size","min-height","text-align","line-height","setResources","resources","composoryRes","defineProperty","enumerable","createDeviceDropList","pos","p","hitArea","titleArea","popup","clickFn","titleClickFn","createDom","label","status","getAlertColor","text","node","createAttrDisp","planeMode","body","title","orderKey","findIndex","attrDisp","sort","ka","kb","tr","td1","td2","td3","td4","useMomentFormat","arisingTime","button","span1","devName","span2","message","span3","popover","placement","container","valueStr","toFix","updateValue","val","updateStatus","updateTime","destroy","getData","createCurrentStatus","txt","addOn","circle","wholeClick","getValue","getDomainAreaLineTree_alertStatus","domaintree","setParameter","instance","navigateToTab","growl","currentStatus","setAlarmStatus","createCurrentStatusByItem","ROLE","navigateTo","main","backHistory","createMarker","threeDbar","createAlarm","createAlarmSmall","smallMode","create3Dbar","getPersentageSite","tempPosition","initEvent","clickEvent","wholeClickEvent","style","underWatch","tools","console","assert"],"mappings":"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","file":"toolkit/component/topo_remake.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var elemData = data,\n        newDimension = {},\n        uuid,\n        cellDiction = {},\n        graph,\n        tostring = Object.prototype.toString,\n        extendTools = [],\n        extendTools = {},\n        registry = {};\n    var self = elemData.element;\n    var viewId = self.viewId;\n    var all_resources = [];\n    var all_kpis = [];\n    var viewFlexService = elemData.viewFlexService;\n    var serviceProxy = elemData.serviceProxy;\n    var userLoginUIService = elemData.userLoginUIService;\n    var element = elemData.element;\n    var commonMethod = element.constructor;\n    var q = elemData.q;\n    var global = elemData.global;\n    var SwSocket = elemData.SwSocket;\n    var parentheight, parentwidth;\n    var json = element.JSON;\n    var taDom;\n    var completeCallback = data.complete;\n    var svgId = \"svg_\" + Math.uuid();\n    var defer = elemData.defer;\n    var traverseRow = elemData.traverseRow;\n    var traverseCol = elemData.traverseCol;\n    var timeout = elemData.timeout;\n    var route = elemData.route;\n    var previewMode = elemData.previewMode;\n    var openAngles = {};\n    var events = {};\n    var expression;\n    var mm = defer.id;\n    var factory = JSON.parse(JSON.stringify(serviceProxy));\n\n    if (elemData == undefined) {\n      throw new Error(\"undefined\");\n    }\n\n    factory.origin = factory.origin + \"/\";\n\n    function isObject(obj) {\n      return tostring.call(obj) == \"[object Object]\";\n    }\n\n    function isNull(obj) {\n      return tostring.call(obj) == \"[object Null]\";\n    }\n\n    function isUndefined(obj) {\n      return tostring.call(obj) == \"[object Undefined]\";\n    }\n\n    function isArray(obj) {\n      return tostring.call(obj) == \"[object Array]\";\n    }\n\n    function isNumber(obj) {\n      /** 判断数字为有效数字不能为NAN */\n      return tostring.call(obj) == \"[object Number]\" && obj === obj;\n    }\n\n    function isFunction(obj) {\n      return tostring.call(obj) == \"[object Function]\";\n    }\n\n    function isString(obj) {\n      return tostring.call(obj) == \"[object String]\";\n    }\n\n    function isNaN(num) {\n      return num !== num;\n    }\n\n    function bind(target, fn) {\n      return function () {\n        fn.apply(target, arguments);\n      };\n    }\n\n    function find(arr, callback) {\n      var i;\n      arr = arr || [];\n\n      for (var i = 0; i < arr.length; i++) {\n        if (callback(arr[i], i)) {\n          return arr[i];\n        }\n      }\n    }\n\n    function filter(arr, callback) {\n      var i,\n          rs = [];\n      arr = arr || [];\n\n      for (var i = 0; i < arr.length; i++) {\n        if (callback(arr[i], i)) {\n          rs.push(arr[i]);\n        }\n      }\n\n      return rs;\n    }\n\n    function clone(obj) {\n      return JSON.parse(JSON.stringify(obj));\n    }\n\n    function extend(a, b) {\n      for (var i in b) {\n        a[i] = b[i];\n      }\n    }\n\n    function each(arr, callback) {\n      var i;\n      arr = arr || [];\n\n      for (i = 0; i < arr.length; i++) {\n        callback && callback(arr[i], i);\n      }\n    }\n\n    function eachProp(obj, callback) {\n      var i;\n      obj = obj || {};\n\n      for (var i in obj) {\n        callback && callback(obj[i], i);\n      }\n    }\n\n    function addCss(dom, css) {\n      eachProp(css, function (elem, attr) {\n        dom.css(attr, elem);\n      });\n    }\n\n    function getId(elem) {\n      var id;\n      isObject(elem) && (id = elem.id);\n      isString(elem) && (id = elem);\n      isNumber(elem) && (id = elem);\n      return id;\n    }\n\n    function getResourceById(id, callback) {\n      id && element.getResourceById(id, callback) || callback(null);\n    }\n\n    function getKpisByModelId(id, callback) {\n      id && element.getKpisByModelId(id, callback) || callback([]);\n    }\n\n    $$.runExpression(element.$attr(\"advance/expression\"), function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n        expression = fnResult;\n      } else {\n        ;\n      }\n    });\n    var resourceUIService = elemData.resourceUIService;\n    var max_height, max_width;\n    var topo = $(\"<div></div>\");\n    var wrap = $(\"<div></div>\");\n    topo.css(\"position\", \"relative\");\n    var resourceUIService = elemData.resourceUIService;\n    var serviceCenterService = elemData.serviceCenterService;\n    var kpiDataService = elemData.kpiDataService;\n\n    if (typeof element.setSelfDom == \"function\") {\n      element.setSelfDom(topo);\n    }\n\n    element.$on = function (eventName, callback) {\n      events[eventName] = callback;\n    };\n\n    element.off(\"$loadCiKpiComplete\");\n    element.off(\"$renderGraphComplete\");\n    topo.append(wrap);\n\n    self.error = function (str) {\n      wrap.children().remove();\n      var warning = $(\"<p>\" + str + \"</p>\");\n      warning.css({\n        \"font-size\": \"12px\",\n        \"min-height\": \"300px\",\n        \"text-align\": \"center\",\n        \"line-height\": \"300px\"\n      });\n      wrap.append(warning);\n    };\n\n    self.setResources = function (resources) {\n      self.composoryRes = resources;\n      Object.defineProperty(self, \"composoryRes\", {\n        enumerable: false\n      });\n    };\n\n    self.createDeviceDropList = function (data, pos, config) {\n      var p = newDimension.persentage || 1;\n      var hitArea = $(\"<div></div>\");\n      var titleArea = $(\"<div></div>\");\n      var popup = $(\"<div></div>\");\n      var config = config || {};\n      var clickFn = config.$attr(\"click\");\n      var titleClickFn = config.$attr(\"titleClick\");\n      $(\"#devicelistscroll\").remove();\n      hitArea.attr(\"id\", \"devicelistscroll\");\n      titleArea.css(\"width\", \"100%\");\n      titleArea.css(\"height\", \"50px\");\n      hitArea.css(\"position\", \"absolute\");\n      hitArea.css(\"z-index\", 199);\n      popup.css(\"padding\", \"2px\");\n      popup.css(\"background-color\", \"#1e415d\");\n      popup.css(\"border\", \"1px solid #000\");\n      popup.css(\"box-shadow\", \"1px 1px 10px 1px rgba(0,0,0,.5)\");\n      popup.css(\"max-height\", \"150px\");\n      popup.css(\"overflow-x\", \"hidden\");\n      popup.css(\"overflow-y\", \"auto\");\n      hitArea.css(\"cursor\", \"pointer\");\n      hitArea.css(\"top\", pos.y / p - (config.y || 30) + \"px\");\n      hitArea.css(\"left\", pos.x / p - (config.x || 50) + \"px\");\n      hitArea.css(\"background-color\", \"rgba(0,0,0,0)\");\n      hitArea.on(\"mouseleave\", function (event) {\n        $(\"#devicelistscroll\").remove();\n      });\n      titleArea.on(\"click\", function (event) {\n        titleClickFn();\n      });\n\n      var createDom = function createDom(item) {\n        var wrap = $(\"<div></div>\");\n        var label = $(\"<span></span>\");\n        var status = $(\"<div></div>\");\n        wrap.attr(\"id\", \"wrap\");\n        status.css(\"margin-right\", \"5px\");\n        status.css(\"width\", \"10px\");\n        status.css(\"height\", \"10px\");\n        status.css(\"border-radius\", \"50%\");\n        status.css(\"background-color\", self.getAlertColor(item.status));\n        status.css(\"display\", \"inline-block\");\n        wrap.css(\"padding\", \"5px 15px\");\n        label.text(item.label);\n        label.css(\"padding-right\", \"10px\");\n        wrap.append(status);\n        wrap.append(label);\n        wrap.on(\"mouseenter\", function (event) {\n          hitArea.find(\"#wrap\").css(\"background-color\", \"rgba(0,0,0,0)\");\n          wrap.css(\"background-color\", \"rgba(0,0,0,.3)\");\n        });\n        wrap.on(\"mouseleave\", function (event) {\n          wrap.css(\"background-color\", \"rgba(0,0,0,0)\");\n        });\n        wrap.on(\"click\", function (event) {\n          clickFn(item);\n        });\n        item.$on(\"statusChanged\", function (node) {\n          status.css(\"background-color\", self.getAlertColor(item.status));\n        });\n        return wrap;\n      };\n\n      for (var i in data) {\n        popup.append(createDom(data[i]));\n      }\n\n      hitArea.append(titleArea);\n      hitArea.append(popup);\n      topo.prepend(hitArea);\n    }; //150 - 235\n\n\n    self.createAttrDisp = function (t, data, pos, callback, planeMode) {\n      var popup, body, title, wrap;\n      var orderKey = ['震动', '冲击', \"速度有效值\", \"速度有效值\", \"冲击平均值\", \"冲击平均值\", '速度', '温度', '电压', '电流'];\n\n      function findIndex(arr, callback) {\n        var i, find;\n\n        for (i = 0; i < arr.length; i++) {\n          find = callback(arr[i], i);\n\n          if (find) {\n            return i;\n          }\n        }\n      }\n\n      function attrDisp() {\n        popup = $(\"<div></div>\");\n        body = $(\"<div></div>\");\n        title = $(\"<div></div>\");\n        wrap = $(\"<table></table>\");\n        popup.css(\"position\", \"absolute\");\n        popup.css(\"padding\", \"2px\");\n        popup.css(\"background-color\", \"rgba(30,65,93,.9)\");\n        popup.css(\"border\", \"1px solid #000\");\n        popup.css(\"box-shadow\", \"1px 1px 10px 1px rgba(0,0,0,.5)\");\n        popup.css(\"z-index\", 99);\n\n        if (planeMode) {\n          body.css(\"max-height\", \"300px\");\n          body.css(\"min-width\", \"380px\");\n        } else {\n          data.sort(function (a, b) {\n            ka = findIndex(orderKey, function (d) {\n              return a.label.indexOf(d) != -1;\n            }) || a.label;\n            kb = findIndex(orderKey, function (d) {\n              return b.label.indexOf(d) != -1;\n            }) || b.label;\n            return ka - kb;\n          });\n          body.css(\"max-height\", \"50px\");\n        }\n\n        body.css(\"overflow-y\", \"auto\");\n        body.css(\"overflow\", \"auto\");\n        title.css(\"text-align\", \"center\");\n        title.css(\"font-weight\", \"bold\");\n        title.css(\"padding\", \"3px\");\n        title.css(\"color\", \"#fff\");\n        title.css(\"background-color\", \"#295375\");\n        title.text(t); //      popup.css(\"top\", pos.y / persentage + \"px\");\n        //      popup.css(\"left\", pos.x / persentage + \"px\");\n\n        popup.css(\"top\", pos.y + \"px\");\n        popup.css(\"left\", pos.x + \"px\");\n        popup.append(title);\n\n        var createDom = function createDom(item) {\n          var tr = $(\"<tr></tr>\");\n          var td1 = $(\"<td></td>\");\n          var td2 = $(\"<td></td>\");\n          var td3 = $(\"<td></td>\");\n          var td4 = $(\"<td></td>\");\n          var time = useMomentFormat(item.arisingTime, \"yyyy-MM-dd hh:mm:ss\");\n          td1.css(\"padding\", \"5px 6px 1px 6px\");\n          td2.css(\"padding\", \"5px 6px 1px 6px\");\n          td3.css(\"padding\", \"5px 6px 1px 6px\");\n          td4.css(\"padding\", \"5px 6px 1px 6px\");\n          td1.css(\"vertical-align\", \"middle\");\n          td2.css(\"vertical-align\", \"middle\");\n          td3.css(\"vertical-align\", \"middle\");\n          td4.css(\"vertical-align\", \"middle\");\n          var label = $(\"<span></span>\");\n          var button = $('<button id=\"button\" rel=\"popover\" ></button>');\n\n          if (!planeMode) {\n            button.popover({\n              placement: \"right\",\n              trigger: \"manual\",\n              title: \"上报时间\",\n              container: \"body\",\n              content: function content() {\n                return time;\n              }\n            }).on(\"mouseenter\", mouseenter).on(\"mouseleave\", mouseleave);\n            label.text(item.label);\n            td1.append(label);\n          } else {\n            var span1 = $(\"<span>\" + item.devName + \"</span>\");\n            var span2 = $(\"<span>\" + item.message + \"</span>\");\n            var span3 = $(\"<span>\" + useMomentFormat(item.arisingTime, \"yyyy-MM-dd hh:mm:ss\") + \"</span>\");\n            span1.css(\"white-space\", \"normal\");\n            span2.css(\"white-space\", \"normal\");\n            span3.css(\"white-space\", \"normal\");\n            span1.css(\"display\", \"inline-block\");\n            span2.css(\"display\", \"inline-block\");\n            span3.css(\"display\", \"inline-block\");\n            span1.css(\"max-width\", \"100px\");\n            span2.css(\"max-width\", \"220px\");\n            td1.append(span1);\n            td3.append(span2);\n            td4.append(span3);\n          }\n\n          if (item.valueStr) {\n            button.text(item.valueStr);\n          } else if (item.value != \"-\") {\n            button.text(self.toFix(item.value, 2));\n          } else {\n            button.text(\"-\");\n          }\n\n          function mouseenter() {\n            if (t) {\n              $(this).popover(\"show\");\n            }\n          }\n\n          function mouseleave() {\n            $(this).popover(\"hide\");\n          } //button.popover(\"hide\");\n\n\n          label.css(\"color\", \"#aaa\");\n          label.css(\"padding-right\", \"10px\");\n\n          item.updateValue = function (value, unit) {\n            //;\n            var val = value != \"-\" ? self.toFix(value, 2) : \"-\";\n\n            if (unit != \"NA\" && unit) {\n              val += unit;\n            }\n\n            button.text(val);\n            this.value = value;\n          };\n\n          item.updateStatus = function (value) {\n            this.status = value;\n            button.css(\"background-color\", self.getAlertColor(value));\n          };\n\n          item.updateTime = function (t) {\n            if (t) {\n              time = useMomentFormat(t, \"yyyy-MM-dd hh:mm:ss\"); //button.popover(\"show\");\n            }\n          };\n\n          button.css(\"min-width\", \"50px\");\n          button.css(\"text-align\", \"center\");\n          button.css(\"line-height\", \"12px\");\n          button.css(\"border\", 0);\n          button.css(\"color\", \"#fff\");\n          button.css(\"border-radius\", \"10px\");\n          button.css(\"background-color\", self.getAlertColor(item.status));\n          button.on(\"click\", function (event) {\n            $(this).popover(\"destroy\");\n\n            if (callback) {\n              callback(item);\n            }\n          });\n\n          if (item.label) {\n            tr.append(td1);\n          }\n\n          if (planeMode) {\n            tr.append(td3);\n            tr.append(td4);\n          }\n\n          tr.append(td2);\n          td2.append(button);\n          return tr;\n        };\n\n        for (var i in data) {\n          wrap.append(createDom(data[i]));\n        }\n\n        body.append(wrap);\n        popup.append(body);\n        topo.append(popup);\n      }\n\n      attrDisp.prototype.destroy = function () {\n        popup.remove();\n      };\n\n      attrDisp.prototype.getData = function () {\n        return data;\n      };\n\n      return new attrDisp();\n    };\n\n    var itemins;\n\n    self.createCurrentStatus = function (txt, pos, status) {\n      var wrap = topo.find(\"div#cStatus\");\n      var title = $(\"<div></div>\");\n      var addOn = $(\"<div></div>\");\n      var circle = $(\"<div></div>\");\n      var ins;\n      wrap = wrap.size() ? wrap : $(\"<div id=\\\"cStatus\\\"></div>\");\n      wrap.children().remove();\n\n      function wholeClick() {\n        $(\"body\").off(\"click\");\n        ins.destroy();\n\n        if (itemins) {\n          itemins.destroy();\n        }\n      }\n\n      function clickFn(event) {\n        var p = newDimension.persentage || 1;\n        var data = self.getValue(\"device/alerts\");\n\n        if (ins) {\n          ins.destroy();\n        }\n\n        $(\"body\").off(\"click\");\n\n        if (data) {\n          if (data.length > 0) {\n            ins = self.createAttrDisp(\"告警信息\", data, {\n              x: pos.x / p - 200,\n              y: pos.y / p + 15\n            }, function (item) {\n              var nodeId = item.nodeId;\n              var resource;\n              var ROLE = self.getValue(\"global/ROLE\");\n              self.getDomainAreaLineTree_alertStatus(function (domaintree) {\n                domaintree.traverse(function (node) {\n                  if (node.id == nodeId) {\n                    self.setParameter(\"id\", node.id);\n                    self.setValue(\"global/resource\", node);\n                    self.setValue(\"global/instance\", item.instance);\n                    self.setParameter(\"sensorId\", item.id);\n                    self.setValue(\"global/alertTime\", item.arisingTime);\n                    self.navigateToTab(\"analysis\", 0, 1);\n                  }\n                });\n              });\n            }, true);\n            setTimeout(function () {\n              $(\"body\").on(\"click\", wholeClick);\n            });\n          } else {\n            self.growl(\"暂无未处理的告警信息！\");\n          }\n        }\n      }\n\n      function currentStatus() {\n        wrap.css(\"position\", \"absolute\");\n        var p = newDimension.persentage || 1;\n        wrap.css(\"cursor\", \"pointer\");\n        wrap.css(\"top\", pos.y / p + \"px\");\n        wrap.css(\"left\", pos.x / p + \"px\");\n        title.text(txt);\n        title.css(\"padding-right\", \"6px\");\n        title.css(\"font-weight\", \"bold\");\n        title.css(\"line-height\", \"14px\");\n        title.css(\"display\", \"inline-block\");\n        title.css(\"color\", \"#fff\");\n        addOn.css(\"display\", \"inline-block\");\n        circle.css(\"display\", \"block\");\n        circle.css(\"position\", \"absolute\");\n        circle.css(\"top\", \"1px\");\n        circle.css(\"width\", \"14px\");\n        circle.css(\"height\", \"14px\");\n        circle.css(\"border-radius\", \"50%\");\n        circle.css(\"background-color\", self.getAlertColor(status));\n        circle.css(\"box-shadow\", \"1px 1px 10px 1px rgba(0,0,0,1)\");\n\n        if (status > 0) {\n          title.css(\"text-decoration\", \"underline\");\n          wrap.off(\"click\");\n          wrap.on(\"click\", clickFn);\n        }\n\n        addOn.append(circle);\n        wrap.append(title);\n        wrap.append(addOn);\n        topo.append(wrap);\n      }\n\n      currentStatus.prototype.setAlarmStatus = function (status) {\n        circle.css(\"background-color\", self.getAlertColor(status));\n\n        if (status > 0) {\n          title.css(\"text-decoration\", \"underline\");\n          wrap.off(\"click\");\n          wrap.on(\"click\", clickFn);\n        }\n      };\n\n      return new currentStatus();\n    };\n\n    self.createCurrentStatusByItem = function (id, pos) {\n      function wholeClick() {\n        $(\"body\").off(\"click\");\n        if (itemins) itemins.destroy();\n      }\n\n      function clickFn(event) {\n        var p = newDimension.persentage || 1;\n        var data = self.getValue(\"device/alerts\");\n\n        if (itemins) {\n          itemins.destroy();\n        }\n\n        data = data.filter(function (elm) {\n          return elm.nodeId == id;\n        });\n        $(\"body\").off(\"click\");\n\n        if (data.length > 0) {\n          itemins = self.createAttrDisp(\"告警信息\", data, {\n            x: pos.x / p,\n            y: pos.y / p\n          }, function (item) {\n            var nodeId = item.nodeId;\n            var resource;\n            var ROLE = self.getValue(\"global/ROLE\");\n            self.getDomainAreaLineTree_alertStatus(function (domaintree) {\n              domaintree.traverse(function (node) {\n                if (node.id == nodeId) {\n                  self.setValue(\"global/resource\", node);\n                  self.setValue(\"global/instance\", item.instance);\n                  self.setValue(\"global/alertTime\", item.arisingTime);\n\n                  if (ROLE == 1) {\n                    self.navigateTo(\"index\", {\n                      main: 2,\n                      backHistory: 1\n                    }, \"self\");\n                  } else if (ROLE == 2) {\n                    self.navigateTo(\"index\", {\n                      main: 2,\n                      backHistory: 1\n                    }, \"self\");\n                  } else if (ROLE == 3) {\n                    self.navigateTo(\"index\", {\n                      main: 2,\n                      backHistory: 1\n                    }, \"self\");\n                  } else {\n                    self.growl(\"此角色无法显示特征曲线\");\n                  }\n                }\n              });\n            });\n          }, true);\n          setTimeout(function () {\n            $(\"body\").on(\"click\", wholeClick);\n          });\n        } else {\n          self.growl(\"此设备暂无未处理的告警信息！\");\n        }\n      }\n\n      clickFn();\n    };\n\n    self.createMarker = function (title, callback) {\n      $$.loadExternalJs([\"toolkit/configure/marker\"], function (threeDbar) {\n        var ins = threeDbar.init(svgId, {\n          title: title\n        });\n        callback(ins);\n      });\n    };\n\n    self.createAlarm = function (title, callback) {\n      $$.loadExternalJs([\"toolkit/configure/alarm\"], function (threeDbar) {\n        var ins = threeDbar.init(svgId, {\n          title: title\n        });\n        callback(ins);\n      });\n    };\n\n    self.createAlarmSmall = function (title, callback) {\n      $$.loadExternalJs(['toolkit/configure/alarm'], function (threeDbar) {\n        var ins = threeDbar.init(svgId, {\n          title: title,\n          smallMode: true\n        });\n        callback(ins);\n      });\n    };\n\n    self.create3Dbar = function (title, callback) {\n      $$.loadExternalJs(['toolkit/configure/3dbarchart'], function (threeDbar) {\n        var ins = threeDbar.init(svgId, {\n          title: title\n        }); //ins.setPos(cell.position());\n        //ins.setValue(0);\n\n        callback(ins);\n      });\n    }; //获得缩放的点位\n\n\n    self.getPersentageSite = function (position) {\n      var p = newDimension.persentage || 1;\n      var tempPosition = {\n        x: 0,\n        y: 0\n      };\n      tempPosition.x = position.x / p;\n      tempPosition.y = position.y / p;\n      return tempPosition;\n    };\n\n    function render(inputJson, cb_fun) {\n      var context;\n\n      function getView(inputJson, cb_fun) {\n        if (inputJson) {\n          getViewSuccess(json = inputJson);\n        } else {\n          self.getViewById(viewId, function (view) {\n            json = JSON.parse(view.content);\n            getViewSuccess(json);\n          });\n        }\n      }\n\n      function waitload(fn) {\n        setTimeout(fn, 4);\n      }\n\n      function loadJointJs() {\n        $$.loadExternalJs([\"rappid-joint\", \"lodash\", \"backbone\"], loadJointJsSuccess);\n      }\n\n      function reDrawImageAddress() {\n        each(json.cells, function (cell) {\n          if (cell.type == \"basic.Image\") {\n            cell.attrs.image['xlink:href'] = factory.origin + cell.attrs.image['xlink:href'].substring(1);\n          }\n        });\n      }\n\n      extendTools = function () {\n        function extendTools(type, name) {\n          return registry[type + \":\" + name];\n        }\n\n        ;\n\n        extendTools.register = function (name, controller) {\n          registry[name] = controller;\n        };\n\n        return extendTools;\n      }();\n      /** 添加组态注册的新组件 */\n\n\n      extendTools.register(\"extend:angle\", function (cell) {\n        elDom.attr(\"text/style/display\", \"none\");\n        elDom.attr(\"rect/style/display\", \"none\");\n        $$.loadExternalJs([\"toolkit/configure/openAngle\"], function (openAngle) {\n          var ins = openAngle.init(svgId);\n          openAngles[cell.id] = ins;\n          ins.setPos(cell.position);\n          ins.setValue(0);\n        });\n      });\n      extendTools.register(\"type:link\", function (cell) {\n        var displayModeLink = {\n          \"arrowheadMarkup\": \"<g></g>\",\n          \"toolMarkup\": \"<g></g>\",\n          \"vertexMarkup\": \"<g></g>\"\n        };\n        jQuery.extend(cell, displayModeLink);\n        cell.attrs[\".connection-wrap\"] = {\n          display: \"none\"\n        };\n      });\n      extendTools.register(\"type:chart.Plot\", function (cell) {\n        var position = cell.position;\n        var size = cell.size;\n        var viewId = getNumber(cell.echartViewId);\n        self.getViewById(viewId, function (view) {\n          if (view) {\n            var chartWrap = $(\"<div></div>\");\n            chartWrap.css(\"width\", size.width * scale + \"px\");\n            chartWrap.css(\"height\", \"auto\");\n            chartWrap.css(\"top\", position.y * scale + \"px\");\n            chartWrap.css(\"left\", position.x * scale + ys + 5 + \"px\");\n            chartWrap.css(\"position\", \"absolute\");\n            chartWrap.css(\"background-color\", \"#eee\");\n            chartWrap.css(\"box-shadow\", \"1px 1px 10px 1px rgba(0,0,0,.2)\");\n            chartWrap.css(\"border-radius\", \"2px\");\n            wrap.prepend(chartWrap);\n            var json = JSON.parse(view.content);\n            json.layout = json.layout.$remapByChild(function (element) {\n              var rs = new commonMethod(element);\n              return rs;\n            });\n            var layout = json.layout;\n            element.children = layout.children;\n            element.traverse(function (elem) {});\n\n            if (cell.nodeIds) {\n              cell.nodeIds.$remove(function (index, element) {\n                return element == 0;\n              });\n\n              if (cell.nodeIds.length > 0) {\n                var callback = function callback(event) {\n                  if (event) {\n                    var resource = event[cell.nodeIds[0]];\n\n                    if (resource) {\n                      var success = function success(data) {\n                        layout.traveseByChild(function (elem) {\n                          if (elem.type == \"echart\") {\n                            elem.data.resource = [resource];\n                            var kpis = elem.data.kpi;\n                            elem.data.kpi = data.filter(function (elm) {\n                              return kpis.indexOf(elm.id) != -1;\n                            });\n                          }\n                        });\n                        traverseRow(chartWrap, layout.children, true);\n                      };\n\n                      serviceCenterService.kpis.getBymodelId(resource.modelId).then(success);\n                    }\n                  }\n                };\n\n                var strToNumer = function strToNumer(arr) {\n                  for (var i in arr) {\n                    if (typeof arr[i] == \"string\") {\n                      if (arr[i].indexOf(\"number:\") != -1) {\n                        var numStr = arr[i].split(\"number:\")[1];\n                        arr[i] = parseInt(numStr);\n                      }\n                    }\n                  }\n\n                  return arr;\n                };\n\n                resourceUIService.getResourceByIds(strToNumer(cell.nodeIds), callback);\n              } else {\n                traverseRow(chartWrap, layout.children, true);\n              }\n            } else {\n              traverseRow(chartWrap, layout.children, true);\n            }\n          }\n        });\n      });\n      /** 添加组态注册的新组件 */\n\n      function getExtendTools() {\n        var rs = [];\n        each(json.cells, function (cell) {\n          var extend = cell.extend;\n          var type = cell.type;\n          var tool = extendTools(\"extend\", extend) || extendTools(\"type\", type);\n\n          if (tool) {\n            tool(cell);\n            rs.push(cell);\n          }\n        });\n        return rs;\n      }\n\n      function getViewSuccess() {\n        reDrawImageAddress();\n        extendTools = getExtendTools();\n        loadJointJs();\n      }\n\n      function drawCell(cell, find, findState) {\n        var setLevel = function setLevel(cell, value) {\n          var range = cell.attributes.range;\n\n          if (range) {\n            range = eval(range);\n          }\n\n          var persent = (value - range[0]) / (range[1] - range[0]);\n          cell.prop(\"attrs/text/text\", \"\");\n          cell.transition(\"attrs/rect\", {\n            \"transform\": \"translate(0,0)\",\n            \"height\": 60 * persent\n          }, {\n            delay: 0,\n            duration: 1000,\n            valueFunction: function valueFunction(start, end) {\n              return function (time) {\n                var height = start[\"height\"] + (end[\"height\"] - start[\"height\"]) * time;\n                var all = 0;\n                return {\n                  \"transform\": \"translate(0,\" + (60 - height) + \")\",\n                  \"height\": height\n                };\n              };\n            }\n          });\n        };\n\n        var setOpenAngle = function setOpenAngle(cell, value, element) {\n          var range = cell.attributes.range;\n          var id = cell.id;\n          openAngles[id].setValue(value);\n        };\n\n        var fillColor = function fillColor(cell, type, color, state, color2) {\n          var stateId = cell.get(\"stateId\");\n\n          if (stateId) {\n            if (state < 1) state = 0;\n            cell.state = state;\n            var colorAry = [color, \"#25bce7\", \"#e1cd0a\", \"#ed9700\", \"#e7675d\"];\n            var colorAry2 = [color2, \"#25bce7\", \"#e1cd0a\", \"#ed9700\", \"#e7675d\"];\n\n            if (stateId == \"number:1\" || stateId == \"number:3\") {\n              if (type && colorAry[state]) {\n                cell.transition(\"attrs/\" + type + \"/fill\", colorAry[state], {\n                  delay: 300,\n                  duration: 500,\n                  valueFunction: joint.util.interpolate.hexColor\n                });\n              }\n            }\n\n            if ((stateId == \"number:2\" || stateId == \"number:3\") && colorAry2[state]) {\n              cell.transition(\"attrs/text/fill\", colorAry2[state], {\n                delay: 300,\n                duration: 500,\n                valueFunction: joint.util.interpolate.hexColor\n              });\n            }\n          }\n        };\n\n        var breathFlash = function breathFlash(cell, type, color, state, opacityState) {\n          var stateId = cell.get(\"stateId\");\n\n          var flash = function flash(el) {\n            var defaultOpacity = opacityState ? 1 : el.opacity;\n            el.transition(\"attrs/\" + type + \"/opacity\", defaultOpacity, {\n              delay: 0,\n              duration: 3000,\n              timingFunction: joint.util.timing.inout,\n              valueFunction: function valueFunction(a, b) {\n                return function (t) {\n                  var o = a + b * (defaultOpacity - Math.abs(defaultOpacity - 2 * defaultOpacity * t));\n                  return Number(o.toFixed(2));\n                };\n              }\n            });\n          };\n\n          if (stateId) {\n            if (state < 0) state = 0;\n            var colorAry = [color, \"#25bce7\", \"#e1cd0a\", \"#ed9700\", \"#e7675d\"];\n\n            if (stateId == \"number:2\") {\n              type = \"text\";\n            }\n\n            if (type) {\n              if (!cell.opacity) {\n                cell.opacity = jQuery.isNumeric(cell.prop(\"attrs/\" + type + \"/opacity\")) ? cell.prop(\"attrs/\" + type + \"/opacity\") : 1;\n              }\n\n              cell.state = state;\n              cell.prop(\"attrs/\" + type + \"/opacity\", 0.1);\n              cell.prop(\"attrs/\" + type + \"/fill\", colorAry[state]);\n\n              if (cell.state > 0) {\n                if (_.contains(cell.getTransitions(), \"attrs/\" + type + \"/opacity\")) return;\n                cell.on(\"transition:end\", function (el, path) {\n                  if (el.state > 0) {\n                    flash(el);\n                  } else {\n                    el.off(\"transition:end\");\n                    el.prop(\"attrs/\" + type + \"/opacity\", el.opacity);\n                  }\n                });\n                flash(cell);\n              } else {\n                cell.prop(\"attrs/\" + type + \"/opacity\", cell.opacity);\n              }\n            }\n          }\n        };\n\n        var bubbleFlash = function bubbleFlash(cell, type, color, state, opacityState) {\n          var stateId = cell.get(\"stateId\");\n\n          var flash = function flash() {\n            cell.prop(\"attrs/\" + type + \"/r\", 0);\n            cell.prop(\"attrs/\" + type + \"/opacity\", opacityState ? 1 : cell.opacity);\n            cell.transition(\"attrs/\" + type, {\n              \"r\": cell.r,\n              \"opacity\": 0\n            }, {\n              delay: 0,\n              duration: 1500,\n              valueFunction: function valueFunction(start, end) {\n                return function (time) {\n                  return {\n                    \"r\": start[\"r\"] + (end[\"r\"] - start[\"r\"]) * time,\n                    \"opacity\": start[\"opacity\"] - start[\"opacity\"] * time\n                  };\n                };\n              }\n            });\n          };\n\n          if (stateId) {\n            if (state < 0) state = 0;\n            var colorAry = [color, \"#25bce7\", \"#e1cd0a\", \"#ed9700\", \"#e7675d\"];\n\n            if (stateId == \"number:2\") {\n              type = \"text\";\n            }\n\n            if (type) {\n              if (!cell.opacity) {\n                cell.opacity = jQuery.isNumeric(cell.prop(\"attrs/\" + type + \"/opacity\")) ? cell.prop(\"attrs/\" + type + \"/opacity\") : 1;\n                cell.r = cell.prop(\"attrs/\" + type + \"/r\");\n                cell.prop(\"attrs/\" + type + \"/opacity\", opacityState ? 1 : cell.opacity);\n              }\n\n              cell.state = state;\n              cell.prop(\"attrs/\" + type + \"/fill\", colorAry[state]);\n\n              if (cell.state > 0) {\n                if (_.contains(cell.getTransitions(), \"attrs/\" + type)) return;\n                cell.on(\"transition:end\", function (el) {\n                  if (el.state > 0) {\n                    flash();\n                  } else {\n                    cell.prop(\"attrs/\" + type + \"/opacity\", cell.opacity);\n                    cell.prop(\"attrs/\" + type + \"/r\", cell.r);\n                  }\n                });\n                flash();\n              } else {\n                cell.prop(\"attrs/\" + type + \"/opacity\", cell.opacity);\n                cell.prop(\"attrs/\" + type + \"/r\", cell.r);\n              }\n            }\n          }\n        };\n\n        var changeIconAndText = function changeIconAndText(cell, state, type) {\n          if (!type) type = \"alertConfig\";\n\n          if (type == \"alertConfig\") {\n            var alertIcon = cell.get(\"alertIcon\");\n\n            if (alertIcon) {\n              if (state < 1) state = 0;\n              var alertConfig = cell.get(type);\n              alertConfig.forEach(function (item) {\n                if (item.id == state) {\n                  if (item.alertText) cell.prop(\"attrs/text/text\", item.alertText);\n                  if (item.alertIcon) cell.prop(\"attrs/image/xlink:href\", factory.origin + item.alertIcon);\n                }\n              });\n            }\n          } else if (type == \"valueConfig\") {\n            var valueConfig = cell.get(type);\n            valueConfig.forEach(function (item) {\n              item.stateDisplay = false;\n\n              if (item.valueText == state) {\n                item.stateDisplay = true;\n                if (item.valueText) cell.prop(\"attrs/text/text\", item.valueText);\n                if (item.valueIcon) cell.prop(\"attrs/image/xlink:href\", factory.origin + item.valueIcon);\n              }\n            });\n          }\n        };\n\n        var getFill = function getFill(obj) {\n          var rs = {};\n\n          for (var i in obj) {\n            rs = obj[i];\n            break;\n          }\n\n          return rs.fill;\n        };\n\n        var getType = function getType(type) {\n          if (type == \"basic.Rect\") {\n            return \"rect\";\n          } else if (type == \"basic.Circle\") {\n            return \"circle\";\n          }\n        };\n\n        var getTextFill = function getTextFill(obj) {\n          return obj[\"text\"][\"fill\"];\n        };\n\n        function getAllUnit_success(units) {\n          var elDom = getCell(cell);\n          var extend = elDom.get(\"extend\");\n\n          if (extend == \"alert\" && findState) {\n            changeIconAndText(elDom, findState.value);\n          } else if (extend == \"value\" && find) {\n            changeIconAndText(elDom, find.value, \"valueConfig\");\n          } else if (extend == \"level\" && find) {\n            setLevel(elDom, find.value);\n          } else if (extend == \"angle\" && find) {\n            setOpenAngle(elDom, find.value, cell);\n          } else {\n            if (findState) {\n              var stateType = cell[\"stateType\"];\n\n              if (stateType == \"number:1\") {\n                breathFlash(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, false);\n              } else if (stateType == \"number:2\") {\n                bubbleFlash(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, false);\n              } else if (stateType == \"number:3\") {\n                breathFlash(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, true);\n              } else if (stateType == \"number:4\") {\n                bubbleFlash(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, true);\n              } else {\n                fillColor(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, getTextFill(cell[\"attrs\"]));\n              }\n            }\n\n            if (find) {\n              var allUnits = data;\n              var unit = allUnits.find(function (elem) {\n                if (cell.kpiObj) return elem.unitCode == cell.kpiObj.unit;else return \"\";\n              });\n              var unitType = false;\n\n              if (elDom.get(\"unitType\")) {\n                unitType = elDom.get(\"unitType\").split(\"number:\")[1] == 1;\n              }\n\n              var rangeObj;\n\n              if (cell.resourceObj.modelId) {\n                rangeObj = resourceUIService.$attr(\"rootModelsDic/\" + cell.resourceObj.modelId + \"/kpiDic/\" + find.kpiCode + \"/rangeObj\");\n                find.value = rangeObj ? rangeObj[find.value] : find.value;\n              }\n\n              var y = elDom.attributes.position.y;\n\n              if (unit && unitType) {\n                elDom.prop(\"attrs/text/text\", find.value + \"\" + unit.unitName);\n              } else {\n                elDom.prop(\"attrs/text/text\", find.value);\n              }\n\n              elDom.prop(\"position/y\", y);\n            }\n          }\n        }\n\n        serviceCenterService.units.getAll().then(getAllUnit_success);\n      }\n\n      function getData_success(data) {\n        each(data, function (d) {\n          if (d.kpiCode == 999999) {\n            drawCell(cellDiction[d.nodeId + \"_\" + d.kpiCode], null, data);\n          } else {\n            drawCell(cellDiction[d.nodeId + \"_\" + d.kpiCode], data, null);\n          }\n        });\n      }\n\n      function ciKpiDefindSuccess(n, k) {\n        nodes = n.map(getId);\n        kpis = k.map(getId);\n        getRealTimeKpiData(nodes, [999999], getData_success, true);\n        getRealTimeKpiData(nodes, kpis, getData_success);\n        kpis.push(999999);\n        getWebSocket(nodes, kpis, getData_success);\n\n        if (events[\"$loadCiKpiComplete\"]) {\n          events[\"$loadCiKpiComplete\"](graph.getCells());\n        }\n\n        element.trigger(\"$loadCiKpiComplete\", graph.getCells());\n      }\n\n      function loadJointJsSuccess(joint) {\n        waitload(function () {\n          context.init(joint);\n          context.ciKpiDefination(ciKpiDefindSuccess);\n        });\n      }\n\n      function getCell(cell) {\n        return isObject(cell) ? graph.getCell(cell.id) : graph.getCell(cell);\n      }\n\n      function getNumber(str) {\n        if (isString(str)) {\n          var n = parseInt(str.replace(new RegExp(\"number\\\\:\", \"g\"), \"\"));\n          return n !== n ? null : n;\n        } else if (isNumber(str)) {\n          return str;\n        }\n\n        return null;\n      }\n\n      function getRealTimeKpiData(ci, kpi, callback, bool) {\n        kpiDataService.getRealTimeKpiData(ci, kpi, function (returnObj) {\n          if (returnObj.code == 0) {\n            callback && callback(returnObj.data);\n          }\n        }, bool);\n      }\n\n      function getWebSocket(ci, kpi, callback) {\n        var paramSocket = {\n          ciid: ci.toString(),\n          kpi: kpi.toString()\n        },\n            operation = \"register\";\n        uuid = uuid || Math.uuid();\n        SwSocket.register(uuid, operation, function (event) {\n          callback && callback([event.data]);\n        });\n        SwSocket.send(uuid, operation, \"kpi\", paramSocket);\n      }\n\n      function ciKpiDefination(callback) {\n        var nodes = [];\n        var kpis = [];\n        var promises = [];\n\n        function defineCell(cell) {\n          var defer = q.defer(),\n              elDom = getCell(cell),\n              nodeId = getNumber(elDom.get(\"nodeId\")),\n              kpiId = getNumber(elDom.get(\"kpiId\"));\n          getResourceById(nodeId, getResourceByIdSuccess);\n\n          function getResourceByIdSuccess(resource) {\n            cell.resourceObj = resource;\n            getKpisByModelId(resource && resource.modelId, getKpisSuccess);\n          }\n\n          function getKpisSuccess(kpis) {\n            cell.kpiObj = kpis.find(function (e) {\n              return e.id == kpiId;\n            }) || null;\n\n            if (cell.resourceObj && cell.kpiObj) {\n              cellDiction[cell.resourceObj.id + \"_\" + cell.kpiObj.id] = cell;\n            }\n\n            defer.resolve(cell);\n          }\n\n          nodeId && nodes.push(nodeId);\n          kpiId && kpis.push(kpiId);\n          return defer.promise;\n        }\n\n        each(json.cells, function (cell) {\n          promises.push(defineCell(cell));\n        });\n        q.all(promises).then(function (d) {\n          callback && callback(nodes, kpis);\n        });\n      }\n\n      function clearWrap() {\n        wrap.children().remove();\n      }\n\n      function resetDimension(ch, cw, ph, pw) {\n        var portion = cw / ch,\n            d = {};\n        ph = ph || 1 / 0;\n\n        if (cw / ch < pw / ph) {\n          d.scale = ph / ch;\n          d.width = ph * portion;\n          d.height = ph;\n          d.persentage = ch / ph;\n        } else {\n          d.scale = pw / cw;\n          d.width = pw;\n          d.height = pw / portion;\n          d.persentage = cw / pw;\n        }\n\n        return d;\n      }\n\n      function init(joint) {\n        var paper,\n            svg,\n            PatternLinkView = joint.dia.LinkView.extend({\n          patternMarkup: ['<pattern id=\"pattern-<%= id %>\" patternUnits=\"userSpaceOnUse\">', '<image xlink:href=\"\"/>', '</pattern>'].join(''),\n          render: function render() {\n            joint.dia.LinkView.prototype.render.apply(this, arguments);\n\n            if (this.model && !this.model.get(\"pattern\")) {\n              return;\n            }\n\n            this.listenTo(this.model, \"change:pattern change:patternColor\", this.update);\n            return this;\n          },\n          remove: function remove() {\n            joint.util.cancelFrame(this.frameId);\n            joint.dia.LinkView.prototype.remove.apply(this, arguments);\n\n            if (this.pattern) {\n              this.pattern.remove();\n              this.pattern = null;\n            }\n          },\n          update: function update() {\n            joint.dia.LinkView.prototype.update.apply(this, arguments);\n\n            if (this.model && !this.model.get(\"pattern\")) {\n              return;\n            }\n\n            if (!this.pattern) {\n              this.pattern = joint.V(_.template(this.patternMarkup)({\n                id: this.id\n              }));\n              this.patternImage = factory.origin + this.pattern.findOne(\"image\");\n              joint.V(this.paper.svg).defs().append(this.pattern);\n            }\n\n            this._V.connection.attr({\n              \"stroke\": \"url(#pattern-\" + this.id + \")\"\n            });\n\n            this.strokeWidth = this._V.connection.attr(\"stroke-width\") || 1;\n            joint.util.cancelFrame(this.frameId);\n            this.frameId = joint.util.nextFrame(_.bind(this.fillWithPattern, this));\n            return this;\n          },\n          fillWithPattern: function fillWithPattern() {\n            var strokeWidth = this.strokeWidth;\n            var bbox = joint.g.rect(joint.V(this.el).bbox(true)).moveAndExpand({\n              x: -strokeWidth,\n              y: -strokeWidth,\n              width: 2 * strokeWidth,\n              height: 2 * strokeWidth\n            });\n            var points = [].concat(this.sourcePoint, this.route, this.targetPoint);\n            points = _.map(points, function (point) {\n              return joint.g.point(point.x - bbox.x, point.y - bbox.y);\n            });\n            var canvas = document.createElement(\"canvas\");\n            canvas.width = bbox.width;\n            canvas.height = bbox.height;\n            var ctx = canvas.getContext(\"2d\");\n            ctx.lineWidth = strokeWidth;\n            ctx.lineJoin = \"round\";\n            ctx.lineCap = \"round\";\n\n            for (var i = 0, pointsCount = points.length - 1; i < pointsCount; i++) {\n              ctx.save();\n              var gradientPoints = this.gradientPoints(points[i], points[i + 1], strokeWidth);\n              var gradient = ctx.createLinearGradient.apply(ctx, gradientPoints);\n              this.drawPattern.call(this, ctx, points[i], points[i + 1], strokeWidth, gradient, points, i);\n              ctx.restore();\n            }\n\n            var dataUri = factory.origin + canvas.toDataURL(\"image/png\");\n            this.pattern.attr(bbox);\n            this.patternImage.attr({\n              width: bbox.width,\n              height: bbox.height,\n              \"xlink:href\": dataUri\n            });\n          },\n          gradientPoints: function gradientPoints(from, to, width) {\n            var angle = joint.g.toRad(from.theta(to) - 90);\n            var center = joint.g.line(from, to).midpoint();\n            var start = joint.g.point.fromPolar(width / 2, angle, center);\n            var end = joint.g.point.fromPolar(width / 2, Math.PI + angle, center);\n            return [start.x, start.y, end.x, end.y];\n          },\n          drawPattern: function drawPattern(ctx, from, to, width, gradient) {\n            ctx.beginPath();\n            ctx.moveTo(from.x, from.y);\n            ctx.lineTo(to.x, to.y);\n            ctx.stroke();\n            ctx.closePath();\n            ctx.beginPath();\n            ctx.strokeStyle = \"white\";\n            ctx.lineWidth = width - 2;\n            ctx.moveTo(from.x, from.y);\n            ctx.lineTo(to.x, to.y);\n            ctx.stroke();\n            ctx.closePath();\n          }\n        }),\n            linkView = PatternLinkView.extend({\n          drawPattern: function drawPattern(ctx, from, to, width, gradient) {\n            var innerWidth = width - 4;\n            var outerWidth = width;\n            var buttFrom = joint.g.point(from).move(to, -outerWidth / 2);\n            var buttTo = joint.g.point(to).move(from, -outerWidth / 2);\n            var lineColor = \"blue\";\n\n            if (this.model.get(\"attrs\") && this.model.get(\"attrs\")[\".connection\"]) {\n              lineColor = this.model.get(\"attrs\")[\".connection\"][\"stroke\"] ? this.model.get(\"attrs\")[\".connection\"][\"stroke\"] : lineColor;\n            }\n\n            gradient.addColorStop(0.300, lineColor);\n            var patternColor = \"#ffffff\";\n\n            if (this.model.get(\"patternColor\")) {\n              patternColor = this.model.get(\"patternColor\");\n            }\n\n            gradient.addColorStop(0.500, patternColor);\n            gradient.addColorStop(0.700, lineColor);\n            ctx.beginPath();\n            ctx.lineWidth = innerWidth;\n            ctx.strokeStyle = gradient;\n            ctx.moveTo(from.x, from.y);\n            ctx.lineTo(to.x, to.y);\n            ctx.stroke();\n            ctx.closePath();\n          }\n        }),\n            config = clone(json),\n            defaultLink = new joint.dia.Link({\n          attrs: {\n            \".marker-source\": {\n              d: \"M 10 0 L 0 5 L 10 10 z\",\n              transform: \"scale(0.001)\"\n            },\n            \".marker-target\": {\n              d: \"M 10 0 L 0 5 L 10 10 z\"\n            },\n            \".connection\": {\n              stroke: \"black\"\n            }\n          }\n        });\n        graph = new joint.dia.Graph();\n        extend(config, {\n          el: wrap[0],\n          model: graph,\n          interactive: false,\n          perpendicularLinks: true,\n          gridSize: 10,\n          markAvailable: true,\n          linkConnectionPoint: joint.util.shapePerimeterConnectionPoint,\n          defaultLink: defaultLink,\n          linkView: linkView\n        });\n        delete config.cells;\n        clearWrap();\n        newDimension = resetDimension(config.height, config.width, topo.height(), topo.width());\n        config.width = newDimension.width;\n        config.height = newDimension.height;\n        paper = new joint.dia.Paper(config);\n        graph.fromJSON(json);\n        svg = wrap.find(\"svg\");\n        svg.attr(\"id\", svgId);\n        waitload(function () {\n          isString(json.bgimage) && addCss(svg, {\n            \"background-image\": \"url(\" + factory.origin + json.bgimage.slice(1) + \")\",\n            \"background-size\": \"contain\",\n            \"background-position\": \"center center\",\n            \"background-repeat\": \"no-repeat\"\n          });\n          wrap.find(\".viewport\").attr(\"transform\", \"scale(\" + newDimension.scale + \")\");\n          wrap.find(\".chart.Plot\").css(\"display\", \"none\");\n        });\n\n        if (events[\"$renderGraphComplete\"]) {\n          events[\"$renderGraphComplete\"](graph.getCells());\n        }\n\n        element.trigger(\"$renderGraphComplete\", graph.getCells());\n      }\n\n      context = {\n        init: init,\n        ciKpiDefination: ciKpiDefination\n      };\n      getView(inputJson, cb_fun);\n    }\n\n    self.render = render;\n    delete element.self;\n    topo.css(\"width\", \"100%\");\n    topo.css(\"background-position\", \"top\");\n    topo.css(\"background-size\", \"contain\");\n    expression = expression ? expression : {};\n    var initEvent = expression.$attr(\"on/init\");\n    var clickEvent = expression.$attr(\"on/click\");\n    var wholeClickEvent = expression.$attr(\"on/wholeClick\");\n\n    if (element.style) {\n      topo.css(element.style);\n    }\n\n    if (isFunction(initEvent)) {\n      try {\n        topo.underWatch = initEvent({\n          target: self,\n          self: self,\n          global: global,\n          tools: elemData\n        }, function complete() {\n          defer.resolve(\"underwatch\");\n        }, defer.id);\n      } catch (e) {\n        console.error(e);\n      }\n    } else {\n      self.render(json);\n    }\n\n    topo.on(\"click\", function (event) {\n      if (typeof wholeClickEvent == \"function\") {\n        try {\n          wholeClickEvent({\n            target: self,\n            global: global\n          });\n        } catch (e) {\n          ;\n        }\n      }\n    });\n    console.assert(topo.underWatch != undefined, \"underWatch没设置\");\n    return topo;\n  };\n});"],"sourceRoot":"/source/"}