{"version":3,"sources":["toolkit/component/tab.js"],"names":["define","data","element","tabWrap","coldomInner","previewMode","traverseColumn","onTabClick","rowDom","undefined","tabInx","fd","children","find","elem","default","indexOf","scope","ulDom","$","liAdd","$attr","addClass","css","append","renderTab","i","remove","index","child","liDom","label","editBtn","removeBtn","display","tabId","attr","text","tabName","before","on","event","ui","stopPropagation","target","parent","length","$remove","inx","j","removeClass","push","id","$randomString","type"],"mappings":"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","file":"toolkit/component/tab.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var element = data.element,\n        tabWrap = data.tabWrap,\n        coldomInner = data.coldomInner,\n        previewMode = data.previewMode,\n        traverseColumn = data.traverseColumn,\n        onTabClick = data.onTabClick,\n        rowDom = data.rowDom;\n\n    if (element.tabInx == undefined) {\n      var fd = element.children.find(function (elem) {\n        return elem.default == true;\n      });\n\n      if (fd) {\n        element.tabInx = element.children.indexOf(fd);\n      } else {\n        element.tabInx = 0;\n      }\n    }\n\n    data.scope.tabInx = element.tabInx;\n    var ulDom = $(\"<div class='nav nav-tabs'></div>\");\n    var liAdd = $(\"<li style='cursor : pointer;'><a><span class='glyphicon glyphicon-plus'></span><span class=''>创建标签</span></a></li>\");\n\n    if (element.$attr(\"parameters/align\") == \"vertical\") {\n      ulDom.addClass(\"vertical\");\n      tabWrap.css(\"float\", \"left\");\n      tabWrap.css(\"width\", \"100px\");\n\n      if (!previewMode) {\n        coldomInner.css(\"float\", \"left\");\n        coldomInner.css(\"width\", \"calc( 100% - 100px )\");\n      }\n    } //coldomInner.addClass(\"tab-content\");\n\n\n    tabWrap.append(ulDom);\n\n    var renderTab = function renderTab() {\n      //预览模式下这里为什么要清理所有呢？所以我把它放到编辑模式下了\n      if (!previewMode) {\n        ulDom.children().remove();\n        ulDom.append(liAdd);\n      }\n\n      ;\n\n      for (var i in element.children) {\n        (function (index, child) {\n          var liDom = $(\"<li style='cursor:pointer;'><a></a></li>\");\n          var label = $(\"<span></span>\");\n          var editBtn = $(\"<span class='proudsmart ps-edit' style='cursor:pointer;'></span>\");\n          var removeBtn = $(\"<span class='glyphicon glyphicon-remove' style='cursor:pointer;'></span>\");\n          label.css(\"padding-right\", \"5px\");\n          editBtn.css(\"padding-right\", \"5px\");\n\n          if (element.tabInx == index) {\n            child.display = \"block\";\n            liDom.addClass(\"active\");\n          } else {\n            child.display = \"none\";\n          }\n\n          ;\n          child.tabId = index;\n          liDom.attr(\"id\", index);\n          label.text(child.tabName);\n          liDom.find(\"a\").append(label);\n\n          if (!previewMode) {\n            liDom.find(\"a\").append(editBtn);\n            liDom.find(\"a\").append(removeBtn);\n            liAdd.before(liDom);\n            editBtn.on(\"click\", function (event, ui) {\n              event.stopPropagation();\n              onTabClick({\n                event: event,\n                ui: ui,\n                target: child,\n                parent: element\n              });\n            });\n            removeBtn.on(\"click\", function (event) {\n              event.stopPropagation();\n\n              if (element.children.length > 1) {\n                element.children.$remove(function (inx, elem) {\n                  return index == inx;\n                });\n\n                if (element.tabInx >= index) {\n                  if (element.tabInx > 0) {\n                    element.tabInx--;\n                  }\n                }\n\n                if (!previewMode) {\n                  coldomInner.children().remove();\n                  renderTab();\n                  traverseColumn(coldomInner, element.children, previewMode);\n                } else {\n                  rowDom.children(\"[tabId]\").remove();\n                  renderTab();\n                  traverseColumn(rowDom, element.children, previewMode);\n                }\n              }\n            });\n          } else {\n            ulDom.append(liDom);\n          }\n\n          ;\n          liDom.on(\"click\", function () {\n            ulDom.find(\".active\").removeClass(\"active\");\n            liDom.addClass(\"active\");\n            element.tabInx = index;\n            data.scope.tabInx = index;\n\n            for (var j in element.children) {\n              element.children[j].display = \"none\";\n            }\n\n            child.display = \"block\";\n\n            if (!previewMode) {\n              coldomInner.children().remove();\n              renderTab();\n              traverseColumn(coldomInner, element.children, previewMode);\n            } else {\n              rowDom.children(\"[tabId]\").css(\"display\", \"none\");\n\n              if (rowDom.children(\"[tabId='tabId_\" + index + \"']\").length > 0) {\n                rowDom.children(\"[tabId='tabId_\" + index + \"']\").css(\"display\", \"block\");\n              } else {\n                traverseColumn(rowDom, element.children, previewMode);\n              } // 在预览模式下不应该清空以后重新加载，会造成性能的问题\n              //            renderTab();\n              //            traverseColumn(rowDom, element.children, previewMode);\n\n            }\n          });\n        })(i, element.children[i]);\n      }\n\n      liAdd.on(\"click\", function () {\n        element.children.push({\n          \"id\": $randomString(32),\n          \"tabName\": \"新建标签页\",\n          \"tabId\": element.children.length - 1,\n          \"type\": \"tabItem\",\n          \"display\": \"none\",\n          \"children\": []\n        });\n\n        if (!previewMode) {\n          coldomInner.children().remove();\n          renderTab();\n          traverseColumn(coldomInner, element.children, previewMode);\n        } else {\n          rowDom.children(\"[tabId]\").css(\"display\", \"none\");\n\n          if (rowDom.children(\"[tabId='tabId_\" + index + \"']\").length > 0) {\n            rowDom.children(\"[tabId='tabId_\" + index + \"']\").css(\"display\", \"block\");\n          } else {\n            traverseColumn(rowDom, element.children, previewMode);\n          } //renderTab();\n          //traverseColumn(rowDom, element.children, previewMode);\n\n        }\n      });\n    };\n\n    renderTab();\n  };\n});"],"sourceRoot":"/source/"}