{"version":3,"sources":["toolkit/component/explainer/ci.js"],"names":["define","data","tools","callback","nodesDes","kpisDes","group","ci","kpi","rs","loop","children","value","find","elem","kpiCode","id","nodeId","i","push","regroup","getSeries","formatter","gr","name","label","item","getLegend","nodes","kpis","legend","series"],"mappings":"AAGAA,OAAO,GAAI,WACT,OAAO,SAAUC,EAAMC,EAAOC,GAC5B,IAAIC,EAAWF,EAAME,SACjBC,EAAUH,EAAMG,QA4ChBC,EA1CU,SAAiBC,EAAIC,GACjC,IAAIC,EAAK,GAELC,EAAO,SAAcH,GACvB,IAAIE,EAAK,CACPF,GAAIA,EACJI,SAAU,IAeRD,EAAO,SAAcF,GACvB,MAAO,CACLA,IAAKA,EACLI,OAf+BL,EAedA,EAfkBC,EAedA,EAdnBK,EAAOZ,EAAKY,KAAK,SAAUC,GAC7B,OAAOA,EAAKC,SAAWP,EAAIQ,IAAMF,EAAKG,QAAUV,EAAGS,KAGjDH,EACKA,EAAKD,MAAQC,EAAKD,MAAQ,EAE1B,MARK,IAAmBL,EAAIC,EACjCK,GAkBN,IAAK,IAAIK,KAAKV,EACZC,EAAGE,SAASQ,KAAKT,EAAKF,EAAIU,KAG5B,OAAOT,GAGT,IAAK,IAAIS,KAAKX,EACZE,EAAGU,KAAKT,EAAKH,EAAGW,KAGlB,OAAOT,EAGGW,CAAQhB,EAAUC,GAE1BgB,EAAY,SAAmBC,GACjC,IAAIb,EAAK,GAELC,EAAO,SAAca,GACvB,IAAId,EAAK,CACPe,KAAMD,EAAGhB,GAAGkB,MACZxB,KAAM,IAGJS,EAAO,SAAcgB,GAavB,MAAO,CACLF,KAXsB,mBAAbF,EACFA,EAAU,CACff,GAAIgB,EAAGhB,GAAGkB,MACVjB,IAAKkB,EAAKlB,IAAIiB,MACdb,MAAOc,EAAKd,QAGPW,EAAGhB,GAAGkB,MAAQ,IAAMC,EAAKlB,IAAIiB,MAKpCb,MAAOc,EAAKd,QAIhB,IAAK,IAAIM,KAAKK,EAAGZ,SACfF,EAAGR,KAAKkB,KAAKT,EAAKa,EAAGZ,SAASO,KAGhC,OAAOT,GAGT,IAAK,IAAIS,KAAKZ,EACZG,EAAGU,KAAKT,EAAKJ,EAAMY,KAGrB,OAAOT,GAGLkB,EAAY,SAAmBL,GACjC,IAAIb,EAAK,GAELC,EAAO,SAAca,GACvB,IAAIb,EAAO,SAAcgB,GAavB,MAVwB,mBAAbJ,EACFA,EAAU,CACff,GAAIgB,EAAGhB,GAAGkB,MACVjB,IAAKkB,EAAKlB,IAAIiB,MACdb,MAAOc,EAAKd,QAGPW,EAAGhB,GAAGkB,MAAQ,IAAMC,EAAKlB,IAAIiB,OAMxC,IAAK,IAAIP,KAAKK,EAAGZ,SACfF,EAAGU,KAAKT,EAAKa,EAAGZ,SAASO,MAI7B,IAAK,IAAIA,KAAKZ,EACZI,EAAKJ,EAAMY,IAGb,OAAOT,GAaTN,EAVS,CACPkB,UAAWA,EACXM,UAAWA,EACX1B,KAAM,CACJ2B,MAAOxB,EACPyB,KAAMxB,EACNyB,OAAQH,IACRI,OAAQV","file":"toolkit/component/explainer/ci.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data, tools, callback) {\n    var nodesDes = tools.nodesDes;\n    var kpisDes = tools.kpisDes;\n\n    var regroup = function regroup(ci, kpi) {\n      var rs = [];\n\n      var loop = function loop(ci) {\n        var rs = {\n          ci: ci,\n          children: []\n        };\n\n        var findValue = function findValue(ci, kpi) {\n          var find = data.find(function (elem) {\n            return elem.kpiCode == kpi.id && elem.nodeId == ci.id;\n          });\n\n          if (find) {\n            return find.value ? find.value : 0;\n          } else {\n            return \"-\";\n          }\n        };\n\n        var loop = function loop(kpi) {\n          return {\n            kpi: kpi,\n            value: findValue(ci, kpi)\n          };\n        };\n\n        for (var i in kpi) {\n          rs.children.push(loop(kpi[i]));\n        }\n\n        return rs;\n      };\n\n      for (var i in ci) {\n        rs.push(loop(ci[i]));\n      }\n\n      return rs;\n    };\n\n    var group = regroup(nodesDes, kpisDes);\n\n    var getSeries = function getSeries(formatter) {\n      var rs = [];\n\n      var loop = function loop(gr) {\n        var rs = {\n          name: gr.ci.label,\n          data: []\n        };\n\n        var loop = function loop(item) {\n          var name;\n\n          if (typeof formatter == \"function\") {\n            name = formatter({\n              ci: gr.ci.label,\n              kpi: item.kpi.label,\n              value: item.value\n            });\n          } else {\n            name = gr.ci.label + \"-\" + item.kpi.label;\n          }\n\n          return {\n            name: name,\n            value: item.value\n          };\n        };\n\n        for (var i in gr.children) {\n          rs.data.push(loop(gr.children[i]));\n        }\n\n        return rs;\n      };\n\n      for (var i in group) {\n        rs.push(loop(group[i]));\n      }\n\n      return rs;\n    };\n\n    var getLegend = function getLegend(formatter) {\n      var rs = [];\n\n      var loop = function loop(gr) {\n        var loop = function loop(item) {\n          var name;\n\n          if (typeof formatter == \"function\") {\n            name = formatter({\n              ci: gr.ci.label,\n              kpi: item.kpi.label,\n              value: item.value\n            });\n          } else {\n            name = gr.ci.label + \"-\" + item.kpi.label;\n          }\n\n          return name;\n        };\n\n        for (var i in gr.children) {\n          rs.push(loop(gr.children[i]));\n        }\n      };\n\n      for (var i in group) {\n        loop(group[i]);\n      }\n\n      return rs;\n    };\n\n    var rs = {\n      getSeries: getSeries,\n      getLegend: getLegend,\n      data: {\n        nodes: nodesDes,\n        kpis: kpisDes,\n        legend: getLegend(),\n        series: getSeries()\n      }\n    };\n    callback(rs);\n  };\n});"],"sourceRoot":"/source/"}