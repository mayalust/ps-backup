{"version":3,"sources":["toolkit/component/explainer/deno_ci_ins_top10.js"],"names":["define","simulate","data","tools","callback","Info","nodesDes","kpisDes","instances","reduce","a","b","indexOf","instance","push","get","result","loopNodeDes","node","loopKpisDes","kpi","vlist","loop","find","el","kpiCode","id","nodeId","insName","i","obj","name","ci","label","value","getLegend","formatter","getSeries","rs","map","item","clone","$clone","itm","innerElem","length","dt","slice","lastElem","sort","inx","elem"],"mappings":"AAGAA,OAAO,CAAC,YAAa,SAAUC,GAC7B,OAAO,SAAUC,EAAMC,EAAOC,GAC5B,IAAIC,EAAOF,EAAME,KACbC,EAAWH,EAAMG,SACjBC,EAAUJ,EAAMI,QAChBC,EAAYN,EAAKO,OAAO,SAAUC,EAAGC,GAKvC,OAJ8B,GAA1BD,EAAEE,QAAQD,EAAEE,WACdH,EAAEI,KAAKH,EAAEE,UAGJH,GACN,IACcP,EAAMF,SA8FvBI,EAAKU,IAAI,2BA5FU,WACjB,IAAIC,EAAS,GA8CTC,EAAc,SAAqBC,GACrC,IAAIC,EAAc,SAAqBC,GACrC,IAAIC,EAAQ,GAERC,EAAO,SAAcT,GACvB,IAAIU,EAAOrB,EAAKqB,KAAK,SAAUC,GAC7B,OAAOX,GAAYW,EAAGX,UAAYW,EAAGC,SAAWL,EAAIM,IAAMF,EAAGG,QAAUT,EAAKQ,KAG1EH,IACFA,EAAKK,QAAUf,EACfQ,EAAMP,KAAKS,KAIf,IAAK,IAAIM,KAAKrB,EACZc,EAAKd,EAAUqB,IAGjB,IAAIC,EAAM,CACRC,KAAM,CACJC,GAAId,EAAKe,MACTb,IAAKA,EAAIa,OAEXC,MAAOb,GAETL,EAAOF,KAAKgB,IAGd,IAAK,IAAID,KAAKtB,EACZY,EAAYZ,EAAQsB,KAIxB,IAAK,IAAIA,KAAKvB,EACZW,EAAYX,EAASuB,IAIvBzB,EAAS,CACP+B,UAjFc,SAAmBC,GACjC,OAAO5B,GAiFP6B,UA9Ec,WACd,IAAIC,EAAKtB,EAAOuB,IAAI,SAAUC,GAC5B,IAAIC,EAAQD,EAAKE,SAQjB,OAPAD,EAAMV,KAAOU,EAAMV,KAAKC,GACxBS,EAAMvC,KAAOuC,EAAMP,MAAMK,IAAI,SAAUI,GACrC,MAAO,CACLZ,KAAQY,EAAIf,QACZM,MAASS,EAAIT,SAGVO,IAELG,EAAYN,EAAGA,EAAGO,OAAS,GAAGH,SAC9BI,EAAKF,EAAU1C,KACnB0C,EAAUb,KAAO,KACjBa,EAAU1C,KAAO4C,EAAGC,MAAM,EAAG,GAC7BT,EAAGA,EAAGO,OAAS,GAAG3C,KAAO4C,EAAGC,MAAM,GAClC,IAAIC,EAAWV,EAAGA,EAAGO,OAAS,GAAGH,SACjCM,EAASjB,KAAO,SACZe,EAAKE,EAAS9C,MACf+C,KAAK,SAAUvC,EAAGC,GACnB,OAAOA,EAAEuB,MAAQxB,EAAEwB,QAErBY,EAAKA,EAAGC,MAAM,IACd,IAAIG,EAAM,EAUV,OATAJ,EAAKA,EAAGP,IAAI,SAAUY,GACpB,IAAIV,EAAQU,EAAKT,SAGjB,OAFAD,EAAMV,KAAO,MAAQmB,EACrBA,IACOT,IAETO,EAAS9C,KAAO4C,EAChBR,EAAGxB,KAAK8B,GACRN,EAAGxB,KAAKkC,GACDV","file":"toolkit/component/explainer/deno_ci_ins_top10.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([\"simulate\"], function (simulate) {\n  return function (data, tools, callback) {\n    var Info = tools.Info;\n    var nodesDes = tools.nodesDes;\n    var kpisDes = tools.kpisDes;\n    var instances = data.reduce(function (a, b) {\n      if (a.indexOf(b.instance) == -1) {\n        a.push(b.instance);\n      }\n\n      return a;\n    }, []);\n    var simulateFn = tools.simulate;\n\n    var getInfo_back = function getInfo_back() {\n      var result = [];\n      /** var data = simulate(\"ci\", nodesDes, kpisDes, instance, simulateFn)*/\n\n      ;\n\n      var getLegend = function getLegend(formatter) {\n        return instances;\n      };\n\n      var getSeries = function getSeries() {\n        var rs = result.map(function (item) {\n          var clone = item.$clone();\n          clone.name = clone.name.ci;\n          clone.data = clone.value.map(function (itm) {\n            return {\n              \"name\": itm.insName,\n              \"value\": itm.value\n            };\n          });\n          return clone;\n        });\n        var innerElem = rs[rs.length - 1].$clone();\n        var dt = innerElem.data;\n        innerElem.name = \"行业\";\n        innerElem.data = dt.slice(0, 5);\n        rs[rs.length - 1].data = dt.slice(6);\n        var lastElem = rs[rs.length - 1].$clone();\n        lastElem.name = \"top10\";\n        var dt = lastElem.data;\n        dt.sort(function (a, b) {\n          return b.value - a.value;\n        });\n        dt = dt.slice(10);\n        var inx = 1;\n        dt = dt.map(function (elem) {\n          var clone = elem.$clone();\n          clone.name = \"top\" + inx;\n          inx++;\n          return clone;\n        });\n        lastElem.data = dt;\n        rs.push(innerElem);\n        rs.push(lastElem);\n        return rs;\n      };\n\n      var loopNodeDes = function loopNodeDes(node) {\n        var loopKpisDes = function loopKpisDes(kpi) {\n          var vlist = [];\n\n          var loop = function loop(instance) {\n            var find = data.find(function (el) {\n              return instance == el.instance && el.kpiCode == kpi.id && el.nodeId == node.id;\n            });\n\n            if (find) {\n              find.insName = instance;\n              vlist.push(find);\n            }\n          };\n\n          for (var i in instances) {\n            loop(instances[i]);\n          }\n\n          var obj = {\n            name: {\n              ci: node.label,\n              kpi: kpi.label\n            },\n            value: vlist\n          };\n          result.push(obj);\n        };\n\n        for (var i in kpisDes) {\n          loopKpisDes(kpisDes[i]);\n        }\n      };\n\n      for (var i in nodesDes) {\n        loopNodeDes(nodesDes[i]);\n      }\n\n      ;\n      callback({\n        getLegend: getLegend,\n        getSeries: getSeries\n      });\n    };\n\n    Info.get(\"../localdb/simulate.json\", getInfo_back);\n  };\n});"],"sourceRoot":"/source/"}