{"version":3,"sources":["toolkit/component/explainer/deno_ci_ins_2d.js"],"names":["define","simulate","data","tools","callback","Info","nodesDes","kpisDes","instance","dictionaryService","get","result","insort","item","xAxis","instances1","instances2","i","indexOf","push","sort","loopNodeDes","node","loopKpisDes","kpi","loop","ins1","ins2","split","find","elem","name","ci","label","some","value","ele","inx","obj","total","j","length","undefined","rs","a","b","getLegend","getxAxis","getSeries","map","itm","simulateBack"],"mappings":"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","file":"toolkit/component/explainer/deno_ci_ins_2d.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([\"simulate\"], function (simulate) {\n  return function (data, tools, callback) {\n    var Info = tools.Info;\n    var nodesDes = tools.nodesDes;\n    var kpisDes = tools.kpisDes;\n    var instance = tools.instance;\n    var simulateFn = tools.simulate;\n    var services = {};\n    services.dictionaryService = tools.dictionaryService;\n\n    var getInfo_back = function getInfo_back() {\n      var result = [];\n      var insort = [];\n\n      var simulateBack = function simulateBack(data) {\n        var xAxis = [],\n            instances1 = [],\n            instances2 = [];\n\n        var loop = function loop(item) {\n          if (xAxis.indexOf(item.instance) == -1) {\n            xAxis.push(item.instance);\n          }\n\n          ;\n        };\n\n        for (var i in data) {\n          loop(data[i]);\n        }\n\n        ;\n        xAxis = xAxis.sort();\n\n        var getLegend = function getLegend() {\n          return instances1;\n        };\n\n        var getxAxis = function getxAxis() {\n          return [insort];\n        };\n\n        var getSeries = function getSeries() {\n          var rs = result.map(function (item) {\n            var obj = {};\n            obj.total = item.total;\n            obj.name = item.name.ins1;\n            var n = 0;\n            obj.data = item.value.map(function (itm) {\n              return {\n                name: itm.ins2 ? itm.ins2 : \"\",\n                value: itm.value ? itm.value : 0\n              };\n            });\n            return obj;\n          });\n          return rs;\n        };\n\n        var loopNodeDes = function loopNodeDes(node) {\n          var loopKpisDes = function loopKpisDes(kpi) {\n            var loop = function loop(item) {\n              var ins1, ins2;\n\n              if (item.instance) {\n                ins1 = item.instance.split(\",\")[0];\n                ins2 = item.instance.split(\",\")[1];\n\n                if (instances1.indexOf(ins1) == -1) {\n                  instances1.push(ins1);\n                }\n\n                if (instances2.indexOf(ins2) == -1) {\n                  instances2.push(ins2);\n                }\n              }\n\n              if (ins2) {\n                var find = result.find(function (elem) {\n                  return elem.name.ci == node.label && elem.name.kpi == kpi.label && elem.name.ins1 == ins1;\n                });\n\n                if (find) {\n                  item.ins2 = ins2 ? ins2 : \"企业\";\n                  var some = find.value.find(function (ele) {\n                    if (ele) {\n                      return ele.instance == item.instance;\n                    } else {\n                      return false;\n                    }\n\n                    ;\n                  });\n                  var inx = instances2.indexOf(ins2);\n\n                  if (!some) {\n                    if (inx == 10) {}\n\n                    find.value[inx] = item;\n                  }\n\n                  ;\n                } else {\n                  var obj = {\n                    name: {\n                      ci: node.label,\n                      kpi: kpi.label,\n                      ins1: ins1\n                    },\n                    value: [],\n                    total: 0\n                  };\n                  var inx = instances2.indexOf(ins2);\n                  item.ins2 = ins2;\n                  obj.value[inx] = item;\n                  result.push(obj);\n                }\n              }\n\n              ;\n            };\n\n            for (var i in data) {\n              loop(data[i]);\n            }\n\n            ;\n          };\n\n          for (var i in kpisDes) {\n            loopKpisDes(kpisDes[i]);\n          }\n        };\n\n        for (var i in nodesDes) {\n          loopNodeDes(nodesDes[i]);\n        }\n\n        ;\n\n        for (var i in result) {\n          for (var j = 0; j < instances2.length; j++) {\n            if (result[i].value[j] == undefined) {\n              result[i].value[j] = {};\n            }\n          }\n        }\n\n        for (var i in result[0].value) {\n          var rs = 0;\n\n          for (var j in result) {\n            if (result[j].value[i]) {\n              if (result[j].value[i].value) {\n                rs += result[j].value[i].value;\n              }\n            }\n          }\n\n          ;\n\n          for (var j in result) {\n            if (result[j].value[i]) {\n              result[j].value[i].total = rs;\n            }\n\n            ;\n          }\n\n          ;\n        }\n\n        ;\n\n        for (var i in result) {\n          result[i].value = result[i].value.sort(function (a, b) {\n            return a.total - b.total;\n          });\n        }\n\n        for (var i in result) {\n          for (var j = 0; j < instances2.length; j++) {\n            if (insort[j] == undefined) {\n              if (j == 3) {\n                ;\n              }\n\n              if (result[i].value[j].ins2 != undefined) {\n                insort[j] = result[i].value[j].ins2;\n              }\n            }\n\n            ;\n          }\n        }\n\n        callback({\n          getLegend: getLegend,\n          getxAxis: getxAxis,\n          getSeries: getSeries\n        });\n      };\n\n      simulateBack(data); //simulate(\"ci_2d\", nodesDes, kpisDes, instance, simulateFn, services, simulateBack);\n    };\n\n    Info.get(\"../localdb/simulate.json\", getInfo_back);\n  };\n});"],"sourceRoot":"/source/"}