{"version":3,"sources":["toolkit/component/explainer/deno_time_inds2.js"],"names":["define","simulate","data","tools","callback","Info","nodesDes","kpisDes","format","instance","result","map","elem","dt","Date","arisingTime","year","getFullYear","month","getMonth","allMonth","item","xAxis","i","indexOf","push","sort","instanceDic","ciKey","key","nodeId","id","loopNodeDes","kpi","loopKpisDes","node","obj","name","ci","label","value","find","el","kpiCode","getLegend","legendAry","temp","getxAxis","parseInt","FormatByString","getSeries","clone","$clone","itm","length"],"mappings":"AAGAA,OAAO,CAAC,YAAa,SAAUC,GAC7B,OAAO,SAAUC,EAAMC,EAAOC,GACjBD,EAAME,KAAjB,IACIC,EAAWH,EAAMG,SACjBC,EAAUJ,EAAMI,QAGhBC,GAFWL,EAAMM,SACJN,EAAMF,SACVE,EAAMK,QACfE,EAAS,GAEbR,EAAOA,EAAKS,IAAI,SAAUC,GACxB,IAAIC,EAAK,IAAIC,KAAKF,EAAKG,aACnBC,EAAOH,EAAGI,cACVC,EAAQL,EAAGM,WAEf,OADAP,EAAKQ,SAAkB,GAAPJ,EAAYE,EACrBN,IAET,IAEyBS,EAFrBC,EAAQ,GAUZ,IAAK,IAAIC,KAAKrB,EARWmB,EASlBnB,EAAKqB,IAR2B,GAAjCD,EAAME,QAAQH,EAAKD,WACrBE,EAAMG,KAAKJ,EAAKD,UAWpBE,EAAQA,EAAMI,OACd,IAAIC,EAAc,GAElB,IAAK,IAAIC,KAAStB,EAEhB,IAAK,IAAIuB,KAAO3B,EAEVA,EAAK2B,GAAKC,QAAUxB,EAASsB,GAAOG,IAAOJ,EAAYzB,EAAK2B,GAAKpB,YACnEkB,EAAYzB,EAAK2B,GAAKpB,UAAY,CAACP,EAAK2B,GAAKpB,SAAUH,EAASsB,KAOtE,IAyCII,EAAc,SAAqBC,GACrC,IAAIC,EAAc,SAAqBC,GACrC,IAAIC,EAAM,CACRC,KAAM,CACJC,GAAIH,EAAK,GAAGI,MAAQ,IAAMJ,EAAK,GAC/BF,IAAKA,EAAIM,OAEXC,MAAOlB,EAAMX,IAAI,SAAUC,GAIzB,OAHWV,EAAKuC,KAAK,SAAUC,GAC7B,OAAO9B,GAAQ8B,EAAGtB,UAAYsB,EAAGC,SAAWV,EAAIF,IAAMW,EAAGjC,UAAY0B,EAAK,IAAMO,EAAGZ,QAAUK,EAAK,GAAGJ,QAK3GrB,EAAOe,KAAKW,IAGd,IAAK,IAAIb,KAAKI,EACZO,EAAYP,EAAYJ,KAI5B,IAAK,IAAIA,KAAKhB,EACZyB,EAAYzB,EAAQgB,IAKtBnB,EAAS,CACPM,OAAQA,EACRkC,UAvEc,WACd,IAAIC,EAAY,GAEhB,IAAK,IAAIhB,KAAOF,EAAa,CAC3B,IAAImB,EAAOnB,EAAYE,GAAK,GAAGU,MAAQ,IAAMZ,EAAYE,GAAK,GAC9DgB,EAAUpB,KAAKqB,GAIjB,OAAOD,GA+DPE,SA5Da,WAMb,MAAO,CALEzB,EAAMX,IAAI,SAAUC,GAG3B,OADW,IAAIE,KAAKkC,SAASpC,EAAO,IAAM,KAAOA,EAAO,GAAK,IACjDqC,eAAezC,OAyD7B0C,UApDc,WACd,IAAIhD,EAAOQ,EAAOC,IAAI,SAAUU,GAC9B,IAAI8B,EAAQ9B,EAAK+B,SAKjB,OAJAD,EAAMd,KAAOc,EAAMd,KAAKC,GACxBa,EAAMjD,KAAOiD,EAAMX,MAAM7B,IAAI,SAAU0C,GACrC,OAAOA,EAAIb,QAENW,IAUT,OAPmB,GAAfjD,EAAKoD,SACPpD,EAAO,CAAC,CACNmC,KAAM,GACNnC,KAAM,MAIHA","file":"toolkit/component/explainer/deno_time_inds2.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([\"simulate\"], function (simulate) {\n  return function (data, tools, callback) {\n    var Info = tools.Info;\n    var nodesDes = tools.nodesDes;\n    var kpisDes = tools.kpisDes;\n    var instance = tools.instance;\n    var simulateFn = tools.simulate;\n    var format = tools.format;\n    var result = []; //var data = simulate(\"time\", nodesDes, kpisDes, instance, simulateFn);\n\n    data = data.map(function (elem) {\n      var dt = new Date(elem.arisingTime);\n      var year = dt.getFullYear();\n      var month = dt.getMonth();\n      elem.allMonth = year * 12 + month;\n      return elem;\n    });\n    var xAxis = [];\n\n    var loop = function loop(item) {\n      if (xAxis.indexOf(item.allMonth) == -1) {\n        xAxis.push(item.allMonth);\n      }\n\n      ;\n    };\n\n    for (var i in data) {\n      loop(data[i]);\n    }\n\n    ;\n    xAxis = xAxis.sort();\n    var instanceDic = {};\n\n    for (var ciKey in nodesDes) {\n      //nodeIds\n      for (var key in data) {\n        //数据\n        if (data[key].nodeId == nodesDes[ciKey].id && !instanceDic[data[key].instance]) {\n          instanceDic[data[key].instance] = [data[key].instance, nodesDes[ciKey]]; //0 实例；1 node节点\n        }\n      }\n    }\n\n    ;\n\n    var getLegend = function getLegend() {\n      var legendAry = [];\n\n      for (var key in instanceDic) {\n        var temp = instanceDic[key][1].label + '-' + instanceDic[key][0];\n        legendAry.push(temp);\n      }\n\n      ;\n      return legendAry;\n    };\n\n    var getxAxis = function getxAxis() {\n      var rs = xAxis.map(function (elem) {\n        var str = elem / 12 + \"-\" + (elem % 12 + 1);\n        var time = new Date(parseInt(elem / 12) + \"-\" + (elem % 12 + 1));\n        return time.FormatByString(format);\n      });\n      return [rs];\n    };\n\n    var getSeries = function getSeries() {\n      var data = result.map(function (item) {\n        var clone = item.$clone();\n        clone.name = clone.name.ci;\n        clone.data = clone.value.map(function (itm) {\n          return itm.value;\n        });\n        return clone;\n      });\n\n      if (data.length == 0) {\n        data = [{\n          name: '',\n          data: ''\n        }];\n      }\n\n      return data;\n    };\n\n    var loopNodeDes = function loopNodeDes(kpi) {\n      var loopKpisDes = function loopKpisDes(node) {\n        var obj = {\n          name: {\n            ci: node[1].label + '-' + node[0],\n            kpi: kpi.label\n          },\n          value: xAxis.map(function (elem) {\n            var find = data.find(function (el) {\n              return elem == el.allMonth && el.kpiCode == kpi.id && el.instance == node[0] && el.nodeId == node[1].id;\n            });\n            return find;\n          })\n        };\n        result.push(obj);\n      };\n\n      for (var i in instanceDic) {\n        loopKpisDes(instanceDic[i]);\n      }\n    };\n\n    for (var i in kpisDes) {\n      loopNodeDes(kpisDes[i]);\n    }\n\n    ;\n    ;\n    callback({\n      result: result,\n      getLegend: getLegend,\n      getxAxis: getxAxis,\n      getSeries: getSeries\n    });\n  };\n});"],"sourceRoot":"/source/"}