{"version":3,"sources":["toolkit/component/weather.js"],"names":["define","data","expression","dom","$","addClass","element","global","style","city","$attr","$$","runExpression","funRes","code","fnResult","system","initFn","wrap","weatherService","setCity","cityName","render","callback","result","widget","main","ul","title","css","append","text","currentCity","createItem","weather","li","date","temperature","icon","i","attr","weather_data","getWeatherByCity","event","json","JSON","parse","status","results","target","e","route","current","$$route","controller","growl","error"],"mappings":"AAGAA,OAAO,GAAI,WACT,OAAO,SAAUC,GACf,IAKIC,EALAC,EAAMC,EAAE,eAAeC,SAAS,OAChCC,EAAUL,EAAKK,QACfC,EAASN,EAAKM,OACdC,EAAQP,EAAKK,QAAQE,MACrBC,EAAOH,EAAQI,MAAM,mBAEzBC,GAAGC,cAAcN,EAAQI,MAAM,sBAAuB,SAAUG,GAC9D,GAAmB,KAAfA,EAAOC,KAAa,CACtB,IAAIC,EAAWF,EAAOZ,KAQtBC,GALEA,EADqB,mBAAZa,EACIA,EAASd,EAAMe,QAEfD,IAGY,QAE3Bb,EAAa,KAIjB,IAAIe,EAASf,EAAWQ,MAAM,WAC9BF,EAAQA,GAAgB,GACxB,IAAIU,EAAOd,EAAE,eAAeC,SAAS,iDACjCc,EAAiBlB,EAAKkB,eAE1Bb,EAAQc,QAAU,SAAUC,GAC1BZ,EAAOY,GAGT,IAgBIC,EAAS,WAhBQ,IAAwBC,EAAAA,EAiB5B,SAAUC,GACvB,IAAIC,EAASrB,EAAE,eAAeC,SAAS,4BACnCqB,EAAOtB,EAAE,eAAeC,SAAS,uBACjCsB,EAAKvB,EAAE,aACPwB,EAAQxB,EAAE,eAEVI,GACFkB,EAAKG,IAAIrB,GAGXmB,EAAGE,IAAI,SAAU,GACjBF,EAAGE,IAAI,UAAW,GAClBF,EAAGE,IAAI,aAAc,QACrBJ,EAAOK,OAAOJ,GACdA,EAAKI,OAAOF,GACZA,EAAMG,KAAKP,EAAO,GAAGQ,YAAc,UACnCJ,EAAMC,IAAI,cAAe,QACzBD,EAAMC,IAAI,gBAAiB,kCAC3BD,EAAMC,IAAI,mBAAoB,wBAC9BH,EAAKI,OAAOH,GAEZ,IAAIM,EAAa,SAAoBC,GACnC,IAAIC,EAAK/B,EAAE,aACX+B,EAAG9B,SAAS,YACZ8B,EAAGN,IAAI,QAAS,QAChBM,EAAGN,IAAI,UAAW,QAClBM,EAAGN,IAAI,eAAgB,kCACvB,IAAIO,EAAOhC,EAAE,WACbgC,EAAKP,IAAI,SAAU,GACnBO,EAAKL,KAAKG,EAAQE,MAClB,IAAIC,EAAcjC,EAAE,WACpBiC,EAAYR,IAAI,SAAU,GAC1BQ,EAAYhC,SAAS,aACrBgC,EAAYN,KAAKG,EAAQG,aACzB,IAAIC,EAAOlC,EAAE,WACbkC,EAAKT,IAAI,SAAU,GACnB,IAAIU,EAAInC,EAAE,WAAWC,SAAS,eAO9B,OANAkC,EAAEV,IAAI,YAAa,QACnBU,EAAEC,KAAK,mBAAoBN,EAAQA,SACnCI,EAAKR,OAAOS,GACZJ,EAAGL,OAAOQ,GACVH,EAAGL,OAAOO,GACVF,EAAGL,OAAOM,GACHD,GAGT,IAAK,IAAII,KAAKf,EAAO,GAAGiB,aACtBd,EAAGG,OAAOG,EAAWT,EAAO,GAAGiB,aAAaF,KAI9C,IAAIJ,EAAK/B,EAAE,aACX+B,EAAGN,IAAI,QAAS,QAChBF,EAAGG,OAAOK,GACVjB,EAAKY,OAAOL,GACZtB,EAAI2B,OAAOZ,IAvEbC,EAAeuB,iBAAiBjC,EAAM,SAAUkC,GAC9C,GAAkB,KAAdA,EAAM7B,KAAa,CACrB,IAAI8B,EAAOC,KAAKC,MAAMH,EAAM1C,MAET,WAAf2C,EAAKG,QACPxB,EAASqB,EAAKI,aAwEtB,GAFA1C,EAAQgB,OAASA,EAEbL,EACF,IACEA,EAAO,CACLgC,OAAQ3C,EACRC,OAAQA,IAEV,MAAO2C,GACiC,iBAApCC,MAAMC,QAAQC,QAAQC,YACxBC,MAAMC,MAAM,+BAOhBlC,IAGF,OAAOnB","file":"toolkit/component/weather.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var dom = $(\"<div></div>\").addClass(\"row\");\n    var element = data.element;\n    var global = data.global;\n    var style = data.element.style;\n    var city = element.$attr(\"parameters/city\");\n    var expression;\n    $$.runExpression(element.$attr(\"advance/expression\"), function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n\n        if (typeof fnResult == 'function') {\n          expression = fnResult(data, system);\n        } else {\n          expression = fnResult;\n        }\n\n        expression = expression || {};\n      } else {\n        expression = {};\n        ; //throw new Error(funRes.message);\n      }\n    });\n    var initFn = expression.$attr(\"on/init\");\n    style = style ? style : {};\n    var wrap = $(\"<div></div>\").addClass(\"weather-layout js-weather-layout weather-flip\");\n    var weatherService = data.weatherService;\n\n    element.setCity = function (cityName) {\n      city = cityName;\n    };\n\n    var getWeatherInfo = function getWeatherInfo(callback) {\n      weatherService.getWeatherByCity(city, function (event) {\n        if (event.code == \"0\") {\n          var json = JSON.parse(event.data);\n\n          if (json.status == \"success\") {\n            callback(json.results);\n          }\n\n          ;\n        }\n\n        ;\n      });\n    };\n\n    var render = function render() {\n      getWeatherInfo(function (result) {\n        var widget = $(\"<div></div>\").addClass(\"weather-widget col-md-12\");\n        var main = $(\"<div></div>\").addClass(\"weather-widget-main\");\n        var ul = $(\"<ul></ul>\");\n        var title = $(\"<div></div>\");\n\n        if (style) {\n          main.css(style);\n        }\n\n        ul.css(\"margin\", 0);\n        ul.css(\"padding\", 0);\n        ul.css(\"list-style\", \"none\");\n        widget.append(main);\n        main.append(title);\n        title.text(result[0].currentCity + \"近期天气状况\");\n        title.css(\"line-height\", \"30px\");\n        title.css(\"border-bottom\", \"1px solid rgba(250,250,250,.2)\");\n        title.css(\"background-color\", \"rgba(250,250,250,.1)\");\n        main.append(ul);\n\n        var createItem = function createItem(weather) {\n          var li = $(\"<li></li>\");\n          li.addClass(\"col-md-3\");\n          li.css(\"float\", \"left\");\n          li.css(\"padding\", \"10px\");\n          li.css(\"border-right\", \"1px solid rgba(250,250,250,.2)\");\n          var date = $(\"<p></p>\");\n          date.css(\"margin\", 0);\n          date.text(weather.date);\n          var temperature = $(\"<p></p>\");\n          temperature.css(\"margin\", 0);\n          temperature.addClass(\"title-deg\");\n          temperature.text(weather.temperature);\n          var icon = $(\"<p></p>\");\n          icon.css(\"margin\", 0);\n          var i = $(\"<i></i>\").addClass(\"icn-weather\");\n          i.css(\"font-size\", \"60px\");\n          i.attr(\"data-weather-icn\", weather.weather);\n          icon.append(i);\n          li.append(icon);\n          li.append(temperature);\n          li.append(date);\n          return li;\n        };\n\n        for (var i in result[0].weather_data) {\n          ul.append(createItem(result[0].weather_data[i]));\n        }\n\n        ;\n        var li = $(\"<li></li>\");\n        li.css(\"clear\", \"both\");\n        ul.append(li);\n        wrap.append(widget);\n        dom.append(wrap);\n      });\n    };\n\n    element.render = render;\n\n    if (initFn) {\n      try {\n        initFn({\n          target: element,\n          global: global\n        });\n      } catch (e) {\n        if (route.current.$$route.controller == \"freeStyleCtrl\") {\n          growl.error(\"组件［天气信息］的初始化表达式配置发生错误！\");\n        }\n\n        ;\n        ;\n      }\n    } else {\n      render();\n    }\n\n    return dom;\n  };\n});"],"sourceRoot":"/source/"}