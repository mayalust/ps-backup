{"version":3,"sources":["toolkit/component/repeater.js"],"names":["define","data","expression","global","traverseColumn","traverseRow","element","previewMode","timeout","col","$attr","wrap","$","addClass","child","children","prevElem","getOption","$$","runExpression","funRes","code","fnResult","system","initFn","Math","floor","render","cloneChild","dt","clone","$clone","traveseByChild","el","Object","defineProperty","value","enumerable","i","push","traverse","parent","remove","elem","createCurrentStatusByItem","tc","pos","left","popup","close","screenWidth","clientX","css","z-index","min-width","height","position","box-shadow","border","top","clientY","overflow","background-color","right","font-size","click","append","table","tr","width","text-align","margin-top","border-bottom","padding","length","tableData","getdomainNameHandler","domainPath","TD","label","Error","message","repeatFn","setTimeout","target","$repeatData","e","console","warn","getLatestDevices","devices","getTicketsByStatus","workorder","energyTypeList","energyType","getCurrentProjects","projects","getAlerts","currentDirective","directives","getCurrentAlert","alerts","getCurrentAlertByProject","runExpressionSuccess"],"mappings":"AAGAA,OAAO,GAAI,WACT,OAAO,SAAUC,GACf,IAWIC,EAXAC,EAASF,EAAKE,OAEdC,GADcH,EAAKI,YACFJ,EAAKG,gBACtBE,EAAUL,EAAKK,QAEfC,GADUN,EAAKO,QACDP,EAAKM,aACnBE,EAAMH,EAAQI,MAAM,kBACpBC,EAAOC,EAAE,eAAeC,SAAS,YACjCC,EAAQR,EAAQS,SAAS,GACzBC,EAAW,GACXC,EAAYX,EAAQI,MAAM,wBAwM9B,OAtMAQ,GAAGC,cAAcb,EAAQI,MAAM,sBAAuB,SAAUU,GAC9D,GAAmB,KAAfA,EAAOC,KAAa,CACtB,IAAIC,EAAWF,EAAOnB,KAQtBC,GALEA,EADqB,mBAAZoB,EACIA,EAASrB,EAAMsB,QAEfD,IAGwB,QAEvCpB,EAAa,IAOjB,SAA8BA,GAC5B,IAAIsB,EAAStB,EAAWQ,MAAM,WAC9BI,EAAML,IAAM,CAACgB,KAAKC,MAAM,GAAKjB,GAAM,GAAKA,GAyHxCH,EAAQqB,OAvHK,SAAgB1B,GAC3B,IAAIc,EAAW,GAEXa,EAAa,SAAoBC,GACnC,IAAIC,EAAQhB,EAAMiB,SAWlB,OAVAD,EAAME,eAAe,SAAUC,QACI,IAAtBA,EAAG,YACZC,OAAOC,eAAeF,EAAI,cAAe,CACvCG,MAAOP,EACPQ,YAAY,IAGdJ,EAAG,YAAiBJ,IAGjBC,GAGT,IAAK,IAAIQ,KAAKrC,EACZc,EAASwB,KAAKX,EAAW3B,EAAKqC,KAGhCtB,EAASD,SAAWA,EACpBC,EAASwB,SAAS,cAClBN,OAAOC,eAAenB,EAAU,SAAU,CACxCoB,MAAO9B,EAAQmC,OACfJ,YAAY,IAEd1B,EAAKI,WAAW2B,SAChBtC,EAAeO,EAAMK,EAASD,SAAUR,EAAa,SAAUoC,GAE7DA,EAAKC,0BAA4B,SAAUC,EAAIC,GAG7C,IAAIC,EAQAC,EAAOC,EAVXrC,EAAE,UAAU8B,SAKVK,EADmC,KAAjCD,EAAII,YAAcJ,EAAIK,QACjBL,EAAIK,QAAU,EAEdL,EAAIK,QAAU,IAIvBH,EAAQpC,EAAE,6BACVqC,EAAQrC,EAAE,gCACVoC,EAAMI,IAAI,CACRC,UAAW,KACXC,YAAa,QACbC,OAAU,OACVC,SAAY,QACZC,aAAc,kCACdC,OAAU,iBACVX,KAAQA,EAAO,KACfY,IAAOb,EAAIc,QAAU,KACrBC,SAAY,OACZC,mBAAoB,sBAEtBb,EAAMG,IAAI,CACRI,SAAY,WACZO,MAAS,MACTC,YAAa,SAEff,EAAMgB,MAAM,WACVrD,EAAE,UAAU8B,WAEdM,EAAMkB,OAAOjB,GACb,IAAIkB,EAAQvD,EAAE,mBACVwD,EAAKxD,EAAE,gFACXuD,EAAMf,IAAI,CACRiB,MAAS,OACTC,aAAc,SACdC,aAAc,SAEhBH,EAAGhB,IAAI,CACLoB,gBAAiB,iBACjBC,QAAW,oBAEbN,EAAMD,OAAOE,GAEb,IAAK,IAAI9B,EAAI,EAAGA,EAAIO,EAAG6B,OAAQpC,IAAK,CAClC,IAAIqC,EAAYrE,EAAQsE,qBAAqB/B,EAAGP,GAAGuC,WAAY,IAC3DC,EAAKlE,EAAE,WAAa+D,EAAU,GAAK,YAAcA,EAAU,GAAK,YAAcA,EAAU,GAAK,YAAc9B,EAAGP,GAAGyC,MAAQ,eAC7HZ,EAAMD,OAAOY,GAKf,OAFA9B,EAAMkB,OAAOC,GACbxD,EAAKuD,OAAOlB,GACLrC,GAITO,GAAGC,cAAcwB,EAAKjC,MAAM,sBAAuB,SAAUU,GAC3D,GAAmB,KAAfA,EAAOC,KAWT,MAAM,IAAI2D,MAAM5D,EAAO6D,SAVvB,IAAI3D,EAAWF,EAAOnB,KAapBiF,IAXqB,mBAAZ5D,EACIA,EAASrB,GAETqB,IAGwB,IAKfZ,MAAM,aAChCyE,WAAW,WACLD,GACFA,EAAS,CACPE,OAAQzC,EACR1C,KAAM0C,EAAK0C,eAGd,UA2CT,GAAI9E,EACF,GAAqB,mBAAViB,EACT,IACEA,EAAO,CACL4D,OAAQ9E,EACRH,OAAQA,IAEV,MAAOmF,GACPC,QAAQC,KAAKF,OA3CA,aAAbrE,EACFX,EAAQmF,iBAAiB,SAAUC,GACjCpF,EAAQqB,OAAO+D,KAEK,aAAbzE,EACTX,EAAQqF,mBAAmB,SAAUC,GACnCtF,EAAQqB,OAAOiE,KAEK,cAAb3E,EACTX,EAAQuF,eAAe,SAAUC,GAC/BxF,EAAQqB,OAAOmE,KAEK,eAAb7E,EACTX,EAAQyF,mBAAmB,SAAUC,GACnC1F,EAAQqB,OAAOqE,KAEK,SAAb/E,EACTX,EAAQ2F,UAAU,SAAUL,GAC1BtF,EAAQqB,OAAOiE,KAEK,4BAAb3E,EACTX,EAAQ4F,iBAAiB,SAAUC,GACjC7F,EAAQqB,OAAOwE,KAEK,wBAAblF,EACTX,EAAQ8F,gBAAgB,SAAUC,GAChC/F,EAAQqB,OAAO0E,KAEK,yBAAbpF,GACTX,EAAQgG,yBAAyB,SAAUD,GACzC/F,EAAQqB,OAAO0E,UAmBnBjG,EAAeO,EAAML,EAAQS,SAAUR,GAlLzCgG,CAAqBrG,KAsLhBS","file":"toolkit/component/repeater.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var global = data.global;\n    var traverseRow = data.traverseRow;\n    var traverseColumn = data.traverseColumn;\n    var element = data.element;\n    var timeout = data.timeout;\n    var previewMode = data.previewMode;\n    var col = element.$attr(\"parameters/col\");\n    var wrap = $(\"<div></div>\").addClass(\"repeater\");\n    var child = element.children[0];\n    var prevElem = {};\n    var getOption = element.$attr(\"advance/getListTable\");\n    var expression;\n    $$.runExpression(element.$attr(\"advance/expression\"), function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n\n        if (typeof fnResult == 'function') {\n          expression = fnResult(data, system);\n        } else {\n          expression = fnResult;\n        }\n\n        expression = expression ? expression : {};\n      } else {\n        expression = {};\n        ; //throw new Error(funRes.message);\n      }\n\n      runExpressionSuccess(expression);\n    });\n\n    function runExpressionSuccess(expression) {\n      var initFn = expression.$attr(\"on/init\");\n      child.col = [Math.floor(12 / col), 12 % col];\n\n      var render = function render(data) {\n        var children = [];\n\n        var cloneChild = function cloneChild(dt) {\n          var clone = child.$clone();\n          clone.traveseByChild(function (el) {\n            if (typeof el[\"$repeatData\"] === \"undefined\") {\n              Object.defineProperty(el, \"$repeatData\", {\n                value: dt,\n                enumerable: false\n              });\n            } else {\n              el[\"$repeatData\"] = dt;\n            }\n          });\n          return clone;\n        };\n\n        for (var i in data) {\n          children.push(cloneChild(data[i]));\n        }\n\n        prevElem.children = children;\n        prevElem.traverse(function () {});\n        Object.defineProperty(prevElem, \"parent\", {\n          value: element.parent,\n          enumerable: false\n        });\n        wrap.children().remove();\n        traverseColumn(wrap, prevElem.children, previewMode, function (elem) {\n          // 做一个弹框\n          elem.createCurrentStatusByItem = function (tc, pos) {\n            $(\".pupop\").remove(); // 判断显示的宽度，高度所在的位置。\n\n            var left, top;\n\n            if (pos.screenWidth - pos.clientX >= 400) {\n              left = pos.clientX + 5;\n            } else {\n              left = pos.clientX - 405;\n            }\n\n            var popup, close;\n            popup = $(\"<div class='pupop'></div>\");\n            close = $(\"<i class=\\\"fa fa-times\\\" ></i>\");\n            popup.css({\n              \"z-index\": \"99\",\n              \"min-width\": \"400px\",\n              \"height\": \"84px\",\n              \"position\": \"fixed\",\n              \"box-shadow\": \"1px 1px 10px 1px rgba(0,0,0,.5)\",\n              \"border\": \"1px solid #000\",\n              \"left\": left + \"px\",\n              \"top\": pos.clientY + \"px\",\n              \"overflow\": \"auto\",\n              \"background-color\": \"rgba(30,65,93,.9)\"\n            });\n            close.css({\n              \"position\": \"absolute\",\n              \"right\": \"2px\",\n              \"font-size\": \"16px\"\n            });\n            close.click(function () {\n              $(\".pupop\").remove();\n            });\n            popup.append(close);\n            var table = $(\"<table></table>\");\n            var tr = $(\"<tr><td>基地</td><td>厂部</td><td>产线</td><td style='width: 150px'>设备名称</td></tr>\");\n            table.css({\n              \"width\": \"100%\",\n              \"text-align\": \"center\",\n              \"margin-top\": \"15px\"\n            });\n            tr.css({\n              \"border-bottom\": \"1px solid #eee\",\n              \"padding\": \"5px 6px 1px 6px\"\n            });\n            table.append(tr); // var tableData = element.getdomainListName(tc);\n\n            for (var i = 0; i < tc.length; i++) {\n              var tableData = element.getdomainNameHandler(tc[i].domainPath, []);\n              var TD = $('<tr><td>' + tableData[0] + '</td><td>' + tableData[1] + '</td><td>' + tableData[2] + '</td><td>' + tc[i].label + '</td></tr>>');\n              table.append(TD);\n            }\n\n            popup.append(table);\n            wrap.append(popup);\n            return wrap;\n          };\n\n          var expression;\n          $$.runExpression(elem.$attr(\"advance/expression\"), function (funRes) {\n            if (funRes.code == \"0\") {\n              var fnResult = funRes.data;\n\n              if (typeof fnResult == 'function') {\n                expression = fnResult(data);\n              } else {\n                expression = fnResult;\n              }\n\n              expression = expression ? expression : {};\n            } else {\n              throw new Error(funRes.message);\n            }\n\n            var repeatFn = expression.$attr(\"on/repeat\");\n            setTimeout(function () {\n              if (repeatFn) {\n                repeatFn({\n                  target: elem,\n                  data: elem.$repeatData\n                });\n              }\n            }, 200);\n          });\n        });\n      };\n\n      element.render = render;\n\n      var start = function start() {\n        if (getOption == \"newdevice\") {\n          element.getLatestDevices(function (devices) {\n            element.render(devices);\n          });\n        } else if (getOption == \"workorder\") {\n          element.getTicketsByStatus(function (workorder) {\n            element.render(workorder);\n          });\n        } else if (getOption == \"energyType\") {\n          element.energyTypeList(function (energyType) {\n            element.render(energyType);\n          });\n        } else if (getOption == \"allprojects\") {\n          element.getCurrentProjects(function (projects) {\n            element.render(projects);\n          });\n        } else if (getOption == \"alert\") {\n          element.getAlerts(function (workorder) {\n            element.render(workorder);\n          });\n        } else if (getOption == \"currentDirectiveByDevice\") {\n          element.currentDirective(function (directives) {\n            element.render(directives);\n          });\n        } else if (getOption == \"currentAlertByDevice\") {\n          element.getCurrentAlert(function (alerts) {\n            element.render(alerts);\n          });\n        } else if (getOption == \"currentAlertByProject\") {\n          element.getCurrentAlertByProject(function (alerts) {\n            element.render(alerts);\n          });\n        }\n      };\n\n      if (previewMode) {\n        if (typeof initFn == \"function\") {\n          try {\n            initFn({\n              target: element,\n              global: global\n            });\n          } catch (e) {\n            console.warn(e);\n          }\n        } else {\n          start();\n        }\n      } else {\n        traverseColumn(wrap, element.children, previewMode);\n      }\n    }\n\n    return wrap;\n  };\n});"],"sourceRoot":"/source/"}