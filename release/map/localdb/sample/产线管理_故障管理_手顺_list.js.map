{"version":3,"sources":["localdb/sample/产线管理_故障管理_手顺_list.js"],"names":["expression","theme","on","init","event","target","scope","getRootScope","resource","getValue","format","name","label","index","composory","attrs","type","min","popuptype","stretch","hide","manual","multiple","text","path","btnstatus","content","icon","click","row","columnIndex","popupHandler","deleteDeviceFaultBookById","id","returnObj","code","growl","readerData","inputparam","status","fileList","forEach","fmt","texAry","pathAry","item","push","filePath","toString","objfmt","filter","undefined","obj","colnum","createSystemPopupByLocalPath","width","title","submit","data","destroy","statuc","hasOwnProperty","i","fileName","qualifiedName","saveDeviceFaultBook","extendParam","paras4list","deviceId","faultLedgerCode","k","getDeviceFaultBookList","sort","workArray","tablefmt","render","map","elem","value","popupaddclick","$on","listsearchclick","param","args"],"mappings":"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","file":"localdb/sample/产线管理_故障管理_手顺_list.js","sourcesContent":["expression = {\n  \"theme\": \"dark\",\n  \"on\": {\n    \"init\": function init(event) {\n      var target = event.target;\n      var scope = target.getRootScope();\n      var resource = target.getValue(\"global/resource\");\n      var taskStatusAry = [{\n        id: 0,\n        label: \"启用\"\n      }, {\n        id: 1,\n        label: \"停用\"\n      }];\n      var format = [{\n        name: \"bookId\",\n        label: \"故障处理手顺书编号\",\n        index: 6\n      }, {\n        name: \"name\",\n        label: \"故障处理手顺书名称\",\n        composory: true,\n        // type: \"date\"\n        index: 1\n      }, {\n        name: \"faultLedgerCode\",\n        label: \"故障台账编号\",\n        composory: true,\n        index: 3\n      }, {\n        name: \"faultPosition\",\n        label: \"故障部位\",\n        index: 2\n      }, {\n        name: \"handleTotalTime\",\n        label: \"处理累计时间(h)\",\n        attrs: {\n          type: \"number\",\n          min: 0\n        },\n        index: 5\n      }, {\n        name: \"faultPerfor\",\n        label: \"故障现象\",\n        composory: true,\n        popuptype: \"textarea\",\n        stretch: true,\n        index: 9\n      }, {\n        name: \"reason\",\n        label: \"故障原因\",\n        composory: true,\n        popuptype: \"textarea\",\n        stretch: true,\n        index: 10\n      }, {\n        name: \"createTime\",\n        label: \"创建日期\",\n        type: \"date\",\n        popuptype: \"datePicker\",\n        hide: true,\n        index: 8\n      }, {\n        name: \"handleTime\",\n        label: \"处理时间\",\n        type: \"date\",\n        popuptype: \"datePicker\",\n        composory: true,\n        hide: true\n      }, {\n        name: \"createby\",\n        label: \"创建人\",\n        index: 7,\n        hide: true\n      }, {\n        name: \"technology\",\n        label: \"技术要点\",\n        popuptype: \"textarea\",\n        composory: true,\n        stretch: true,\n        hide: true,\n        index: 11\n      }, {\n        name: \"tools\",\n        label: \"使用工具\",\n        popuptype: \"textarea\",\n        composory: true,\n        stretch: true,\n        hide: true,\n        index: 12\n      }, {\n        name: \"handleCondition\",\n        label: \"处理条件安全要点\",\n        composory: true,\n        popuptype: \"textarea\",\n        stretch: true,\n        hide: true,\n        index: 13\n      }, {\n        name: \"faultName\",\n        label: \"故障名称\",\n        composory: true,\n        hide: true,\n        index: 4\n      }, {\n        name: \"externalDevId\",\n        label: \"设备编号\",\n        stretch: true,\n        hide: true\n      }, {\n        name: \"fileList\",\n        label: \"附件\",\n        popuptype: \"uploadFile2\",\n        stretch: true,\n        manual: true,\n        multiple: true,\n        // 上传多个文件\n        text: \"\",\n        //文件的名称\n        path: \"\",\n        //文件的路径\n        btnstatus: \"delete,download\",\n        hide: true,\n        index: 14\n      }, {\n        label: \"操作\",\n        type: \"buttonGroup\",\n        content: [{\n          label: \"详情\",\n          icon: \"null\",\n          on: {\n            click: function click(index, row, columnIndex) {\n              popupHandler(index.row, 0);\n            }\n          }\n        }, {\n          label: \"编辑\",\n          icon: \"null\",\n          on: {\n            click: function click(index, row, columnIndex) {\n              popupHandler(index.row, 1);\n            }\n          }\n        }, {\n          label: \"删除\",\n          icon: \"null\",\n          on: {\n            click: function click(index, row, columnIndex) {\n              target.deleteDeviceFaultBookById(index.row.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  target.growl(\"删除成功\");\n                  readerData();\n                }\n              });\n            }\n          }\n        }]\n      }];\n\n      var render = function render(workArray) {\n        //只有让有hide=false的传递到datatable\n        var tablefmt = format.filter(function (fmt) {\n          if (!fmt.hide) return fmt;\n        });\n        target.render({\n          data: workArray,\n          format: tablefmt.map(function (elem) {\n            return {\n              \"name\": elem.label,\n              \"value\": elem.name,\n              \"type\": elem.type || \"text\",\n              \"content\": elem.content,\n              \"render\": elem.render\n            };\n          })\n        });\n      };\n\n      var popupHandler = function popupHandler(inputparam, status) {\n        if (!inputparam.fileList) inputparam.fileList = [];\n        format.forEach(function (fmt) {\n          if (fmt.name == 'fileList') {\n            var texAry = [];\n            var pathAry = [];\n            inputparam.fileList.forEach(function (item) {\n              texAry.push(item.label);\n              pathAry.push(item.filePath);\n            });\n            fmt.text = texAry.toString();\n            fmt.path = pathAry.toString();\n          }\n        }); //只有让有index的传递到popup\n\n        var objfmt = format.filter(function (fmt) {\n          //   if (fmt.name == \"fileList\") {\n          //     fmt.text = inputparam.label;\n          //     fmt.path = inputparam.qualifiedName;\n          //   }\n          if (fmt.index != undefined) return fmt;\n        });\n        var obj = {\n          resource: inputparam,\n          format: objfmt,\n          status: status,\n          colnum: 3\n        };\n        target.createSystemPopupByLocalPath(\"popup\", {\n          width: \"80%\",\n          title: \"手顺书信息\",\n          on: {\n            submit: function submit(data, destroy) {\n              if (data.statuc == \"success\" && data.data) {\n                if (data.data.hasOwnProperty(\"fileList\")) {\n                  for (var i in data.data[\"fileList\"]) {\n                    data.data[\"fileList\"][i].fileName = data.data[\"fileList\"][i].label;\n                    data.data[\"fileList\"][i].filePath = data.data[\"fileList\"][i].qualifiedName;\n                  }\n                }\n\n                target.saveDeviceFaultBook(data.data, function (returnObj) {\n                  if (returnObj) {\n                    target.growl(\"保存成功\");\n                    readerData();\n                    if (destroy) destroy();\n                  }\n                });\n              }\n            }\n          }\n        }, obj);\n      };\n\n      var extendParam = {};\n\n      var readerData = function readerData() {\n        var paras4list = {\n          deviceId: resource.id,\n          name: \"\",\n          faultLedgerCode: \"\"\n        };\n        var sort = {\n          \"sort\": \"bookId\"\n        };\n\n        for (var k in extendParam) {\n          paras4list[k] = extendParam[k];\n        }\n\n        target.getDeviceFaultBookList([paras4list, sort], function (returnObj) {\n          render(returnObj);\n        });\n      }; //监听别的地方告诉我添加\n\n\n      if (scope.popupaddclick) {\n        scope.popupaddclick();\n        scope.popupaddclick = null;\n      }\n\n      scope.popupaddclick = scope.$on(\"POPUPADDCLICK\", function () {\n        popupHandler({\n          fileList: [],\n          deviceId: resource.id\n        }, 1);\n      });\n\n      if (scope.listsearchclick) {\n        scope.listsearchclick();\n        scope.listsearchclick = null;\n      }\n\n      scope.listsearchclick = scope.$on(\"LISTSEARCHCLICK\", function (param, args) {\n        extendParam = args;\n        readerData();\n      });\n\n      if (resource) {\n        readerData();\n      }\n\n      target.on(\"tree_resourceChange\", function (obj) {\n        resource = obj.resource;\n        readerData();\n      });\n    }\n  }\n};"],"sourceRoot":"/source/"}