{"version":3,"sources":["app-ac/js/controllers/user-shop-ctrl.js"],"names":["define","controllers","controller","$scope","$location","Info","userLoginUIService","unitService","dictionaryService","resourceUIService","modelDefinitionService","growl","configUIService","treeviewIndex","oldTreeviewIndex","currentMenuCode","firstMenuCode","localMenuCode","showMenu","menuitems","$on","rootHandler","shopLoginStatus","get","info","menu","feature","uniqueList","myOptionDic","menusFilter","item","functionCode","charAt","gotoHomePage","user","enterprise","logoStatus","location","href","logout","evt","d","callbackFun","isAuthenticated","userInfo","lastLoginTime","newDateJson","Format","GetDateCategoryStrByLabel","initMenus","getConfigsByGroupName","returnObj","code","data","length","forEach","baseConfig","jQuery","extend","JSON","parse","value","title","$","html","shortcut","attr","Date","getTime","e","getAllUnits","i","units","myOptions","unitCode","unitName","unitDics","getAllDicts","dicts","myDicts","dic","obj","dictCode","push","items","hasOwnProperty","getSimpleDistricts","provinces","findAllIndustry","industries"],"mappings":"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","file":"app-ac/js/controllers/user-shop-ctrl.js","sourcesContent":["define(['controllers/controllers'], function (controllers) {\n  'use strict';\n\n  controllers.controller('userShopCtrl', ['$scope', '$location', 'Info', 'userLoginUIService', 'unitService', 'dictionaryService', 'resourceUIService', 'modelDefinitionService', 'growl', 'configUIService', function ($scope, $location, Info, userLoginUIService, unitService, dictionaryService, resourceUIService, modelDefinitionService, growl, configUIService) {\n    $scope.treeviewIndex = \"\";\n    $scope.oldTreeviewIndex = \"\";\n    $scope.currentMenuCode = null; //当前的菜单编码\n\n    $scope.firstMenuCode = null; //第一层的菜单编码\n\n    $scope.localMenuCode = \"F01\"; //判断使用哪一个服务中心，用来替代localIndex\n\n    $scope.showMenu = false;\n    $scope.menuitems = {}; // 路由跳转成功后触发\n\n    $scope.$on('$routeChangeSuccess', function () {\n      userLoginUIService.rootHandler($scope, $location);\n    });\n    $scope.shopLoginStatus = \"\";\n    var info = Info.get(\"localdb/info.json\", function (info) {\n      $scope.menu = info.menu;\n      $scope.feature = info.uniqueList;\n    });\n    $scope.myOptionDic = {};\n\n    function initUnit() {\n      unitService.getAllUnits(function (returnObj) {\n        if (returnObj.code == 0) {\n          unitService.units = returnObj.data;\n          $scope.myOptions = returnObj.data;\n\n          for (var i in $scope.myOptions) {\n            $scope.myOptionDic[$scope.myOptions[i].unitCode] = $scope.myOptions[i].unitName;\n            if ($scope.myOptions[i].unitCode == \"NA\" || $scope.myOptions[i].unitCode == \"Number\") $scope.myOptionDic[$scope.myOptions[i].unitCode] = \"\";\n          }\n\n          unitService.unitDics = $scope.myOptionDic;\n        }\n      });\n      dictionaryService.getAllDicts(function (returnObj) {\n        if (returnObj.code == 0) {\n          dictionaryService.dicts = returnObj.data;\n          $scope.myDicts = returnObj.data;\n          var dic = {};\n\n          for (var i in returnObj.data) {\n            var obj = returnObj.data[i];\n\n            if (dic[obj.dictCode]) {\n              dic[obj.dictCode].push(obj);\n            } else {\n              dic[obj.dictCode] = [];\n              dic[obj.dictCode].push(obj);\n            }\n          }\n\n          for (var items in dic) {\n            $scope.myDicts[items] = dic[items];\n          }\n        }\n      });\n\n      if (!resourceUIService.hasOwnProperty(\"provinces\")) {\n        resourceUIService.getSimpleDistricts(function (returnObj) {\n          if (returnObj.code == 0) {\n            resourceUIService.provinces = returnObj.data;\n            $scope.provinces = returnObj.data;\n          }\n        });\n      }\n    }\n\n    $scope.menusFilter = function (item) {\n      return item.functionCode.charAt(0) === \"S\";\n    };\n\n    $scope.gotoHomePage = function () {\n      if (userLoginUIService.user.enterprise.logoStatus != '0') {\n        location.href = \"http://www.proudsmart.com\";\n      }\n    };\n\n    $scope.logout = function () {\n      userLoginUIService.logout(); //location.href =\"login.html\";\n    };\n\n    var initConfigManager = function initConfigManager(callbackFun) {\n      configUIService.getConfigsByGroupName(\"EnterpriseConfig\", function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data && returnObj.data.length > 0) {\n            returnObj.data.forEach(function (item) {\n              try {\n                if ($scope.baseConfig) {\n                  $scope.baseConfig = jQuery.extend(true, $scope.baseConfig, JSON.parse(item.value));\n                } else {\n                  $scope.baseConfig = JSON.parse(item.value);\n                }\n\n                if ($scope.baseConfig) {\n                  //拥有企业设置\n                  if ($scope.baseConfig.title) $(\"title\").html($scope.baseConfig.title);else $(\"title\").html(\"\");\n                  if ($scope.baseConfig.shortcut) $(\"link[rel='shortcut icon']\").attr(\"href\", \"../\" + $scope.baseConfig.shortcut + \"?\" + new Date().getTime());else $(\"link[rel='shortcut icon']\").attr(\"href\", \"../../login/images/shortcut_null.png\" + \"?\" + new Date().getTime());\n                }\n              } catch (e) {}\n            });\n          } else {\n            $(\"title\").html(\"\");\n            $(\"link[rel='shortcut icon']\").attr(\"href\", \"../../login/images/shortcut_null.png\" + \"?\" + new Date().getTime());\n          }\n\n          callbackFun();\n        }\n      });\n    };\n\n    var findAllIndustry = function findAllIndustry() {\n      modelDefinitionService.findAllIndustry(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.industries = returnObj.data;\n        }\n      });\n    };\n\n    $scope.$on('loginStatusChanged', function (evt, d) {\n      if (userLoginUIService.user.isAuthenticated) {\n        $scope.shopLoginStatus = \"login\";\n        $scope.userInfo = userLoginUIService.user;\n        $scope.lastLoginTime = newDateJson(userLoginUIService.user.lastLoginTime).Format(GetDateCategoryStrByLabel());\n        initConfigManager(function () {\n          userLoginUIService.initMenus($scope, $location);\n        });\n        initUnit();\n        findAllIndustry();\n      } else {\n        $scope.shopLoginStatus = \"loginOut\";\n      }\n    });\n  }]);\n});"],"sourceRoot":"/source/"}