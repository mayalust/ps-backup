define(["controllers/controllers"],function(e){"use strict";e.controller("flowConfigureCtrl",["$scope","$rootScope","$location","$timeout","growl","userEnterpriseService","userLoginUIService","resourceUIService","viewFlexService","userDomainService","solutionUIService","unitService","$location",function(d,t,i,e,o,n,r,a,s,u,c,l,f){d.errorMsg="",d.slide="1",d.treeAry=[],d.configureView=[],d.echartView=[],d.myOptions,d.handleUser="",d.userList="",d.defaultRoute="../app-oc/index.html#/processdesign",d.treeviewIndex="",d.oldTreeviewIndex="",d.currentMenuCode=null,d.firstMenuCode=null,d.localMenuCode="F01",d.showMenu=!1,d.menuitems={},d.$on("$routeChangeSuccess",function(){r.rootHandler(d,i)}),d.menusFilter=function(e){return"S"===e.functionCode.charAt(0)},d.homeClick=function(){window.open("http://www.proudsmart.com")},d.backClick=function(){-1<location.hash.search("#/displayView")||-1<location.hash.search("#/flow")?location.href="../app-oc/index.html#/processdesign":-1<location.hash.search("#/processView")&&(location.href="../app-oc/index.html#/workorderrecord")},t.indexShow=!1,t.personalShow=!0,d.routePathNodes={};var h=function(e,o){e.count=0;var t,i,n,r,d;Math.random();return e.icon=e.icon?e.icon:"fa fa-building-o",e.alertlv="bg-green",e.isLoaded=0,e.type=0,e.text=e.label,e.name=e.label,"Device"==(t=e).type?a.getManagedDevicesByModelId(t.id,function(e){if(0==e.code){var o=e.data;t.resources=o,t.resources.push({id:0,label:"无"}),i&&i()}}):a.getResourceByModelId(t.id,function(e){if(0==e.code){var o=e.data;t.resources=o,t.resources.push({id:0,label:"无"}),i&&i()}}),n=e,a.getAttrsByModelId(n.id,function(e){0==e.code&&(n.attrs=e.data,n.isLoaded=n.isLoaded+1,r&&r())}),d=e,a.getKpisByModelId(d.id,function(e){0==e.code&&(d.kpis=e.data,d.kpis.push({id:0,label:"无"}))}),e},p=function(e){c.getGroupModels(function(o){0==o.code&&a.getModels(function(e){e.data=e.data.concat(o.data),function(e){if(0==e.code){a.rootModelDic={};var o=e.data;for(var t in o){var i=o[t];d.routePathNodes[i.parentModelId]||(d.routePathNodes[i.parentModelId]=[]),d.routePathNodes[i.parentModelId].push(i),d.routePathNodes[i.id]||(d.routePathNodes[i.id]=[]),a.rootModelDic[i.id]=i,h(i)}var n=function e(o){for(var t in d.routePathNodes)if(t==o.id){for(var i in o.nodes=d.routePathNodes[t],o.nodes)e(o.nodes[i]);0==o.nodes.length&&(o.nodes=null)}};for(var r in n(a.rootModel),d.routePathNodes)if(r!=a.rootModel.id&&!a.rootModelDic[r])for(var t in d.routePathNodes[r])n(d.routePathNodes[r][t]),a.rootModel.nodes||(a.rootModel.nodes=[]),a.rootModel.nodes.push(d.routePathNodes[r][t]);a.rootModelDic[a.rootModel.id]=a.rootModel,d.rootModelDic=a.rootModelDic,d.rootModel=a.rootModel,d.treeAry=o}}(e)})})};function m(){d.configureView=[{viewId:0,viewTitle:"无"}],d.echartView=[{viewId:0,viewTitle:"无"}],s.getAllMyViews(function(e){0==e.code&&(e.data.forEach(function(e){"configure"==e.viewType&&d.configureView.push(e),"designView"==e.viewType&&d.echartView.push(e)}),d.$broadcast("RAPPIDVIEWS",{data:d.configureView}))})}d.logout=function(){r.logout()},d.domains=[];function M(){l.getAllUnits(function(e){if(0==e.code){for(var o in l.units=e.data,d.myOptions=e.data,l.unitDics={},d.myOptions)l.unitDics[d.myOptions[o].unitCode]=d.myOptions[o].unitName,"NA"!=d.myOptions[o].unitCode&&"Number"!=d.myOptions[o].unitCode||(l.unitDics[d.myOptions[o].unitCode]="");d.myOptionDic=l.unitDics}})}var v=!1,g=function(){v||(v=!0,u.queryDomainTree(r.user.userID,function(e){d.domainListTree=e.domainListTree,d.domainListDic=e.domainListDic;var o=[{domainPath:"",text:"无"}];!function o(e,t,i){e.forEach(function(e){e.text=function(e){for(var o="",t=0;t<e;t++)o+="*";return o}(t)+e.text,i.push(e),e.nodes&&o(e.nodes,t+2,i)})}(d.domainListTree,0,o),d.domains=o}),a.getRootModel(function(e){0==e.code&&(e.data.name=e.data.label,e.data.text=e.data.label,a.rootModel=e.data,d.selectedParentitem=e.data,p())}))};r.user.isAuthenticated?(M(),g(),m(),r.initMenus(d,i)):d.$on("loginStatusChanged",function(e,o){r.user.isAuthenticated?(t.staffName=r.user.userName,d.userInfo=r.user,M(),g(),m(),r.initMenus(d,i)):(d.errorMsg=r.result.message,d.errorStatus=1)})}])});
//# sourceMappingURL=../../../map/app-flowsheet/js/controllers/flow-ctrl.js.map
