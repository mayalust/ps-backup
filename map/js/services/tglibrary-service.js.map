{"version":3,"sources":["js/services/tglibrary-service.js"],"names":["define","services","tgmainService","q","userLoginUIService","rootScope","resourceUIService","kpiDataService","viewFlexService","window","location","SwSocket","uuid","factory","showCam","simulateAlert","kpiDes","nodeDes","directives","i","ifSimulateAlert","ipcam","health","camClick","openCam","closeCam","blinks","id","$randomString","width","height","left","top","background","marks","value","rotates","getValue","bars","webSocketBack","fullbars","barsOuters","charts","min","max","tg_labal","color","$on","unregister","this","getOption","webSocketBackChart","call","controllPanel","onSlide","parseInt","highLight","onChange","sendDeviceDirective","getTitle","$apply","toggles","getBoolean","boolChange","webSocketBackToggle","sendDeviceDirectiveBoolean","ci","getResourceById","then","event","label","cur","time","pushData","kpi","getValueList","arr","length","dataType","setValue","getKpisByKpiIds","Math","random","nodeName","title","round","nodes","kpis","category","timespan","deferred","def1","def2","nodesDes","kpisDes","minTimespan","kpiResDefer","result","push","optionDefault","animation","grid","containLabel","show","padding","text","textStyle","fontWeight","fontSize","tooltip","trigger","legend","data","calculable","xAxis","type","boundaryGap","axisLine","lineStyle","axisLabel","splitLine","axisTick","yAxis","splitNumber","series","name","itemStyle","normal","areaStyle","defer","promise","JSON","parse","stringify","resolve","getResourceByIds","all","valueList","$Array","vlistGroup","j","nodeId","kpiId","each","kpiCode","groupValue","date","newDateJson","arisingTime","timeStamp","getTime","first","vlGroup","$valueListGroup","op","$option","clearSeries","getxAxisByTime","eachValueListMerged","vg","$valueList","pushSeries","setFirstxAxis","setLegend","setTitle","setOption","option","getDirectivesByModelId","modelId","code","err","reject","console","log","node","param","isRealTimeData","timePeriod","nodeIds","kpiCodes","startTime","endTime","timeRange","statisticType","condList","error","alert","blinkClick","startBlink","stopBlink","orderHandlerClick","open","overviewClick","equipmentClick","malfunctionClick","chartClick","getAllMyViews","content","index","cp","find","indexOf","comId","val","ciid","toString","register","$formatDate","send","editService","route","handleView","resources","controlSetting","getAttrs","setAttrs","getResources","resource","getKpisByResource","getKpisByModelId","step","current","params","deviceGroupId","apply","viewId","originalViewId","viewTitle","viewName","viewType","updateView","addView","save","obj","$inject"],"mappings":"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","file":"js/services/tglibrary-service.js","sourcesContent":["define(['../services/services.js'], function (services) {\n  'use strict';\n\n  services.factory(\"tgmain\", tgmainService);\n  tgmainService.$inject = ['$q', 'userLoginUIService', '$rootScope', 'resourceUIService', 'kpiDataService', 'viewFlexService', '$window', '$location', 'SwSocket'];\n\n  function tgmainService(q, userLoginUIService, rootScope, resourceUIService, kpiDataService, viewFlexService, window, location, SwSocket) {\n    var uuid,\n        factory = {},\n        showCam = false,\n        simulateAlert = false,\n        kpiDes = {},\n        nodeDes = {},\n        directives = {};\n\n    factory.ifSimulateAlert = function () {\n      return simulateAlert;\n    };\n\n    factory.ipcam = {};\n    factory.health = {};\n\n    factory.camClick = function () {\n      if (factory.ipcam.openCam) {\n        factory.ipcam.openCam();\n      }\n\n      showCam = true;\n    };\n\n    factory.closeCam = function () {\n      if (factory.ipcam.closeCam) {\n        factory.ipcam.closeCam();\n      }\n\n      showCam = false;\n    };\n\n    factory.showCam = function () {\n      return showCam;\n    };\n\n    factory.blinks = [{\n      id: $randomString(32),\n      width: 13,\n      height: 20,\n      left: 44.7,\n      top: 7.8,\n      background: 'url(../img/tongji/tank1_red.png)'\n    }, {\n      id: $randomString(32),\n      width: 9,\n      height: 20,\n      left: 66.9,\n      top: 19.5,\n      background: 'url(../img/tongji/tank2_red.png)'\n    }];\n    factory.marks = [{\n      id: $randomString(32),\n      width: 1.3,\n      left: 50.7,\n      top: 25.6,\n      value: 100\n    }, {\n      id: $randomString(32),\n      width: 1.3,\n      left: 70.2,\n      top: 34.4,\n      value: 100\n    }];\n    factory.rotates = [{\n      id: $randomString(32),\n      top: 52,\n      left: 43,\n      value: 10,\n      getValue: getValue\n    }, {\n      id: $randomString(32),\n      top: 50,\n      left: 46,\n      value: 20,\n      getValue: getValue\n    }];\n    factory.bars = [{\n      id: $randomString(32),\n      width: 1.3,\n      height: 7.2,\n      left: 50.7,\n      top: 26,\n      value: 40,\n      getValue: getValue,\n      webSocketBack: webSocketBack\n    }, {\n      id: $randomString(32),\n      width: 1.3,\n      height: 7.2,\n      left: 70.2,\n      top: 34.7,\n      value: 50,\n      getValue: getValue,\n      webSocketBack: webSocketBack\n    }];\n    factory.fullbars = [{\n      id: $randomString(32),\n      width: 1.3,\n      height: 7.2,\n      left: 50.7,\n      top: 26,\n      value: 100\n    }, {\n      id: $randomString(32),\n      width: 1.3,\n      height: 7.2,\n      left: 70.2,\n      top: 34.7,\n      value: 100\n    }];\n    factory.barsOuters = [{\n      id: $randomString(32),\n      width: 3,\n      height: 7.7,\n      left: 49.9,\n      top: 26.3,\n      value: 100\n    }, {\n      id: $randomString(32),\n      width: 3,\n      height: 8,\n      left: 69.4,\n      top: 35.1,\n      value: 100\n    }];\n    factory.charts = [{\n      min: 0,\n      max: 100,\n      tg_labal: '混合罐子V102液位曲线',\n      color: \"#d99a37\"\n    }, {\n      min: 0,\n      max: 120,\n      tg_labal: '混合罐子V103液位曲线',\n      color: \"#c25262\"\n    }, {\n      min: 0,\n      max: 20,\n      tg_labal: '压力变送器PT101变化曲线',\n      color: \"#39a4d9\"\n    }, {\n      min: 0,\n      max: 100,\n      tg_labal: '压力变送器PT201变化曲线',\n      color: \"#d97c39\"\n    }, {\n      min: 0,\n      max: 100,\n      tg_labal: '孔板流量计FT101变化曲线',\n      color: \"#4ccbb4\"\n    }];\n    rootScope.$on(\"$destroy\", function () {\n      SwSocket.unregister(uuid);\n    });\n\n    for (var i in factory.charts) {\n      (function () {\n        this.id = $randomString(32);\n        this.getOption = getOption;\n        this.webSocketBack = webSocketBackChart;\n      }).call(factory.charts[i]);\n    }\n\n    factory.controllPanel = [{\n      tg_labal: '调节阀门FV101',\n      onSlide: function onSlide(value) {\n        factory.rotates[0].value = parseInt(value);\n\n        if (factory.rotates[0].highLight) {\n          factory.rotates[0].highLight();\n        }\n\n        this.value = value;\n      },\n      onChange: function onChange(value) {\n        factory.rotates[0].value = parseInt(value);\n\n        if (factory.rotates[0].highLight) {\n          factory.rotates[0].highLight();\n        }\n\n        this.value = value;\n\n        if (this.sendDeviceDirective) {\n          this.sendDeviceDirective(value);\n        }\n      }\n    }, {\n      tg_labal: '调节阀门FV201',\n      onSlide: function onSlide(value) {\n        factory.rotates[1].value = parseInt(value);\n\n        if (factory.rotates[1].highLight) {\n          factory.rotates[1].highLight();\n        }\n\n        this.value = value;\n      },\n      onChange: function onChange(value) {\n        factory.rotates[1].value = parseInt(value);\n\n        if (factory.rotates[1].highLight) {\n          factory.rotates[1].highLight();\n        }\n\n        this.value = value;\n\n        if (this.sendDeviceDirective) {\n          this.sendDeviceDirective(value);\n        }\n      }\n    }, {\n      tg_labal: '变频器U201',\n      onSlide: function onSlide(value) {\n        this.value = value;\n      },\n      onChange: function onChange(value) {\n        this.value = value;\n\n        if (this.sendDeviceDirective) {\n          this.sendDeviceDirective(value);\n        }\n      }\n    }, {\n      tg_labal: '调压模块GZ201',\n      onSlide: function onSlide(value) {\n        this.value = value;\n      },\n      onChange: function onChange(value) {\n        this.value = value;\n\n        if (this.sendDeviceDirective) {\n          this.sendDeviceDirective(value);\n        }\n      }\n    }];\n\n    for (var i in factory.controllPanel) {\n      (function () {\n        this.value = 50;\n        this.getTitle = getTitle;\n        this.getValue = getValue;\n\n        this.webSocketBack = function (value) {\n          var cur = this;\n          rootScope.$apply(function () {//cur.value = parseFloat(value);\n          });\n        };\n      }).call(factory.controllPanel[i]);\n    }\n\n    factory.marks[0].value = 50;\n    factory.marks[1].value = 50;\n    factory.toggles = [{\n      tg_labal: '原料泵P101'\n    }, {\n      tg_labal: '原料泵P201'\n    }, {\n      tg_labal: '变频泵P301'\n    }];\n\n    for (var i in factory.toggles) {\n      (function () {\n        this.getBoolean = getBoolean;\n        this.onChange = boolChange;\n        this.webSocketBack = webSocketBackToggle;\n      }).call(factory.toggles[i]);\n    }\n\n    function boolChange(value) {\n      this.value = value;\n\n      if (this.sendDeviceDirectiveBoolean) {\n        this.sendDeviceDirectiveBoolean(value);\n      }\n    }\n\n    ;\n\n    function getTitle(ci) {\n      var nodeName,\n          cur = this;\n      getResourceById(ci).then(function (event) {\n        nodeName = event.label; //cur.title = nodeName;\n      });\n    }\n\n    ;\n\n    function webSocketBackToggle(value) {\n      var cur = this;\n      rootScope.$apply(function () {\n        cur.value = parseInt(value) == 1 ? true : false;\n      });\n    }\n\n    ;\n\n    function webSocketBack(value) {\n      var cur = this;\n      rootScope.$apply(function () {\n        cur.value = value;\n      });\n    }\n\n    ;\n\n    function webSocketBackChart(value, time) {\n      var cur = this;\n      rootScope.$apply(function () {\n        if (cur.pushData) {\n          cur.pushData(value, time);\n        }\n      });\n    }\n\n    ;\n\n    function getValue(ci, kpi) {\n      var nodeName,\n          kpiName,\n          cur = this;\n      getValueList([ci], [kpi], 'ci', 0).then(function (arr) {\n        if (arr.length) {\n          cur.dataType = \"real\";\n\n          if (cur.setValue) {\n            cur.setValue(arr[0].value);\n          } else {\n            cur.value = arr[0].value;\n          }\n\n          getResourceById(ci).then(function (event) {\n            nodeName = event.label;\n            getKpisByKpiIds(kpi).then(function (event) {\n              kpiName = event.label; //cur.title = nodeName;\n            });\n          });\n        } else {\n          cur.dataType = \"virtual\";\n\n          if (cur.setValue) {\n            cur.setValue(parseInt(Math.random() * 100));\n          } else {\n            cur.value = parseInt(Math.random() * 100);\n          }\n\n          getResourceById(ci).then(function (event) {\n            nodeName = event.label;\n            getKpisByKpiIds(kpi).then(function (event) {\n              kpiName = event.label; //cur.title = nodeName + \"(模拟数据)\";\n            });\n          });\n        }\n      });\n    }\n\n    ;\n\n    function getBoolean(ci, kpi) {\n      var nodeName,\n          kpiName,\n          cur = this;\n      getValueList([ci], [kpi], 'ci', 0).then(function (arr) {\n        if (arr.length) {\n          cur.dataType = \"real\";\n\n          if (cur.setValue) {\n            cur.setValue(arr[0].value);\n          } else {\n            cur.value = arr[0].value;\n          }\n\n          getResourceById(ci).then(function (event) {\n            nodeName = event.label;\n            getKpisByKpiIds(kpi).then(function (event) {\n              kpiName = event.label;\n              cur.title = nodeName;\n            });\n          });\n        } else {\n          cur.dataType = \"virtual\";\n\n          if (cur.setValue) {\n            cur.setValue(Math.round(Math.random()) == 1 ? true : false);\n          } else {\n            cur.value = Math.round(Math.random()) == 1 ? true : false;\n          }\n\n          getResourceById(ci).then(function (event) {\n            nodeName = event.label;\n            getKpisByKpiIds(kpi).then(function (event) {\n              kpiName = event.label;\n              cur.title = nodeName + \"(模拟数据)\";\n            });\n          });\n        }\n      });\n    }\n\n    ;\n\n    factory.blinkClick = function () {\n      simulateAlert = !simulateAlert;\n\n      if (simulateAlert) {\n        for (var i in factory.blinks) {\n          factory.blinks[i].startBlink();\n        }\n\n        factory.health.startBlink();\n      } else {\n        for (var i in factory.blinks) {\n          factory.blinks[i].stopBlink();\n        }\n\n        factory.health.stopBlink();\n      }\n    };\n\n    factory.orderHandlerClick = function () {\n      window.open('index.html#/workorder', '_self');\n    };\n\n    factory.overviewClick = function () {\n      window.open('index.html', '_self');\n    };\n\n    factory.equipmentClick = function () {\n      window.open('index.html#/emcsView', '_self');\n    };\n\n    factory.malfunctionClick = function () {\n      window.open('index.html#/configAlert', '_self');\n    };\n\n    factory.chartClick = function () {\n      window.open('index.html#/designView', '_self');\n    };\n\n    viewFlexService.getAllMyViews(function (event) {\n      var content;\n      var views = new $Array(event.data);\n      var find = views.find(\"viewType\", \"tongji\");\n\n      if (find) {\n        try {\n          if (find.content) {\n            content = JSON.parse(find.content);\n            var controllPanel = content.controllPanel;\n            var toggles = content.toggles;\n            var charts = content.charts;\n            var nodes = [];\n            var kpis = [];\n\n            for (var i = 0; i < 2; i++) {\n              (function (index, cp) {\n                var ci = cp.node;\n                var kpi = cp.kpi;\n                factory.rotates[index].title = cp.title;\n                factory.rotates[index].getValue(ci, kpi);\n              })(i, controllPanel[i]);\n            }\n\n            for (var i = 0; i < 2; i++) {\n              (function (index, cp) {\n                var ci = cp.node;\n                var kpi = cp.kpi;\n                factory.bars[index].title = cp.title;\n                factory.bars[index].getValue(ci, kpi);\n              })(i, charts[i]);\n            }\n\n            for (var i in controllPanel) {\n              (function (index, cp) {\n                var kpi = cp.kpi;\n                var ci = cp.node;\n\n                if (nodes.indexOf(ci) == -1) {\n                  nodes.push(ci);\n                }\n\n                if (kpis.indexOf(kpi) == -1) {\n                  kpis.push(kpi);\n                }\n\n                factory.controllPanel[index].title = cp.title;\n                factory.controllPanel[index].getValue(ci, kpi);\n                getResourceById(ci).then(function success(event) {\n                  try {\n                    if (event) {\n                      var modelId = event.modelId;\n                      getDirectivesByModelId(modelId).then(function success(event) {\n                        try {\n                          if (event) {\n                            var comId = event[0].id;\n                            var nodeId = ci;\n\n                            factory.controllPanel[index].sendDeviceDirective = function (value) {\n                              resourceUIService.sendDeviceDirective(nodeId, comId, {\n                                value: value\n                              }, function (event) {});\n                            };\n                          } else {\n                            throw \"event.data is undefined!!\";\n                          }\n                        } catch (err) {\n                          console.log(err);\n                        }\n                      }, function error(err) {\n                        console.log(err);\n                      });\n                    } else {\n                      throw \"event.data is undefined!!\";\n                    }\n                  } catch (err) {\n                    console.log(err);\n                  }\n                }, function error(err) {\n                  console.log(err);\n                });\n                factory.controllPanel[index].getTitle(ci);\n              })(i, controllPanel[i]);\n            }\n\n            for (var i in toggles) {\n              (function (index, cp) {\n                var ci = cp.node;\n                var kpi = cp.kpi;\n\n                if (nodes.indexOf(ci) == -1) {\n                  nodes.push(ci);\n                }\n\n                if (kpis.indexOf(kpi) == -1) {\n                  kpis.push(kpi);\n                }\n\n                factory.toggles[index].title = cp.title;\n                factory.toggles[index].getBoolean(ci, kpi);\n                getResourceById(ci).then(function success(event) {\n                  try {\n                    if (event) {\n                      var modelId = event.modelId;\n                      getDirectivesByModelId(modelId).then(function success(event) {\n                        try {\n                          if (event) {\n                            var comId = event[0].id;\n                            var nodeId = ci;\n\n                            factory.toggles[index].sendDeviceDirectiveBoolean = function (value) {\n                              var val = value == true ? 1 : 0;\n                              resourceUIService.sendDeviceDirective(nodeId, comId, {\n                                value: val\n                              }, function (event) {});\n                            };\n                          } else {\n                            throw \"event.data is undefined!!\";\n                          }\n                        } catch (err) {\n                          console.log(err);\n                        }\n                      }, function error(err) {\n                        console.log(err);\n                      });\n                    } else {\n                      throw \"event.data is undefined!!\";\n                    }\n                  } catch (err) {\n                    console.log(err);\n                  }\n                }, function error(err) {\n                  console.log(err);\n                });\n              })(i, toggles[i]);\n            }\n\n            for (var i in charts) {\n              (function (index, cp) {\n                var ci = cp.node;\n                var kpi = cp.kpi;\n                var title = cp.title;\n                var color = factory.charts[index].color;\n                var max = factory.charts[index].max;\n                var min = factory.charts[index].min;\n                factory.charts[index].title = cp.title;\n                factory.charts[index].getOption(ci, kpi, 'time', 24 * 3600 * 100, title, color, max, min);\n\n                if (nodes.indexOf(ci) == -1) {\n                  nodes.push(ci);\n                }\n\n                if (kpis.indexOf(kpi) == -1) {\n                  kpis.push(kpi);\n                }\n              })(i, charts[i]);\n            }\n\n            uuid = Math.uuid();\n            var param = {\n              ciid: nodes.toString(),\n              kpi: kpis.toString()\n            };\n            SwSocket.register(uuid, \"register\", function (event) {\n              try {\n                if (event) {\n                  var kpiId = event.data.kpiCode;\n                  var nodeId = event.data.nodeId;\n\n                  for (var i in controllPanel) {\n                    (function (index, cp) {\n                      var ci = cp.node;\n                      var kpi = cp.kpi;\n\n                      if (ci == nodeId && kpi == kpiId) {\n                        if (factory.toggles[index]) {\n                          factory.controllPanel[index].webSocketBack(event.data.value);\n                        } else {//console.log(factory.charts[index]);\n                        }\n                      }\n                    })(i, controllPanel[i]);\n                  }\n\n                  for (var i in charts) {\n                    (function (index, cp) {\n                      var ci = cp.node;\n                      var kpi = cp.kpi;\n\n                      if (ci == nodeId && kpi == kpiId) {\n                        var timeStamp = event.data.arisingTime;\n                        var date = newDateJson(timeStamp);\n\n                        if (factory.bars[index]) {\n                          factory.bars[index].webSocketBack(event.data.value, $formatDate(date, \"时分\"));\n                        }\n                      }\n                    })(i, charts[i]);\n                  }\n\n                  for (var i in toggles) {\n                    (function (index, cp) {\n                      var ci = cp.node;\n                      var kpi = cp.kpi;\n\n                      if (ci == nodeId && kpi == kpiId) {\n                        if (factory.toggles[index]) {\n                          factory.toggles[index].webSocketBack(event.data.value);\n                        } else {//console.log(factory.charts[index]);\n                        }\n                      }\n                    })(i, toggles[i]);\n                  }\n\n                  for (var i in charts) {\n                    (function (index, cp) {\n                      var ci = cp.node;\n                      var kpi = cp.kpi;\n\n                      if (ci == nodeId && kpi == kpiId) {\n                        var timeStamp = event.data.arisingTime;\n                        var date = newDateJson(timeStamp);\n\n                        if (factory.charts[index]) {\n                          factory.charts[index].webSocketBack(event.data.value, $formatDate(date, \"时分\"));\n                        } else {//console.log(factory.charts[index]);\n                        }\n                      }\n                    })(i, charts[i]);\n                  }\n                } else {\n                  throw 'event is undefined!!';\n                }\n              } catch (error) {\n                console.log(error);\n              }\n            });\n            SwSocket.send(uuid, \"register\", 'kpi', param);\n          } else {\n            throw \"content id undefined!!\";\n          }\n        } catch (err) {\n          console.log(err);\n        }\n      } else {\n        window.open('index_tongji.html#/tongji/edit', '_self');\n      }\n    });\n\n    function getOption(nodes, kpis, category, timespan, title, color, max, min) {\n      var deferred,\n          def1,\n          def2,\n          nodesDes,\n          kpisDes,\n          minTimespan,\n          cur = this;\n      var kpiResDefer;\n      var result = [];\n\n      for (var i = 0; i < 7; i++) {\n        result.push(parseInt(Math.random() * 30));\n      }\n\n      var optionDefault = {\n        animation: true,\n        grid: {\n          left: '8%',\n          top: '10%',\n          width: \"80%\",\n          height: \"80%\",\n          containLabel: true\n        },\n        title: {\n          show: false,\n          padding: 30,\n          text: '草莓大棚温度变化',\n          \"textStyle\": {\n            \"fontWeight\": \"bold\",\n            \"fontSize\": 16\n          }\n        },\n        tooltip: {\n          trigger: 'axis'\n        },\n        legend: {\n          data: []\n        },\n        calculable: true,\n        xAxis: [{\n          type: 'category',\n          boundaryGap: false,\n          data: ['', '', '', '', '', '', ''],\n          \"axisLine\": {\n            \"lineStyle\": {\n              \"color\": \"#b0b0b0\",\n              \"width\": 1\n            }\n          },\n          axisLabel: {\n            \"show\": false,\n            \"textStyle\": {}\n          },\n          splitLine: {\n            \"lineStyle\": {\n              \"color\": \"rgb(239, 239, 239)\",\n              \"width\": 1\n            }\n          },\n          \"axisTick\": {\n            \"show\": false,\n            \"lineStyle\": {}\n          }\n        }],\n        yAxis: [{\n          show: true,\n          max: max,\n          min: min,\n          type: 'value',\n          splitNumber: 4,\n          boundaryGap: true,\n          \"axisLine\": {\n            \"lineStyle\": {\n              \"color\": \"#b0b0b0\",\n              \"width\": 1\n            }\n          },\n          splitLine: {\n            \"lineStyle\": {\n              \"color\": \"rgb(239, 239, 239)\",\n              \"width\": 1\n            }\n          },\n          axisLabel: {\n            \"show\": false,\n            \"textStyle\": {}\n          },\n          \"axisTick\": {\n            \"show\": false,\n            \"lineStyle\": {}\n          }\n        }],\n        series: [{\n          name: '数据',\n          type: 'line',\n          data: result,\n          itemStyle: {\n            normal: {\n              color: color\n            }\n          },\n          lineStyle: {\n            normal: {\n              color: color\n            }\n          },\n          areaStyle: {\n            normal: {\n              color: color\n            }\n          }\n        }]\n      };\n      deferred = q.defer();\n      def1 = q.defer();\n      def2 = q.defer();\n      kpiResDefer = [def1.promise, def2.promise];\n      resourceUIService.getKpisByKpiIds([kpis], function (event) {\n        kpisDes = JSON.parse(JSON.stringify(event));\n        minTimespan = kpisDes.minTimespan;\n        delete kpisDes.minTimespan;\n        def1.resolve(\"success\");\n      });\n      resourceUIService.getResourceByIds([nodes], function (event) {\n        nodesDes = event;\n        def2.resolve(\"success\");\n      });\n      q.all(kpiResDefer).then(function () {\n        getValueList([nodes], [kpis], category, timespan).then(function (event) {\n          var valueList = new $Array(event);\n\n          var vlistGroup = function () {\n            var result = new $Array([]);\n\n            for (var i in kpisDes) {\n              for (var j in nodesDes) {\n                result.push({\n                  nodeId: parseInt(j),\n                  nodeDes: nodesDes[j],\n                  kpiId: parseInt(i),\n                  kpiDes: kpisDes[i],\n                  valueList: []\n                });\n              }\n            }\n\n            return result;\n          }(kpisDes, nodesDes);\n\n          valueList.each(function (value) {\n            var kpiId = value.kpiCode;\n            var nodeId = value.nodeId;\n            vlistGroup.each(function (groupValue) {\n              if (groupValue.kpiId == kpiId && groupValue.nodeId == nodeId) {\n                var date = newDateJson(value.arisingTime);\n                value.timeStamp = date.getTime();\n                groupValue.valueList.push(value);\n              }\n            });\n          });\n\n          if (vlistGroup.first().valueList.length > 0) {\n            var vlGroup = new $valueListGroup(vlistGroup, minTimespan, '时分');\n            var op = new $option(JSON.parse(JSON.stringify(optionDefault)));\n            var xAxis, legend;\n            op.clearSeries();\n            legend = [];\n            xAxis = vlGroup.getxAxisByTime();\n            vlGroup.eachValueListMerged(function (vg) {\n              var name = vg.nodeDes.label + \"-\" + vg.kpiDes.label;\n              var data = vg.$valueList;\n              op.pushSeries(name, data);\n            });\n            op.setFirstxAxis(xAxis);\n            op.setLegend(legend);\n            op.setTitle(title);\n\n            if (op.getOption().series.length > 0) {\n              cur.dataType = \"real\";\n\n              if (cur.setOption) {\n                cur.setOption(op.getOption());\n              } else {\n                cur.option = op.getOption();\n              }\n            } else {\n              cur.dataType = \"virtual\";\n              optionDefault.title.text = title + \"(模拟数据)\";\n\n              if (cur.setOption) {\n                cur.setOption(optionDefault);\n              } else {\n                cur.option = optionDefault;\n              }\n            }\n\n            cur.title = title;\n          } else {\n            cur.dataType = \"virtual\";\n            optionDefault.title.text = title + \"(模拟数据)\";\n\n            if (cur.setOption) {\n              cur.setOption(optionDefault);\n            } else {\n              cur.option = optionDefault;\n            }\n          }\n        });\n      });\n      return deferred.promise;\n    }\n\n    function getDirectivesByModelId(modelId) {\n      var deferred = q.defer();\n\n      if (directives[modelId]) {\n        deferred.resolve(directives[modelId]);\n      } else {\n        resourceUIService.getDirectivesByModelId([modelId], function (event) {\n          try {\n            if (event.code == 0) {\n              if (event.data) {\n                directives[modelId] = event.data;\n                deferred.resolve(directives[modelId]);\n              } else {\n                throw 'data is empty';\n              }\n            } else {\n              throw event;\n            }\n          } catch (err) {\n            deferred.reject(err);\n            console.log(err);\n          }\n        });\n      }\n\n      return deferred.promise;\n    }\n\n    function getResourceById(node) {\n      var deferred = q.defer();\n\n      if (nodeDes[node]) {\n        deferred.resolve(nodeDes[node]);\n      } else {\n        resourceUIService.getResourceById([node], function (event) {\n          try {\n            if (event.code == 0) {\n              if (event.data) {\n                nodeDes[node] = event.data;\n                deferred.resolve(nodeDes[node]);\n              } else {\n                throw 'data is empty';\n              }\n            } else {\n              throw event;\n            }\n          } catch (err) {\n            deferred.reject(err);\n            console.log(err);\n          }\n        });\n      }\n\n      return deferred.promise;\n    }\n\n    function getKpisByKpiIds(kpi) {\n      var deferred = q.defer();\n\n      if (kpiDes[kpi]) {\n        deferred.resolve(kpiDes[kpi]);\n      } else {\n        resourceUIService.getKpisByKpiIds([kpi], function (event) {\n          try {\n            if (event) {\n              kpiDes[kpi] = event[kpi];\n              deferred.resolve(kpiDes[kpi]);\n            } else {\n              throw 'data is empty';\n            }\n          } catch (err) {\n            deferred.reject(err);\n            console.log(err);\n          }\n        });\n      }\n\n      return deferred.promise;\n    }\n\n    function getValueList(nodes, kpis, category, timespan) {\n      var deferred = q.defer();\n      var kpiQueryModel = {\n        category: category,\n        isRealTimeData: true,\n        timePeriod: timespan,\n        nodeIds: nodes,\n        kpiCodes: kpis,\n        startTime: null,\n        endTime: null,\n        timeRange: \"\",\n        statisticType: \"psiot\",\n        condList: []\n      };\n      var param = [\"kpi\", kpiQueryModel];\n      kpiDataService.getValueList(param, function (event) {\n        try {\n          if (event.code == 0) {\n            if (event.data) {\n              deferred.resolve(event.data);\n            } else {\n              throw \"event.data is undefined!\";\n            }\n          } else {\n            throw \"cannot get value list!\";\n          }\n        } catch (error) {\n          alert(error);\n        }\n      });\n      return deferred.promise;\n    }\n\n    ;\n    return factory;\n  }\n\n  services.factory(\"edit\", editService);\n  editService.$inject = ['$q', 'userLoginUIService', '$rootScope', 'resourceUIService', 'kpiDataService', 'viewFlexService', '$window', '$route'];\n\n  function editService(q, userLoginUIService, rootScope, resourceUIService, kpiDataService, viewFlexService, window, route) {\n    var factory = {},\n        handleView,\n        content,\n        deviceGroupId;\n    var resources;\n    factory.step = 0;\n\n    if (route.current) {\n      deviceGroupId = route.current.params.deviceGroupId;\n    } else {}\n\n    getResources().then(function success(resources) {\n      factory.resources = resources;\n    }, function error(err) {\n      console.log(err);\n    });\n    viewFlexService.getAllMyViews(function (event) {\n      var views = new $Array(event.data);\n      var find = views.find(\"viewType\", \"tongji\");\n\n      if (find) {\n        try {\n          if (find.content) {\n            content = JSON.parse(find.content);\n            var controllPanel = content.controllPanel;\n            var toggles = content.toggles;\n            var charts = content.charts;\n\n            for (var i in controllPanel) {\n              (function (index, cp) {\n                var ci = cp.node;\n                var kpi = cp.kpi;\n                var title = cp.title;\n                controlSetting.apply(factory.controllPanel[index], [ci, kpi, title]);\n              })(i, controllPanel[i]);\n            }\n\n            for (var i in toggles) {\n              (function (index, cp) {\n                var ci = cp.node;\n                var kpi = cp.kpi;\n                var title = cp.title;\n                controlSetting.apply(factory.toggles[index], [ci, kpi, title]);\n              })(i, toggles[i]);\n            }\n\n            for (var i in charts) {\n              (function (index, cp) {\n                var ci = cp.node;\n                var kpi = cp.kpi;\n                var title = cp.title;\n                controlSetting.apply(factory.charts[index], [ci, kpi, title]);\n              })(i, charts[i]);\n            }\n          } else {\n            throw \"content id undefined!!\";\n          }\n        } catch (err) {\n          console.log(err);\n        }\n\n        handleView = function handleView(data) {\n          var param = [{\n            viewId: find.viewId,\n            originalViewId: 0,\n            viewTitle: \"tongji\",\n            viewName: \"tongji\",\n            viewType: \"tongji\",\n            content: JSON.stringify(data)\n          }];\n          viewFlexService.updateView(param, function (event) {\n            window.open('index_tongji.html#/tongji', '_self');\n          });\n        };\n      } else {\n        handleView = function handleView(data) {\n          var param = [{\n            viewTitle: \"tongji\",\n            viewName: \"tongji\",\n            viewType: \"tongji\",\n            content: JSON.stringify(data)\n          }];\n          viewFlexService.addView(param, function (event) {\n            window.open('index_tongji.html#/tongji', '_self');\n          });\n        };\n      }\n    });\n\n    factory.save = function () {\n      var controllPanel = [],\n          toggles = [],\n          charts = [];\n\n      for (var i in factory.controllPanel) {\n        (function (obj) {\n          if (obj.getAttrs != null) {\n            controllPanel.push(obj.getAttrs());\n          }\n        })(factory.controllPanel[i]);\n      }\n\n      for (var i in factory.toggles) {\n        (function (obj) {\n          if (obj.getAttrs != null) {\n            toggles.push(obj.getAttrs());\n          }\n        })(factory.toggles[i]);\n      }\n\n      for (var i in factory.charts) {\n        (function (obj) {\n          if (obj.getAttrs != null) {\n            charts.push(obj.getAttrs());\n          }\n        })(factory.charts[i]);\n      }\n\n      handleView({\n        controllPanel: controllPanel,\n        toggles: toggles,\n        charts: charts\n      });\n    };\n\n    factory.controllPanel = [{\n      label: \"第一个滑动条\"\n    }, {\n      label: \"第二个滑动条\"\n    }, {\n      label: \"第三个滑动条\"\n    }, {\n      label: \"第四个滑动条\"\n    }];\n    factory.toggles = [{\n      label: \"第一个开关\"\n    }, {\n      label: \"第二个开关\"\n    }, {\n      label: \"第三个开关\"\n    }];\n    factory.charts = [{\n      label: \"第一个视图\"\n    }, {\n      label: \"第二个视图\"\n    }, {\n      label: \"第三个视图\"\n    }, {\n      label: \"第四个视图\"\n    }, {\n      label: \"第五个视图\"\n    }];\n\n    function controlSetting(ci, kpi, title) {\n      this.onChange = onChange;\n      this.getAttrs = getAttrs;\n      this.setAttrs = setAttrs;\n      this.setAttrs(ci, kpi, title);\n    }\n\n    ;\n\n    function setAttrs(ci, kpi, title) {\n      var cur = this;\n      getResources().then(function success(resources) {\n        //factory.resources = resources;\n        cur.resource = factory.resources.find(\"id\", ci);\n        cur.title = title;\n        getKpisByResource(cur.resource).then(function success(kpis) {\n          cur.kpis = kpis;\n          cur.kpi = kpis.find(\"id\", kpi);\n        }, function error(err) {\n          console.log(err);\n        });\n      }, function error(err) {\n        console.log(err);\n      });\n    }\n\n    ;\n\n    function getAttrs() {\n      return {\n        title: this.title,\n        kpi: this.kpi.id,\n        node: this.resource.id\n      };\n    }\n\n    ;\n\n    function onChange() {\n      var cur = this;\n      cur.title = cur.resource.label;\n      getKpisByResource(cur.resource).then(function success(kpis) {\n        cur.kpis = kpis;\n      }, function error(err) {\n        console.log(err);\n      });\n    }\n\n    ;\n\n    function getResources() {\n      var deferred = q.defer();\n\n      if (resources) {\n        deferred.resolve(resources);\n      } else {\n        resourceUIService.getResources(function (event) {\n          try {\n            if (event.code == 0) {\n              if (event.data) {\n                resources = new $Array(event.data);\n                deferred.resolve(resources);\n              } else {\n                throw 'data is empty';\n              }\n            } else {\n              throw event;\n            }\n          } catch (err) {\n            deferred.reject(err);\n            console.log(err);\n          }\n        });\n      }\n\n      return deferred.promise;\n    }\n\n    ;\n\n    function getKpisByResource(resource) {\n      var deferred = q.defer();\n\n      if (resource.kpis) {\n        deferred.resolve(resource.kpis);\n      } else {\n        var modelId = resource.modelId;\n        resourceUIService.getKpisByModelId([modelId], function (event) {\n          try {\n            if (event.code == 0) {\n              if (event.data) {\n                resource.kpis = new $Array(event.data);\n                deferred.resolve(resource.kpis);\n              } else {\n                throw 'data is empty';\n              }\n            } else {\n              throw event;\n            }\n          } catch (err) {\n            deferred.reject(err);\n            console.log(err);\n          }\n        });\n      }\n\n      return deferred.promise;\n    }\n\n    return factory;\n  }\n\n  ;\n});"],"sourceRoot":"/source/"}