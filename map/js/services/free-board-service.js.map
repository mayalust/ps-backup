{"version":3,"sources":["js/services/free-board-service.js"],"names":["define","services","factory","serviceProxy","serviceCenterService","route","userDomainService","viewFlexService","q","thridPartyApiService","resourceUIService","Info","growl","userLoginUIService","projectUIService","customMethodService","ticketTaskService","alertService","SwSocket","kpiDataService","routeParam","commonMethodService","service","Object","prototype","traveseByChild","callback","this","traverse","data","i","children","InfoData","load","path","cur","defer","back","get","info","$extension","defineProperty","enumerable","replaceCiKpi","template","rootTarget","scope","Error","clone","$clone","defers","layout","element","type","$remapByChild","rs","setRootTarget","renderAttr","getCiKpi","ci","kpi","resource","resolve","source","viewId","$$","cacheAsyncData","call","getViewById","event","code","json","JSON","parse","content","push","promise","all","then"],"mappings":"AAAAA,OAAO,CAAC,2BAA4B,SAAUC,GAC5C,aAEAA,EAASC,QAAQ,mBAAoB,CAAC,eAAgB,uBAAwB,SAAU,oBAAqB,kBAAmB,KAAM,uBAAwB,oBAAqB,OAAQ,QAAS,qBAAsB,mBAAoB,sBAAuB,oBAAqB,eAAgB,WAAY,iBAAkB,eAAgB,sBAAuB,SAAUC,EAAcC,EAAsBC,EAAOC,EAAmBC,EAAiBC,EAAGC,EAAsBC,EAAmBC,EAAMC,EAAOC,EAAoBC,EAAkBC,EAAqBC,EAAmBC,EAAcC,EAAUC,EAAgBC,EAAYC,GACjoB,IAAIC,EAAU,GA4Gd,OAzGAC,OAAOC,UAAUC,eAAiB,SAAUC,GAC1CA,EAASC,KAAM,CAACA,OAGhB,SAASC,EAASC,GAChB,IAAK,IAAIC,KAAKD,EACZH,EAASG,EAAKC,GAAID,GAEdA,EAAKC,GAAGC,UACVH,EAASC,EAAKC,GAAGC,UAPvBH,CAASD,KAAKI,WAahBT,EAAQU,SAAW,CACjBC,KAAM,SAAcC,GAClB,IAAIC,EAAMR,KAEVQ,EAAIC,MAAQ,SAAUV,GACpBS,EAAIE,KAAOX,GAGbf,EAAK2B,IAAIJ,EAAM,SAAUK,GACvBJ,EAAIK,WAAWD,GACfJ,EAAIC,MAAQ,SAEW,mBAAZD,EAAIE,MACbF,EAAIE,UAIVD,MAAO,QAETb,OAAOkB,eAAelB,OAAOC,UAAW,iBAAkB,CACxDkB,YAAY,IAGdpB,EAAQqB,aAAe,SAAUd,EAAMH,EAAUkB,EAAUC,EAAYC,GACrE,QAAqB,IAAVA,EACT,MAAM,IAAIC,MAAM,4CAGlB,IAAIZ,EAAMR,KACNqB,EAAQnB,EAAKoB,SACbC,EAAS,GACbF,EAAMG,OAAO1B,eAAe,SAAU2B,GAChB,YAAhBA,EAAQC,OACVD,EAAQrB,SAAW,MAGvBiB,EAAMG,OAAStB,EAAKsB,OAAOG,cAAc,SAAUF,GACjD,IAAIG,EAAKlC,EAAoB+B,EAASN,GAEtC,OADAS,EAAGC,cAAcX,GACVU,IAETpB,EAAIc,OAAOD,GACXb,EAAIgB,OAAO1B,eAAe,SAAU2B,GAClC,IAAIhB,EAAQ5B,EAAE4B,QAEVqB,EAAa,WACXL,EAAQvB,KACVuB,EAAQM,SAAS,SAAUC,EAAIC,GACzBR,EAAQvB,OACVuB,EAAQvB,KAAKgC,SAAWF,EACxBP,EAAQvB,KAAK+B,IAAMA,GAIrBxB,EAAM0B,QAAQ,aAGhB1B,EAAM0B,QAAQ,YAMlB,GAAIV,EAAQW,OAGV,GAAc,QAFDX,EAAQW,OAEC,CACpB,IAAIC,EAASZ,EAAQY,OACrBC,GAAGC,eAAeC,KAAK5D,EAAgB6D,YAAa,CAACJ,GAAS,SAAUK,GACtE,GAAkB,GAAdA,EAAMC,MAA2B,MAAdD,EAAMxC,KAAc,CACzC,IAAI0C,EAAOC,KAAKC,MAAMJ,EAAMxC,KAAK6C,SACjCtB,EAAQoB,KAAOD,EAGjBd,WAGFA,SAGFA,IAGFP,EAAOyB,KAAKvC,EAAMwC,WAEpBpE,EAAEqE,IAAI3B,GAAQ4B,KAAK,WACjBpD,EAASS,MAINb,KAETrB,EAASC,QAAQ,cAAe,CAAC,eAAgB,uBAAwB,KAAM,oBAAqB,OAAQ,SAAUC,EAAcC,EAAsBI,EAAGE,EAAmBC,GAE9K,MADc","file":"js/services/free-board-service.js","sourcesContent":["define(['../services/services.js'], function (services) {\n  'use strict';\n\n  services.factory('freeboardservice', ['serviceProxy', 'serviceCenterService', '$route', 'userDomainService', 'viewFlexService', '$q', 'thridPartyApiService', 'resourceUIService', 'Info', 'growl', \"userLoginUIService\", 'projectUIService', 'customMethodService', 'ticketTaskService', 'alertService', 'SwSocket', 'kpiDataService', '$routeParams', 'commonMethodService', function (serviceProxy, serviceCenterService, route, userDomainService, viewFlexService, q, thridPartyApiService, resourceUIService, Info, growl, userLoginUIService, projectUIService, customMethodService, ticketTaskService, alertService, SwSocket, kpiDataService, routeParam, commonMethodService) {\n    var service = {},\n        freeBoardValue;\n\n    Object.prototype.traveseByChild = function (callback) {\n      callback(this, [this]);\n      traverse(this.children);\n\n      function traverse(data) {\n        for (var i in data) {\n          callback(data[i], data);\n\n          if (data[i].children) {\n            traverse(data[i].children);\n          }\n        }\n      }\n    };\n\n    service.InfoData = {\n      load: function load(path) {\n        var cur = this;\n\n        cur.defer = function (callback) {\n          cur.back = callback;\n        };\n\n        Info.get(path, function (info) {\n          cur.$extension(info);\n          cur.defer = 'LOADED';\n\n          if (typeof cur.back == 'function') {\n            cur.back();\n          }\n        });\n      },\n      defer: 'WAIT'\n    };\n    Object.defineProperty(Object.prototype, \"traveseByChild\", {\n      enumerable: false\n    });\n\n    service.replaceCiKpi = function (data, callback, template, rootTarget, scope) {\n      if (typeof scope === \"undefined\") {\n        throw new Error(\"replaceCiKpi error, scope is not defined\");\n      }\n\n      var cur = this;\n      var clone = data.$clone();\n      var defers = [];\n      clone.layout.traveseByChild(function (element) {\n        if (element.type == \"injector\") {\n          element.children = [];\n        }\n      });\n      clone.layout = data.layout.$remapByChild(function (element) {\n        var rs = commonMethodService(element, scope);\n        rs.setRootTarget(rootTarget);\n        return rs;\n      });\n      cur.$clone(clone);\n      cur.layout.traveseByChild(function (element) {\n        var defer = q.defer();\n\n        var renderAttr = function renderAttr() {\n          if (element.data) {\n            element.getCiKpi(function (ci, kpi) {\n              if (element.data) {\n                element.data.resource = ci;\n                element.data.kpi = kpi;\n              }\n\n              ;\n              defer.resolve(\"success\");\n            });\n          } else {\n            defer.resolve(\"success\");\n          }\n\n          ;\n        };\n\n        if (element.source) {\n          var source = element.source;\n\n          if (source == \"TOPO\") {\n            var viewId = element.viewId;\n            $$.cacheAsyncData.call(viewFlexService.getViewById, [viewId], function (event) {\n              if (event.code == 0 && event.data != null) {\n                var json = JSON.parse(event.data.content);\n                element.JSON = json;\n              }\n\n              renderAttr();\n            });\n          } else {\n            renderAttr();\n          }\n        } else {\n          renderAttr();\n        }\n\n        defers.push(defer.promise);\n      });\n      q.all(defers).then(function () {\n        callback(cur);\n      });\n    };\n\n    return service;\n  }]);\n  services.factory('dataservice', ['serviceProxy', 'serviceCenterService', '$q', 'resourceUIService', 'Info', function (serviceProxy, serviceCenterService, q, resourceUIService, Info) {\n    var service = {};\n    return service;\n  }]);\n});"],"sourceRoot":"/source/"}