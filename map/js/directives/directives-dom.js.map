{"version":3,"sources":["js/directives/directives-dom.js"],"names":["define","directives","initDirective","$timeout","$compile","growl","restrict","controller","$scope","$element","$attrs","table","domMain","isEditing","$on","Event","DIRECTIVESINIT","event","args","destroy","DataTable","dom","language","$","ProudSmart","datatable","data","columns","title","orderable","columnDefs","targets","render","type","full","isEdit","str","canEdit","isNew","on","selectedDitem","parentDom","parent","html","e","preventDefault","tr","this","closest","row","hasClass","removeClass","addClass","devicePointInit","stopPropagation","tds","parents","children","checkPass","each","i","val","jqob","txt","cells","invalidate","length","warning","cell","doAction","returnObj","id","isDel","rowData","flg","remove","draw"],"mappings":"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","file":"js/directives/directives-dom.js","sourcesContent":["define(['directives/directives'], function (directives) {\n  'use strict';\n\n  directives.initDirective('directiveTable', ['$timeout', '$compile', 'growl', function ($timeout, $compile, growl) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var itemAttrs;\n        $scope.$on(Event.DIRECTIVESINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            //scrollX: true,\n            columns: [{\n              data: \"name\",\n              title: \"指令名称\"\n            }, {\n              data: \"commandCode\",\n              title: \"指令编码\"\n            }, {\n              data: \"description\",\n              title: \"描述\"\n            }, {\n              data: \"option\",\n              title: \"操作\",\n              //width: \"140px\",\n              orderable: false //去掉操作项排序功能\n              //visible: $scope.selectedDitem && $scope.selectedDitem.canEdit\n\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"name\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\n                if (full.isEdit == 2 && type == \"display\") return \"<input class='form-control input-sm' style='border: 1px solid #F18282;width: 100%;' type='text'  value='\" + data + \"'>\";else return data;\n              }\n            }, {\n              targets: 1,\n              data: \"commandCode\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\n                if (full.isEdit == 2 && type == \"display\") return \"<input class='form-control input-sm' style='border: 1px solid #F18282;width: 100%;' type='number'  value='\" + data + \"'>\";else return data;\n              }\n            }, {\n              targets: 2,\n              data: \"description\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\n                if (full.isEdit == 2 && type == \"display\") return \"<input class='form-control input-sm'  type='text' value='\" + (data ? data : '') + \"'>\";else return data;\n              }\n            }, {\n              targets: 3,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\n                var str = \"<div class='btn-group btn-group-sm'>\";\n\n                if (full.canEdit) {\n                  if (full.isEdit == 2) {\n                    str += \"<a id='save-btn' class='btn btn-default btn-sm' ><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>\";\n                    if (full.isNew) str += \"<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\";else str += \"<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>\";\n                  } else {\n                    str += \"<div class='btn-group table-option-group' >\" + \"<button type='button' class='btn btn-default btn-sm'>操作</button>\" + \"<button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'>\" + \"<span class='caret'></span>\" + \"<span class='sr-only'>Toggle Dropdown</span>\" + \"</button>\" + \"<ul class='dropdown-menu' role='menu'>\" + \"<li><a  href='' id='edit-btn'>修改</a></li>\" + //\"<li><a  href='' id='params-btn'>解析</a></li>\" +\n                    \"<li><a  href='' id='del-btn'>删除</a></li>\" + \"<li><a  href='' id='point-btn'>设置测点</a></li>\" + \"</ul>\" + \"</div>\";\n                  } //                  } else {\n                  //                    str += \"<a id='params-btn' class='btn btn-default btn-sm'><i class='fa fa-link hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 解析</span></a>\"\n                  //                    str += \"<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\"\n\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          if ($scope.selectedDitem && $scope.selectedDitem.canEdit) {\n            var parentDom = $(\".special-btn\").parent();\n            parentDom.html('<a ng-click=\"addModelSubItem()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加指令</span></a>');\n            $compile(parentDom)($scope);\n          }\n        });\n        domMain.on('click', '#point-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (tr.hasClass('time-color')) {\n            tr.removeClass('time-color');\n          } else {\n            table.$('tr.time-color').removeClass('time-color');\n            tr.addClass('time-color');\n          }\n\n          $scope.devicePointInit(row.data(), \"point\");\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (row.data().isEdit == 2) {\n            var tds = $(this).parents(\"tr\").children();\n            var checkPass = true;\n            $.each(tds, function (i, val) {\n              var jqob = $(val);\n\n              if (i == 0 || i == 1) {\n                var txt = jqob.children(\"input\").val();\n\n                if (!txt) {\n                  $(val).addClass('danger');\n                  checkPass = false;\n                  row.data().isEdit = 2;\n                  row.cells().invalidate();\n                  return false;\n                } else {\n                  if (i == 1) {\n                    if (txt.length > 4) {\n                      growl.warning(\"您输入任务编码超过了4位数字!\", {});\n                      $(val).addClass('danger');\n                      checkPass = false;\n                      return false;\n                    }\n                  }\n\n                  $(val).removeClass('danger');\n                }\n              } //if (i == 1) {\n              //  var txt = $(val).children(\"select\").val();\n              //  jqob.html(txt);\n              //  table.cell(jqob).data(txt); //修改DataTables对象的数据\n              //  return true;\n              //}\n\n\n              if (i == 3) {\n                row.cell(jqob).invalidate();\n                return true;\n              }\n\n              var txt = jqob.children(\"input\").val();\n              jqob.html(txt);\n              table.cell(jqob).data(txt); //修改DataTables对象的数据\n            });\n\n            if (checkPass) {\n              $scope.doAction(\"directive-save\", row.data(), function (returnObj) {\n                if (returnObj == false) {\n                  row.data().isEdit = 2;\n                } else {\n                  row.data().id = returnObj.id;\n                  row.data().isEdit = 0;\n                  row.data().isNew = false;\n                  row.cells().invalidate();\n                  isEditing = false;\n                }\n              });\n            }\n          }\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n\n          if (!isEditing) {\n            isEditing = true;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 2;\n            row.cells().invalidate();\n          } else {\n            $scope.doAction(\"thresholdMessage\", \"当前有修改中的指令，请先完成该操作\");\n          }\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data().isDel = true;\n          var rowData = row.data();\n          $scope.doAction(\"directive-delete\", rowData, function (flg) {\n            if (flg) row.remove().draw(false);\n          });\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.preventDefault();\n\n          if (isEditing) {\n            isEditing = false;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 0;\n            row.cells().invalidate();\n          }\n        });\n        domMain.on('click', '#params-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (row.data().isEdit == 2) {\n            var tds = $(this).parents(\"tr\").children();\n            var checkPass = true;\n            $.each(tds, function (i, val) {\n              var jqob = $(val);\n\n              if (i == 2) {\n                var txt = jqob.children(\"input\").val();\n\n                if (!txt) {\n                  $(val).addClass('danger');\n                  checkPass = false;\n                  return false;\n                } else {\n                  $(val).removeClass('danger');\n                }\n\n                if (checkPass) {\n                  var txt = jqob.children(\"input\").val();\n                  table.cell(jqob).data(txt); //修改DataTables对象的数据\n\n                  $scope.doAction(\"directive-params\", row.data());\n                }\n              }\n            });\n          } else {\n            $scope.doAction(\"directive-params\", row.data());\n          }\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}