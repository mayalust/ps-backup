{"version":3,"sources":["js/directives/select-list-dom.js"],"names":["define","directives","initDirective","timeout","compile","templateUrl","restrict","scope","source","name","titles","link","element","attr","$watch","n","o","s","item","keyhistory","shiftPress","ctrlPress","shiftKeyUp","event","keyCode","$","off","on","shiftKeyDown","ctrlKeyUp","ctrlKeyDown","$apply","i","selected","dropRight","switchItem","dropLeft","leftFilter","elem","applied","leaveplace","rightFilter","rightFilterNoCheck","every","leftFilterNoCheck","bool","console","log","checked","filter","renew","leftToRight","rightToLeft","start","self","this","stop","click","checklist","undefined","$remove","index","push","length","_addFn","lastpress","el","target","$$","loadExternalJs","draggable","cursor","cursorAt","top","left","appendTo","revert","containment","scroll","revertDuration","zIndex","helper","ui","result","map","rs","slice","text","toString","append","addClass","drop","stopPropagation","droppable"],"mappings":"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","file":"js/directives/select-list-dom.js","sourcesContent":["define(['directives/directives'], function (directives) {\n  'use strict';\n\n  directives.initDirective('selectList', ['$timeout', '$compile', function (timeout, compile) {\n    return {\n      templateUrl: \"../partials/select_list.html\",\n      restrict: 'A',\n      scope: {\n        source: \"=\",\n        name: \"=\",\n        titles: \"=\"\n      },\n      link: function link(scope, element, attr) {\n        var ready = function ready() {\n          var sourceWatcher = function sourceWatcher(n, o, s) {\n            var keyhistory = [];\n\n            if (n) {\n              var shiftPress = false,\n                  ctrlPress = false;\n\n              var shiftKeyUp = function shiftKeyUp(event) {\n                if (event.keyCode == 16) {\n                  shiftPress = false;\n                  $(\"body\").off(\"keyup.shift\");\n                  $(\"body\").on(\"keydown.shift\", shiftKeyDown);\n                }\n              };\n\n              var ctrlKeyUp = function ctrlKeyUp(event) {\n                if (event.keyCode == 91) {\n                  ctrlPress = false;\n                  $(\"body\").off(\"keyup.ctrl\");\n                  $(\"body\").on(\"keydown.ctrl\", ctrlKeyDown);\n                }\n              };\n\n              var shiftKeyDown = function shiftKeyDown(event) {\n                if (event.keyCode == 16) {\n                  shiftPress = true;\n                  $(\"body\").off(\"keydown.shift\");\n                  $(\"body\").on(\"keyup.shift\", shiftKeyUp);\n                }\n              };\n\n              var ctrlKeyDown = function ctrlKeyDown(event) {\n                if (event.keyCode == 91) {\n                  ctrlPress = true;\n                  $(\"body\").off(\"keydown.ctrl\");\n                  $(\"body\").on(\"keyup.ctrl\", ctrlKeyUp);\n                }\n              };\n\n              var bodyClick = function bodyClick(event) {\n                s.$apply(function () {\n                  for (var i in n) {\n                    n[i].selected = false;\n                  }\n                });\n              };\n\n              $(\"body\").on(\"keydown.shift\", shiftKeyDown);\n              $(\"body\").on(\"keydown.ctrl\", ctrlKeyDown);\n              $(\"body\").on(\"click.whole\", bodyClick);\n\n              scope.dropRight = function () {\n                switchItem(true);\n              };\n\n              scope.dropLeft = function () {\n                switchItem(false);\n              };\n\n              scope.leftFilter = function (elem) {\n                return elem.applied != true && elem.leaveplace != true;\n              };\n\n              scope.rightFilter = function (elem) {\n                return elem.applied == true && elem.leaveplace != true;\n              };\n\n              scope.rightFilterNoCheck = function () {\n                var every = n.every(function (elem) {\n                  return elem.applied != true || elem.selected != true;\n                });\n                return !every;\n              };\n\n              scope.leftFilterNoCheck = function () {\n                var every = n.every(function (elem) {\n                  return elem.applied == true || elem.selected != true;\n                });\n                return !every;\n              };\n\n              var switchItem = function switchItem(bool) {\n                console.log(\"switchItem\");\n                keyhistory = [];\n                var checked = n.filter(function (elem) {\n                  return elem.selected == true;\n                });\n\n                var loop = function loop(item) {\n                  item.applied = bool;\n                  item.selected = false;\n                  item.renew = true;\n                };\n\n                for (var i in checked) {\n                  loop(checked[i]);\n                }\n              };\n\n              scope.leftToRight = function () {\n                switchItem(true);\n              };\n\n              scope.rightToLeft = function () {\n                switchItem(false);\n              };\n\n              var loop = function loop(item) {\n                item.start = function () {\n                  var self = this;\n\n                  if (self.selected != true) {\n                    self.selected = true;\n                    keyhistory = [self];\n                  }\n\n                  ;\n\n                  for (var i in n) {\n                    if (n[i].selected == true) {\n                      n[i].leaveplace = true;\n                    }\n                  }\n                };\n\n                item.stop = function () {\n                  for (var i in n) {\n                    if (n[i].leaveplace == true) {\n                      n[i].leaveplace = false;\n                    }\n                  }\n                };\n\n                item.click = function () {\n                  var self = this;\n                  var checklist = n.filter(function (elem) {\n                    if (self.applied) {\n                      return self.applied == elem.applied;\n                    } else {\n                      return elem.applied == false || elem.applied == undefined;\n                    }\n                  });\n\n                  for (var i in n) {\n                    n[i].renew = false;\n                  }\n\n                  if (ctrlPress || shiftPress) {\n                    if (shiftPress) {\n                      keyhistory.$remove(function (index, elem) {\n                        return elem == self;\n                      });\n                      keyhistory.push(self);\n\n                      if (keyhistory.length > 1) {\n                        var lastpress = keyhistory[keyhistory.length - 2];\n\n                        var _addFn;\n\n                        var loop = function loop(elem) {\n                          if (_addFn == undefined) {\n                            if (elem == self || elem == lastpress) {\n                              elem.selected = true;\n\n                              _addFn = function addFn(el) {\n                                el.selected = true;\n\n                                if (el == self || el == lastpress) {\n                                  _addFn = undefined;\n                                }\n                              };\n                            }\n                          } else if (typeof _addFn == 'function') {\n                            _addFn(elem);\n                          }\n                        };\n\n                        for (var i in checklist) {\n                          loop(checklist[i]);\n                        }\n                      }\n\n                      ;\n                    } else {\n                      if (self.selected != true) {\n                        self.selected = true;\n                        keyhistory.push(this);\n                      } else {\n                        self.selected = false;\n                        keyhistory.$remove(function (index, elem) {\n                          return elem == this;\n                        });\n                      }\n                    }\n                  } else {\n                    for (var i in n) {\n                      n[i].selected = false;\n                    }\n\n                    self.selected = true;\n                    keyhistory = [self];\n                  }\n\n                  console.log(n);\n                };\n              };\n\n              for (var i in n) {\n                loop(n[i]);\n              }\n            }\n          };\n\n          scope.$watch(\"source\", sourceWatcher);\n        };\n\n        timeout(ready);\n      }\n    };\n  }]);\n  directives.initDirective('selectDrag', ['$timeout', '$compile', function (timeout, compile) {\n    return {\n      restrict: 'A',\n      scope: {\n        target: \"=\",\n        start: \"&\",\n        stop: \"&\",\n        name: \"=\"\n      },\n      link: function link(scope, element, attr) {\n        var ready = function ready() {\n          var itemWatcher = function itemWatcher(n, o, s) {\n            if (n) {\n              var jqueryUiReady = function jqueryUiReady() {\n                var helper = function helper(ui) {\n                  var filter = n.filter(function (elem) {\n                    return elem.selected == true;\n                  }).map(function (elem) {\n                    console.log(elem, scope.name);\n                    return elem[scope.name];\n                  });\n                  var result;\n\n                  if (filter.length > 2) {\n                    var rs = filter.slice(0, 2);\n                    rs.push(\"等\" + filter.length + \"个\");\n                    result = $(\"<div></div>\").text(rs.toString());\n                  } else if (filter.length > 0) {\n                    var rs = filter;\n                    result = $(\"<div></div>\").text(rs.toString());\n                  } else if (filter.length == 0) {\n                    var rs = $(ui.target);\n                    console.log(rs);\n                    result = $(\"<div></div>\").append(rs);\n                  }\n\n                  result.attr(\"id\", \"select-helper\");\n                  result.addClass(\"item\");\n                  return result;\n                };\n\n                var start = function start() {\n                  s.$apply(function () {\n                    s.start();\n                  });\n                };\n\n                var stop = function stop() {\n                  s.$apply(function () {\n                    s.stop();\n                  });\n                };\n\n                $(element).draggable({\n                  cursor: 'move',\n                  cursorAt: {\n                    top: 5,\n                    left: 5\n                  },\n                  appendTo: 'body',\n                  revert: true,\n                  containment: 'body',\n                  scroll: false,\n                  revertDuration: 0,\n                  zIndex: 9999999,\n                  helper: helper,\n                  start: start,\n                  stop: stop\n                });\n              };\n\n              $$.loadExternalJs([\"jquery-ui\"], jqueryUiReady);\n            }\n          };\n\n          scope.$watch(\"target\", itemWatcher);\n        };\n\n        timeout(ready);\n      }\n    };\n  }]);\n  directives.initDirective('selectDrop', ['$timeout', '$compile', function (timeout, compile) {\n    return {\n      restrict: 'A',\n      scope: {\n        target: \"=\",\n        drop: \"&\"\n      },\n      link: function link(scope, element, attr) {\n        var drop = function drop(event) {\n          event.stopPropagation();\n          scope.$apply(function () {\n            scope.drop();\n          });\n        };\n\n        var jqueryUiReady = function jqueryUiReady() {\n          $(element).droppable({\n            drop: drop\n          });\n        };\n\n        $$.loadExternalJs([\"jquery-ui\"], jqueryUiReady);\n      }\n    };\n  }]);\n});"],"sourceRoot":"/source/"}