{"version":3,"sources":["js/directives/resource-dom.js"],"names":["define","directives","BootstrapDialog","datatables","initDirective","$timeout","$compile","growl","restrict","controller","$scope","$element","$attrs","table","domMain","$on","event","args","destroy","empty","DataTable","dom","data","length","$","ProudSmart","datatable","footerdom","language","select","order","columns","title","optionCol3","visible","columnDefs","targets","render","type","full","values","series","TYPE_SPEC","str","menuitems","id","rowCallback","nRow","aData","iDataIndex","on","e","preventDefault","tr","this","closest","addClass","row","writeXml","find","removeClass","selectTr","selectObj","$apply","rowData","delMod","flg","remove","draw","bAutoWidth","bProcessing","bPaginate","bSort","bInfo","optionCol2","isIndexEdit","escape","specialtyPropsDic","specialtyProp","name","search","value","addData","deleteAction","stopPropagation","val"],"mappings":"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","file":"js/directives/resource-dom.js","sourcesContent":["define(['directives/directives', 'bootstrap-dialog', 'datatables.net', 'datatables.net-bs', 'datatables.net-select'], function (directives, BootstrapDialog, datatables) {\n  'use strict'; //设备模板列表\n\n  directives.initDirective('resourceListTable', ['$timeout', '$compile', 'growl', function ($timeout, $compile, growl) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        $scope.$on(\"RESOURCE\", function (event, args) {\n          if (table) {\n            table.destroy();\n            domMain.empty();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: args.data && args.data.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            select: $.ProudSmart.datatable.select,\n            data: args.data,\n            order: [[5, \"desc\"]],\n            columns: [{\n              data: \"label\",\n              title: \"模板名称\"\n            }, {\n              data: \"desc\",\n              title: \"模板描述\"\n            }, {\n              data: \"values.series\",\n              title: \"产品系列\"\n            }, {\n              data: \"values.TYPE_SPEC\",\n              title: \"设备型号\"\n            }, $.ProudSmart.datatable.optionCol3, {\n              data: \"createTime\",\n              title: \"\",\n              visible: false\n            }],\n            \"columnDefs\": [{\n              \"targets\": 1,\n              \"data\": \"desc\",\n              \"render\": function render(data, type, full) {\n                return data;\n              }\n            }, {\n              \"targets\": 2,\n              \"data\": \"values.series\",\n              \"render\": function render(data, type, full) {\n                var str = full.values.series ? full.values.series : \"\";\n                return str;\n              }\n            }, {\n              \"targets\": 3,\n              \"data\": \"values.TYPE_SPEC\",\n              \"render\": function render(data, type, full) {\n                var str = full.values.TYPE_SPEC ? full.values.TYPE_SPEC : \"\";\n                return str;\n              }\n            }, {\n              \"targets\": 4,\n              \"data\": \"option\",\n              \"render\": function render(data, type, full) {\n                // 返回自定义内容\n                var str = \"<div class='btn-group btn-group-sm'>\";\n\n                if ($scope.menuitems['A04_S01']) {\n                  str += \"<button id='edit-btn'  ng-click='addMod(\" + full.id + \");'  class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 管理</span></button>\";\n                }\n\n                if ($scope.menuitems['A05_S01']) {\n                  str += \"<button id='del-btn'   class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\";\n                }\n\n                if ($scope.menuitems['A06_S01']) {\n                  str += \"<button type='button' class='btn btn-default dropdown-toggle' data-toggle='dropdown'> 更多<span class='caret'></span></button>\";\n                  str += \"<ul class='dropdown-menu' role='menu'>\";\n\n                  if ($scope.menuitems['A06_S01']) {\n                    str += \"<li><a role='button' ng-click='modelViewEdit(\" + full.id + \");' id='disable-btn'>设计仪表板</a></li>\";\n                  }\n\n                  if ($scope.menuitems['A12_S01']) {\n                    str += \"<li><a id='xml-btn' role='button' >导出SDK模板</a></li>\";\n                  }\n\n                  str += \"</ul>\";\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }],\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            }\n          });\n        });\n        domMain.on('click', '#xml-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          tr.addClass('selected');\n          var row = table.row(tr);\n          $scope.writeXml(row.data());\n        });\n        domMain.on('click', 'td', function (e) {\n          e.preventDefault();\n          $(domMain).find(\"tbody tr\").removeClass(\"selected\");\n          var tr = $(this).closest('tr');\n          tr.addClass('selected');\n          var row = table.row(tr);\n          $scope.selectTr = row.data().id;\n          $scope.selectObj = row.data();\n          $scope.$apply();\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          $scope.delMod(rowData, function (flg) {\n            if (flg) row.remove().draw(false);\n          });\n        });\n      }]\n    };\n  }]);\n  directives.initDirective('kpiListTable', ['$timeout', '$compile', 'growl', function ($timeout, $compile, growl) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var itemAttrs;\n        var groupInf;\n        $scope.$on(\"KPI\", function (event, args) {\n          if (table) {\n            table.destroy();\n            domMain.empty();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: args && args.length > 0 ? $.ProudSmart.datatable.footerdom : '',\n            language: $.ProudSmart.datatable.language,\n            bAutoWidth: true,\n            data: args,\n            bProcessing: true,\n            bPaginate: false,\n            \"bSort\": false,\n            \"bInfo\": false,\n            //              \"scrollY\": 300,\n            //              \"scrollCollapse\": true,\n            columns: [{\n              data: \"serial\",\n              title: \"序号\"\n            }, {\n              data: \"name\",\n              title: \"数据项\"\n            }, {\n              data: \"id\",\n              title: \"数据编码\"\n            }, {\n              data: \"label\",\n              title: \"名称\"\n            }, {\n              data: \"unit\",\n              title: \"单位\"\n            }, {\n              data: \"number\",\n              title: \"是否数值\"\n            },\n            /*{\n            data: \"type\",\n            title: \"数据分类\"\n            }, */\n            {\n              data: \"values\",\n              title: \"检测专业\"\n            }, {\n              data: \"range\",\n              title: \"取值范围\"\n            }, {\n              data: \"icon\",\n              title: \"图标\"\n            }, $.ProudSmart.datatable.optionCol2],\n            columnDefs: [{\n              targets: 0,\n              data: \"serial\",\n              render: function render(data, type, full) {\n                if ($scope.isIndexEdit && type == \"display\") return \"<input style='width:40px' class='form-control input-sm index-edit-input' type='number' value='\" + data + \"'>\";else return data;\n              }\n            }, {\n              targets: 1,\n              data: \"name\",\n              render: function render(data, type, full) {\n                return escape(data);\n              }\n            }, {\n              targets: 2,\n              data: \"id\",\n              render: function render(data, type, full) {\n                return escape(data);\n              }\n            }, {\n              targets: 3,\n              data: \"label\",\n              render: function render(data, type, full) {\n                return escape(data);\n              }\n            }, {\n              targets: 4,\n              data: \"unit\",\n              render: function render(data, type, full) {\n                return data;\n              }\n            }, {\n              targets: 5,\n              data: \"number\",\n              render: function render(data, type, full) {\n                var str = '';\n\n                if (data) {\n                  str = '是';\n                } else {\n                  str = '否';\n                }\n\n                return str;\n              }\n            },\n            /*{\n            targets: 4,\n            data: \"type\",\n            render: function(data, type, full) {\n             var str = '';\n             if(data == 'kpi'){\n               str = '测点';\n             }else if(data == 'fault'){\n               str = '故障';\n             }\n             return str;\n            }\n            }, */\n            {\n              //宝钢使用\n              targets: 6,\n              data: \"values\",\n              render: function render(data, type, full) {\n                var str = \"\";\n\n                if (data) {\n                  str = $scope.specialtyPropsDic[data.specialtyProp];\n                }\n\n                return str;\n              }\n            }, {\n              targets: 7,\n              data: \"range\",\n              render: function render(data, type, full) {\n                return data;\n              }\n            }, {\n              targets: 8,\n              data: \"icon\",\n              render: function render(data, type, full) {\n                var str = '';\n\n                if (data) {\n                  str = '<div  class=\"btn btn-social-icon btn-bitbucket btn-sm\"><i  class=\"' + data + '\"></i>';\n                }\n\n                return str;\n              }\n            }, {\n              targets: 9,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\n                var str = \"<div class='btn-group btn-group-sm'>\";\n\n                if ($scope.menuitems['D04_A08']) {\n                  str += \"<button id='edit-btn' class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></button>\";\n                }\n\n                if ($scope.menuitems['D03_A08']) {\n                  str += \"<button id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\";\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }],\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            }\n          });\n        });\n        $scope.$on(\"table-search-handle\", function (event, args) {\n          if (args.name == $attrs.name) table.search(args.value).draw();\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n          isEditing = true;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.addData('upd', row.data());\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n          $scope.deleteAction(\"kpi\", rowData, function (flg) {\n            if (flg) {\n              row.remove().draw(false);\n            }\n          });\n        });\n        domMain.on('change', '.index-edit-input', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data()[\"index\"] = $(this).val();\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}