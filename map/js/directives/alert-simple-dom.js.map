{"version":3,"sources":["js/directives/alert-simple-dom.js"],"names":["define","directives","initDirective","$timeout","$compile","restrict","controller","$scope","$element","$attrs","table","modelData","domMain","severity","name","value","condition","$on","Event","ALERTEDITINIT","event","args","destroy","data","DataTable","dom","language","$","ProudSmart","datatable","alerts","order","rowCallback","nRow","aData","iDataIndex","columns","title","width","orderable","visible","columnDefs","targets","render","type","full","instance","isEdit","escape","threshold","str","length","nodeIds","nodeIdsforSelect","split","forEach","nodeId","push","toString","i","kpis","kpiCode","refValue","id","selectedDitem","resources","Date","getTime","nodeName","label","enabled","canEdit","isNew","on","parentDom","parent","html","e","stopPropagation","tr","this","closest","row","oldrows","rows","doAction","pageInfo","page","info","newPage","Math","floor","draw","attr","tds","parents","children","checkPass","each","val","jqob","txt","addClass","removeClass","j","css","thresholds","obj","item","ary","find","returnObj","cells","invalidate","preventDefault","flg","remove","isDel","target","test","siblings","td"],"mappings":"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","file":"js/directives/alert-simple-dom.js","sourcesContent":["define(['directives/directives'], function (directives) {\n  'use strict';\n\n  directives.initDirective('aeditTable', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var isFromEdit = false;\n        var hasThresholdOpen = false;\n        var modelData;\n        var severity = [{\n          'name': '警告告警',\n          'value': '1'\n        }, {\n          'name': '次要告警',\n          'value': '2'\n        }, {\n          'name': '重要告警',\n          'value': '3'\n        }, {\n          'name': '严重告警',\n          'value': '4'\n        }];\n        var condition = [{\n          'name': '大于',\n          'value': 'compare(value,refValue)>0'\n        }, {\n          'name': '大于等于',\n          'value': 'compare(value,refValue)>=0'\n        }, {\n          'name': '小于',\n          'value': 'compare(value,refValue)<0'\n        }, {\n          'name': '小于等于',\n          'value': 'compare(value,refValue)<=0'\n        }, {\n          'name': '表达式',\n          'value': ''\n        }];\n        $scope.$on(Event.ALERTEDITINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          hasThresholdOpen = false;\n          modelData = args.data;\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: $.ProudSmart.datatable.language,\n            data: modelData.alerts,\n            order: [[4, \"desc\"]],\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            },\n            columns: [{\n              data: \"label\",\n              title: \"告警名称\",\n              width: \"200px\"\n            }, {\n              data: \"thresholds\",\n              title: \"告警规则\"\n            }, {\n              data: \"enabled\",\n              title: \"启用\",\n              width: \"30px\"\n            }, {\n              data: \"option\",\n              orderable: false,\n              title: \"操作\",\n              width: \"100px\"\n            }, {\n              data: \"id\",\n              title: \"\",\n              visible: false\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"label\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\n                if (!full.instance) {\n                  if (full.isEdit == 2 && type == \"display\") return \"<input style='width:100%' maxlength='100' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n                }\n\n                return \"\";\n              }\n            }, {\n              targets: 1,\n              data: \"thresholds\",\n              orderable: false,\n              render: function render(data, type, full) {\n                // 返回自定义内容\n                var str = \"\";\n                var threshold;\n\n                if (typeof data != \"undefined\" && data != null && data.length != 0) {\n                  threshold = data[0];\n                }\n\n                if (full.isEdit == 2 && type == \"display\") {\n                  if (threshold) {\n                    if (threshold.nodeIds && threshold.nodeIdsforSelect == null) {\n                      threshold.nodeIdsforSelect = [];\n                      var nodeIdAry = threshold.nodeIds.split(\",\");\n                      nodeIdAry.forEach(function (nodeId) {\n                        threshold.nodeIdsforSelect.push('number:' + nodeId);\n                      });\n                      threshold.nodeIdsforSelect = threshold.nodeIdsforSelect.toString();\n                    } // 指标类型\n\n\n                    str = '<select name=\"kpiCode-name\" class=\"combobox form-control input-sm\">' + '<option value=\"NaN\" selected disabled>指标类型...</option>';\n\n                    for (var i in modelData.kpis) {\n                      if (threshold.kpiCode == modelData.kpis[i][\"id\"]) {\n                        str += '<option value=\"' + modelData.kpis[i][\"id\"] + '\" selected>' + modelData.kpis[i][\"label\"] + '</option>';\n                      } else {\n                        str += '<option value=\"' + modelData.kpis[i][\"id\"] + '\">' + modelData.kpis[i][\"label\"] + '</option>';\n                      }\n                    }\n\n                    str += '</select>&nbsp;'; //计算条件\n\n                    str += '<select name=\"condition-name\" class=\"combobox form-control input-sm\">' + '<option value=\"NaN\" selected disabled>计算条件...</option>';\n\n                    for (var i in condition) {\n                      if (threshold.condition == condition[i][\"value\"]) {\n                        str += '<option value=\"' + condition[i][\"value\"] + '\" selected>' + condition[i][\"name\"] + '</option>';\n                      } else {\n                        str += '<option value=\"' + condition[i][\"value\"] + '\">' + condition[i][\"name\"] + '</option>';\n                      }\n                    }\n\n                    str += '</select>&nbsp;'; //参考值\n\n                    str += \"<input name='refValue-name' class='form-control input-sm' type='text' value='\" + escape(threshold.refValue) + \"'>&nbsp;\";\n                    str += \"<input class='form-control input-sm' type='text' style='display:none' value='\" + threshold.id + \"'/>\"; //告警级别\n\n                    str += '<select name=\"severity-name\" class=\"combobox form-control input-sm\">' + '<option value=\"NaN\" selected disabled>告警级别...</option>';\n\n                    for (var i in severity) {\n                      if (threshold.severity == severity[i][\"value\"]) {\n                        str += '<option value=\"' + severity[i][\"value\"] + '\" selected>' + severity[i][\"name\"] + '</option>';\n                      } else {\n                        str += '<option value=\"' + severity[i][\"value\"] + '\">' + severity[i][\"name\"] + '</option>';\n                      }\n                    }\n\n                    str += '</select>&nbsp;';\n                    if ($scope.selectedDitem && $scope.selectedDitem.resources && $scope.selectedDitem.resources.length > 0) str += \"<select buttonclass='btn btn-default btn-sm' multiple='multiple' numberdisplayed='0' bootstrap-multiselect nonselectedtext='所有设备...' optionclass='disabled' ng-model='threshold.nodeIds\" + new Date().getTime() + \"' selectvalues='\" + threshold.nodeIdsforSelect + \"' ng-options='item.id as item.label for item in selectedDitem.resources'></select>\";else str += \"<select disabled='true' class='combobox form-control input-sm'><option value=''>无设备...</option></select>\";\n                  } else {\n                    // 指标类型\n                    str = '<select name=\"kpiCode-name\" class=\"combobox form-control input-sm\">' + '<option value=\"NaN\" selected disabled>指标类型...</option>';\n\n                    for (var i in modelData.kpis) {\n                      str += '<option value=\"' + modelData.kpis[i][\"id\"] + '\">' + modelData.kpis[i][\"label\"] + '</option>';\n                    }\n\n                    str += '</select>&nbsp;'; //计算条件\n\n                    str += '<select name=\"condition-name\" class=\"combobox form-control input-sm\">' + '<option value=\"NaN\" selected disabled>计算条件...</option>';\n\n                    for (var i in condition) {\n                      str += '<option value=\"' + condition[i][\"value\"] + '\">' + condition[i][\"name\"] + '</option>';\n                    }\n\n                    str += '</select>&nbsp;'; //参考值\n\n                    str += \"<input name='refValue-name' class='form-control input-sm' type='text' value='' placeholder='参考值'>&nbsp;\";\n                    str += \"<input class='form-control input-sm' type='text' style='display:none' value=''/>\"; //告警级别\n\n                    str += '<select name=\"severity-name\" class=\"combobox form-control input-sm\">' + '<option value=\"NaN\" selected disabled>告警级别...</option>';\n\n                    for (var i in severity) {\n                      str += '<option value=\"' + severity[i][\"value\"] + '\">' + severity[i][\"name\"] + '</option>';\n                    }\n\n                    str += '</select>&nbsp;';\n                    if ($scope.selectedDitem && $scope.selectedDitem.resources && $scope.selectedDitem.resources.length > 0) str += \"<select ng-disabled='!selectedDitem.resources || selectedDitem.resources.length == 0' buttonclass='btn btn-default btn-sm' multiple='multiple' numberdisplayed='0' bootstrap-multiselect nonselectedtext='所有设备...' optionclass='disabled' ng-model='threshold.nodeIds' selectvalues='' ng-options='item.id as item.label for item in selectedDitem.resources'></select>\";else str += \"<select disabled='true' class='combobox form-control input-sm'><option value=''>无设备...</option></select>\";\n                  }\n\n                  return str;\n                } else if (threshold) {\n                  if (threshold.nodeIds) {\n                    var nodeName = [];\n                    var nodeIdAry = threshold.nodeIds.split(\",\");\n                    nodeIdAry.forEach(function (nodeId) {\n                      for (var i in modelData.resources) {\n                        if (nodeId == modelData.resources[i].id) {\n                          nodeName.push(modelData.resources[i].label);\n                          break;\n                        }\n                      }\n                    });\n                    nodeName = nodeName.toString();\n\n                    if (nodeName) {\n                      str = nodeName + \"的\";\n                    }\n                  }\n\n                  for (var i in modelData.kpis) {\n                    if (threshold.kpiCode == modelData.kpis[i][\"id\"]) {\n                      str += modelData.kpis[i][\"label\"];\n                      break;\n                    }\n                  }\n\n                  for (var i in condition) {\n                    if (threshold.condition == condition[i][\"value\"]) {\n                      if (condition[i][\"name\"] == \"表达式\") {\n                        str += \"满足条件：\";\n                      } else {\n                        str += condition[i][\"name\"];\n                      }\n\n                      break;\n                    }\n                  }\n\n                  str += threshold.refValue + \"时，进行\";\n\n                  for (var i in severity) {\n                    if (threshold.severity == severity[i][\"value\"]) {\n                      str += severity[i][\"name\"];\n                      break;\n                    }\n                  }\n\n                  if (typeof threshold.enabled != \"undefined\") {\n                    full[\"enabled\"] = threshold.enabled;\n                  }\n\n                  str += \"。<span class='text-right'><a id='instance-btn' href=''>点击添加阈值</a><span>\";\n                  return str;\n                } else {\n                  //full[\"enabled\"] = false;\n                  return [];\n                }\n              }\n            }, {\n              targets: 2,\n              data: \"enabled\",\n              orderable: false,\n              render: function render(data, type, full) {\n                var str = \"<div class='text-center'>\"; //                if (full.isEdit == 2 && full.isNew) data = true;\n\n                if (!data) {\n                  str += \"<a id='unable-btn' class='btn btn-social-icon btn-sm'><i class='fa fa-square-o'></i></a>\"; //                  str += \"<input type='checkbox' style='display:none'/>\";\n                } else {\n                  str += \"<a id='enable-btn' class='btn btn-social-icon btn-sm'><i class='fa fa-check-square-o'></i></a>\"; //                  str += \"<input type='checkbox' checked='checked' style='display:none'/>\";\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }, {\n              targets: 3,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                var str = \"<div class='btn-group btn-group-sm'>\";\n\n                if (full.canEdit) {\n                  if (full.isEdit == 2) {\n                    str += \"<a id='save-btn' class='btn btn-default' ><i class='fa fa-save  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>\";\n                    if (full.isNew) str += \"<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\";else str += \"<a id='cancel-btn' class='btn btn-default' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>\";\n                  } else {\n                    str += \"<a id='edit-btn' class='btn btn-default' ><i class='fa fa-edit  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></a>\";\n                    str += \"<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\";\n                  } //                } else {\n                  //                  str += \"<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\"\n\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"addModelSubItem()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加告警</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', '#instance-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var oldrows = table.rows()[0].length;\n          $scope.doAction('alert-instance', row.data());\n\n          if (table) {\n            var pageInfo = table.page.info();\n            var rows = table.rows();\n            var newPage = 0;\n\n            for (var i = 0;; i++) {\n              if (rows[0][i] == oldrows) {\n                newPage = Math.floor(i / pageInfo.length);\n                break;\n              }\n            }\n\n            if (newPage > 0) {\n              table.page(newPage).draw('page');\n            }\n          }\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          if ($('#save-btn').attr('disabled')) return;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (row.data().isEdit == 2) {\n            var tds = $(this).parents(\"tr\").children();\n            var checkPass = true;\n            $.each(tds, function (i, val) {\n              var jqob = $(val);\n\n              if (i == 0 && !row.data().instance) {\n                var txt = jqob.children(\"input\").val();\n\n                if (!txt || txt == \"\") {\n                  $(val).addClass('danger');\n                  checkPass = false;\n                  row.data().isEdit = 2; //row.cells().invalidate();\n\n                  return false;\n                } else {\n                  $(val).removeClass('danger');\n                }\n              }\n\n              if (i == 1) {\n                for (var j = 0; j < jqob.children(\"input, select\").length; j++) {\n                  if (j != 3 && j != 5) {\n                    var txt = $(jqob.children(\"input,select\")[j]).val();\n\n                    if (j != 1 && (!txt || txt == \"NaN\") || j == 1 && txt == \"NaN\") {\n                      $(jqob.children(\"input,select\")[j]).css(\"background-color\", \"#f2dede\");\n                      checkPass = false;\n                      row.data().isEdit = 2;\n                      return false;\n                    } else {\n                      $(jqob.children(\"input,select\")[j]).css(\"background-color\", \"#fffff\");\n                    }\n                  }\n                }\n              }\n            });\n\n            if (checkPass) {\n              var thresholds = [];\n              var obj = {};\n              $.each(tds, function (i, val) {\n                var jqob = $(val);\n\n                if (i == 0) {\n                  var txt = jqob.children(\"input\").val();\n                  row.data().name = txt;\n                  row.data().label = txt;\n                }\n\n                if (i == 1) {\n                  obj[\"kpiCode\"] = $(jqob.children(\"input, select\")[0]).val();\n                  obj[\"condition\"] = $(jqob.children(\"input, select\")[1]).val();\n                  obj[\"refValue\"] = $(jqob.children(\"input, select\")[2]).val();\n                  obj[\"id\"] = $(jqob.children(\"input, select\")[3]).val();\n                  obj[\"severity\"] = $(jqob.children(\"input, select\")[4]).val();\n                  obj[\"nodeIds\"] = [];\n                  var nodeIds = $(jqob.children(\"input, select\")[5]).val();\n\n                  if (nodeIds && nodeIds.length > 0) {\n                    nodeIds.forEach(function (item) {\n                      var ary = item.split(\":\");\n                      obj[\"nodeIds\"].push(ary[ary.length - 1]);\n                    });\n                  }\n\n                  obj[\"nodeIds\"] = obj[\"nodeIds\"].toString();\n                }\n\n                if (i == 2) {\n                  if (jqob.find(\"#enable-btn\").length == 0) {\n                    obj[\"enabled\"] = false;\n                  } else {\n                    obj[\"enabled\"] = true;\n                  }\n                }\n              });\n              thresholds.push(obj);\n              row.data()[\"thresholds\"] = thresholds; //              $('#save-btn').attr(\"disabled\", true);\n              //              if ($scope.hasOwnProperty(\"doSaveAction\")) {\n              //                $('#save-btn').attr(\"disabled\", true);\n              //                $scope.doSaveAction('alert-save', row.data(), function(returnObj) {\n              //                  if (returnObj == false) {\n              //                    row.data().isEdit = 2;\n              //                  } else {\n              //                    row.data().id = returnObj.id;\n              //                    row.data().isEdit = 0;\n              //                    row.data().isNew = false;\n              //                    row.cells().invalidate();\n              //                    isEditing = false;\n              //                  }\n              //                });\n              //              } else {\n\n              $scope.doAction(\"alert-save\", row.data(), function (returnObj) {\n                if (returnObj == false) {\n                  row.data().isEdit = 2;\n                } else {\n                  row.data().id = returnObj.id;\n                  row.data().isEdit = 0;\n                  row.data().isNew = false;\n                  row.cells().invalidate().draw(false);\n                  isEditing = false;\n                }\n              }); //              }\n            }\n          }\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault(); //if (!isEditing) {\n\n          isEditing = true;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data().isEdit = 2;\n          row.cells().invalidate().draw(false); //} else {\n          //\t$scope.doAction(\"thresholdMessage\", \"当前有修改中的指标，请先完成该操作\");\n          //}\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.preventDefault();\n          var tds = $(this).parents(\"tr\").children(); //if (isEditing) {\n          //\tisEditing = false;\n\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data().isEdit = 0;\n          row.cells().invalidate().draw(false);\n          $.each(tds, function (i, val) {\n            $(val).removeClass('danger');\n          });\n\n          if (row.data().thresholds[0].id == 0) {\n            $scope.doAction(\"alert-cancel\", row.data(), function (flg) {\n              if (flg) row.remove().draw(false);\n            });\n          } //}\n\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data().isDel = true; //          if ($scope.hasOwnProperty(\"doDeleteAction\")) {\n          //            $scope.doDeleteAction(\"alert-delete\", row.data(), function(flg) {\n          //              if (flg)\n          //                row.remove().draw(false);\n          //            });\n          //          } else {\n\n          $scope.doAction(\"alert-delete\", row.data(), function (flg) {\n            if (flg) row.remove().draw(false);\n          }); //          }\n        });\n        domMain.on('change', \"[name=condition-name]\", function (e) {\n          e.stopPropagation();\n\n          if ($(e.target).val() != null && $(e.target).val() != \"\") {\n            var reg = /^[-]?([0]\\.[0-9]+|[1-9]+[0-9]*\\.?[0-9]+)?$/;\n\n            if (!reg.test($($(e.target).siblings()[1]).val())) {\n              $($(e.target).siblings()[1]).css(\"background-color\", \"#f2dede\");\n              $($(e.target).siblings()[1]).val(\"\");\n              $($(e.target).siblings()[1]).attr(\"placeholder\", \"请输入正确数字\");\n            }\n          } else {\n            $($(e.target).siblings()[1]).css(\"background-color\", \"white\");\n            $($(e.target).siblings()[1]).attr(\"placeholder\", \"参考值\");\n          }\n        }); //        domMain.on('change', \"[name=refValue-name]\", function(e) {\n        //          e.stopPropagation();\n        //          if ($(e.target).val() != \"\") {\n        //            if (null != $($(e.target).siblings()[1]).val() && \"\" != $($(e.target).siblings()[1]).val()) {\n        //              var reg = /^[-]?([0]\\.[0-9]+|[1-9]+[0-9]*\\.?[0-9]+)?$/;\n        //              if (!reg.test($(e.target).val())) {\n        //                $(e.target).css(\"background-color\", \"#f2dede\");\n        //                $(e.target).val(\"\");\n        //                $(e.target).attr(\"placeholder\", \"请输入正确数字\");\n        //              } else {\n        //                $(e.target).css(\"background-color\", \"white\");\n        //              }\n        //            } else {\n        //              $(e.target).css(\"background-color\", \"white\");\n        //            }\n        //          }\n        //        });\n\n        domMain.on('click', '#unable-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (typeof row.data().thresholds != \"undefined\" && row.data().thresholds != null && row.data().thresholds.length != 0) {\n            var td = $(this).closest('td');\n            var str = \"<div class='text-center'><a id='enable-btn' class='btn btn-social-icon btn-sm' data-toggle='tooltip' ><i class='fa fa-check-square-o'></i></a></div>\"; //            str += \"<input type='checkbox' checked='checked' style='display:none'/>\";\n\n            if (row.data().isEdit == 2) {\n              td.html(str);\n            } else {\n              row.data()[\"enabled\"] = true;\n              row.data().thresholds[0][\"enabled\"] = true;\n\n              (function (td, str) {\n                $scope.doAction(\"alert-enable\", row.data(), function (returnObj) {\n                  if (returnObj) {\n                    td.html(str);\n                  }\n                });\n              })(td, str);\n            }\n          }\n        });\n        domMain.on('click', '#enable-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (typeof row.data().thresholds != \"undefined\" && row.data().thresholds != null && row.data().thresholds.length != 0) {\n            var td = $(this).closest('td');\n            var str = \"<div class='text-center'><a id='unable-btn' class='btn btn-social-icon btn-sm'><i class='fa fa-square-o'></i></a></div>\"; //            str += \"<input type='checkbox' style='display:none'/>\";\n\n            if (row.data().isEdit == 2) {\n              td.html(str);\n            } else {\n              row.data()[\"enabled\"] = false;\n              row.data().thresholds[0][\"enabled\"] = false;\n\n              (function (td, str) {\n                $scope.doAction(\"alert-enable\", row.data(), function (returnObj) {\n                  if (returnObj) {\n                    td.html(str);\n                  }\n                });\n              })(td, str);\n            }\n          }\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}