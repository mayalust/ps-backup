{"version":3,"sources":["js/directives/kpi-dom.js"],"names":["define","directives","initDirective","$timeout","$compile","restrict","controller","$scope","$element","$attrs","growl","table","domMain","isEditing","$on","Event","KPIEDITINIT","event","args","destroy","DataTable","dom","language","$","ProudSmart","datatable","data","rowCallback","nRow","aData","iDataIndex","order","columns","title","orderable","width","visible","columnDefs","targets","render","type","full","isEdit","id","escape","put","i","myOptions","unitCode","unitName","myDicts","valueCode","label","str","kpiIconList","icon","isNew","on","selectedDitem","parentDom","parent","html","e","stopPropagation","length","tr","this","closest","addClass","row","css","child","d","dateItem","initListDate","allDataItems","dateType","allDataTypes","optStr","optStr2","dId","dataItemId","dtId","dataTypeId","undefined","instance","instanceData","j","name","format","show","warning","selectRow","sel","val","doAction","returnObj","uid","tds","parents","children","checkPass","each","jqob","txt","jQuery","trim","removeClass","cell","invalidate","cells","preventDefault","draw","isDel","rowData","flg","remove"],"mappings":"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","file":"js/directives/kpi-dom.js","sourcesContent":["define(['directives/directives'], function (directives) {\n  'use strict';\n\n  directives.initDirective('kpieditTable', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', 'growl', function ($scope, $element, $attrs, growl) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        var itemAttrs;\n        $scope.$on(Event.KPIEDITINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: $.ProudSmart.datatable.language,\n            data: args.data,\n            rowCallback: function rowCallback(nRow, aData, iDataIndex) {\n              $compile(nRow)($scope);\n            },\n            order: [[9, \"asc\"]],\n            columns: [{\n              data: \"name\",\n              title: \"名称\"\n            }, {\n              data: \"label\",\n              title: \"显示名称\"\n            }, {\n              data: \"unit\",\n              title: \"单位\"\n            }, {\n              data: \"range\",\n              title: \"取值范围\"\n            }, {\n              data: \"number\",\n              title: \"是否数值\"\n            }, {\n              data: \"granularity\",\n              title: \"采集频率\"\n            }, {\n              data: \"granularityUnit\",\n              title: \"采集频率单位\"\n            }, {\n              data: \"icon\",\n              title: \"图标\"\n            }, {\n              data: \"option\",\n              orderable: false,\n              title: \"操作\",\n              width: \"100px\"\n            }, {\n              data: \"uid\",\n              visible: false\n            }],\n            columnDefs: [{\n              targets: 0,\n              data: \"name\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && full.id == 0 && type == \"display\") return \"<input maxlength='20' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 1,\n              data: \"label\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && type == \"display\") return \"<input maxlength='20' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 2,\n              data: \"unit\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && type == \"display\") {\n                  var put = \"<select class='combobox form-control input-sm'>\";\n                  put += '<option value=\"\">请选择...</option>';\n\n                  for (var i in $scope.myOptions) {\n                    if ($scope.myOptions[i].unitCode == data) {\n                      put += '<option selected=\"true\" value=\"' + $scope.myOptions[i].unitCode + '\">' + $scope.myOptions[i].unitName + '</option>';\n                    } else {\n                      put += '<option value=\"' + $scope.myOptions[i].unitCode + '\">' + $scope.myOptions[i].unitName + '</option>';\n                    }\n                  }\n\n                  put += '</select>';\n                  return put;\n                }\n\n                for (var i in $scope.myOptions) {\n                  if ($scope.myOptions[i].unitCode == data) {\n                    return $scope.myOptions[i].unitName;\n                  }\n                }\n\n                return data;\n              }\n            }, {\n              targets: 3,\n              data: \"range\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && type == \"display\") return \"<input maxlength='100' style='width:100%' class='form-control input-sm' type='text' value='\" + escape(data) + \"'>\";else return escape(data);\n              }\n            }, {\n              targets: 4,\n              data: \"number\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                var put;\n\n                if (full.isEdit == 2 && type == \"display\") {\n                  put = \"<select class='combobox form-control input-sm'>\";\n\n                  if (data == true || data == 'true') {\n                    put += \"<option value='true' selected>是</option>\";\n                    put += \"<option value='false'>否</option>\";\n                  } else {\n                    put += \"<option value='true'>是</option>\";\n                    put += \"<option value='false' selected>否</option>\";\n                  }\n\n                  put += \"</select>\";\n                  return put;\n                }\n\n                if (data == true || data == 'true') {\n                  put = '是';\n                } else {\n                  put = '否';\n                }\n\n                return put;\n              }\n            }, {\n              targets: 5,\n              data: \"granularity\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && type == \"display\") return \"<input style='width:100%' class='form-control input-sm' type='number' value='\" + data + \"'>\";else return data;\n              }\n            }, {\n              targets: 6,\n              data: \"granularityUnit\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                if (full.isEdit == 2 && type == \"display\") {\n                  var put = \"<select class='combobox form-control input-sm'>\";\n                  put += '<option value=\"\">请选择...</option>';\n\n                  for (var i in $scope.myDicts[\"KqiGranularityUnit\"]) {\n                    if ($scope.myDicts[\"KqiGranularityUnit\"][i].valueCode == data) {\n                      put += '<option selected=\"true\" value=\"' + $scope.myDicts[\"KqiGranularityUnit\"][i].valueCode + '\">' + $scope.myDicts[\"KqiGranularityUnit\"][i].label + '</option>';\n                    } else {\n                      put += '<option value=\"' + $scope.myDicts[\"KqiGranularityUnit\"][i].valueCode + '\">' + $scope.myDicts[\"KqiGranularityUnit\"][i].label + '</option>';\n                    }\n                  }\n\n                  put += '</select>';\n                  return put;\n                }\n\n                var str = \"\";\n\n                for (var i in $scope.myDicts[\"KqiGranularityUnit\"]) {\n                  if ($scope.myDicts[\"KqiGranularityUnit\"][i].valueCode == data) {\n                    str = $scope.myDicts[\"KqiGranularityUnit\"][i].label;\n                    break;\n                  }\n                }\n\n                return str;\n              }\n            }, {\n              targets: 7,\n              data: \"icon\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\n                var put = \"\";\n\n                if (full.isEdit == 2 && type == \"display\") {\n                  put = \"<select class='combobox form-control input-sm'>\";\n                  put += '<option value=\"\">请选择...</option>';\n\n                  for (var i in $scope.kpiIconList) {\n                    if ($scope.kpiIconList[i].icon == data) {\n                      put += '<option selected=\"true\" value=\"' + $scope.kpiIconList[i].icon + '\">' + $scope.kpiIconList[i].title + '</option>';\n                    } else {\n                      put += '<option value=\"' + $scope.kpiIconList[i].icon + '\">' + $scope.kpiIconList[i].title + '</option>';\n                    }\n                  }\n\n                  put += '</select>';\n                } else {\n                  if (data) put = '<div class=\"btn btn-social-icon btn-bitbucket btn-sm\" ><i class=\"' + data + '\"></i></div>';\n                }\n\n                return put;\n              }\n            }, {\n              targets: 8,\n              data: \"option\",\n              render: function render(data, type, full) {\n                // 返回自定义内容\t\t\n                var str = \"<div class='btn-group btn-group-sm'>\";\n\n                if (full.isEdit == 2) {\n                  str += \"<a id='save-btn' class='btn btn-default' ><i class='fa fa-save hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 保存</span></a>\";\n                  if (full.isNew) str += \"<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\";else str += \"<a id='cancel-btn' class='btn btn-default' ><i class='fa fa-times hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>\";\n                } else {\n                  //str += \"<a id='edit-btn' class='btn btn-default' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 修改</span></a>\"\n                  //str += \"<a id='del-btn' class='btn btn-default' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></a>\"\n                  str += \"<div class='btn-group table-option-group'>\" + \"<button type='button' class='btn btn-default btn-sm'>操作</button>\" + \"<button type='button' class='btn btn-default btn-sm dropdown-toggle' data-toggle='dropdown'>\" + \"<span class='caret'></span>\" + \"<span class='sr-only'>Toggle Dropdown</span>\" + \"</button>\" + \"<ul class='dropdown-menu' role='menu'>\" + \"<li><a href='javascript:void(0);' id='edit-btn' >修改</a></li>\" + \"<li><a href='javascript:void(0);' id='del-btn' >删除</a></li>\" + \"<li><a href='javascript:void(0);' id='data-btn' >接入数据定义</a></li>\" + \"</ul>\" + \"</div>\";\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        });\n\n        function format(d) {\n          var dateItem = $scope.initListDate.allDataItems;\n          var dateType = $scope.initListDate.allDataTypes;\n          var optStr = \"\";\n          var optStr2 = \"\";\n          var dId = d.dataItemId;\n          var dtId = d.dataTypeId;\n\n          if (d.instance == undefined) {\n            var instanceData = 0;\n          } else {\n            var instanceData = d.instance;\n          }\n\n          for (var i in dateItem) {\n            if (dateItem[i].id == dId) {\n              optStr += \"<option value='\" + dateItem[i].id + \"' selected>\" + dateItem[i].label + \"</option>\";\n            } else {\n              optStr += \"<option value='\" + dateItem[i].id + \"'>\" + dateItem[i].label + \"</option>\";\n            }\n          }\n\n          for (var j in dateType) {\n            if (dateType[j].id == dtId) {\n              optStr2 += \"<option value='\" + dateType[j].id + \"' selected>\" + dateType[j].name + \"</option>\";\n            } else {\n              optStr2 += \"<option value='\" + dateType[j].id + \"'>\" + dateType[j].name + \"</option>\";\n            }\n          }\n\n          if (d != undefined) {\n            // `d` is the original data object for the row\n            var returnStr;\n            returnStr = '<table width=\"60%\"  class=\"table table-hover\">' + '<tr>' + '<td >数据编码:</td>' + '<td><select id=\"dataCode\" name=\"dataCode\" class=\"combobox form-control input-sm\"><option>请选择</option>' + optStr + '</select></td>' + '<td >数据类型:</td>' + '<td ><select id=\"dataType\" name=\"dataType\" class=\"combobox form-control input-sm\"><option>请选择</option>' + optStr2 + '</select></td>' + '</tr>' + '<tr>' + '<td>实例编号:</td>' + '<td  ><input id=\"instance\" name=\"instance\" class=\"form-control input-sm\" type=\"text\"   value=\"' + instanceData + '\"/></td>' + '</tr>' + '<tr>' + '<td ><div class=\"input-group\">' + '<a id=\"data-save-btn\" class=\"btn btn-default btn-sm\" style=\"margin-right: 15px;\"><i class=\"fa fa-check\"></i><span class=\"hidden-xs ng-binding\">保存</span></a>' + '<a id=\"data-cancel-btn\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-close\"></i><span class=\"hidden-xs ng-binding\">取消</span></a></div></td>' + '</tr>' + '</table>';\n            return returnStr;\n          }\n        }\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n\n        domMain.on('init.dt', function () {\n          if ($scope.selectedDitem) {\n            var parentDom = $(\".special-btn\").parent(); //parentDom.html('<a ng-click=\"addModelSubItem()\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加指标</span></a>');\n\n            parentDom.html('<select class=\"form-control\" style=\"min-width:200px\" selectdata=\"kpiList\" itemchange=\"kpichangehandler\" select2></select>');\n            $compile(parentDom)($scope);\n          }\n        });\n        domMain.on('click', '#data-btn', function (e) {\n          e.stopPropagation();\n          var selStatus = table.$('tr.shown');\n\n          if (selStatus.length < 1) {\n            var tr = $(this).closest('tr');\n            tr.addClass('shown');\n            var row = table.row(tr);\n            $(\".open>.dropdown-menu\").css(\"display\", \"none\");\n            row.child(format(row.data())).show();\n          } else {\n            growl.warning(\"您正在操作，请先保存或者取消再进行此操作\", {});\n          }\n        });\n        domMain.on('click', '#data-save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var selectRow = table.row('.shown');\n          var sel = selectRow.data();\n\n          if ($(\"#instance\").val().length > 4) {\n            growl.warning(\"您输入的实例编号过长，最多只能输入4位\", {});\n            return;\n          }\n\n          if ($(\"#dataCode\").val() == \"请选择\") {\n            growl.warning(\"数据编码是必填项，请选择\", {});\n            return;\n          }\n\n          if ($(\"#dataType\").val() == \"请选择\") {\n            growl.warning(\"数据类型是必填项，请选择\", {});\n            return;\n          }\n\n          selectRow.data()[\"dataItemId\"] = $(\"#dataCode\").val();\n          selectRow.data()[\"dataTypeId\"] = $(\"#dataType\").val();\n          selectRow.data()[\"instance\"] = $(\"#instance\").val();\n          $scope.doAction(\"kpi-data-save\", sel, function (returnObj) {\n            if (returnObj == false) {\n              row.data().isEdit = 2;\n            } else {\n              selectRow.data().id = returnObj.id;\n              selectRow.data().uid = returnObj.uid;\n              selectRow.data().isEdit = 0;\n              selectRow.data().isNew = false;\n              isEditing = false;\n              $scope.doAction('data-cancel');\n            }\n          });\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n\n          if (row.data().isEdit == 2) {\n            var tds = $(this).parents(\"tr\").children();\n            var checkPass = true;\n            $.each(tds, function (i, val) {\n              var jqob = $(val);\n\n              if (i == 0 || i == 1) {\n                if (jqob.children(\"input\").length > 0) {\n                  var txt = jqob.children(\"input\").val();\n\n                  if (!jQuery.trim(txt)) {\n                    $(val).addClass('danger');\n                    checkPass = false;\n                    row.data().isEdit = 2; // row.cells().invalidate();//会更新已经输入的值\n\n                    growl.warning(\"该字段不能为空!\", {});\n                    return false;\n                  } else {\n                    $(val).removeClass('danger');\n                  }\n                }\n              }\n\n              if (i == 2) {\n                var txt = $(val).children(\"select\").val();\n\n                if (!txt) {\n                  $(val).addClass('danger');\n                  row.data().isEdit = 2; // row.cells().invalidate();//会更新已经输入的值\n\n                  checkPass = false;\n                  growl.warning(\"请选择一个单位!\", {});\n                  return false;\n                } else {\n                  $(val).removeClass('danger');\n                }\n\n                jqob.html(txt);\n                table.cell(jqob).data(txt); //修改DataTables对象的数据\n\n                return true;\n              }\n\n              if (i == 4 || i == 6 || i == 7) {\n                var txt = $(val).children(\"select\").val();\n                jqob.html(txt);\n                table.cell(jqob).data(txt); //修改DataTables对象的数据\n\n                return true;\n              }\n\n              if (i == 8) {\n                row.cell(jqob).invalidate();\n                return true;\n              }\n\n              var txt = jqob.children(\"input\").val();\n              jqob.html(txt);\n              table.cell(jqob).data(txt); //修改DataTables对象的数据\n            });\n\n            if (checkPass) {\n              tr.removeClass('shown');\n              $scope.doAction(\"kpi-save\", row.data(), function (returnObj) {\n                if (returnObj == false) {\n                  row.data().isEdit = 2;\n                } else {\n                  row.data().id = returnObj.id;\n                  row.data().uid = returnObj.uid;\n                  row.data().isEdit = 0;\n                  row.data().isNew = false;\n                  row.cells().invalidate();\n                  isEditing = false;\n                }\n              });\n            }\n          }\n        });\n        domMain.on('click', '#edit-btn', function (e) {\n          e.preventDefault();\n          var selStatus = table.$('tr.shown');\n\n          if (selStatus.length < 1) {\n            if (!isEditing) {\n              isEditing = true;\n              var tr = $(this).closest('tr');\n              tr.addClass('shown');\n              var row = table.row(tr);\n              row.data().isEdit = 2;\n              row.cells().invalidate();\n            } else {\n              $scope.doAction(\"thresholdMessage\", \"当前有修改中的指标，请先完成该操作\");\n            }\n          } else {\n            growl.warning(\"您正在操作，请先保存或者取消再进行此操作\", {});\n          }\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.preventDefault();\n\n          if (isEditing) {\n            isEditing = false;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 0;\n            tr.removeClass('shown');\n            row.cells().invalidate();\n          }\n        });\n        domMain.on('click', '#data-cancel-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.invalidate().draw();\n          tr.removeClass('shown');\n          $scope.doAction('data-cancel');\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          row.data().isDel = true;\n          var rowData = row.data();\n          $scope.doAction(\"kpi-delete\", rowData, function (flg) {\n            if (flg) row.remove().draw(false);\n          });\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}