{"version":3,"sources":["js/controllers/report-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","$location","unitService","$routeParams","jacquardMachineStateUIService","kpiDataService","resourceUIService","$timeout","userLoginUIService","Info","userEnterpriseService","growl","nodeList","reportList","searchName","searchShow","showTab","showMainTab","filterSum","objSize","type","value","getRunTimeStat","yieldGridData","datalist","returnObj","code","data","length","totaldata","i","push","$broadcast","Event","REPORTTREEINIT","getCurrentDateStateByCustomerId","customerId","date","how_long_to_finish","parseInt","report2customer","getCurrentDateStateByfigureName","figureName","report2figure","search","seek","callback","closeTable","durationGridData","columns","title","columnDefs","targets","render","row","escape","externalDevId","figure_name","undefined","customer_id","weekRunTime","init","initEvent","$","on","e","aname","target","attr","getCurrentDateState","console","log","user","isAuthenticated","$on","evt","d","ngDialog","reportUIService","userUIService","queryParam","reportName","startTime","endTime","url","uploadFileUrl","goClear","goSearch","getReportInfo","res","queryDitem","statelabel","state","name","emailTemplate","templateId","templateName","receiverType","receiverId","queryEnterpriseUser","dialog","open","template","scope","className"],"mappings":"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","file":"js/controllers/report-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('ReportTreeCtrl', ['$scope', '$location', 'unitService', '$routeParams', 'jacquardMachineStateUIService', 'kpiDataService', 'resourceUIService', '$timeout', 'userLoginUIService', 'Info', 'userEnterpriseService', 'growl', function ($scope, $location, unitService, $routeParams, jacquardMachineStateUIService, kpiDataService, resourceUIService, $timeout, userLoginUIService, Info, userEnterpriseService, growl) {\n    $scope.nodeList = {};\n    var modId = \"285937244977380\";\n    var newData = {};\n    var nodeIds = [];\n    $scope.reportList = [];\n    $scope.searchName = \"\";\n    $scope.searchShow = \"yes\";\n    $scope.showTab = \"\";\n    $scope.showMainTab = \"start\";\n    $scope.filterSum = 0;\n    $scope.objSize = 0;\n    var type = $routeParams.type;\n    var value = $routeParams.value; // var byModelId = function() {\n    //   //企业B获取资源模型定义\n    //   var loadindex = 0;\n    //   resourceUIService.getModels(function(returnObj) {\n    //     if (returnObj.code == 0 && returnObj.data[0].parentModelId) {\n    //       for (var i in returnObj.data) {\n    //         if (returnObj.data[i].parentModelId != 9) {\n    //           //通过模型Id获取多个设备\n    //           resourceUIService.getResourceByModelId(returnObj.data[i].id, function(returnObj1) {\n    //             if (returnObj1.code == 0) {\n    //               $scope.objSize += returnObj1.data.length;\n    //               for (var j in returnObj1.data) {\n    //                 nodeIds.push(returnObj1.data[j].id);\n    //               }\n    //               loadindex++;\n    //               if (loadindex == returnObj.data.length) {\n    //                 kpiValues();\n    //               }\n    //             };\n    //           });\n    //         }\n    //       }\n    //     };\n    //   });\n    // }\n\n    $scope.search = function (seek, showTab, callback) {\n      if (seek != \"\" && seek != null) {\n        $scope.searchName = seek;\n        $scope.showTab = showTab;\n\n        if (showTab == 1000) {\n          getCurrentDateStateByCustomerId(seek); // if ($scope.reportList[j].clientNum == seek) {\n          //   $scope.filterSum = $scope.filterSum + 1;\n          // }\n        } else {\n          getCurrentDateStateByfigureName(seek); // if ($scope.reportList[j].designName == seek) {\n          //   $scope.filterSum = $scope.filterSum + 1;\n          // }\n        } // $scope.$apply();\n\n      } else {\n        $scope.showTab = \"0\"; // $scope.$apply();\n      }\n    }; // var kpiValues = function() {\n    //   var nowDate = new Date();\n    //   var day = nowDate.getDate();\n    //   var dayofweek = nowDate.getDay() == 0 ? 7 : nowDate.getDay();\n    //   var mon = nowDate.getMonth();\n    //   day += getWeekStartDate(nowDate, dayofweek);\n    //   var kpiQueryModel = {\n    //     category: \"time\",\n    //     isRealTimeData: true,\n    //     timePeriod: day * 24 * 60 * 60 * 1000,\n    //     nodeIds: nodeIds,\n    //     kpiCodes: [3234],\n    //     mon: mon,\n    //     day: day,\n    //     dayofweek: dayofweek,\n    //     time: nowDate\n    //   }\n    //   resourceUIService.getResourceByIds(nodeIds, function(returnObj) {\n    //     kpiQueryModel.nodesDic = returnObj;\n    //     if (kpiQueryModel.kpisDic) {\n    //       handlerFun([\"kpi\", kpiQueryModel]);\n    //     }\n    //   });\n    //   resourceUIService.getKpisByKpiIds([3234, 3207, 3209, 3215, 3227, 3228, 3229, 3230], function(returnObj) {\n    //     kpiQueryModel.kpisDic = returnObj;\n    //     if (kpiQueryModel.nodesDic) {\n    //       handlerFun([\"kpi\", kpiQueryModel]);\n    //     }\n    //   });\n    // }\n    // var getPreDaykpiValues = function(kpiQueryModel, modelDic) {\n    //   kpiQueryModel.kpiCodes = [3207, 3209, 3215, 3227, 3228, 3229, 3230];\n    //   kpiQueryModel.timePeriod = 0;\n    //   var sumMon = 0;\n    //   var sumWeek = 0;\n    //   var sumDay = 0;\n    //   var sumHour = 0;\n    //   var sumDesign = 0;\n    //   var sumGrand = 0;\n    //   var sumSurp = 0;\n    //   kpiDataService.getKpiValueList([\"kpi\", kpiQueryModel], function(returnObj) {\n    //     for (var j in modelDic) {\n    //       modelDic[j].designName = \"\";\n    //       modelDic[j].dayYield = 0;\n    //       modelDic[j].designMiss = 0;\n    //       modelDic[j].grandYield = 0;\n    //       modelDic[j].surpHours = 0;\n    //       modelDic[j].clientNum = 0;\n    //       modelDic[j].dayDuration = 0;\n    //       if (returnObj.data.recordList.length > 0) {\n    //         returnObj.data.recordList.forEach(function(record) {\n    //           modelDic[j].dayDuration = record[j + '?3229'] ? record[j + '?3229'] : 0;\n    //           modelDic[j].monthDuration += modelDic[j].dayDuration;\n    //           modelDic[j].weekDuration += modelDic[j].dayDuration;\n    //           sumDay += modelDic[j].dayDuration;\n    //           modelDic[j].designName = record[j + '?3215'] ? record[j + '?3215'] : '';\n    //           modelDic[j].dayYield = record[j + '?3207'] ? record[j + '?3207'] : 0;\n    //           modelDic[j].designMiss = record[j + '?3209'] ? record[j + '?3209'] : 0;\n    //           modelDic[j].grandYield = record[j + '?3227'] ? record[j + '?3227'] : 0;\n    //           modelDic[j].surpHours = record[j + '?3228'] ? record[j + '?3228'] : 0;\n    //           modelDic[j].clientNum = record[j + '?3230'] ? record[j + '?3230'] : 0;\n    //         })\n    //       }\n    //       sumHour += modelDic[j].dayYield;\n    //       sumMon = sumMon + (modelDic[j].monthDuration ? modelDic[j].monthDuration : 0);\n    //       sumWeek = sumWeek + (modelDic[j].weekDuration ? modelDic[j].weekDuration : 0);\n    //       sumDesign += modelDic[j].designMiss;\n    //       sumGrand += modelDic[j].grandYield;\n    //       sumSurp += modelDic[j].surpHours;\n    //       modelDic[j].monthHUT = (modelDic[j].monthDuration / (kpiQueryModel.day * 24) * 100).toFixed(2);\n    //       modelDic[j].monthDuration = modelDic[j].monthDuration.toFixed(2);\n    //       modelDic[j].weekDuration = modelDic[j].weekDuration.toFixed(2);\n    //       $scope.reportList.push(modelDic[j]);\n    //     }\n    //     $scope.daySum = parseFloat(sumHour).toFixed(2);\n    //     $scope.designSum = parseFloat(sumDesign).toFixed(2);\n    //     $scope.grandSum = parseFloat(sumGrand).toFixed(2);\n    //     $scope.surpSum = parseFloat(sumSurp).toFixed(2);\n    //     $scope.startHUTSum = $scope.reportList.length > 0 ? ((sumMon / ($scope.reportList.length * kpiQueryModel.day * 24)) * 100).toFixed(2) : 0;\n    //     $scope.startMonthSum = parseFloat(sumMon).toFixed(2);\n    //     $scope.startWeekSum = parseFloat(sumWeek).toFixed(2);\n    //     $scope.startSum = parseFloat(sumDay).toFixed(2);\n    //     $scope.durationGridData.data = $scope.reportList;\n    //     $scope.yieldGridData.data = $scope.reportList;\n\n\n    if (type && value) {\n      if (type == 1000) {\n        getCurrentDateStateByCustomerId(value);\n      } else {\n        getCurrentDateStateByfigureName(value);\n      }\n    } //     // $scope.$broadcast(Event.REPORTTREEINIT + \"_yield\", $scope.yieldGridData);\n    //   });\n    // }\n    // var handlerFun = function(p) {\n    //   $scope.daySum = 0;\n    //   $scope.designSum = 0;\n    //   $scope.grandSum = 0;\n    //   $scope.surpSum = 0;\n    //   $scope.startSum = 0;\n    //   $scope.startWeekSum = 0;\n    //   $scope.startMonthSum = 0;\n    //   $scope.startHUTSum = 0;\n    //   $scope.unitDics = unitService.unitDics;\n    //   kpiDataService.getKpiValueList(p, function(returnObj) {\n    //     if (returnObj.code == 0) {\n    //       var modelDic = {};\n    //       for (var key in p[1].nodesDic) {\n    //         if (!modelDic[key]) {\n    //           modelDic[key] = { reportName: p[1].nodesDic[key].label, monthDuration: 0, weekDuration: 0 };\n    //         }\n    //       }\n    //       returnObj.data.recordList.forEach(function(record) {\n    //         for (var key in returnObj.nodesDic) {\n    //           var recordTime = newDateJson(record.time);\n    //           if (recordTime.getMonth() == p[1].mon) {\n    //             modelDic[key].monthDuration += record[key + \"?3234\"] ? Number(record[key + \"?3234\"]) : 0;\n    //           }\n    //           if (weekCheck(recordTime, p[1].time)) {\n    //             modelDic[key].weekDuration += record[key + \"?3234\"] ? Number(record[key + \"?3234\"]) : 0;\n    //           }\n    //         }\n    //       });\n    //       getPreDaykpiValues(p[1], modelDic)\n    //     }\n    //   });\n    // }\n    // var getWeekStartDate = function(nowDate, dayofweek) { //获得本周的开端日期\n    //   var plus = 0;\n    //   var weekStartDate = new Date(nowDate.getYear(), nowDate.getMonth(), nowDate.getDate() - dayofweek + 1);\n    //   if (weekStartDate.getMonth() == nowDate.getMonth()) {\n    //     plus = 0\n    //   } else {\n    //     var oldday = weekStartDate.getDate();\n    //     weekStartDate.setDate(1);\n    //     weekStartDate.setMonth(weekStartDate.getMonth() + 1);\n    //     plus = new Date(weekStartDate.getTime() - 1000 * 60 * 60 * 24).getDate() - oldday + 1;\n    //   }\n    //   return plus;\n    // }\n    // var weekCheck = function(old, now) {\n    //   var now_time = now.getTime();\n    //   var old_time = old.getTime();\n    //   var now_day = now.getDay() == 0 ? 7 : now.getDay();\n    //   var old_day = old.getDay() == 0 ? 7 : old.getDay();\n    //   if (now_time >= old_time + 7 * 60 * 60 * 24 * 1000 || old_time >= now_time + 7 * 60 * 60 * 24 * 1000) {\n    //     return false;\n    //   } else if (old.getDate() == now.getDate() || old.getDate() > now.getDate && old_day > new_day || old.getDate() < now.getDate && old_day < new_day) {\n    //     return true;\n    //   }\n    //   return false;\n    // }\n\n\n    $scope.closeTable = function () {\n      $scope.showTab = \"0\";\n    };\n\n    $scope.durationGridData = {\n      columns: [{\n        title: \"机台编号\",\n        data: \" externalDevId\"\n      }, {\n        title: \"当日产量(米)\",\n        data: \"figure_day_output\"\n      }, {\n        title: \"花样名称\",\n        data: \"figure_name\"\n      }, {\n        title: \"生产任务(米)\",\n        data: \"tasks_number\"\n      }, {\n        title: \"累计产量(米)\",\n        data: \"number_produced\"\n      }, {\n        title: \"剩余小时(小时)\",\n        data: \"how_long_to_finish\"\n      }, {\n        title: \"客户编号\",\n        data: \"customer_id\"\n      }],\n      columnDefs: [{\n        targets: 0,\n        render: function render(data, type, row) {\n          return escape(row.externalDevId);\n        }\n      }, {\n        targets: 2,\n        render: function render(data, type, row) {\n          if (row.figure_name == null || row.figure_name == undefined) {\n            row.figure_name = '';\n            return row.figure_name;\n          } else {\n            return '<a id=\"designname\" style=\"cursor:pointer\">' + row.figure_name + '</a>';\n          }\n        }\n      }, {\n        targets: 6,\n        render: function render(data, type, row) {\n          if (row.customer_id == null || row.customer_id == undefined) {\n            row.customer_id = '';\n            return row.customer_id;\n          } else {\n            return '<a id=\"clientnum\" style=\"cursor:pointer\">' + row.customer_id + '</a>';\n          }\n        }\n      }]\n    };\n    $scope.yieldGridData = {\n      columns: [{\n        title: \"机台编号\",\n        data: \" externalDevId\"\n      }, {\n        title: \"当日开机时长\",\n        data: \"dayRunTime\"\n      }, {\n        title: \"本周时长\",\n        data: \" weekRunTime\"\n      }, {\n        title: \"本月开机时长\",\n        data: \"monthRunTime\"\n      }, {\n        title: \"本月开机率(%)\",\n        data: \"monthBootRate\"\n      }],\n      columnDefs: [{\n        targets: 0,\n        render: function render(data, type, row) {\n          return escape(row.externalDevId);\n        }\n      }, {\n        targets: 2,\n        render: function render(data, type, row) {\n          return escape(row.weekRunTime);\n        }\n      }] //================================================   start  提花机  ====================================================================\n\n    };\n\n    function getRunTimeStat() {\n      $scope.yieldGridData.datalist = [];\n      jacquardMachineStateUIService.getRunTimeStat(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data == null || returnObj.data.length == 0) {\n            $scope.yieldGridData.totaldata = [];\n            $scope.yieldGridData.datalist = [];\n          } else {\n            $scope.yieldGridData.totaldata = returnObj.data[returnObj.data.length - 1];\n\n            for (var i = 0; i < returnObj.data.length - 1; i++) {\n              $scope.yieldGridData.datalist.push(returnObj.data[i]);\n            }\n          }\n\n          $timeout(function () {\n            $scope.$broadcast(Event.REPORTTREEINIT + \"_yield2\", $scope.yieldGridData);\n          });\n        }\n      });\n    }\n\n    function getCurrentDateState() {\n      $scope.durationGridData.datalist = [];\n      jacquardMachineStateUIService.getCurrentDateState(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data == null || returnObj.data.length == 0) {\n            $scope.durationGridData.totaldata = [];\n            $scope.durationGridData.datalist = [];\n          } else {\n            $scope.durationGridData.totaldata = returnObj.data[returnObj.data.length - 1];\n\n            for (var i = 0; i < returnObj.data.length - 1; i++) {\n              var date = returnObj.data[i].how_long_to_finish;\n              returnObj.data[i].how_long_to_finish = parseInt(date / 3600) + '小时' + parseInt(parseInt(date % 3600) / 60) + '分钟';\n              $scope.durationGridData.datalist.push(returnObj.data[i]);\n            }\n          }\n\n          $timeout(function () {\n            console.log($scope.durationGridData);\n            $scope.$broadcast(Event.REPORTTREEINIT + \"_duration\", $scope.durationGridData);\n          });\n        }\n      });\n    }\n\n    $scope.report2customer = [];\n    $scope.report2figure = [];\n\n    function getCurrentDateStateByCustomerId(customerId) {\n      jacquardMachineStateUIService.getCurrentDateStateByCustomerId(customerId, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i = 0; i < returnObj.data.length; i++) {\n            var date = returnObj.data[i].how_long_to_finish;\n            returnObj.data[i].how_long_to_finish = parseInt(date / 3600) + '小时' + parseInt(parseInt(date % 3600) / 60) + '分钟';\n            $scope.report2customer.push(returnObj.data[i]);\n          }\n        }\n      });\n    }\n\n    function getCurrentDateStateByfigureName(figureName) {\n      jacquardMachineStateUIService.getCurrentDateStateByfigureName(figureName, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i = 0; i < returnObj.data.length; i++) {\n            var date = returnObj.data[i].how_long_to_finish;\n            returnObj.data[i].how_long_to_finish = parseInt(date / 3600) + '小时' + parseInt(parseInt(date % 3600) / 60) + '分钟';\n            $scope.report2figure.push(returnObj.data[i]);\n          }\n        }\n      });\n    } //================================================   end  提花机  ====================================================================\n\n\n    var init = function init() {\n      getRunTimeStat();\n      initEvent();\n    };\n\n    var initEvent = function initEvent() {\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        $scope.showTab = \"0\";\n        var aname = $(e.target).attr(\"name\");\n        $scope.showMainTab = aname;\n\n        if (aname == 'start') {\n          getRunTimeStat();\n        } else if (aname == 'day') {\n          getCurrentDateState();\n        } // $scope.$broadcast(Event.REPORTTREEINIT + \"_duration\", $scope.durationGridData);\n        // $scope.$apply();\n\n      });\n    }; //判断用户是否存在\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n\n          if (type && value) {\n            $scope.showTab = type;\n            $scope.searchName = value;\n            $scope.searchShow = \"\";\n          }\n        }\n      });\n    } else {\n      init();\n\n      if (type && value) {\n        $scope.showTab = type;\n        $scope.searchName = value;\n        $scope.searchShow = \"\";\n      }\n    }\n  }]);\n  controllers.initController('reportLookCtrl', ['$scope', '$location', 'ngDialog', 'unitService', '$routeParams', 'reportUIService', 'kpiDataService', 'resourceUIService', '$timeout', 'userLoginUIService', 'Info', 'userUIService', 'growl', function ($scope, $location, ngDialog, unitService, $routeParams, reportUIService, kpiDataService, resourceUIService, $timeout, userLoginUIService, Info, userUIService, growl) {\n    $scope.queryParam = {\n      \"reportName\": \"\",\n      \"startTime\": \"\",\n      \"endTime\": \"\"\n    };\n    $scope.url = userUIService.uploadFileUrl;\n\n    $scope.goClear = function () {\n      $scope.queryParam.reportName = \"\";\n      $scope.queryParam.startTime = \"\";\n      $scope.queryParam.endTime = \"\";\n    };\n\n    $scope.goSearch = function () {\n      reportUIService.getReportInfo($scope.queryParam, function (res) {\n        if (res.code == 0) {\n          $scope.$broadcast(\"reportLook\", res.data);\n        }\n      });\n    }; //判断用户是否存在\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          $scope.goSearch();\n        }\n      });\n    } else {\n      $scope.goSearch();\n    }\n  }]);\n  controllers.initController('reportRuleCtrl', ['$scope', '$location', 'ngDialog', 'unitService', '$routeParams', 'jacquardMachineStateUIService', 'kpiDataService', 'resourceUIService', '$timeout', 'userLoginUIService', 'Info', 'userEnterpriseService', 'growl', function ($scope, $location, ngDialog, unitService, $routeParams, jacquardMachineStateUIService, kpiDataService, resourceUIService, $timeout, userLoginUIService, Info, userEnterpriseService, growl) {\n    /**\n     * 查询所有报表规则并且初始化数据\n     *\n     */\n    $scope.queryDitem = {\n      statelabel: \"\",\n      //查询条件显示\n      state: 0,\n      //查询条件\n      name: \"\",\n      emailTemplate: 0,\n      templateId: null,\n      templateName: null,\n      receiverType: null,\n      receiverId: null\n    };\n    /**\n     * 查询报表规则\n     */\n\n    $scope.goSearch = function () {\n      $scope.queryDitem.name = $scope.queryDitem.state == 0 ? $scope.queryDitem.name : null;\n      $scope.queryDitem.emailTemplate = $scope.queryDitem.state == 1 ? $scope.queryDitem.emailTemplate : null;\n      $scope.queryDitem.templateId = $scope.queryDitem.state == 2 ? $scope.queryDitem.templateId : null;\n    };\n\n    var init = function init() {\n      userEnterpriseService.queryEnterpriseUser(function (res) {\n        if (res.code == 0) {\n          $scope.$broadcast(\"reportRule\", res.data);\n        }\n      });\n    };\n\n    $scope.dialog = function () {\n      ngDialog.open({\n        template: '../partials/dialogue/add_report_rule.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n    }; //判断用户是否存在\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]);\n});"],"sourceRoot":"/source/"}