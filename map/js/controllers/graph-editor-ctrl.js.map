{"version":3,"sources":["js/controllers/graph-editor-ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","controller","scope","rootScope","routeParams","timeout","kpiDataService","resourceUIService","SwSocket","Info","viewFlexService","growl","q","window","location","solutionUIService","serviceCenterService","chartOptionService","toolBarList","status","rootCi","freeBoardValue","CHARTDATA","solutionId","serviceViewId","allViews","viewId","currentView","loadedView","groupId","modelId","path","callback","event","data","filter","element","viewType","find","Error","viewTitle","titleChange","getDashboard","cachBindData","undefined","clone","dt","JSON","parse","content","standardDashboard","layout","setting","editData","traveseByChild","onChange","eval","source","$extension","bindTo","id","$randomString","replaceCiKpi","call","renderBoard","getModelDashboardViewSolution","code","version","type","children","col","padding","console","log","toolbar","this","subtoolbar","modelSelector","get","info","titleComposory","getModelDashboardViewContent","getAllMyViews","click","toolbarDetail","sub","map","select","tools","dataType","tempData","option","uuid","push","exitDashboard","fnlist","label","icon","style","width","border-radius","font-size","font-weight","fn","href","dialogBox","saveDashboard","viewmode","title","description","change","defer","defera","deferb","unitFilter","unitFilterDisabled","kpis","getBymodelId","then","kpiUnits","reduce","prev","next","some","elem","value","unit","resolve","err","resources","all","promise","cols","inx","drop","colstyles","path1","path2","refineDataStructure","$$hashKey","model","resource","kpi","attributes","i","reset","applied","panelCancel","dataPanel","editPanel","init","rootDomain","getModelByIds","allmodel","models","getAll","Array","apply","allModels","TEXT","modelDisable","SPARKLINE","LINECHART","GAUGECHART","PIECHART","BARCHART","SCATTERCHART","KCHART","RADARCHART","grid","GRID","linechart","gaugechart","piechart","barchart","scatterchart","kchart","radarchart","mapchart","map1chart","map2chart","scatter2chart","scatter3chart","relation1chart","relation2chart","parallels1chart","parallels2chart","parallels3chart","sankey1chart","sankey2chart","panelClose","dataPanelShow","temp","checked","defers","finished","def","getcikpi","$","isArray","resourceId","kpiId","check","correct","savedata","saveModelDashboardViewContent","stringify","success","error","param","length","slice","viewName","updateView","addView","colstyle","gridSelector","colChange","setValue","onDelete","getElem","getParent","targetId","target","attr","parent","$remove","onSetting","ui","selectData","switchToData","valueGroup","onDataChange","onDrop","before","dragId","draggable","indexOf","targetParent","insertBefore","split","pare","row","traverse","el","selectWrap","kpiChange","maxKpi","resourceChange","mode","groupRemove","list","clearDashboard","resetDashboard","dataTypeChange","groupAdd","parseInt","Math","random","toString","tabClick","removeClass","addClass"],"mappings":"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","file":"js/controllers/graph-editor-ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers'], function (controllers) {\n  'use strict';\n\n  controllers.controller('graphEditorCtrl', ['$scope', '$rootScope', '$routeParams', '$timeout', 'kpiDataService', 'resourceUIService', 'SwSocket', 'Info', 'viewFlexService', 'growl', '$q', '$window', '$location', 'solutionUIService', 'serviceCenterService', 'chartOptionService', 'toolBarList', function (scope, rootScope, routeParams, timeout, kpiDataService, resourceUIService, SwSocket, Info, viewFlexService, growl, q, window, location, solutionUIService, serviceCenterService, chartOptionService, toolBarList) {\n    var status, rootCi, freeBoardValue, CHARTDATA, solutionId, serviceViewId, allViews, viewId, currentView, loadedView;\n    var solutionId = routeParams.solutionId;\n    var groupId = routeParams.groupId;\n    var modelId = routeParams.modelId;\n    var viewId = routeParams.viewId;\n    var path = \"../localdb/freeboard.json\";\n    scope.solutionId = solutionId;\n    loadedView = {\n      id: $randomString(32),\n      type: 'column',\n      children: [],\n      col: 12\n    };\n    Info.get(path, function (info) {\n      if (solutionId) {\n        scope.titleComposory = false;\n        solutionUIService.getModelDashboardViewContent(solutionId, groupId, modelId, getModelDashboardViewSolution);\n      } else {\n        scope.titleComposory = true;\n\n        if (viewId) {\n          viewFlexService.getAllMyViews(callback);\n          scope.viewId = viewId;\n        }\n      }\n    });\n\n    function callback(event) {\n      allViews = event.data.filter(function (element) {\n        return element.viewType == \"designView_v2\" && element.viewId != viewId;\n      });\n      currentView = event.data.find(function (element) {\n        return element.viewId == viewId;\n      });\n\n      if (currentView) {\n        scope.viewTitle = currentView.viewTitle;\n        scope.titleChange();\n        getDashboard();\n      } else {\n        throw new Error(\"视图不存在！！\");\n      }\n    }\n\n    function getDashboard() {\n      var cachBindData = {};\n\n      if (currentView != undefined) {\n        var clone,\n            dt = JSON.parse(currentView.content);\n        clone = dt;\n      } else {\n        clone = standardDashboard.clone();\n      }\n\n      loadedView = {\n        layout: clone.data,\n        setting: clone.setting\n      };\n      scope.editData = {\n        layout: clone.data,\n        setting: clone.setting\n      };\n      scope.editData.layout.traveseByChild(function (element) {\n        if (element.onChange) {\n          element.onChange = eval(element.onChange);\n        }\n\n        if (element.source) {\n          var source = element.source;\n          element.clone(freeBoardValue[source].clone().$extension(element));\n        }\n\n        if (element.data) {\n          if (element.data.bindTo) {\n            if (cachBindData[element.data.bindTo]) {\n              element.data = cachBindData[element.data.bindTo];\n            } else {\n              cachBindData[element.data.bindTo] = element.data;\n            }\n          }\n        }\n\n        element.id = $randomString(32);\n      });\n      replaceCiKpi.call(scope.editData.layout, function () {\n        timeout(function () {\n          scope.editData.renderBoard();\n        });\n      });\n    }\n\n    function getModelDashboardViewSolution(event) {\n      if (event.code) {\n        if (event.data != null) {\n          var clone,\n              dt = JSON.parse(event.data);\n\n          if (dt.version == \"V_2\") {\n            clone = {\n              layout: dt.data,\n              setting: dt.setting\n            };\n          } else {\n            clone = {\n              layout: {\n                id: $randomString(32),\n                type: 'column',\n                children: [],\n                col: 12\n              },\n              setting: {\n                padding: 15\n              }\n            };\n          }\n        }\n\n        loadedView = clone.clone();\n        scope.editData = clone;\n        scope.editData.layout.traveseByChild(function (element) {\n          if (element.onChange) {\n            element.onChange = eval(element.onChange);\n          }\n\n          if (element.source) {\n            var source = element.source;\n            element.clone(freeBoardValue[source].clone().$extension(element.clone()));\n          }\n\n          element.id = $randomString(32); //console.log(\"mmm= \", element.clone());\n        });\n        console.log(\"hhh = \", scope.editData);\n        replaceCiKpi.call(scope.editData.layout, function () {\n          timeout(function () {\n            scope.editData.renderBoard();\n          });\n        });\n      }\n    }\n\n    function toolbar(data) {\n      this.clone(data);\n    }\n\n    toolbar.prototype.click = function () {\n      scope.toolbarDetail = this.clone();\n      scope.toolbarDetail.sub = scope.toolbarDetail.sub.map(function (element) {\n        return new subtoolbar(element);\n      });\n    };\n\n    function subtoolbar(data) {\n      this.clone(data);\n    }\n\n    subtoolbar.prototype.click = function () {\n      var select = scope.tools[this.dataType.type + 'chart'].clone();\n      var tempData = CHARTDATA[this.option];\n      var uuid = $randomString(32);\n      var selectWrap;\n      select.$extension(tempData);\n      select.id = $randomString(32);\n\n      if (tempData) {\n        select.$extension({\n          data: {\n            bindTo: uuid\n          }\n        });\n        selectWrap = {\n          type: \"row\",\n          style: \"border : 1px dashed #aaa; padding : 20px 0; margin : 20px auto;\",\n          children: [{\n            type: 'col',\n            col: 12,\n            children: [{\n              id: $randomString(32),\n              type: 'multiSelect',\n              data: select.data.$extension({\n                bindTo: uuid\n              })\n            }]\n          }, {\n            type: 'col',\n            col: 12,\n            children: [select]\n          }]\n        };\n      } else {\n        selectWrap = select;\n      }\n\n      scope.toolbarDetail = undefined;\n      scope.editData.layout.children.push(select);\n      scope.editData.renderBoard();\n    };\n\n    function modelSelector(data) {\n      this.clone(data);\n    }\n\n    ;\n\n    rootScope.exitDashboard = function () {\n      var fnlist = [{\n        label: '不保存',\n        icon: 'btn btn-default pull-left',\n        style: {\n          width: '50%',\n          'border-radius': 0,\n          'font-size': '18px',\n          'font-weight': 'bold',\n          'padding': 10\n        },\n        fn: function fn() {\n          if (solutionId && serviceViewId) {\n            window.location.href = \"../app-ac/index.html#/myView\";\n          } else {\n            window.location.href = \"../app-oc/index.html#/designView/\" + scope.viewId;\n          }\n        }\n      }, {\n        label: '取消',\n        icon: 'btn btn-cancel',\n        style: {\n          width: '50%',\n          'border-radius': 0,\n          'font-size': '18px',\n          'font-weight': 'bold',\n          'padding': 10\n        },\n        fn: function fn() {\n          scope.dialogBox = undefined;\n        }\n      }, {\n        label: '保存',\n        icon: 'btn btn-success',\n        style: {\n          width: '50%',\n          'border-radius': 0,\n          'font-size': '18px',\n          'font-weight': 'bold',\n          'padding': 10\n        },\n        fn: function fn() {\n          rootScope.saveDashboard(function () {\n            if (rootScope.viewmode == 'editor') {\n              if (solutionId && serviceViewId) {\n                window.location.href = \"../app-ac/index.html#/myView\";\n              } else {\n                window.location.href = \"../app-oc/index.html#/designView/\" + scope.viewId;\n              }\n            } else {\n              if (solutionId && serviceViewId) {\n                window.location.href = \"../app-ac/index.html#/myView\";\n              } else {\n                window.location.href = \"../app-oc/index.html#/designView/\" + scope.viewId;\n              }\n            }\n          });\n        }\n      }];\n      scope.dialogBox = {\n        title: {\n          label: '退出DASHBOARD编辑器'\n        },\n        description: {\n          label: '尚有未保存的修改，是否保存？'\n        },\n        fnlist: fnlist\n      };\n    };\n\n    modelSelector.prototype.change = function () {\n      var modelId = this.id;\n      var defer = q.defer();\n      var defera = q.defer();\n      var deferb = q.defer();\n      scope.unitFilter = undefined;\n      scope.unitFilterDisabled = false;\n      serviceCenterService.kpis.getBymodelId(modelId).then(function success(data) {\n        scope.kpis = data;\n        scope.kpiUnits = data.reduce(function (prev, next) {\n          var some = prev.some(function (elem) {\n            return elem.value == next.unit;\n          });\n\n          if (!some) {\n            prev.push({\n              label: next.unit,\n              value: next.unit\n            });\n          }\n\n          return prev;\n        }, [{\n          label: 'all',\n          value: ''\n        }]);\n        defera.resolve(\"success\");\n      }, function error(err) {\n        console.log(err);\n      });\n      serviceCenterService.resources.getBymodelId(modelId).then(function success(data) {\n        scope.resources = data;\n        deferb.resolve(\"success\");\n      }, function error(err) {\n        console.log(err);\n      });\n      q.all([defera.promise, deferb.promise]).then(function (event) {\n        defer.resolve(\"success\");\n      });\n      return defer.promise;\n    };\n\n    console.log(toolBarList);\n    scope.toolBarList = toolBarList.map(function (element) {\n      return new toolbar(element);\n    });\n    scope.cols = [{\n      inx: 0,\n      value: 12\n    }];\n    scope.drop = {};\n    scope.colstyles = [{\n      label: '自定义',\n      value: []\n    }, {\n      label: '100%',\n      value: [12]\n    }, {\n      label: '50% - 50%',\n      value: [6, 6]\n    }, {\n      label: '66% - 33%',\n      value: [8, 4]\n    }, {\n      label: '33% - 66%',\n      value: [4, 8]\n    }, {\n      label: '33% - 33% - 33%',\n      value: [4, 4, 4]\n    }, {\n      label: '25% - 25% - 25% - 25%',\n      value: [3, 3, 3, 3]\n    }];\n    var path1 = \"../localdb/editor.json\";\n    var path2 = \"../localdb/freeboard.json\";\n\n    scope.titleChange = function () {\n      if (allViews) {\n        check();\n      } else {\n        viewFlexService.getAllMyViews(function (event) {\n          if (event.code == '0') {\n            allViews = event.data.filter(function (element) {\n              return element.viewType == \"designView_v2\" && element.viewId != viewId;\n            });\n            check();\n          }\n        });\n      }\n\n      function check() {\n        var find = allViews.some(function (element) {\n          return element.viewTitle == scope.viewTitle;\n        });\n        scope.correct = !find;\n      }\n    };\n\n    function refineDataStructure() {\n      var cachBindData = {};\n      this.traveseByChild(function (element) {\n        delete element.id;\n\n        if (element.$$hashKey) {\n          delete element.$$hashKey;\n        }\n\n        if (element.data) {\n          if (element.data.model) {\n            element.data.model = {\n              id: element.data.model.id\n            };\n          }\n\n          if (element.data.resource) {\n            element.data.resource = element.data.resource.map(function (elem) {\n              if (elem.id == rootCi.id) {\n                return \"rootCi\";\n              } else {\n                return elem.id;\n              }\n            });\n          }\n\n          if (element.data.kpi) {\n            element.data.kpi = element.data.kpi.map(function (elem) {\n              return elem.id;\n            });\n          }\n        }\n\n        if (element.attributes) {\n          for (var i in element.attributes) {\n            var reset = {\n              value: element.attributes[i].value\n            };\n\n            if (element.attributes[i].applied != undefined) {\n              reset.applied = element.attributes[i].applied;\n            }\n\n            if (element.attributes[i].data) {\n              reset.$extension({\n                data: {\n                  value: element.attributes[i].data.value\n                }\n              });\n            }\n\n            element.attributes[i] = reset;\n          }\n\n          if (element.data.bindTo) {\n            if (cachBindData[element.data.bindTo]) {\n              element.data = cachBindData[element.data.bindTo];\n            } else {\n              cachBindData[element.data.bindTo] = element.data;\n            }\n          }\n        }\n      });\n    }\n\n    ;\n\n    rootScope.saveDashboard = function (callback) {\n      if (solutionId || typeof scope.viewTitle == 'string' && scope.viewTitle != '') {\n        var savedata = scope.editData.clone();\n        refineDataStructure.call(savedata.layout);\n        var content = {\n          version: 'V_2',\n          data: savedata.layout,\n          setting: savedata.setting\n        };\n\n        if (solutionId) {\n          solutionUIService.saveModelDashboardViewContent(solutionId, groupId, modelId, JSON.stringify(content), function (event) {\n            if (event.code == 0) {\n              //window.location.href = \"../app-ac/index.html#/myView\";\n              growl.success(\"解决方案视图修改成功\", {});\n            } else {\n              growl.error(\"解决方案视图修改失败\", {});\n            }\n          });\n        } else {\n          var param = {\n            viewTitle: scope.viewTitle.length > 30 ? scope.viewTitle.slice(0, 30) : scope.viewTitle,\n            viewName: 'designView_v2',\n            viewType: \"designView_v2\",\n            content: JSON.stringify(content)\n          };\n\n          if (scope.viewId) {\n            param.viewId = scope.viewId;\n            viewFlexService.updateView(param, function (event) {\n              if (event.code == 0) {\n                growl.success(\"性能视图修改成功\", {});\n\n                if (callback) {\n                  callback();\n                } //window.location.href = \"../app-oc/index.html#/designView/\" + scope.viewId;\n\n              }\n            });\n          } else {\n            viewFlexService.addView(param, function (event) {\n              if (event.code == 0) {\n                growl.success(\"性能视图创建成功\", {});\n                scope.viewId = event.data.viewId;\n\n                if (callback) {\n                  callback();\n                } //window.location.href = \"../app-oc/index.html#/designView/\" + event.data.viewId;\n\n              }\n            });\n          }\n        }\n      } else {\n        growl.error(\"视图名不能为空！\", {});\n      }\n    };\n\n    Info.get(path1, function (info) {\n      console.log(info);\n      CHARTDATA = info;\n      Info.get(path2, function (info) {\n        freeBoardValue = info.freeBoardValue;\n        init();\n      });\n    });\n    scope.editData = {\n      layout: {\n        id: $randomString(32),\n        type: 'column',\n        children: [],\n        col: 12\n      },\n      setting: {\n        padding: 15\n      }\n    };\n    rootScope.panelCancel = panelCancel;\n\n    function panelCancel() {\n      scope.unitFilter = \"\";\n      scope.unitFilterDisabled = false;\n      scope.dataPanel = undefined;\n      scope.editPanel = undefined;\n      scope.resources = undefined;\n      scope.kpis = undefined;\n    }\n\n    function init() {\n      serviceCenterService.rootDomain.get().then(function success(data) {\n        rootCi = data;\n        var model = [data.modelId];\n        resourceUIService.getModelByIds(model, function (event) {\n          var rootModel = event.data[0];\n          var allmodel = [rootModel];\n          serviceCenterService.models.getAll().then(function success(data) {\n            Array.prototype.push.apply(allmodel, data);\n            scope.allModels = allmodel.map(function (element) {\n              return new modelSelector(element);\n            });\n            freeBoardValue.TEXT.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            freeBoardValue.SPARKLINE.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            freeBoardValue.LINECHART.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            freeBoardValue.GAUGECHART.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            freeBoardValue.PIECHART.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            freeBoardValue.BARCHART.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            freeBoardValue.SCATTERCHART.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            freeBoardValue.KCHART.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            freeBoardValue.RADARCHART.$extension({\n              data: {\n                model: scope.allModels[0],\n                resource: [rootCi],\n                modelDisable: false\n              }\n            });\n            scope.tools = {\n              grid: freeBoardValue.GRID,\n              linechart: freeBoardValue.LINECHART,\n              gaugechart: freeBoardValue.GAUGECHART,\n              piechart: freeBoardValue.PIECHART,\n              barchart: freeBoardValue.BARCHART,\n              scatterchart: freeBoardValue.SCATTERCHART,\n              kchart: freeBoardValue.KCHART,\n              radarchart: freeBoardValue.RADARCHART,\n              mapchart: {\n                type: 'mapchart'\n              },\n              map1chart: {\n                type: 'map1chart'\n              },\n              map2chart: {\n                type: 'map2chart'\n              },\n              scatter2chart: {\n                type: 'scatter2chart'\n              },\n              scatter3chart: {\n                type: 'scatter3chart'\n              },\n              relation1chart: {\n                type: \"relation1chart\"\n              },\n              relation2chart: {\n                type: \"relation2chart\"\n              },\n              parallels1chart: {\n                type: 'parallels1chart'\n              },\n              parallels2chart: {\n                type: 'parallels2chart'\n              },\n              parallels3chart: {\n                type: 'parallels3chart'\n              },\n              sankey1chart: {\n                type: 'sankey1chart'\n              },\n              sankey2chart: {\n                type: 'sankey2chart'\n              }\n            };\n\n            for (var i in scope.tools) {\n              console.log(scope.tools[i]);\n              replaceCiKpi.call(scope.tools[i]);\n            }\n\n            scope.editData.renderBoard();\n          }, function error(err) {\n            console.log(err);\n          });\n        });\n      });\n    }\n\n    scope.colstyle = scope.colstyles[1];\n    scope.gridSelector = {};\n\n    scope.colChange = function (col) {\n      scope.gridSelector.setValue(col);\n    };\n\n    scope.onDelete = function (event) {\n      var targetId = $(event.target).attr(\"id\");\n      var getElem, getParent;\n      scope.editData.layout.traveseByChild(function (element, parent) {\n        if (element.id == targetId) {\n          getElem = element;\n          getParent = parent;\n        }\n      });\n      var find = getParent.find(function (elem) {\n        return elem == getElem;\n      });\n\n      if (find) {\n        getParent.$remove(function (element) {\n          return element.id == find.id;\n        });\n      }\n\n      scope.editData.renderBoard();\n    };\n\n    scope.onSetting = function (event, ui) {\n      var getElem, getParent;\n      var targetId = $(event.target).attr(\"id\");\n      scope.editData.layout.traveseByChild(function (element, parent) {\n        if (element.id == targetId) {\n          getElem = element;\n          getParent = parent;\n        }\n      });\n      scope.selectData = getElem;\n      scope.editPanel = getElem.clone();\n\n      rootScope.panelClose = function panelCloseData() {\n        getElem.$extension(scope.editPanel);\n        scope.unitFilter = \"\";\n        scope.unitFilterDisabled = false;\n        scope.dataPanel = undefined;\n        scope.editPanel = undefined;\n        scope.resources = undefined;\n        scope.kpis = undefined;\n        scope.editData.renderBoard();\n      };\n    };\n\n    scope.switchToData = function () {\n      var temp = scope.editPanel;\n      scope.editPanel = undefined;\n      timeout(function () {\n        dataPanelShow(temp);\n      }, 400);\n      rootScope.panelClose = panelCloseData;\n\n      function panelCloseData() {\n        if (scope.dataPanel.data.resource && scope.dataPanel.data.kpi) {\n          for (var i in scope.dataPanel.attributes) {\n            if (scope.dataPanel.attributes[i].data) {\n              if (scope.dataPanel.attributes[i].data.value == 'none') {\n                scope.dataPanel.attributes[i].data.value = scope.dataPanel.attributes[i].data.option[1].value;\n              }\n            }\n          }\n\n          if (scope.dataPanel.valueGroup) {\n            scope.dataPanel.valueGroup.data.value = \"value\";\n          }\n        } else {\n          for (var i in scope.dataPanel.attributes) {\n            if (scope.dataPanel.attributes[i].data) {\n              if (scope.dataPanel.attributes[i].data.value != 'none') {\n                scope.dataPanel.attributes[i].data.value = 'none';\n              }\n            }\n          }\n\n          if (scope.dataPanel.valueGroup) {\n            scope.dataPanel.valueGroup.data.value = \"custom\";\n          }\n        }\n\n        scope.selectData.$extension(scope.dataPanel);\n        scope.editData.renderBoard();\n        timeout(function () {\n          var temp = scope.selectData.clone();\n          scope.editPanel = temp;\n\n          rootScope.panelClose = function () {\n            scope.selectData.$extension(scope.editPanel);\n            scope.editData.renderBoard();\n            scope.unitFilter = \"\";\n            scope.unitFilterDisabled = false;\n            scope.dataPanel = undefined;\n            scope.editPanel = undefined;\n            scope.resources = undefined;\n            scope.kpis = undefined;\n          };\n        }, 400);\n        scope.unitFilter = \"\";\n        scope.unitFilterDisabled = false;\n        scope.dataPanel = undefined;\n        scope.editPanel = undefined;\n        scope.resources = undefined;\n        scope.kpis = undefined;\n      }\n    };\n\n    scope.onDataChange = function (event, ui) {\n      var getElem, getParent;\n      var targetId = $(event.target).attr(\"id\");\n      scope.editData.layout.traveseByChild(function (element, parent) {\n        if (element.id == targetId) {\n          getElem = element;\n          getParent = parent;\n        }\n      });\n\n      for (var i in scope.resources) {\n        scope.resources[i].checked = false;\n      }\n\n      for (var i in scope.kpis) {\n        scope.kpis[i].checked = false;\n      }\n\n      scope.selectData = getElem;\n      dataPanelShow(getElem.clone());\n      rootScope.panelClose = panelCloseData;\n\n      function panelCloseData() {\n        if (scope.dataPanel.data.resource && scope.dataPanel.data.kpi) {\n          for (var i in scope.dataPanel.attributes) {\n            if (scope.dataPanel.attributes[i].data) {\n              if (scope.dataPanel.attributes[i].data.value == 'none') {\n                scope.dataPanel.attributes[i].data.value = scope.dataPanel.attributes[i].data.option[1].value;\n              }\n            }\n          }\n\n          if (scope.dataPanel.valueGroup) {\n            scope.dataPanel.valueGroup.data.value = \"value\";\n          }\n        } else {\n          for (var i in scope.dataPanel.attributes) {\n            if (scope.dataPanel.attributes[i].data) {\n              if (scope.dataPanel.attributes[i].data.value != 'none') {\n                scope.dataPanel.attributes[i].data.value = 'none';\n              }\n            }\n          }\n\n          if (scope.dataPanel.valueGroup) {\n            scope.dataPanel.valueGroup.data.value = \"custom\";\n          }\n        }\n\n        scope.selectData.$extension(scope.dataPanel.clone());\n        scope.editData.renderBoard();\n        scope.unitFilter = \"\";\n        scope.unitFilterDisabled = false;\n        scope.dataPanel = undefined;\n        scope.editPanel = undefined;\n        scope.resources = undefined;\n        scope.kpis = undefined;\n      }\n    };\n\n    function panelClose() {\n      scope.unitFilter = \"\";\n      scope.unitFilterDisabled = false;\n      scope.dataPanel = undefined;\n      scope.editPanel = undefined;\n      scope.resources = undefined;\n      scope.kpis = undefined;\n      scope.editData.renderBoard();\n    }\n\n    scope.onChange = function (cols, reset) {\n      scope.tools.grid.children = cols.map(function (element) {\n        var result = {\n          type: 'column',\n          children: [],\n          col: element\n        };\n        return result;\n      });\n\n      if (reset) {\n        scope.colstyle = scope.colstyles[0];\n      }\n    };\n\n    scope.onDrop = function (event, ui, before) {\n      var targetId = $(event.target).attr(\"id\");\n      var dragId = ui.draggable.attr(\"id\");\n\n      if (targetId != dragId) {\n        if (dragId.indexOf(\"add_\") == -1) {\n          var getElem,\n              getParent,\n              clone = {};\n          scope.editData.layout.traveseByChild(function (element, parent) {\n            if (element.id == dragId) {\n              getElem = element;\n              getParent = parent;\n            }\n          });\n          clone = getElem.clone();\n          var find = getParent.find(function (elem) {\n            return elem == getElem;\n          });\n\n          if (find) {\n            getParent.$remove(function (element) {\n              return element.id == find.id;\n            });\n          }\n\n          var find, targetParent;\n          scope.editData.layout.traveseByChild(function (element, parent) {\n            if (element.id == targetId) {\n              find = element;\n              targetParent = parent;\n            }\n          });\n\n          if (before) {\n            var inx = targetParent.indexOf(find);\n\n            if (inx != -1) {\n              targetParent.insertBefore(inx, clone);\n            }\n          } else {\n            find.children.push(clone);\n          }\n\n          scope.editData.renderBoard();\n        } else {\n          var dragId = dragId.split(\"add_\")[1];\n\n          if (dragId == 'grid') {\n            var find, pare, children;\n            var children = [];\n            var row;\n\n            if (scope.tools.clone()[dragId]) {\n              row = scope.tools.clone()[dragId];\n            } else if (scope.tools.clone()[dragId + 'chart']) {\n              row = scope.tools.clone()[dragId + 'chart'];\n            } else {\n              throw new Error(\"找不到视图!\");\n            }\n\n            row.traveseByChild(function (element) {\n              element.id = $randomString(32);\n              element.traverse(function (el) {\n                if (el.onChange) {\n                  el.onChange = eval(el.onChange);\n                }\n              });\n            });\n            scope.editData.layout.traveseByChild(function (element, parent) {\n              if (element.id == targetId) {\n                find = element;\n                pare = parent;\n              }\n            });\n\n            if (before) {\n              var inx = pare.indexOf(find);\n              pare.insertBefore(inx, row);\n            } else {\n              find.children.push(row);\n            }\n\n            scope.editData.renderBoard();\n          } else {\n            var find = toolBarList.find(function (element) {\n              return element.id == dragId;\n            });\n            var uuid = $randomString(32);\n            var option = find.sub[0].option;\n            var find, pare, children;\n            var children = [];\n            var select;\n\n            if (scope.tools.clone()[dragId]) {\n              select = scope.tools.clone()[dragId];\n            } else if (scope.tools.clone()[dragId + 'chart']) {\n              select = scope.tools.clone()[dragId + 'chart'];\n            } else {\n              throw new Error(\"找不到视图!\");\n            }\n\n            var tempData = CHARTDATA[option];\n            select.id = $randomString(32);\n            select.$extension(tempData);\n            var selectWrap = {\n              type: \"row\",\n              style: \"border : 1px dashed #aaa; padding : 20px 0; margin : 20px auto;\",\n              children: [{\n                type: 'col',\n                col: 12,\n                children: [{\n                  id: $randomString(32),\n                  type: 'multiSelect',\n                  data: {\n                    bindTo: uuid,\n                    model: select.data.model,\n                    resource: select.data.resource\n                  }\n                }]\n              }, {\n                type: 'col',\n                col: 12,\n                children: [select]\n              }]\n            };\n            selectWrap.traveseByChild(function (element) {\n              element.id = $randomString(32);\n              element.traverse(function (el) {\n                if (el.onChange) {\n                  el.onChange = eval(el.onChange);\n                }\n              });\n            });\n            scope.editData.layout.traveseByChild(function (element, parent) {\n              if (element.id == targetId) {\n                find = element;\n                pare = parent;\n              }\n            });\n\n            if (before) {\n              var inx = pare.indexOf(find);\n              pare.insertBefore(inx, selectWrap);\n            } else {\n              find.children.push(selectWrap);\n            }\n\n            scope.editData.renderBoard();\n          }\n        }\n      }\n    };\n\n    scope.kpiChange = function (kpi) {\n      if (scope.dataPanel.data.maxKpi == 1) {\n        for (var i in scope.kpis) {\n          if (scope.kpis[i].id != kpi.id) {\n            scope.kpis[i].checked = false;\n          } else {\n            scope.kpis[i].checked = !scope.kpis[i].checked;\n          }\n        }\n      } else {\n        kpi.checked = !kpi.checked;\n      }\n\n      var filter = scope.kpis.filter(function (element) {\n        return element.checked == true;\n      });\n\n      if (filter.length > 0) {\n        scope.unitFilter = filter[0].unit;\n        scope.unitFilterDisabled = true;\n        scope.dataPanel.data.kpi = filter;\n      } else {\n        scope.unitFilter = \"\";\n        scope.unitFilterDisabled = false;\n        scope.dataPanel.data.kpi = undefined;\n      }\n    };\n\n    scope.resourceChange = function (resource) {\n      console.log(scope.resources);\n      resource.checked = !resource.checked;\n      var filter = scope.resources.filter(function (element) {\n        return element.checked == true;\n      });\n\n      if (filter.length > 0) {\n        scope.dataPanel.data.resource = filter;\n      } else {\n        scope.dataPanel.data.resource = undefined;\n      }\n    };\n\n    function dataPanelShow(temp) {\n      scope.dataPanel = temp.clone();\n      scope.dataPanel.data.model = scope.allModels.find(function (element) {\n        return element.id == scope.dataPanel.data.model.id;\n      });\n      scope.dataPanel.data.model.change().then(function success() {\n        for (var i in scope.resources) {\n          var some = false;\n\n          if (scope.dataPanel.data.resource) {\n            some = scope.dataPanel.data.resource.some(function (elem) {\n              return scope.resources[i].id == elem.id;\n            });\n          }\n\n          scope.resources[i].checked = some;\n        }\n\n        for (var i in scope.kpis) {\n          var find;\n\n          if (scope.dataPanel.data.kpi) {\n            find = scope.dataPanel.data.kpi.find(function (elem) {\n              return scope.kpis[i].id == elem.id;\n            });\n          }\n\n          if (find) {\n            scope.unitFilter = find.unit;\n            scope.unitFilterDisabled = true;\n          }\n\n          scope.kpis[i].checked = find != undefined;\n        }\n      });\n    }\n\n    ;\n\n    function replaceCiKpi(callback) {\n      var defers = [];\n      var cur = this;\n      this.traveseByChild(function (element) {\n        var resourceArr = [];\n        var finished,\n            def = q.defer();\n        defers.push(def.promise);\n\n        (function (def) {\n          if (element.data) {\n            element.data.defer = function (callback) {\n              finished = callback;\n            };\n\n            if (_typeof(element.data.model) != 'object') {\n              var modelId = element.data.model;\n              resourceUIService.getModelByIds([modelId], function (event) {\n                if (event.code == '0') {\n                  element.data.model = new modelSelector(event.data[0]);\n                  getcikpi(modelId);\n                }\n              });\n            } else if (element.data.model != undefined) {\n              var modelId = element.data.model.id;\n\n              if (modelId == undefined) {\n                console.log(element, \"is empty\");\n              }\n\n              getcikpi(modelId);\n            }\n          } else {\n            def.resolve(\"success\");\n          }\n\n          function getcikpi(modelId) {\n            console.log(modelId);\n            serviceCenterService.resources.getBymodelId(modelId).then(function success(data) {\n              if ($.isArray(element.data.resource)) {\n                for (var i in element.data.resource) {\n                  if (element.data.resource[i] == 'rootCi') {\n                    element.data.resource[i] = rootCi;\n                  } else if (_typeof(element.data.resource[i]) != 'object') {\n                    var resourceId = element.data.resource[i];\n                    element.data.resource[i] = data.find(function (elem) {\n                      return resourceId == elem.id;\n                    });\n                  }\n                }\n              }\n\n              serviceCenterService.kpis.getBymodelId(modelId).then(function success(data) {\n                if ($.isArray(element.data.kpi)) {\n                  for (var i in element.data.kpi) {\n                    if (_typeof(element.data.kpi[i]) != 'object') {\n                      var kpiId = element.data.kpi[i];\n                      element.data.kpi[i] = data.find(function (elem) {\n                        return kpiId == elem.id;\n                      });\n                    }\n                  }\n                }\n\n                delete element.data.defer;\n\n                if (typeof finished == 'function') {\n                  finished(\"success!!\");\n                }\n\n                def.resolve(\"success\");\n              });\n            });\n          }\n        })(def);\n      });\n      q.all(defers).then(function success(data) {\n        if (typeof callback == 'function') {\n          callback();\n        }\n      });\n    }\n\n    scope.mode = \"EDIT\";\n\n    scope.groupRemove = function (target, list) {\n      if (list.length > 1) {\n        list.$remove(function (element) {\n          return target.id == element.id;\n        });\n        console.log(list);\n\n        for (var i in list) {\n          list[i].id = i;\n        }\n      }\n    };\n\n    rootScope.clearDashboard = function () {\n      scope.editData = {\n        layout: {\n          id: $randomString(32),\n          type: 'column',\n          children: [],\n          col: 12\n        }\n      };\n      timeout(function () {\n        scope.editData.renderBoard();\n      });\n    };\n\n    rootScope.resetDashboard = function () {\n      var cachBindData = {};\n      scope.editData = loadedView.clone();\n      scope.editData.layout.traveseByChild(function (element) {\n        if (element.onChange) {\n          element.onChange = eval(element.onChange);\n        }\n\n        element.id = $randomString(32);\n\n        if (element.source) {\n          var source = element.source;\n          element.clone(freeBoardValue[source].clone().$extension(element.clone()));\n        }\n\n        if (element.data) {\n          if (element.data.bindTo) {\n            if (cachBindData[element.data.bindTo]) {\n              element.data = cachBindData[element.data.bindTo];\n            } else {\n              cachBindData[element.data.bindTo] = element.data;\n            }\n          }\n        }\n      });\n      replaceCiKpi.call(scope.editData.layout);\n      timeout(function () {\n        if (status == \"PREV\") {\n          scope.editData.renderBoard(true);\n        } else {\n          scope.editData.renderBoard();\n        }\n      });\n    };\n\n    scope.dataTypeChange = function (data, editPanel) {\n      if (data.value != \"none\") {\n        if (editPanel.data.resource == undefined || editPanel.data.kpi == undefined) {\n          var temp = scope.editPanel;\n          scope.editPanel = undefined;\n          timeout(function () {\n            dataPanelShow(temp);\n          }, 400);\n          rootScope.panelClose = panelCloseData;\n        }\n      }\n\n      function panelCloseData() {\n        if (scope.dataPanel.data.resource && scope.dataPanel.data.kpi) {\n          var temp = scope.dataPanel;\n          scope.selectData.clone(temp);\n          scope.dataPanel = undefined;\n          scope.editData.renderBoard();\n          timeout(function () {\n            rootScope.panelClose = function () {\n              scope.editPanel.clone(scope.selectData);\n              scope.unitFilter = \"\";\n              scope.unitFilterDisabled = false;\n              scope.dataPanel = undefined;\n              scope.editPanel = undefined;\n              scope.resources = undefined;\n              scope.kpis = undefined;\n            };\n\n            ;\n          }, 400);\n        } else {\n          data.value = \"none\";\n        }\n\n        scope.unitFilter = \"\";\n        scope.unitFilterDisabled = false;\n        scope.dataPanel = undefined;\n        scope.editPanel = undefined;\n        scope.resources = undefined;\n        scope.kpis = undefined;\n      }\n    };\n\n    scope.groupAdd = function (list) {\n      var clone = list[0].clone();\n      var value = [];\n\n      for (var i in clone.attributes.value.value.split(\",\")) {\n        value.push(parseInt(Math.random() * 100));\n      }\n\n      clone.attributes.value.value = value.toString();\n      list.push(clone);\n\n      for (var i in list) {\n        delete list[i]['$$hashKey'];\n        list[i].id = i;\n      }\n    };\n\n    scope.tabClick = function (mode) {\n      scope.mode = mode;\n\n      if (mode == \"EDIT\") {\n        $(\".free-board-left\").removeClass(\"free-board-fold\");\n        $(\".free-board-right\").removeClass(\"free-board-full\");\n        timeout(function () {\n          var target = $(\".previewarea\");\n          target.removeClass(\"previewarea\");\n          target.addClass(\"drawarea\");\n          scope.editData.renderBoard();\n          status = \"EDIT\";\n        }, 300);\n      } else {\n        $(\".free-board-left\").addClass(\"free-board-fold\");\n        $(\".free-board-right\").addClass(\"free-board-full\");\n        timeout(function () {\n          var target = $(\".drawarea\");\n          target.addClass(\"previewarea\");\n          target.removeClass(\"drawarea\");\n          scope.editData.renderBoard(true);\n          status = \"PREV\";\n        }, 300);\n      }\n\n      ;\n    };\n  }]);\n});"],"sourceRoot":"/source/"}