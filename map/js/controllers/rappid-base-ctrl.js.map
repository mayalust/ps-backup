{"version":3,"sources":["js/controllers/rappid-base-ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","BootstrapDialog","keyboardJS","joint","initController","$scope","$routeParams","$compile","$rootScope","viewFlexService","resourceUIService","kpiDataService","SwSocket","growl","loc","timeout","configUIService","$q","ngDialog","paper","graph","paperScroller","stencil","selection","selectionView","clipboard","commandManager","navigator","snapLines","inspector","cellsDic","shiftHold","backspaceHold","displayMode","uuid","Math","displayModeLink","arrowheadMarkup","toolMarkup","vertexMarkup","kpiDefDic","zoomOptAry","location","hash","search","_events_","interval","promise","fn","defer","resolve","reject","getResourceById","id","res","rej","d","code","data","getMeasurePointData","queue","item","rs","allObj","i","arr","push","isArray","shift","apply","Number","name","parse","a","JSON","e","removeType","str","match","exec","getKpi","kpi","onEvent","eventName","callback","bind","target","tagName","selectedItem","cell","cellposition","attributes","position","embeds","get","keyCode","prop","y","forEach","subId","subCell","getCell","x","remove","models","length","alertIcons","selectedView","temp","domainListTree","selectedAlertConfig","selectedValueConfig","directiveList","autoSaveHandler","baseConfig","autoSave","isNaN","setInterval","checkSameName","viewTitle","run","allViews","some","elem","errorMsg","checkSm","getAllMyViews","event","sendItemDir","dir","dirNodeId","itemDirValues","value","params","show","title","closable","message","buttons","label","cssClass","action","dialogRef","sendDeviceDirective","nodeId","returnObj","success","close","warning","backHandler","nodeChangeHandler","ary","toString","split","nodes","node","modelId","domainPath","sn","model","rootModelDic","kpis","directives","then","resource","sensors","values","MeasurePointLocate","sensor","physicalConfig","accessConfigs","sensorChangeHandler","$watch","n","o","s","console","log","dataItems","filter","instance","sort","b","k1","find","dataItemId","k2","serial","dataItemChangeHandler","dataItem","directivesChangeHandler","directiveIds","nodesChangeHandler","nodeIds","kpiChangeHandler","kpiId","kpisChangeHandler","kpiIds","subViewChangeHandler","subViewId","echartViewIdChangeHandler","echartViewId","selectTypeChangeHandler","stateIdChangeHandler","stateId","stateTypeChangeHandler","stateType","tabsInfoChangeHandler","tabsInfo","unitChangeHandler","unitType","alertlevelChangeHandler","alertLevels","alertIconChangeHandler","attrs","image","alertIcon","alertTextChangeHandler","text","alertText","valuelevelChangeHandler","valueLevels","valueIconChangeHandler","valueIcon","valueTextChangeHandler","valueText","valueDirChangeHandler","valueDirAttrChangeHandler","domainAndModelChangeHandler","initItem","domains","concat","getDevicesByCondition","layoutZChangeHandler","z","extendDomainsChangeHandler","extendDomainId","fillColor","type","color","state","color2","colorAry","colorAry2","transition","delay","duration","valueFunction","util","interpolate","hexColor","breathFlash","opacityState","flash","el","defaultOpacity","opacity","timingFunction","timing","inout","t","abs","toFixed","jQuery","isNumeric","_","contains","getTransitions","on","path","off","setLevel","range","eval","persent","transform","height","start","end","time","bubbleFlash","r","changeIconAndText","stateDisplay","stateHandler","returnData","cellObj","showEffect","extend","cells","nodeIdAry","fillType","attrsType","fillValue","unit","kpiDef","myOptionDic","valueHandler","rangeObj","kpiCode","rootModelsDic","kpiDic","kpiIdAry","getResourceBaseState","ids","getRealTimeKpiData","getResourceState","getWebsocket","param","ciid","operation","register","send","$on","unregister","clearInterval","showViewContent","scope","viewId","clear","getViewById","$","AdminLTE","controlSidebar","activate","domainListDic","extendDomain","template","resourceType","getResourceByIds","resourceId","resourceDic","replace","getExtendDomainsByFilter","subDomainListTree","subDomainListDic","components","myCommander","save4Json","$parent","configViewBg","bgimages","configCustoms","load","layout","getGraph","getPaper","fitToContent","configCommons","shapes","customer","configItem","content","contentCellsDic","originalCellDic","scale","paperscorllerW","width","display","zoom","pop","max","$el","css","fromJSON","options","gridSize","bgimage","bgcolor","setDimensions","setGrid","scroll","echartAry","groupDic","cellsModel","textary","boxClientRect","getBoundingClientRect","size","left","top","groupDef","group","groupAry","k","modelAry","setTimeout","$apply","dirty","PatternLinkView","dia","LinkView","patternMarkup","join","render","this","arguments","listenTo","update","cancelFrame","frameId","pattern","V","patternImage","findOne","svg","defs","append","_V","connection","attr","stroke","strokeWidth","nextFrame","fillWithPattern","bbox","g","rect","moveAndExpand","points","sourcePoint","route","targetPoint","map","point","canvas","document","createElement","ctx","getContext","lineWidth","lineJoin","lineCap","pointsCount","save","gradientPoints","gradient","createLinearGradient","drawPattern","call","restore","dataUri","toDataURL","xlink:href","from","to","angle","toRad","theta","center","line","midpoint","fromPolar","PI","beginPath","moveTo","lineTo","closePath","strokeStyle","createConfigView","callbackFun","configureInfo","Date","Format","viewType","description","dialog","open","className","tree","typeContents","treeAry","getResourceByModelId","saveData","addView","href","closeDialog","window","history","back","updateCellHandler","getModel","collection","updateCell","inspectorStatus","status","$applyAsync","openOrClose","viewConfigClick","creatingLine","lineCoords","source","tempLine","tempLines","body","evt","preventDefault","stopPropagation","normalizeEvent","clientCoords","snapToGrid","clientX","clientY","x2","y2","x1","y1","addCellhandler","parentCell","embedObjs","parentCellPos","oldParentCellPos","getLastCell","MAX_VALUE","embedobj","parent","addCell","newCell","clone","unset","initialization","element","interactive","Graph","Paper","perpendicularLinks","markAvailable","defaultLink","Link",".marker-source",".marker-target",".connection","linkConnectionPoint","shapePerimeterConnectionPoint","linkView","innerWidth","outerWidth","lineColor","move","addColorStop","patternColor","ui","PaperScroller","autoResizePaper","padding","Snaplines","scroller","opt","scrollTop","GridLayout","columnWidth","columns","rowHeight","resizeToFit","dy","dx","Stencil","dropAnimation","groups","renderSearch","each","groupName","closeGroups","Backbone","Collection","SelectionView","drawStatus","createLine","stroke-width","viewport","vertices","which","tmplink","startSelecting","cancelSelection","startPanning","cellView","ctrlKey","metaKey","createSelectionBox","add","destroySelectionBox","findViewByModel","reset","without","oncontextmenu","initBatchCommand","invoke","storeBatchCommand","is","openCellTools","halo","$inspectorHolder","$inspectorHolder_text","$inspectorHolder_presentation","$inspectorHolder_geometry","dirSubViewId","subViewState","nodeState","Halo","removeHandles","dirModelId","modelIdAry","dirModel","dirSn","addHandle","icon","category","directiveId","dirObj","isSend","valueLvevel","valueDirective","valueDirectiveAttr","subViewIdAry","viewRoutes","commander","configDispaly","cloneCell","extendHalohandler","flg","cellid","toPNG","dataURL","pjson","toJSON","tmpcopy","stringify","font-size","fill","ref-dy","font-family","newconfig","key","keyDesc","invalid","canDelete","saveConfig","copyactionhandler","removeHandle","FreeTransform","selectType","extendDomainid","zTypeAry","selectTypeAry","echartViewIdAry","nodeIdsAry","nodeItem","stateIdAry","stateTypeAry","unitTypeAry","extenDomainAry","directivesAry","directiveItem","kpisAry","kpiItem","domainPathAry","projectId","inspectorDefs","inputs","commonInspectorInputs","commonInspectorGroups","extendAlertInputs","valueLevel","extendValueInputs","alertLevel","commonInspectorInputsKpis","commonInspectorInstance","levelInputs","domainInputs","switchInputs","openAngleInputs","Inspector","$label","Tooltip","right","direction","children","wrap","html","Element","Clipboard","copyElements","translate","useLocalStorage","pasteCells","link","originalCells","baseWidth","baseHeight","backgroundImage","context","fillStyle","getGridBackgroundImage","viewjson","JSONstring","viewName","updateView","err","alert","CommandManager","cmd","redoStack","batch","lastCmdIndex","trigger","undoStack","undo","redo","configDispalySet","alignAction","align","x_offset","y_offset","toFront","toBack","embed","unembed","preview","encodeURIComponent","flip","hasOwnProperty","indexOf","windowName","uniqueId","write","loadJSON","hotkey","inputcontent","getElementById","json","viewChange","view","splice","loadcount","gotoShowView","rootModelDicWatch","nv","ov","domainListTreeWatch","myOptionDicWatch","undefined","confighome","allmyViews","dialogBox","wholeClick","treedata","navigate","navi","ta","j","$extension","currentView","findCur","traverse","lv1views","detaillist","details","lv1viewsclick","tmp","jsonObj","level","findView","$$","switchToNumber","fnlist","style","border-radius","font-weight","select","con","allViewLoaded"],"mappings":"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","file":"js/controllers/rappid-base-ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers', 'bootstrap-dialog', 'keyboardJS', 'rappid-joint', 'Array'], function (controllers, BootstrapDialog, keyboardJS, joint) {\n  'use strict';\n\n  controllers.initController('RappidBaseCtrl', ['$scope', '$routeParams', '$compile', '$rootScope', 'viewFlexService', 'resourceUIService', 'kpiDataService', 'SwSocket', 'growl', '$location', '$timeout', 'configUIService', \"$q\", 'ngDialog', function ($scope, $routeParams, $compile, $rootScope, viewFlexService, resourceUIService, kpiDataService, SwSocket, growl, loc, timeout, configUIService, $q, ngDialog) {\n    var paper, graph, paperScroller, stencil, selection, selectionView, clipboard, commandManager, navigator, snapLines, inspector;\n    var cellsDic = {}; //组件字典\n\n    var shiftHold = false; //shift按钮状态\n\n    var backspaceHold = false; //空格按钮状态\n\n    var displayMode = false; //显示模式，false为设计模式，true为展示模式\n\n    var uuid = Math.uuid(); //线条展示时，清空设计状态\n\n    var displayModeLink = {\n      'arrowheadMarkup': '<g></g>',\n      'toolMarkup': '<g></g>',\n      'vertexMarkup': '<g></g>'\n    };\n    var kpiDefDic = {}; //指标字典\n\n    var zoomOptAry = []; //缩放动作数组，用于记录缩放的动作\n    //url包含#/display时，组态进入展示模式\n\n    if (location.hash.search(\"#/display\") > -1) {\n      displayMode = true;\n    }\n\n    ; //onEvent保存状态的变更\n\n    var _events_ = {};\n\n    $scope.onEvent = function (eventName, callback) {\n      _events_[eventName] = callback;\n    }; //监听按钮\n\n\n    keyboardJS.bind('shift', function (e) {\n      shiftHold = true;\n    }, function (e) {\n      shiftHold = false;\n    });\n    keyboardJS.bind('shift', null, function (e) {\n      shiftHold = false;\n    });\n    keyboardJS.bind('backspace', function (e) {\n      backspaceHold = true;\n    }, function (e) {\n      backspaceHold = false;\n    });\n    keyboardJS.bind('backspace', null, function (e) {\n      backspaceHold = false;\n    }); //监听上下左右和删除按钮\n\n    keyboardJS.bind(['up', 'down', 'right', 'left', 'delete'], function (e) {\n      if (e.target.tagName != \"INPUT\" && $scope.selectedItem.cell) {\n        var cell = $scope.selectedItem.cell;\n        var cellposition = cell.attributes.position;\n        var embeds = cell.get(\"embeds\");\n\n        if (e.keyCode == 38) {\n          cell.prop('position/y', cellposition.y - 1);\n\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.prop('position/y', subCell.attributes.position.y - 1);\n            });\n          }\n        } else if (e.keyCode == 40) {\n          cell.prop('position/y', cellposition.y + 1);\n\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.prop('position/y', subCell.attributes.position.y + 1);\n            });\n          }\n        } else if (e.keyCode == 39) {\n          cell.prop('position/x', cellposition.x + 1);\n\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.prop('position/x', subCell.attributes.position.x + 1);\n            });\n          }\n        } else if (e.keyCode == 37) {\n          cell.prop('position/x', cellposition.x - 1);\n\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.prop('position/x', subCell.attributes.position.x - 1);\n            });\n          }\n        } else if (e.keyCode == 46) {\n          if (embeds) {\n            embeds.forEach(function (subId) {\n              var subCell = graph.getCell(subId);\n              subCell.remove();\n            });\n          }\n\n          cell.remove();\n        }\n      } else if (e.target.tagName != \"INPUT\" && selection.models.length > 0) {\n        selection.models.forEach(function (cell) {\n          var cellposition = cell.attributes.position;\n\n          if (e.keyCode == 38) {\n            cell.prop('position/y', cellposition.y - 1);\n          } else if (e.keyCode == 40) {\n            cell.prop('position/y', cellposition.y + 1);\n          } else if (e.keyCode == 39) {\n            cell.prop('position/x', cellposition.x + 1);\n          } else if (e.keyCode == 37) {\n            cell.prop('position/x', cellposition.x - 1);\n          } else if (e.keyCode == 46) {\n            var embeds = cell.get(\"embeds\");\n\n            if (embeds) {\n              embeds.forEach(function (subId) {\n                var subCell = graph.getCell(subId);\n                subCell.remove();\n              });\n            }\n\n            cell.remove();\n          }\n        });\n      }\n    });\n    $scope.alertIcons = [];\n    $scope.selectedView = {\n      temp: {},\n      //临时存储Domains\n      inspector: false,\n      //控制inspector是否显示视图设置\n      domainListTree: null //管理域\n\n    }; //组态视图对象\n\n    $scope.selectedAlertConfig = {};\n    $scope.selectedValueConfig = {};\n    $scope.selectedItem = {}; //选中的组件对象\n\n    $scope.directiveList = []; //指令集合\n\n    var interval; //自动保存的计时器对象\n\n    /**\n     * 自动保存，需要在全局配置中设置\n     * @param {Object} callback\n     */\n\n    $scope.autoSaveHandler = function (callback) {\n      if ($scope.baseConfig && $scope.baseConfig.autoSave) {\n        if (isNaN($scope.baseConfig.autoSave)) {\n          $scope.baseConfig.autoSave = 15;\n        }\n\n        interval = setInterval(function () {\n          callback();\n        }, $scope.baseConfig.autoSave * 60 * 1000);\n      }\n    };\n    /**\n     * 检查当前组态视图名称是否可以用\n     * @param {Object} viewTitle\n     */\n\n\n    $scope.checkSameName = function (viewTitle) {\n      var run = function run(allViews) {\n        var some = allViews.some(function (elem) {\n          return viewTitle == elem.viewTitle;\n        });\n\n        if (some) {\n          $scope.errorMsg = \"此视图名称已被占用\";\n        } else {\n          $scope.errorMsg = null;\n        }\n\n        $scope.checkSm = some;\n      };\n\n      if ($scope.getAllMyViews) {\n        run($scope.getAllMyViews);\n      } else {\n        viewFlexService.getAllMyViews(function (event) {\n          if (event.code == 0) {\n            $scope.getAllMyViews = event.data;\n            run(event.data);\n          }\n        });\n      }\n    };\n    /**\n     * 发送指令\n     * @param {Object} dir\n     * @param {Object} dirNodeId\n     */\n\n\n    $scope.sendItemDir = function (dir, dirNodeId) {\n      var itemDirValues = {};\n\n      if (!dir.value) {\n        growl.warning(\"请输入指令参数\");\n        return;\n      }\n\n      for (var i in dir.params) {\n        var obj = dir.params[i];\n        itemDirValues[obj.name] = dir.value;\n      }\n\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        message: '您发送的指令将会在设备上执行，状态数据返回将会有一定时间，确认要发送指令吗？',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            resourceUIService.sendDeviceDirective(dirNodeId ? dirNodeId : Number($scope.selectedItem.nodeId), dir.id, itemDirValues, function (returnObj) {\n              if (returnObj.code == 0) {\n                growl.success(\"指令发送成功，请勿重复发送，状态数据返回需要一定时间！\", {});\n              }\n            });\n            dialogRef.close();\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.backHandler = function () {};\n    /**\n     * 设备单选切换时\n     */\n\n\n    function promise(fn) {\n      var defer = $q.defer();\n      fn(defer.resolve, defer.reject);\n      return defer.promise;\n    }\n\n    function getResourceById(id) {\n      return promise(function (res, rej) {\n        resourceUIService.getResourceById(id, function (d) {\n          if (d.code == \"0\") {\n            res(d.data);\n          } else {\n            rej(d);\n          }\n        });\n      });\n    }\n\n    function getMeasurePointData(queue) {\n      var item,\n          rs = [];\n      queue = isArray(queue) ? queue : [queue];\n\n      function allObj(obj) {\n        var arr = [],\n            i;\n\n        for (i in obj) {\n          if (_typeof(obj[i]) !== \"object\") {\n            return false;\n          }\n\n          arr.push(obj[i]);\n        }\n\n        return arr;\n      }\n\n      while (item = queue.shift()) {\n        if (isArray(item)) {\n          [].push.apply(queue, item);\n        } else {\n          var arr = allObj(item);\n\n          if (arr) {\n            [].push.apply(queue, arr);\n          } else {\n            //测点数据展示1000以下的，1000以上的离线数据\n            if (item && Number(item.name) < 1000) {\n              rs.push(item);\n            }\n          }\n        }\n      }\n\n      return rs;\n    }\n\n    function parse(obj) {\n      var a;\n\n      try {\n        a = JSON.parse(obj);\n      } catch (e) {\n        return;\n      }\n\n      return a;\n    }\n\n    function removeType(str) {\n      var match = /(?:[^:]*:)?([^:]*)/.exec(str);\n      return match ? match[1] : str;\n    }\n\n    $scope.nodeChangeHandler = function () {\n      var nodeId;\n\n      if ($scope.selectedItem.nodeId == null) {\n        if ($scope.selectedItem.cell.get('nodeId')) {\n          var ary = $scope.selectedItem.cell.get('nodeId').toString().split(\":\");\n          nodeId = Number(ary[ary.length - 1]);\n          $scope.selectedItem.nodeId = nodeId;\n        }\n      } else {\n        nodeId = $scope.selectedItem.nodeId;\n      }\n\n      if (nodeId) {\n        for (var i = 0; i < $scope.selectedItem.nodes.length; i++) {\n          var node = $scope.selectedItem.nodes[i];\n\n          if (node.id == nodeId) {\n            $scope.selectedItem.cell.attributes[\"nodeId\"] = \"number:\" + node.id;\n            $scope.selectedItem.cell.attributes[\"modelId\"] = \"number:\" + node.modelId;\n            $scope.selectedItem.cell.attributes[\"domainPath\"] = \"number:\" + $scope.selectedItem.domainPath;\n            $scope.selectedItem.cell.attributes[\"sn\"] = node.sn;\n            $scope.selectedItem.cell.attributes[\"attrs\"][\"text\"][\"text\"] = node.label;\n\n            if ($scope.selectedItem.modelId == 0) {\n              $scope.selectedItem.modelId = node.modelId;\n              var model = resourceUIService.rootModelDic[$scope.selectedItem.modelId]; //选中对象的modelId\n\n              if (model) {\n                //存在该模型\n                $scope.selectedItem.kpis = model.kpis;\n                $scope.selectedItem.directives = model.directives;\n              }\n            }\n\n            break;\n          }\n        }\n\n        getResourceById(nodeId).then(function (resource) {\n          $scope.selectedItem.sensors = getMeasurePointData(parse(resource.values.MeasurePointLocate));\n          $scope.selectedItem.sensor = $scope.selectedItem.cell.attributes[\"sensor\"];\n          $scope.selectedItem.physicalConfig = resource.physicalConfig.accessConfigs;\n\n          if (typeof $scope.selectedItem.sensor !== \"undefined\" && $scope.selectedItem.sensor !== null) {\n            $scope.sensorChangeHandler();\n          }\n        });\n      }\n    };\n\n    function getKpi(id) {\n      return function (kpi) {\n        return kpi.id == id;\n      };\n    }\n\n    $scope.$watch(\"selectedItem.sensor\", function (n, o, s) {\n      if (n === null) {\n        console.log(s.selectedItem);\n      }\n    });\n\n    $scope.sensorChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"sensor\"] = $scope.selectedItem.sensor;\n      $scope.selectedItem.dataItems = $scope.selectedItem.physicalConfig.filter(function (d) {\n        return d.instance == removeType($scope.selectedItem.sensor);\n      });\n      $scope.selectedItem.dataItems.sort(function (a, b) {\n        var k1 = $scope.selectedItem.kpis.find(getKpi(a.dataItemId)),\n            k2 = $scope.selectedItem.kpis.find(getKpi(b.dataItemId));\n        return k1.serial - k2.serial;\n      });\n    };\n\n    $scope.dataItemChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"dataItem\"] = $scope.selectedItem.dataItem;\n    };\n    /**\n     * 指令切换时\n     */\n\n\n    $scope.directivesChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"directiveIds\"] = $scope.selectedItem.directiveIds;\n    };\n    /**\n     * 设备多选切换时\n     */\n\n\n    $scope.nodesChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"nodeIds\"] = $scope.selectedItem.nodeIds;\n    };\n    /**\n     * 指标切换时\n     */\n\n\n    $scope.kpiChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"kpiId\"] = \"number:\" + $scope.selectedItem.kpiId;\n    };\n    /**\n     * 复选指标切换时\n     */\n\n\n    $scope.kpisChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"kpiIds\"] = $scope.selectedItem.kpiIds;\n    };\n    /**\n     * 子视图切换时\n     */\n\n\n    $scope.subViewChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"subViewId\"] = \"number:\" + $scope.selectedItem.subViewId;\n    };\n    /**\n     * 分析视图切换时\n     */\n\n\n    $scope.echartViewIdChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"echartViewId\"] = \"number:\" + $scope.selectedItem.echartViewId;\n    };\n    /**\n     * 设备选择方式切换时（已废弃）\n     */\n\n\n    $scope.selectTypeChangeHandler = function () {\n      $scope.selectedItem.models = [];\n      $scope.selectedItem.modelId = 0;\n      $scope.selectedItem.nodeId = 0;\n      $scope.selectedItem.nodeIds = [];\n      $scope.selectedItem.directives = [];\n      $scope.selectedItem.kpis = [];\n      $scope.selectedItem.kpiId = 0;\n    };\n    /**\n     * 告警状态切换时\n     */\n\n\n    $scope.stateIdChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"stateId\"] = \"number:\" + $scope.selectedItem.stateId;\n    };\n    /**\n     * 提醒方式切换时\n     */\n\n\n    $scope.stateTypeChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"stateType\"] = \"number:\" + $scope.selectedItem.stateType;\n    };\n    /**\n     * 分组信息切换时（不常用）\n     */\n\n\n    $scope.tabsInfoChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"tabsInfo\"] = $scope.selectedItem.tabsInfo;\n    };\n    /**\n     * 指标单位切换时\n     */\n\n\n    $scope.unitChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"unitType\"] = \"number:\" + $scope.selectedItem.unitType;\n    };\n    /**\n     * 告警级别切换时\n     */\n\n\n    $scope.alertlevelChangeHandler = function () {\n      if ($scope.selectedAlertConfig) {\n        $scope.selectedItem.cell.prop('alertConfig', $scope.alertLevels);\n      }\n    };\n    /**\n     * 告警图标切换时\n     */\n\n\n    $scope.alertIconChangeHandler = function () {\n      if ($scope.selectedAlertConfig) {\n        $scope.selectedItem.cell.prop('alertConfig', $scope.alertLevels);\n\n        if ($scope.selectedAlertConfig.id == 0) {\n          $scope.selectedItem.cell.attributes.attrs.image[\"xlink:href\"] = $scope.selectedAlertConfig.alertIcon;\n        }\n      }\n    };\n    /**\n     * 告警名称切换时\n     */\n\n\n    $scope.alertTextChangeHandler = function () {\n      if ($scope.selectedAlertConfig) {\n        $scope.selectedItem.cell.prop('alertConfig', $scope.alertLevels);\n\n        if ($scope.selectedAlertConfig.id == 0) {\n          $scope.selectedItem.cell.attributes.attrs.text.text = $scope.selectedAlertConfig.alertText;\n        }\n      }\n    };\n    /**\n     * 指标图标切换时\n     */\n\n\n    $scope.valuelevelChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n      }\n    };\n    /**\n     * 指标单位切换时\n     */\n\n\n    $scope.valueIconChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n\n        if ($scope.selectedValueConfig.id == 0) {\n          $scope.selectedItem.cell.attributes.attrs.image[\"xlink:href\"] = $scope.selectedValueConfig.valueIcon;\n        }\n      }\n    };\n    /**\n     * 指标值切换时\n     */\n\n\n    $scope.valueTextChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n\n        if ($scope.selectedValueConfig.id == 0) {\n          $scope.selectedItem.cell.attributes.attrs.text.text = $scope.selectedValueConfig.valueText;\n        }\n      }\n    };\n    /**\n     * 指标指令切换时\n     */\n\n\n    $scope.valueDirChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n      }\n    };\n    /**\n     * 指标指令参数切换时\n     */\n\n\n    $scope.valueDirAttrChangeHandler = function () {\n      if ($scope.selectedValueConfig) {\n        $scope.selectedItem.cell.prop('valueConfig', $scope.valueLevels);\n      }\n    };\n    /**\n     * 管理域／模板切换时\n     * @param {Object} initItem\n     */\n\n\n    $scope.domainAndModelChangeHandler = function (initItem) {\n      var modelId = $scope.selectedItem.modelId > 0 ? $scope.selectedItem.modelId : null;\n      var domains = $scope.selectedItem.domainPath;\n\n      if (!modelId || !domains) {\n        console.log(\"性能调试\");\n        return;\n      }\n\n      var model = resourceUIService.rootModelDic[$scope.selectedItem.modelId]; //选中对象的modelId\n\n      if (model) {\n        //存在该模型\n        $scope.selectedItem.kpis = model.kpis;\n        $scope.selectedItem.directives = model.directives;\n        $scope.selectedItem.cell.attributes[\"modelId\"] = \"number:\" + $scope.selectedItem.modelId;\n        $scope.selectedItem.cell.attributes[\"domainPath\"] = \"number:\" + $scope.selectedItem.domainPath;\n      } else {\n        $scope.selectedItem.kpis = [];\n        $scope.selectedItem.directives = [];\n      }\n\n      if ($scope.selectedView.temp[modelId + \"_\" + domains]) {\n        $scope.selectedItem.nodes = [{\n          label: \"无\",\n          id: 0\n        }].concat($scope.selectedView.temp[modelId + \"_\" + domains]);\n\n        if (initItem) {\n          $scope.selectedItem.nodeIds = initItem.nodeIds;\n          $scope.nodesChangeHandler();\n        }\n      } else {\n        resourceUIService.getDevicesByCondition({\n          modelId: modelId,\n          domains: domains\n        }, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.selectedView.temp[modelId + \"_\" + domains] = returnObj.data;\n            $scope.selectedItem.nodes = [{\n              label: \"无\",\n              id: 0\n            }].concat(returnObj.data);\n\n            if (initItem) {\n              $scope.selectedItem.nodeIds = initItem.nodeIds;\n              $scope.nodesChangeHandler();\n            }\n          }\n\n          ;\n        });\n      }\n    };\n    /**\n     * 组件图层切换时\n     */\n\n\n    $scope.layoutZChangeHandler = function () {\n      $scope.selectedItem.cell.attributes[\"z\"] = Number($scope.selectedItem.z);\n      $scope.selectedItem.cell.prop(\"z\", Number($scope.selectedItem.z));\n    };\n    /**\n     * 扩展域切换时，暂时用处不大\n     */\n\n\n    $scope.extendDomainsChangeHandler = function () {\n      if ($scope.selectedItem.extendDomainId) {\n        $scope.selectedItem.cell.attributes[\"extendDomainId\"] = \"number:\" + $scope.selectedItem.extendDomainId;\n        $scope.selectedItem.cell.attributes[\"nodeId\"] = \"number:\" + $scope.selectedItem.extendDomainId;\n      }\n    };\n    /**\n     * 告警状态提示方式：填充颜色\n     * @param {Object} cell 组件对象\n     * @param {Object} type 组件类型，比如rect、image、cricle等\n     * @param {Object} color 填充颜色\n     * @param {Object} state 告警状态\n     * @param {Object} color2 组件的原来颜色\n     */\n\n\n    var fillColor = function fillColor(cell, type, color, state, color2) {\n      var stateId = cell.get(\"stateId\");\n\n      if (stateId) {\n        if (state < 1) state = 0;\n        var colorAry = [color, '#25bce7', '#e1cd0a', '#ed9700', '#e7675d'];\n        var colorAry2 = [color2, '#25bce7', '#e1cd0a', '#ed9700', '#e7675d'];\n\n        if (stateId == \"number:1\" || stateId == \"number:3\") {\n          if (type) {\n            cell.transition('attrs/' + type + '/fill', colorAry[state], {\n              delay: 0,\n              duration: 500,\n              valueFunction: joint.util.interpolate.hexColor\n            });\n          }\n        }\n\n        if (stateId == \"number:2\" || stateId == \"number:3\") {\n          cell.transition('attrs/text/fill', colorAry2[state], {\n            delay: 0,\n            duration: 500,\n            valueFunction: joint.util.interpolate.hexColor\n          });\n        }\n      }\n    };\n    /**\n     * 告警状态提示方式：呼吸灯,经过优化的 zhangafa 2017-6-2\n     * @param {Object} cell 组件对象\n     * @param {Object} type 组件类型，比如rect、image、cricle等\n     * @param {Object} color 填充颜色\n     * @param {Object} state 告警状态\n     * @param {Object} opacityState 组件的透明度\n     */\n\n\n    var breathFlash = function breathFlash(cell, type, color, state, opacityState) {\n      var stateId = cell.get(\"stateId\");\n\n      var flash = function flash(el) {\n        var defaultOpacity = opacityState ? 1 : el.opacity;\n        el.transition('attrs/' + type + '/opacity', defaultOpacity, {\n          delay: 0,\n          duration: 3000,\n          timingFunction: joint.util.timing.inout,\n          valueFunction: function valueFunction(a, b) {\n            return function (t) {\n              var o = a + b * (defaultOpacity - Math.abs(defaultOpacity - 2 * defaultOpacity * t));\n              return Number(o.toFixed(2));\n            };\n          }\n        });\n      };\n\n      if (stateId) {\n        if (state < 0) state = 0;\n        var colorAry = [color, '#25bce7', '#e1cd0a', '#ed9700', '#e7675d'];\n\n        if (stateId == \"number:2\") {\n          type = \"text\";\n        }\n\n        if (type) {\n          if (!cell.opacity) {\n            cell.opacity = jQuery.isNumeric(cell.prop('attrs/' + type + '/opacity')) ? cell.prop('attrs/' + type + '/opacity') : 1;\n          }\n\n          cell.state = state;\n          cell.prop('attrs/' + type + '/opacity', 0.1);\n          cell.prop('attrs/' + type + '/fill', colorAry[state]);\n\n          if (cell.state > 0) {\n            if (_.contains(cell.getTransitions(), 'attrs/' + type + '/opacity')) return;\n            cell.on('transition:end', function (el, path) {\n              if (el.state > 0) {\n                flash(el);\n              } else {\n                el.off('transition:end');\n                el.prop('attrs/' + type + '/opacity', el.opacity);\n              }\n            });\n            flash(cell);\n          } else {\n            cell.prop('attrs/' + type + '/opacity', cell.opacity);\n          }\n        }\n      }\n    };\n    /**\n     * 液位设置\n     * @param {Object} cell 组件对象\n     * @param {Object} value 液位的数值\n     */\n\n\n    var setLevel = function setLevel(cell, value) {\n      var range = cell.attributes.range;\n\n      if (range) {\n        range = eval(range);\n      }\n\n      var persent = (value - range[0]) / (range[1] - range[0]);\n      cell.prop(\"attrs/text/text\", \"\");\n      cell.transition('attrs/rect', {\n        'transform': 'translate(0,0)',\n        'height': 60 * persent\n      }, {\n        delay: 0,\n        duration: 1000,\n        valueFunction: function valueFunction(start, end) {\n          return function (time) {\n            var height = start['height'] + (end['height'] - start['height']) * time;\n            var all = 0;\n            return {\n              'transform': 'translate(0,' + (60 - height) + ')',\n              'height': height\n            };\n          };\n        }\n      });\n    };\n    /**\n     * 告警状态提示方式：气泡，仅支持圆形\n     * @param {Object} cell 组件对象\n     * @param {Object} type 组件类型，比如rect、image、cricle等\n     * @param {Object} color 填充颜色\n     * @param {Object} state 告警状态\n     * @param {Object} opacityState 组件的透明度\n     */\n\n\n    var bubbleFlash = function bubbleFlash(cell, type, color, state, opacityState) {\n      var stateId = cell.get(\"stateId\");\n\n      var flash = function flash() {\n        cell.prop('attrs/' + type + '/r', 0);\n        cell.prop('attrs/' + type + '/opacity', opacityState ? 1 : cell.opacity);\n        cell.transition('attrs/' + type, {\n          'r': cell.r,\n          'opacity': 0\n        }, {\n          delay: 0,\n          duration: 1500,\n          valueFunction: function valueFunction(start, end) {\n            return function (time) {\n              return {\n                'r': start['r'] + (end['r'] - start['r']) * time,\n                'opacity': start['opacity'] - start['opacity'] * time\n              };\n            };\n          }\n        });\n      };\n\n      if (stateId) {\n        if (state < 0) state = 0;\n        var colorAry = [color, '#25bce7', '#e1cd0a', '#ed9700', '#e7675d'];\n\n        if (stateId == \"number:2\") {\n          type = \"text\";\n        }\n\n        if (type) {\n          if (!cell.opacity) {\n            cell.opacity = jQuery.isNumeric(cell.prop('attrs/' + type + '/opacity')) ? cell.prop('attrs/' + type + '/opacity') : 1;\n            cell.r = cell.prop('attrs/' + type + '/r');\n            cell.prop('attrs/' + type + '/opacity', opacityState ? 1 : cell.opacity);\n          }\n\n          cell.state = state;\n          cell.prop('attrs/' + type + '/fill', colorAry[state]);\n\n          if (cell.state > 0) {\n            if (_.contains(cell.getTransitions(), 'attrs/' + type)) return;\n            cell.on('transition:end', function (el) {\n              if (el.state > 0) {\n                flash();\n              } else {\n                cell.prop('attrs/' + type + '/opacity', cell.opacity);\n                cell.prop('attrs/' + type + '/r', cell.r);\n              }\n            });\n            flash();\n          } else {\n            cell.prop('attrs/' + type + '/opacity', cell.opacity);\n            cell.prop('attrs/' + type + '/r', cell.r);\n          }\n        }\n      }\n    };\n    /**\n     * 告警扩展修改图片和文字\n     * @param {Object} cell\n     * @param {Object} state\n     * @param {Object} type alertConfig：图标设置 valueConfig文字设置\n     */\n\n\n    var changeIconAndText = function changeIconAndText(cell, state, type) {\n      if (!type) type = \"alertConfig\";\n\n      if (type == \"alertConfig\") {\n        var alertIcon = cell.get(\"alertIcon\");\n\n        if (alertIcon) {\n          if (state < 1) state = 0;\n          var alertConfig = cell.get(type);\n          alertConfig.forEach(function (item) {\n            if (item.id == state) {\n              if (item.alertText) cell.prop('attrs/text/text', item.alertText);\n              if (item.alertIcon) cell.prop('attrs/image/xlink:href', item.alertIcon);\n            }\n          });\n        }\n      } else if (type == \"valueConfig\") {\n        var valueConfig = cell.get(type);\n        valueConfig.forEach(function (item) {\n          item.stateDisplay = false;\n\n          if (item.valueText == state) {\n            item.stateDisplay = true;\n            if (item.valueText) cell.prop('attrs/text/text', item.valueText);\n            if (item.valueIcon) cell.prop('attrs/image/xlink:href', item.valueIcon);\n          }\n        });\n      }\n    };\n    /**\n     * 告警状态设置\n     * @param {Object} returnData\n     */\n\n\n    var stateHandler = function stateHandler(returnData) {\n      if (cellsDic[returnData.nodeId]) {\n        cellsDic[returnData.nodeId].forEach(function (cellObj) {\n          if (cellObj[returnData.nodeId].state != returnData.value) {\n            var showEffect = true;\n            var cell = cellObj[returnData.nodeId];\n\n            if (cell.get(\"kpiId\") && cell.get(\"kpiId\") != \"number:0\") {\n              if (returnData.instance) {\n                if (\"number:\" + returnData.instance != cell.get(\"kpiId\")) {\n                  showEffect = false;\n                }\n              } else {\n                showEffect = false;\n              }\n            } else {\n              if (returnData.instance) {\n                showEffect = false;\n              }\n            }\n\n            if (!showEffect) return;\n            var extend = cellObj[returnData.nodeId].get(\"extend\");\n\n            if (extend == 'alarm') {\n              //告警扩展\n              changeIconAndText(cellObj[returnData.nodeId], returnData.value);\n            } else if (extend == \"level\") {\n              //液位扩展\n              fillColor(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, false);\n            } else {\n              if (cellObj[returnData.nodeId].get('stateType') == \"number:1\") {\n                breathFlash(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, false);\n              } else if (cellObj[returnData.nodeId].get('stateType') == \"number:2\") {\n                bubbleFlash(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, false);\n              } else if (cellObj[returnData.nodeId].get('stateType') == \"number:3\") {\n                breathFlash(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, true);\n              } else if (cellObj[returnData.nodeId].get('stateType') == \"number:4\") {\n                bubbleFlash(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, true);\n              } else {\n                fillColor(cellObj[returnData.nodeId], cellObj[returnData.nodeId + \"_type\"], cellObj[returnData.nodeId + \"_fill\"], returnData.value, cellObj[returnData.nodeId + \"text_fill\"]);\n              }\n            }\n          }\n        });\n      } else {\n        graph.attributes.cells.models.forEach(function (cell) {\n          if (cell.get(\"nodeId\")) {\n            var nodeIdAry = cell.get(\"nodeId\").split(\":\");\n\n            if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] == returnData.nodeId) {\n              if (!cellsDic[returnData.nodeId]) cellsDic[returnData.nodeId] = [];\n              var cellObj = {};\n              var type = $scope.fillType[cell.get(\"type\")];\n              var showEffect = true;\n\n              if (cell.get(\"kpiId\") && cell.get(\"kpiId\") != \"number:0\") {\n                if (returnData.instance) {\n                  if (\"number:\" + returnData.instance != cell.get(\"kpiId\")) {\n                    showEffect = false;\n                  }\n                } else {\n                  showEffect = false;\n                }\n              } else {\n                if (returnData.instance) {\n                  showEffect = false;\n                }\n              }\n\n              var extend = cell.get(\"extend\");\n              var attrsType = cell.get(\"attrs\")[type];\n              if (attrsType) cellObj[returnData.nodeId + \"_fill\"] = attrsType[\"fill\"];else cellObj[returnData.nodeId + \"_fill\"] = '#fff';\n\n              if (extend != 'alarm' && extend != 'value' && extend != 'level') {\n                if (cell.get(\"attrs\")[\"text\"]) {\n                  cellObj[returnData.nodeId + \"text_fill\"] = cell.get(\"attrs\")[\"text\"][\"fill\"];\n                } else {\n                  cellObj[returnData.nodeId + \"text_fill\"] = '#000';\n                }\n\n                cellObj[returnData.nodeId + \"_type\"] = type;\n                cellObj[returnData.nodeId] = cell;\n                cellsDic[returnData.nodeId].push(cellObj);\n                if (!showEffect) return;\n\n                if (cell.get('stateType') == \"number:1\") {\n                  breathFlash(cell, type, attrsType[\"fill\"], returnData.value, false);\n                } else if (cell.get('stateType') == \"number:2\") {\n                  bubbleFlash(cell, type, attrsType[\"fill\"], returnData.value, false);\n                } else if (cell.get('stateType') == \"number:3\") {\n                  breathFlash(cell, type, attrsType[\"fill\"], returnData.value, true);\n                } else if (cell.get('stateType') == \"number:4\") {\n                  bubbleFlash(cell, type, attrsType[\"fill\"], returnData.value, true);\n                } else {\n                  fillColor(cell, type, attrsType[\"fill\"], returnData.value, cellObj[returnData.nodeId + \"text_fill\"]);\n                }\n              } else if (extend == 'alarm') {\n                cellObj[returnData.nodeId] = cell;\n                cellsDic[returnData.nodeId].push(cellObj);\n                if (!showEffect) return;\n                changeIconAndText(cell, returnData.value);\n              } else if (extend == \"level\") {\n                fillColor(cell, type, attrsType[\"fill\"], returnData.value, false);\n              }\n            }\n          }\n        });\n      }\n    };\n    /**\n     * 文本修改\n     * @param {Object} cell\n     * @param {Object} value\n     */\n\n\n    var fillValue = function fillValue(cell, value) {\n      var extend = cell.get(\"extend\");\n      if (extend == 'alarm') return;\n\n      if (extend == 'level') {\n        setLevel(cell, value);\n      } else {\n        var unit = \"\";\n\n        if (cell.get(\"unitType\") == \"number:1\") {\n          var kpiDef = kpiDefDic[cell.get(\"kpiId\")];\n\n          if (kpiDef && $scope.myOptionDic) {\n            unit = $scope.myOptionDic[kpiDef.unit];\n\n            if (unit) {\n              cell.prop('attrs/text/text', value + \"\" + unit);\n            }\n          }\n        }\n\n        if (!unit) cell.prop('attrs/text/text', value);\n      }\n    };\n    /**\n     * 组件label设置\n     * @param {Object} returnData\n     */\n\n\n    var valueHandler = function valueHandler(returnData) {\n      if (cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode]) {\n        cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode].forEach(function (cellObj) {\n          fillValue(cellObj, cellObj.rangeObj ? cellObj.rangeObj[returnData.value] : returnData.value);\n          if (cellObj.get(\"extend\") == 'value') changeIconAndText(cellObj, returnData.value, \"valueConfig\");\n        });\n      } else {\n        var rangeObj;\n        if (returnData.modelId) rangeObj = $rootScope.rootModelsDic[returnData.modelId].kpiDic[returnData.kpiCode].rangeObj;\n        graph.attributes.cells.models.forEach(function (cell) {\n          if (cell.get(\"nodeId\")) {\n            var nodeIdAry = cell.get(\"nodeId\").split(\":\");\n\n            if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] == returnData.nodeId) {\n              if (!cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode]) cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode] = [];\n\n              if (cell.get(\"kpiId\")) {\n                var kpiIdAry = cell.get(\"kpiId\").split(\":\");\n\n                if (kpiIdAry.length > 0 && kpiIdAry[kpiIdAry.length - 1] == returnData.kpiCode) {\n                  cell.rangeObj = rangeObj;\n                  cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode].push(cell);\n                  fillValue(cell, rangeObj ? rangeObj[returnData.value] : returnData.value);\n                  if (cell.get(\"extend\") == 'value') changeIconAndText(cell, returnData.value, \"valueConfig\");\n                }\n              }\n            }\n          }\n        });\n      }\n    };\n    /**\n     * 获得组件绑定的设备上基本告警状态\n     * @param {Object} ids\n     */\n\n\n    var getResourceBaseState = function getResourceBaseState(ids) {\n      kpiDataService.getRealTimeKpiData(ids, [999999], function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            stateHandler(returnObj.data[i]);\n          }\n        }\n      }, true);\n    };\n    /**\n     * 获得组件绑定的设备上KPI指标数据\n     * @param {Object} ids\n     * @param {Object} kpis\n     */\n\n\n    var getResourceState = function getResourceState(ids, kpis) {\n      kpiDataService.getRealTimeKpiData(ids, kpis, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            valueHandler(returnObj.data[i]);\n          }\n        }\n      });\n    };\n    /******** 以下为websocket处理 ********/\n\n\n    var uuid = Math.uuid();\n\n    var getWebsocket = function getWebsocket(ids, kpis) {\n      kpis.push(999999);\n      var param = {\n        ciid: ids.toString(),\n        kpi: kpis.toString()\n      };\n      var operation = \"register\"; //考虑极端情况，一个页面有多个模块监听同一个方法\n      //但展示在页面的数据需对接收的实时监听的数据做不同处理\n\n      SwSocket.register(uuid, operation, function (returnObj) {\n        if (returnObj.data.kpiCode == 999999) stateHandler(returnObj.data);else valueHandler(returnObj.data);\n      }); //websocket发送请求\n\n      SwSocket.send(uuid, operation, 'kpi', param);\n    };\n    /**\n     * 注销scope时注销方法heartBeat，回调函数callback\n     */\n\n\n    $scope.$on(\"$destroy\", function () {\n      SwSocket.unregister(uuid);\n      if (interval) clearInterval(interval);\n    });\n    /******** 以上为websocket处理 ********/\n\n    /**\n     * 通过viewId获得视图的组态内容\n     * @param {Object} scope\n     * @param {Object} viewId\n     */\n\n    var showViewContent = function showViewContent(scope, viewId) {\n      //清空原来的组件内容\n      cellsDic = {};\n\n      if (graph.attributes && graph.attributes.cells && graph.attributes.cells.models) {\n        graph.attributes.cells.models.forEach(function (cell) {\n          cell.off('transition:end');\n        });\n        graph.clear();\n      }\n\n      if (viewId != \"all\") {\n        viewFlexService.getViewById(viewId, function (returnObj) {\n          if (returnObj.code == 0) {\n            $.AdminLTE.controlSidebar.activate(); //激活控制区域\n\n            $scope.selectedView = returnObj.data;\n            $scope.selectedView.temp = {}; //临时存储Domains\n\n            $scope.selectedView.inspector = false; //控制inspector是否显示视图设置\n            //设置管理域\n\n            $scope.selectedView.domainListTree = [$scope.domainListDic[$scope.selectedView.domainPath]]; //查询扩展域（项目视图且扩展域配置为真时）\n\n            if ($scope.baseConfig && $scope.baseConfig.extendDomain && $scope.selectedView.template && $scope.selectedView.template.resourceType == 'project') {\n              resourceUIService.getResourceByIds([$scope.selectedView.template.resourceId], function (resourceDic) {\n                if (!resourceDic[$scope.selectedView.template.resourceId]) return;\n                var domains = resourceDic[$scope.selectedView.template.resourceId].domains.replace($scope.selectedView.template.resourceId + \"/\", \"\");\n                var params = {\n                  domains: domains,\n                  modelId: 301\n                };\n                resourceUIService.getExtendDomainsByFilter(params, function (returnObj) {\n                  if (returnObj.code != 0) return;\n                  $scope.selectedView.subDomainListTree = returnObj.domainListTree;\n                  $scope.selectedView.subDomainListDic = returnObj.domainListDic;\n                });\n              });\n            }\n\n            scope.data.viewTitle = $scope.selectedView.viewTitle; //设计模式下，获得背景、自定义和通用组件\n\n            if (!displayMode) {\n              $scope.autoSaveHandler(scope.components.myCommander.save4Json);\n\n              if ($scope.$parent.configViewBg.length > 0) {\n                scope.data.bgimages = scope.data.bgimages.concat($scope.$parent.configViewBg);\n              }\n\n              if ($scope.$parent.configCustoms.length > 0) {\n                scope.components.stencil.load($scope.$parent.configCustoms, \"enterprise\");\n                scope.components.layout(stencil.getGraph(\"enterprise\"));\n                scope.components.stencil.getPaper(\"enterprise\").fitToContent(1, 1, 10);\n              }\n\n              if ($scope.$parent.configCommons.length > 0) {\n                scope.components.stencil.load($scope.$parent.configCommons.concat(scope.data.stencil.shapes.customer), \"customer\");\n                scope.components.layout(stencil.getGraph(\"customer\"));\n                scope.components.stencil.getPaper(\"customer\").fitToContent(1, 1, 10);\n                $scope.$parent.configCommons.forEach(function (configItem) {\n                  configItem.label = configItem.attrs.text.text;\n                  $scope.alertIcons.push(configItem);\n                });\n              }\n            } //如果有视图内容，按照视图内容处理，否则用空的内容\n\n\n            if (returnObj.data.content) {\n              $scope.fillType = scope.data.fillType;\n              var content = JSON.parse(returnObj.data.content);\n              var contentCellsDic = {};\n              var originalCellDic = {}; //原始的单元格\n\n              var scale = (scope.data.paperscorllerW - 20) / content.width; // 展示模式下，去掉线条的控制显示和性能视图的组件存储\n\n              for (var i = content.cells.length - 1; i > -1; i--) {\n                if (content.cells[i].type == \"link\") {\n                  if (displayMode) {\n                    jQuery.extend(content.cells[i], displayModeLink);\n                    content.cells[i].attrs['.connection-wrap'] = {\n                      display: 'none'\n                    };\n                  }\n                } else if (content.cells[i].type == \"chart.Plot\") {\n                  if (displayMode) {\n                    contentCellsDic[content.cells[i].id] = content.cells[i];\n                  }\n                } else {\n                  originalCellDic[content.cells[i].id] = content.cells[i];\n                }\n              } //如果缩放操作有，进行处理\n\n\n              if (zoomOptAry.length > 0) {\n                paperScroller.zoom(-zoomOptAry.pop(), {\n                  max: 4\n                });\n                paper.$el.css('margin-left', 0);\n              }\n\n              scope.components.graph.fromJSON(content);\n              scope.components.paper.options.gridSize = Number(content.gridSize);\n              scope.components.paper.options.width = content.width;\n              scope.components.paper.options.height = content.height;\n              scope.data.bgimage = content.bgimage;\n              scope.data.bgcolor = content.bgcolor ? content.bgcolor : \"#ffffff\";\n              scope.data.width = content.width;\n              scope.data.height = content.height;\n              scope.data.originalCellDic = originalCellDic;\n              scope.components.myCommander.setDimensions();\n              scope.components.myCommander.setGrid();\n              paper.$el.css('background-position', \"center center\");\n\n              if (displayMode) {\n                // paperSroller缩放处理\n                zoomOptAry.push(scale - 1);\n                paperScroller.zoom(scale - 1, {\n                  max: 4\n                });\n                paper.$el.css('margin-right', 0);\n                scope.data.width = jQuery(\".paper\").width();\n                scope.data.height = jQuery(\".paper\").height();\n                paperScroller.scroll(0, 0); //paperScroller.$el.css('overflow-x', \"hidden\");\n\n                paperScroller.$el.css('padding-left', \"0\");\n                paperScroller.$el.css('padding-top', \"0\");\n                /** 以下处理echarts */\n\n                var echartAry = [];\n                var groupDic = {};\n\n                for (var i = graph.attributes.cells.models.length - 1; i > -1; i--) {\n                  var cellsModel = graph.attributes.cells.models[i];\n\n                  if (cellsModel.attributes.type == \"chart.Plot\") {\n                    var boxClientRect = jQuery(\"[model-id=\" + cellsModel.id + \"]\").find(\"g.background\")[0].getBoundingClientRect();\n\n                    if (!contentCellsDic[cellsModel.id + \"_extend\"]) {\n                      contentCellsDic[cellsModel.id].size.width = boxClientRect.width;\n                      contentCellsDic[cellsModel.id].size.height = boxClientRect.height;\n                      contentCellsDic[cellsModel.id].size.x = boxClientRect.left;\n\n                      if ($routeParams.type == 'service') {\n                        contentCellsDic[cellsModel.id].size.y = cellsModel.attributes.position.y * scale;\n                      } else {\n                        contentCellsDic[cellsModel.id].size.y = boxClientRect.top - 86;\n                      }\n\n                      contentCellsDic[cellsModel.id].position.width = boxClientRect.width;\n                      contentCellsDic[cellsModel.id].position.height = boxClientRect.height;\n                      contentCellsDic[cellsModel.id].position.x = boxClientRect.left;\n\n                      if ($routeParams.type == 'service') {\n                        contentCellsDic[cellsModel.id].position.y = cellsModel.attributes.position.y * scale;\n                      } else {\n                        contentCellsDic[cellsModel.id].position.y = boxClientRect.top - 86;\n                      }\n\n                      contentCellsDic[cellsModel.id + \"_extend\"] = true;\n                    }\n\n                    if (cellsModel.attributes.tabsInfo || cellsModel.attributes.attrs.text && cellsModel.attributes.attrs.text.text) {\n                      var textary;\n\n                      if (!cellsModel.attributes.tabsInfo) {\n                        textary = cellsModel.attributes.attrs.text.text.split(\"$$\");\n                      } else {\n                        textary = cellsModel.attributes.tabsInfo.split(\"$$\");\n                      }\n\n                      if (textary.length > 1) {\n                        //有group状态\n                        cellsModel.attributes.attrs.text = {\n                          text: textary[textary.length - 1]\n                        };\n                        contentCellsDic[cellsModel.id].attrs.text = cellsModel.attributes.attrs.text;\n                        var groupDef = JSON.parse(textary[0]);\n\n                        if (!groupDic[groupDef.group]) {\n                          groupDic[groupDef.group] = {\n                            name: groupDef.group,\n                            x: contentCellsDic[cellsModel.id].position.x,\n                            y: contentCellsDic[cellsModel.id].position.y,\n                            width: contentCellsDic[cellsModel.id].size.width,\n                            height: contentCellsDic[cellsModel.id].size.height,\n                            echartAry: []\n                          };\n                        }\n\n                        groupDic[groupDef.group].echartAry.push(contentCellsDic[cellsModel.id]);\n                      } else {\n                        echartAry.push(contentCellsDic[cellsModel.id]);\n                      }\n                    } else {\n                      echartAry.push(contentCellsDic[cellsModel.id]);\n                    }\n\n                    cellsModel.remove();\n                  }\n                }\n\n                scope.data.echartAry = echartAry;\n                var groupAry = [];\n\n                for (var k in groupDic) {\n                  groupAry.push(groupDic[k]);\n                }\n\n                scope.data.groupAry = groupAry;\n                /** 以上处理echarts */\n\n                var ids = [];\n                var kpis = [];\n                content.cells.forEach(function (item) {\n                  if (item.nodeId && item.type != \"chart.Plot\") {\n                    var nodeIdAry = item.nodeId.split(\":\");\n\n                    if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] != '?') {\n                      var nodeId = Number(nodeIdAry[nodeIdAry.length - 1]);\n                      if (nodeId == 0) return true;\n                      ids.push(nodeId);\n\n                      if (item.kpiId) {\n                        var kpiIdAry = item.kpiId.split(\":\");\n\n                        if (kpiIdAry.length > 0 && kpiIdAry[kpiIdAry.length - 1] != '?') {\n                          var kpiId = Number(kpiIdAry[kpiIdAry.length - 1]);\n                          if (kpiId == 0) return true;\n                          var modelAry = item.modelId.split(\":\");\n                          var modelId = Number(modelAry[modelAry.length - 1]);\n                          var model = resourceUIService.rootModelDic[modelId];\n\n                          if (model && model.kpis) {\n                            model.kpis.forEach(function (kpiDef) {\n                              if (kpiId == kpiDef.id) {\n                                kpiDefDic[item.kpiId] = kpiDef;\n                                kpis.push(kpiId);\n                                getResourceState([nodeId], [kpiId]);\n                                return false;\n                              }\n                            });\n                          }\n                        }\n                      }\n                    }\n                  }\n                });\n\n                if (ids.length > 0) {\n                  getResourceBaseState(ids);\n                  getWebsocket(ids, kpis);\n                }\n              } //              scope.components.commander.reset();\n\n            } else {\n              scope.data.bgcolor = \"#ffffff\"; //              scope.components.commander.reset();\n\n              scope.components.graph.clear();\n\n              if (displayMode) {\n                paper.$el.css('background-image', 'url(\"\"),url(\"\")');\n                paper.$el.css('margin-right', 0);\n              }\n            }\n\n            $scope.onEvent(\"graphUpdated\", function () {\n              setTimeout(function () {\n                $scope.$apply(function () {\n                  $rootScope.dirty = true;\n                });\n              });\n            });\n          }\n        });\n      }\n    }; //组态线条的处理\n\n\n    var PatternLinkView = joint.dia.LinkView.extend({\n      patternMarkup: ['<pattern id=\"pattern-<%= id %>\" patternUnits=\"userSpaceOnUse\">', '<image xlink:href=\"\"/>', '</pattern>'].join(''),\n      render: function render() {\n        joint.dia.LinkView.prototype.render.apply(this, arguments);\n\n        if (this.model && !this.model.get(\"pattern\")) {\n          return;\n        }\n\n        this.listenTo(this.model, 'change:pattern change:patternColor', this.update);\n        return this;\n      },\n      remove: function remove() {\n        joint.util.cancelFrame(this.frameId);\n        joint.dia.LinkView.prototype.remove.apply(this, arguments);\n\n        if (this.pattern) {\n          this.pattern.remove();\n          this.pattern = null;\n        }\n      },\n      update: function update() {\n        joint.dia.LinkView.prototype.update.apply(this, arguments);\n\n        if (this.model && !this.model.get(\"pattern\")) {\n          return;\n        }\n\n        if (!this.pattern) {\n          this.pattern = joint.V(_.template(this.patternMarkup)({\n            id: this.id\n          }));\n          this.patternImage = this.pattern.findOne('image');\n          joint.V(this.paper.svg).defs().append(this.pattern);\n        }\n\n        this._V.connection.attr({\n          'stroke': 'url(#pattern-' + this.id + ')'\n        });\n\n        this.strokeWidth = this._V.connection.attr('stroke-width') || 1;\n        joint.util.cancelFrame(this.frameId);\n        this.frameId = joint.util.nextFrame(_.bind(this.fillWithPattern, this));\n        return this;\n      },\n      fillWithPattern: function fillWithPattern() {\n        var strokeWidth = this.strokeWidth;\n        var bbox = joint.g.rect(joint.V(this.el).bbox(true)).moveAndExpand({\n          x: -strokeWidth,\n          y: -strokeWidth,\n          width: 2 * strokeWidth,\n          height: 2 * strokeWidth\n        });\n        var points = [].concat(this.sourcePoint, this.route, this.targetPoint);\n        points = _.map(points, function (point) {\n          return joint.g.point(point.x - bbox.x, point.y - bbox.y);\n        });\n        var canvas = document.createElement('canvas');\n        canvas.width = bbox.width;\n        canvas.height = bbox.height;\n        var ctx = canvas.getContext('2d');\n        ctx.lineWidth = strokeWidth;\n        ctx.lineJoin = \"round\";\n        ctx.lineCap = \"round\";\n\n        for (var i = 0, pointsCount = points.length - 1; i < pointsCount; i++) {\n          ctx.save();\n          var gradientPoints = this.gradientPoints(points[i], points[i + 1], strokeWidth);\n          var gradient = ctx.createLinearGradient.apply(ctx, gradientPoints);\n          this.drawPattern.call(this, ctx, points[i], points[i + 1], strokeWidth, gradient, points, i);\n          ctx.restore();\n        }\n\n        var dataUri = canvas.toDataURL('image/png');\n        this.pattern.attr(bbox);\n        this.patternImage.attr({\n          width: bbox.width,\n          height: bbox.height,\n          'xlink:href': dataUri\n        });\n      },\n      gradientPoints: function gradientPoints(from, to, width) {\n        var angle = joint.g.toRad(from.theta(to) - 90);\n        var center = joint.g.line(from, to).midpoint();\n        var start = joint.g.point.fromPolar(width / 2, angle, center);\n        var end = joint.g.point.fromPolar(width / 2, Math.PI + angle, center);\n        return [start.x, start.y, end.x, end.y];\n      },\n      drawPattern: function drawPattern(ctx, from, to, width, gradient) {\n        ctx.beginPath();\n        ctx.moveTo(from.x, from.y);\n        ctx.lineTo(to.x, to.y);\n        ctx.stroke();\n        ctx.closePath();\n        ctx.beginPath();\n        ctx.strokeStyle = \"white\";\n        ctx.lineWidth = width - 2;\n        ctx.moveTo(from.x, from.y);\n        ctx.lineTo(to.x, to.y);\n        ctx.stroke();\n        ctx.closePath();\n      }\n    });\n    /**\n     * 新建组态视图\n     * @param {Object} callbackFun\n     */\n\n    var createConfigView = function createConfigView(callbackFun) {\n      $scope.configureInfo = {\n        viewId: 0,\n        viewTitle: '新建组态视图' + new Date().Format(\"yyyy-MM-dd\"),\n        viewType: 'configure',\n        template: {\n          type: 0\n        },\n        domainPath: '',\n        description: ''\n      };\n      var dialog = ngDialog.open({\n        template: '../partials/dialogue/configure_dia.html',\n        className: 'ngdialog-theme-plain',\n        scope: $scope\n      });\n      $scope.checkSameName($scope.configureInfo.viewTitle); // 模板、项目、普通之间的切换\n\n      var typeWatcher = function typeWatcher(n, o, s) {\n        var callback = function callback(event) {\n          var tree = event.data;\n          $scope.typeContents = [].concat(tree);\n        };\n\n        if (n < 2) {\n          callback({\n            data: $scope.treeAry\n          });\n        } else if (n == 2) {\n          if ($scope.getResourceByModelId) {\n            callback($scope.getResourceByModelId);\n          } else {\n            resourceUIService.getResourceByModelId(302, function (event) {\n              $scope.getResourceByModelId = event;\n              callback(event);\n            });\n          }\n\n          ;\n        }\n      };\n\n      $scope.$watch(\"configureInfo.template.type\", typeWatcher); //保存按钮\n\n      $scope.saveData = function () {\n        if (!$scope.configureInfo.template.resourceId || $scope.configureInfo.template.resourceId == 0) {\n          $scope.configureInfo.template = null;\n        } else {\n          if ($scope.configureInfo.template.type == 1) {\n            $scope.configureInfo.template.resourceType = \"device\";\n          } else {\n            $scope.configureInfo.template.resourceType = \"project\";\n          }\n        }\n\n        viewFlexService.addView($scope.configureInfo, function (returnObj) {\n          if (returnObj.code == 0) {\n            var viewId = returnObj.data.viewId;\n\n            if (dialog) {\n              dialog.close();\n              $('#' + dialog.id).remove();\n            }\n\n            growl.success(\"保存成功\");\n            location.href = \"index.html#/configure/\" + viewId;\n            /** 不使用回调方式，直接刷新了URL\n            if(callbackFun) {\n              callbackFun(returnObj.data.viewId);\n            }\n            growl.success(\"保存成功\")\n            */\n          }\n        });\n      };\n\n      $scope.closeDialog = function () {\n        if (dialog) {\n          dialog.close();\n          $('#' + dialog.id).remove();\n          window.history.back();\n        }\n      };\n    };\n    /**\n     * 更新组件的状态\n     */\n\n\n    $scope.updateCellHandler = function () {\n      if (inspector) {\n        if (inspector.getModel().collection) {\n          inspector.updateCell();\n        }\n      }\n    };\n    /**\n     * 右边栏控制\n     * @param {Object} status\n     */\n\n\n    var inspectorStatus = function inspectorStatus(status) {\n      $scope.selectedView.inspector = false;\n      $scope.$applyAsync();\n      $.AdminLTE.controlSidebar.openOrClose(status);\n    };\n\n    $scope.viewConfigClick = function () {\n      $scope.selectedView.inspector = true;\n      $scope.$applyAsync();\n    };\n    /********以下是划线的功能********/\n\n\n    var creatingLine = false;\n    var lineCoords = {\n      source: {},\n      target: {}\n    };\n    var tempLine;\n    var tempLines = [];\n    $(document.body).on('mousemove', function (evt) {\n      if (creatingLine) {\n        evt.preventDefault();\n        evt.stopPropagation();\n        evt = joint.util.normalizeEvent(evt);\n        var clientCoords = paper.snapToGrid({\n          x: evt.clientX,\n          y: evt.clientY\n        });\n        lineCoords.x2 = clientCoords.x;\n        lineCoords.y2 = clientCoords.y;\n        var d = 'M ' + lineCoords.x1 + ' ' + lineCoords.y1 + ' L ' + lineCoords.x2 + ' ' + lineCoords.y2;\n        tempLine.attr('d', d);\n      }\n    });\n    /********以上是划线的功能********/\n\n    /**\n     * 主动添加组件的处理\n     * @param {Object} cell\n     */\n\n    var addCellhandler = function addCellhandler(cell) {\n      if (cell.get(\"extend\") == \"copy\") {\n        var parentCell = JSON.parse(cell.get(\"parentCell\"));\n        var embedObjs = JSON.parse(cell.get(\"embedObjs\"));\n        var parentCellPos = cell.get(\"position\");\n        var oldParentCellPos = parentCell.position;\n        cell.remove();\n        parentCell.id = joint.util.uuid();\n        parentCell.embeds = [];\n        parentCell.z = graph.getLastCell() ? (Number(graph.getLastCell().get('z')) || 0) + 1 : 1;\n        if (parentCell.z > Number.MAX_VALUE) parentCell.z = Number.MAX_VALUE;\n        parentCell.position = parentCellPos;\n\n        if (embedObjs) {\n          for (var i = 0; i < embedObjs.length; i++) {\n            var embedobj = embedObjs[i];\n            embedobj.id = joint.util.uuid();\n            parentCell.embeds.push(embedobj.id);\n            embedobj.parent = parentCell.id;\n            embedobj.position.x = embedobj.position.x - oldParentCellPos.x + parentCellPos.x;\n            embedobj.position.y = embedobj.position.y - oldParentCellPos.y + parentCellPos.y;\n            embedobj.z = parentCell.z + i + 1;\n            if (embedobj.z > Number.MAX_VALUE) embedobj.z = Number.MAX_VALUE;\n            graph.addCell(embedobj);\n          }\n\n          ;\n        }\n\n        graph.addCell(parentCell);\n      } else if (typeof cell.get(\"z\") == \"string\") {\n        var newCell = cell.clone();\n        newCell.unset(\"z\");\n        newCell.attributes.z = graph.getLastCell() ? (Number(graph.getLastCell().get('z')) || 0) + 1 : 1;\n        if (newCell.attributes.z > Number.MAX_VALUE) newCell.attributes.z = Number.MAX_VALUE;\n        cell.remove();\n        graph.addCell(newCell);\n      }\n    };\n    /**\n     * 组态核心功能代码区域，基于Rappid,包括\n     * initializePaper\n     * initializeStencil\n     * initializeSelection\n     * initializeHaloAndInspector\n     * initializeNavigator\n     * initializeClipboard\n     * initializeMyCommandManager\n     * initializeCommandManager\n     * toolTips\n     * initView\n     * initAlertIconfunction\n     */\n\n\n    $scope.initialization = [// Create a graph, paper and wrap the paper in a PaperScroller.\n    // 创建一个图层，页面和包裹页面的页面控制层\n    function initializePaper(scope, element) {\n      var interactive = false;\n\n      if (!displayMode) {\n        interactive = true;\n      }\n\n      $scope.graph = graph = new joint.dia.Graph();\n      /**setTimeout(function(){\n        var graphwatcher = function(n,o, s){\n          console.log(\"graphwatcher\");\n        }\n        $scope.$watch(\"graph\", graphwatcher, true);\n      }, 5000);*/\n\n      paper = new joint.dia.Paper({\n        //          el: $('.paper-container'),\n        width: 1200,\n        height: 700,\n        gridSize: 10,\n        perpendicularLinks: true,\n        model: graph,\n        markAvailable: true,\n        interactive: interactive,\n        defaultLink: new joint.dia.Link({\n          attrs: {\n            '.marker-source': {\n              d: 'M 10 0 L 0 5 L 10 10 z',\n              transform: 'scale(0.001)'\n            },\n            '.marker-target': {\n              d: 'M 10 0 L 0 5 L 10 10 z'\n            },\n            '.connection': {\n              stroke: 'black'\n            }\n          }\n        }),\n        linkConnectionPoint: joint.util.shapePerimeterConnectionPoint,\n        linkView: PatternLinkView.extend({\n          drawPattern: function drawPattern(ctx, from, to, width, gradient) {\n            var innerWidth = width - 4;\n            var outerWidth = width;\n            var buttFrom = joint.g.point(from).move(to, -outerWidth / 2);\n            var buttTo = joint.g.point(to).move(from, -outerWidth / 2);\n            var lineColor = \"blue\";\n\n            if (this.model.get(\"attrs\") && this.model.get(\"attrs\")[\".connection\"]) {\n              lineColor = this.model.get(\"attrs\")[\".connection\"][\"stroke\"] ? this.model.get(\"attrs\")[\".connection\"][\"stroke\"] : lineColor;\n            }\n\n            gradient.addColorStop(0.300, lineColor);\n            var patternColor = \"#ffffff\";\n\n            if (this.model.get(\"patternColor\")) {\n              patternColor = this.model.get(\"patternColor\");\n            }\n\n            gradient.addColorStop(0.500, patternColor);\n            gradient.addColorStop(0.700, lineColor);\n            ctx.beginPath();\n            ctx.lineWidth = innerWidth;\n            ctx.strokeStyle = gradient;\n            ctx.moveTo(from.x, from.y);\n            ctx.lineTo(to.x, to.y);\n            ctx.stroke();\n            ctx.closePath();\n          }\n        })\n      });\n      paperScroller = new joint.ui.PaperScroller({\n        paper: paper,\n        autoResizePaper: displayMode,\n        padding: 0\n      });\n\n      if (!displayMode) {\n        snapLines = new joint.ui.Snaplines({\n          paper: paper\n        });\n      }\n\n      ;\n      $('.paper-container', element).append(paperScroller.el);\n      scope.components.paper = paper;\n      scope.components.scroller = paperScroller;\n      scope.components.graph = graph;\n      scope.data.paperscorllerW = $('.paper-scroller').width();\n      graph.on('add', function (cell, collection, opt) {\n        addCellhandler(cell);\n      });\n\n      if ($routeParams.type == 'service') {\n        $(paperScroller.el).css(\"overflow\", \"hidden\");\n        $(paperScroller.el).css(\"width\", \"auto\");\n        $(paperScroller.el).css(\"height\", \"auto\");\n      } else {\n        $('.paper-echart-container').scroll(function () {\n          $('.paper-scroller').scrollTop($('.paper-echart-container').scrollTop());\n        });\n        $('.paper-scroller').scroll(function () {\n          $('.paper-echart-container').scrollTop($('.paper-scroller').scrollTop());\n        });\n      }\n    }, // Create stencil.\n    // 创建模板\n    function initializeStencil(scope, element) {\n      function layout(graph) {\n        joint.layout.GridLayout.layout(graph, {\n          columnWidth: (stencil.options.width - 10) / 2,\n          columns: 2,\n          rowHeight: 90,\n          resizeToFit: false,\n          dy: 10,\n          dx: 0\n        });\n      }\n\n      stencil = new joint.ui.Stencil({\n        graph: graph,\n        paper: paper,\n        width: 230,\n        dropAnimation: true,\n        groups: scope.data.stencil.groups,\n        search: scope.data.stencil.search\n      }).on('filter', layout);\n\n      stencil.renderSearch = function () {\n        return $('<div class=\"sidebar-form\"><input placeholder=\"搜索...\" type=\"search\" class=\"search form-control\"/></div>');\n      };\n\n      $('.stencil-container', element).append(stencil.render().el);\n\n      _.each(scope.data.stencil.shapes, function (shapes, groupName) {\n        stencil.load(shapes, groupName);\n        layout(stencil.getGraph(groupName));\n        stencil.getPaper(groupName).fitToContent(1, 1, 10);\n      });\n\n      stencil.closeGroups();\n      scope.components.layout = layout;\n      scope.components.stencil = stencil;\n    }, // Create Selection\n    // 创建选择\n    function initializeSelection(scope, element) {\n      selection = new Backbone.Collection();\n      selectionView = new joint.ui.SelectionView({\n        paper: paper,\n        graph: graph,\n        model: selection\n      }); // Initiate selecting when the user grabs the blank area of the paper while the Shift key is pressed.\n      // 当shift键被按下时，启动用户在页面的空白区域时开始选择。\n      // Otherwise, initiate paper pan.\n      // 否则，页面默认功能\n\n      paper.on('blank:pointerdown', function (evt, x, y) {\n        inspectorStatus(false);\n\n        if (scope.data.drawStatus) {\n          var createLine = function createLine() {\n            var d = 'M ' + x + ' ' + y + ' L ' + x + ' ' + y;\n\n            if (tempLine) {\n              tempLines.push(tempLine);\n            }\n\n            tempLine = joint.V('path', {\n              stroke: 'black',\n              'stroke-width': 1,\n              d: d\n            });\n            joint.V(paper.viewport).append(tempLine);\n\n            if (!creatingLine) {\n              lineCoords.source = {\n                x: x,\n                y: y\n              };\n            } else {\n              if (!lineCoords.vertices) lineCoords.vertices = [];\n              lineCoords.vertices.push({\n                x: x,\n                y: y\n              });\n            }\n\n            creatingLine = true;\n            lineCoords.x1 = x;\n            lineCoords.y1 = y;\n          };\n\n          if (3 != evt.which) {\n            createLine();\n          } else {\n            if (creatingLine) {\n              createLine();\n              lineCoords.target = {\n                x: x,\n                y: y\n              };\n              var tmplink = new joint.dia.Link({\n                source: lineCoords.source,\n                target: lineCoords.target,\n                vertices: lineCoords.vertices,\n                attrs: {}\n              });\n              graph.addCell([tmplink]);\n              creatingLine = false;\n              lineCoords = {\n                source: {},\n                target: {}\n              };\n              tempLines.forEach(function (line) {\n                line.remove();\n              });\n              tempLines = [];\n              tempLine = null;\n              scope.$apply(function () {\n                scope.data.drawStatus = false;\n              });\n            }\n          }\n        } else {\n          if (shiftHold) {\n            selectionView.startSelecting(evt, x, y);\n          } else {\n            selectionView.cancelSelection();\n            paperScroller.startPanning(evt, x, y);\n            /* 这里暂时取消了。因为涉及到组态对象拖动时不能变化的问题\n            if(inspector && inspector.options.cell === $scope.selectedItem.cell) {\n              if(inspector.getModel().collection) {\n                inspector.updateCell();\n              }\n              inspector.remove();\n            }\n            */\n          }\n        }\n      });\n      paper.on('cell:pointerdown', function (cellView, evt) {\n        // Select an element if CTRL/Meta key is pressed while the element is clicked.\n        // 如果Ctrl /Meta 键是被按下，当元素被点击时，添加到selectionBox中\n        if ((evt.ctrlKey || evt.metaKey) && !(cellView.model instanceof joint.dia.Link)) {\n          selectionView.createSelectionBox(cellView);\n          selection.add(cellView.model);\n        }\n      });\n      selectionView.on('selection-box:pointerdown', function (evt) {\n        // Unselect an element if the CTRL/Meta key is pressed while a selected element is clicked.\n        // 取消之前的效果\n        if (evt.ctrlKey || evt.metaKey) {\n          var cell = selection.get($(evt.target).data('model'));\n          selectionView.destroySelectionBox(paper.findViewByModel(cell));\n          selection.reset(selection.without(cell));\n        }\n      }); // Disable context menu inside the paper.\n      // 取消HTML默认页面菜单\n      // This prevents from context menu being shown when selecting individual elements with Ctrl in OS X.\n\n      paper.el.oncontextmenu = function (evt) {\n        evt.preventDefault();\n      };\n\n      keyboardJS.on('delete, backspace', function (evt) {\n        if (!$.contains(evt.target, paper.el)) {\n          // remove selected elements from the paper only if the target is the paper\n          return;\n        }\n\n        commandManager.initBatchCommand();\n        selection.invoke('remove');\n        commandManager.storeBatchCommand();\n        selectionView.cancelSelection();\n\n        if (backspaceHold && !$(evt.target).is(\"input, textarea\")) {\n          // Prevent Backspace from navigating back.\n          evt.preventDefault();\n        }\n      });\n    }, // Halo, FreeTransfrom  & Inspector\n    // 元素控制器，自由转换和属性\n    function initializeHaloAndInspector(scope, element) {\n      function openCellTools(cellView) {\n        var $inspectorHolder = $('#control-sidebar-settings-data', element);\n        var $inspectorHolder_text = $('#control-sidebar-settings-text', element);\n        var $inspectorHolder_presentation = $('#control-sidebar-settings-presentation', element);\n        var $inspectorHolder_geometry = $('#control-sidebar-settings-geometry', element);\n        var cell = cellView.model || cellView;\n        var halo;\n\n        if (displayMode) {\n          if (!cellsDic[cell.id]) cellsDic[cell.id] = jQuery.extend(true, {}, cell.attributes);\n          var subViewState = cell.get('subViewId') && cell.get('subViewId') != \"number:0\" && cell.get('subViewId') != \"?\";\n          var nodeState = cell.get('nodeId') && cell.get('nodeId') != \"number:0\" && cell.get('nodeId') != \"?\";\n\n          if (subViewState == null || nodeState == null) {\n            cell.attributes = cellsDic[cell.id];\n            subViewState = cell.get('subViewId') && cell.get('subViewId') != \"number:0\" && cell.get('subViewId') != \"?\";\n            nodeState = cell.get('nodeId') && cell.get('nodeId') != \"number:0\" && cell.get('nodeId') != \"?\";\n          }\n\n          if (subViewState || nodeState) {\n            halo = new joint.ui.Halo({\n              cellView: cellView,\n              type: 'toolbar'\n            }).render();\n            halo.removeHandles();\n          }\n\n          if (nodeState) {\n            var dirNodeId; //指令设备对象\n\n            var dirModelId; //设备对象模板\n\n            var nodeIdAry = cell.get('nodeId').toString().split(\":\");\n            if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] != '?') dirNodeId = Number(nodeIdAry[nodeIdAry.length - 1]);\n            var modelIdAry = cell.get('modelId').toString().split(\":\");\n            if (modelIdAry.length > 0 && modelIdAry[modelIdAry.length - 1] != '?') dirModelId = Number(modelIdAry[modelIdAry.length - 1]);\n            var dirModel = resourceUIService.rootModelDic[dirModelId];\n            var dirSn = cell.get('sn');\n            $scope.selectedItem[\"nodeId\"] = dirNodeId;\n            halo.addHandle({\n              name: 'alertaction',\n              position: 's',\n              icon: 'images/alert.svg'\n            });\n            halo.on('action:alertaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              window.open(\"../app-oc/index.html#/configAlert/\" + dirNodeId + \"/node\");\n            });\n            halo.addHandle({\n              name: 'chartaction',\n              position: 's',\n              icon: 'images/chart.svg'\n            });\n            halo.on('action:chartaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              window.open(\"../app-oc/index.html#/emcsView/\" + dirNodeId);\n            });\n            halo.addHandle({\n              name: 'infoaction',\n              position: 's',\n              icon: 'images/info.svg'\n            });\n            halo.on('action:infoaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              window.open(\"../app-oc/index.html#/facility/sn/\" + dirSn);\n            });\n            halo.addHandle({\n              name: 'configaction',\n              position: 's',\n              icon: 'images/config.svg'\n            });\n            halo.on('action:configaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              if (dirModel && dirModel.category == \"Device\") window.open(\"../app-oc/index.html#/resource_type/\" + dirModelId + \"/0\");else window.open(\"../app-oc/index.html#/resourcegroup/\" + dirModelId + \"/0\");\n            });\n\n            if (cell.get('directiveIds')) {\n              halo.addHandle({\n                name: 'directiveaction',\n                position: 's',\n                icon: 'images/directive.svg'\n              });\n              halo.on('action:directiveaction:pointerdown', function (evt) {\n                evt.stopPropagation();\n                inspectorStatus(true);\n                var directiveList = [];\n                cell.get('directiveIds').forEach(function (directiveId) {\n                  if (typeof directiveId != \"number\") {\n                    var ary = directiveId.split(\":\");\n                    directiveId = Number(ary[ary.length - 1]);\n                  }\n\n                  dirModel.directives.forEach(function (dirObj) {\n                    if (directiveId == dirObj.id) {\n                      directiveList.push(dirObj);\n                    }\n                  });\n                });\n                $scope.directiveList = directiveList;\n                $scope.$apply();\n              });\n            }\n\n            if (cell.get('valueConfig')) {\n              var isSend = false; //是否发送过\n\n              $scope.valueLevels = cell.get('valueConfig');\n\n              if ($scope.valueLevels && dirModel) {\n                $scope.valueLevels.forEach(function (valueLvevel) {\n                  if (valueLvevel.stateDisplay && valueLvevel.valueDirective && valueLvevel.valueDirectiveAttr) {\n                    isSend = true;\n                    dirModel.directives.forEach(function (dirObj) {\n                      if (valueLvevel.valueDirective == dirObj.id) {\n                        dirObj.value = valueLvevel.valueDirectiveAttr;\n                        $scope.sendItemDir(dirObj, dirNodeId);\n                      }\n                    });\n                  }\n                });\n\n                if (!isSend && $scope.valueLevels[0].valueDirective && $scope.valueLevels[0].valueDirectiveAttr) {\n                  dirModel.directives.forEach(function (dirObj) {\n                    if ($scope.valueLevels[0].valueDirective == dirObj.id) {\n                      dirObj.value = $scope.valueLevels[0].valueDirectiveAttr;\n                      $scope.sendItemDir(dirObj, dirNodeId);\n                    }\n                  });\n                }\n              }\n            }\n          }\n\n          if (subViewState) {\n            var dirSubViewId;\n            var subViewIdAry = cell.get('subViewId').toString().split(\":\");\n            if (subViewIdAry.length > 0 && subViewIdAry[subViewIdAry.length - 1] != '?') dirSubViewId = Number(subViewIdAry[subViewIdAry.length - 1]);\n            halo.addHandle({\n              name: 'nextaction',\n              position: 's',\n              icon: 'images/subview.svg'\n            });\n            halo.on('action:nextaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n\n              if ($routeParams.type == 'service') {\n                loc.path(\"display/\" + dirSubViewId + \"/service\");\n              } else {\n                if (dirSubViewId > 0) {\n                  SwSocket.unregister(uuid);\n                  uuid = Math.uuid();\n                  scope.data.viewRoutes.push($scope.selectedView);\n                  showViewContent(scope, dirSubViewId);\n                }\n              }\n            });\n          }\n\n          return;\n        } else {\n          if (scope.components.commander.configDispaly) inspectorStatus(true);\n          halo = new joint.ui.Halo({\n            cellView: cellView\n          }).render();\n\n          halo.options.clone = function (cell, opt) {\n            var cloneCell = cell.clone();\n            var z = (Number(graph.getLastCell().get('z')) || 0) + 1;\n            cloneCell.attributes[\"z\"] = z;\n            cloneCell.prop(\"z\", z);\n            cloneCell.unset(\"parent\");\n            return cloneCell;\n          };\n\n          if (cell.get(\"alertConfig\")) {\n            $scope.alertLevels = cell.get(\"alertConfig\");\n          } else {\n            $scope.alertLevels = [{\n              label: '正常',\n              id: 0\n            }, {\n              label: '警告',\n              id: 1\n            }, {\n              label: '次要',\n              id: 2\n            }, {\n              label: '重要',\n              id: 3\n            }, {\n              label: '严重',\n              id: 4\n            }];\n          }\n\n          if (cell.get(\"valueConfig\")) {\n            $scope.valueLevels = cell.get(\"valueConfig\");\n          } else {\n            $scope.valueLevels = [{\n              label: '第一组数据',\n              id: 0,\n              stateDisplay: true\n            }, {\n              label: '第二组数据',\n              id: 1,\n              stateDisplay: false\n            }, {\n              label: '第三组数据',\n              id: 2,\n              stateDisplay: false\n            }, {\n              label: '第四组数据',\n              id: 3,\n              stateDisplay: false\n            }, {\n              label: '第五组数据',\n              id: 4,\n              stateDisplay: false\n            }];\n          }\n\n          if (cell.attributes.embeds && cell.attributes.embeds.length > 0) {\n            halo.addHandle({\n              name: 'embedsaction',\n              position: 's',\n              icon: 'images/info.svg'\n            });\n            halo.addHandle({\n              name: 'copyaction',\n              position: 'w',\n              icon: 'images/print.png'\n            });\n\n            var extendHalohandler = function extendHalohandler(flg) {\n              var embeds = [];\n              var embedObjs = [];\n\n              if ($scope.selectedItem.cell.attributes.embeds) {\n                var parentCell = $scope.selectedItem.cell.clone();\n                parentCell.id = joint.util.uuid();\n                parentCell.attributes.id = parentCell.id;\n                parentCell.attributes.parent = \"\";\n                parentCell.attributes.z = graph.getLastCell() ? (Number(graph.getLastCell().get('z')) || 0) + 1 : 1;\n                var i = 1;\n                $scope.selectedItem.cell.attributes.embeds.forEach(function (cellid) {\n                  var cloneCell = graph.getCell(cellid).clone();\n                  cloneCell.id = joint.util.uuid();\n                  cloneCell.attributes.id = cloneCell.id;\n                  cloneCell.attributes.parent = parentCell.id;\n                  cloneCell.attributes.z = parentCell.attributes.z + i;\n                  embeds.push(cloneCell.id);\n\n                  if (flg == \"embedsaction\") {\n                    graph.addCell(cloneCell);\n                  } else if (flg == \"copyaction\") {\n                    embedObjs.push(cloneCell);\n                  }\n\n                  i++;\n                });\n                parentCell.attributes.embeds = embeds;\n\n                if (flg == \"embedsaction\") {\n                  graph.addCell(parentCell);\n                } else if (flg == \"copyaction\") {\n                  var copyactionhandler = function copyactionhandler(dataURL) {\n                    var imageWidth = 60;\n                    var imageHeight = 60;\n                    var pjson = parentCell.toJSON();\n                    var tmpcopy = {\n                      \"type\": \"basic.Image\",\n                      \"extend\": \"copy\",\n                      \"parentCell\": JSON.stringify(pjson),\n                      \"embedObjs\": JSON.stringify(embedObjs),\n                      \"size\": {\n                        \"width\": imageWidth,\n                        \"height\": imageHeight\n                      },\n                      \"attrs\": {\n                        \"image\": {\n                          \"width\": imageWidth,\n                          \"height\": imageHeight,\n                          \"xlink:href\": dataURL\n                        },\n                        \"text\": {\n                          \"text\": pjson.attrs.text.text,\n                          \"font-size\": 12,\n                          \"stroke\": \"#000000\",\n                          \"display\": \"block\",\n                          \"stroke-width\": 0,\n                          \"fill\": \"#000000\",\n                          \"ref-dy\": 10,\n                          \"font-family\": \"Microsoft YaHei\"\n                        }\n                      }\n                    };\n                    $scope.$parent.configCustoms.push(tmpcopy);\n                    scope.components.stencil.load($scope.$parent.configCustoms, \"enterprise\");\n                    scope.components.layout(stencil.getGraph(\"enterprise\"));\n                    scope.components.stencil.getPaper(\"enterprise\").fitToContent(1, 1, 10);\n                    var newconfig = {\n                      key: \"\",\n                      value: JSON.stringify(tmpcopy),\n                      groupName: \"ConfigurationCustom\",\n                      keyDesc: \"\",\n                      invalid: false,\n                      canDelete: true,\n                      domainPath: \"\",\n                      id: 0,\n                      label: pjson.attrs.text.text\n                    };\n                    configUIService.saveConfig(newconfig, function (returnObj) {});\n                  };\n\n                  paper.toPNG(function (dataURL) {\n                    copyactionhandler(dataURL);\n                  }, {\n                    padding: 0\n                  });\n                }\n              }\n            };\n\n            halo.on('action:embedsaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              extendHalohandler(\"embedsaction\");\n            });\n            halo.on('action:copyaction:pointerdown', function (evt) {\n              evt.stopPropagation();\n              extendHalohandler(\"copyaction\");\n            });\n          }\n\n          ;\n          /** 去掉Text的resize按钮 */\n\n          if (cell.get(\"type\") == \"basic.Text\") {\n            halo.removeHandle('resize');\n          }\n          /** freeTransform，halo已经具有该功能*/\n\n\n          if (cell.get(\"type\") != \"link\") {\n            var freeTransform = new joint.ui.FreeTransform({\n              cellView: cellView\n            }).render();\n          }\n        }\n\n        if ($scope.selectedItem.cell && $scope.selectedItem.cell.id == cell.id) return;\n        var selectedItem = {\n          modelId: $scope.selectedView.template && $scope.selectedView.template.resourceType == \"device\" ? $scope.selectedView.template.resourceId : 0,\n          nodeId: 0,\n          kpiId: 0,\n          subViewId: 0,\n          echartViewId: 0,\n          kpis: [],\n          nodes: [],\n          cell: cell,\n          stateId: 0,\n          selectType: -1,\n          domainPath: $scope.selectedView.domainPath,\n          nodeIds: [],\n          directives: [],\n          stateType: 0,\n          unitType: 0,\n          z: 0,\n          extendDomainid: 0\n        };\n        /**\n        if(cell.get(\"type\") == \"kpis\"){\n         }**/\n\n        selectedItem.dataItem = cell.attributes[\"dataItem\"]; //获得组件图层\n\n        if (cell.get('z')) {\n          var zTypeAry = cell.get('z').toString().split(\":\");\n          if (zTypeAry.length > 0 && zTypeAry[zTypeAry.length - 1] != '?') selectedItem.z = Number(zTypeAry[zTypeAry.length - 1]);\n        } //获得设备选择方式\n\n\n        if (cell.get('selectType')) {\n          var selectTypeAry = cell.get('selectType').toString().split(\":\");\n          if (selectTypeAry.length > 0 && selectTypeAry[selectTypeAry.length - 1] != '?') selectedItem.selectType = Number(selectTypeAry[selectTypeAry.length - 1]);\n        }\n\n        if (cell.get(\"type\") == \"chart.Plot\") {\n          if (cell.get('echartViewId')) {\n            var echartViewIdAry = cell.get('echartViewId').toString().split(\":\");\n            if (echartViewIdAry.length > 0 && echartViewIdAry[echartViewIdAry.length - 1] != '?') selectedItem.echartViewId = Number(echartViewIdAry[echartViewIdAry.length - 1]);\n          }\n\n          if (cell.get('tabsInfo')) {\n            selectedItem.tabsInfo = cell.get('tabsInfo');\n          }\n\n          if (cell.get('nodeIds')) {\n            var nodeIdsAry = [];\n            cell.get('nodeIds').forEach(function (nodeItem) {\n              var ary = nodeItem.toString().split(\":\");\n              nodeIdsAry.push(Number(ary[ary.length - 1]));\n            });\n            selectedItem.nodeIds = nodeIdsAry;\n          }\n        } else {\n          if (cell.get('kpiId')) {\n            var kpiIdAry = cell.get('kpiId').toString().split(\":\");\n            if (kpiIdAry.length > 0 && kpiIdAry[kpiIdAry.length - 1] != '?') selectedItem.kpiId = Number(kpiIdAry[kpiIdAry.length - 1]);\n          }\n\n          if (cell.get('nodeId')) {\n            var nodeIdAry = cell.get('nodeId').toString().split(\":\");\n            if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] != '?') selectedItem.nodeId = Number(nodeIdAry[nodeIdAry.length - 1]);\n          }\n\n          if (cell.get('subViewId')) {\n            var subViewIdAry = cell.get('subViewId').toString().split(\":\");\n            if (subViewIdAry.length > 0 && subViewIdAry[subViewIdAry.length - 1] != '?') selectedItem.subViewId = Number(subViewIdAry[subViewIdAry.length - 1]);\n          }\n\n          if (cell.get('stateId')) {\n            var stateIdAry = cell.get('stateId').toString().split(\":\");\n            if (stateIdAry.length > 0 && stateIdAry[stateIdAry.length - 1] != '?') selectedItem.stateId = Number(stateIdAry[stateIdAry.length - 1]);\n          }\n\n          if (cell.get('stateType')) {\n            var stateTypeAry = cell.get('stateType').toString().split(\":\");\n            if (stateTypeAry.length > 0 && stateTypeAry[stateTypeAry.length - 1] != '?') selectedItem.stateType = Number(stateTypeAry[stateTypeAry.length - 1]);\n          }\n\n          if (cell.get('unitType')) {\n            var unitTypeAry = cell.get('unitType').toString().split(\":\");\n            if (unitTypeAry.length > 0 && unitTypeAry[unitTypeAry.length - 1] != '?') selectedItem.unitType = Number(unitTypeAry[unitTypeAry.length - 1]);\n          }\n\n          if (cell.get('sn')) {\n            selectedItem.sn = cell.get('sn');\n          }\n\n          if (cell.get('extendDomainId')) {\n            var extenDomainAry = cell.get('extendDomainId').toString().split(\":\");\n            if (extenDomainAry.length > 0 && extenDomainAry[extenDomainAry.length - 1] != '?') selectedItem.extendDomainId = Number(extenDomainAry[extenDomainAry.length - 1]);\n          } //            if(cell.get('extendDomains')) {\n          //              selectedItem.extendDomains = cell.get('extendDomains');\n          //            }\n\n\n          if (cell.get('directiveIds')) {\n            var directivesAry = [];\n            cell.get('directiveIds').forEach(function (directiveItem) {\n              var ary = directiveItem.toString().split(\":\");\n              directivesAry.push(Number(ary[ary.length - 1]));\n            });\n            selectedItem.directiveIds = directivesAry;\n          }\n\n          if (cell.get('kpiIds')) {\n            var kpisAry = [];\n            cell.get('kpiIds').forEach(function (kpiItem) {\n              var ary = kpiItem.toString().split(\":\");\n              kpisAry.push(Number(ary[ary.length - 1]));\n            });\n            selectedItem.kpiIds = kpisAry;\n          }\n        }\n\n        if (selectedItem.selectType) {\n          //selectType不使用\n          if (cell.get('domainPath')) {\n            var domainPathAry = cell.get('domainPath').toString().split(\":\");\n            if (domainPathAry.length > 0 && domainPathAry[domainPathAry.length - 1] != '?') selectedItem.domainPath = domainPathAry[domainPathAry.length - 1];\n          }\n\n          if (cell.get('modelId')) {\n            var modelIdAry = cell.get('modelId').toString().split(\":\");\n            if (modelIdAry.length > 0 && modelIdAry[modelIdAry.length - 1] != '?') selectedItem.modelId = Number(modelIdAry[modelIdAry.length - 1]);\n          }\n\n          if ($scope.selectedView.template && $scope.selectedView.template.resourceType == 'project') {\n            var projectId = $scope.selectedView.template.resourceId;\n\n            if ($scope.selectedView.temp.domains) {\n              selectedItem.domainPath = $scope.selectedView.temp.domains;\n              $scope.selectedItem = jQuery.extend(true, {}, selectedItem);\n              $scope.domainAndModelChangeHandler(selectedItem);\n            } else {\n              resourceUIService.getResourceById(projectId, function (event) {\n                $scope.selectedView.temp.domains = event.data.domainPath;\n                selectedItem.domainPath = $scope.selectedView.temp.domains;\n                $scope.selectedItem = jQuery.extend(true, {}, selectedItem);\n                $scope.domainAndModelChangeHandler(selectedItem);\n              });\n            }\n          } else {\n            $scope.selectedItem = jQuery.extend(true, {}, selectedItem);\n            $scope.domainAndModelChangeHandler(selectedItem);\n          }\n        } // No need to re-render inspector if the cellView didn't change. 强制刷新\n\n\n        if (!inspector || inspector.options.cell !== cell || true) {\n          if (inspector) {\n            if (inspector.getModel().collection) {\n              // update cell if the model is still in the graph\n              inspector.updateCell();\n            } // Clean up the old inspector if there was one.\n\n\n            inspector.remove();\n          }\n\n          var inspectorDefs = scope.inspectorDefs[cell.get('type')];\n          var inputs = inspectorDefs ? inspectorDefs.inputs ? inspectorDefs.inputs : scope.commonInspectorInputs : scope.commonInspectorInputs;\n          var groups = inspectorDefs ? inspectorDefs.groups ? inspectorDefs.groups : scope.commonInspectorGroups : scope.commonInspectorGroups;\n\n          if (cell.get('extend') == \"alarm\") {\n            inputs = _.extend(inputs, scope.extendAlertInputs);\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"value\") {\n            inputs = _.extend(inputs, scope.extendValueInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n          } else if (cell.get('extend') == \"kpis\") {\n            inputs = _.extend(inputs, scope.commonInspectorInputsKpis);\n          } else if (cell.get('extend') == \"instance\") {\n            inputs = _.extend(inputs, scope.commonInspectorInstance);\n            delete inputs.domainPath;\n            delete inputs.subViewId;\n            delete inputs.directiveIds;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"level\") {\n            inputs = _.extend({}, scope.levelInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"domain\") {\n            inputs = _.extend({}, scope.domainInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"switch\") {\n            inputs = _.extend({}, scope.switchInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else if (cell.get('extend') == \"openangle\") {\n            inputs = _.extend({}, scope.openAngleInputs);\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          } else {\n            delete inputs.alertIcon;\n            delete inputs.alertLevel;\n            delete inputs.alertText;\n            delete inputs.valueIcon;\n            delete inputs.valueLevel;\n            delete inputs.valueText;\n            delete inputs.valueDirective;\n            delete inputs.valueDirectiveAttr;\n          }\n\n          inspector = new joint.ui.Inspector({\n            inputs: inputs,\n            groups: groups,\n            cell: cell\n          }).on('render', function () {\n            this.$('[data-tooltip]').each(function () {\n              var $label = $(this);\n              new joint.ui.Tooltip({\n                target: $label,\n                content: $label.data('tooltip'),\n                right: '.inspector',\n                direction: 'right'\n              });\n            });\n          });\n          var el = inspector.render().el;\n\n          for (var i = 0; i < el.children.length; i++) {\n            $(el.children[i]).wrap(\"<div class='inspector'></div>\");\n          }\n\n          $inspectorHolder_geometry.html(el.children[3]);\n          $inspectorHolder_presentation.html(el.children[2]);\n          $inspectorHolder_text.html(el.children[1]);\n          $inspectorHolder.html(el.children[0]);\n          $compile($inspectorHolder)($scope);\n          $compile($inspectorHolder_text)($scope);\n          $compile($inspectorHolder_presentation)($scope);\n          $compile($inspectorHolder_geometry)($scope);\n        }\n\n        $scope.nodeChangeHandler(); // adjust selection\n\n        selectionView.cancelSelection();\n        selection.reset([cellView.model]);\n      }\n\n      ;\n      paper.on('cell:pointerup', function (cellView) {\n        if (cellView.model instanceof joint.dia.Element && !selection.contains(cellView.model)) {\n          openCellTools(cellView);\n        }\n      });\n      paper.on('link:options', function (evt, cellView, x, y) {\n        openCellTools(cellView);\n      });\n    }, // Navigator\n    // 导航（没有使用）\n    function initializeNavigator(scope, element) {\n      return;\n      navigator = new joint.ui.Navigator({\n        width: 240,\n        height: 115,\n        paperScroller: paperScroller,\n        zoomOptions: {\n          max: 5,\n          min: 0.2\n        }\n      });\n      $('.navigator-container', element).append(navigator.el);\n      navigator.render();\n    }, // Clipboard\n    // 剪切板缩略显示（没有使用）\n    function initializeClipboard(scope, element) {\n      clipboard = new joint.ui.Clipboard();\n      keyboardJS.on('ctrl + shift + c', function () {\n        // Copy all selected elements and their associated links.\n        clipboard.copyElements(selection, graph, {\n          translate: {\n            dx: 20,\n            dy: 20\n          },\n          useLocalStorage: true\n        });\n      });\n      keyboardJS.on('ctrl + shift + v', function () {\n        selectionView.cancelSelection();\n        clipboard.pasteCells(graph, {\n          link: {\n            z: -1\n          },\n          useLocalStorage: true\n        }); // Make sure pasted elements get selected immediately. This makes the UX better as\n        // the user can immediately manipulate the pasted elements.\n\n        clipboard.each(function (cell) {\n          if (cell.get('type') === 'link') return; // Push to the selection not to the model from the clipboard but put the model into the graph.\n          // Note that they are different models. There is no views associated with the models\n          // in clipboard.\n\n          selection.add(graph.getCell(cell.id));\n          selectionView.createSelectionBox(paper.findViewByModel(cell));\n        });\n      });\n      keyboardJS.on('ctrl + x', function () {\n        var originalCells = clipboard.copyElements(selection, graph, {\n          useLocalStorage: true\n        });\n        commandManager.initBatchCommand();\n\n        _.invoke(originalCells, 'remove');\n\n        commandManager.storeBatchCommand();\n        selectionView.cancelSelection();\n      });\n    }, // Command Manager\n    // 个性化的命令\n    function initializeMyCommandManager(scope, element) {\n      var getGridBackgroundImage = function getGridBackgroundImage(gridSize, color) {\n        var canvas = $('<canvas/>', {\n          width: gridSize,\n          height: gridSize\n        });\n        canvas[0].width = gridSize;\n        canvas[0].height = gridSize;\n        var context = canvas[0].getContext('2d');\n        context.beginPath();\n        context.rect(1, 1, 1, 1);\n        context.fillStyle = color || '#AAAAAA';\n        context.fill();\n        return canvas[0].toDataURL('image/png');\n      };\n\n      scope.components.myCommander = {};\n\n      scope.components.myCommander.setDimensions = function () {\n        paper.setDimensions(paper.options.width, paper.options.height);\n        paperScroller.options.baseWidth = paper.options.width;\n        paperScroller.options.baseHeight = paper.options.height;\n        paperScroller.$el.css('padding-top', 0);\n        paperScroller.$el.css('padding-left', 0);\n      };\n\n      scope.components.myCommander.setGrid = function () {\n        var gridSize = paper.options.gridSize;\n        var backgroundImage = getGridBackgroundImage(gridSize);\n\n        if (scope.data.bgcolor) {\n          paper.$el.css('background-color', scope.data.bgcolor);\n        } else {\n          paper.$el.css('background-color', \"#fff\");\n        }\n\n        if (scope.data.bgimage) {\n          if (!displayMode) {\n            paper.$el.css('background-image', 'url(\"' + backgroundImage + '\"),url(\"' + scope.data.bgimage + '\")');\n          } else {\n            paper.$el.css('background-image', 'url(\"\"),url(\"' + scope.data.bgimage + '\")');\n          }\n        } else {\n          if (!displayMode) {\n            paper.$el.css('background-image', 'url(\"' + backgroundImage + '\")');\n          } else {\n            paper.$el.css('background-image', 'url(\"\"),url(\"\")');\n          }\n        }\n      };\n\n      $rootScope.save4Json = scope.components.myCommander.save4Json = function (callback) {\n        var viewjson = graph.toJSON();\n        $rootScope.dirty = false;\n\n        var callback = callback || function () {};\n\n        viewjson.gridSize = paper.options.gridSize;\n        viewjson.width = paper.options.width;\n        viewjson.height = paper.options.height;\n        viewjson.bgimage = scope.data.bgimage;\n        viewjson.bgcolor = scope.data.bgcolor;\n        var JSONstring = JSON.stringify(viewjson);\n\n        try {\n          var param = {\n            viewId: $scope.selectedView.viewId,\n            viewTitle: scope.data.viewTitle,\n            viewName: scope.data.viewTitle,\n            viewType: \"configure\",\n            content: JSONstring\n          };\n\n          if (param.viewId == 0) {\n            viewFlexService.addView(param, function (returnObj) {\n              if (returnObj.code == 0) {\n                $rootScope.dirty = false;\n                callback(\"success\");\n                growl.success(\"保存成功\");\n              }\n            });\n          } else {\n            viewFlexService.updateView(param, function (returnObj) {\n              if (returnObj.code == 0) {\n                callback(\"success\");\n                $rootScope.dirty = false;\n                growl.success(\"保存成功\");\n              }\n            });\n          }\n        } catch (err) {\n          callback(\"error\");\n          alert(err);\n        }\n      };\n    }, // Command Manager\n    // rappid内置命令\n    function initializeCommandManager(scope, element) {\n      if (displayMode) return;\n      /** 重载CommandManager类的push方法 */\n\n      joint.dia.CommandManager.prototype.push = function (cmd) {\n        if (typeof _events_['graphUpdated'] == \"function\") {\n          _events_['graphUpdated']();\n        }\n\n        ;\n        this.redoStack = [];\n\n        if (!cmd.batch) {\n          this.undoStack.push(cmd);\n          this.trigger('add', cmd);\n        } else {\n          this.lastCmdIndex = Math.max(this.lastCmdIndex, 0);\n          this.trigger('batch', cmd);\n        }\n      };\n      /** */\n\n\n      commandManager = new joint.dia.CommandManager({\n        graph: graph\n      });\n      keyboardJS.on('ctrl + z', function () {\n        commandManager.undo();\n        selectionView.cancelSelection();\n      });\n      keyboardJS.on('ctrl + y', function () {\n        commandManager.redo();\n        selectionView.cancelSelection();\n      });\n      commandManager.configDispaly = true;\n\n      commandManager.configDispalySet = function (flg) {\n        commandManager.configDispaly = flg;\n      };\n\n      commandManager.alignAction = function (flg) {\n        commandManager.initBatchCommand();\n        var align;\n        selectionView.model.models.forEach(function (cell) {\n          if (flg == \"left\") {\n            if (!align) align = cell.attributes.position.x;\n\n            if (align > cell.attributes.position.x) {\n              align = cell.attributes.position.x;\n            }\n          } else if (flg == \"right\") {\n            if (!align) align = cell.attributes.position.x + cell.attributes.size.width;\n\n            if (align < cell.attributes.position.x + cell.attributes.size.width) {\n              align = cell.attributes.position.x + cell.attributes.size.width;\n            }\n          } else if (flg == \"up\") {\n            if (!align) align = cell.attributes.position.y;\n\n            if (align > cell.attributes.position.y) {\n              align = cell.attributes.position.y;\n            }\n          } else if (flg == \"down\") {\n            if (!align) align = cell.attributes.position.y + cell.attributes.size.height;\n\n            if (align < cell.attributes.position.y + cell.attributes.size.height) {\n              align = cell.attributes.position.y + cell.attributes.size.height;\n            }\n          }\n        });\n        selectionView.model.models.forEach(function (cell) {\n          if (cell.get(\"parent\")) {\n            var parentCell = graph.getCell(cell.get(\"parent\"));\n            var x_offset = parentCell.get(\"position\").x - cell.get(\"position\").x;\n            var y_offset = parentCell.get(\"position\").y - cell.get(\"position\").y;\n\n            if (flg == \"left\") {\n              cell.prop('position/x', align - x_offset);\n            } else if (flg == \"right\") {\n              cell.prop('position/x', align - parentCell.attributes.size.width - x_offset);\n            } else if (flg == \"up\") {\n              cell.prop('position/y', align - y_offset);\n            } else if (flg == \"down\") {\n              cell.prop('position/y', align - parentCell.attributes.size.height - y_offset);\n            }\n          }\n        });\n        selectionView.model.models.forEach(function (cell) {\n          if (!cell.get(\"parent\")) {\n            if (flg == \"left\") {\n              cell.prop('position/x', align);\n            } else if (flg == \"right\") {\n              cell.prop('position/x', align - cell.attributes.size.width);\n            } else if (flg == \"up\") {\n              cell.prop('position/y', align);\n            } else if (flg == \"down\") {\n              cell.prop('position/y', align - cell.attributes.size.height);\n            }\n          }\n        });\n        commandManager.storeBatchCommand();\n      };\n\n      commandManager.toFront = function () {\n        selection.invoke('toFront');\n      };\n\n      commandManager.toBack = function () {\n        selection.invoke('toBack');\n      };\n\n      commandManager.embed = function () {\n        var parentCell;\n        selectionView.model.models.forEach(function (cell) {\n          if (!parentCell) {\n            parentCell = cell;\n          } else {\n            if (parentCell.attributes.z > cell.attributes.z) {\n              parentCell = cell;\n            }\n          }\n        });\n        selectionView.model.models.forEach(function (cell) {\n          if (parentCell.id != cell.id) {\n            parentCell.embed(cell);\n          }\n        });\n      };\n\n      commandManager.unembed = function () {\n        selectionView.model.models.forEach(function (cell) {\n          if (cell.attributes.embeds) {\n            cell.attributes.embeds.forEach(function (cellid) {\n              cell.unembed(graph.getCell(cellid));\n            });\n          }\n        });\n      };\n\n      commandManager.preview = function () {\n        var viewId = $scope.selectedView.viewId;\n        var param = [{\n          viewId: viewId\n        }];\n        window.open('../app-free-style/index.html#/topoview/index/' + encodeURIComponent(JSON.stringify(param)), '_blank');\n      };\n\n      commandManager.flip = function () {\n        selectionView.model.models.forEach(function (cell) {\n          var attrs = cell.attributes.attrs;\n\n          if (attrs.hasOwnProperty(\"image\")) {\n            var image = attrs.image;\n\n            if (image.hasOwnProperty(\"transform\")) {\n              var scale = image.transform;\n\n              if (scale.indexOf(\"scale(-1,1)\") == -1) {\n                cell.attr(\"image/transform\", \"scale(-1,1),translate(-\" + image.width + \",0)\");\n              } else {\n                cell.attr(\"image/transform\", \"scale(1,1),translate(0,0)\");\n              }\n            } else {\n              cell.attr(\"image/transform\", \"scale(-1,1),translate(-\" + image.width + \",0)\");\n            }\n          }\n        });\n      };\n\n      commandManager.toJSON = function () {\n        var windowFeatures = 'menubar=no,location=no,resizable=yes,scrollbars=yes,status=no';\n\n        var windowName = _.uniqueId('json_output');\n\n        var jsonWindow = window.open('', windowName, windowFeatures);\n        jsonWindow.document.write(JSON.stringify(graph.toJSON()));\n      };\n\n      commandManager.loadJSON = function () {\n        BootstrapDialog.show({\n          title: '导入组态内容',\n          message: $('<textarea id=\"json4configer\" class=\"form-control\" placeholder=\"输入JSON\"></textarea>'),\n          buttons: [{\n            label: '确认',\n            cssClass: 'btn-primary',\n            hotkey: 13,\n            // Enter.\n            action: function action(dialogRef) {\n              dialogRef.close();\n              var inputcontent = document.getElementById('json4configer');\n\n              if (inputcontent.value) {\n                var json = JSON.parse(inputcontent.value);\n                graph.fromJSON(json);\n              }\n            }\n          }]\n        });\n      };\n\n      scope.components.commander = commandManager;\n    }, // toolTip显示处理\n    function toolTips(scope, element) {\n      $('.toolbar-container [data-tooltip]', element).each(function () {\n        new joint.ui.Tooltip({\n          target: $(this),\n          content: $(this).data('tooltip'),\n          top: '.toolbar-container',\n          direction: 'top'\n        });\n      });\n    }, // 初始化视图\n    function initView(scope, element) {\n      if ($routeParams.type == 'service') {\n        return;\n      }\n\n      ;\n\n      if (!$routeParams.viewId) {\n        location.href = \"../app-oc/index.html#/index\";\n        return;\n      }\n\n      scope.data.viewRoutes = [];\n\n      scope.data.viewChange = function (view) {\n        SwSocket.unregister(uuid);\n        uuid = Math.uuid();\n\n        for (var i in scope.data.viewRoutes) {\n          if (scope.data.viewRoutes[i].viewId == view.viewId) {\n            scope.data.viewRoutes.splice(i, scope.data.viewRoutes.length - i);\n          }\n        }\n\n        showViewContent(scope, view.viewId);\n      };\n\n      var loadcount = 0;\n\n      var gotoShowView = function gotoShowView() {\n        if (loadcount == 3) {\n          if ($routeParams.viewId != 0) {\n            showViewContent(scope, $routeParams.viewId);\n          } else {\n            createConfigView(function (viewId) {\n              showViewContent(scope, viewId);\n            });\n          }\n        }\n      };\n\n      var rootModelDicWatch = $scope.$watch(\"rootModelDic\", function (nv, ov) {\n        if (nv && !ov || ov) {\n          loadcount++;\n          gotoShowView();\n          rootModelDicWatch();\n        }\n      });\n      var domainListTreeWatch = $scope.$watch(\"domainListTree\", function (nv, ov) {\n        if (nv && !ov || ov) {\n          loadcount++;\n          gotoShowView();\n          domainListTreeWatch();\n        }\n      });\n      var myOptionDicWatch = $scope.$watch(\"myOptionDic\", function (nv, ov) {\n        if (nv && !ov || ov) {\n          loadcount++;\n          gotoShowView();\n          myOptionDicWatch();\n        }\n      });\n    }, // 初始化告警图标的方法\n    function initAlertIconfunction(scope, element) {\n      if (scope.data.stencil && scope.data.stencil.shapes && scope.data.stencil.shapes.customer) {\n        scope.data.stencil.shapes.customer.forEach(function (item) {\n          if (item.label || item.attrs.text && item.attrs.text.text) {\n            if (!item.label) item.label = item.attrs.text.text;\n            $scope.alertIcons.push(item);\n          }\n        });\n      }\n    }];\n    /********↑↑↑↑↑↑以上是组态的核心处理对象↑↑↑↑↑↑********/\n\n    if ($routeParams.type == 'service') {\n      if ($scope.defer == undefined) {\n        $scope.defer = $q.defer();\n      }\n\n      ;\n      var promise = $scope.defer.promise;\n\n      $scope.initialization[9] = function initView(scope, element) {\n        var confighome, confighomeArr, allmyViews, currentlevel;\n        $rootScope.dialogBox = undefined;\n        scope.open = false;\n\n        scope.wholeClick = function () {\n          scope.open = false;\n        };\n\n        if (scope.defer == undefined) {\n          scope.defer = $q.defer();\n        }\n\n        var promise = scope.defer.promise;\n\n        scope.lv1viewsclick = function (item) {\n          scope.open = false;\n\n          if (graph.attributes && graph.attributes.cells && graph.attributes.cells.models) {\n            graph.attributes.cells.models.forEach(function (cell) {\n              cell.off('transition:end');\n            });\n          }\n\n          ;\n          timeout(function () {\n            location.href = \"../app-sc/index_configure.html#/display/\" + item.viewId + \"/service\";\n          });\n        };\n\n        viewFlexService.getAllMyViews(function (event) {\n          if (event.code == 0) {\n            confighome = event.data.find(function (element) {\n              return element.viewType == 'confighome';\n            });\n            confighomeArr = event.data.filter(function (element) {\n              return element.viewType == 'confighome';\n            });\n            confighomeArr = confighomeArr.map(function (element) {\n              return element.viewId;\n            });\n            var tmp = event.data.filter(function (element) {\n              return element.viewType == 'configure';\n            });\n            allmyViews = tmp.map(function (element) {\n              var jsonObj;\n\n              if (element.content != null) {\n                jsonObj = JSON.parse(element.content);\n              } else {\n                jsonObj = {};\n              }\n\n              if (jsonObj.level == undefined) {\n                jsonObj.level = 1;\n              }\n\n              var obj = {\n                viewId: element.viewId,\n                viewTitle: element.viewTitle,\n                viewType: element.viewType,\n                navigate: element.navigate,\n                JSON: jsonObj\n              };\n              return obj;\n            });\n            allViewLoaded();\n          }\n        });\n\n        function allViewLoaded() {\n          if (!$routeParams.viewId) {\n            location.href = \"../app-sc/index_configure.html#/display/edit/service\";\n            return;\n          } else if ($routeParams.viewId == 'all') {\n            if (confighome) {\n              var viewId = JSON.parse(confighome.content).viewId;\n              var currentView = allmyViews.find(function (element) {\n                return element.viewId == viewId;\n              });\n\n              if (!viewId || currentView) {\n                run(viewId);\n              } else {\n                location.href = \"../app-sc/index_configure.html#/display/edit/service\";\n              }\n            } else {\n              delete $rootScope.dialogBox;\n              location.href = \"../app-sc/index_configure.html#/display/edit/service\";\n            }\n          } else if ($routeParams.viewId == 'edit') {\n            var findView, fnhandle;\n            scope.lv1views = allmyViews.filter(function (element) {\n              return $$.switchToNumber(element.navigate) > 0;\n            });\n\n            if (confighome) {\n              findView = scope.lv1views.find(function (elem) {\n                return elem.viewId == JSON.parse(confighome.content).viewId;\n              });\n\n              fnhandle = function fnhandle() {\n                var viewId = $rootScope.dialogBox.select.value.viewId;\n                var con = {\n                  viewId: viewId\n                };\n                var param = {\n                  viewId: confighome.viewId,\n                  viewTitle: 'confighome',\n                  viewType: 'confighome',\n                  content: JSON.stringify(con)\n                };\n                viewFlexService.updateView(param, function () {\n                  delete $rootScope.dialogBox;\n                  location.href = \"../app-sc/index_configure.html#/display/all/service\";\n                });\n              };\n            } else {\n              findView = scope.lv1views[0];\n\n              fnhandle = function fnhandle() {\n                var viewId = $rootScope.dialogBox.select.value.viewId;\n                var con = {\n                  viewId: viewId\n                };\n                var param = {\n                  viewTitle: 'confighome',\n                  viewType: 'confighome',\n                  content: JSON.stringify(con)\n                };\n                viewFlexService.addView(param, function () {\n                  delete $rootScope.dialogBox;\n                  location.href = \"../app-sc/index_configure.html#/display/all/service\";\n                });\n              };\n            }\n\n            var fnlist = [{\n              label: '确定',\n              icon: 'btn btn-success',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: fnhandle\n            }];\n            $rootScope.dialogBox = {\n              title: {\n                label: '请选择服务中心默认视图'\n              },\n              description: {\n                label: ''\n              },\n              select: {\n                \"label\": '请选择展示页',\n                \"value\": findView,\n                \"options\": scope.lv1views\n              },\n              fnlist: fnlist\n            };\n          } else {\n            run($routeParams.viewId);\n          }\n        }\n\n        function run(viewId) {\n          var treedata = {};\n\n          for (var i in allmyViews) {\n            if (typeof allmyViews[i].navigate == 'string' && allmyViews[i].navigate != \"\") {\n              var navi = allmyViews[i].navigate.split(\"/\");\n              var rs = {};\n              var ta = rs;\n\n              for (var j in navi) {\n                if (j < navi.length - 1) {\n                  ta[navi[j]] = {};\n                  ta = ta[navi[j]];\n                } else {\n                  ta[navi[j]] = {\n                    data: allmyViews[i]\n                  };\n                }\n              }\n\n              ;\n              treedata.$extension(rs);\n            }\n          }\n\n          var currentView = allmyViews.find(function (element) {\n            return element.viewId == viewId;\n          });\n\n          if (currentView) {\n            var findCur;\n            treedata.traverse(function (attr, element) {\n              if (element.data) {\n                if (element.data.viewId) {\n                  if (currentView.viewId == element.data.viewId) {\n                    findCur = element;\n                    var arr = [];\n\n                    for (var k in element.parent) {\n                      if (k != 'data') {\n                        arr.push(element.parent[k].data);\n                      }\n                    }\n\n                    scope.lv1views = arr;\n                  }\n                }\n              }\n            });\n            var target,\n                detaillist = [];\n\n            if (findCur) {\n              target = findCur.parent;\n\n              while (target.parent) {\n                detaillist.push(target.data);\n                target = target.parent;\n              }\n\n              scope.details = detaillist;\n            }\n\n            scope.data.viewRoutes = [];\n\n            scope.data.viewChange = function (view) {\n              SwSocket.unregister(uuid);\n              uuid = Math.uuid();\n\n              for (var i in scope.data.viewRoutes) {\n                if (scope.data.viewRoutes[i].viewId == view.viewId) {\n                  scope.data.viewRoutes.splice(i, scope.data.viewRoutes.length - i);\n                }\n              }\n\n              showViewContent(scope, view.viewId);\n            };\n\n            showViewContent(scope, currentView.viewId);\n          } else {\n            location.href = \"../app-sc/index_configure.html#/display/edit/service\";\n          }\n        }\n      };\n    }\n  }]);\n});"],"sourceRoot":"/source/"}