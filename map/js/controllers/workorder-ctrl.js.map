{"version":3,"sources":["js/controllers/workorder-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","ngDialog","resourceUIService","workflowService","ticketCategoryService","alertService","SwSocket","Info","userLoginUIService","growl","$routeParams","processService","ticketTaskService","ticketService","console","info","editVisible","addOrderShow","processType","activeTab","activeListTab","type","id","seleStatus","initAddList","orderAddData","title","priorityCode","ticketNo","category","ticketCategoryId","values","deviceId","faultId","message","orderCount","doing","unpush","done","all","get","priorityData","statusData","formAryList","definitions","selectItem","process","undefined","spl","split","getWorkflowById","res","code","data","resAry","startAttributeDefinitions","i","typePro","label","name","dataType","push","log","JSON","stringify","initData","devicesAll","faultList","findFault","devicesDic","findFaultKnowledgeByModelId","modelId","getDoingOrderCount","getTicketsByStatusAndDeviceId","returnObj","length","obj","status","findTickets","getUnpushOrderCount","getDoneOrderCount","getAllOrderCount","getTicketsByDeviceId","getAllTickets","getOrderData","state","count","workOrderData","orderGirtData","$broadcast","Event","WORKORDERINIT","goSearch","v","loaderValue","wordCancel","getOrderProcedure","processTypeList","processTypeData","addWorkOrder","workOrderType","myDicts","open","template","scope","className","saveOrder","commitloading","warning","ticket","saveTicket","success","closeDialog","indexOf","changeWorkOrderItem","$","tab","cancelOrder","uploadOrder","commitTicket","dataList","j","splice","formatDate","str","newDateJson","Format","GetDateCategoryStrByLabel","columnDefs","targets","render","full","strIcon","menuitems","columns","ProudSmart","datatable","optionCol2","cancelTicket","show","closable","buttons","cssClass","action","dialogRef","close","resultObj","delTicket","deleteTicket","tabStatus","cancelOrderNo","on","e","target","closest","removeClass","children","addClass","aname","attr","$apply","text","relatedTarget","getTicketCategorys","arr1","arr2","arr3","arr4","processType1","processType2","processType3","processType4","getDevicesByCondition","newObj","forEach","init"],"mappings":"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","file":"js/controllers/workorder-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('WorkOrderCtrl', ['$scope', 'ngDialog', 'resourceUIService', 'workflowService', 'ticketCategoryService', 'alertService', 'SwSocket', 'Info', 'userLoginUIService', 'growl', '$routeParams', 'processService', 'ticketTaskService', 'ticketService', function ($scope, ngDialog, resourceUIService, workflowService, ticketCategoryService, alertService, SwSocket, Info, userLoginUIService, growl, $routeParams, processService, ticketTaskService, ticketService) {\n    console.info(\"切换到工单管理\");\n    var previousTab; //前一个激活的标签tab名称\n\n    $scope.editVisible = false;\n    $scope.addOrderShow = false;\n    $scope.processType = [];\n    $scope.activeTab = \"执行中\";\n    $scope.activeListTab = \"tab1\";\n    var type = $routeParams.type;\n    var id = $routeParams.id;\n    $scope.seleStatus = 100;\n\n    $scope.initAddList = function () {\n      //新增工单初始化\n      $scope.orderAddData = {\n        \"title\": \"\",\n        \"priorityCode\": \"0\",\n        \"ticketNo\": '',\n        \"category\": \"\",\n        \"ticketCategoryId\": 0,\n        \"values\": null,\n        \"deviceId\": \"\",\n        \"faultId\": \"\",\n        \"message\": \"\"\n      };\n    }; //各阶段工单数量\n\n\n    $scope.orderCount = {\n      \"doing\": 0,\n      \"unpush\": 0,\n      \"done\": 0,\n      \"all\": 0\n    };\n    var info = Info.get(\"../localdb/info.json\", function (info) {\n      $scope.priorityData = info.priorityData;\n      $scope.statusData = info.statusData; // $scope.workOrderType = info.workOrderType;\n      // $scope.workOrderType = $scope.myDicts['ticketCategory'];\n    });\n    $scope.formAryList = [];\n    $scope.definitions = {};\n    $scope.selectItem = \"\"; //根据流程查开始节点属性\n\n    $scope.process = function () {\n      if ($scope.orderAddData.ticketCategoryId != \"\" && $scope.orderAddData.ticketCategoryId != undefined && $scope.orderAddData.ticketCategoryId != null) {\n        var spl = $scope.orderAddData.ticketCategoryId.split(\":\");\n        workflowService.getWorkflowById(spl[0], function (res) {\n          if (res.code == 0) {\n            $scope.selectItem = res.data;\n            var resAry = res.data.startAttributeDefinitions;\n            $scope.formAryList = [];\n\n            for (var i in resAry) {\n              var typePro = {};\n              typePro[\"label\"] = resAry[i].label;\n              typePro[\"name\"] = resAry[i].name;\n              typePro[\"dataType\"] = resAry[i].dataType;\n              $scope.definitions[resAry[i].label] = \"\";\n              $scope.formAryList.push(typePro);\n            }\n\n            console.log(\"arry==\" + JSON.stringify($scope.formAryList) + \"arry==\" + JSON.stringify($scope.definitions));\n          }\n        });\n      } else {\n        $scope.formAryList = [];\n      }\n    };\n\n    $scope.initData = {\n      \"devicesAll\": \"\",\n      \"faultList\": \"\"\n    };\n    $scope.devicesAll = \"\"; //根据工单分类初始化工单流程\n\n    var getProcedure = function getProcedure() {\n      ticketCategoryService.getTicketCategorys(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.processTypeData = returnObj.data; //展示table数据的工单流程\n\n          var arr1 = [];\n          var arr2 = [];\n          var arr3 = [];\n          var arr4 = [];\n\n          for (var i in returnObj.data) {\n            if (returnObj.data[i].category == \"10\") {\n              //告警工单\n              arr1.push(returnObj.data[i]);\n            } else if (returnObj.data[i].category == \"20\") {\n              arr2.push(returnObj.data[i]);\n            } else if (returnObj.data[i].category == \"30\") {\n              arr3.push(returnObj.data[i]);\n            } else if (returnObj.data[i].category == \"40\") {\n              arr4.push(returnObj.data[i]);\n            }\n          }\n\n          $scope.processType1 = arr1;\n          $scope.processType2 = arr2;\n          $scope.processType3 = arr3;\n          $scope.processType4 = arr4;\n          getOrderData(100);\n        }\n      });\n      $scope.devicesDic = {};\n      resourceUIService.getDevicesByCondition({}, function (res) {\n        if (res.code == 0) {\n          var newObj = [];\n          newObj.push({\n            text: '请选择',\n            label: '请选择',\n            id: '-1'\n          });\n          res.data.forEach(function (obj) {\n            if (obj.label) {\n              obj.text = obj.label;\n              $scope.devicesDic[obj.id] = obj;\n              newObj.push(obj);\n            }\n          });\n          $scope.devicesAll = newObj;\n        }\n      });\n    };\n\n    $scope.findFault = function () {\n      if ($scope.devicesDic[$scope.orderAddData.deviceId]) {\n        resourceUIService.findFaultKnowledgeByModelId($scope.devicesDic[$scope.orderAddData.deviceId].modelId, function (res) {\n          if (res.code == 0) {\n            $scope.initData.faultList = res.data;\n          }\n        });\n      }\n    };\n\n    var searchList = function searchList(obj) {\n      ticketTaskService.findTickets(obj, function (returnObj) {\n        if (returnObj.code == 0) {\n          console.log(\"工单数据\");\n          var status = $scope.seleStatus;\n          var state = \"\";\n          var count = returnObj.data.length;\n\n          if (status == 100) {\n            $scope.orderCount.doing = count;\n            state = \"doing\"; //执行中\n\n            $scope.workOrderData[\"tab\"] = true;\n          } else if (status == 10) {\n            $scope.orderCount.unpush = count;\n            state = \"undo\"; //未发布\n\n            $scope.workOrderData[\"tab\"] = false;\n          } else if (status == 200) {\n            $scope.orderCount.done = count;\n            state = \"did\"; //已完成\n\n            $scope.workOrderData[\"tab\"] = false;\n          } //$scope.orderData = returnObj.data;\n\n\n          $scope.workOrderData.data = returnObj.data;\n          $scope.orderGirtData.data = returnObj.data;\n          $scope.workOrderData.state = state;\n\n          if (status == 10) {\n            $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n          } else {\n            $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n          }\n        }\n      });\n    }; //查询条件事件\n\n\n    $scope.goSearch = function () {\n      var v = {};\n      v[\"title\"] = $scope.loaderValue;\n      v[\"status\"] = $scope.seleStatus;\n      searchList(v);\n      /*     if($scope.queryDitem.state > 0) {\n             v[$scope.queryDitem.attributeName] = $scope.loaderValue;\n             if($scope.seleStatus > 0){\n               v[\"status\"] = $scope.seleStatus;\n             }\n             searchList(v);\n           }else {\n             v['title'] = $scope.loaderValue;\n             if($scope.seleStatus > 0){\n               v[\"status\"] = $scope.seleStatus;\n             }\n             searchList(v);\n           }*/\n    }; //未发布工单查询刷新\n\n\n    $scope.wordCancel = function () {\n      $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n    }; //根据工单分类初始化工单流程\n\n\n    $scope.getOrderProcedure = function () {\n      /*  if ($scope.orderAddData.category == 10) {\n          $scope.processType = $scope.processType1;\n        } else if ($scope.orderAddData.category == 20) {\n          $scope.processType = $scope.processType2;\n        } else if ($scope.orderAddData.category == 30) {\n          $scope.processType = $scope.processType3;\n        } else if ($scope.orderAddData.category == 40) {\n          $scope.processType = $scope.processType4;\n        } else {\n          $scope.processType = [];\n        }*/\n      //通过传值方式获取流程分类\n      var processTypeList = $scope.processTypeData;\n      var processType = [];\n\n      for (var i in processTypeList) {\n        if (processTypeList[i].category == $scope.orderAddData.category) {\n          processType.push(processTypeList[i]);\n        }\n      }\n\n      $scope.processType = processType;\n    };\n    /**\n     * 新建工单\n     */\n\n\n    $scope.addWorkOrder = function (obj) {\n      if (obj) {\n        $scope.orderAddData = obj;\n      } else {\n        $scope.initAddList();\n      }\n\n      $scope.workOrderType = $scope.myDicts['ticketCategory'];\n      ngDialog.open({\n        template: '../partials/dialogue/add_workorder.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n      /*if($scope.addOrderShow){\n        growl.warning(\"当前有未保存工单\",{});\n      }else{\n        $scope.addOrderShow = true;\n        $scope.processType = [];\n      }*/\n    };\n    /**\n     * 获取各工单count(执行中，未发布，已完成)\n     */\n\n\n    function getDoingOrderCount() {\n      var status = 100;\n\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(100, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.doing = returnObj.data.length;\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": status\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.doing = returnObj.data.length;\n          }\n        });\n      }\n    }\n\n    function getUnpushOrderCount() {\n      var status = 10;\n\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(100, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.doing = returnObj.data.length;\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": status\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.unpush = returnObj.data.length;\n          }\n        });\n      }\n    }\n\n    function getDoneOrderCount() {\n      var status = 200;\n\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(100, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.doing = returnObj.data.length;\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": status\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.done = returnObj.data.length;\n          }\n        });\n      }\n    }\n\n    function getAllOrderCount() {\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByDeviceId(id, function (res) {\n          if (res.code == 0) {\n            $scope.orderCount.all = res.data.length;\n          }\n        });\n      } else {\n        ticketTaskService.getAllTickets(function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.orderCount.all = returnObj.data.length;\n          }\n        });\n      }\n    }\n    /**\n     * 获取工单数据(执行中，未发布，已完成)\n     */\n\n\n    function getOrderData(status) {\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(status, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            console.log(\"工单数据\");\n            var state = \"\";\n            var count = returnObj.data.length;\n\n            if (status == 100) {\n              $scope.orderCount.doing = count;\n              state = \"doing\"; //执行中\n\n              $scope.workOrderData[\"tab\"] = true;\n            } else if (status == 10) {\n              $scope.orderCount.unpush = count;\n              state = \"undo\"; //未发布\n\n              $scope.workOrderData[\"tab\"] = false;\n            } else if (status == 200) {\n              $scope.orderCount.done = count;\n              state = \"did\"; //已完成\n\n              $scope.workOrderData[\"tab\"] = false;\n            } //$scope.orderData = returnObj.data;\n\n\n            $scope.workOrderData.data = returnObj.data;\n            $scope.orderGirtData.data = returnObj.data;\n            $scope.workOrderData.state = state;\n\n            if (status == 10) {\n              $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n            } else {\n              $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n            }\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": status\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            console.log(\"工单数据\");\n            var state = \"\";\n            var count = returnObj.data.length;\n\n            if (status == 100) {\n              $scope.orderCount.doing = count;\n              state = \"doing\"; //执行中\n\n              $scope.workOrderData[\"tab\"] = true;\n            } else if (status == 10) {\n              $scope.orderCount.unpush = count;\n              state = \"undo\"; //未发布\n\n              $scope.workOrderData[\"tab\"] = false;\n            } else if (status == 200) {\n              $scope.orderCount.done = count;\n              state = \"did\"; //已完成\n\n              $scope.workOrderData[\"tab\"] = false;\n            } //$scope.orderData = returnObj.data;\n\n\n            $scope.workOrderData.data = returnObj.data;\n            $scope.orderGirtData.data = returnObj.data;\n            $scope.workOrderData.state = state;\n\n            if (status == 10) {\n              $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n            } else {\n              $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n            }\n          }\n        });\n      }\n    }\n    /**\n     * 获取所有工单数据\n     */\n\n\n    function getAllOrderData() {\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByDeviceId(id, function (res) {\n          if (res.code == 0) {\n            $scope.orderCount.all = res.data.length;\n          }\n        });\n      } else {\n        ticketTaskService.getAllTickets(function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.workOrderData.data = returnObj.data;\n            $scope.orderCount.all = returnObj.data.length;\n            $scope.workOrderData.state = 'all'; //全部\n\n            $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n          }\n        });\n      }\n    }\n    /**\n     * 发起工单必输项验证\n     * @param o\n     */\n\n\n    var requiredFiledValidation = function requiredFiledValidation(o) {\n      var m = null;\n\n      if (!o.title || o.title == \"\") {\n        m = '工单名称不能为空';\n      } else if (!String(o.priorityCode) || String(o.priorityCode) == \"\") {\n        m = '紧急度不能为空';\n      } else if (!o.category || o.category == \"\") {\n        m = '工单类型不能为空';\n      } else if (!o.ticketCategoryId || o.ticketCategoryId == \"\") {\n        m = '工单流程不能为空';\n      } else if (!o.deviceId || o.deviceId == \"\" || o.deviceId == \"-1\") {\n        m = '设备不能为空';\n      } else if (!o.message || o.message == \"\") {\n        m = '工单内容不能为空';\n      }\n\n      return m;\n    };\n    /**\n     * 保存工单\n     */\n\n\n    $scope.saveOrder = function () {\n      //校验必输项\n\n      /* var rv = requiredFiledValidation($scope.orderAddData);\n       if (rv != null) {\n         growl.warning(rv, {});\n         return;\n       }*/\n      if ($scope.commitloading) {\n        growl.warning(\"请等待，正在保存工单\", {});\n        return;\n      }\n\n      $scope.commitloading = true;\n      $scope.orderAddData.values = $scope.definitions;\n      /* var cat = $scope.orderAddData.ticketCategoryId.split(\":\");\n       $scope.orderAddData.ticketCategoryId = cat[1];*/\n\n      $scope.orderAddData.deviceId = $scope.orderAddData.deviceId;\n      var ticket = $scope.orderAddData;\n      ticketTaskService.saveTicket(ticket, function (returnObj) {\n        $scope.commitloading = false;\n\n        if (returnObj.code == 0) {\n          growl.success(\"保存工单成功\", {});\n          $scope.closeDialog();\n          $scope.initAddList();\n          getAllOrderCount(); //刷新总工单数量\n\n          getDoingOrderCount();\n          getUnpushOrderCount();\n          $scope.addOrderShow = false; //跳转到未发布\n\n          if ($scope.activeTab.indexOf(\"未发布\") > -1) {\n            changeWorkOrderItem($scope.activeTab);\n          } else {\n            $('#myTab li:eq(3) a').tab('show');\n          }\n        }\n      });\n    };\n    /**\n     * 取消工单\n     */\n\n\n    $scope.cancelOrder = function () {\n      $scope.addOrderShow = false;\n      growl.info(\"取消发布工单\", {});\n      $scope.initAddList();\n    };\n    /**\n     * 发布工单\n     */\n\n\n    $scope.uploadOrder = function () {\n      /* var r = requiredFiledValidation($scope.orderAddData);\n       if (r != null) {\n         growl.warning(r, {});\n         return;\n       }*/\n      if ($scope.commitloading) {\n        growl.warning(\"请等待，正在发布工单\");\n        return;\n      }\n\n      $scope.commitloading = true;\n      $scope.orderAddData.values = $scope.definitions;\n      /*  var temporary = $scope.orderAddData.ticketCategoryId;\n        var cat = $scope.orderAddData.ticketCategoryId.split(\":\");\n        $scope.orderAddData.ticketCategoryId = cat[1];*/\n\n      $scope.orderAddData.deviceId = $scope.orderAddData.deviceId;\n      var ticket = $scope.orderAddData; //ticket.push(obj);\n\n      ticketTaskService.commitTicket(ticket, function (returnObj) {\n        $scope.commitloading = false;\n\n        if (returnObj.code == 0) {\n          //$scope.$apply();\n          growl.success(\"发布工单成功\", {});\n          $scope.closeDialog();\n          $scope.addOrderShow = false;\n          $scope.formAryList = [];\n\n          if ($scope.orderAddData.status == 10) {\n            var dataList = $scope.orderGirtData.data;\n\n            for (var j in dataList) {\n              if (dataList[j].ticketCategoryId == returnObj.data.ticketCategoryId) {\n                $scope.orderGirtData.data.splice(j, 1);\n                break;\n              }\n            }\n\n            $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n          }\n\n          $scope.initAddList();\n          getAllOrderCount(); //刷新总工单数量\n\n          getDoingOrderCount();\n          getDoneOrderCount();\n          getUnpushOrderCount(); //跳转到执行中\n\n          if ($scope.activeTab.indexOf(\"执行中\") > -1) {\n            changeWorkOrderItem($scope.activeTab);\n          } else {\n            $('#myTab li:eq(0) a').tab('show');\n          }\n        } else {\n          $scope.commitloading = false;\n          $scope.orderAddData.ticketCategoryId = \"\";\n        }\n      });\n    }; //格式化时间\n\n\n    var formatDate = function formatDate(str) {\n      if (str) {\n        str = newDateJson(str).Format(GetDateCategoryStrByLabel());\n      }\n\n      return str;\n    };\n\n    $scope.workOrderData = {\n      \"columnDefs\": [{\n        \"targets\": 1,\n        \"data\": \"ticketNo\",\n        \"render\": function render(data, type, full) {\n          return data;\n        }\n      }, {\n        \"targets\": 2,\n        \"data\": \"ticketCategoryId\",\n        \"render\": function render(data, type, full) {\n          //返回自定义内容\n          var str = \"\";\n\n          for (var i in $scope.processTypeData) {\n            if ($scope.processTypeData[i].id == data) {\n              str = $scope.processTypeData[i].name;\n            }\n          }\n\n          return str;\n        }\n      }, {\n        \"targets\": 3,\n        \"data\": \"status\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          var str = \"\";\n          var strIcon = \"\";\n\n          if (data == 10) {\n            str = \"未发布\";\n            strIcon = \"label-primary\";\n          } else if (data == 100) {\n            str = \"处理中\";\n            strIcon = \"label-warning\";\n          } else if (data == 200) {\n            str = \"已完成\";\n            strIcon = \"label-info\";\n          } else if (data == 150) {\n            str = \"已撤销\";\n            strIcon = \"label-info\";\n          }\n\n          return \"<span class='label \" + strIcon + \"'>\" + str + \"</span>\";\n        }\n      }, {\n        \"targets\": 5,\n        \"data\": \"\",\n        \"render\": function render(data, type, full) {\n          //  返回自定义内容\n          return formatDate(data);\n        }\n      }, {\n        \"targets\": 6,\n        \"data\": \"\",\n        \"render\": function render(data, type, full) {\n          //  返回自定义内容\n          return formatDate(data);\n        }\n      }, {\n        \"targets\": 8,\n        \"data\": \"option\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          var str = \"<div class='btn-group btn-group-sm'>\";\n\n          if ($scope.menuitems['A01_S09']) {\n            str += \"<button id='history'    class='btn btn-primary' ><i class='fa fa-edit hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 执行历史</span></button>\";\n          }\n\n          if ($scope.activeTab == null || $scope.activeTab.indexOf(\"执行中\") > -1 && $scope.menuitems['A06_S09']) {\n            str += \"<button id='revoke'   class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 撤销</span></button>\";\n          }\n\n          str += \"</div>\";\n          return str;\n        }\n      }]\n    };\n    $scope.orderGirtData = {\n      \"columns\": [{\n        \"data\": \"title\",\n        \"title\": \"工单名称\"\n      }, {\n        \"data\": \"ticketCategoryId\",\n        \"title\": \"工单流程\"\n      }, {\n        \"data\": \"status\",\n        \"title\": \"工单状态\"\n      }, $.ProudSmart.datatable.optionCol2],\n      \"columnDefs\": [{\n        \"targets\": 0,\n        \"data\": \"title\",\n        \"render\": function render(data, type, full) {\n          return \"<span style='cursor: pointer;'>\" + data + \"</span>\";\n        }\n      }, {\n        \"targets\": 1,\n        \"data\": \"ticketCategoryId\",\n        \"render\": function render(data, type, full) {\n          var str = \"\";\n\n          for (var i in $scope.processTypeData) {\n            if ($scope.processTypeData[i].id == data) {\n              str = $scope.processTypeData[i].name;\n            }\n          }\n\n          return \"<span style='cursor: pointer;'>\" + str + \"</span>\";\n        }\n      }, {\n        \"targets\": 2,\n        \"data\": \"status\",\n        \"render\": function render(data, type, full) {\n          return \"<span style='cursor: pointer;' class='label \" + (data == 10 ? \"label-primary\" : data == 100 ? \"label-warning\" : \"label-info\") + \"'>\" + (data == 10 ? \"未发布\" : data == 100 ? \"处理中\" : \"已完成\") + \"</span>\";\n        }\n      }, {\n        \"targets\": 3,\n        \"data\": \"option\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          var str = \"<div class='btn-group btn-group-sm'>\";\n\n          if ($scope.menuitems['A07_S09']) {\n            str += \"<button id='release-btn'   class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 发布</span></button>\";\n          }\n\n          if ($scope.menuitems['A08_S09']) {\n            str += \"<button id='del-btn'   class='btn btn-default' ><i class='fa fa-trash hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 删除</span></button>\";\n          }\n\n          str += \"</div>\";\n          return str;\n        }\n      }]\n    };\n\n    $scope.cancelTicket = function (ticketNo) {\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: '确认要撤销该工单？',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            dialogRef.close();\n            ticketTaskService.cancelTicket(ticketNo, function (resultObj) {\n              if (resultObj.code == 0) {\n                growl.success(\"撤销工单成功!\", {}); //changeWorkOrderItem(\"执行中\");\n\n                if (type == \"gateway\") {\n                  ticketTaskService.getTicketsByStatusAndDeviceId(100, id, function (returnObj) {\n                    if (returnObj.code == 0) {\n                      $scope.workOrderData.data = returnObj.data;\n                      $scope.orderCount.doing = returnObj.data.length;\n                      $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n                    }\n                  });\n                } else {\n                  var obj = {\n                    \"status\": 100\n                  };\n                  ticketTaskService.findTickets(obj, function (returnObj) {\n                    $scope.workOrderData.data = returnObj.data;\n                    $scope.orderCount.doing = returnObj.data.length;\n                    $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n                  });\n                } // $scope.$broadcast(Event.WORKORDERINIT+\"_order\", $scope.orderGirtData);\n\n              }\n            });\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.delTicket = function (ticketNo) {\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: '是否要删除该工单',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            ticketService.deleteTicket(ticketNo, function (resultObj) {\n              if (resultObj.code == 0) {\n                growl.success(\"删除工单成功!\", {});\n\n                if (type == \"gateway\") {\n                  ticketTaskService.getTicketsByStatusAndDeviceId(10, id, function (returnObj) {\n                    if (returnObj.code == 0) {\n                      $scope.workOrderData.data = returnObj.data;\n                      $scope.orderCount.doing = returnObj.data.length;\n                      $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n                    }\n                  });\n                } else {\n                  var obj = {\n                    \"status\": 10\n                  };\n                  ticketTaskService.findTickets(obj, function (returnObj) {\n                    $scope.orderGirtData.data = returnObj.data;\n                    $scope.orderCount.unpush = returnObj.data.length;\n                    $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n                  }); // $scope.$broadcast(Event.WORKORDERINIT+\"_order\", $scope.orderGirtData);\n                }\n              }\n            });\n            dialogRef.close();\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.tabStatus = \"false\";\n\n    var changeWorkOrderItem = function changeWorkOrderItem(activeTab) {\n      if (activeTab == null || activeTab.indexOf(\"执行中\") > -1) {\n        getOrderData(100);\n        $scope.workOrderData[\"tab\"] = true;\n        $scope.seleStatus = 100;\n      } else if (activeTab.indexOf(\"未发布\") > -1) {\n        getOrderData(10);\n        $scope.seleStatus = 10;\n      } else if (activeTab.indexOf(\"已完成\") > -1) {\n        getOrderData(200);\n        $scope.seleStatus = 200;\n        $scope.workOrderData[\"tab\"] = false;\n      } else if (activeTab.indexOf(\"全部工单\") > -1) {\n        getAllOrderData();\n        $scope.seleStatus = 0;\n        $scope.workOrderData[\"tab\"] = false;\n      }\n    };\n\n    $scope.cancelOrderNo = function () {\n      if (type == \"gateway\") {\n        ticketTaskService.getTicketsByStatusAndDeviceId(10, id, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.workOrderData.data = returnObj.data;\n            $scope.orderCount.doing = returnObj.data.length;\n            $scope.$broadcast(Event.WORKORDERINIT, $scope.workOrderData);\n          }\n        });\n      } else {\n        var obj = {\n          \"status\": 10\n        };\n        ticketTaskService.findTickets(obj, function (returnObj) {\n          $scope.orderGirtData.data = returnObj.data;\n          $scope.orderCount.unpush = returnObj.data.length;\n          $scope.$broadcast(Event.WORKORDERINIT + \"_order\", $scope.orderGirtData);\n        }); // $scope.$broadcast(Event.WORKORDERINIT+\"_order\", $scope.orderGirtData);\n      }\n    };\n    /**\n     * tab页的事件监听\n     */\n\n\n    var initEvent = function initEvent() {\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        if ($(e.target).closest(\"li.disabled\").length > 0) {\n          $(e.target).closest(\"li.disabled\").removeClass(\"active\");\n          $(e.target).closest(\"ul\").children(\"[name=\" + $scope.activeListTab + \"]\").addClass(\"active\");\n          return;\n        }\n\n        var aname = $(e.target).closest(\"li\").attr(\"name\");\n\n        if (aname) {\n          $scope.activeListTab = aname;\n          $scope.$apply();\n          $scope.initAddList(); // 获取已激活的标签页的名称\n\n          $scope.activeTab = $(e.target).text(); // 获取前一个激活的标签页的名称\n\n          previousTab = $(e.relatedTarget).text();\n          $scope.addOrderShow = false;\n          changeWorkOrderItem($scope.activeTab);\n        }\n      });\n    }; //初始化工单管理\n\n\n    function init() {\n      initEvent();\n      $scope.initAddList(); //根据状态获取工单数量\n\n      getUnpushOrderCount();\n      getDoneOrderCount(); //获取所有工单\n\n      getAllOrderCount();\n      getDoingOrderCount();\n      getProcedure();\n\n      if ($routeParams && $routeParams.state) {\n        //从工单详情返回到工单管理页面\n        var activeTab = \"\";\n        var id = null;\n\n        switch ($routeParams.state) {\n          case 'doing':\n            activeTab = \"执行中\";\n            id = 0;\n            break;\n\n          case 'did':\n            activeTab = \"已完成\";\n            id = 1;\n            break;\n\n          case 'all':\n            activeTab = \"全部工单\";\n            id = 2;\n            break;\n\n          case 'undo':\n            activeTab = \"未发布\";\n            id = 3;\n            break;\n        }\n\n        $(\"#myTab li:eq(\" + id + \") a\").tab('show');\n        changeWorkOrderItem(activeTab);\n      } else {\n        //进入工单管理页面\n        getOrderData(100); //执行中\n      }\n    }\n\n    init();\n  }]);\n});"],"sourceRoot":"/source/"}