{"version":3,"sources":["js/controllers/appnav-ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","BootstrapDialog","controller","$scope","$state","ngDialog","$location","Info","alertService","userLoginUIService","viewFlexService","unitService","configUIService","resourceUIService","dictionaryService","ticketTaskService","route","timeout","$rootScope","growl","userDomainService","userUIService","userEnterpriseService","q","registerService","psTreeData","psUiRouterHandler","cms","cms2","psConfig","projectUIService","dialogInstance","runtime","init","criticalCount","orderCount","myOptions","myOptionDic","myDicts","provinces","citys","districts","cityDics","districtDics","alertView","designView","enterpriseType","treeviewIndex","oldTreeviewIndex","loadingShow","currentMenuCode","firstMenuCode","localMenuCode","showMenu","menuitems","getAllUserInfo","getAllDeviceInfo","$on","rootHandler","detailshow","$attr","closeDialog","close","checkLoginAccont","userInfo","watch","$watch","n","o","s","path","match","window","location","pathname","exec","openSidebar","$","css","queryEnterpriseRole","returnObj","code","index","hash","split","roles","data","filter","ele","roleID","indexOf","values","roleInfo","find","user","currentRoleID","Error","setRoleValues","tabs","JSON","parse","children","e","console","error","event","main_active_index","navToPage","params","then","d","go","apply","changeRole","usercurrentRoleID","updateRoleValues","navigateTo","loginNames","forEach","arr","account","loginName","sessionStorage","setItem","getItem","isShowSelect","get","info","baseConfig","customerConfig","projectConfig","jQuery","extend","kpiIconList","kpiIcon","host","userName","password","search","concat","loginFun","loginCallback","i","removeItem","href","gotoHomePage","enterprise","logoStatus","gotoAppPage","showMenuFun","logout","clear","onViewLoad","log","menusFilter","item","functionCode","charAt","publicTableSearch","tabelname","value","$broadcast","name","initUserObjects","callbackFun","initMenus","getConfigsByGroupName","length","title","html","shortcut","attr","Date","getTime","rootModelsDic","getModelsByCondition","model","id","getKpisByModelId","subReturnObj","kpiDef","modelId","kpiDic","unit","unitLabel","range","test","rangeObj","rangeAry","Array","min","max","Object","modelLoader","getAllAttrs","attrDef","attrs","push","getDirectivesByModelId","dirDef","directives","getAllUnits","units","unitDics","unitCode","unitName","unitLoader","getAllDicts","dicts","dic","dictCode","items","queryUserByCondition","getAllUserInfoList","userID","deviceLoader","getAllDeviceInfos","externalDevId","hasOwnProperty","getSimpleDistricts","province","city","getAllDataTypes","allDataTypes","dashboardView","getAllMyViews","v","viewList","view","description","viewType","viewmenus","viewTitle","url","viewId","status","statusBg","statusLab","icon","splice","label","show","viewLoadFinished","getRootDomain","rootCi","getKpiTypeByFilter","newObj","text","defaultKpiList","domainsArr","domains","domainListTree","getResourceById","tc","domainPath","getDomainsByFilter","domainListDic","domainsLoader","domainTreeQuery","getDevicesByCondition","findProjectsByCondition","project","devDic","j","projectId","projectLabel","projectName","customerLabel","customerName","deviceDic","evt","isAuthenticated","lastLoginTime","newDateJson","Format","GetDateCategoryStrByLabel","FileUploader","fileMaxSize","fileFormat","queueLimit","uploader","serviceOrigin","withCredentials","removeAfterUpload","fileBelongDic","filters","fn","options","nameAry","type","warning","size","onWhenAddingFileFailed","onAfterAddingFile","fileItem","queue","removeFromQueue","onAfterAddingAll","addedFileItems","fileBelongId","onBeforeUploadItem","formData","onProgressItem","progress","onProgressAll","onSuccessItem","response","headers","onErrorItem","onCancelItem","onCompleteItem","state","message","onCompleteAll","uplaodHandler","uploadAll","scope","clearHandler","clearQueue","msg"],"mappings":"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","file":"js/controllers/appnav-ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.controller('AppNavCtrl', ['$scope', '$state', 'ngDialog', '$location', 'Info', 'alertService', 'userLoginUIService', 'viewFlexService', 'unitService', 'configUIService', 'resourceUIService', 'dictionaryService', 'ticketTaskService', '$route', '$timeout', '$rootScope', 'growl', 'userDomainService', 'userUIService', 'userEnterpriseService', '$q', '$registerService', 'psTreeData', 'psUiRouterHandler', 'commonMethodService', 'commonMethodService2', 'psConfig', 'projectUIService', function ($scope, $state, ngDialog, $location, Info, alertService, userLoginUIService, viewFlexService, unitService, configUIService, resourceUIService, dictionaryService, ticketTaskService, route, timeout, $rootScope, growl, userDomainService, userUIService, userEnterpriseService, q, registerService, psTreeData, psUiRouterHandler, cms, cms2, psConfig, projectUIService) {\n    var dialogInstance; // 弹出框实例\n\n    var localmodel = false; // 本地测试模式\n\n    var menuDisplayAlertCount = false; //菜单是否显示告警数量\n\n    runtime.init();\n    var target = new cms();\n    $scope.criticalCount = 0; // 菜单栏严重告警个数\n\n    $scope.orderCount = 0; // 待处理工单\n\n    $scope.myOptions; // 单位对象\n\n    $scope.myOptionDic; //单位字典\n\n    $scope.myDicts; // 配置项字典\n\n    $scope.provinces; // 省级区域\n\n    $scope.citys; // 市级区域\n\n    $scope.districts; // 县级区域\n\n    $scope.cityDics; // 市级区域\n\n    $scope.districtDics; // 县级区域\n    //    $scope.powers = {}; // 权限列表\n\n    $scope.alertView = []; //告警视图集合\n\n    $scope.designView = []; //性能视图集合\n\n    $scope.enterpriseType = 0; // 企业类型\n\n    $scope.treeviewIndex = \"\";\n    $scope.oldTreeviewIndex = \"\";\n    $scope.loadingShow = false; //true 显示loading false 隐藏\n\n    $scope.currentMenuCode = null; //当前的菜单编码\n\n    $scope.firstMenuCode = null; //第一层的菜单编码\n\n    $scope.localMenuCode = \"F01\"; //判断使用哪一个服务中心，用来替代localIndex\n\n    $scope.showMenu = false;\n    $scope.menuitems = {};\n    $scope.getAllUserInfo; //缓存用户信息\n\n    $scope.getAllDeviceInfo; //缓存设备信息\n    // 路由跳转成功后触发\n\n    $scope.$on('$routeChangeSuccess', function () {\n      userLoginUIService.rootHandler($scope, $location);\n      $scope.detailshow = route && route.$attr(\"current/params/mode\") == 'detail';\n    }); //弹出框的关闭事件\n\n    $scope.closeDialog = function () {\n      ngDialog.close();\n    };\n    /**\n     * 判断未登录后如何处理\n     * localmodel＝true 本地测试使用\n     */\n\n\n    function extend(a, b) {\n      for (var i in b) {\n        a[i] = b[i];\n      }\n\n      return a;\n    }\n\n    var showLogin = function showLogin() {\n      if (!localmodel) {\n        return;\n      }\n\n      dialogInstance = BootstrapDialog.show({\n        title: '欢迎来到普奥的世界',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: function message(dialog) {\n          var $message = $('<div></div>');\n          var pageToLoad = dialog.getData('pageToLoad');\n          $message.load(pageToLoad);\n          return $message;\n        },\n        data: {\n          'pageToLoad': 'partials/login.html'\n        },\n        buttons: [{\n          label: '登录',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            var userInput = document.getElementById('username');\n            var psdInput = document.getElementById('password');\n            userLoginUIService.login(userInput.value, psdInput.value);\n          }\n        }, {\n          label: '退出',\n          action: function action(dialogRef) {\n            dialogRef.close();\n            location.href = \"../index.html\";\n          }\n        }]\n      });\n    };\n    /**\n     * 获得基础配置\n     */\n\n\n    Info.get(\"../localdb/info.json\", function (info) {\n      if ($scope.baseConfig) {\n        delete info.customerConfig;\n        delete info.projectConfig;\n        $scope.baseConfig = jQuery.extend(true, $scope.baseConfig, info);\n      } else {\n        $scope.baseConfig = info;\n      }\n    });\n    /**\n     * 获得KPI的图片配置\n     */\n\n    Info.get(\"../localdb/icon.json\", function (info) {\n      $scope.kpiIconList = info.kpiIcon;\n    });\n    /**\n     * 切换角色的登陆状态\n     * 韩星 2018.01.08\n     */\n\n    function checkLoginAccont(userInfo) {\n      /**\n       * 1 该用户有几个角色\n       * 2 每个角色切换视图\n       */\n      function getCurrentLocation() {\n        var path = window.location.pathname,\n            match = /\\/(app\\-[\\w-]+)\\//.exec(path);\n        return match ? match[1] : null;\n      }\n\n      function getMainActiveIndexFromHash() {\n        var hash = window.location.hash,\n            arr = hash.split(\"/\");\n        return arr[4] - 0;\n      }\n\n      var watch = $scope.$watch('baseConfig', function (n, o, s) {\n        if (_typeof(n) === \"object\") {\n          var location = getCurrentLocation();\n\n          if (location === \"app-sc\" && !n.openSidebar) {\n            $(\".sidebar-toggle\").css(\"display\", \"none\");\n            $(\".main-sidebar\").css(\"display\", \"none\");\n            $(\".sidebar-mini.sidebar-collapse .content-wrapper\").css(\"cssText\", \"margin-left: 0px!important\");\n          }\n\n          watch();\n        }\n      });\n      userEnterpriseService.queryEnterpriseRole(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.index = getMainActiveIndexFromHash();\n          $scope.roles = returnObj.data ? returnObj.data.filter(function (ele) {\n            if (ele.roleID == \"100\") {\n              return false;\n            }\n\n            if (userInfo.roleID.indexOf(ele.roleID) == -1) {\n              return false;\n            }\n\n            return ele.values;\n          }) : [];\n          $scope.roleInfo = $scope.roles.find(function (n) {\n            return n.roleID == userLoginUIService.user.currentRoleID;\n          });\n\n          if (typeof $scope.roleInfo === \"undefinded\") {\n            throw new Error(\"role cannot be found on current user\");\n            return;\n          }\n\n          psConfig.setRoleValues($scope.roleInfo.values);\n\n          try {\n            $rootScope.tabs = JSON.parse($scope.roleInfo.values).children;\n          } catch (e) {\n            $rootScope.tabs = [];\n            console.error(e);\n            return;\n          }\n        }\n      });\n      $rootScope.$on(\"main_active_index\", function (event, index) {\n        $scope.index = index;\n        $rootScope.main_active_index = index;\n      });\n\n      $scope.navToPage = function (params, index) {\n        $rootScope.main_active_index = index;\n        $scope.index = params.index;\n        psUiRouterHandler(params).then(function (d) {\n          $state.go.apply($state, d);\n        });\n        /**\n         if (params.children && params.children.length > 0 && params.children[0].children && params.children[0].children.length > 0) {\n          window.location.href = \"../app-sc/index_freeboard.html#/prod_sub_dashboard/\" + params.showTree + \"/\" + index + \"/minor_dashboard/\"\n            + params.children[0].index + \"/minor_view/\" + params.children[0].children[0].viewId + \"/\" + params.children[0].children[0].index;\n        } else if (params.children && params.children.length > 0) {\n          window.location.href = \"../app-sc/index_freeboard.html#/prod_sub_dashboard/\" + params.showTree + \"/\" + index + \"/subview/\" + params.children[0].viewId + \"/\" + params.children[0].index + \"/index\";\n        } else {\n          if(typeof params.viewId == \"number\"){\n            $state.go(\"prod_dashboard\",{\n              showTree: params.showTree ,\n              main_active_index:index,\n              mainViewId:params.viewId ,\n              index:\"index\"\n            })\n          }else if(typeof params.viewId == \"string\") {\n             window.location.href = \"../app-sc/index_freeboard.html#/prod_dashboard/\" + params.showTree + \"/\" + index + \"/\" + params.viewId;\n          }else {\n            console.log(\"没有找到对应的视图！\")\n          }\n        }**/\n      };\n\n      $scope.changeRole = function (e) {\n        userLoginUIService.user.usercurrentRoleID = e.roleID + \"\";\n        userLoginUIService.user.currentRoleID = e.roleID;\n        psConfig.updateRoleValues(e.values).then(function (values) {\n          var default_tab = values.children[0];\n          $rootScope.tabs = values.children;\n          cms2.navigateTo(0);\n          /**\n           $state.go(\"prod_dashboard\",{\n            id : $state.params.id,\n            showTree:0,\n            main_active_index:default_tab.index,\n            viewId : default_tab.viewId,\n            index:\"index\",\n          })**/\n        }); // var urldata = $$.urlparse();\n        // window.location.href = urldata.originpath + \"?roleID=\" + e.roleID + \"#/freeboard/index\";\n        // index_freeboard.html#/prod_dashboard/0/0/407106366960019/index\n        // $rootScope.tabs = JSON.parse(e.values).children;\n      };\n\n      $scope.loginNames.forEach(function (ele, index, arr) {\n        if (ele.account == userInfo.loginName) {\n          $scope.loginName = $scope.loginNames[index];\n        }\n      }); // 缓存用户\n\n      if (userInfo.loginName == \"baowu_admin\" || userInfo.loginName == \"013346\" || userInfo.loginName == \"045400\" || userInfo.loginName == \"171171\" || userInfo.loginName == \"013346\") {\n        sessionStorage.setItem(\"loginNames\", userInfo);\n      } // 判断该不该显示选择框\n\n\n      if (sessionStorage.getItem(\"loginNames\")) {\n        $scope.isShowSelect = true;\n      } else {\n        $scope.isShowSelect = false;\n      }\n    }\n\n    var loginNames = [{\n      userName: '决策者虚拟工作台',\n      account: 'baowu_admin',\n      password: 'abc123'\n    }, {\n      userName: '报警管理虚拟工作台  ',\n      account: 'baowu_bj',\n      password: 'abc123'\n    }, {\n      userName: '诊断管理虚拟工作台   ',\n      account: 'baowu_fx',\n      password: 'abc123'\n    }, {\n      userName: '协同管理虚拟工作台   ',\n      account: 'baowu_xt',\n      password: 'abc123'\n    }, {\n      userName: '审核管理虚拟工作台   ',\n      account: 'baowu_sh',\n      password: 'abc123'\n    }, {\n      userName: '点检管理虚拟工作台   ',\n      account: 'baowu_dj',\n      password: 'abc123'\n    }, {\n      userName: '产线管理虚拟工作台   ',\n      account: 'baowu_cx',\n      password: 'abc123'\n    }, {\n      userName: '检修管理虚拟工作台   ',\n      account: 'baowu_jx',\n      password: 'abc123'\n    }, {\n      userName: '孟坤荫',\n      //  精密检测工程师\n      account: '170628',\n      password: 'abc123'\n    }, {\n      userName: '乐海滨',\n      //产线工程师\n      account: '041048',\n      password: 'abc123'\n    }, {\n      userName: '沈政',\n      //产线工程师\n      account: '171211',\n      password: 'abc123'\n    }, {\n      userName: '宋明中',\n      //总包诊断工程师\n      account: '080231',\n      password: 'abc123'\n    }, {\n      userName: '陈黎敏',\n      // 总包产线诊断\n      account: '190625',\n      password: 'abc123'\n    }, {\n      userName: '沈嘉麟',\n      //产线工程师\n      account: '170373',\n      password: 'abc123'\n    }, {\n      userName: '廖勇',\n      // 2050产线决策\n      account: '190712',\n      password: 'abc123'\n    }, {\n      userName: '陈红琳',\n      //'报警管理员',\n      account: '170307',\n      password: 'abc123'\n    }, {\n      userName: '张骏骋',\n      // 辊道备修工程师\n      account: '174079',\n      password: 'abc123'\n    }, {\n      userName: '腾威',\n      //辊道备修质量工程师\n      account: '171352',\n      password: 'abc123'\n    }, {\n      userName: '张君',\n      //访客工作台\n      account: '170381',\n      password: 'abc123'\n    }, {\n      userName: '陈弘',\n      //卷筒工作台\n      account: '171163',\n      password: 'abc123'\n    }, {\n      userName: '审核专家',\n      //审核专家\n      account: 'baowu_shzj',\n      password: 'abc123'\n    }, {\n      userName: '宋小佩',\n      //电厂脱硫系统\n      account: '190494',\n      password: 'abc123'\n    }, {\n      userName: '沈亮',\n      // 电厂脱硫产线工程师\n      account: '190426',\n      password: 'abc123'\n    }, {\n      userName: '炼铁厂(产内)',\n      // 电厂脱硫产线工程师\n      account: 'baowu_lt',\n      password: 'abc123'\n    }, {\n      userName: '万欣(测试新框架)',\n      // 电厂脱硫产线工程师\n      account: '170616',\n      password: 'abc123'\n    }, {\n      userName: '智能诊断工程师',\n      // 电厂脱硫产线工程师\n      account: '190747',\n      password: 'abc123'\n    }, {\n      userName: '葛申剑',\n      //产线工程师\n      account: '190747',\n      password: 'abc123'\n    }],\n        // 本地用户显示\n    loginNamesLocal = [{\n      userName: '智能产线工程师',\n      // 电厂脱硫产线工程师\n      account: '190520',\n      password: 'abc123'\n    }, {\n      userName: '环保管理员',\n      // 电厂脱硫产线工程师\n      account: 'baowu_huanbao',\n      password: 'abc123'\n    }, {\n      userName: '废水',\n      // 能环部废水\n      account: 'baowu_fs',\n      password: 'abc123'\n    }],\n        isLocal = function isLocal() {\n      var host = window.location.host;\n      return host && host.search('localhost') != -1 && host.search('127.0.0.1');\n    };\n\n    $scope.loginNames = isLocal() ? loginNames.concat(loginNamesLocal) : loginNames;\n\n    $scope.loginFun = function (e) {\n      userLoginUIService.loginCallback(e.account, e.password, function (userInfo) {\n        if (userInfo.code == 0) {\n          // 清除所有的设备除了用户的sessionStorage\n          for (var i in sessionStorage) {\n            if (i != \"loginNames\") {\n              sessionStorage.removeItem(i);\n            }\n          }\n\n          window.location.href = \"index.html\";\n        }\n      });\n    };\n\n    $scope.gotoHomePage = function () {\n      if (userLoginUIService.user.enterprise.logoStatus != '0') {\n        location.href = \"http://www.proudsmart.com\";\n      }\n    };\n\n    $scope.gotoAppPage = function () {\n      location.href = \"index.html\";\n    };\n\n    $scope.showMenuFun = function () {\n      $scope.showMenu = !$scope.showMenu;\n    };\n\n    $scope.logout = function () {\n      sessionStorage.clear();\n      userLoginUIService.logout();\n    };\n\n    $scope.onViewLoad = function () {\n      console.log('view changed');\n    };\n\n    function initUnit(callbackFun) {\n      unitService.getAllUnits(function (returnObj) {\n        if (returnObj.code == 0) {\n          unitService.units = returnObj.data;\n          $scope.myOptions = returnObj.data;\n          unitService.unitDics = {};\n\n          for (var i in $scope.myOptions) {\n            unitService.unitDics[$scope.myOptions[i].unitCode] = $scope.myOptions[i].unitName;\n            if ($scope.myOptions[i].unitCode == \"NA\" || $scope.myOptions[i].unitCode == \"Number\") unitService.unitDics[$scope.myOptions[i].unitCode] = \"\";\n          }\n\n          $scope.myOptionDic = unitService.unitDics;\n\n          if (callbackFun) {\n            callbackFun();\n          }\n\n          resourceUIService.unitLoader($scope.myOptionDic);\n        }\n      });\n      dictionaryService.getAllDicts(function (returnObj) {\n        if (returnObj.code == 0) {\n          dictionaryService.dicts = returnObj.data;\n          $scope.myDicts = returnObj.data;\n          var dic = {};\n\n          for (var i in returnObj.data) {\n            var obj = returnObj.data[i];\n\n            if (dic[obj.dictCode]) {\n              dic[obj.dictCode].push(obj);\n            } else {\n              dic[obj.dictCode] = [];\n              dic[obj.dictCode].push(obj);\n            }\n          }\n\n          for (var items in dic) {\n            $scope.myDicts[items] = dic[items];\n          }\n        }\n      });\n      /**\n       * 韩星 2018.2.6\n       * 缓存所有的用户\n       */\n\n      userUIService.queryUserByCondition({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          var getAllUserInfoList = returnObj.data;\n\n          for (var i in getAllUserInfoList) {\n            getAllUserInfoList[getAllUserInfoList[i].loginName] = getAllUserInfoList[i].userName;\n            getAllUserInfoList[getAllUserInfoList[i].userID] = getAllUserInfoList[i].userName;\n          }\n\n          $scope.getAllUserInfo = getAllUserInfoList;\n        }\n      });\n      /**\n       * 缓存所有的设备的部分字段(includeFields=label,externalDevId,id)\n       * HANXING 2018.3.28\n       */\n\n      resourceUIService.deviceLoader().then(function (getAllDeviceInfos) {\n        var obj = {};\n\n        for (var i in getAllDeviceInfos) {\n          obj[getAllDeviceInfos[i].id] = getAllDeviceInfos[i];\n          obj[getAllDeviceInfos[i].externalDevId] = getAllDeviceInfos[i];\n        }\n\n        $scope.getAllDeviceInfo = obj;\n      });\n\n      if (!resourceUIService.hasOwnProperty(\"provinces\")) {\n        resourceUIService.getSimpleDistricts(function (returnObj) {\n          if (returnObj.code == 0) {\n            resourceUIService.provinces = returnObj.data;\n            $scope.provinces = returnObj.data;\n            $scope.cityDics = {};\n            $scope.districtDics = {};\n            $scope.provinces.forEach(function (province) {\n              $scope.cityDics[province.id] = province.children;\n              province.children.forEach(function (city) {\n                $scope.districtDics[city.id] = city.children;\n              });\n            });\n          }\n        });\n      }\n\n      resourceUIService.getAllDataTypes(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.allDataTypes = returnObj.data;\n        }\n      });\n    }\n\n    ;\n\n    function initRootDomain() {\n      resourceUIService.getRootDomain(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data) {\n            $scope.rootCi = returnObj.data.id;\n          } else {\n            growl.error(\"当前用户不存在rootCi，请联系客服处理。\", {});\n          }\n        }\n      });\n    }\n\n    ;\n    /**\n     * 获得基本的模型定义，包括：\n     * 测点定义\n     * 指令定义\n     * 属性定义\n     */\n\n    var initRootModels = function initRootModels() {\n      $rootScope.rootModelsDic = {};\n      resourceUIService.rootModelsDic = $rootScope.rootModelsDic;\n      resourceUIService.getModelsByCondition({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.forEach(function (model) {\n            if (!$rootScope.rootModelsDic[model.id]) $rootScope.rootModelsDic[model.id] = {};\n            $rootScope.rootModelsDic[model.id].model = model;\n          }); //-1表示查询所有的模版上的KPI\n\n          resourceUIService.getKpisByModelId(-1, function (subReturnObj) {\n            if (subReturnObj.code == 0) {\n              subReturnObj.data.forEach(function (kpiDef) {\n                if (!$rootScope.rootModelsDic[kpiDef.modelId]) return;\n                if (!$rootScope.rootModelsDic[kpiDef.modelId].kpiDic) $rootScope.rootModelsDic[kpiDef.modelId].kpiDic = {};\n                if ($scope.myOptionDic[kpiDef.unit]) kpiDef.unitLabel = $scope.myOptionDic[kpiDef.unit];\n                var regExp = /\\{|\\[.*\\}|\\]/;\n\n                if (kpiDef.range) {\n                  var find = regExp.test(kpiDef.range);\n                  var rangeObj = [];\n\n                  if (find) {\n                    try {\n                      rangeObj = find ? JSON.parse(kpiDef.range) : [];\n                    } catch (e) {}\n                  }\n\n                  kpiDef.rangeAry = rangeObj;\n\n                  if (rangeObj instanceof Array) {\n                    kpiDef.rangeAry = rangeObj;\n\n                    if (rangeObj.length == 2) {\n                      kpiDef.min = rangeObj[0];\n                      kpiDef.max = rangeObj[1];\n                    }\n                  } else if (rangeObj instanceof Object) {\n                    kpiDef.rangeObj = rangeObj;\n                  }\n                }\n\n                $rootScope.rootModelsDic[kpiDef.modelId].kpiDic[kpiDef.id] = kpiDef;\n              });\n              resourceUIService.modelLoader($rootScope.rootModelsDic);\n            }\n          }); //获得所有模板的属性\n\n          resourceUIService.getAllAttrs(function (subReturnObj) {\n            if (subReturnObj.code == 0) {\n              subReturnObj.data.forEach(function (attrDef) {\n                if (!$rootScope.rootModelsDic[attrDef.modelId]) return;\n                if (!$rootScope.rootModelsDic[attrDef.modelId].attrs) $rootScope.rootModelsDic[attrDef.modelId].attrs = [];\n                $rootScope.rootModelsDic[attrDef.modelId].attrs.push(attrDef);\n              });\n            }\n          }); //-1表示获得所有模板的指令\n\n          resourceUIService.getDirectivesByModelId(-1, function (subReturnObj) {\n            if (subReturnObj.code == 0) {\n              subReturnObj.data.forEach(function (dirDef) {\n                if (!$rootScope.rootModelsDic[dirDef.modelId]) return;\n                if (!$rootScope.rootModelsDic[dirDef.modelId].directives) $rootScope.rootModelsDic[dirDef.modelId].directives = [];\n                $rootScope.rootModelsDic[dirDef.modelId].directives.push(dirDef);\n              });\n            }\n          });\n        }\n      });\n    }; //    var setPower = function(pow, len) {\n    //      pow = pow.substring(0, len);\n    //      $scope.powers[pow] = true;\n    //      if(len > 5) {\n    //        setPower(pow, len - 2);\n    //      }\n    //    };\n    //\n    //    var initPower = function() {\n    //      for(var i in userLoginUIService.user.functionCodeSet) {\n    //        var funCode = userLoginUIService.user.functionCodeSet[i];\n    //        $scope.powers[funCode] = true;\n    //        if(funCode.length > 5) {\n    //          setPower(funCode, funCode.length - 2);\n    //        }\n    //      }\n    //    };\n\n\n    var initCount = function initCount() {\n      if (menuDisplayAlertCount) {\n        var params = {};\n        params.states = \"0\";\n        alertService.countFromCache(params, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.criticalCount = returnObj.data.criticalCount;\n          }\n        }); //获取执行中工单\n\n        var status = 100;\n        ticketTaskService.getTicketsByStatus(status, function (m) {\n          if (m.code == 0) {\n            $scope.orderCount = m.data.length;\n          }\n        });\n      }\n    };\n\n    function initViews() {\n      $scope.alertView = [];\n      $scope.designView = [];\n      $scope.dashboardView = [];\n      viewFlexService.getAllMyViews(function (returnObj) {\n        if (returnObj.code == 0) {\n          var v = returnObj.data;\n          var viewList = [];\n\n          for (var i = 0; i < v.length; i++) {\n            var view = v[i];\n\n            if (view) {\n              viewList.push(view);\n              var description = {};\n\n              if (typeof view.description == \"string\") {\n                var objectLike = /^\\{(.|\\n)*\\}$/;\n                var reg = objectLike.test(view.description);\n\n                if (reg) {\n                  description = JSON.parse(view.description);\n                }\n              }\n\n              if (view.viewType == \"designView\") {\n                var viewmenus = {\n                  \"title\": view.viewTitle.split(\"?\")[0],\n                  \"url\": \"#/\" + view.viewType + \"/\" + view.viewId,\n                  \"viewId\": view.viewId,\n                  \"view\": view,\n                  \"status\": description['status'],\n                  \"statusBg\": description[\"status\"] == 1 ? 'bg-red' : description[\"status\"] == 2 ? 'bg-green' : '',\n                  \"statusLab\": description[\"status\"] == 1 ? '授权' : description[\"status\"] == 2 ? '购买' : '',\n                  \"icon\": \"fa fa-area-chart\"\n                };\n                $scope.designView.push(viewmenus);\n              } else if (view.viewType == \"configAlert\") {\n                var viewmenus = {\n                  \"title\": view.viewTitle.split(\"?\")[0],\n                  \"url\": \"#/\" + view.viewType + \"/\" + view.viewId,\n                  \"viewId\": view.viewId,\n                  \"view\": view,\n                  \"status\": description[\"status\"],\n                  \"statusBg\": description[\"status\"] == 1 ? 'bg-red' : description[\"status\"] == 2 ? 'bg-green' : '',\n                  \"statusLab\": description[\"status\"] == 1 ? '授权' : description[\"status\"] == 2 ? '购买' : '',\n                  \"icon\": \"fa fa-warning\"\n                };\n\n                if (viewmenus.title == \"全部告警\") {\n                  $scope.alertView.splice(0, 0, viewmenus);\n                } else {\n                  $scope.alertView.push(viewmenus);\n                }\n              } else if (view.viewType == \"dashboard\") {\n                view.label = view.viewTitle;\n                view.show = true;\n                $scope.dashboardView.push(view);\n              }\n            }\n          }\n          /* for(var i = 0; i < 1; i++){\n           var viewmenus = {\n           \"title\": \"viewmenus\" + i,\n           \"url\": \"#\",\n           \"viewId\": i,\n           \"icon\": \"fa fa-warning\",\n           \"view\" : {\n           \"viewId\" : 123\n           }\n           };\n           $scope.alertView.push(viewmenus);\n           }*/\n\n\n          viewFlexService.viewLoadFinished = true;\n          viewFlexService.viewList = viewList;\n          $scope.viewList = viewList;\n          $scope.$broadcast('viewLoadFinished');\n        }\n      });\n    }\n\n    ;\n\n    var initDefaultKpis = function initDefaultKpis() {\n      resourceUIService.getKpiTypeByFilter({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          var newObj = [];\n          returnObj.data.forEach(function (obj) {\n            obj.text = obj.label;\n            newObj.push(obj);\n          });\n          $scope.defaultKpiList = newObj;\n        }\n      });\n    }; //做一个device的缓存，系统90%之上的表格都需要设备 客户 项目名称；\n\n\n    var initDevDic = function initDevDic() {\n      resourceUIService.getDevicesByCondition({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          projectUIService.findProjectsByCondition({}, function (project) {\n            var devDic = {};\n\n            for (var i = 0; i < returnObj.data.length; i++) {\n              for (var j = 0; j < project.data.length; j++) {\n                if (returnObj.data[i].projectId == project.data[j].id) {\n                  returnObj.data[i].projectLabel = project.data[j].projectName;\n                  returnObj.data[i].customerLabel = project.data[j].customerName;\n                }\n              }\n            }\n\n            returnObj.data.forEach(function (data) {\n              devDic[data.id] = data;\n            });\n            $rootScope.deviceDic = devDic;\n          });\n        }\n      }, \"includeFields=label,id,projectId,domains,modelId,customerId,sn\");\n    };\n\n    $scope.menusFilter = function (item) {\n      return item.functionCode.charAt(0) === \"S\";\n    };\n\n    $scope.publicTableSearch = function (tabelname, value) {\n      $scope.$broadcast('table-search-handle', {\n        name: tabelname,\n        value: value\n      });\n    };\n\n    var initConfigManager = function initConfigManager(callbackFun) {\n      configUIService.getConfigsByGroupName(\"EnterpriseConfig\", function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data && returnObj.data.length > 0) {\n            returnObj.data.forEach(function (item) {\n              try {\n                if ($scope.baseConfig) {\n                  $scope.baseConfig = jQuery.extend(true, $scope.baseConfig, JSON.parse(item.value));\n                } else {\n                  $scope.baseConfig = JSON.parse(item.value);\n                }\n\n                if ($scope.baseConfig) {\n                  //拥有企业设置\n                  if ($scope.baseConfig.title) $(\"title\").html($scope.baseConfig.title);else $(\"title\").html(\"\");\n                  if ($scope.baseConfig.shortcut) $(\"link[rel='shortcut icon']\").attr(\"href\", $scope.baseConfig.shortcut + \"?\" + new Date().getTime());else $(\"link[rel='shortcut icon']\").attr(\"href\", \"../login/images/shortcut_null.png\" + \"?\" + new Date().getTime());\n                }\n              } catch (e) {}\n            });\n          } else {\n            $(\"title\").html(\"\");\n            $(\"link[rel='shortcut icon']\").attr(\"href\", \"../login/images/shortcut_null.png\" + \"?\" + new Date().getTime());\n          }\n\n          callbackFun();\n        }\n      });\n    };\n\n    var domainTreeQuery = function domainTreeQuery() {\n      // 获取当前用户的domains\n      var domainsArr = userLoginUIService.user.domains.split(\"/\");\n      var domainListTree = {};\n\n      for (var i = 2; i < domainsArr.length - 1; i++) {\n        resourceUIService.getResourceById([domainsArr[i]], function (tc) {\n          domainListTree[tc.data.domainPath] = tc.data;\n          domainListTree[tc.data.id] = tc.data;\n        });\n      }\n\n      resourceUIService.getDomainsByFilter({}, function (tc) {\n        for (var i in tc.data) {\n          domainListTree[tc.data[i].domainPath] = tc.data[i];\n          domainListTree[tc.data[i].id] = tc.data[i];\n        }\n\n        $rootScope.domainListDic = domainListTree;\n        resourceUIService.domainsLoader(domainListTree);\n      });\n    };\n\n    function initUserObjects() {\n      initConfigManager(function () {\n        userLoginUIService.initMenus($scope, $location);\n      });\n      initUnit(function () {\n        initRootModels();\n      });\n      initViews();\n      initRootDomain();\n      initCount();\n      initDefaultKpis();\n      domainTreeQuery();\n      initDevDic();\n    }\n\n    ; // 监听用户登录状态\n\n    $scope.$on('loginStatusChanged', function (evt, d) {\n      if (userLoginUIService.user.isAuthenticated) {\n        if (dialogInstance) {\n          dialogInstance.close();\n        }\n\n        $scope.userInfo = userLoginUIService.user;\n        $scope.lastLoginTime = newDateJson(userLoginUIService.user.lastLoginTime).Format(GetDateCategoryStrByLabel());\n        if (userLoginUIService.user.enterprise) $scope.enterpriseType = userLoginUIService.user.enterprise.enterpriseType;\n        initUserObjects();\n        checkLoginAccont($scope.userInfo);\n      } else {\n        $scope.userInfo = {};\n        $scope.lastLoginTime = \"\";\n        showLogin();\n      }\n    });\n  }]);\n  controllers.controller('AppUploadCtrl', ['$scope', 'growl', 'FileUploader', function ($scope, growl, FileUploader) {\n    $scope.fileMaxSize = $scope.fileMaxSize ? $scope.fileMaxSize : 1;\n    $scope.fileFormat = $scope.fileFormat ? $scope.fileFormat : \"jpg、png、jpeg、bmp、gif、svg\";\n    $scope.queueLimit = $scope.queueLimit ? $scope.queueLimit : 1;\n    var uploader = $scope.uploader = new FileUploader({\n      url: $scope.serviceOrigin,\n      withCredentials: true,\n      //      queueLimit: 1, //文件个数\n      removeAfterUpload: true //上传后删除文件\n\n    });\n    uploader.fileBelongDic = {}; // FILTERS\n\n    uploader.filters.push({\n      name: 'fileFilter',\n      fn: function fn(item, options) {\n        var nameAry = item.name.split(\".\");\n        var type = nameAry[nameAry.length - 1];\n\n        if ($scope.fileFormat.indexOf(type) == -1) {\n          growl.warning(\"文件格式仅支持\" + $scope.fileFormat + \"文件，请重新选择\", {});\n          return false;\n        }\n\n        if (item.size / 1024 > $scope.fileMaxSize * 1000) {\n          growl.warning(\"您选择的文件大于\" + $scope.fileMaxSize + \"M，请重新选择\", {});\n          return false;\n        }\n\n        return true;\n      }\n    }); // CALLBACKS\n\n    uploader.onWhenAddingFileFailed = function (item, filter, options) {\n      //      uploader.clearQueue();\n      //      uploader.destroy();\n      console.info('onWhenAddingFileFailed', item, filter, options);\n    };\n\n    uploader.onAfterAddingFile = function (fileItem) {\n      if (uploader.queue.length > $scope.queueLimit) uploader.removeFromQueue(uploader.queue.length.length - 1);\n      console.info('onAfterAddingFile', fileItem);\n    };\n\n    uploader.onAfterAddingAll = function (addedFileItems) {\n      if (uploader.fileBelongId) {\n        uploader.fileBelongDic[uploader.fileBelongId] = addedFileItems;\n      }\n\n      $scope.$broadcast(\"onAfterAddingAll\", {\n        addedFileItems: addedFileItems\n      });\n      console.info('onAfterAddingAll', addedFileItems);\n    };\n\n    uploader.onBeforeUploadItem = function (item) {\n      Array.prototype.push.apply(item.formData, uploader.formData);\n      console.info('onBeforeUploadItem', item);\n    };\n\n    uploader.onProgressItem = function (fileItem, progress) {\n      console.info('onProgressItem', fileItem, progress);\n    };\n\n    uploader.onProgressAll = function (progress) {\n      console.info('onProgressAll', progress);\n    };\n\n    uploader.onSuccessItem = function (fileItem, response, status, headers) {\n      console.info('onSuccessItem', fileItem, response, status, headers);\n    };\n\n    uploader.onErrorItem = function (fileItem, response, status, headers) {\n      growl.warning(\"上传文件失败\", {});\n      $scope.loadingShow = false;\n      console.info('onErrorItem', fileItem, response, status, headers);\n    };\n\n    uploader.onCancelItem = function (fileItem, response, status, headers) {\n      console.info('onCancelItem', fileItem, response, status, headers);\n    };\n\n    uploader.onCompleteItem = function (fileItem, response, status, headers) {\n      console.info('onCompleteItem', fileItem, response, status, headers);\n      uploader.formData = []; //清空参数\n\n      if (response) {\n        if (response.code == 0) $scope.$broadcast(\"uploadTemplate\", {\n          state: true,\n          response: response\n        });else growl.error(response.message, {});\n        $scope.loadingShow = false;\n      } else {\n        growl.error(\"操作异常了，尝试重新刷新\", {});\n      }\n    };\n\n    uploader.onCompleteAll = function () {\n      console.info('onCompleteAll');\n    };\n\n    uploader.uplaodHandler = function () {\n      uploader.uploadAll();\n      scope.loadingShow = true;\n      uploader.fileBelongDic = {};\n      uploader.fileBelongId = \"\";\n    };\n\n    uploader.clearHandler = function () {\n      uploader.clearQueue();\n      uploader.fileBelongDic = {};\n      uploader.fileBelongId = \"\";\n    };\n\n    uploader.growl = function (msg) {\n      growl.info(msg, {});\n    };\n  }]);\n});"],"sourceRoot":"/source/"}