{"version":3,"sources":["js/controllers/configure-ctrl.js"],"names":["define","controllers","BootstrapDialog","controller","$scope","$rootScope","$location","$timeout","growl","userLoginUIService","resourceUIService","viewFlexService","userDomainService","solutionUIService","unitService","configUIService","location","hash","search","href","errorMsg","slide","treeAry","configureView","echartView","configViewBg","configCustoms","configCommons","myOptions","treeviewIndex","oldTreeviewIndex","defaultRoute","currentMenuCode","firstMenuCode","localMenuCode","showMenu","menuitems","$on","rootHandler","alertLevels","label","id","stateDisplayModel","type","stateTypeModel","selectTypes","unitTypes","homeClick","flg","dirty","show","title","closable","message","buttons","cssClass","action","dialogRef","save4Json","status","close","indexShow","personalShow","routePathNodes","initModelAtts","obj","idx","count","model","callback","Math","random","icon","alertlv","isLoaded","text","name","getManagedDevicesByModelId","returnObj","code","resources","concat","data","getResourceByModelId","getAttrsByModelId","attrs","getDataItemsByModelId","kpis","getDirectivesByModelId","urmpTree","ciName","getGroupModels","returnGroup","getModels","rootModelDic","tree","i","parentModelId","push","addNodes","parentNode","modeid","nodes","length","key","rootModel","typeAry","handler","sidebarMenuClick","item","selectDashboard","viewId","window","open","$broadcast","logout","domains","domainTreeQuery","queryDomainTree","user","userID","domainListTree","domainListDic","domainsAry","domainPath","foreachdomains","lv","forEach","domain","breaks","getbreak","initstate","init","getRootModel","selectedParentitem","initConfigManager","callbackFun","getConfigsByGroupName","baseConfig","jQuery","extend","JSON","parse","value","$","html","shortcut","attr","Date","getTime","e","url","coustom","keyDesc","s","width","height","base","size","image","xlink:href","font-size","stroke","display","stroke-width","fill","ref-dy","font-family","initRootModels","rootModelsDic","getModelsByCondition","getKpisByModelId","subReturnObj","kpiDef","kpiDic","myOptionDic","unit","unitLabel","range","find","test","rangeObj","rangeAry","Array","min","max","Object","directives","isAuthenticated","initUnit","initViews","initMenus","evt","d","staffName","userName","userInfo","result","errorStatus","viewTitle","dashboardView","getAllMyViews","viewType","sort","a","b","releaseStatus","getAllUnits","units","unitDics","unitCode","unitName"],"mappings":"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","file":"js/controllers/configure-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict'; //根据接口调用自定义视图获取\n  //用户登录userLoginUIService\n\n  controllers.controller('ConfigureCtrl', ['$scope', '$rootScope', '$location', '$timeout', 'growl', 'userLoginUIService', 'resourceUIService', 'viewFlexService', 'userDomainService', 'solutionUIService', 'unitService', 'configUIService', function ($scope, $rootScope, $location, $timeout, growl, userLoginUIService, resourceUIService, viewFlexService, userDomainService, solutionUIService, unitService, configUIService) {\n    if (location.hash == \"\" || location.hash.search(\"#/index\") > -1) {\n      location.href = \"../app-oc/index.html#/configureview\";\n      return;\n    }\n\n    $scope.errorMsg = \"\";\n    $scope.slide = \"1\"; //    $scope.powers = {};\n\n    $scope.treeAry = [];\n    $scope.configureView = []; //组态视图集合\n\n    $scope.echartView = []; //组态视图集合\n\n    $scope.configViewBg = []; //组态自定义背景集合\n\n    $scope.configCustoms = []; //组态自定义组件集合\n\n    $scope.configCommons = []; //组态自定义组件集合\n\n    $scope.myOptions;\n    $scope.treeviewIndex = \"\";\n    $scope.oldTreeviewIndex = \"\";\n    $scope.defaultRoute = \"../app-oc/index.html#/configureview\";\n    $scope.currentMenuCode = null; //当前的菜单编码\n\n    $scope.firstMenuCode = null; //第一层的菜单编码\n\n    $scope.localMenuCode = \"F01\"; //判断使用哪一个服务中心，用来替代localIndex\n\n    $scope.showMenu = false;\n    $scope.menuitems = {}; // 路由跳转成功后触发\n\n    $scope.$on('$routeChangeSuccess', function () {\n      userLoginUIService.rootHandler($scope, $location);\n    });\n\n    function initMenus() {\n      function menuhandle(menuInfo) {\n        menuInfo.searchUrl = menuInfo.url ? menuInfo.url.substring(1) + \"/\" : \"\"; //菜单选中状态用\n\n        if (menuInfo.function) {\n          menuInfo.function.forEach(function (handlemenu) {\n            menuInfo.searchUrl = menuInfo.searchUrl + (handlemenu.url ? handlemenu.url.substring(1) + \"/\" : \"\");\n            $scope.menuitems[handlemenu.functionCode] = handlemenu;\n            if (handlemenu.url) $scope.menuitems[handlemenu.url] = handlemenu;\n            menuhandle(handlemenu);\n          });\n        }\n      }\n\n      $scope.userInfo.functionList.forEach(function (menu) {\n        $scope.menuitems[menu.functionCode] = menu;\n        if (menu.url) $scope.menuitems[menu.url] = menu;\n        menuhandle(menu);\n      });\n      $scope.menuitems[\"isloaded\"] = true; //加载完毕\n\n      rootHandler();\n    }\n\n    $scope.alertLevels = [{\n      label: '正常',\n      id: 0\n    }, {\n      label: '警告',\n      id: 1\n    }, {\n      label: '次要',\n      id: 2\n    }, {\n      label: '重要',\n      id: 3\n    }, {\n      label: '严重',\n      id: 4\n    }];\n    $scope.stateDisplayModel = [{\n      label: '不显示',\n      id: 0,\n      type: 'basic.Text,basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image'\n    }, {\n      label: '仅背景',\n      id: 1,\n      type: 'basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon'\n    }, {\n      label: '仅文字',\n      id: 2,\n      type: 'basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image'\n    }, {\n      label: '全显示',\n      id: 3,\n      type: 'basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon'\n    }];\n    $scope.stateTypeModel = [{\n      label: '默认',\n      id: 0,\n      type: 'basic.Text,basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image'\n    }, {\n      label: '呼吸灯',\n      id: 1,\n      type: 'basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image'\n    }, {\n      label: '气泡',\n      id: 2,\n      type: 'basic.Circle'\n    }, {\n      label: '呼吸灯(忽略透明)',\n      id: 3,\n      type: 'basic.Rect,basic.Circle,basic.Rhombus,basic.Path,basic.Polygon,basic.Image'\n    }, {\n      label: '气泡(忽略透明)',\n      id: 4,\n      type: 'basic.Circle'\n    }];\n    $scope.selectTypes = [{\n      label: '按域选择',\n      id: 0\n    }, {\n      label: '按设备类型选择',\n      id: 1\n    }];\n    $scope.unitTypes = [{\n      label: '不显示',\n      id: 0\n    }, {\n      label: '显示',\n      id: 1\n    }]; //    var setPower = function(pow, len) {\n    //      pow = pow.substring(0, len);\n    //      $scope.powers[pow] = true;\n    //      if(len > 5) {\n    //        setPower(pow, len - 2);\n    //      }\n    //    }\n    //    var initPower = function() {\n    //      for(var i in userLoginUIService.user.functionCodeSet) {\n    //        var funCode = userLoginUIService.user.functionCodeSet[i];\n    //        $scope.powers[funCode] = true;\n    //        if(funCode.length > 5) {\n    //          setPower(funCode, funCode.length - 2);\n    //        }\n    //      }\n    //    }\n\n    $scope.homeClick = function (flg) {\n      if (flg == 1) {\n        // window.open(\"http://www.proudsmart.com\");\n        location.href = \"../app-oc/index.html#/dashboard\";\n      } else {\n        if ($rootScope.dirty == true) {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            message: '视图尚未保存，要在退出前保存吗？',\n            buttons: [{\n              label: '保存退出',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                $rootScope.save4Json(function (status) {\n                  dialogRef.close();\n                  location.href = \"../app-oc/index.html#/views/configure\";\n                });\n              }\n            }, {\n              label: '退出',\n              action: function action(dialogRef) {\n                location.href = \"../app-oc/index.html#/views/configure\";\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else {\n          location.href = \"../app-oc/index.html#/views/configure\";\n        }\n\n        ;\n      }\n    };\n\n    $rootScope.indexShow = false;\n    $rootScope.personalShow = true;\n    $scope.routePathNodes = {};\n\n    var getResources = function getResources(model, callback) {\n      if (model.type == \"Device\") {\n        resourceUIService.getManagedDevicesByModelId(model.id, function (returnObj) {\n          if (returnObj.code == 0) {\n            model.resources = [{\n              id: 0,\n              label: \"无\"\n            }].concat(returnObj.data);\n\n            if (callback) {\n              callback();\n            }\n          }\n\n          ;\n        });\n      } else {\n        resourceUIService.getResourceByModelId(model.id, function (returnObj) {\n          if (returnObj.code == 0) {\n            model.resources = [{\n              id: 0,\n              label: \"无\"\n            }].concat(returnObj.data);\n\n            if (callback) {\n              callback();\n            }\n          }\n\n          ;\n        });\n      }\n    };\n\n    var getResourceAttrs = function getResourceAttrs(model, callback) {\n      resourceUIService.getAttrsByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.attrs = returnObj.data;\n          model.isLoaded = model.isLoaded + 1;\n\n          if (callback) {\n            callback();\n          }\n        }\n\n        ;\n      });\n    };\n\n    var getResourceKpis = function getResourceKpis(model) {\n      resourceUIService.getDataItemsByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.kpis = [{\n            id: 0,\n            label: \"无\"\n          }].concat(returnObj.data);\n        }\n\n        ;\n      });\n    };\n    /**\n     * 获得模型下的指令\n     * @param {Object} model\n     */\n\n\n    var getResourceDirectives = function getResourceDirectives(model) {\n      resourceUIService.getDirectivesByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model[\"directives\"] = returnObj.data;\n        }\n\n        ;\n      });\n    };\n\n    var initModelAtts = function initModelAtts(obj, idx) {\n      obj.count = 0;\n      var random = Math.random();\n      obj.icon = obj.icon ? obj.icon : 'fa fa-building-o';\n      obj.alertlv = \"bg-green\"; //random > 0.75 ? \"bg-red\" : (random > 0.5 ? \"bg-orange\" : (random > 0.25 ? \"bg-yellow\" : \"bg-green\"));\n\n      obj.isLoaded = 0;\n      obj.type = 0;\n      obj.text = obj.label;\n      obj.name = obj.label;\n      getResources(obj);\n      getResourceAttrs(obj);\n      getResourceKpis(obj);\n      getResourceDirectives(obj);\n      return obj;\n    };\n\n    var urmpTree = function urmpTree(ciName) {\n      var handler = function handler(returnObj) {\n        if (returnObj.code == 0) {\n          resourceUIService.rootModelDic = {};\n          var tree = returnObj.data;\n\n          for (var i in tree) {\n            var obj = tree[i];\n            if (!$scope.routePathNodes[obj.parentModelId]) $scope.routePathNodes[obj.parentModelId] = [];\n            $scope.routePathNodes[obj.parentModelId].push(obj);\n            if (!$scope.routePathNodes[obj.id]) $scope.routePathNodes[obj.id] = [];\n            resourceUIService.rootModelDic[obj.id] = obj;\n            initModelAtts(obj);\n          }\n\n          var addNodes = function addNodes(parentNode) {\n            for (var modeid in $scope.routePathNodes) {\n              if (modeid == parentNode.id) {\n                parentNode.nodes = $scope.routePathNodes[modeid];\n\n                for (var i in parentNode.nodes) {\n                  addNodes(parentNode.nodes[i]);\n                }\n\n                if (parentNode.nodes.length == 0) {\n                  parentNode.nodes = null;\n                }\n              }\n            }\n          };\n\n          addNodes(resourceUIService.rootModel);\n\n          for (var key in $scope.routePathNodes) {\n            if (key != resourceUIService.rootModel.id && !resourceUIService.rootModelDic[key]) {\n              for (var i in $scope.routePathNodes[key]) {\n                addNodes($scope.routePathNodes[key][i]);\n                if (!resourceUIService.rootModel.nodes) resourceUIService.rootModel.nodes = [];\n                resourceUIService.rootModel.nodes.push($scope.routePathNodes[key][i]);\n              }\n            }\n          }\n\n          resourceUIService.rootModelDic[resourceUIService.rootModel.id] = resourceUIService.rootModel;\n          $scope.rootModelDic = resourceUIService.rootModelDic;\n          $scope.rootModel = resourceUIService.rootModel;\n          $scope.treeAry = [{\n            id: 0,\n            label: \"请选择\"\n          }].concat(tree);\n          $scope.typeAry = [{\n            id: 0,\n            label: \"普通\"\n          }, {\n            id: 1,\n            label: \"模板\"\n          }, {\n            id: 2,\n            label: \"项目\"\n          }];\n        }\n      };\n\n      solutionUIService.getGroupModels(function (returnGroup) {\n        if (returnGroup.code == 0) {\n          resourceUIService.getModels(function (returnObj) {\n            returnObj.data = returnObj.data.concat(returnGroup.data);\n            handler(returnObj);\n          });\n        }\n      });\n    };\n\n    function initViews() {\n      $scope.configureView = [{\n        viewId: 0,\n        viewTitle: '不可下钻'\n      }, {\n        viewId: 1,\n        viewTitle: '可下钻，无子视图'\n      }];\n      $scope.echartView = [{\n        viewId: 0,\n        viewTitle: '无'\n      }];\n      $scope.dashboardView = [];\n      $scope.selectDashboard = null;\n      viewFlexService.getAllMyViews(function (returnObj) {\n        if (returnObj.code == 0) {\n          var dashboardView = [];\n          returnObj.data.forEach(function (item) {\n            if (item.viewType == \"configure\") {\n              $scope.configureView.push(item);\n            }\n\n            if (item.viewType == \"designView\") {\n              $scope.echartView.push(item);\n            }\n\n            if (item.viewType == \"dashboard\") {\n              item.icon = \"proudsmart ps-yunyingshouye\";\n              item.show = true;\n              dashboardView.push(item);\n            }\n          });\n          dashboardView = dashboardView.sort(function (a, b) {\n            return a.releaseStatus < b.releaseStatus;\n          });\n          dashboardView[0].show = false;\n          if (!$scope.selectDashboard) $scope.selectDashboard = dashboardView[0];\n          dashboardView.push({\n            viewTitle: \"添加自定义工作台\",\n            viewId: 0,\n            icon: \"fa fa-plus-square\"\n          });\n          $scope.dashboardView = dashboardView;\n          $scope.$broadcast('RAPPIDVIEWS', {\n            \"data\": $scope.configureView\n          });\n        }\n      });\n    }\n\n    $scope.sidebarMenuClick = function (item, flg) {\n      if ($scope.selectDashboard == item && item.viewId != 0) return;\n      $scope.selectDashboard = item;\n\n      if (item.viewId == 0) {\n        window.open(\"../app-freeboard/index.html#/freeboard/view/dashboard\", \"_blank\");\n      } else {\n        if (flg) {\n          window.open(\"../app-freeboard/index.html#/freeboard/view/dashboard/\" + item.viewId + \"/0\", \"_blank\");\n        } else {\n          $scope.$broadcast('CHANGEDASHBOARDVIEWS', {\n            \"data\": $scope.selectDashboard\n          });\n        }\n      }\n    };\n\n    $scope.logout = function () {\n      userLoginUIService.logout();\n    };\n\n    $scope.domains = [];\n\n    var getbreak = function getbreak(lv) {\n      var breaks = \"\";\n\n      for (var i = 0; i < lv; i++) {\n        breaks += \"*\";\n      }\n\n      return breaks;\n    };\n\n    var foreachdomains = function foreachdomains(domains, lv, domainsAry) {\n      domains.forEach(function (domain) {\n        domain.text = getbreak(lv) + domain.text;\n        domainsAry.push(domain);\n\n        if (domain.nodes) {\n          foreachdomains(domain.nodes, lv + 2, domainsAry);\n        }\n      });\n    };\n\n    var domainTreeQuery = function domainTreeQuery() {\n      userDomainService.queryDomainTree(userLoginUIService.user.userID, function (data) {\n        $scope.domainListTree = data.domainListTree;\n        $scope.domainListDic = data.domainListDic;\n        var domainsAry = [{\n          domainPath: \"\",\n          text: \"无\"\n        }];\n        foreachdomains($scope.domainListTree, 0, domainsAry);\n        $scope.domains = domainsAry;\n      });\n    };\n\n    function initUnit(callbackFun) {\n      unitService.getAllUnits(function (returnObj) {\n        if (returnObj.code == 0) {\n          unitService.units = returnObj.data;\n          $scope.myOptions = returnObj.data;\n          unitService.unitDics = {};\n\n          for (var i in $scope.myOptions) {\n            unitService.unitDics[$scope.myOptions[i].unitCode] = $scope.myOptions[i].unitName;\n            if ($scope.myOptions[i].unitCode == \"NA\" || $scope.myOptions[i].unitCode == \"Number\") unitService.unitDics[$scope.myOptions[i].unitCode] = \"\";\n          }\n\n          $scope.myOptionDic = unitService.unitDics;\n          if (callbackFun) callbackFun();\n        }\n      });\n    }\n\n    var initstate = false;\n\n    var init = function init() {\n      if (initstate) return;\n      initstate = true;\n      resourceUIService.getRootModel(function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.name = returnObj.data.label;\n          returnObj.data.text = returnObj.data.label;\n          resourceUIService.rootModel = returnObj.data;\n          $scope.selectedParentitem = returnObj.data;\n          urmpTree();\n        }\n      });\n    };\n\n    var initConfigManager = function initConfigManager(callbackFun) {\n      configUIService.getConfigsByGroupName(\"EnterpriseConfig\", function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data && returnObj.data.length > 0) {\n            returnObj.data.forEach(function (item) {\n              try {\n                if ($scope.baseConfig) {\n                  $scope.baseConfig = jQuery.extend(true, $scope.baseConfig, JSON.parse(item.value));\n                } else {\n                  $scope.baseConfig = JSON.parse(item.value);\n                }\n\n                if ($scope.baseConfig) {\n                  //拥有企业设置\n                  if ($scope.baseConfig.title) $(\"title\").html($scope.baseConfig.title);else $(\"title\").html(\"\");\n                  if ($scope.baseConfig.shortcut) $(\"link[rel='shortcut icon']\").attr(\"href\", $scope.baseConfig.shortcut + \"?\" + new Date().getTime());else $(\"link[rel='shortcut icon']\").attr(\"href\", \"../login/images/shortcut_null.png\" + \"?\" + new Date().getTime());\n                }\n              } catch (e) {}\n            });\n          } else {\n            $(\"title\").html(\"\");\n            $(\"link[rel='shortcut icon']\").attr(\"href\", \"../login/images/shortcut_null.png\" + \"?\" + new Date().getTime());\n          }\n\n          callbackFun();\n        }\n      });\n      configUIService.getConfigsByGroupName(\"ConfigurationViewBG\", function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.forEach(function (item) {\n            $scope.configViewBg.push({\n              label: item.label,\n              url: item.value\n            });\n          });\n        }\n      });\n      configUIService.getConfigsByGroupName(\"ConfigurationCustom\", function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.forEach(function (item) {\n            try {\n              var coustom = JSON.parse(item.value);\n              coustom.attrs.text.text = item.label;\n              $scope.configCustoms.push(coustom);\n            } catch (e) {}\n          });\n        }\n      });\n      configUIService.getConfigsByGroupName(\"ConfigurationCommon\", function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.forEach(function (item) {\n            var keyDesc;\n            item.keyDesc = item.keyDesc || \"\";\n            var s = item.keyDesc.search(\"{\");\n            var e = item.keyDesc.search(\"}\");\n\n            if (s == 0 && e == item.keyDesc.length - 1) {\n              keyDesc = JSON.parse(item.keyDesc);\n              keyDesc.width = keyDesc.width ? keyDesc.width : 128;\n              keyDesc.height = keyDesc.height ? keyDesc.height : 128;\n            }\n\n            var base = {\n              \"type\": \"basic.Image\",\n              \"size\": {\n                \"width\": 60,\n                \"height\": 60\n              },\n              \"attrs\": {\n                \"image\": {\n                  \"width\": keyDesc ? keyDesc.width : 128,\n                  \"height\": keyDesc ? keyDesc.height : 128,\n                  \"xlink:href\": item.value\n                },\n                \"text\": {\n                  \"text\": item.label,\n                  \"font-size\": 12,\n                  \"stroke\": \"#000000\",\n                  \"display\": \"block\",\n                  \"stroke-width\": 0,\n                  \"fill\": \"#000000\",\n                  \"ref-dy\": 10,\n                  \"font-family\": \"Microsoft YaHei\"\n                }\n              }\n            };\n            $scope.configCommons.push(base);\n          });\n        }\n      });\n    };\n    /**\n     * 获得基本的模型定义，包括：\n     * 测点定义\n     * 指令定义\n     * 属性定义\n     */\n\n\n    var initRootModels = function initRootModels() {\n      $rootScope.rootModelsDic = {};\n      resourceUIService.rootModelsDic = $rootScope.rootModelsDic;\n      resourceUIService.getModelsByCondition({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.forEach(function (model) {\n            resourceUIService.getKpisByModelId(model.id, function (subReturnObj) {\n              if (subReturnObj.code == 0) {\n                if (!$rootScope.rootModelsDic[model.id]) $rootScope.rootModelsDic[model.id] = {};\n                subReturnObj.data.forEach(function (kpiDef) {\n                  if (!$rootScope.rootModelsDic[model.id].kpiDic) $rootScope.rootModelsDic[model.id].kpiDic = {};\n                  if ($scope.myOptionDic[kpiDef.unit]) kpiDef.unitLabel = $scope.myOptionDic[kpiDef.unit];\n                  var regExp = /\\{|\\[.*\\}|\\]/;\n\n                  if (kpiDef.range) {\n                    var find = regExp.test(kpiDef.range);\n                    var rangeObj = [];\n\n                    if (find) {\n                      try {\n                        rangeObj = find ? JSON.parse(kpiDef.range) : [];\n                      } catch (e) {}\n                    }\n\n                    kpiDef.rangeAry = rangeObj;\n\n                    if (rangeObj instanceof Array) {\n                      kpiDef.rangeAry = rangeObj;\n\n                      if (rangeObj.length == 2) {\n                        kpiDef.min = rangeObj[0];\n                        kpiDef.max = rangeObj[1];\n                      }\n                    } else if (rangeObj instanceof Object) {\n                      kpiDef.rangeObj = rangeObj;\n                    }\n                  }\n\n                  $rootScope.rootModelsDic[model.id].kpiDic[kpiDef.id] = kpiDef;\n                });\n              }\n            });\n            resourceUIService.getDirectivesByModelId(model.id, function (subReturnObj) {\n              if (subReturnObj.code == 0) {\n                if (!$rootScope.rootModelsDic[model.id]) $rootScope.rootModelsDic[model.id] = {};\n                $rootScope.rootModelsDic[model.id].directives = subReturnObj.data;\n              }\n\n              ;\n            });\n          });\n        }\n      });\n    };\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          $rootScope.staffName = userLoginUIService.user.userName;\n          $scope.userInfo = userLoginUIService.user;\n          domainTreeQuery();\n          initUnit(function () {\n            initRootModels();\n          });\n          init(); //          initPower();\n\n          initViews();\n          initConfigManager(function () {\n            userLoginUIService.initMenus($scope, $location);\n          });\n        } else {\n          $scope.errorMsg = userLoginUIService.result.message;\n          $scope.errorStatus = 1;\n        }\n      });\n    } else {\n      domainTreeQuery();\n      initUnit(function () {\n        initRootModels();\n      });\n      init(); //      initPower();\n\n      initViews();\n      initConfigManager(function () {\n        userLoginUIService.initMenus($scope, $location);\n      });\n    }\n  }]);\n});"],"sourceRoot":"/source/"}