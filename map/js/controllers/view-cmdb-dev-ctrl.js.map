{"version":3,"sources":["js/controllers/view-cmdb-dev-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","q","FileUploader","$controller","$location","$routeParams","$timeout","kpiDataService","userLoginUIService","resourceUIService","alertService","customerProjectUIService","sparePartUIService","SwSocket","Info","viewFlexService","userUIService","unitService","growl","userDomainService","userEnterpriseService","faultKnowledgeUIService","timeout","route","configUIService","serviceOrigin","uploadFileUrl","fileFormat","fileMaxSize","toggle","$","click","uploadExcel","config","uploader","formData","push","uploadAll","loadingShow","$on","event","args","response","code","success","queryData","onAfterAddingFile","fileItem","queue","length","queueLimit","removeFromQueue","selectObj","writeXml","obj","location","href","encodeURI","label","id","queryDitem","modelAry","loaderValue","modelType","selectTr","modelId","promises","defers","i","defer","modelViewEdit","params","window","open","JSON","stringify","exportModel","copyModel","sel","info","copyModelDefinition","res","data","$broadcast","warning","queryObj","getModelsByCondition","resultObj","state","statelabel","attributeName","goSearch","v","delMod","callback","show","title","closable","message","buttons","cssClass","action","dialogRef","deleteModel","returnObj","del","splice","close","addMod","status","init","getAllModelType","resolve","promise","all","then","user","isAuthenticated","evt","d","ngDialog","$rootScope","tab","isLoading","selectedDitem","modelNo","desc","series","model","attrType","attrList","addAttributeType","operateType","attrTab","attrTypeSort","protocols","deleteAttrs","resolutionObj","protocolStorage","docError","name","conter","attrClick","t","attribute","type","attrError","prompt","cityChang","province","city","district","addAttributeObj","uid","sourceValue","canEdit","dataType","delId","Math","uuid","isEdit","values","splitStr","split","undefined","jQuery","extend","attrTypeName","updateTypeName","template","scope","className","initKpiData","target","source","unit","number","range","icon","compress","compressTime","deadZone","deadZoneRange","interval","intervalTime","addDefaultData","select2Kpi","addDataObj","addData","saveDefaultKpis","flg","kpis","kpi","forEach","saveKpis","closeDialog","sheetObjs","unknows","key","successObj","failObj","checkChang","saveKpi","index","tableSearchValue","linkAge","e","defaultKpiLists","defaultKpiList","ele","specialtyProp","selectChange","addProtocol","protocolObj","analysisChange","expandObj","initData","saveProtocol","accessConfigs","kpiId","saveModelConfig","addCollection","directivesObj","taskObj","taskCode","description","taskCycle","cycleUnit","kpiDefinitionIds","controller","addDirectives","commandCode","commandType","addDoc","docUrl","fileType","$parent","baseConfig","modelUploadConfig","uploadParam","url","postfix","size","modeIdAttrs","getAttrsByModelId","resObj","rootModelsDic","attrs","attrTypeList","arr","defaultArr","attr","newObj","j","attrTypeAry","concat","sort","doubleCompare","downClick","qualifiedName","modelTypeObj","valueCode","saveAttribute","mod","modAttr","attrObj","saveArr","saveAttrs","deleteAction","tabArr","n","deleteKpi","deleteDirective","deleteModelConfig","deleteCollectionTaskDefinitionByModelId","deleteModelFile","cutName","selList","arrList","k","UploadFile","docList","formObj","encodeURIComponent","successDoc","escape","decodeURIComponent","saveModelOption","updateModel","deleteAttrsAction","addModel","saveModel","trim","dataTypeObj","resolutionProtocol","protocol","getAllResolutionProtocol","saveType","typeName","typeList","addType","selArr","arrType","sArr","editArr","getWayKpiInit","devkpi","base","dataTypeId","registers","readExpression","writeExpression","startPoint","mainAddr","subAddr","bdAddr","scale","regsKpiList","func","dataByte","serialNumStatus","allDataTypes","dataObj","inArray","accessProtocol","analysisProtocol","resolution","resolutionProtocolDic","regs","protocolList","extAttributes","ioWidth","kpiRegisters","byteSize","reg","regSelect","attributes","errorPoint","configList","content","optionExpand","option","modelKpis","console","log","gatList","modelkpi","oldKpi","configkpi","kpiName","parseInt","dataTypehander","dataTypeList","myDicts","propsList","specialtyProps","specialtyPropsDic","value","$watch","o","getModelByIds","getDataItemsByModelId","tempkpis","getAllCollectionPlugins","protocolDic","item","protocolVersions","resolutionProtocols","getModelConfigByModelId","findCollectionTaskDefinitionByModelId","getDirectivesByModelIdNotByRole","getUploadModelFileList","getdefaultAttrs","on","closest","removeClass","children","addClass","aname","$apply","solutionUIService","selectData","optional","noOptional","dirError","txt","kpiDir","selectValueLeft","selectValueRight","dirKpiList","updateTask","saveCollectionTaskDefinitionByModelId","clearError","saveCollection","direct","list","each","val","this","addCollectionTaskDefinitionByModelId","saveDirectives","saveDirective","selectRight","opt","selectLeft","leftUp","$recent","$options","remove","setTimeout","before","leftDown","len","after","withCredentials","removeAfterUpload","filters","fn","options","nameAry","fileSize","onWhenAddingFileFailed","filter","clearQueue","destroy","onBeforeUploadItem","Array","prototype","apply","clearItems","onSuccessItem","headers","error","nameChange","onErrorItem"],"mappings":"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","file":"js/controllers/view-cmdb-dev-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('ViewCmdbDevCtrl', ['$scope', '$q', 'FileUploader', '$controller', '$location', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'customerProjectUIService', 'sparePartUIService', 'SwSocket', 'Info', 'viewFlexService', 'userUIService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', 'faultKnowledgeUIService', '$timeout', '$route', 'configUIService', function ($scope, q, FileUploader, $controller, $location, $routeParams, $timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, customerProjectUIService, sparePartUIService, SwSocket, Info, viewFlexService, userUIService, unitService, growl, userDomainService, userEnterpriseService, faultKnowledgeUIService, timeout, route, configUIService) {\n    $scope.serviceOrigin = userUIService.uploadFileUrl + '/api/rest/import/resourceUIService/importModel';\n    $scope.fileFormat = 'xls、xlsx';\n    $scope.fileMaxSize = 10;\n    $controller('AppUploadCtrl', {\n      $scope: $scope,\n      growl: growl,\n      FileUploader: FileUploader\n    });\n\n    $scope.toggle = function toggle() {\n      $('#fileName').click();\n    };\n\n    $scope.uploadExcel = function (config) {\n      $scope.uploader.formData.push({\n        config: 'deviceModel'\n      });\n      $scope.uploader.uploadAll(); // growl.info(\"模板导入处理中,请耐心等待...\", {});\n\n      $scope.loadingShow = true;\n    };\n\n    $scope.$on(\"uploadTemplate\", function (event, args) {\n      if (args.response.code == 0) {\n        growl.success(\"模板导入成功\", {});\n        $scope.loadingShow = false;\n        queryData({});\n      } else {\n        $scope.loadingShow = false;\n      }\n    });\n\n    $scope.uploader.onAfterAddingFile = function (fileItem) {\n      if ($scope.uploader.queue.length > $scope.queueLimit) {\n        $scope.uploader.removeFromQueue(0);\n      }\n\n      $scope.uploadExcel();\n    };\n\n    $scope.selectObj = '';\n    /**\n     * xml 导出\n     */\n\n    $scope.writeXml = function (obj) {\n      location.href = '' + userUIService.uploadFileUrl + '/api/rest/download/resourceUIService/getDeviceModel/' + encodeURI(encodeURI(obj.label)) + '.xml/' + obj.id + '/';\n    };\n\n    var TEXT = {\n      \"SUBMIT\": \"确定\",\n      \"CANCEL\": \"取消\"\n    };\n    $scope.queryDitem = {};\n    $scope.modelAry = [];\n    $scope.loaderValue = \"\";\n    $scope.modelType = \"\";\n    $scope.selectTr = \"0\";\n    var modelId = $routeParams.modelId;\n    var promises = []; //已加载列表\n\n    var defers = []; //延期列表\n\n    for (var i = 0; i < 1; i++) {\n      defers.push(q.defer());\n    }\n\n    ;\n    /**\n     * 查询模型下面的种类\n     */\n\n    var modelTypeList = function modelTypeList() {\n      resourceUIService.getAllModelType(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.modelType = returnObj.data;\n          defers[0].resolve(\"success\");\n        }\n\n        ;\n      });\n    };\n    /**\n     * 设计仪表板处理事件\n     */\n\n\n    $scope.modelViewEdit = function (modelId) {\n      var params = {\n        modelId: modelId\n      };\n      window.open(\"../app-freeboard/index.html#/template/model/dashboard/\" + JSON.stringify(params), \"blank\");\n    };\n    /**\n     * excel 导出\n     */\n\n\n    $scope.exportModel = function () {\n      location.href = '' + userUIService.uploadFileUrl + '/api/rest/export/resourceUIService/exportModel/' + $scope.selectObj.id + '.xlsx/' + $scope.selectObj.id + '/deviceModel/';\n    };\n    /**\n     * 模板复制\n     */\n\n\n    $scope.copyModel = function (sel) {\n      if ($scope.selectTr && $scope.selectTr != 0) {\n        $scope.selectTr = 0;\n        growl.info(\"复制模板处理中,请耐心等待...\", {});\n        resourceUIService.copyModelDefinition(sel, function (res) {\n          if (res.code == 0) {\n            $scope.modelAry.push(res.data);\n            growl.success(\"复制模板成功\", {});\n            $scope.$broadcast(\"RESOURCE\", {\n              data: $scope.modelAry\n            });\n          }\n        });\n      } else {\n        growl.warning(\"请选择一个模板\", {});\n      }\n    };\n    /**\n     *  查询模型列表\n     */\n\n\n    var queryData = function queryData(queryObj) {\n      // $scope.loaderValue = \"\";\n      resourceUIService.getModelsByCondition(queryObj, function (resultObj) {\n        if (resultObj.code == 0) {\n          $scope.modelAry = resultObj.data;\n\n          if (modelId && resultObj.data.length > 0) {\n            $scope.queryDitem.state = 4;\n            $scope.queryDitem.statelabel = '模板名称';\n            $scope.queryDitem.attributeName = 'label';\n            $scope.loaderValue = resultObj.data[0].label;\n            modelId = '';\n          }\n\n          $scope.$broadcast(\"RESOURCE\", {\n            data: $scope.modelAry\n          });\n        }\n      });\n    }; //查询条件事件\n\n\n    $scope.goSearch = function () {\n      var v = {};\n\n      if ($scope.queryDitem.state > 0) {\n        v[$scope.queryDitem.attributeName] = $scope.loaderValue;\n        queryData(v);\n      } else if (modelId) {\n        v['id'] = modelId;\n        queryData(v);\n      } else {\n        v['label'] = $scope.loaderValue;\n        queryData(v);\n      }\n    }; //删除设备模板\n\n\n    $scope.delMod = function (data, callback) {\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        message: '确认删除设备模板吗？',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            if (data.id > 0) {\n              resourceUIService.deleteModel(data.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  callback(true);\n                  growl.success(\"删除成功\");\n                  var del = $scope.modelAry;\n\n                  for (var i in del) {\n                    if (del[i].id == data.id) {\n                      $scope.modelAry.splice(i, 1);\n                    }\n                  }\n\n                  ;\n                  $scope.selectTr = \"0\";\n                }\n              });\n              dialogRef.close();\n            }\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    }; //添加事件\n\n\n    $scope.addMod = function (status) {\n      if (status == 0) {\n        window.location.href = \"#/editModel/\" + status + \"\";\n      } else if (status > 0) {\n        window.location.href = \"#/editModel/\" + status + \"\";\n      } else {\n        growl.warning('操作异常');\n      }\n    };\n    /**\n     * 初始化\n     */\n\n\n    var init = function init() {\n      modelTypeList();\n\n      for (var i in defers) {\n        promises.push(defers[i].promise);\n      } //所有延迟加载完成后操作\n\n\n      q.all(promises).then(function (data) {\n        $scope.goSearch();\n      });\n    };\n    /**\n     * 标准的登录状态判定\n     * 登陆后执行初始化init方法\n     */\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]);\n  controllers.initController('EditModelCtrl', ['$scope', 'ngDialog', 'FileUploader', '$controller', '$location', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'customerProjectUIService', 'sparePartUIService', 'SwSocket', 'Info', 'viewFlexService', 'userUIService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', 'faultKnowledgeUIService', '$timeout', '$rootScope', function ($scope, ngDialog, FileUploader, $controller, $location, $routeParams, $timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, customerProjectUIService, sparePartUIService, SwSocket, Info, viewFlexService, userUIService, unitService, growl, userDomainService, userEnterpriseService, faultKnowledgeUIService, timeout, $rootScope) {\n    $scope.tab = \"tab1\";\n    $scope.modelId = $routeParams.id;\n    $scope.isLoading = false; //标记是否可以保存\n\n    $scope.selectedDitem = {\n      \"id\": 0,\n      \"label\": \"\",\n      \"modelNo\": \"\",\n      \"desc\": \"\",\n      \"series\": \"\"\n    }; //初始添加模型\n\n    $scope.model = {};\n    $scope.attrType = []; //属性分类\n\n    $scope.attrList = []; //属性分类\n\n    $scope.addAttributeType = \"attr\"; //用来区分是添加属性还是分类\n\n    $scope.operateType = \"\"; //记录操作的状态\n\n    $scope.attrTab = \"default\";\n    $scope.attrTypeSort = 0;\n    $scope.protocols = [];\n    $scope.deleteAttrs = [];\n    $scope.resolutionObj = {};\n    $scope.protocolStorage = {};\n    $scope.docError = {\n      \"name\": \"\",\n      \"conter\": \"\"\n    };\n\n    var initEvent = function initEvent() {\n      $('#deploy a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        if ($(e.target).closest(\"li.disabled\").length > 0) {\n          $(e.target).closest(\"li.disabled\").removeClass(\"active\");\n          $(e.target).closest(\"ul\").children(\"[name=\" + $scope.tab + \"]\").addClass(\"active\");\n          return;\n        }\n\n        var aname = $(e.target).closest(\"li\").attr(\"name\");\n\n        if (aname == 'tab2' && $scope.model.kpi.length > 0) {\n          // $scope.$broadcast(Event.KPIEDITINIT, {\n          //   \"data\": $scope.model.kpi\n          // });\n          timeout(function () {\n            $scope.$broadcast(\"KPI\", $scope.model.kpi);\n          });\n        }\n\n        if (aname) {\n          $scope.tab = aname;\n          $scope.$apply();\n        }\n      });\n    };\n\n    $scope.attrClick = function (t) {\n      if (t.name) {\n        $scope.attrTab = t.name;\n        $scope.attrTypeSort = t.attrTypeSort;\n      }\n    };\n\n    var cityInit = function cityInit() {\n      $scope.cityChang = {\n        \"province\": \"\",\n        \"city\": \"\",\n        \"district\": \"\"\n      };\n    };\n    /***\n     * 添加属性\n     * type type分类   attr 属性\n     * stataus  add 新增 up 修改\n     * obj  修改选择的值\n     */\n\n\n    $scope.attribute = function (type, status, obj) {\n      $scope.addAttributeType = type;\n      $scope.attrError.name = \"\";\n      $scope.attrError.prompt = \"\";\n      cityInit();\n\n      if (type == \"attr\" && status == \"add\") {\n        $scope.addAttributeObj = {\n          \"id\": 0,\n          \"label\": \"\",\n          \"name\": \"\",\n          \"modelId\": $scope.modelId,\n          \"attrType\": $scope.attrTab,\n          \"attrTypeSort\": $scope.attrTypeSort,\n          \"uid\": 0,\n          \"sourceValue\": \"\",\n          \"canEdit\": true,\n          \"dataType\": \"\",\n          \"delId\": Math.uuid(),\n          \"isEdit\": 3,\n          \"values\": {}\n        };\n      } else if (type == \"attr\" && status == \"up\") {\n        if (obj.dataType == 'standardAddress' && obj.sourceValue) {\n          var splitStr = obj.sourceValue.split(',');\n\n          if (splitStr[0] && splitStr[0] != undefined) {\n            $scope.cityChang.province = splitStr[0];\n          }\n\n          if (splitStr[1] && splitStr[1] != undefined) {\n            $scope.cityChang.city = splitStr[0] + \",\" + splitStr[1];\n          }\n\n          if (splitStr[2] && splitStr[2] != undefined) {\n            $scope.cityChang.district = splitStr[0] + \",\" + splitStr[1] + \",\" + splitStr[2];\n          }\n        }\n\n        $scope.addAttributeObj = jQuery.extend(true, {}, obj);\n        $scope.addAttributeObj[\"isEdit\"] = 2;\n      } else if (type == \"type\" && status == \"up\") {\n        $scope.addAttributeObj = {\n          \"attrTypeName\": obj.name,\n          \"updateTypeName\": obj.name,\n          \"attrTypeSort\": obj.attrTypeSort,\n          \"id\": obj.id,\n          \"isEdit\": 2\n        };\n      } else if (type == \"type\" && status == \"add\") {\n        $scope.addAttributeObj = {\n          \"attrTypeName\": \"\",\n          \"updateTypeName\": \"\",\n          \"attrTypeSort\": $scope.attrType.length,\n          \"isEdit\": 3\n        };\n      }\n\n      ngDialog.open({\n        template: '../partials/dialogue/add_attribute.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n    };\n    /**\n     * 添加数据项\n     */\n\n\n    var initKpiData = function initKpiData(target, source) {\n      target.label = source.label;\n      target.name = source.name;\n      target.unit = source.unit;\n      target.number = source.number ? source.number : '';\n      target.type = source.type ? source.type : 'kpi';\n      target.range = source.range;\n      target.icon = source.icon;\n      target.compress = source.compress ? source.compress : false;\n      target.compressTime = source.compressTime ? source.compressTime : 0;\n      target.deadZone = source.deadZone ? source.deadZone : false;\n      target.deadZoneRange = source.deadZoneRange ? source.deadZoneRange : 0;\n      target.interval = source.interval ? source.interval : false;\n      target.intervalTime = source.intervalTime ? source.intervalTime : 0;\n      return target;\n    };\n\n    $scope.addDefaultData = function (status, sel) {\n      $scope.isLoading = false;\n      $scope.select2Kpi = null;\n\n      if (status == \"add\") {\n        $scope.addDataObj = initKpiData({\n          type: 'kpi'\n        }, {});\n        $scope.addDataObj[\"id\"] = 0;\n        $scope.addDataObj[\"uid\"] = 0;\n      } else {\n        $scope.addDataObj = jQuery.extend(true, {}, sel);\n      }\n\n      $scope.operateType = \"data\";\n      ngDialog.open({\n        template: '../partials/dialogue/add_defaultdata.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n    };\n\n    $scope.addData = function (status, sel) {\n      $scope.isLoading = false;\n      $scope.select2Kpi = null;\n\n      if (status == \"add\") {\n        $scope.addDataObj = initKpiData({}, {});\n        $scope.addDataObj[\"id\"] = 0;\n        $scope.addDataObj[\"uid\"] = 0;\n      } else {\n        $scope.addDataObj = jQuery.extend(true, {}, sel);\n      }\n\n      $scope.operateType = \"data\";\n      ngDialog.open({\n        template: '../partials/dialogue/add_data.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n    };\n\n    $scope.saveDefaultKpis = function (flg) {\n      var kpis = [];\n\n      if (flg == 0) {\n        //给空的数据项赋值\n        $scope.model.kpi.forEach(function (kpi) {\n          if (!kpi.compress && !kpi.interval) {\n            kpi.compress = $scope.addDataObj.compress;\n            kpi.compressTime = $scope.addDataObj.compressTime;\n            kpi.deadZone = $scope.addDataObj.deadZone;\n            kpi.deadZoneRange = $scope.addDataObj.deadZoneRange;\n            kpi.interval = $scope.addDataObj.interval;\n            kpi.intervalTime = $scope.addDataObj.intervalTime;\n            kpis.push(kpi);\n          }\n        });\n      } else if (flg == 1) {\n        //覆盖所有的数据项\n        $scope.model.kpi.forEach(function (kpi) {\n          kpi.compress = $scope.addDataObj.compress;\n          kpi.compressTime = $scope.addDataObj.compressTime;\n          kpi.deadZone = $scope.addDataObj.deadZone;\n          kpi.deadZoneRange = $scope.addDataObj.deadZoneRange;\n          kpi.interval = $scope.addDataObj.interval;\n          kpi.intervalTime = $scope.addDataObj.intervalTime;\n          kpis.push(kpi);\n        });\n      }\n\n      if (kpis.length > 0) {\n        resourceUIService.saveKpis($scope.modelId, kpis, function (returnObj) {\n          if (returnObj.code == 0) {\n            if (returnObj.data) {\n              timeout(function () {\n                $scope.$broadcast(\"KPI\", $scope.model.kpi);\n              });\n              growl.success(\"成功应用\", {});\n            }\n\n            $scope.closeDialog();\n          }\n        });\n      } else {\n        growl.info(\"当前没有可以应用的数据项\");\n        $scope.closeDialog();\n      }\n    };\n\n    $scope.saveKpis = function (sheetObjs) {\n      if (sheetObjs) {\n        var kpis = [];\n        var unknows = [];\n\n        for (var key in sheetObjs) {\n          for (var i in sheetObjs[key]) {\n            if (i > 0) {\n              var kpi = initKpiData({\n                \"id\": 0,\n                \"uid\": 0\n              }, sheetObjs[key][i]);\n\n              if (!kpi.label || !kpi.name || !kpi.unit || !kpi.number || !kpi.type) {\n                unknows.push(kpi);\n              } else {\n                kpis.push(kpi);\n              }\n            }\n          }\n        }\n\n        ;\n\n        if (kpis.length > 0) {\n          growl.info(\"识别\" + (kpis.length + unknows.length) + \"条数据，成功\" + kpis.length + \"条，失败\" + unknows.length + \"条，开始导入识别成功数据！\");\n          resourceUIService.saveKpis($scope.modelId, kpis, function (returnObj) {\n            if (returnObj.code == 0) {\n              if (returnObj.data) {\n                returnObj.data.successObj.forEach(function (obj) {\n                  $scope.model['kpi'].push(obj);\n                });\n                timeout(function () {\n                  $scope.$broadcast(\"KPI\", $scope.model.kpi);\n                });\n                growl.success(\"成功导入\" + returnObj.data.successObj.length + \"条,失败\" + returnObj.data.failObj.length + \"条\", {});\n              } else {\n                growl.warning(\"该导入数据出现问题，请刷新页面，查看是否导入成功\");\n              }\n            } else {}\n          });\n        } else {\n          growl.warning(\"该导入数据无法识别\");\n        }\n      }\n    };\n\n    $scope.checkChang = function () {\n      if ($scope.addDataObj.interval) {\n        $scope.addDataObj.intervalTime = 1;\n      } else {\n        $scope.addDataObj.intervalTime = 0;\n      }\n\n      if ($scope.addDataObj.compress == false) {\n        $scope.addDataObj.deadZoneRange = 0;\n        $scope.addDataObj.compressTime = 0;\n      }\n    };\n\n    $scope.saveKpi = function () {\n      /* if($scope.$$childTail.select2Kpi) { //select2自己会有一个子域\n         initKpiData($scope.addDataObj, $scope.$$childTail.select2Kpi);\n       }*/\n      $scope.isLoading = true;\n      var kpiList = $scope.model['kpi']; //后端处理重复校验\n\n      /*  for(var k in kpiList) {\n          if(kpiList[k].label == $scope.addDataObj.label && $scope.addDataObj.id != kpiList[k].id) {\n            growl.warning(\"数据项不能重复\", {});\n            $scope.isLoading = false;\n            return;\n          }\n        }*/\n\n      resourceUIService.saveKpi($scope.modelId, $scope.addDataObj, function (resultObj) {\n        $scope.isLoading = false;\n\n        if (resultObj.code == 0) {\n          if ($scope.addDataObj.id <= 0 || $scope.addDataObj.uid <= 0) {\n            $scope.addDataObj.id = resultObj.data.id;\n            $scope.addDataObj.uid = resultObj.data.uid;\n            $scope.model['kpi'].push($scope.addDataObj);\n          } else {\n            for (var i in $scope.model['kpi']) {\n              if ($scope.model['kpi'][i].id == resultObj.data.id) {\n                $scope.model['kpi'][i] = resultObj.data;\n                $scope.model['kpi'][i].index = $scope.addDataObj.index;\n                break;\n              }\n            }\n          }\n\n          $scope.tableSearchValue = \"\";\n          growl.success(\"保存成功\", {});\n          timeout(function () {\n            $scope.$broadcast(\"KPI\", $scope.model.kpi);\n          });\n          $scope.closeDialog();\n        }\n      });\n    };\n\n    $scope.linkAge = function (e) {\n      $scope.defaultKpiLists = [];\n      $scope.defaultKpiList.forEach(function (ele) {\n        if (ele.specialtyProp == e) {\n          $scope.defaultKpiLists.push(ele);\n        }\n      });\n    };\n\n    $scope.select2Kpi = {};\n\n    $scope.selectChange = function (sel) {\n      if (sel) {\n        $scope.addDataObj.label = sel.label;\n        $scope.addDataObj.name = sel.name;\n        $scope.addDataObj.unit = sel.unit;\n        $scope.addDataObj.number = sel.number ? sel.number : '';\n        $scope.addDataObj.type = sel.type ? sel.type : 'kpi';\n        $scope.addDataObj.range = sel.range;\n        $scope.addDataObj.icon = sel.icon;\n        $scope.addDataObj.id = sel.id; // $scope.addDataObj.values = sel.values;\n      }\n    };\n    /**\n     * 添加解析协议\n     */\n\n\n    $scope.addProtocol = function (status, sel) {\n      $scope.operateType = \"protocol\";\n\n      if (status != 'add') {\n        $scope.protocolObj = jQuery.extend(true, {}, sel);\n        $scope.analysisChange();\n      } else {\n        $scope.protocolObj = {\n          id: 0,\n          modelId: $scope.modelId\n        };\n      }\n\n      $scope.expandObj = {};\n      $scope.initData();\n      ngDialog.open({\n        template: '../partials/dialogue/add_protocol.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n    };\n\n    $scope.saveProtocol = function () {\n      for (var i in $scope.protocolObj.accessConfigs) {\n        $scope.protocolObj.accessConfigs[i].kpiId = $scope.protocolObj.accessConfigs[i].uid;\n      }\n\n      resourceUIService.saveModelConfig($scope.protocolObj, function (resultObj) {\n        if (resultObj.code == 0) {\n          if ($scope.protocolObj.id <= 0) {\n            $scope.model['config'].push(resultObj.data);\n          } else {\n            for (var i in $scope.model['config']) {\n              if ($scope.model['config'][i].id == resultObj.data.id) {\n                $scope.model['config'][i] = resultObj.data;\n                break;\n              }\n            }\n          }\n\n          growl.success(\"保存成功\", {});\n          $scope.closeDialog();\n        }\n      });\n    };\n    /**\n     * 创建采集组\n     */\n\n\n    $scope.addCollection = function (status, sel) {\n      $scope.directivesObj = null;\n\n      if (status == \"add\") {\n        $scope.taskObj = {\n          taskCode: \"\",\n          description: \"\",\n          taskCycle: \"\",\n          cycleUnit: \"\",\n          kpiDefinitionIds: [],\n          isEdit: 3,\n          id: 0\n        };\n      } else {\n        $scope.taskObj = jQuery.extend(true, {}, sel);\n      }\n\n      ngDialog.open({\n        template: '../partials/dialogue/add_collection.html',\n        scope: $scope,\n        controller: \"addCollectionCtrl\",\n        className: 'ngdialog-theme-plain'\n      });\n    };\n    /**\n     * 创建指令\n     */\n\n\n    $scope.addDirectives = function (status, sel) {\n      $scope.taskObj = null;\n\n      if (status == 'add') {\n        $scope.directivesObj = {\n          isEdit: 3,\n          name: \"\",\n          description: \"\",\n          commandCode: \"\",\n          kpiDefinitionIds: [],\n          commandType: \"\",\n          values: {},\n          id: 0\n        };\n      } else {\n        $scope.directivesObj = jQuery.extend(true, {}, sel);\n      }\n\n      ngDialog.open({\n        template: '../partials/dialogue/add_directives.html',\n        scope: $scope,\n        controller: \"addCollectionCtrl\",\n        className: 'ngdialog-theme-plain'\n      });\n    };\n    /**\n     * 创建文档\n     */\n\n\n    $scope.addDoc = function () {\n      $scope.docUrl = 'api/rest/upload/resourceUIService/uploadModelFile';\n      $scope.fileType = $scope.$parent.baseConfig.modelUploadConfig ? $scope.$parent.baseConfig.modelUploadConfig.fileType : \"\";\n      $scope.docError.name = \"\";\n      $scope.docError.conter = \"\";\n      $scope.uploadParam = {\n        \"modelId\": \"\",\n        \"name\": \"\",\n        \"type\": \"\",\n        \"url\": \"\",\n        \"description\": \"\",\n        \"postfix\": \"\",\n        \"size\": \"\"\n      };\n      ngDialog.open({\n        template: '../partials/dialogue/add_doc.html',\n        scope: $scope,\n        controller: \"addDocCtrl\",\n        className: 'ngdialog-theme-plain'\n      });\n    };\n    /**\n     * 模型Id查模型详情\n     */\n\n\n    var modeIdQueryDetails = function modeIdQueryDetails() {\n      resourceUIService.getModelByIds([$scope.modelId], function (resObj) {\n        if (resObj.code == 0) {\n          $scope.selectedDitem = resObj.data[0];\n        }\n      });\n    };\n    /**\n     * 模型Id查属性列表\n     */\n\n\n    var modeIdAttrs = function modeIdAttrs() {\n      resourceUIService.getAttrsByModelId($scope.modelId, function (resObj) {\n        if (resObj.code == 0) {\n          $scope.model[\"attrs\"] = resObj.data; //更新模板上的属性\n\n          if ($rootScope.rootModelsDic[$scope.modelId]) {\n            $rootScope.rootModelsDic[$scope.modelId].attrs = resObj.data;\n          } else {\n            $rootScope.rootModelsDic[$scope.modelId] = {};\n            $rootScope.rootModelsDic[$scope.modelId][\"attrs\"] = resObj.data;\n          }\n\n          var attrTypeList = resObj.data;\n          var arr = [];\n          var defaultArr = [];\n\n          for (var i in attrTypeList) {\n            var obj = attrTypeList[i];\n            var attr = {\n              \"name\": \"\",\n              \"id\": \"\",\n              \"attrTypeSort\": \"\",\n              \"arr\": []\n            };\n            var newObj = -1;\n\n            if (obj.attrType == \"default\" && defaultArr.length > 0) {\n              newObj = i;\n              defaultArr[0].arr.push(obj);\n            } else {\n              for (var j in arr) {\n                if (arr[j].name == obj.attrType) {\n                  newObj = j;\n                  arr[j].arr.push(obj);\n                  break;\n                }\n              }\n            }\n\n            if (newObj == -1) {\n              attr.name = obj.attrType;\n              attr.id = obj.id;\n              attr.arr.push(obj);\n\n              if (obj.attrType == \"default\") {\n                attr.attrTypeSort = 0;\n                defaultArr.push(attr);\n              } else {\n                attr.attrTypeSort = obj.attrTypeSort;\n                arr.push(attr);\n              }\n            }\n          }\n\n          var attrTypeAry = defaultArr.concat(arr);\n          attrTypeAry.sort(doubleCompare([\"attrTypeSort\", \"\"], \"\"));\n          $scope.attrType = attrTypeAry;\n        }\n      });\n    };\n    /**\n     * 获得模型下的指令\n     * @param {Object} model\n     */\n\n\n    var getResourceDirectives = function getResourceDirectives() {\n      resourceUIService.getDirectivesByModelIdNotByRole($scope.modelId, function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.sort(doubleCompare([\"values\", \"index\"], \"desc\"));\n          $scope.model[\"directives\"] = returnObj.data;\n        }\n\n        ;\n      });\n    };\n    /**\n     * 获得模型下的文档\n     * @param {Object} model\n     */\n\n\n    var docInit = function docInit() {\n      resourceUIService.getUploadModelFileList($scope.modelId, function (returnObj) {\n        if (returnObj.code == 0) {\n          var docList = [];\n\n          if (returnObj.data.length > 0) {\n            for (var i in returnObj.data) {\n              var name = escape(decodeURIComponent(returnObj.data[i].name));\n              returnObj.data[i].name = name;\n              var description = escape(decodeURIComponent(returnObj.data[i].description));\n              returnObj.data[i].description = description;\n              docList.push(returnObj.data[i]);\n            }\n          }\n\n          $scope.model[\"docData\"] = docList;\n        }\n\n        ;\n      });\n    };\n\n    $scope.downClick = function (qualifiedName) {\n      var url = userUIService.uploadFileUrl + qualifiedName;\n      window.open(url);\n    };\n\n    $scope.modelType = [];\n    $scope.modelTypeObj = {};\n    /**\n     * 获取设备种类\n     */\n\n    $scope.getAllModelType = function () {\n      resourceUIService.getAllModelType(function (res) {\n        if (res.code == 0) {\n          $scope.modelType = res.data;\n\n          for (var i in res.data) {\n            $scope.modelTypeObj[\"\" + res.data[i].valueCode + \"\"] = res.data[i];\n          }\n        }\n      });\n    };\n    /**\n     * 获得所有的协议\n     */\n\n\n    var getAllCollectionPlugins = function getAllCollectionPlugins() {\n      resourceUIService.getAllCollectionPlugins(function (returnObj) {\n        var protocolDic = {};\n\n        if (returnObj.code == 0) {\n          returnObj.data.forEach(function (item) {\n            if (!protocolDic[item.protocol]) {\n              protocolDic[item.protocol] = item;\n              $scope.protocols.push(item);\n            }\n          });\n          $scope.protocolVersions = returnObj.data;\n        }\n      });\n    };\n    /*\n     * 查询解析协议\n     */\n\n\n    var getAllResolutionProtocols = function getAllResolutionProtocols() {\n      resourceUIService.getAllResolutionProtocol(\"\", function (resultObj) {\n        if (resultObj.code == 0) {\n          $scope.resolutionProtocolDic = {};\n          resultObj.data.forEach(function (item) {\n            $scope.resolutionProtocolDic[item.label] = item;\n          });\n          $scope.resolutionProtocols = resultObj.data;\n        }\n      });\n    };\n\n    var attributeDispose = function attributeDispose(mod, modAttr) {\n      if (modAttr.length > 0) {\n        resourceUIService.saveAttrs(modAttr, function (resultObj) {\n          if (resultObj.code == 0) {\n            if ($scope.modelId <= 0) {\n              $scope.modelId = mod.id; // window.location.href = \"#/editModel/\" + mod.id + \"\";\n\n              init();\n            } else {\n              modeIdAttrs();\n            }\n          }\n        });\n      }\n    };\n    /**\n     * 保存属性\n     */\n\n\n    var saveAttribute = function saveAttribute(mod) {\n      var attrObj = $scope.attrType;\n      var modAttr = [];\n\n      for (var i in attrObj) {\n        if (attrObj[i].arr.length > 0) {\n          var saveArr = attrObj[i].arr;\n\n          for (var j in saveArr) {\n            if (saveArr[j].isEdit > 0) {\n              if (saveArr[j].isEdit == 3) {\n                saveArr[j].id = 0;\n              }\n\n              saveArr[j].modelId = mod.id;\n              saveArr[j].attrType = attrObj[i].name;\n              saveArr[j].isEdit = \"0\";\n              modAttr.push(saveArr[j]);\n            }\n          }\n        }\n      }\n\n      attributeDispose(mod, modAttr);\n    };\n    /**\n     * 删除功能的action\n     */\n\n\n    $scope.deleteAction = function (type, sel, callback) {\n      if (type == \"attr\") {\n        if (sel.isEdit == 3) {\n          var del = $scope.attrType;\n\n          for (var i in del) {\n            if (del[i].name == $scope.attrTab) {\n              var tabArr = del[i].arr;\n\n              for (var j in tabArr) {\n                if (tabArr[j].delId == sel.delId) {\n                  tabArr.splice(j, 1);\n                  break;\n                }\n              }\n            }\n          }\n\n          var arr = $scope.model[\"attrs\"];\n\n          for (var n in arr) {\n            if (arr[n].delId == sel.delId) {\n              arr.splice(n, 1);\n              break;\n            }\n          }\n        } else {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '确认删除属性吗？',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                var del = $scope.attrType;\n\n                for (var i in del) {\n                  if (del[i].name == $scope.attrTab) {\n                    var tabArr = del[i].arr;\n\n                    for (var j in tabArr) {\n                      if (tabArr[j].id == sel.id) {\n                        $scope.deleteAttrs.push(tabArr[j].uid);\n                        tabArr.splice(j, 1);\n                        break;\n                      }\n                    }\n                  }\n                }\n\n                var arr = $scope.model[\"attrs\"];\n\n                if (sel.uid > 0) {\n                  for (var n in arr) {\n                    if (arr[n].uid == sel.uid) {\n                      arr.splice(n, 1);\n                      break;\n                    }\n                  }\n                }\n\n                growl.success(\"删除成功\", {});\n                growl.info(\"请点击“保存模板”按钮，以便对修改的内容进行保存！\", {});\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        }\n      } else if (type == \"kpi\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除数据项吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              resourceUIService.deleteKpi($scope.modelId, sel.id, function (resultObj) {\n                if (resultObj.code == 0) {\n                  for (var i in $scope.model['kpi']) {\n                    if (sel.id == $scope.model['kpi'][i].id) {\n                      $scope.model['kpi'].splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  callback(true);\n                  growl.success(\"删除成功\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"dir\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除指令吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              resourceUIService.deleteDirective($scope.modelId, sel.id, function (resultObj) {\n                if (resultObj.code == 0) {\n                  for (var i in $scope.model['directives']) {\n                    if (sel.id == $scope.model['directives'][i].id) {\n                      $scope.model['directives'].splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  growl.success(\"删除成功\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"protocol\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除协议吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              resourceUIService.deleteModelConfig(sel.id, function (resultObj) {\n                if (resultObj.code == 0) {\n                  for (var i in $scope.model['config']) {\n                    if (sel.id == $scope.model['config'][i].id) {\n                      $scope.model['config'].splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  growl.success(\"删除成功\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"task\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除数据项吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              resourceUIService.deleteCollectionTaskDefinitionByModelId($scope.modelId, sel.id, function (resultObj) {\n                if (resultObj.code == 0) {\n                  for (var i in $scope.model['taskData']) {\n                    if (sel.id == $scope.model['taskData'][i].id) {\n                      $scope.model['taskData'].splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  growl.success(\"删除成功\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"doc\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除文档吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              resourceUIService.deleteModelFile(sel, function (resultObj) {\n                if (resultObj.code == 0) {\n                  for (var i in $scope.model['docData']) {\n                    if (sel.id == $scope.model['docData'][i].id) {\n                      $scope.model['docData'].splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  growl.success(\"删除成功\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"assortment\") {\n        var cutName = sel.name;\n        var selList = $scope.attrType;\n\n        if (sel.arr.length > 0) {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            message: '\"' + cutName + '\" 分类下面有子属性确认删除吗？',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                for (var i in selList) {\n                  if (selList[i].name == cutName) {\n                    var arrList = selList[i].arr;\n\n                    for (var k in arrList) {\n                      if (arrList[k].id > 0) {\n                        $scope.deleteAttrs.push(arrList[k].uid);\n                      }\n                    }\n\n                    $scope.attrType.splice(i, 1);\n                    break;\n                  }\n                }\n\n                $scope.attrTab = \"default\";\n                $scope.attrTypeSort = 0;\n                growl.success(\"删除成功\", {});\n                growl.info(\"请点击“保存模板”按钮，以便对修改的内容进行保存！\", {});\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else {\n          for (var i in selList) {\n            if (selList[i].name == cutName) {\n              $scope.attrType.splice(i, 1);\n              break;\n            }\n          }\n        }\n      }\n    };\n\n    $scope.UploadFile = function () {\n      var docList = $scope.model['docData'];\n\n      for (var i in docList) {\n        if (docList[i].name == $scope.uploadParam.name) {\n          $scope.docError.name = 'name';\n          $scope.docError.conter = \"文档名称已存在\";\n          return;\n        }\n      }\n\n      $scope.formObj = {\n        \"modelId\": $scope.modelId,\n        \"name\": encodeURIComponent($scope.uploadParam.name),\n        \"description\": encodeURIComponent($scope.uploadParam.description)\n      };\n      $scope.$broadcast(\"UploadFile1\");\n    };\n\n    $scope.successDoc = function (obj) {\n      var name = escape(decodeURIComponent(obj.name));\n      obj.name = name;\n      obj.description = escape(decodeURIComponent(obj.description));\n      $scope.model[\"docData\"].push(obj);\n    };\n\n    var saveModelOption = function saveModelOption() {\n      if ($scope.modelId > 0) {\n        resourceUIService.updateModel($scope.selectedDitem, function (returnObj) {\n          if (returnObj.code == 0) {\n            saveAttribute(returnObj.data);\n            growl.success(\"保存成功\", {});\n            deleteAttrsAction();\n          }\n        });\n      } else {\n        resourceUIService.addModel($scope.selectedDitem, function (returnObj) {\n          if (returnObj.code == 0) {\n            growl.success(\"保存成功\", {});\n            saveAttribute(returnObj.data); // window.location.href = \"#/resource_type\";\n          }\n        });\n      }\n    }; //删除属性\n\n\n    var deleteAttrsAction = function deleteAttrsAction() {\n      if ($scope.deleteAttrs.length > 0) {\n        resourceUIService.deleteAttrs($scope.deleteAttrs, function (resultObj) {\n          if (resultObj.code == 0) {\n            $scope.deleteAttrs = [];\n          }\n        });\n      }\n    };\n    /**\n     * 设备模板保存按钮事件\n     */\n\n\n    $scope.saveModel = function () {\n      /*   if($scope.selectedDitem.modelType == \"\" || $scope.selectedDitem.modelType == null) {\n           growl.warning(\"设备种类不能为空\", {});\n           return;\n         }\n         if($.trim($scope.selectedDitem.series) == \"\" || $scope.selectedDitem.series == null) {\n           growl.warning(\"产品系列不能为空\", {});\n           return;\n         }\n         if($.trim($scope.selectedDitem.modelNo) == \"\" || $scope.selectedDitem.modelNo == null) {\n           growl.warning(\"设备型号不能为空\", {});\n           return;\n         }*/\n      if ($.trim($scope.selectedDitem.label) == \"\" || $scope.selectedDitem.label == null) {\n        growl.warning(\"模板名称不能为空\", {});\n        return;\n      }\n\n      for (var j in $scope.attrType) {\n        if ($scope.attrType[j].arr.length <= 0) {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            message: '存在没有配置属性信息的属性分类，空的属性分类系统将不会保存，确认保存吗？',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                saveModelOption();\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n          return;\n        }\n      }\n\n      ;\n      saveModelOption();\n    };\n    /**\n     * 获得模型下的任务\n     * @param {Object} model\n     */\n\n\n    var taskInit = function taskInit() {\n      resourceUIService.findCollectionTaskDefinitionByModelId($scope.modelId, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.model[\"taskData\"] = returnObj.data;\n        }\n\n        ;\n      });\n    };\n    /**\n     * 模型上的协议\n     */\n\n\n    var modelConfig = function modelConfig() {\n      resourceUIService.getModelConfigByModelId($scope.modelId, function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data) {\n            var configList = returnObj.data;\n            $scope.model['config'] = returnObj.data;\n          } else {\n            $scope.model['config'] = [];\n          }\n        }\n      });\n    };\n    /**\n     * 模型上的数据项\n     */\n\n\n    var modelKpi = function modelKpi() {\n      resourceUIService.getDataItemsByModelId($scope.modelId, function (returnObj) {\n        if (returnObj.code == 0) {\n          //去掉KQI\n          var tempkpis = [];\n\n          for (var i in returnObj.data) {\n            if (returnObj.data[i].type) {\n              tempkpis.push(returnObj.data[i]);\n            }\n          }\n\n          $scope.model[\"kpi\"] = tempkpis;\n        }\n\n        ;\n      });\n    };\n    /**\n     * 查询模型下面的默认属性\n     */\n\n\n    var defaultAttrs = function defaultAttrs() {\n      resourceUIService.getdefaultAttrs(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.model[\"attrs\"] = returnObj.data;\n          var arr = [];\n          var attrType = returnObj.data;\n\n          for (var i in attrType) {\n            var obj = attrType[i];\n            var attr = {\n              \"name\": \"\",\n              \"id\": \"\",\n              \"arr\": []\n            };\n            var newObj = -1;\n\n            for (var j in arr) {\n              if (arr[j].name == obj.attrType) {\n                newObj = j;\n                obj[\"isEdit\"] = 2;\n                obj[\"uid\"] = 0;\n                arr[j].arr.push(obj);\n                break;\n              }\n            }\n\n            if (newObj == -1) {\n              attr.name = obj.attrType;\n              obj[\"isEdit\"] = 2;\n              obj[\"uid\"] = 0;\n              attr.arr.push(obj);\n              arr.push(attr);\n            }\n          }\n\n          $scope.attrType = arr;\n        }\n      });\n    };\n    /**\n     * 查询模型下面的种类\n     */\n\n\n    var modelTypeList = function modelTypeList() {\n      resourceUIService.getAllModelType(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.model[\"modelType\"] = returnObj.data;\n        }\n\n        ;\n      });\n    };\n\n    $scope.dataTypeObj = {};\n\n    var dataTypeInit = function dataTypeInit() {\n      var dataTypehander = function dataTypehander() {\n        var dataTypeList = $scope.myDicts['DataType'];\n        var propsList = $scope.myDicts['specialtyProps'];\n\n        for (var i in dataTypeList) {\n          $scope.dataTypeObj[dataTypeList[i].valueCode] = dataTypeList[i];\n        }\n\n        if (propsList && propsList.length > 0) {\n          var arr = $scope.baseConfig.specialtyProps.split(\",\");\n          var specialtyProps = [];\n          var specialtyPropsDic = {};\n\n          for (var i in propsList) {\n            // var subarr = arr[i].split(\":\")\n            specialtyProps.push({\n              value: propsList[i].valueCode,\n              label: propsList[i].label\n            });\n            specialtyPropsDic[propsList[i].valueCode] = propsList[i].label;\n          }\n\n          $scope.specialtyProps = specialtyProps;\n          $scope.specialtyPropsDic = specialtyPropsDic;\n        }\n      };\n\n      if ($scope.myDicts) {\n        dataTypehander();\n      } else {\n        $scope.$watch(\"myDicts\", function (n, o) {\n          if (n) {\n            dataTypehander();\n          }\n        });\n      }\n    };\n\n    $scope.resolutionProtocol = function (protocol, callback) {\n      if ($scope.resolutionObj[protocol] != \"\" && $scope.resolutionObj[protocol] != undefined) {\n        return;\n      } else {\n        resourceUIService.getAllResolutionProtocol(protocol, function (resultObj) {\n          if (resultObj.code == 0) {\n            $scope.resolutionObj[protocol] = resultObj.data;\n\n            if (callback) {\n              callback();\n            }\n\n            return;\n          }\n        });\n      }\n    };\n    /**弹出操作事件 start**/\n\n\n    $scope.attrError = {\n      \"name\": \"\",\n      \"prompt\": \"\"\n    }; //属性异常处理\n    //保存分类\n\n    $scope.saveType = function () {\n      var typeName = $scope.addAttributeObj.attrTypeName;\n      var updateTypeName = $scope.addAttributeObj.updateTypeName;\n      var isEdit = $scope.addAttributeObj.isEdit;\n      var id = $scope.addAttributeObj.id;\n      var attrTypeSort = $scope.addAttributeObj.attrTypeSort;\n      var typeList = $scope.attrType;\n      $scope.attrTab = typeName;\n      $scope.attrTypeSort = attrTypeSort;\n\n      if (typeName == 'default' || typeName == '基础属性') {\n        $scope.attrError.name = \"type\";\n        $scope.attrError.prompt = \"系统分类不能创建\";\n        return;\n      } //新增\n\n\n      if (isEdit == 3) {\n        var addType = {\n          \"name\": \"\",\n          \"id\": \"\",\n          \"attrTypeSort\": \"\",\n          \"arr\": []\n        };\n\n        for (var i in typeList) {\n          if (typeList[i].name == typeName) {\n            $scope.attrError.name = \"type\";\n            $scope.attrError.prompt = \"分类名称已存在\";\n            return;\n          }\n        }\n\n        addType.name = typeName;\n        addType.attrTypeSort = attrTypeSort;\n        addType.id = \"\" + Math.uuid() + \"\";\n        $scope.attrType.push(addType);\n      } else if (isEdit == 2) {\n        for (var i in typeList) {\n          if (typeList[i].id != id && typeList[i].name == typeName) {\n            $scope.attrError.name = \"type\";\n            $scope.attrError.prompt = \"分类名称已存在\";\n            return;\n          }\n        }\n\n        for (var n in typeList) {\n          if (typeList[n].name == updateTypeName) {\n            typeList[n].name = typeName;\n            var selArr = typeList[n].arr;\n\n            if (selArr.length > 0) {\n              for (var j in selArr) {\n                if (selArr[j].id > 0) {\n                  selArr[j][\"attrType\"] = typeName;\n                  selArr[j][\"attrTypeSort\"] = attrTypeSort;\n                  selArr[j][\"isEdit\"] = 2;\n                }\n              }\n\n              break;\n            } else {\n              typeList[n].attrType = typeName;\n              typeList[n].attrTypeSort = attrTypeSort;\n              typeList[n].isEdit = 2;\n            }\n          }\n        }\n      }\n\n      growl.info(\"请点击“保存模板”按钮，以便对修改的内容进行保存！\", {});\n      $scope.closeDialog();\n    }; //保存属性\n\n\n    $scope.saveAttrs = function () {\n      if ($.trim($scope.addAttributeObj.name) == \"\" || $scope.addAttributeObj.name == null) {\n        $scope.attrError.name = \"name\";\n        $scope.attrError.prompt = \"属性名称不能为空\";\n        return;\n      }\n\n      if ($.trim($scope.addAttributeObj.label) == \"\" || $scope.addAttributeObj.label == null) {\n        $scope.attrError.name = \"label\";\n        $scope.attrError.prompt = \"显示名称不能为空\";\n        return;\n      }\n\n      var arrType = $scope.model[\"attrs\"];\n\n      for (var j in arrType) {\n        if ($scope.addAttributeObj.id > 0) {\n          if (arrType[j].id != $scope.addAttributeObj.id && arrType[j].name == $scope.addAttributeObj.name) {\n            growl.warning(\"属性名称已存在\", {});\n            return;\n          } else if (arrType[j].id != $scope.addAttributeObj.id && arrType[j].label == $scope.addAttributeObj.label) {\n            growl.warning(\"显示名称已存在\", {});\n            return;\n          }\n\n          if (arrType[j].id == $scope.addAttributeObj.id) {\n            arrType[j] = $scope.addAttributeObj;\n            break;\n          }\n        } else {\n          if (arrType[j].delId != $scope.addAttributeObj.delId && arrType[j].name == $scope.addAttributeObj.name) {\n            growl.warning(\"属性名称已存在\", {});\n            return;\n          } else if (arrType[j].delId != $scope.addAttributeObj.delId && arrType[j].label == $scope.addAttributeObj.label) {\n            growl.warning(\"显示名称已存在\", {});\n            return;\n          }\n\n          if (arrType[j].delId == $scope.addAttributeObj.delId) {\n            arrType[j] = $scope.addAttributeObj;\n            break;\n          }\n        }\n      }\n\n      if ($scope.addAttributeObj.dataType == 'standardAddress') {\n        $scope.addAttributeObj.sourceValue = \"\";\n\n        if ($scope.cityChang.district) {\n          $scope.addAttributeObj.sourceValue = $scope.cityChang.district;\n        } else if ($scope.cityChang.city) {\n          $scope.addAttributeObj.sourceValue = $scope.cityChang.city;\n        } else {\n          $scope.addAttributeObj.sourceValue = $scope.cityChang.province;\n        }\n      }\n\n      if ($scope.addAttributeObj.isEdit == 3) {\n        // $scope.attrType[$scope.addAttributeObj.attrType].push($scope.addAttributeObj);\n        var sArr = $scope.attrType;\n\n        for (var n in sArr) {\n          if (sArr[n].name == $scope.addAttributeObj.attrType) {\n            sArr[n].arr.push($scope.addAttributeObj);\n            $scope.model[\"attrs\"].push($scope.addAttributeObj);\n            break;\n          }\n        }\n      } else {\n        // if($scope.addAttributeObj.id > 0) {\n        var sArr = $scope.attrType;\n\n        for (var i in sArr) {\n          if (sArr[i].name == $scope.addAttributeObj.attrType) {\n            var editArr = sArr[i].arr;\n\n            for (var j in editArr) {\n              if (editArr[j].id == $scope.addAttributeObj.id) {\n                editArr[j] = $scope.addAttributeObj;\n                break;\n              }\n            }\n          } // }\n\n        }\n      }\n\n      growl.info(\"请点击“保存模板”按钮，以便对修改的内容进行保存！\", {});\n      $scope.closeDialog();\n    };\n\n    var getWayKpiInit = function getWayKpiInit(devkpi, base) {\n      devkpi[\"kpiId\"] = devkpi.id;\n      devkpi[\"kpiName\"] = devkpi.name;\n      devkpi[\"dataTypeId\"] = base.dataTypeId; //数据类型\n\n      devkpi[\"registers\"] = base.registers;\n      devkpi[\"config\"] = base.config;\n      devkpi[\"readExpression\"] = base.readExpression;\n      devkpi[\"writeExpression\"] = base.writeExpression;\n      devkpi[\"serialNumStatus\"] = false;\n      devkpi[\"config\"][\"startPoint\"] = base.startPoint; //起始地址\n\n      devkpi[\"config\"][\"length\"] = base.length; //字节长度\n\n      devkpi[\"config\"][\"mainAddr\"] = base.mainAddr; //主地址\n\n      devkpi[\"config\"][\"subAddr\"] = base.subAddr; //子地址\n\n      devkpi[\"config\"][\"bdAddr\"] = base.bdAddr; //BD地址\n\n      devkpi[\"config\"][\"scale\"] = base.scale; //浮点类型\n\n      devkpi[\"config\"][\"option\"] = false;\n    };\n\n    $scope.regsKpiList = {}; //ng-repeat 通过filter精确匹配\n\n    $scope.func = function (e) {\n      return e.name == $scope.attrTab;\n    };\n    /**\n     * 根据数据类型过滤寄存器\n     * @param size 字节长度\n     * @param kpiId  数据项id\n     */\n\n\n    $scope.dataByte = function (kpi) {\n      var arr = [\"单精度浮点\", \"双精度浮点\", \"ubytef\", \"bytef\", \"ushortf\", \"shortf\", \"uintf\", \"intf\", \"ulongf\", \"longf\"];\n      var serialNumStatus = false;\n      var dataType = $scope.allDataTypes;\n      var dataObj = {};\n\n      for (var i in dataType) {\n        if (dataType[i].id == kpi.dataTypeId) {\n          dataObj = dataType[i];\n          break;\n        }\n      }\n\n      if ($.inArray(dataObj.name, arr) != -1) {\n        serialNumStatus = true;\n      }\n\n      if ($scope.expandObj[kpi.kpiId]) {\n        $scope.expandObj[kpi.kpiId].serialNumStatus = serialNumStatus;\n      } else {\n        kpi.serialNumStatus = serialNumStatus;\n        $scope.expandObj[kpi.kpiId] = kpi;\n      }\n\n      if ($scope.protocolObj.accessProtocol == 'flexem' && $scope.protocolObj.analysisProtocol) {\n        var resolution = function resolution(arr, kpi) {\n          var resolutionProtocol = $scope.resolutionProtocolDic[$scope.protocolObj.analysisProtocol].regs;\n          var protocolList = [];\n\n          for (var j in resolutionProtocol) {\n            if ($.inArray(resolutionProtocol[j].extAttributes.ioWidth, arr) >= 0) {\n              protocolList.push(resolutionProtocol[j]);\n            }\n          }\n\n          $scope.regsKpiList[kpi.kpiId] = protocolList;\n        };\n\n        kpi.kpiRegisters = [];\n\n        switch (dataObj.byteSize) {\n          case 1:\n            resolution([0], kpi);\n            break;\n\n          case 2:\n            resolution([2], kpi);\n            break;\n\n          case 4:\n            resolution([2, 4], kpi);\n            break;\n\n          case 8:\n            resolution([2, 4, 8], kpi);\n            break;\n\n          default:\n            $scope.regsKpiList[kpi.kpiId] = [];\n        }\n\n        ;\n      }\n    };\n\n    $scope.reg = function (kpi, config) {\n      if ($scope.protocolObj.resolutionProtocol) {\n        $scope.protocolObj.resolutionProtocol.regs.forEach(function (regSelect) {\n          if (kpi.registers == regSelect.label) {\n            kpi.kpiRegisters = regSelect.attributes;\n            return true;\n          }\n        });\n      }\n    };\n\n    $scope.analysisChange = function () {\n      if ($scope.protocolObj.id <= 0) {\n        $scope.errorPoint = {};\n        var configList = $scope.model['config'];\n\n        for (var i in configList) {\n          if ($scope.protocolObj.analysisProtocol && configList[i].accessProtocol == $scope.protocolObj.accessProtocol && configList[i].analysisProtocol == $scope.protocolObj.analysisProtocol) {\n            $scope.errorPoint.name = 'analysisProtocol';\n            $scope.errorPoint.content = '解析协议已存在'; // $scope.protocolObj.accessConfigs = [];\n\n            return;\n          }\n        }\n      }\n    }; //高级选项切换\n\n\n    $scope.expandObj = {};\n\n    $scope.optionExpand = function (kpi) {\n      if ($scope.expandObj[kpi.kpiId]) {\n        if ($scope.expandObj[kpi.kpiId].option == true) {\n          $scope.expandObj[kpi.kpiId].option = false;\n        } else {\n          $scope.expandObj[kpi.kpiId].option = true;\n        }\n\n        return;\n      } else {\n        kpi.option = true;\n        $scope.expandObj[kpi.kpiId] = kpi;\n      }\n    }; //初始化数据项\n\n\n    $scope.initData = function () {\n      var modelKpis = $scope.model['kpi'];\n      console.log(1234);\n      console.log(modelKpis);\n      var gatList = [];\n      modelKpis.forEach(function (modelkpi) {\n        var devkpi = jQuery.extend(true, {}, modelkpi);\n\n        if ($scope.protocolObj.accessConfigs) {\n          var oldKpi = false; //初始化过的数据\n\n          $scope.protocolObj.accessConfigs.forEach(function (configkpi) {\n            if (devkpi.id == configkpi.kpiId) {\n              oldKpi = true;\n              configkpi.kpiName = devkpi.name;\n\n              if ($scope.protocolObj.id <= 0) {\n                configkpi.dataTypeId = '';\n                configkpi.registers = '';\n                configkpi.option = false;\n                configkpi.kpiRegisters = [];\n              } else {\n                if ($scope.protocolObj.accessProtocol == 'modbus') {\n                  configkpi.registers = parseInt(configkpi.registers);\n                }\n\n                if (configkpi.config && configkpi.config.scale != undefined) {\n                  if (configkpi.config.scale != undefined) {\n                    configkpi.config.scale = parseInt(configkpi.config.scale);\n                  }\n                }\n              }\n\n              gatList.push(configkpi);\n              return true;\n            }\n          });\n\n          if (!oldKpi) {\n            getWayKpiInit(devkpi, {\n              config: {}\n            });\n            gatList.push(devkpi);\n          }\n        } else {\n          getWayKpiInit(devkpi, {\n            config: {}\n          });\n          gatList.push(devkpi);\n        }\n      });\n      $scope.protocolObj.accessConfigs = gatList;\n    };\n    /**弹出操作事件 end**/\n\n    /**\n     * 初始化\n     */\n\n\n    var init = function init() {\n      modelTypeList();\n      dataTypeInit();\n      $scope.getAllModelType();\n\n      if ($scope.modelId > 0) {\n        modeIdQueryDetails();\n        modeIdAttrs();\n        modelKpi();\n        getAllCollectionPlugins();\n        getAllResolutionProtocols();\n        modelConfig();\n        taskInit();\n        getResourceDirectives();\n        docInit();\n      } else {\n        defaultAttrs();\n      }\n\n      initEvent();\n    };\n    /**\n     * 标准的登录状态判定\n     * 登陆后执行初始化init方法\n     */\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]);\n  controllers.initController('addCollectionCtrl', ['$scope', 'ngDialog', 'FileUploader', '$location', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'customerProjectUIService', 'sparePartUIService', 'SwSocket', 'Info', 'viewFlexService', 'userUIService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', 'faultKnowledgeUIService', 'solutionUIService', '$route', function ($scope, ngDialog, FileUploader, $location, $routeParams, $timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, customerProjectUIService, sparePartUIService, SwSocket, Info, viewFlexService, userUIService, unitService, growl, userDomainService, userEnterpriseService, faultKnowledgeUIService, solutionUIService, route) {\n    $scope.selectData = {\n      \"optional\": \"\",\n      \"noOptional\": \"\"\n    };\n    $scope.dirError = {\n      \"name\": \"\",\n      \"txt\": \"\"\n    };\n    var kpiDir = jQuery.extend(true, [], $scope.model['kpi']);\n    $scope.selectValueLeft = [];\n    $scope.selectValueRight = [];\n    var dirKpiList = [];\n\n    if ($scope.directivesObj && $scope.directivesObj.id > 0) {\n      dirKpiList = $scope.directivesObj.kpiDefinitionIds;\n    } else if ($scope.taskObj && $scope.taskObj.id > 0) {\n      dirKpiList = $scope.taskObj.kpiDefinitionIds;\n    }\n\n    if (dirKpiList.length > 0) {\n      for (var j = 0; j < dirKpiList.length; j++) {\n        var index = -1;\n\n        for (var i = 0; i < kpiDir.length; i++) {\n          if (kpiDir[i].uid == dirKpiList[j]) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.selectValueRight.push(kpiDir.splice(index, 1)[0]);\n        }\n      }\n\n      $scope.selectValueLeft = kpiDir;\n    } else {\n      $scope.selectValueLeft = kpiDir;\n    }\n\n    var updateTask = function updateTask(obj) {\n      resourceUIService.saveCollectionTaskDefinitionByModelId($scope.modelId, [obj], function (res) {\n        if (res.code == \"0\") {\n          if ($scope.taskObj.id > 0) {\n            for (var i in $scope.model['taskData']) {\n              if ($scope.model['taskData'][i].id == res.data[0].id) {\n                $scope.model['taskData'][i] = res.data[0];\n                break;\n              }\n            }\n\n            growl.success(\"修改成功\", {});\n          }\n        }\n\n        $scope.closeDialog();\n      });\n    };\n\n    $scope.clearError = function () {\n      $scope.dirError.name = \"\";\n      $scope.dirError.txt = \"\";\n    };\n\n    $scope.saveCollection = function () {\n      var direct = $scope.model['taskData'];\n\n      for (var d in direct) {\n        if (direct[d].taskCode == $scope.taskObj.taskCode && $scope.taskObj.id != direct[d].id) {\n          /* $scope.dirError.name = \"taskCode\";\n           $scope.dirError.txt = \"分组编码不能重复\";*/\n          growl.warning(\"分组编码不能重复\", {});\n          return;\n        }\n      }\n\n      if ($scope.taskObj.id > 0) {\n        if ($scope.selectValueRight.length > 0) {\n          var list = [];\n          $(\"#valueRight option\").each(function () {\n            var val = $(this).val(); //获取单个value\n            // list.push(val.split(\":\")[1]);\n\n            list.push(val);\n          });\n          $scope.taskObj.kpiDefinitionIds = list;\n          updateTask($scope.taskObj);\n        }\n      } else {\n        resourceUIService.addCollectionTaskDefinitionByModelId($scope.modelId, $scope.taskObj, function (res) {\n          if (res.code == \"0\") {\n            growl.success(\"保存成功\", {});\n            $scope.model['taskData'].push(res.data);\n\n            if ($scope.selectValueRight.length > 0) {\n              var list = [];\n              $(\"#valueRight option\").each(function () {\n                var val = $(this).val(); //获取单个value\n\n                list.push(val);\n              });\n              res.data.kpiDefinitionIds = list;\n              updateTask(res.data);\n            }\n\n            $scope.closeDialog();\n          }\n        });\n      }\n    };\n\n    $scope.saveDirectives = function () {\n      var direct = $scope.model['directives'];\n\n      for (var d in direct) {\n        if (direct[d].commandCode == $scope.directivesObj.commandCode && $scope.directivesObj.id != direct[d].id) {\n          /*  $scope.dirError.name = \"commandCode\";\n           $scope.dirError.txt = \"指令编码不能重复\";*/\n          growl.warning(\"指令编码不能重复\", {});\n          return;\n        }\n\n        if (direct[d].name == $scope.directivesObj.name && $scope.directivesObj.id != direct[d].id) {\n          /*$scope.dirError.name = \"name\";\n          $scope.dirError.txt = \"指令名称不能重复\"*/\n          growl.warning(\"指令名称不能重复\", {});\n          return;\n        }\n      }\n\n      var list = [];\n\n      if ($scope.selectValueRight.length > 0) {\n        $(\"#valueRight option\").each(function () {\n          var val = $(this).val(); //获取单个value\n          // list.push(val.split(\":\")[1]);\n\n          list.push(val);\n        });\n      }\n\n      $scope.directivesObj.kpiDefinitionIds = list;\n      resourceUIService.saveDirective($scope.modelId, $scope.directivesObj, function (res) {\n        if (res.code == \"0\") {\n          growl.success(\"保存成功\", {});\n\n          if ($scope.directivesObj.id <= 0) {\n            $scope.model['directives'].push(res.data);\n          } else {\n            for (var i in $scope.model['directives']) {\n              if ($scope.model['directives'][i].id == res.data.id) {\n                $scope.model['directives'][i] = res.data;\n                break;\n              }\n            }\n          }\n\n          $scope.model['directives'].sort(doubleCompare([\"values\", \"index\"], \"desc\"));\n          $scope.isLoading = true;\n          $scope.closeDialog();\n        }\n      });\n    };\n\n    $scope.selectRight = function () {\n      if ($scope.selectData.optional && $scope.selectData.optional.length > 0) {\n        var opt = $scope.selectData.optional;\n        var sel = $scope.selectValueLeft;\n\n        for (var j in opt) {\n          for (var i in sel) {\n            if (opt[j] == sel[i].id) {\n              $scope.selectValueRight.push(sel[i]);\n              $scope.selectValueLeft.splice(i, 1);\n              break;\n            }\n          }\n        }\n      }\n    };\n\n    $scope.selectLeft = function () {\n      if ($scope.selectData.noOptional && $scope.selectData.noOptional.length > 0) {\n        var sel = $scope.selectValueRight;\n        var opt = $scope.selectData.noOptional;\n\n        for (var j in opt) {\n          for (var i in sel) {\n            if (opt[j] == sel[i].uid) {\n              $scope.selectValueLeft.push(sel[i]);\n              $scope.selectValueRight.splice(i, 1);\n              break;\n            }\n          }\n        }\n      }\n    }; //右边向上按钮\n\n\n    $scope.leftUp = function () {\n      var index = $('#valueRight option').index($('#valueRight option:selected:first'));\n      var $recent = $('#valueRight option:eq(' + (index - 1) + ')');\n\n      if (index > 0) {\n        var $options = $('#valueRight option:selected').remove();\n        setTimeout(function () {\n          $recent.before($options);\n        }, 10);\n      }\n    }; //右边向下按钮\n\n\n    $scope.leftDown = function () {\n      var index = $('#valueRight option').index($('#valueRight option:selected:last'));\n      var len = $('#valueRight option').length - 1;\n      var $recent = $('#valueRight option:eq(' + (index + 1) + ')');\n\n      if (index < len) {\n        var $options = $('#valueRight option:selected').remove();\n        setTimeout(function () {\n          $recent.after($options);\n        }, 10);\n      }\n    };\n  }]);\n  controllers.initController('addDocCtrl', ['$scope', 'FileUploader', '$location', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'sparePartUIService', 'SwSocket', 'Info', 'viewFlexService', 'userUIService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', 'solutionUIService', '$route', function ($scope, FileUploader, $location, $routeParams, $timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, sparePartUIService, SwSocket, Info, viewFlexService, userUIService, unitService, growl, userDomainService, userEnterpriseService, solutionUIService, route) {\n    /* * * * * * * * * * * * * * * * * *  以下上传功能模块 * * * * * * * * * * * * * * * * * */\n    var uploader = $scope.uploader = new FileUploader({\n      // url: '' + userUIService.uploadFileUrl + '/api/rest/upload/resourceUIService/uploadModelFile',\n      url: '' + userUIService.uploadFileUrl + '/' + $scope.docUrl + '',\n      withCredentials: true,\n      // 跨域\n      queueLimit: 1,\n      //文件个数\n      removeAfterUpload: false //上传后删除文件\n\n    });\n    uploader.filters.push({\n      name: 'fileFilter',\n      fn: function fn(item\n      /*{File|FileLikeObject}*/\n      , options) {\n        var nameAry = item.name.split(\".\");\n        var type = nameAry[nameAry.length - 1];\n        var fileSize = $scope.$parent.$parent.baseConfig.modelUploadConfig ? $scope.$parent.$parent.baseConfig.modelUploadConfig.fileSize ? $scope.$parent.$parent.baseConfig.modelUploadConfig.fileSize : 5 : 5;\n\n        if (item.size / 1024 > fileSize * 1024) {\n          $scope.docError.name = 'error';\n          $scope.docError.conter = \"您选择的文件大于\" + fileSize + \"M，请重新选择\";\n          return false;\n        } else {\n          $scope.docError.name = '';\n          $scope.docError.conter = \"\";\n        }\n\n        $scope.uploadParam.url = item.name;\n        return true;\n      }\n    });\n\n    uploader.onAfterAddingFile = function (fileItem) {\n      console.info('onAfterAddingFile', fileItem.name);\n    };\n\n    uploader.onWhenAddingFileFailed = function (item\n    /*{File|FileLikeObject}*/\n    , filter, options) {\n      uploader.clearQueue();\n      uploader.destroy();\n      $scope.uploadParam.url = item.name;\n      console.info('onWhenAddingFileFailed', item.name);\n    };\n\n    uploader.onBeforeUploadItem = function (item) {\n      Array.prototype.push.apply(item.formData, uploader.formData);\n      console.info('onBeforeUploadItem', item);\n    };\n\n    $scope.clearItems = function () {\n      //重新选择文件时，清空队列，达到覆盖文件的效果\n      uploader.clearQueue();\n    };\n\n    uploader.onSuccessItem = function (fileItem, response, status, headers) {\n      if (response.code == 0) {\n        uploader.clearQueue();\n        uploader.destroy();\n        $scope.successDoc(response.data);\n        uploader.formData = [];\n        growl.success(\"上传文件成功\", {});\n        $scope.isLoading = false;\n        $scope.closeDialog();\n      } else {\n        growl.error(response.message, {});\n        $scope.isLoading = false;\n      }\n    };\n\n    $scope.nameChange = function () {\n      $scope.docError.name = '';\n      $scope.docError.conter = \"\";\n    };\n\n    uploader.onErrorItem = function (fileItem, response, status, headers) {\n      growl.warning(\"上传文件失败\", {});\n      $scope.isLoading = false;\n      console.info('onErrorItem', fileItem, response, status, headers);\n    };\n\n    $scope.$on(\"UploadFile1\", function (event, args) {\n      if (!uploader.queue || uploader.queue.length == 0) {\n        // growl.warning(\"请选择一个文件\", {});\n        $scope.docError.name = 'error';\n        $scope.docError.conter = \"请选择一个文件\";\n        return;\n      }\n\n      $scope.isLoading = true;\n      uploader.formData.push($scope.formObj);\n      uploader.uploadAll();\n    });\n  }]);\n});"],"sourceRoot":"/source/"}