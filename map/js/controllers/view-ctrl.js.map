{"version":3,"sources":["js/controllers/view-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","$location","$routeParams","$timeout","viewFlexService","kpiDataService","resourceUIService","growl","userLoginUIService","userDomainService","$document","userEnterpriseService","status","editVisible","alertAry","domainListDic","domainListTree","selectedAlertitem","selectedDesignitem","cilistByModelId","routePathNodes","ifSolutionStatus","editState","selectedCis","alertViewList","selectedDitem","selLength","selectAlertList","selList","search","searchStatus","alertId","alertType","type","split","initHistory","label","undefined","domain","nodeType","nodeIds","alertCodes","createTimeFrom","createTimeTo","pageSize","messageFilter","timeType","states","severities","length","searchAlert","shyj","goBack","$broadcast","Event","ALERTINFOSINIT","option","param","join","parseInt","getDevicesByCondition","returnObj","code","data","faultList","alertDefinition","modelId","callback","getAlertDefinitionByAlertCode","res","dataList","push","selectedModelId","clearSearchAlert","nodeId","initSearchAlerts","id","callbackfun","selectedResource","domainPath","getAlertTypeByDeviceType","getResourceById","domainTreeQuery","domainCallback","menuitems","baseConfig","extendDomain","getExtendDomainsByFilter","queryDomainTree","user","userID","menuitemsWatch","$watch","o","n","managedViews","getManagedViewsByTypeAndRole","v","i","view","obj","title","viewTitle","url","viewType","viewId","icon","splice","init","renderChartDom","height","find","width","widthheightPortion","position","float","severityAry","stateAry","alertViewClick","item","warning","commitItem","content","JSON","parse","ary","j","indexOf","resources","resourceDesc","model","getResourceByModelId","forEach","text","alerts","addAlertView","random","columns","domainId","domainName","description","count","Math","alertlv","isLoaded","name","viewName","protectLevel","domainLabel","creator","updator","createTime","updateTime","statusType","originalViewId","modelPath","state0","state5","state10","state20","severity1","severity2","severity3","severity4","$","ProudSmart","datatable","selectCol","optionCol3","handler","editAlertView","changeAlertCI","alertitem","delAlertView","show","closable","message","escape","buttons","cssClass","action","dialogRef","$apply","close","deleteViews","resultObj","success","saveAlertView","getSeverities","getStates","substring","selectedAlertCode","document","getElementById","selIndex","selectedIndex","viewInfo","options","value","val","stringify","addView","updateView","cancelAlertView","format","editChartView","charAt","jQuery","xml2json","hasOwnProperty","SubViews","chartObj","chart","arr","groupObj","dataSource","filters","filter","filterObj","toString","subObj","titleAry","getChartProperty","chartsItems","s","elements","nodes","layout","height_absolute","style","col","round","class","row","getResourceAlerts","modelID","findAlertDefinitions","chartViewClick","changeChartsCI","addDesignView","window","open","editDesignView","delDesignView","designView","getResourceAlertsLabel","path","rootModel","rootModelDic","getRootModel","getModels","tree","parentModelId","cmpObj","extend","addNodes","parentNode","modeid","key","viewList","isAuthenticated","viewLoadFinished","$on","event","msg"],"mappings":"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","file":"js/controllers/view-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('ViewCtrl', ['$scope', '$location', '$routeParams', '$timeout', 'viewFlexService', 'kpiDataService', 'resourceUIService', 'growl', 'userLoginUIService', 'userDomainService', '$document', 'userEnterpriseService', function ($scope, $location, $routeParams, $timeout, viewFlexService, kpiDataService, resourceUIService, growl, userLoginUIService, userDomainService, $document, userEnterpriseService) {\n    var status = [];\n    $scope.editVisible = false; //是否展示告警视图编辑框\n\n    $scope.alertAry = [];\n    $scope.domainListDic = {}; //域字典\n\n    $scope.domainListTree = null; //树形域\n\n    $scope.selectedAlertitem = {}; //选中的告警视图\n\n    $scope.selectedDesignitem = null; //选中的性能视图\n\n    $scope.cilistByModelId = []; //通过模型ID获得视图支持的设备列表\n\n    $scope.routePathNodes = {};\n    $scope.ifSolutionStatus = true;\n    $scope.editState = false; //这在编辑的告警组状态，true正在编辑，不可以点击其他的告警组\n\n    $scope.selectedCis = []; //选中的设备ID\n\n    $scope.alertViewList = []; //通过接口查询视图\n\n    $scope.selectedDitem = {};\n    $scope.selLength = 10;\n    $scope.selectAlertList = {\n      selList: [],\n      search: false,\n      searchStatus: false\n    };\n    var alertId = $routeParams.alertId;\n    var alertType = $routeParams.type;\n\n    if ($routeParams.status) {\n      status = $routeParams.status.split(\",\");\n    } //查询字段\n\n\n    var initHistory = function initHistory() {\n      /* $scope.selectedAlertitem = {\n         'domain': '',\n         'nodeType': '',\n         'alertCodes': '',\n         'createTimeFrom': '',\n         'createTimeTo': '',\n         'messageFilter': '',\n         'nodeIds': \"\",\n         'severities': ['1','2','3','4'],\n         'pageSize': '',\n         'timeType': '1',\n         'states': ['0','5','10','20'],\n         'selected': {\n           'state0': true,//status[0] == 0 ? false : true\n           'state5': true,//status[1] == 0 ? false : true\n           'state10': true,//status[2] == 0 ? false : true\n           'state20': true,//status[3] == 0 ? false : true\n           'severity1': true,\n           'severity2': true,\n           'severity3': true,\n           'severity4': true\n         }\n       };*/\n      $scope.selectedDitem.label = [];\n\n      if ($scope.selectedAlertitem == undefined) {\n        $scope.selectedAlertitem = {};\n      }\n\n      $scope.selectedAlertitem.domain = '';\n      $scope.selectedAlertitem.nodeType = '';\n      $scope.selectedAlertitem.nodeIds = '';\n      $scope.selectedAlertitem.alertCodes = '';\n      $scope.selectedAlertitem.createTimeFrom = '';\n      $scope.selectedAlertitem.createTimeTo = '';\n      $scope.selectedAlertitem.pageSize = '';\n      $scope.selectedAlertitem.messageFilter = '';\n      $scope.selectedAlertitem.timeType = '1';\n      $scope.selectedAlertitem.states = ['0', '5', '10', '20'];\n      $scope.selectedAlertitem.severities = ['1', '2', '3', '4'];\n\n      if (status.length > 0 || alertId > 0) {\n        $scope.searchAlert();\n      } // if ($routeParams.nodeId == 0) {\n      //   $scope.shyj = 1;\n      // } else {\n\n\n      $scope.shyj = ''; // $scope.selectedAlertitem.selected.state0 = true;\n      // $scope.selectedAlertitem.selected.state5 = true;\n      // $scope.selectedAlertitem.selected.state10 = true;\n      // $scope.selectedAlertitem.selected.state20 = true;\n      // }\n    };\n\n    var severityAry = [\"1\", \"2\", \"3\", \"4\"];\n    var stateAry = [\"0\", \"5\", \"10\", \"20\"]; //日期格式YYYY-MM-DD HH:mm:ss转换成时间戳\n\n    function timestamp(str) {\n      return new Date(str.replace(new RegExp(\"-\", \"gm\"), \"/\")).getTime();\n    }\n\n    ;\n\n    $scope.goBack = function () {\n      if ($scope.selectAlertList.search == true) {\n        $scope.selectAlertList.search = false;\n        $scope.$broadcast(Event.ALERTINFOSINIT + \"_view\", {\n          \"option\": []\n        });\n      } else {\n        $scope.selectAlertList.search = true;\n        initHistory();\n      }\n    }; //查询告警\n\n\n    $scope.searchAlert = function () {\n      var getSeverities = \"\";\n      var getStates = \"\";\n      /*  for (var i in severityAry) {\n          if ($scope.selectedAlertitem.selected[\"severity\" + severityAry[i]] == true) {\n            getSeverities += severityAry[i] + ',';\n          }\n        }\n        if (getSeverities.length != 0) {\n          getSeverities = getSeverities.substring(0, getSeverities.length - 1);\n        }\n         for (var i in stateAry) {\n          if ($scope.selectedAlertitem.selected[\"state\" + stateAry[i]] == true) {\n            getStates += stateAry[i] + ',';\n          }\n        }\n        if (getStates.length != 0) {\n          getStates = getStates.substring(0, getStates.length - 1);\n        }\n         if ($scope.selectedAlertitem.pageSize == undefined) {\n          return;\n        }*/\n\n      var param = {};\n      param = {\n        'domain': $scope.selectedAlertitem.domain,\n        'nodeType': $scope.selectedAlertitem.nodeType,\n        'alertCodes': $scope.selectedAlertitem.alertCodes,\n        'pageSize': $scope.selectedAlertitem.pageSize || 1000,\n        'messageFilter': $scope.selectedAlertitem.messageFilter,\n        'severities': $scope.selectedAlertitem.severities ? $scope.selectedAlertitem.severities.join(\",\") : '',\n        'states': $scope.selectedAlertitem.states ? $scope.selectedAlertitem.states.join(\",\") : ''\n      };\n\n      if ($scope.selectedAlertitem.timeType == \"1\") {\n        param['firstTimeFrom'] = $scope.selectedAlertitem.createTimeFrom;\n        param['firstTimeTo'] = $scope.selectedAlertitem.createTimeTo;\n      } else if ($scope.selectedAlertitem.timeType == \"2\") {\n        param['lastTimeFrom'] = $scope.selectedAlertitem.createTimeFrom;\n        param['lastTimeTo'] = $scope.selectedAlertitem.createTimeTo;\n      } else if ($scope.selectedAlertitem.timeType == \"3\") {\n        param['closeTimeFrom'] = $scope.selectedAlertitem.createTimeFrom;\n        param['closeTimeTo'] = $scope.selectedAlertitem.createTimeTo;\n      }\n\n      if (alertId > 0 && alertType == 'node') {\n        param['nodeIds'] = parseInt(alertId); // $scope.nodeIdStatus = alertId;\n\n        allDevice();\n      } else {\n        param['nodeIds'] = $scope.selectedAlertitem.nodeIds;\n      }\n\n      $timeout(function () {\n        //可以通过告警id跟设备id查询\n        if (alertId > 0 && alertType == 'alert') {\n          param[\"alertId\"] = alertId;\n          alertId = 0;\n        } else if (alertId > 0 && alertType == 'node') {\n          param[\"nodeIds\"] = parseInt(alertId);\n          $scope.selectedAlertitem[\"nodeIds\"] = parseInt(alertId);\n        }\n\n        $scope.$broadcast(\"searchAlertView\", {\n          \"option\": param\n        });\n      });\n    };\n\n    $scope.faultList = [];\n\n    $scope.alertDefinition = function (alertId, modelId, callback) {\n      resourceUIService.getAlertDefinitionByAlertCode(alertId, modelId, function (res) {\n        if (res.code == 0) {\n          var dataList = res.data;\n          $scope.faultList = [];\n\n          if (res.data && dataList.alertType == \"FAULT\") {\n            $scope.faultList.push(res.data);\n          }\n\n          if (callback) {\n            callback();\n          }\n\n          return;\n        }\n      });\n    };\n\n    var selectedModelId = '';\n\n    function getDeviceData(id, callbackfun) {\n      resourceUIService.getResourceById(id, function (returnObj) {\n        if (returnObj.code == 0 && returnObj.data) {\n          $scope.selectedResource = returnObj.data;\n          selectedModelId = returnObj.data.modelId;\n          $scope.selectedAlertitem.nodeIds = returnObj.data.id;\n\n          if (callbackfun) {\n            callbackfun();\n          }\n        }\n      });\n    } //查询数据清零\n\n\n    $scope.clearSearchAlert = function () {\n      if ($routeParams.nodeId == 0) {\n        initHistory(); // $scope.selectedDitem.alerts = [];\n\n        $scope.selectedDitem.label = [];\n      }\n      /* else if ($routeParams.nodeId && $routeParams.nodeId != 0) {\n         $scope.selectedAlertitem.pageSize = '';\n         $scope.selectedAlertitem.createTimeFrom = '';\n         $scope.selectedAlertitem.createTimeTo = '';\n         $scope.selectedAlertitem.messageFilter = '';\n         $scope.selectedAlertitem.alertCodes = '';\n       }*/\n      else {\n          $scope.selectedDitem.label = [];\n          $scope.selectedAlertitem.domain = '';\n          $scope.selectedAlertitem.nodeType = '';\n          $scope.selectedAlertitem.nodeIds = '';\n          $scope.selectedAlertitem.alertCodes = '';\n          $scope.selectedAlertitem.createTimeFrom = '';\n          $scope.selectedAlertitem.createTimeTo = '';\n          $scope.selectedAlertitem.pageSize = '';\n          $scope.selectedAlertitem.messageFilter = '';\n          $scope.selectedAlertitem.timeType = '1';\n          $scope.selectedAlertitem.states = ['0', '5', '10', '20'];\n          $scope.selectedAlertitem.severities = ['1', '2', '3', '4'];\n        }\n\n      ;\n    };\n\n    var initSearchAlerts = function initSearchAlerts() {\n      if ($routeParams.nodeId) {\n        getDeviceData($routeParams.nodeId, function () {\n          $scope.selectedAlertitem.nodeType = $scope.selectedResource.modelId; // $scope.selectedAlertitem.domainLabel = $scope.domainListDic[$scope.selectedResource.domainPath].name;\n\n          $scope.selectedAlertitem.domain = $scope.selectedResource.domainPath;\n          $scope.getAlertTypeByDeviceType(selectedModelId);\n          $scope.searchAlert();\n        });\n      }\n    };\n    /**\n     * 获取设备类型\n     *\n     */\n\n\n    var domainTreeQuery = function domainTreeQuery() {\n      var domainCallback = function domainCallback(data) {\n        $scope.domainListDic = data.domainListDic;\n        $scope.domainListTree = data.domainListTree;\n\n        if ($routeParams.nodeId) {\n          initSearchAlerts();\n        }\n      };\n\n      if (!$scope.menuitems[\"isloaded\"]) {\n        var menuitemsWatch = $scope.$watch('menuitems', function (o, n) {\n          if ($scope.menuitems[\"isloaded\"]) {\n            if ($scope.baseConfig.extendDomain) {\n              resourceUIService.getExtendDomainsByFilter({}, domainCallback);\n            } else {\n              userDomainService.queryDomainTree(userLoginUIService.user.userID, domainCallback);\n            }\n\n            menuitemsWatch();\n          }\n        }, true);\n      } else if ($scope.baseConfig.extendDomain) {\n        resourceUIService.getExtendDomainsByFilter({}, domainCallback);\n      } else {\n        userDomainService.queryDomainTree(userLoginUIService.user.userID, domainCallback);\n      }\n    };\n    /**\n     * 获取设备视图\n     *\n     */\n\n\n    var managedViews = function managedViews() {\n      viewFlexService.getManagedViewsByTypeAndRole(\"configAlert\", function (data) {\n        if (data.code == 0) {\n          var v = data.data;\n          var viewList = [];\n\n          for (var i = 0; i < v.length; i++) {\n            var view = v[i];\n\n            if (view) {\n              var obj = {\n                \"title\": view.viewTitle.split(\"?\")[0],\n                \"url\": \"#/\" + view.viewType + \"/\" + view.viewId,\n                \"viewId\": view.viewId,\n                \"view\": view,\n                \"icon\": \"fa fa-warning\"\n              };\n            }\n\n            if (obj.title == \"全部告警\") {\n              $scope.alertViewList.splice(0, 0, obj);\n            } else {\n              $scope.alertViewList.push(obj);\n            }\n          }\n\n          init();\n        }\n      });\n    };\n    /**\n     * 设备模板名称汉化\n     * @param ciName\n     */\n\n\n    var urmpTree = function urmpTree(ciName) {\n      resourceUIService.getModels(function (returnObj) {\n        if (returnObj.code == 0) {\n          resourceUIService.rootModelDic = {};\n          var tree = returnObj.data;\n\n          for (var i in tree) {\n            var obj = tree[i];\n            obj.text = obj.label;\n            if (!$scope.routePathNodes[obj.parentModelId]) $scope.routePathNodes[obj.parentModelId] = [];\n            $scope.routePathNodes[obj.parentModelId].push(obj);\n            if (!$scope.routePathNodes[obj.id]) $scope.routePathNodes[obj.id] = [];\n            var cmpObj = jQuery.extend(true, {}, obj);\n            resourceUIService.rootModelDic[cmpObj.id] = cmpObj;\n          }\n\n          var addNodes = function addNodes(parentNode) {\n            for (var modeid in $scope.routePathNodes) {\n              if (modeid == parentNode.id) {\n                parentNode.nodes = $scope.routePathNodes[modeid];\n\n                for (var i in parentNode.nodes) {\n                  addNodes(parentNode.nodes[i]);\n                }\n\n                if (parentNode.nodes.length == 0) {\n                  parentNode.nodes = null;\n                }\n              }\n            }\n          };\n\n          addNodes(resourceUIService.rootModel);\n\n          for (var key in $scope.routePathNodes) {\n            if (key != resourceUIService.rootModel.id && !resourceUIService.rootModelDic[key]) {\n              for (var i in $scope.routePathNodes[key]) {\n                addNodes($scope.routePathNodes[key][i]);\n                if (!resourceUIService.rootModel.nodes) resourceUIService.rootModel.nodes = [];\n                resourceUIService.rootModel.nodes.push($scope.routePathNodes[key][i]);\n              }\n            }\n          }\n\n          resourceUIService.rootModelDic[resourceUIService.rootModel.id] = resourceUIService.rootModel;\n          $scope.rootModel = resourceUIService.rootModel;\n          $scope.rootModelDic = resourceUIService.rootModelDic;\n        }\n      });\n    };\n    /**\n     * 获取树形资源域\n     */\n\n\n    $scope.renderChartDom = function (data) {\n      if (data) {\n        var height = $document.find(\".item_tr\").width() * data.width / 100 * data.widthheightPortion;\n        return {\n          position: 'relative',\n          float: 'left',\n          width: data.width + \"%\",\n          height: height\n        };\n      }\n    }; //资源域\n\n\n    var getEnterpriseDomain = function getEnterpriseDomain() {\n      //查询用户域\n      userEnterpriseService.queryEnterpriseDomain(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.enterpriseDomain = returnObj.data;\n        }\n      });\n    };\n    /**\n     * 初始化告警组图标\n     * @param {Object} random\n     */\n\n\n    var getIcon = function getIcon(random) {\n      var icon = \"fa fa-warning\";\n      return icon;\n    };\n    /**\n     * 告警组切换\n     * 说明：除了切换时使用，在告警组新增、更新、删除等操作时调用\n     * @param {Object} item\n     */\n\n\n    var severityAry = [\"1\", \"2\", \"3\", \"4\"];\n    var stateAry = [\"0\", \"5\", \"10\", \"20\"];\n\n    $scope.alertViewClick = function (item) {\n      $scope.selectAlertList.search = false;\n\n      if (item == undefined || item.length <= 0) {\n        return;\n      }\n\n      if ($scope.editState) {\n        growl.warning('当前有正在编辑的告警组', {});\n        return;\n      }\n\n      $scope.commitItem = item;\n      $scope.viewId = item.viewId;\n\n      if (typeof item.view.content == \"string\") {\n        item.view.content = JSON.parse(item.view.content);\n\n        if (!item.view.content.domainPath) {\n          item.view.content.domainPath = item.view.content.domain;\n        } //初始化checkbox    告警状态  0,5,10,20\n\n\n        var ary = item.view.content.states.split(\",\");\n\n        for (var i in stateAry) {\n          item[\"state\" + stateAry[i]] = false;\n\n          for (var j in ary) {\n            if (stateAry[i] == ary[j]) {\n              item[\"state\" + stateAry[i]] = true;\n              ary.splice(j, 1);\n              break;\n            }\n          }\n        } //告警级别\n\n\n        for (var i in severityAry) {\n          item[\"severity\" + severityAry[i]] = item.view.content.severities.indexOf(severityAry[i]) > -1 ? true : false;\n        }\n      }\n\n      $scope.selectedAlertitem = item;\n      $scope.cilistByModelId = [];\n\n      if (!$scope.selectedAlertitem.resources) {\n        if ($scope.selectedAlertitem.view.resourceDesc) {\n          var model = JSON.parse($scope.selectedAlertitem.view.resourceDesc);\n\n          for (var i in model) {\n            var modelId = model[0].modelId;\n            resourceUIService.getResourceByModelId(modelId, function (returnObj) {\n              if (returnObj.code == 0) {\n                returnObj.data.forEach(function (item) {\n                  item.text = item.label;\n                });\n                $scope.cilistByModelId = returnObj.data;\n                $scope.selectedAlertitem.resources = returnObj.data;\n              }\n            });\n          }\n        } else {\n          $scope.cilistByModelId = [];\n        }\n      } else {\n        $scope.cilistByModelId = $scope.selectedAlertitem.resources;\n      } //更新domain name\n      //      for(var i in $scope.enterpriseDomain) {\n      //        if($scope.selectedAlertitem.view.content.domain == $scope.enterpriseDomain[i].domainPath) {\n      //          $scope.selectedAlertitem.view.content.domainLabel = $scope.enterpriseDomain[i].name;\n      //        }\n      //      }\n      //更新domain name\n\n\n      if (!$scope.selectedAlertitem.alerts) {\n        //点击更新告警类型\n        if ($scope.selectedAlertitem.view.content && typeof $scope.selectedAlertitem.view.content.nodeType != \"undefined\") $scope.getAlertTypeByDeviceType($scope.selectedAlertitem.view.content.nodeType); // else\n        // $scope.selectedDitem.alerts = [];\n      } else {\n        $scope.selectedDitem.alerts = $scope.selectedAlertitem.alerts;\n      }\n\n      if (item.viewId != 0) {\n        $timeout(function () {\n          $scope.$broadcast(\"alertViewClick\", {\n            \"option\": item\n          });\n        });\n      }\n    };\n    /**\n     * 新增告警视图的数据结构\n     */\n\n\n    var initAlertData = function initAlertData() {\n      var obj = {};\n      obj.id = 0;\n      obj.domainId = 0;\n      obj.domainPath = \"\";\n      obj.domainName = \"\";\n      obj.description = \"\";\n      obj.count = 0;\n      var random = Math.random();\n      obj.icon = getIcon(random);\n      obj.alertlv = random > 0.75 ? \"bg-red\" : random > 0.5 ? \"bg-orange\" : random > 0.25 ? \"bg-yellow\" : \"bg-green\";\n      obj.isLoaded = 0;\n      obj.type = 1;\n      obj.name = \"\";\n      obj.title = \"\";\n      obj.label = obj.name;\n      obj.view = {\n        \"viewId\": \"\",\n        \"viewName\": \"\",\n        \"viewTitle\": \"\",\n        \"viewType\": \"configAlert\",\n        \"protectLevel\": \"\",\n        \"content\": {\n          \"nodeType\": \"\",\n          //$(\"#selectedDeviceType\").val().replace(\"number:\",\"\");    //节点类型 设备类型\n          \"domain\": \"\",\n          //$(\"#selectedDomainPath\").val(); //域路径 资源域\n          \"domainLabel\": \"\",\n          //前端使用属性，后端不保存\n          \"severities\": \"\",\n          //告警级别过滤\n          \"states\": \"\",\n          //告警状态\n          \"pageSize\": \"1000\",\n          //一次查询返回的告警数\n          \"nodeIds\": \"\",\n          //节点过滤列表（不做）\n          \"alertCodes\": \"\",\n          //$(\"#selectedAlertType\").val(),    //告警类型过滤\n          //\"agentIds\" : \"\",\n          //\"tags\" : \"\",\n          //\"titleFilter\" : \"\",\n          \"messageFilter\": \"\" //关键字\n          //\"owner\" : \"\",     //所属人过滤\n          //\"causeAlertId\" : \"\"  //关联告警ID\n\n        },\n        \"creator\": \"\",\n        \"updator\": \"\",\n        \"createTime\": \"\",\n        \"updateTime\": \"\",\n        \"description\": \"\",\n        \"domainPath\": \"\",\n        \"domainId\": \"\",\n        \"resourceDesc\": \"\",\n        \"statusType\": \"\",\n        \"originalViewId\": \"\",\n        \"modelPath\": \"\"\n      };\n      obj.state0 = true;\n      obj.state5 = true;\n      obj.state10 = true;\n      obj.state20 = true;\n      obj.severity1 = true;\n      obj.severity2 = true;\n      obj.severity3 = true;\n      obj.severity4 = true;\n      return obj;\n    };\n    /**\n     * 清空告警视图下方数据\n     */\n\n\n    function clearViewInfoData() {\n      //新建告警视图，下方查询结果清空\n      var columsData = [];\n      var columnDefs = [];\n      var columns = [$.ProudSmart.datatable.selectCol, {\n        \"data\": \"title\",\n        \"title\": \"告警名称\"\n      }, {\n        \"data\": \"message\",\n        \"title\": \"告警消息\"\n      }, {\n        \"data\": \"severity\",\n        \"title\": \"告警级别\"\n      }, {\n        \"data\": \"state\",\n        \"title\": \"状态\"\n      }, {\n        \"data\": \"arisingTime\",\n        \"title\": \"最近告警时间\"\n      }, $.ProudSmart.datatable.optionCol3];\n      $scope.$broadcast(Event.ALERTINFOSINIT, {\n        \"option\": [columsData, columns, columnDefs]\n      });\n    }\n    /**\n     * 新增告警组\n     */\n\n\n    $scope.addAlertView = function () {\n      $scope.editState = true;\n\n      var handler = function handler() {\n        for (var i in $scope.alertViewList) {\n          if ($scope.alertViewList[i].view.viewId == \"\") {\n            growl.warning(\"当前有正在编辑的告警组，不能再添加告警组\", {});\n            return;\n          }\n        }\n\n        $scope.alertViewList.push(initAlertData());\n        $scope.selectedAlertitem = $scope.alertViewList[$scope.alertViewList.length - 1];\n        $scope.editVisible = true; //新建告警视图，清空该告警下方的数据\n\n        clearViewInfoData();\n      };\n\n      handler();\n    };\n\n    $scope.editAlertView = function () {\n      $scope.editState = !$scope.editState;\n      $scope.editVisible = !$scope.editVisible;\n      if (!$scope.editVisible) return;\n    };\n    /**\n     * 切换告警视图内容的CI，类似过滤操作\n     * @param {Object} item\n     */\n\n\n    $scope.changeAlertCI = function (item) {\n      //alertViewClick($scope.selectedAlertitem.view,item.id);\n      var alertitem = {\n        viewId: null,\n        nodeId: item.id\n      };\n      $scope.$broadcast(\"alertViewClick\", {\n        \"option\": alertitem\n      });\n    };\n    /**\n     * 删除一个告警组\n     */\n\n\n    $scope.delAlertView = function () {\n      if ($scope.selectedAlertitem) {\n        if ($scope.editState) {\n          growl.warning('当前有正在编辑的告警组', {});\n          return;\n        }\n\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认要删除 “' + escape($scope.selectedAlertitem.title) + '” 告警组',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              //正在添加的告警视图删除操作，前端删除即可\n              $scope.$apply();\n\n              if ($scope.selectedAlertitem.view.viewId == \"\") {\n                //growl.success(\"取消新建告警视图\",{});\n                $scope.selectedAlertitem = false;\n                $scope.editVisible = false;\n                dialogRef.close();\n\n                for (var i in $scope.alertViewList) {\n                  if ($scope.alertViewList[i].view.viewId == \"\") {\n                    $scope.alertViewList.splice(i, 1);\n                    break;\n                  }\n                } //if($scope.alertView.length>=1){\n                //  $scope.alertViewClick($scope.alertView[$scope.alertView.length - 1]);\n                //}\n                //$scope.editVisible = false;\n                //dialogRef.close();\n                //return;\n\n              } else {\n                viewFlexService.deleteViews([$scope.selectedAlertitem.viewId], function (resultObj) {\n                  if (resultObj.code == 0) {\n                    for (var i in $scope.alertViewList) {\n                      if ($scope.alertViewList[i].view.viewId == $scope.selectedAlertitem.viewId) {\n                        $scope.alertViewList.splice(i, 1);\n                        break;\n                      }\n                    }\n\n                    $scope.editVisible = false;\n                    growl.success(\"删除告警组成功\", {});\n\n                    if ($scope.alertViewList.length == 0) {\n                      //最后一个告警的删除操作,清空下方查询结果\n                      //clearViewInfoData();\n                      //最后一个告警组的选中状态设备null\n                      $scope.selectedAlertitem = null;\n                    } else {\n                      $scope.alertViewClick($scope.alertViewList[$scope.alertViewList.length - 1]);\n                    }\n\n                    return;\n                  }\n                });\n                dialogRef.close();\n              }\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n    /**\n     * 保存告警视图\n     */\n\n\n    $scope.saveAlertView = function () {\n      $scope.editState = false;\n\n      if (typeof $scope.selectedAlertitem.title == \"undefined\") {\n        return;\n      }\n\n      if (typeof $scope.selectedAlertitem.view.content.pageSize == \"undefined\") {\n        return;\n      }\n\n      if (!$scope.selectedAlertitem.title) {\n        growl.warning(\"名称不能为空\", {});\n        return;\n      }\n\n      var getSeverities = \"\";\n      var getStates = \"\";\n\n      for (var i in severityAry) {\n        if ($scope.selectedAlertitem[\"severity\" + severityAry[i]] == true) {\n          getSeverities += severityAry[i] + ',';\n        }\n      }\n\n      if (getSeverities.length != 0) {\n        getSeverities = getSeverities.substring(0, getSeverities.length - 1);\n      }\n\n      for (var i in stateAry) {\n        if ($scope.selectedAlertitem[\"state\" + stateAry[i]] == true) {\n          getStates += stateAry[i] + ',';\n        }\n      }\n\n      if (getStates.length != 0) {\n        getStates = getStates.substring(0, getStates.length - 1);\n      } //domain域的更新\n      //      for(var i in $scope.enterpriseDomain) {\n      //        if($scope.selectedAlertitem.view.content.domainLabel == $scope.enterpriseDomain[i].name) {\n      //          $scope.selectedAlertitem.view.content.domain = $scope.enterpriseDomain[i].domainPath;\n      //        }\n      //      }\n      //测试告警类型\n\n\n      var selectedAlertCode = document.getElementById(\"selectedAlertType\");\n      var selIndex = selectedAlertCode.selectedIndex;\n      var alertVal = selectedAlertCode.options[selIndex].value;\n      var alertText = selectedAlertCode.options[selIndex].text;\n      var viewInfo = {};\n      viewInfo.viewId = $scope.selectedAlertitem.view.viewId ? $scope.selectedAlertitem.viewId : \"\";\n      viewInfo.viewName = $scope.selectedAlertitem.title;\n      viewInfo.viewTitle = viewInfo.viewName;\n      viewInfo.viewType = \"configAlert\";\n      viewInfo.protectLevel = $scope.selectedAlertitem.view.protectLevel ? $scope.selectedAlertitem.view.protectLevel : \"\";\n      viewInfo.content = {\n        \"nodeType\": $scope.selectedAlertitem.view.content.nodeType,\n        //$(\"#selectedDeviceType\").val().replace(\"number:\",\"\");    //节点类型 设备类型\n        \"domain\": $scope.selectedAlertitem.view.content.domain,\n        //域路径 资源域 $scope.selectedAlertitem.view.content.domain,\n        \"severities\": $scope.selectedAlertitem.severities ? $scope.selectedAlertitem.severities.join(\",\") : '',\n        //告警级别过滤\n        \"states\": $scope.selectedAlertitem.states ? $scope.selectedAlertitem.states.join(\",\") : '',\n        //告警状态\n        \"pageSize\": $(\"#alertCount\").val(),\n        //一次查询返回的告警数\n        //\"nodeIds\" : \"\",   //节点过滤列表（不做）\n        \"alertCodes\": $scope.selectedAlertitem.view.content.alertCodes,\n        //告警类型过滤\n        \"messageFilter\": $scope.selectedAlertitem.view.content.messageFilter //关键字\n        //\"agentIds\" : \"\",\n        //\"tags\" : \"\",\n        //\"titleFilter\" : \"\",\n        //\"owner\" : \"\",     //所属人过滤\n        //\"causeAlertId\" : \"\"  //关联告警ID\n\n      };\n      viewInfo.creator = $scope.selectedAlertitem.view.creator ? $scope.selectedAlertitem.view.creator : \"\";\n      viewInfo.updator = $scope.selectedAlertitem.view.updator ? $scope.selectedAlertitem.view.updator : \"\";\n      viewInfo.createTime = $scope.selectedAlertitem.view.createTime ? $scope.selectedAlertitem.view.createTime : \"\";\n      viewInfo.updateTime = $scope.selectedAlertitem.view.updateTime ? $scope.selectedAlertitem.view.updateTime : \"\";\n      viewInfo.description = $scope.selectedAlertitem.view.description ? $scope.selectedAlertitem.view.description : \"\";\n      viewInfo.domainPath = $scope.selectedAlertitem.view.domainPath ? $scope.selectedAlertitem.view.domainPath : \"\";\n      viewInfo.domainId = $scope.selectedAlertitem.view.domainId ? $scope.selectedAlertitem.view.domainId : \"\";\n      viewInfo.resourceDesc = $scope.selectedAlertitem.view.resourceDesc ? $scope.selectedAlertitem.view.resourceDesc : \"\";\n      viewInfo.statusType = $scope.selectedAlertitem.view.statusType ? $scope.selectedAlertitem.view.statusType : \"\";\n      viewInfo.originalViewId = $scope.selectedAlertitem.view.originalViewId ? $scope.selectedAlertitem.view.originalViewId : \"\";\n      viewInfo.modelPath = $scope.selectedAlertitem.view.modelPath ? $scope.selectedAlertitem.view.modelPath : \"\";\n      viewInfo.content = JSON.stringify(viewInfo.content);\n\n      if ($scope.selectedAlertitem.view.viewId == \"\") {\n        //新建告警视图\n        viewFlexService.addView(viewInfo, function (resultObj) {\n          if (resultObj.code == 0) {\n            //刷新重新遍历所有的告警视图\n            growl.success(\"新建告警组成功\", {});\n            $scope.editVisible = false;\n            $scope.selectedAlertitem.view = resultObj.data;\n            $scope.selectedAlertitem.viewId = resultObj.data.viewId;\n            $scope.alertViewClick($scope.selectedAlertitem);\n            return true;\n          } else {\n            growl.warning(\"新建告警组失败\", {});\n            $scope.editVisible = true;\n            return false;\n          }\n        });\n      } else {\n        viewFlexService.updateView(viewInfo, function (resultObj) {\n          if (resultObj.code == 0) {\n            growl.success(\"修改告警组成功\", {});\n            $scope.editVisible = false;\n            $scope.selectedAlertitem.view = resultObj.data;\n            $scope.selectedAlertitem.alerts = null;\n            $scope.selectedAlertitem.resources = null;\n\n            for (var i in $scope.alertViewList) {\n              if ($scope.alertViewList[i].view.viewId == resultObj.data.viewId) {\n                $scope.alertViewList[i] = $scope.selectedAlertitem;\n                break;\n              }\n            }\n\n            $scope.alertViewClick($scope.selectedAlertitem);\n            return;\n          } else {\n            growl.warning(\"修改告警组失败\", {});\n            $scope.editVisible = true;\n            return;\n          }\n        });\n      }\n    };\n    /**\n     * 取消修改告警组\n     */\n\n\n    $scope.cancelAlertView = function () {\n      $scope.editState = false;\n\n      if ($scope.selectedAlertitem.view.viewId == \"\") {\n        //growl.success(\"取消新建告警视图\",{});\n        for (var i in $scope.alertViewList) {\n          if ($scope.alertViewList[i].view.viewId == \"\") {\n            $scope.alertViewList.splice(i, 1); //删除新建的告警组\n            //选中上一个告警组\n\n            if ($scope.alertViewList.length > 0) {\n              $scope.alertViewClick($scope.alertViewList[i - 1]);\n            }\n\n            break;\n          }\n        }\n      }\n\n      $scope.editVisible = !$scope.editVisible;\n      if (!$scope.editVisible) return;\n    };\n\n    $scope.format = function (content) {\n      if (typeof content == \"string\") {\n        return JSON.parse(content);\n      } else {\n        // object or undefined\n        return;\n      }\n    };\n\n    var editChartView = function editChartView(v, nodeIds) {\n      if (!v.content) return;\n      var content;\n\n      if (v.content.charAt(0) == \"<\") {\n        content = jQuery.xml2json(v.content);\n\n        if (content.hasOwnProperty(\"SubViews\") == null || content.SubViews.hasOwnProperty(\"chart\") == null) {\n          return;\n        }\n\n        var chartObj = content.SubViews.chart;\n        var arr = [];\n        var groupObj = {};\n\n        if (chartObj.hasOwnProperty(\"length\")) {\n          for (var j in chartObj) {\n            if (chartObj[j].type == \"LineChart\" || chartObj[j].type == \"PieChart\" || chartObj[j].type == \"GaugeChart\") {\n              if (nodeId) {\n                for (var i in chartObj[j].dataSource.filters.filter) {\n                  var filterObj = chartObj[j].dataSource.filters.filter[i];\n\n                  if (filterObj.type == \"ci\") {\n                    filterObj.nodeIds = nodeIds.toString();\n                  }\n                }\n              }\n\n              var titleObj = kpiDataService.getChartProperty(chartObj[j], \"title\");\n              var titleAry = titleObj.value.split(\"::\");\n\n              if (titleAry.length > 1) {\n                if (groupObj[titleAry[0]]) {\n                  var subObj = groupObj[titleAry[0]];\n                  subObj[\"children\"].push(chartObj[j]);\n\n                  if (subObj[\"length\"] == subObj[\"children\"].length) {\n                    arr.push(groupObj[titleAry[0]]);\n                  }\n                } else {\n                  var subObj = {};\n                  subObj[\"length\"] = titleAry[1];\n                  subObj[\"type\"] = chartObj[j].type;\n                  subObj[\"isGroup\"] = true;\n                  subObj[\"children\"] = [];\n                  subObj[\"children\"].push(chartObj[j]);\n                  groupObj[titleAry[0]] = subObj;\n\n                  if (subObj[\"length\"] == subObj[\"children\"].length) {\n                    arr.push(groupObj[titleAry[0]]);\n                  }\n                }\n              } else {\n                arr.push(chartObj[j]);\n              }\n            }\n          }\n        } else {\n          if (nodeId) {\n            for (var i in chartObj.dataSource.filters.filter) {\n              var filterObj = chartObj.dataSource.filters.filter[i];\n\n              if (filterObj.type == \"ci\") {\n                filterObj.nodeIds = nodeIds.toString();\n              }\n            }\n          }\n\n          if (chartObj.type == \"LineChart\" || chartObj.type == \"PieChart\" || chartObj.type == \"GaugeChart\") {\n            arr.push(chartObj);\n          }\n        }\n\n        $scope.chartsItems = arr;\n      } else {\n        var s = v.content;\n        content = JSON.parse(s);\n\n        if (nodeIds && nodeIds.length > 0) {\n          for (var i in content.elements) {\n            content.elements[i].nodes = nodeIds;\n          }\n        }\n\n        for (var i in content.elements) {\n          var cols = 12;\n\n          if (!content.elements[i].layout) {\n            content.elements[i].layout = {\n              row: i,\n              col: 0,\n              width: 100,\n              widthheightPortion: .4,\n              style: \"height:500px\",\n              class: \"col-lg-12\"\n            };\n          } else {\n            /*\n             if (content.elements[i].height_absolute)\n             content.elements[i].layout.style = \"height:\"+ content.elements[i].height_absolute +\"px\";\n             else\n             content.elements[i].layout.style = \"height:400px\";\n             var col = Math.round(content.elements[i].layout.width * 12 * 0.01);\n             */\n            if (content.elements[i].height_absolute) content.elements[i].layout.style = {\n              height: content.elements[i].height_absolute + \"px\"\n            };else content.elements[i].layout.style = {\n              height: \"400px\"\n            };\n            var col = Math.round(content.elements[i].layout.width * 12 * 0.01);\n            content.elements[i].layout.class = \"col-lg-\" + col;\n          }\n        }\n\n        $scope.chartsItems = content.elements;\n      }\n    };\n\n    $scope.chartViewClick = function (item) {\n      $scope.selectedCis = [];\n      $scope.selectedDesignitem = item;\n      $scope.cilistByModelId = [];\n      kpiDataService.cilistByModelId = [];\n\n      if (!$scope.selectedDesignitem.resources) {\n        var model = JSON.parse($scope.selectedDesignitem.view.resourceDesc);\n\n        for (var i in model) {\n          var modelId = model[0].modelId;\n          resourceUIService.getResourceByModelId(modelId, function (returnObj) {\n            if (returnObj.code == 0) {\n              returnObj.data.forEach(function (item) {\n                item.text = item.label;\n              });\n              $scope.selectedDesignitem.resources = returnObj.data;\n              $scope.cilistByModelId = returnObj.data;\n              kpiDataService.cilistByModelId = returnObj.data;\n              editChartView($scope.selectedDesignitem.view, null);\n            }\n          });\n        }\n      } else {\n        $scope.cilistByModelId = $scope.selectedDesignitem.resources;\n        kpiDataService.cilistByModelId = $scope.selectedDesignitem.resources;\n        editChartView($scope.selectedDesignitem.view, null);\n      }\n    };\n\n    $scope.changeChartsCI = function (item) {\n      editChartView($scope.selectedDesignitem.view, $scope.selectedCis);\n    };\n\n    $scope.addDesignView = function () {\n      window.open(\"../app-editor/index.html#/echart\");\n    };\n\n    $scope.editDesignView = function () {\n      if ($scope.selectedDesignitem) {\n        if ($scope.selectedDesignitem.view.content.charAt(0) == \"<\") {\n          window.open(\"../iot-web/simpleView.html?viewId=\" + $scope.selectedDesignitem.viewId);\n        } else {\n          window.open(\"../app-editor/index.html#/echart/\" + $scope.selectedDesignitem.viewId);\n        }\n      }\n    };\n\n    $scope.delDesignView = function () {\n      if ($scope.selectedDesignitem) {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '是否要删除' + escape($scope.selectedDesignitem.title) + '视图',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              viewFlexService.deleteViews([$scope.selectedDesignitem.viewId], function (resultObj) {\n                if (resultObj.code == 0) {\n                  growl.success(\"删除视图成功\", {});\n\n                  for (var i in $scope.designView) {\n                    if ($scope.designView[i].viewId == $scope.selectedDesignitem.viewId) {\n                      $scope.selectedDesignitem = null;\n                      $scope.designView.splice(i, 1);\n                      $scope.chartsItems = null;\n                      break;\n                    }\n                  }\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n    /**\n     * 通过设备类型获取告警类型,及告警设备名称\n     */\n\n\n    $scope.getAlertTypeByDeviceType = function () {\n      var modelID = $scope.selectedAlertitem.nodeType;\n\n      if (modelID == undefined || modelID == null || modelID == \"\") {\n        // $scope.selectedDitem.alerts = [];\n        $scope.selectedAlertitem.alerts = [];\n        return;\n      } else {\n        getResourceAlerts(modelID);\n        getResourceAlertsLabel(modelID);\n        getResourceByModelId(modelID);\n      }\n    };\n\n    function getResourceAlerts(modelID) {\n      resourceUIService.findAlertDefinitions({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          if ($scope.selectedDitem.alerts == undefined) {\n            $scope.selectedDitem[\"alerts\"] = returnObj.data; // $scope.selectedAlertitem[\"alerts\"] = returnObj.data;\n          } else {\n            $scope.selectedDitem.alerts = returnObj.data;\n            $scope.selectedAlertitem.alerts = returnObj.data;\n          }\n        }\n\n        ;\n      });\n      /* resourceUIService.getAlertsByModelId(modelID, function(returnObj) {\n         if (returnObj.code == 0) {\n           $scope.selectedDitem.alerts = returnObj.data;\n           $scope.selectedAlertitem.alerts = returnObj.data;\n         };\n       });*/\n    }\n\n    function getResourceAlertsLabel(modelID) {\n      /*resourceUIService.getManagedDevicesByModelId(modelID, function(returnObj) {\n        if (returnObj.code == 0) {\n          $scope.selectedDitem.label = returnObj.data;\n        }\n      })*/\n      var obj = {\n        \"modelId\": modelID\n      };\n\n      if ($scope.selectedAlertitem.domain) {\n        obj[\"domains\"] = $scope.selectedAlertitem.domain;\n      }\n\n      resourceUIService.getDevicesByCondition(obj, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.selectedDitem.label = returnObj.data;\n        }\n      });\n    } //通过设备跳转过来默认查询所有的设备\n\n\n    function allDevice() {\n      resourceUIService.getDevicesByCondition({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.selectedDitem.label = returnObj.data;\n          alertId = 0;\n        }\n      });\n    }\n\n    var getResourceByModelId = function getResourceByModelId(modelID) {\n      resourceUIService.getResourceByModelId(modelID, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.resources = returnObj.data;\n        }\n      });\n    };\n\n    var init = function init() {\n      //这里是处理从dashboard点击待处理告警的故障查询页面\n      if ($location.path() == \"/configAlertByStatus\") {\n        var item = \"0,5\";\n        $timeout(function () {\n          $scope.$broadcast(\"alertViewClick\", {\n            \"option\": \"\",\n            \"states\": item\n          });\n        });\n      } else {\n        resourceUIService.rootModel = null;\n\n        if (!resourceUIService.rootModel) {\n          resourceUIService.getRootModel(function (returnObj) {\n            if (returnObj.code == 0) {\n              resourceUIService.rootModel = returnObj.data;\n              urmpTree();\n              domainTreeQuery();\n            }\n          });\n        } else {\n          $scope.rootModel = resourceUIService.rootModel;\n          $scope.rootModelDic = resourceUIService.rootModelDic;\n          domainTreeQuery();\n        }\n\n        if ($location.path().indexOf(\"configAlert\") > 0) {\n          // for (var i in $scope.alertViewList) {\n          //   if ($scope.alertViewList[i].view.viewId == \"\") {\n          //     $scope.alertViewList.splice(i, 1);\n          //     break;\n          //   }\n          // }\n          getResourceAlerts();\n\n          if (!$routeParams.hasOwnProperty(\"viewId\") && !$routeParams.hasOwnProperty(\"nodeId\")) {\n            if ($scope.alertViewList.length > 0 && $scope.alertViewList != undefined) {\n              for (var i in $scope.alertViewList) {\n                $scope.alertViewClick($scope.alertViewList[i]);\n                break;\n              }\n            } else {\n              $timeout(function () {\n                $scope.$broadcast(Event.ALERTINFOSINIT + \"_view\", {\n                  \"option\": []\n                });\n                /* $scope.$broadcast(Event.ALERTINFOSINIT, {\n                   \"option\": []\n                 });*/\n              });\n            }\n          }\n\n          if (status.length > 0 || alertId > 0) {\n            initHistory();\n            $scope.selectAlertList.search = true;\n          }\n        } else {\n          initHistory();\n\n          if (!$routeParams.hasOwnProperty(\"viewId\") && !$routeParams.hasOwnProperty(\"nodeId\")) {\n            for (var i in $scope.designView) {\n              $scope.chartViewClick($scope.designView[i]);\n              break;\n            }\n\n            return;\n          }\n\n          if ($routeParams.viewId) {\n            for (var i in viewFlexService.viewList) {\n              var v = viewFlexService.viewList[i];\n\n              if (v.viewId == $routeParams.viewId) {\n                if (v.viewType == \"designView\") {\n                  editChartView(v, $routeParams[\"nodeId\"]);\n                }\n\n                break;\n              }\n            }\n          }\n        }\n      }\n    };\n\n    if (userLoginUIService.user.isAuthenticated && viewFlexService.viewLoadFinished) {\n      managedViews();\n    } else {\n      $scope.$on('viewLoadFinished', function (event, msg) {\n        managedViews();\n      });\n    }\n  }]);\n});"],"sourceRoot":"/source/"}