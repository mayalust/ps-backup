{"version":3,"sources":["app-ac/js/controllers/cmdb-solution-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","$rootScope","$location","$routeParams","$timeout","userLoginUIService","resourceUIService","SwSocket","Info","growl","route","ngDialog","viewFlexService","solutionUIService","console","info","routePaths","routePathNodes","selectedDitem","queryDitem","domainListDic","userGridData","visible","treeAry","activeMainTab","current","activeTab","params","treeviewIndex","scope","$on","previousMainTab","initstate","activeListTab","getIds","get","iconList","qualityIcon","kpiIconList","kpiIcon","model","solutionId","groupId","modelId","selectedSolution","id","selectedGroupitem","category","initModelAtts","obj","idx","count","ids","callback","Math","random","icon","alertlv","isLoaded","type","text","label","name","canEdit","getAttrsByModelId","returnObj","code","attrs","data","getKpisByModelId","kpis","getThresholdsBySolution","alerts","directives","getDirectivesByModelId","urmpTree","ciName","getModels","rootModelDic","modelListSelect","tree","i","parentModelId","push","addNodes","parentNode","modeid","nodes","length","key","rootModel","handler","reLoader","changeDItem","$broadcast","Event","ATTREDITINIT","KPIEDITINIT","ALERTEDITINIT","DIRECTIVESINIT","click","item","selectedDirective","splice","dbClick","showChildren","addModel","parentModel","arr","warning","newModelName","newModel","resources","unshift","delModel","success","show","title","closable","message","escape","buttons","cssClass","action","dialogRef","deleteModelFromSolution","close","updateModel","handlerData","saveGroupModel","modelViewEdit","window","location","href","dashboardViewId","createServiceView","log","serviceViewId","saveModelSubItem","kpichangehandler","e","newKpi","isEdit","unit","range","number","granularity","granularityUnit","option","uid","isNew","addModelSubItem","select2init","isDel","newAttr","dataType","uuid","newAlert","description","expression","protocolType","attrLabel","iconClick","indexId","thisId","$","val","attr","doAction","select","addData","values","addResource","updataData","updateDevice","selectedInstances","CMDBINFOSINIT","deleteResource","resultObj","state","selectedAttrs","deleteKpi","saveKpi","deleteAttr","saveAttr","deleteDirective","saveDirective","checkDirectiveParam","deleteThresholdBySolution","saveThresholdBySolution","enabled","thresholds","saveThresholdsByAlert","changeDomainItem","$apply","changeTabItem","CMDBINFOS4MAPINIT","on","aname","target","targetText","search","trim","relatedTarget","gotoPath","newAry","gotoParentPath","parent","gotoBrotherPath","path","enterpriseType","directiveBack","saveThresholds","modelData","alertCode","hasThreshold","thresholdsData","dialog","goSearch","domainPath","getCustomerDeviceByFilter","nodeIds","newObj","onlineStatus","floor","externalDevId","health","selected","kpiDataService","getRealTimeKpiData","j","nodeId","value","goClear","placeList","deviceModel","changeModel","n","gotoResourceType","closeDialog","confirm","managedByGroup","linkModelToSolution","linkModelToGroupModel","deleteDeviceModel","deleteModelFromGroupModel","addDeviceModel","open","template","linkDevices","groupModels","changehanderdata","getGroupModelsBySolutionId","callbackfun","solutionChange","auto","returnVal","getDeviceModelsBySolutionId","groupChange","getModelsByGroupId","getSolutionsModelsGroup","getSolutionsByStatus","forEach","designDashboardView","init","user","getRootModel","getKpiTypeByFilter","kpiList","isAuthenticated","evt","d"],"mappings":"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","file":"app-ac/js/controllers/cmdb-solution-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('CmdbSolutionCtrl', ['$scope', '$rootScope', '$location', '$routeParams', '$timeout', 'userLoginUIService', 'resourceUIService', 'SwSocket', 'Info', 'growl', '$route', 'ngDialog', 'viewFlexService', 'solutionUIService', function ($scope, $rootScope, $location, $routeParams, $timeout, userLoginUIService, resourceUIService, SwSocket, Info, growl, route, ngDialog, viewFlexService, solutionUIService) {\n    console.info(\"切换到资源管理-设备相关管理\");\n    $scope.routePaths = [];\n    $scope.routePathNodes = {};\n    $scope.selectedDitem = null;\n    $scope.queryDitem = null;\n    $scope.domainListDic = {};\n    $scope.userGridData;\n    $scope.visible = false;\n    $scope.treeAry = [];\n    $scope.activeMainTab = \"设备类型视图\";\n\n    if (route.current) {\n      $scope.activeTab = route.current.params.activeTab ? route.current.params.activeTab : $scope.treeviewIndex == \"/modelsGroup\" ? '设备组模板信息' : '模板信息';\n    } else {\n      scope.$on(\"locationChanged\", function () {\n        $scope.activeTab = route.current.params.activeTab ? route.current.params.activeTab : $scope.treeviewIndex == \"/modelsGroup\" ? '设备组模板信息' : '模板信息';\n      });\n    } //$scope.activeTab = '模板信息';\n\n\n    $scope.previousMainTab;\n    $scope.activeListTab = \"tab1\";\n    var initstate = false;\n    var columns = [];\n    var columsData = [];\n    var activeTab;\n    var previousTab;\n    var previousDomainID;\n    var previousDomainPath;\n    var info = Info.get(\"../localdb/icon.json\", function (info) {\n      $scope.iconList = info.qualityIcon;\n      $scope.kpiIconList = info.kpiIcon;\n    });\n\n    var callback = function callback(evendata) {\n      console.log(\"callback:\", evendata);\n      var addDatas = [];\n      $scope.$broadcast('OptionStatusChange', {\n        \"data\": addDatas\n      });\n    };\n\n    var getViewId = function getViewId(pName) {\n      for (var i in viewFlexService.viewList) {\n        var v = viewFlexService.viewList[i];\n\n        if (v.viewType == 'designView' && pName.search(v.viewTitle) > -1) {\n          return v.viewId;\n        }\n      }\n\n      return 0;\n    };\n\n    var getColumns = function getColumns(ary) {\n      for (var i in ary) {\n        var col = ary[i];\n\n        if (col.visible == true || col.visible == \"true\") {\n          var colobj = new Object();\n          colobj.data = col.dataField;\n          colobj.title = col.headerText;\n          columns.push(colobj);\n        }\n      }\n    };\n\n    var formatDate = function formatDate(str) {\n      if (str) {\n        str = newDateJson(str).Format(GetDateCategoryStrByLabel());\n      }\n\n      return str;\n    };\n\n    var getIcon = function getIcon(random) {\n      var icon;\n\n      switch (true) {\n        case random > 0.9:\n          icon = \"fa fa-hospital-o\";\n          break;\n\n        case random > 0.8:\n          icon = \"fa fa-truck\";\n          break;\n\n        case random > 0.7:\n          icon = \"fa fa-tv\";\n          break;\n\n        case random > 0.6:\n          icon = \"fa fa-users\";\n          break;\n\n        case random > 0.5:\n          icon = \"fa fa-bolt\";\n          break;\n\n        case random > 0.4:\n          icon = \"fa fa-bank\";\n          break;\n\n        default:\n          icon = \"fa fa-plus\";\n      }\n\n      return icon;\n    };\n\n    var getIds = function getIds(model) {\n      var solutionId = 0;\n      var groupId = 0;\n      var modelId = 0;\n\n      if ($scope.selectedSolution && $scope.selectedSolution.id) {\n        solutionId = $scope.selectedSolution.id;\n      }\n\n      if ($scope.selectedGroupitem && $scope.selectedGroupitem.id) {\n        groupId = $scope.selectedGroupitem.id;\n      } else {\n        if (model.category == \"DeviceGroup\") {\n          groupId = model.id;\n        }\n      }\n\n      if (model.category != \"DeviceGroup\") {\n        modelId = model.id;\n      }\n\n      return {\n        solutionId: solutionId,\n        groupId: groupId,\n        modelId: modelId\n      };\n    };\n\n    var initDateRanger = function initDateRanger() {\n      return;\n      $('input[name=\"daterange\"]').daterangepicker({\n        timePicker: true,\n        timePicker24Hour: true,\n        autoUpdateInput: true,\n        opens: \"left\",\n        locale: {\n          format: 'YYYY/MM/DD HH:mm:ss'\n        }\n      });\n    };\n\n    var getResourceAttrs = function getResourceAttrs(model, callback) {\n      resourceUIService.getAttrsByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.attrs = returnObj.data;\n          model.isLoaded = model.isLoaded + 1;\n\n          if (callback) {\n            callback();\n          }\n        }\n\n        ;\n      });\n    };\n\n    var getResourceKpis = function getResourceKpis(model) {\n      resourceUIService.getKpisByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.kpis = returnObj.data;\n        }\n\n        ;\n      });\n    };\n\n    var getResourceAlertsAndThresholds = function getResourceAlertsAndThresholds(model) {\n      var ids = getIds(model);\n      solutionUIService.getThresholdsBySolution(ids.solutionId, ids.groupId, ids.modelId, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.alerts = returnObj.data;\n        }\n\n        ;\n      });\n    };\n\n    var getResourceDirectives = function getResourceDirectives(model) {\n      model.directives = [];\n      resourceUIService.getDirectivesByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.directives = returnObj.data;\n        }\n\n        ;\n      });\n    };\n\n    var initModelAtts = function initModelAtts(obj, idx) {\n      obj.count = 0;\n      var random = Math.random();\n      obj.icon = obj.icon ? obj.icon : 'fa fa-building-o';\n      obj.alertlv = \"bg-green\"; //random > 0.75 ? \"bg-red\" : (random > 0.5 ? \"bg-orange\" : (random > 0.25 ? \"bg-yellow\" : \"bg-green\"));\n\n      obj.isLoaded = 0;\n      obj.type = 0;\n      obj.text = obj.label;\n      obj.name = obj.label;\n      if (obj.category == \"DeviceGroup\") obj.canEdit = obj.canEdit;else obj.canEdit = false;\n\n      if (idx != false) {\n        getResourceAttrs(obj);\n        getResourceKpis(obj);\n        getResourceAlertsAndThresholds(obj);\n        getResourceDirectives(obj);\n      }\n\n      return obj;\n    };\n\n    var urmpTree = function urmpTree(ciName) {\n      var handler = function handler(returnObj) {\n        if (returnObj.code == 0) {\n          resourceUIService.rootModelDic = {};\n          $scope.modelListSelect = returnObj.data;\n          var tree = returnObj.data;\n\n          for (var i in tree) {\n            var obj = initModelAtts(tree[i], false);\n            if (!$scope.routePathNodes[obj.parentModelId]) $scope.routePathNodes[obj.parentModelId] = [];\n            $scope.routePathNodes[obj.parentModelId].push(obj);\n            if (!$scope.routePathNodes[obj.id]) $scope.routePathNodes[obj.id] = [];\n            resourceUIService.rootModelDic[obj.id] = obj;\n          }\n\n          var addNodes = function addNodes(parentNode) {\n            for (var modeid in $scope.routePathNodes) {\n              if (modeid == parentNode.id) {\n                parentNode.nodes = $scope.routePathNodes[modeid];\n\n                for (var i in parentNode.nodes) {\n                  addNodes(parentNode.nodes[i]);\n                }\n\n                if (parentNode.nodes.length == 0) {\n                  parentNode.nodes = null;\n                }\n              }\n            }\n          };\n\n          addNodes(resourceUIService.rootModel);\n\n          for (var key in $scope.routePathNodes) {\n            if (key != resourceUIService.rootModel.id && !resourceUIService.rootModelDic[key]) {\n              for (var i in $scope.routePathNodes[key]) {\n                addNodes($scope.routePathNodes[key][i]);\n                if (!resourceUIService.rootModel.nodes) resourceUIService.rootModel.nodes = [];\n                resourceUIService.rootModel.nodes.push($scope.routePathNodes[key][i]);\n              }\n            }\n          }\n\n          resourceUIService.rootModelDic[resourceUIService.rootModel.id] = resourceUIService.rootModel;\n          $scope.rootModelDic = resourceUIService.rootModelDic;\n          $scope.rootModel = resourceUIService.rootModel;\n        }\n      };\n\n      resourceUIService.getModels(function (returnObj) {\n        handler(returnObj);\n      });\n    };\n\n    var reLoader = function reLoader() {\n      $scope.selectedDitem.isLoaded = 1;\n    };\n    /**\n     * 在设备类型模式下切换属性/指标/告警/指令\n     */\n\n\n    var changeDItem = function changeDItem() {\n      var obj = {\n        attrs: [],\n        kpis: [],\n        directives: [],\n        alerts: []\n      };\n\n      if ($scope.selectedDitem && $scope.selectedDitem.id != 0) {\n        obj = $scope.selectedDitem;\n      }\n\n      if ($scope.activeTab == null || $scope.activeTab == \"属性\") {\n        $scope.$broadcast(Event.ATTREDITINIT, {\n          \"data\": obj.attrs\n        });\n      } else if ($scope.activeTab == \"指标\") {\n        $scope.$broadcast(Event.KPIEDITINIT, {\n          \"data\": obj.kpis\n        });\n      } else if ($scope.activeTab == \"告警\") {\n        $scope.$broadcast(Event.ALERTEDITINIT, {\n          \"data\": obj\n        });\n      } else if ($scope.activeTab == \"指令\") {\n        $scope.$broadcast(Event.DIRECTIVESINIT, {\n          \"data\": obj.directives\n        });\n      }\n    };\n\n    $scope.click = function (item) {\n      $scope.selectedDirective = null;\n\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        if ($scope.selectedDitem && $scope.selectedDitem.id == item.id) return;\n\n        for (var i in $scope.routePaths) {\n          if ($scope.selectedDitem && $scope.routePaths[i].id == $scope.selectedDitem.id) {\n            $scope.routePaths.splice(i, 1);\n          }\n        }\n\n        $scope.selectedDitem = item;\n        $scope.routePaths.push(item);\n        $scope.visible = true;\n        changeDItem();\n        $scope.activeListTab = \"tab1\";\n      }\n    };\n\n    $scope.dbClick = function (item) {\n      $scope.selectedDirective = null;\n\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        for (var i in $scope.routePaths) {\n          if ($scope.selectedDitem && $scope.routePaths[i].id == $scope.selectedDitem.id) {\n            $scope.routePaths.splice(i, 1);\n          }\n        }\n\n        $scope.selectedDitem = item;\n        $scope.routePaths.push(item);\n        $scope.visible = true;\n        $scope.activeListTab = \"tab1\";\n        $scope.showChildren(item);\n      }\n    };\n\n    $scope.addModel = function () {\n      if (!$scope.selectedSolution) {\n        growl.warning(\"请选择一个解决方案\", {});\n        return;\n      }\n\n      var parentModel = $scope.selectedSolution;\n      var arr = [];\n\n      for (var i in $scope.treeAry) {\n        var obj = $scope.treeAry[i];\n        arr.push(obj);\n\n        if (obj.id == 0) {\n          growl.warning(\"当前有未保存设备模板\", {});\n          return;\n        }\n      }\n\n      var doAdd = function doAdd(newModelName) {\n        var newModel = {};\n        newModel.label = newModelName;\n        newModel.id = 0;\n        newModel.count = 0;\n        newModel.icon = 'fa fa-building-o';\n        newModel.isLoaded = 0;\n        newModel.resources = [];\n        newModel.solutionId = parentModel.id;\n        newModel.canEdit = true; //          arr.push(newModel);\n\n        arr.unshift(newModel);\n        parentModel.nodes = arr;\n        $scope.treeAry = parentModel.nodes;\n        $scope.click(newModel);\n      };\n\n      doAdd('新建' + parentModel.label + '的设备组');\n    };\n\n    $scope.delModel = function () {\n      if ($scope.selectedDitem.id == 0) {\n        var arr = [];\n\n        for (var i in $scope.treeAry) {\n          if ($scope.treeAry[i].id == 0) {\n            continue;\n          } else {\n            arr.push($scope.treeAry[i]);\n          }\n        }\n\n        $scope.selectedSolution.nodes = arr;\n        $scope.treeAry = $scope.selectedSolution.nodes;\n        if ($scope.treeAry.length > 0) $scope.click($scope.treeAry[0]);else $scope.selectedDitem = null;\n        growl.success(\"删除设备模板成功\", {});\n      } else {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认删除 ' + escape($scope.selectedDitem.label) + ' 模板吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              //判断：若该设备类型关联1个或多个设备，不能删除\n              if ($scope.selectedDitem) {\n                solutionUIService.deleteModelFromSolution($scope.selectedSolution.id, $scope.selectedDitem.id, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    var arr = [];\n\n                    for (var i in $scope.treeAry) {\n                      if ($scope.treeAry[i].id != $scope.selectedDitem.id) {\n                        arr.push($scope.treeAry[i]);\n                      }\n                    }\n\n                    $scope.treeAry = arr;\n                    $scope.selectedSolution.nodes = arr;\n\n                    if ($scope.treeAry.length > 0) {\n                      $scope.click($scope.treeAry[0]);\n                    } else {\n                      $scope.routePaths[$scope.routePaths.length - 1] = {\n                        name: \"\",\n                        parentModelId: $scope.selectedSolution\n                      };\n                      $scope.selectedSolution.nodes = null;\n                      $scope.selectedDitem = null;\n                    }\n\n                    changeDItem();\n                    growl.success(\"删除设备模板成功\");\n                  }\n                });\n              }\n\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n\n    $scope.updateModel = function () {\n      var handlerData = function handlerData(returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in $scope.treeAry) {\n            if ($scope.treeAry[i].id == $scope.selectedDitem.id) {\n              $scope.treeAry[i].label = returnObj.data.label;\n              $scope.treeAry[i].icon = returnObj.data.icon;\n              $scope.selectedDitem.label = returnObj.data.label;\n              $scope.selectedDitem.icon = returnObj.data.icon;\n            }\n          }\n\n          growl.success(\"修改成功\", {});\n        }\n      };\n\n      if ($scope.selectedDitem) {\n        var obj = {};\n        obj.id = $scope.selectedDitem.id;\n        obj.label = $scope.selectedDitem.label;\n        obj.icon = $scope.selectedDitem.icon;\n\n        if ($scope.treeviewIndex == \"/models\") {\n          resourceUIService.updateModel(obj, function (returnObj) {\n            handlerData(returnObj);\n          });\n        } else {\n          solutionUIService.saveGroupModel($scope.selectedDitem.solutionId, $scope.selectedDitem, function (returnObj) {\n            handlerData(returnObj);\n          });\n        }\n      }\n    };\n\n    $scope.modelViewEdit = function () {\n      window.location.href = '../app-sc/index_machine.html#/machine/edit/' + $scope.selectedDitem.dashboardViewId + \"/\" + $scope.selectedDitem.id;\n    };\n\n    $scope.createServiceView = function () {\n      console.log($scope.selectedSolution);\n      var serviceViewId = $scope.selectedSolution.serviceViewId;\n      var ids = getIds($scope.selectedDitem);\n\n      switch (serviceViewId) {\n        case 200:\n          growl.warning(\"通用服务模板无需设计\", {});\n          break;\n\n        case 201:\n          window.location.href = '../app-sc/index_machine.html#/machine/edit/' + ids.solutionId + \"/\" + ids.modelId;\n          break;\n\n        case 202:\n          if (ids.groupId && ids.groupId != 0) {\n            window.location.href = '../app-topo/index.html#/topology/deviceGroupModel/0/' + ids.solutionId + \"/\" + ids.groupId;\n          } else {\n            window.location.href = '../app-topo/index.html#/topology/deviceModel/0/' + ids.solutionId + \"/\" + ids.modelId;\n          }\n\n          break;\n\n        case 203:\n          window.location.href = '../app-sc/index_tongji.html#/tongji/modeledit/' + ids.solutionId + \"/\" + ids.groupId;\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    $scope.saveModelSubItem = function () {\n      for (var i in $scope.treeAry) {\n        if ($scope.selectedDitem.label == $scope.treeAry[i].label && $scope.selectedDitem.id != $scope.treeAry[i].id) {\n          growl.warning(\"当前有重复设备模板名称，请修改\", {});\n          return;\n        }\n      }\n\n      if ($scope.selectedDitem.id == 0) {\n        if ($scope.treeviewIndex == \"/models\") {\n          resourceUIService.addModel($scope.selectedDitem, function (returnObj) {\n            if (returnObj.code == 0) {\n              var arr = [];\n              var obj = initModelAtts(returnObj.data, true);\n\n              for (var i in $scope.selectedSolution.nodes) {\n                if ($scope.selectedSolution.nodes[i].id == 0) {\n                  arr.push(obj);\n                  continue;\n                } else {\n                  arr.push($scope.selectedSolution.nodes[i]);\n                }\n              }\n\n              $scope.selectedSolution.nodes = arr;\n              $scope.treeAry = arr;\n              $scope.click(obj);\n              growl.success(\"新建设备模板成功\", {});\n            }\n          });\n        } else {\n          solutionUIService.saveGroupModel($scope.selectedDitem.solutionId, $scope.selectedDitem, function (returnObj) {\n            if (returnObj.code == 0) {\n              var arr = [];\n              var obj = initModelAtts(returnObj.data, true);\n\n              for (var i in $scope.selectedSolution.nodes) {\n                if ($scope.selectedSolution.nodes[i].id == 0) {\n                  arr.push(obj);\n                  continue;\n                } else {\n                  arr.push($scope.selectedSolution.nodes[i]);\n                }\n              }\n\n              $scope.selectedSolution.nodes = arr;\n              $scope.treeAry = arr;\n              $scope.click(obj);\n              growl.success(\"新建设备组模板成功\", {});\n            }\n          });\n        }\n      } else {\n        $scope.updateModel($scope.selectedDitem);\n      }\n    };\n\n    $scope.kpichangehandler = function (e) {\n      if (e.id == -1) return;\n      $scope.newKpi = {\n        isEdit: 2,\n        canEdit: true,\n        label: \"\",\n        name: \"\",\n        unit: \"\",\n        range: \"\",\n        number: \"\",\n        granularity: \"\",\n        granularityUnit: \"\",\n        option: \"\",\n        id: 0,\n        uid: 0,\n        isNew: true\n      };\n\n      if (e.id != 0) {\n        $scope.newKpi.id = e.id;\n        $scope.newKpi.label = e.label;\n        $scope.newKpi.name = e.name;\n        $scope.newKpi.unit = e.unit;\n        $scope.newKpi.number = e.number;\n        $scope.newKpi.range = e.range;\n        $scope.newKpi.icon = e.icon;\n        $scope.newKpi.granularity = e.granularity;\n        $scope.newKpi.granularityUnit = e.granularityUnit;\n      }\n\n      $scope.addModelSubItem();\n      $scope.select2init();\n    };\n\n    $scope.addModelSubItem = function () {\n      if (!$scope.selectedDitem || $scope.selectedDitem.id == 0) {\n        growl.warning(\"当前设备模板没有保存，无法添加\", {});\n        return;\n      }\n\n      ;\n\n      if ($scope.activeTab == null || $scope.activeTab == \"属性\") {\n        if (!$scope.selectedDitem.attrs) $scope.selectedDitem.attrs = [];\n\n        for (var i = $scope.selectedDitem.attrs.length - 1; i > -1; i--) {\n          if ($scope.selectedDitem.attrs[i].isNew) {\n            if (!$scope.selectedDitem.attrs[i].isDel) {\n              growl.warning(\"当前有未保存属性\", {});\n              return;\n            } else {\n              $scope.selectedDitem.attrs.splice(i, 1);\n            }\n          }\n        }\n\n        var newAttr = {\n          isEdit: 2,\n          canEdit: true,\n          label: \"\",\n          name: \"\",\n          dataType: 0,\n          id: Math.uuid(),\n          isNew: true\n        };\n        $scope.selectedDitem.attrs.push(newAttr);\n        $scope.$broadcast(Event.ATTREDITINIT, {\n          \"data\": $scope.selectedDitem.attrs\n        });\n      } else if ($scope.activeTab == \"指标\") {\n        if (!$scope.selectedDitem.kpis) $scope.selectedDitem.kpis = [];\n\n        for (var i = $scope.selectedDitem.kpis.length - 1; i > -1; i--) {\n          if ($scope.newKpi.id == $scope.selectedDitem.kpis[i].id) {\n            growl.warning(\"该指标在设备模板中已经使用\", {});\n            return;\n          }\n\n          if ($scope.selectedDitem.kpis[i].isNew) {\n            if (!$scope.selectedDitem.kpis[i].isDel) {\n              growl.warning(\"当前有未保存指标\", {});\n              return;\n            } else {\n              $scope.selectedDitem.kpis.splice(i, 1);\n            }\n          }\n        }\n\n        $scope.selectedDitem.kpis.push($scope.newKpi);\n        $scope.$broadcast(Event.KPIEDITINIT, {\n          \"data\": $scope.selectedDitem.kpis\n        });\n      } else if ($scope.activeTab == \"告警\") {\n        if (!$scope.selectedDitem.alerts) $scope.selectedDitem.alerts = [];\n\n        for (var i = $scope.selectedDitem.alerts.length - 1; i > -1; i--) {\n          if ($scope.selectedDitem.alerts[i].isNew) {\n            if (!$scope.selectedDitem.alerts[i].isDel) {\n              growl.warning(\"当前有未保存告警\", {});\n              return;\n            } else {\n              $scope.selectedDitem.alerts.splice(i, 1);\n            }\n          }\n        }\n\n        var newAlert = {\n          isEdit: 2,\n          canEdit: true,\n          label: \"\",\n          name: \"\",\n          description: \"\",\n          option: \"\",\n          id: Math.uuid(),\n          isNew: true\n        };\n        $scope.selectedDitem.alerts.push(newAlert);\n        $scope.$broadcast(Event.ALERTEDITINIT, {\n          \"data\": $scope.selectedDitem\n        });\n      } else if ($scope.activeTab == \"指令\") {\n        if (!$scope.selectedDitem.directives) $scope.selectedDitem.directives = [];\n\n        for (var i = $scope.selectedDitem.directives.length - 1; i > -1; i--) {\n          if ($scope.selectedDitem.directives[i].isNew) {\n            if (!$scope.selectedDitem.directives[i].isDel) {\n              growl.warning(\"当前有未保存指令\", {});\n              return;\n            } else {\n              $scope.selectedDitem.directives.splice(i, 1);\n            }\n          }\n        }\n\n        var newDir = {\n          isEdit: 2,\n          canEdit: true,\n          label: \"\",\n          name: \"\",\n          description: \"\",\n          option: \"\",\n          expression: \"\",\n          protocolType: \"\",\n          id: 0,\n          isNew: true\n        };\n        $scope.selectedDitem.directives.push(newDir);\n        $scope.$broadcast(Event.DIRECTIVESINIT, {\n          \"data\": $scope.selectedDitem.directives\n        });\n      }\n    };\n\n    $scope.attrLabel = \"\"; //属性显示名称\n\n    $scope.iconClick = function (type, indexId, thisId) {\n      if ($(\"#label\" + indexId + \"\").val() != \"图标\") {\n        $scope.attrLabel = $(\"#label\" + indexId + \"\").val();\n      }\n\n      if (type == 'icon') {\n        $(\"#label\" + indexId + \"\").val(\"图标\");\n        $(\"#label\" + indexId + \"\").attr(\"disabled\", true);\n        $scope.selectedDitem.attrs[indexId].label = \"图标\";\n      } else {\n        if ($(\"#label\" + indexId + \"\").val() == \"图标\") {\n          $(\"#label\" + indexId + \"\").val($scope.attrLabel);\n        }\n\n        $(\"#label\" + indexId + \"\").attr(\"disabled\", false);\n      }\n    };\n    /**\n     * datatables内部操作处理\n     * @param {Object} type\n     * @param {Object} select\n     */\n\n\n    $scope.doAction = function (type, select, callback) {\n      //增加三种视图（设备类型，资源域，网关）显示页的判断\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        if (type == \"save\") {\n          select.isEdit = 0;\n\n          if (select.id == 0) {\n            var addData = {};\n            addData.label = select.label;\n            addData.id = select.id;\n            addData.values = select.values;\n            addData.modelId = $scope.selectedDitem.id;\n            resourceUIService.addResource(addData, function (returnObj) {\n              if (returnObj.code == 0) {\n                reLoader();\n                growl.success(\"保存成功\", {});\n              }\n            });\n          } else if (select.id > 0) {\n            var updataData = select.data;\n            updataData.label = select.label;\n            updataData.id = select.id;\n            updataData.values = select.values;\n            resourceUIService.updateDevice(updataData, function (returnObj) {\n              if (returnObj.code == 0) {\n                reLoader();\n                growl.success(\"保存成功\", {});\n              }\n            });\n          }\n        } else if (type == \"cancel\") {\n          for (var i in resourceUIService.selectedInstances) {\n            resourceUIService.selectedInstances[i][\"isEdit\"] = 0;\n          }\n\n          $scope.$broadcast(Event.CMDBINFOSINIT, {\n            \"option\": [resourceUIService.selectedInstances, $scope.selectedDitem.attrs]\n          });\n        } else if (type == \"delete\") {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '是否要删除设备:' + escape(select.label) + '',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                resourceUIService.deleteResource(select.id, function (resultObj) {\n                  if (resultObj.code == 0) {\n                    reLoader();\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == \"change\") {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '是否要改变设备状态为:' + (select.state == 1 ? '离线' : '在线') + '',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                for (var i in resourceUIService.selectedInstances) {\n                  if (resourceUIService.selectedInstances[i].id == select.id) {\n                    if (select.state == 1) {\n                      resourceUIService.selectedInstances[i].state = 0;\n                    } else {\n                      resourceUIService.selectedInstances[i].state = 1;\n                    }\n                  }\n                }\n\n                $scope.$broadcast(Event.CMDBINFOSINIT, {\n                  \"option\": [resourceUIService.selectedInstances, resourceUIService.selectedAttrs]\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == \"eidterror\") {\n          growl.warning(\"当前有正在编辑的设备\", {});\n        } else if (type == \"directive\") {\n          location.href = '#directiveview/' + select.data.modelId + '/' + select.id;\n        } else if (type == \"message\") {} else if (type == 'thresholdMessage') {\n          growl.warning(select, {});\n        } else if (type == 'kpi-delete') {\n          if (select.isNew) {\n            for (var i in $scope.selectedDitem.kpis) {\n              if (select.id == $scope.selectedDitem.kpis[i].id) {\n                $scope.selectedDitem.kpis.splice(i, 1);\n                callback(true);\n                break;\n              }\n            }\n          } else {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              //size:BootstrapDialog.SIZE_WIDE,\n              message: '是否要删除设备指标:' + escape(select.name) + '',\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  resourceUIService.deleteKpi($scope.selectedDitem.id, select.id, function (resultObj) {\n                    if (resultObj.code == 0) {\n                      for (var i in $scope.selectedDitem.kpis) {\n                        if (select.id == $scope.selectedDitem.kpis[i].id) {\n                          $scope.selectedDitem.kpis.splice(i, 1);\n                          callback(true);\n                          break;\n                        }\n                      }\n\n                      growl.success(\"指标删除成功\", {});\n                    }\n                  });\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  callback(false);\n                  dialogRef.close();\n                }\n              }]\n            });\n          }\n        } else if (type == 'kpi-save') {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '是否要保存设备指标:' + escape(select.name) + '',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                resourceUIService.saveKpi($scope.selectedDitem.id, select, function (resultObj) {\n                  if (resultObj.code == 0) {\n                    callback(resultObj.data);\n                    growl.success(\"指标保存成功\", {});\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                callback(false);\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == 'attr-delete') {\n          if (select.isNew) {\n            for (var i in $scope.selectedDitem.attrs) {\n              if (select.id == $scope.selectedDitem.attrs[i].id) {\n                $scope.selectedDitem.attrs.splice(i, 1);\n                callback(true);\n                break;\n              }\n            }\n          } else {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              //size:BootstrapDialog.SIZE_WIDE,\n              message: '是否要删除设备属性:' + escape(select.name) + '',\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  resourceUIService.deleteAttr($scope.selectedDitem.id, select.id, function (resultObj) {\n                    if (resultObj.code == 0) {\n                      for (var i in $scope.selectedDitem.attrs) {\n                        if (select.id == $scope.selectedDitem.attrs[i].id) {\n                          $scope.selectedDitem.attrs.splice(i, 1);\n                          callback(true);\n                          break;\n                        }\n                      }\n\n                      growl.success(\"属性删除成功\", {});\n                    }\n                  });\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  callback(false);\n                  dialogRef.close();\n                }\n              }]\n            });\n          }\n        } else if (type == 'attr-save') {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '是否要保存设备属性:' + escape(select.name) + '',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                if (select.isNew) select.id = 0;\n                select.modelId = $scope.selectedDitem.id;\n                resourceUIService.saveAttr($scope.selectedDitem.id, select, function (resultObj) {\n                  if (resultObj.code == 0) {\n                    callback(resultObj.data);\n                    growl.success(\"属性保存成功\", {});\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                callback(false);\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == 'directive-delete') {\n          if (select.isNew) {\n            for (var i in $scope.selectedDitem.directives) {\n              if (select.id == $scope.selectedDitem.directives[i].id) {\n                $scope.selectedDitem.directives.splice(i, 1);\n                callback(true);\n                break;\n              }\n            }\n          } else {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              //size:BootstrapDialog.SIZE_WIDE,\n              message: '是否要删除设备指令:' + escape(select.label) + '',\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  resourceUIService.deleteDirective($scope.selectedDitem.id, select.id, function (resultObj) {\n                    if (resultObj.code == 0) {\n                      for (var i in $scope.selectedDitem.directives) {\n                        if (select.id == $scope.selectedDitem.directives[i].id) {\n                          $scope.selectedDitem.directives.splice(i, 1);\n                          callback(true);\n                          break;\n                        }\n                      }\n\n                      growl.success(\"指令删除成功\", {});\n                    }\n                  });\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  callback(false);\n                  dialogRef.close();\n                }\n              }]\n            });\n          }\n        } else if (type == 'directive-save') {\n          if (!callback) {\n            //参数关联修改后自动保存\n            resourceUIService.saveDirective($scope.selectedDitem.id, select, function (resultObj) {\n              if (resultObj.code == 0) {\n                $scope.selectedDirective = null;\n\n                for (var i in $scope.selectedDitem.directives) {\n                  if (select.id == $scope.selectedDitem.directives[i].id) {\n                    $scope.selectedDitem.directives[i].params = select.params;\n                    break;\n                  }\n                }\n              }\n            });\n            return;\n          }\n\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '是否要保存设备指令:' + escape(select.label) + '',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                if (select.isNew) select.id = 0;\n                if ($scope.selectedDirective) select.params = $scope.selectedDirective.params;\n                resourceUIService.saveDirective($scope.selectedDitem.id, select, function (resultObj) {\n                  if (resultObj.code == 0) {\n                    callback(resultObj.data);\n                    growl.success(\"指令保存成功\", {});\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                callback(false);\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == \"directive-params\") {\n          resourceUIService.checkDirectiveParam(select, function (returnObj) {\n            if (returnObj.code == 0) {\n              if (returnObj.data.params.length > 0) {\n                $scope.selectedDirective = returnObj.data;\n              } else {\n                growl.info(\"当前表达式无法解析出参数\", {});\n              }\n            }\n          });\n        } else if (type == 'alert-delete') {\n          if (select.isNew) {\n            for (var i in $scope.selectedDitem.alerts) {\n              if (select.id == $scope.selectedDitem.alerts[i].id) {\n                $scope.selectedDitem.alerts.splice(i, 1);\n                callback(true);\n                break;\n              }\n            }\n          } else {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              //size:BootstrapDialog.SIZE_WIDE,\n              message: '是否要删除设备告警:' + escape(select.label) + '',\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  var ids = getIds($scope.selectedDitem);\n                  solutionUIService.deleteThresholdBySolution(ids.solutionId, ids.groupId, ids.modelId, select.id, function (resultObj) {\n                    if (resultObj.code == 0) {\n                      for (var i in $scope.selectedDitem.alerts) {\n                        if (select.id == $scope.selectedDitem.alerts[i].id) {\n                          $scope.selectedDitem.alerts.splice(i, 1);\n                          callback(true);\n                          break;\n                        }\n                      }\n\n                      growl.success(\"告警删除成功\", {});\n                    }\n                  });\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  callback(false);\n                  dialogRef.close();\n                }\n              }]\n            });\n          }\n        } else if (type == 'alert-save') {\n          if (select.isEdit == 2 && select.isNew) select.id = 0;\n          var ids = getIds($scope.selectedDitem);\n          solutionUIService.saveThresholdBySolution(ids.solutionId, ids.groupId, ids.modelId, select, function (resultObj) {\n            if (resultObj.code == 0) {\n              callback(resultObj.data);\n              growl.success(\"告警保存成功\", {});\n            }\n          });\n        } else if (type == 'alert-enable') {\n          var enabled = \"停用\";\n\n          if (select.thresholds[0][\"enabled\"]) {\n            enabled = \"启用\";\n          }\n\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            message: '确认要' + enabled + '设备告警:' + escape(select.label) + '?',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                resourceUIService.saveThresholdsByAlert($scope.selectedDitem.id, select, function (resultObj) {\n                  if (resultObj.code == 0) {\n                    callback(resultObj.data);\n                    growl.success(\"告警已\" + enabled, {});\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                callback(false);\n                dialogRef.close();\n              }\n            }]\n          });\n        }\n      }\n    };\n\n    var changeDomainItem = function changeDomainItem() {\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        $scope.activeTab = '属性';\n        $scope.activeListTab = \"tab1\";\n        urmpTree();\n      }\n\n      $scope.$apply();\n    };\n\n    var changeTabItem = function changeTabItem() {\n      $scope.$apply();\n\n      if ($scope.activeListTab == \"tab2\") {\n        $timeout(function () {\n          $scope.$broadcast(Event.CMDBINFOS4MAPINIT, {\n            \"option\": [resourceUIService.selectedInstances, resourceUIService.selectedAttrs]\n          });\n        });\n      }\n    };\n\n    $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n      $scope.selectedDirective = null;\n      var aname = $(e.target).attr(\"name\");\n      var targetText = $(e.target).text();\n\n      if (!aname) {\n        if (targetText.search(\"视图\") > -1) {\n          // 获取已激活主页的名称\n          $scope.activeMainTab = $.trim($(e.target).text()); // 获取前一个激活的主页的名称\n\n          $scope.previousMainTab = $(e.relatedTarget).text();\n          changeDomainItem();\n        } else {\n          // 获取已激活的标签页的名称\n          $scope.activeTab = $.trim($(e.target).text()); // 获取前一个激活的标签页的名称\n\n          previousTab = $.trim($(e.relatedTarget).text());\n          changeDItem();\n        }\n      } else {\n        $scope.activeListTab = aname;\n        changeTabItem();\n      }\n    });\n\n    var initEvent = function initEvent() {\n      //\t\t   \t\t$('a[data-toggle=\"tab\"]').off('shown.bs.tab');\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        $scope.selectedDirective = null;\n        var aname = $(e.target).attr(\"name\");\n        var targetText = $(e.target).text();\n\n        if (!aname) {\n          if (targetText.search(\"视图\") > -1) {\n            // 获取已激活主页的名称\n            $scope.activeMainTab = $.trim($(e.target).text()); // 获取前一个激活的主页的名称\n\n            $scope.previousMainTab = $(e.relatedTarget).text();\n            changeDomainItem();\n          } else {\n            // 获取已激活的标签页的名称\n            $scope.activeTab = $.trim($(e.target).text()); // 获取前一个激活的标签页的名称\n\n            previousTab = $.trim($(e.relatedTarget).text());\n            changeDItem();\n          }\n        } else {\n          $scope.activeListTab = aname;\n          changeTabItem();\n        }\n      });\n    };\n\n    $scope.gotoPath = function (item) {\n      if (item.nodes == $scope.treeAry) return;\n      var newAry = [];\n\n      for (var i in $scope.routePaths) {\n        if ($scope.routePaths[i].id == item.id) {\n          newAry.push($scope.routePaths[i]);\n          break;\n        }\n\n        newAry.push($scope.routePaths[i]);\n      }\n\n      $scope.routePaths = newAry;\n      $scope.showChildren(item);\n    };\n    /**\n     * 显示父节点\n     * @param {Object} item\n     */\n\n\n    $scope.gotoParentPath = function (item) {\n      var parent = $scope.rootModelDic[item.parentModelId];\n\n      if (!parent) {\n        parent = $scope.rootModel;\n      }\n\n      var newAry = [];\n\n      for (var i in $scope.routePaths) {\n        if ($scope.routePaths[i].id == parent.id) {\n          newAry.push($scope.routePaths[i]);\n          break;\n        }\n\n        newAry.push($scope.routePaths[i]);\n      }\n\n      $scope.routePaths = newAry;\n      $scope.treeAry = parent.nodes;\n      $scope.selectedSolution = parent;\n      $scope.click($scope.treeAry[0]);\n    };\n    /**\n     * 显示兄弟节点\n     * @param {Object} item\n     */\n\n\n    $scope.gotoBrotherPath = function (item) {\n      if (item.nodes == $scope.treeAry) return;\n      var newAry = [];\n\n      for (var i in $scope.routePaths) {\n        if ($scope.routePaths[i].parentModelId == item.parentModelId) {\n          newAry.push(item);\n          break;\n        }\n\n        newAry.push($scope.routePaths[i]);\n      }\n\n      $scope.routePaths = newAry;\n      $scope.showChildren(item);\n    };\n\n    $scope.showChildren = function (item) {\n      if (item.id == 0) {\n        growl.warning(\"但前设备模板没有保存，无法进行该操作\", {});\n        return;\n      }\n\n      if (item.nodes && item.nodes.length > 0) {\n        $scope.selectedSolution = item;\n        $scope.selectedDitem = null;\n        $scope.treeAry = item.nodes;\n        $scope.click($scope.treeAry[0]);\n      } else {\n        if ($location.path() == \"/resource_type\" && $scope.enterpriseType == 0) {\n          $scope.selectedSolution = item;\n          $scope.selectedDitem = null;\n          changeDItem();\n          $scope.treeAry = [];\n          $scope.routePaths.push({\n            name: \"\",\n            parentModelId: $scope.selectedSolution.id\n          });\n        }\n      }\n    };\n\n    $scope.directiveBack = function () {\n      $scope.doAction(\"directive-save\", $scope.selectedDirective);\n    };\n\n    $scope.saveThresholds = function (modelData, alertCode, thresholds) {\n      resourceUIService.saveThresholds(thresholds, function (returnObj) {\n        if (returnObj.code == 0) {\n          growl.success(\"阈值设置保存成功\", {});\n          var hasThreshold = false;\n\n          for (var i = 0; i < modelData.thresholds.length; i++) {\n            if (modelData.thresholds[i].alertCode == alertCode) {\n              modelData.thresholds[i].thresholdsData = returnObj.data;\n              hasThreshold = true;\n              break;\n            }\n          }\n\n          if (!hasThreshold) {\n            modelData.thresholds.push({\n              \"alertCode\": alertCode,\n              \"thresholdsData\": returnObj.data\n            });\n          }\n        }\n      });\n    }; //用户管理数据初始化\n\n\n    var getDBdata = function getDBdata() {\n      //客户管理\n      userEnterpriseService.queryCustomer(function (resultObj) {\n        if (resultObj.code == 0) {\n          for (var i in resultObj.data) {\n            var obj = resultObj.data[i];\n            obj.isEdit = 0;\n\n            if (obj.customerEmail == null || obj.customerEmail == \"\") {\n              obj[\"customerEmail\"] = obj.customerPhone;\n            } else {\n              obj[\"customerEmail\"] = obj.customerEmail;\n            }\n          }\n\n          $scope.userGridData = resultObj.data;\n        }\n      });\n    };\n\n    var getSearchResourceState = function getSearchResourceState(ids, selectedInstances) {\n      kpiDataService.getRealTimeKpiData(ids, [999999], function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            for (var j in selectedInstances) {\n              if (returnObj.data[i].nodeId == selectedInstances[j].id) {\n                selectedInstances[j].health = 100 - returnObj.data[i].value * 20;\n              }\n            }\n          }\n        }\n\n        $scope.$broadcast(Event.CMDBINFOSINIT + \"_shadows\", {\n          \"option\": selectedInstances\n        });\n      });\n    };\n\n    $scope.goSearch = function () {\n      //      resourceUIService.getDeviceShadowsByFilter($scope.queryDitem,function(returnObj){\n      if (!$scope.queryDitem) {\n        $scope.queryDitem = {\n          domainPath: null,\n          modelId: 0\n        };\n      }\n\n      resourceUIService.getCustomerDeviceByFilter($scope.queryDitem, function (returnObj) {\n        if (returnObj.code == 0) {\n          var nodeIds = [];\n\n          for (var i in returnObj.data) {\n            var newObj = returnObj.data[i];\n            newObj.option = \"\";\n            newObj.state = 1;\n            newObj.onlineStatus = newObj.onlineStatus ? newObj.onlineStatus : 'online';\n            newObj.alertlv = Math.floor(Math.random() * 4);\n            newObj.externalDevId = newObj.externalDevId ? newObj.externalDevId : \"\";\n            newObj.data = newObj;\n            newObj.health = 100;\n            newObj.isEdit = 0;\n            newObj.selected = false;\n            nodeIds.push(newObj.id);\n          }\n\n          getSearchResourceState(nodeIds, returnObj.data);\n          $scope.$broadcast(Event.CMDBINFOSINIT + \"_shadows\", {\n            \"option\": returnObj.data\n          });\n        }\n      });\n    };\n\n    $scope.goClear = function () {\n      $scope.queryDitem = {\n        domainPath: null,\n        modelId: 0\n      };\n    };\n\n    $scope.placeList = [];\n    $scope.selectedSolution = {};\n    var dialog;\n    $scope.deviceModel = 0;\n\n    $scope.changeModel = function (n) {\n      $scope.deviceModel = n;\n    };\n\n    $scope.gotoResourceType = function () {\n      dialog.close();\n      location.href = \"../app-oc/index.html#/resource_type\";\n    };\n\n    $scope.closeDialog = function () {\n      $scope.deviceModel = 0;\n    };\n\n    $scope.confirm = function () {\n      if (!$scope.deviceModel > 0) {\n        growl.warning(\"请选择一个设备模板\", {});\n        return;\n      }\n\n      for (var i in $scope.treeAry) {\n        if ($scope.deviceModel == $scope.treeAry[i].id) {\n          growl.warning(\"当前已经关联该设备模板，请重新选择\", {});\n          return;\n        }\n      }\n\n      var handlerData = function handlerData(obj) {\n        if (!$scope.treeAry) $scope.treeAry = [];\n        initModelAtts(obj);\n        $scope.treeAry.push(obj);\n        $scope.click(obj);\n        $scope.deviceModel = 0;\n      };\n\n      if ($scope.selectedSolution.managedByGroup == 0) {\n        solutionUIService.linkModelToSolution($scope.selectedSolution.id, $scope.deviceModel, function (returnObj) {\n          if (returnObj.code == 0) {\n            handlerData(returnObj.data);\n          }\n        });\n      } else {\n        solutionUIService.linkModelToGroupModel($scope.selectedSolution.id, $scope.selectedGroupitem.id, $scope.deviceModel, function (returnObj) {\n          if (returnObj.code == 0) {\n            handlerData(returnObj.data);\n          }\n        });\n      }\n\n      dialog.close();\n    };\n\n    $scope.deleteDeviceModel = function () {\n      var handlerData = function handlerData(obj) {\n        for (var i in $scope.treeAry) {\n          if ($scope.treeAry[i].id == obj.id) {\n            $scope.treeAry.splice(i, 1);\n            break;\n          }\n        }\n\n        if ($scope.treeAry.length > 0) {\n          $scope.click($scope.treeAry[0]);\n        } else {\n          $scope.selectedDitem = null;\n        }\n      };\n\n      var permission = function permission() {\n        if ($scope.selectedSolution.managedByGroup == 0) {\n          solutionUIService.deleteModelFromSolution($scope.selectedSolution.id, $scope.selectedDitem.id, function (returnObj) {\n            if (returnObj.code == 0) {\n              handlerData(returnObj.data);\n            }\n          });\n        } else {\n          solutionUIService.deleteModelFromGroupModel($scope.selectedSolution.id, $scope.selectedGroupitem.id, $scope.selectedDitem.id, function (returnObj) {\n            if (returnObj.code == 0) {\n              handlerData(returnObj.data);\n            }\n          });\n        }\n      };\n\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: '确认解除 ' + escape($scope.selectedDitem.label) + ' 模板吗？',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            permission();\n            dialogRef.close();\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.addDeviceModel = function () {\n      dialog = ngDialog.open({\n        template: 'partials/device-info.html',\n        //        className: 'ngdialog-theme-plain ',\n        scope: $scope\n      });\n    };\n\n    $scope.linkDevices = function () {\n      $rootScope.selectedGroupitem = $scope.selectedDitem;\n      $rootScope.groupModels = $scope.treeAry;\n      location.href = \"#/models\";\n    };\n\n    var changehanderdata = function changehanderdata(nodes) {\n      for (var i in nodes) {\n        initModelAtts(nodes[i]);\n        if (i == 0) $scope.click(nodes[0]);\n      }\n\n      $scope.treeAry = nodes;\n    };\n\n    var getModelsByGroupId = function getModelsByGroupId(callbackfun) {\n      solutionUIService.getModelsByGroupId($scope.selectedSolution.id, $scope.selectedGroupitem.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          callbackfun(returnObj.data);\n        }\n      });\n    };\n\n    var getGroupModelsBySolutionId = function getGroupModelsBySolutionId(callbackfun) {\n      solutionUIService.getGroupModelsBySolutionId($scope.selectedSolution.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          callbackfun(returnObj.data);\n        }\n      });\n    };\n\n    var getDeviceModelsBySolutionId = function getDeviceModelsBySolutionId(callbackfun) {\n      solutionUIService.getDeviceModelsBySolutionId($scope.selectedSolution.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          callbackfun(returnObj.data);\n        }\n      });\n    };\n\n    $scope.solutionChange = function (auto) {\n      $rootScope.selectedSolution = $scope.selectedSolution;\n\n      if ($scope.treeviewIndex == \"/models\") {\n        //在设备模板界面\n        if ($scope.selectedSolution.managedByGroup == 1) {\n          //当前为设备组模式\n          if (auto && $rootScope.groupModels) {\n            //有group\n            $scope.selectedGroupitem = $rootScope.selectedGroupitem;\n            $scope.groupModels = $rootScope.groupModels;\n          } else {\n            $rootScope.groupModels = null;\n            getGroupModelsBySolutionId(function (returnVal) {\n              $scope.groupModels = returnVal;\n            });\n          }\n        } else {\n          //当前为设备模式\n          getDeviceModelsBySolutionId(changehanderdata);\n        }\n      } else if ($scope.treeviewIndex == \"/modelsGroup\") {\n        //在设备组模板界面\n        if ($scope.selectedSolution.managedByGroup == 1) {\n          $rootScope.selectedGroupitem = null;\n          $rootScope.groupModels = null;\n          getGroupModelsBySolutionId(changehanderdata);\n        } else {\n          growl.warning(\"该解决方案的类型为[设备]',无法使用[关联设备组]菜单\");\n          location.href = \"#/models\"; //跳转到设备组处理\n        }\n      }\n    };\n\n    $scope.groupChange = function (auto) {\n      if ($scope.treeviewIndex == \"/models\") {\n        //在设备模板界面\n        if ($scope.selectedSolution.managedByGroup == 1) {\n          //当前为设备组模式\n          if (auto && $rootScope.selectedGroupitem) {\n            //有group\n            $scope.selectedGroupitem = $rootScope.selectedGroupitem;\n          }\n        }\n\n        if ($scope.selectedGroupitem) {\n          getModelsByGroupId(changehanderdata);\n        } else {\n          $scope.treeAry = null;\n          $scope.selectedDitem = null;\n        }\n      }\n    };\n\n    var getSolutions = function getSolutions() {\n      solutionUIService.getSolutionsByStatus(10, function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.forEach(function (item) {\n            $scope.placeList.push(item);\n          });\n          $rootScope.placeList = $scope.placeList;\n        }\n      });\n    };\n\n    var getSolutionsModelsGroup = function getSolutionsModelsGroup() {\n      if ($rootScope.placeList && $rootScope.placeList.length > 0) {\n        $scope.placeList = $rootScope.placeList;\n      } else {\n        getSolutions();\n      }\n\n      if ($rootScope.selectedGroupitem) {\n        $scope.groupModels = $rootScope.groupModels;\n      }\n\n      if ($rootScope.selectedSolution) {\n        $scope.selectedSolution = $rootScope.selectedSolution;\n        $scope.solutionChange(true);\n        $scope.groupChange(true);\n      } else {\n        location.href = \"#/myView\";\n      }\n    };\n\n    $scope.designDashboardView = function () {\n      var ids = getIds($scope.selectedDitem);\n      window.open(\"../app-editor2/index.html#/editor/solution/\" + ids.solutionId + \"/\" + ids.groupId + \"/\" + ids.modelId);\n    };\n\n    var init = function init() {\n      if (initstate) return;\n      $scope.domainPath = userLoginUIService.user.domainPath;\n      initstate = true;\n      resourceUIService.rootModel = null;\n\n      if (resourceUIService.rootModel == null) {\n        resourceUIService.getRootModel(function (returnObj) {\n          if (returnObj.code == 0) {\n            returnObj.data.name = returnObj.data.label;\n            returnObj.data.text = returnObj.data.label;\n            resourceUIService.rootModel = returnObj.data;\n            urmpTree();\n            getSolutionsModelsGroup();\n          }\n        });\n      } else {\n        $scope.rootModelDic = resourceUIService.rootModelDic;\n        $scope.rootModel = resourceUIService.rootModel;\n        getSolutionsModelsGroup();\n      }\n\n      resourceUIService.getKpiTypeByFilter({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          var newObj = [];\n          newObj.push({\n            text: '请选择',\n            label: '请选择',\n            id: -1\n          });\n          newObj.push({\n            text: '手动添加指标',\n            label: '手动添加指标',\n            id: 0\n          });\n          returnObj.data.forEach(function (obj) {\n            obj.text = obj.label;\n            newObj.push(obj);\n          });\n          $scope.kpiList = newObj;\n        }\n      });\n      initEvent();\n    };\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]);\n});"],"sourceRoot":"/source/"}