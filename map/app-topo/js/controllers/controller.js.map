{"version":3,"sources":["app-topo/js/controllers/controller.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","angular","module","controller","scope","rootScope","lm","loading","undefined","loginList","name","password","sitem","login","item","userLoginUIService","getviews","loc","deleteViews","unregisterDevice","route","userInfo","user","then","event","result","i","data","viewType","innerData","JSON","parse","content","clone","stringify","push","viewList","error","console","log","getLocation","viewClick","view","selectView","elements","addNewTopo","path","deleteChart","viewId","gatewayId","deviceId","backTolist","renderImage","unit","background-image","elemCLick","elem","selectedElement","elePos","top","left","popPos","popClose","timeout","kpiDataService","getSimpleDistricts","window","q","resourceUIService","viewFlexService","solutionUIService","serviceCenterService","deferred","promise","localSearch","currentView","solutionId","id","$modelGroup","cur","this","defer","resource","arguments","attributesDes","getAttrsByModelId","code","message","Object","defineProperty","enumerable","attribute","value","province","city","district","arr","split","$Address","all","find","element","label","children","setPosition","resolve","err","reject","step","saveloading","require","Bmap","editResource","model","resources","getBymodelId","getAllGateways","remap","map","gateways","concat","openResourceSelect","receive","modelId","models","resourceSelect","resourcesArray","filter","kpiArray","some","kpi","show","selectResource","resourceClose","onChange","changeProvince","changeCity","changeDistrict","equipment","modelGroup","keyword","search","setSearchCompleteCallback","searchResult","$apply","wr","lat","point","lng","latitude","longitude","$models","getAll","cached","getModels","$DeviceGroupModels","get","getDeviceGroupModels","lib","dropDeviceGroup","ui","offset","draggable","$","attr","kpiId","resourceId","object","create","remove","receivedList","received","kpiSource","title","writable","instance","dropDevice","rArrList","dropDeviceGroupModel","kpiArrays","run","params","current","DeviceMode","mode","onDrop","parseInt","back","backsolution","backService","flag","getAllMyViews","Array","dt","nodeId","bgImgId","saveAndExit","updateAsDevice","runAsDevice","call","saveAsDevice","saveAsDeviceModel","runAsDeviceModel","updateAsDeviceGroup","runAsDeviceGroup","saveAsDeviceGroup","saveAsDeviceGroupModel","runAsDeviceGroupModel","icon","saveServiceViewContent","location","href","temlateView","getServiceViewMap","getResource","getResourceById","device","test","getModelByIds","returnObj","getKpisByModelId","forEach","res","fold","used","userkpi","index","isArray","length","deviceModelId","getServiceViewContent","kpis","deviceGroupModelId","getModelsByGroupId","unfold","bool","j","deviceGroupId","attrsFn","modelGroups","values","nextStep","defers","callback","ele","findRes","param","viewTitle","viewName","addView","originalViewId","updateView","saveDataFn","attrName","val","deviceGroup","saveDeviceGroup","deviceToGroup","saveDeviceToGroups","hasEmpty","msg","btnlist","text","fn","kpiIcon","channelType","sensorIcon","prevStep_Btn","accomplished","open","bgSel_click","createNewGraph","reload","renderBgImg","bgSelect","backgroundImage","$on"],"mappings":"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","file":"app-topo/js/controllers/controller.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine([\"angular\"], function (angular) {\n  var module = angular.module(\"myapp\");\n  module.controller(\"loginController\", [\"$scope\", \"$rootScope\", \"loginManagement\", function (scope, rootScope, lm) {\n    rootScope.loading = undefined;\n    scope.loginList = [{\n      \"name\": \"wangxingbo@proudsmart.com\",\n      \"password\": \"abc123\"\n    }, {\n      \"name\": \"ps@ps.com\",\n      \"password\": \"abc1234\"\n    }, {\n      \"name\": \"394160008@qq.com\",\n      \"password\": \"@WSX3edc\"\n    }, {\n      \"name\": \"zhangjiang79@qq.com\",\n      \"password\": \"1q2w3e4r\"\n    }, {\n      \"name\": \"adomain@test.com\",\n      \"password\": \"1q2w3e4r\"\n    }, {\n      \"name\": \"1203538033@qq.com\",\n      \"password\": \"lin664181\"\n    }, {\n      \"name\": \"18611560122\",\n      \"password\": \"abc123\"\n    }];\n    scope.sitem = scope.loginList[0];\n\n    scope.login = function (item) {\n      lm.login(item);\n    };\n  }]);\n  module.controller(\"toposhowController\", [\"$scope\", \"userLoginUIService\", \"$rootScope\", \"getviews\", \"$location\", \"deleteViews\", \"unregisterDevice\", \"$route\", function (scope, userLoginUIService, rootScope, getviews, loc, deleteViews, unregisterDevice, route) {\n    rootScope.loading = false;\n    scope.userInfo = userLoginUIService.user;\n    getviews.then(function success(event) {\n      var result = [];\n\n      for (var i in event.data) {\n        if (event.data[i].viewType == \"topology\") {\n          var innerData = JSON.parse(event.data[i].content);\n          var clone = JSON.parse(JSON.stringify(event.data[i]));\n          clone.content = innerData;\n          result.push(clone);\n        }\n      }\n\n      scope.viewList = result;\n    }, function error(error) {\n      console.log(error);\n    });\n    scope.getLocation = undefined;\n    scope.viewClick = viewClick;\n    scope.addNewTopo = addNewTopo;\n    scope.deleteChart = deleteChart;\n    scope.backTolist = backTolist;\n    scope.renderImage = renderImage;\n    scope.elemCLick = elemCLick;\n    scope.elePos = elePos;\n    scope.popPos = popPos;\n    scope.popClose = popClose;\n\n    function popClose() {\n      scope.selectedElement = undefined;\n    }\n\n    function elePos(top, left) {\n      return {\n        top: top + \"px\",\n        left: left + \"px\"\n      };\n    }\n\n    function popPos(top, left) {\n      return {\n        top: top - 120 + \"px\",\n        left: left - 40 + \"px\"\n      };\n    }\n\n    function elemCLick(elem) {\n      scope.selectedElement = elem;\n    }\n\n    function renderImage(unit) {\n      switch (unit) {\n        case \"Amount\":\n          return {\n            \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n          };\n          break;\n\n        case \"Temperature\":\n          return {\n            \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n          };\n          break;\n\n        default:\n          return {\n            \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n          };\n          break;\n      }\n    }\n\n    function viewClick(view) {\n      scope.selectView = view.content.elements;\n    }\n\n    function backTolist(view) {\n      scope.selectView = undefined;\n    }\n\n    function addNewTopo() {\n      loc.path(\"/topology\");\n    }\n\n    function deleteChart(viewId, gatewayId, deviceId) {\n      deleteViews([viewId]).then(function success(event) {\n        unregisterDevice(gatewayId, deviceId).then(function success(event) {\n          getviews.then(function success(event) {\n            var result = [];\n\n            for (var i in event.data) {\n              if (event.data[i].viewType == \"topology\") {\n                result.push(event.data[i]);\n              }\n            }\n\n            scope.viewList = result;\n          }, function error(error) {\n            console.log(error);\n          });\n        });\n      }, function error(error) {\n        console.log(error);\n      });\n    }\n  }]);\n  module.controller(\"mainController\", [\"$scope\", \"userLoginUIService\", \"$rootScope\", \"$timeout\", \"$location\", \"kpiDataService\", \"getSimpleDistricts\", \"$window\", \"$q\", \"$route\", \"resourceUIService\", \"viewFlexService\", 'solutionUIService', 'serviceCenterService', function (scope, userLoginUIService, rootScope, timeout, loc, kpiDataService, getSimpleDistricts, window, q, route, resourceUIService, viewFlexService, solutionUIService, serviceCenterService) {\n    var deferred, promise, localSearch, currentView, solutionId, id, flag; //viewFlexService.deleteViews([10125]);\n\n    rootScope.loading = false;\n    rootScope.step = 0;\n    scope.saveloading = false;\n    scope.userInfo = userLoginUIService.user;\n    deferred = q.defer();\n    promise = deferred.promise;\n\n    require([\"baiduMap\"], function (Bmap) {\n      Bmap(function (event) {\n        if (event != 'error') {\n          deferred.resolve(event);\n        } else {\n          deferred.reject(event);\n        }\n      });\n    });\n\n    scope.editResource = function (model) {\n      serviceCenterService.resources.getBymodelId(model.id).then(function (data) {\n        console.log(data);\n      });\n    };\n\n    resourceUIService.getAllGateways(function (event) {\n      var first = [{\n        id: '',\n        name: '所有网关'\n      }];\n      var remap = event.data.map(function (element) {\n        return {\n          id: element.id,\n          name: element.name\n        };\n      });\n      scope.gateways = first.concat(remap);\n      scope.gatewayId = '';\n      console.log(scope.gateways);\n    });\n\n    function $modelGroup() {\n      var cur = this,\n          deferred = q.defer(),\n          resource = arguments[0];\n\n      if (!cur.attributesDes) {\n        resourceUIService.getAttrsByModelId(cur.id, function (event) {\n          try {\n            if (event.code == 0) {\n              cur.attributesDes = event.data;\n              Object.defineProperty(cur, \"attributesDes\", {\n                enumerable: false\n              });\n              Object.defineProperty(cur, \"id\", {\n                enumerable: false\n              });\n\n              if (resource) {\n                for (var i in cur.attributesDes) {\n                  (function (name, attribute) {\n                    attribute.value = resource ? resource[name] : '';\n\n                    if (name == 'standardAddress') {\n                      var arr = resource ? resource[name].split(\",\") : [],\n                          province,\n                          city,\n                          district;\n\n                      if (arr[0]) {\n                        province = scope.$Address.all.find(function (element) {\n                          return element.label == arr[0];\n                        });\n                      }\n\n                      if (arr[1]) {\n                        city = province.children.find(function (element) {\n                          return element.label == arr[1];\n                        });\n\n                        if (!city) {\n                          city = province.children[0];\n                        }\n                      }\n\n                      if (arr[2]) {\n                        district = city.children.find(function (element) {\n                          return element.label == arr[2];\n                        });\n\n                        if (!district) {\n                          district = city.children[0];\n                        }\n                      }\n\n                      scope.$Address.setPosition(province, city, district);\n                    } else if (name == 'productionDate') {\n                      if (resource) {\n                        if (typeof resource[name] == 'string') {\n                          attribute.value = resource ? resource[name].split(\"T\")[0] : '';\n                        }\n                      }\n                    }\n                  })(cur.attributesDes[i].name, cur.attributesDes[i]);\n                }\n              }\n\n              deferred.resolve(cur);\n            } else {\n              throw event.message;\n            }\n          } catch (err) {\n            deferred.reject(err);\n          }\n        });\n      }\n\n      return deferred.promise;\n    }\n\n    ;\n\n    scope.openResourceSelect = function (receive) {\n      var modelId = receive.model.id;\n      var model = scope.models.find(function (element) {\n        return element.id == modelId;\n      });\n      scope.resourceSelect = model.resourcesArray.filter(function (element) {\n        var findshow = element.kpiArray.some(function (kpi) {\n          return kpi.show == true;\n        });\n        return findshow;\n      });\n\n      scope.selectResource = function (resource) {\n        receive.resource = resource;\n        var kpi = resource.kpiArray.find(function (element) {\n          return receive.kpi.id == element.id;\n        });\n\n        if (_typeof(kpi) == 'object' && kpi != null) {\n          kpi.show = false;\n        }\n\n        delete scope.resourceSelect;\n        delete scope.selectResource;\n      };\n    };\n\n    scope.resourceClose = function () {\n      delete scope.selectResource;\n      delete scope.resourceSelect;\n    };\n\n    scope.$Address = {\n      setPosition: function setPosition(province, city, district) {\n        var cur = this;\n\n        if (province) {\n          cur.province = province;\n\n          if (city) {\n            cur.city = city;\n\n            if (district) {\n              cur.district = district;\n            } else {\n              cur.district = cur.city.children[0];\n            }\n          } else {\n            cur.city = province.children[0];\n            cur.district = cur.city.children[0];\n          }\n        }\n\n        if (cur.onChange) {\n          cur.onChange(cur.province, cur.city, cur.district);\n        }\n      },\n      changeProvince: function changeProvince(province) {\n        var cur = this;\n        cur.city = province.children[0];\n        cur.district = cur.city.children[0];\n\n        if (cur.onChange) {\n          cur.onChange(cur.province, cur.city, cur.district);\n        }\n      },\n      changeCity: function changeCity(city) {\n        var cur = this;\n        cur.district = city.children[0];\n\n        if (cur.onChange) {\n          cur.onChange(cur.province, cur.city, cur.district);\n        }\n      },\n      changeDistrict: function changeDistrict(district) {\n        var cur = this;\n\n        if (cur.onChange) {\n          cur.onChange(cur.province, cur.city, cur.district);\n        }\n      },\n      onChange: function onChange(province, city, district) {\n        if (scope.equipment.modelGroup.attributesDes) {\n          var find = scope.equipment.modelGroup.attributesDes.find(function (element) {\n            return element.name == 'standardAddress';\n          });\n          var lat = scope.equipment.modelGroup.attributesDes.find(function (element) {\n            return element.name == 'latitude';\n          });\n          var lng = scope.equipment.modelGroup.attributesDes.find(function (element) {\n            return element.name == 'longitude';\n          });\n\n          if (find) {\n            find.value = province.label + \",\" + city.label + \",\" + district.label;\n            var keyword = province.label + \" \" + city.label + \" \" + district.label;\n            promise.then(function success(event) {\n              localSearch = event;\n              scope.getLocation = \"获取地址中...\";\n              localSearch.search(keyword);\n              localSearch.setSearchCompleteCallback(function (searchResult) {\n                scope.$apply(finishApply);\n\n                function finishApply() {\n                  scope.getLocation = undefined;\n\n                  if (searchResult.wr[0]) {\n                    var lat = searchResult.wr[0].point.lat;\n                    var lng = searchResult.wr[0].point.lng;\n                    var latitude = scope.equipment.modelGroup.attributesDes.find(function (element) {\n                      return element.name == 'latitude';\n                    });\n                    latitude.value = lat;\n                    var longitude = scope.equipment.modelGroup.attributesDes.find(function (element) {\n                      return element.name == 'longitude';\n                    });\n                    longitude.value = lng;\n                  }\n\n                  ;\n                }\n              });\n            }, function error(error) {\n              scope.getLocation = \"N/A\";\n            });\n          }\n        }\n      }\n    };\n    var $models = {\n      getAll: function getAll() {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.cached) {\n          deferred.resolve(cur.cached);\n        } else {\n          resourceUIService.getModels(function (event) {\n            if (event.code == '0') {\n              cur.cached = event.data;\n              deferred.resolve(event.data);\n            } else {\n              deferred.reject(event.message);\n            }\n          });\n        }\n\n        return deferred.promise;\n      }\n    };\n    var $DeviceGroupModels = {\n      get: function get() {\n        var cur = this,\n            deferred = q.defer();\n\n        if (cur.cached) {\n          deferred.resolve(cached);\n        } else {\n          resourceUIService.getDeviceGroupModels(function (event) {\n            try {\n              if (event.code == 0) {\n                cur.cached = event.data;\n                /* Group Model Defination */\n\n                deferred.resolve(event.data);\n              } else {\n                throw event.message;\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          });\n        }\n\n        return deferred.promise;\n      }\n    };\n\n    require(['commonlib'], function (lib) {\n      //scope.userInfo = userInfo.getUserInfo();\n      scope.kpiIcon = kpiIcon;\n      scope.sensorIcon = sensorIcon;\n      scope.prevStep_Btn = prevStep_Btn;\n      scope.renderImage = renderImage;\n      scope.accomplished = accomplished;\n      scope.bgSel_click = bgSel_click;\n      scope.createNewGraph = createNewGraph;\n      scope.renderBgImg = renderBgImg;\n      scope.bgSelect = bgSelect;\n      scope.backgroundImage = '';\n      scope.equipment = Object.create({});\n      scope.backgroundImage = [{\n        id: 1,\n        path: \"images/topo/topo_bg1.png\"\n      }, {\n        id: 2,\n        path: \"images/topo/topo_bg2.jpg\"\n      }, {\n        id: 3,\n        path: \"images/topo/topo_bg3.jpg\"\n      }];\n\n      if (route.current) {\n        run();\n      } else {\n        rootScope.$on(\"locChanges\", function () {\n          run();\n        });\n      }\n\n      function dropDeviceGroup(ui, offset) {\n        var model, resource, kpi;\n        var draggable = $(ui.draggable);\n        var modelId = draggable.attr(\"model\");\n        var kpiId = draggable.attr(\"kpi\");\n        var resourceId = draggable.attr(\"resource\");\n        model = scope.models.find(function (model) {\n          return model.id == modelId;\n        });\n        resource = model.resourcesArray.find(function (resource) {\n          return resource.id == resourceId;\n        });\n        kpi = resource.kpiArray.find(function (kpi) {\n          return kpi.id == kpiId;\n        });\n        kpi.show = false;\n        var object = Object.create({\n          remove: function remove() {\n            var cur = this;\n            cur.kpi.show = true;\n            scope.receivedList = scope.receivedList.filter(function (received) {\n              return received != cur;\n            });\n          }\n        }, {\n          kpiSource: {\n            value: kpi,\n            enumerable: false\n          },\n          title: {\n            value: kpi.label,\n            enumerable: true,\n            writable: true\n          },\n          instance: {\n            value: kpi.label,\n            enumerable: true,\n            writable: true\n          },\n          resource: {\n            value: resource,\n            enumerable: true,\n            writable: true\n          },\n          model: {\n            value: model,\n            enumerable: true\n          },\n          kpi: {\n            value: kpi,\n            enumerable: true\n          },\n          top: {\n            value: ui.offset.top - offset.top,\n            enumerable: true\n          },\n          left: {\n            value: ui.offset.left - offset.left,\n            enumerable: true\n          }\n        });\n\n        if (scope.receivedList) {\n          scope.receivedList.push(object);\n        } else {\n          scope.receivedList = [object];\n        }\n      }\n\n      ;\n\n      function dropDevice(ui, offset) {\n        var model, resource, kpi;\n        var draggable = $(ui.draggable);\n        var modelId = draggable.attr(\"model\");\n        var kpiId = draggable.attr(\"kpi\");\n        var resourceId = draggable.attr(\"resource\");\n        model = scope.models.find(function (model) {\n          return model.id == modelId;\n        });\n        resource = scope.resources.find(function (resource) {\n          return resource.id == resourceId;\n        });\n        kpi = resource.kpiArray.find(function (kpi) {\n          return kpi.id == kpiId;\n        });\n        kpi.show = false;\n        var object = Object.create({\n          remove: function remove() {\n            var cur = this;\n            cur.kpi.show = true;\n            scope.receivedList = scope.receivedList.filter(function (received) {\n              return received != cur;\n            });\n          }\n        }, {\n          kpiSource: {\n            value: kpi,\n            enumerable: false\n          },\n          title: {\n            value: kpi.label,\n            enumerable: true,\n            writable: true\n          },\n          instance: {\n            value: kpi.label,\n            enumerable: true,\n            writable: true\n          },\n          resource: {\n            value: resource,\n            enumerable: true,\n            writable: true\n          },\n          model: {\n            value: model,\n            enumerable: true\n          },\n          kpi: {\n            value: kpi,\n            enumerable: true\n          },\n          top: {\n            value: ui.offset.top - offset.top,\n            enumerable: true\n          },\n          left: {\n            value: ui.offset.left - offset.left,\n            enumerable: true\n          }\n        });\n\n        if (scope.receivedList) {\n          scope.receivedList.push(object);\n        } else {\n          scope.receivedList = [object];\n        }\n      }\n\n      ;\n\n      function rArrList(data) {\n        var cur = this;\n\n        for (var i in data) {\n          cur[i] = data[i];\n        }\n      }\n\n      rArrList.prototype.remove = function () {\n        var cur = this,\n            findKpi;\n        scope.receivedList = scope.receivedList.filter(function (received) {\n          return received != cur;\n        });\n\n        if (cur.resource) {\n          findKpi = cur.resource.kpiArray.find(function (element) {\n            return element.id == cur.kpi.id;\n          });\n          findKpi.show = true;\n        }\n      };\n\n      function dropDeviceGroupModel(ui, offset) {\n        var model, kpi;\n        var draggable = $(ui.draggable);\n        var modelId = draggable.attr(\"model\");\n        var kpiId = draggable.attr(\"kpi\");\n        model = scope.models.find(function (model) {\n          return model.id == modelId;\n        });\n        kpi = model.kpiArrays.find(function (kpi) {\n          return kpi.id == kpiId;\n        });\n        kpi.show = false;\n        var object = new rArrList({\n          kpiSource: kpi,\n          title: kpi.label,\n          instance: kpi.label,\n          model: model,\n          kpi: kpi,\n          top: ui.offset.top - offset.top,\n          left: ui.offset.left - offset.left\n        });\n\n        if (scope.receivedList) {\n          scope.receivedList.push(object);\n        } else {\n          scope.receivedList = [object];\n        }\n      }\n\n      function run() {\n        var params = route.current.params;\n        scope.equipment.DeviceMode = params.mode;\n\n        if (params.mode == \"deviceGroup\") {\n          scope.onDrop = dropDeviceGroup;\n        } else if (params.mode == \"deviceGroupModel\" || params.mode == \"deviceModel\") {\n          scope.onDrop = dropDeviceGroupModel;\n        } else if (params.mode == \"device\") {\n          scope.onDrop = dropDevice;\n        }\n\n        id = parseInt(params.id);\n        solutionId = parseInt(params.solutionId);\n\n        if (scope.equipment.DeviceMode == 'deviceGroupModel' || scope.equipment.DeviceMode == 'deviceModel') {\n          scope.back = backsolution;\n        } else {\n          scope.back = backService;\n        }\n\n        flag = params.flag;\n        viewFlexService.getAllMyViews(function (event) {\n          try {\n            if (event.code == '0') {\n              if (event.data instanceof Array) {\n                currentView = event.data.find(function (element) {\n                  var dt = {};\n\n                  if (element.content != null && element.content != undefined) {\n                    dt = JSON.parse(element.content);\n                  }\n\n                  element.JSON = dt;\n                  if (dt) return id ? id == dt.nodeId : false;\n                });\n              }\n\n              if (currentView) {\n                scope.bgImgId = currentView.JSON ? currentView.JSON.bgImgId : undefined;\n                scope.equipment.label = currentView.JSON.label;\n              }\n\n              getSimpleDistricts.then(function success(event) {\n                if (event.code == 0) {\n                  scope.$Address.all = event.data;\n\n                  if (scope.equipment.DeviceMode == 'device') {\n                    if (currentView) {\n                      scope.saveAndExit = updateAsDevice;\n                      runAsDevice.call(scope, id, currentView.JSON.elements);\n                    } else {\n                      scope.saveAndExit = saveAsDevice;\n                      runAsDevice.call(scope, id);\n                    }\n                  } else if (scope.equipment.DeviceMode == 'deviceModel') {\n                    if (currentView) {\n                      scope.saveAndExit = saveAsDeviceModel;\n                      runAsDeviceModel.call(scope, id, currentView.JSON.elements);\n                    } else {\n                      scope.saveAndExit = saveAsDeviceModel;\n                      runAsDeviceModel.call(scope, id);\n                    }\n                  } else if (scope.equipment.DeviceMode == 'deviceGroup') {\n                    if (currentView) {\n                      scope.saveAndExit = updateAsDeviceGroup;\n                      runAsDeviceGroup.call(scope, id, currentView.JSON.elements);\n                    } else {\n                      scope.saveAndExit = saveAsDeviceGroup;\n                      runAsDeviceGroup.call(scope, id);\n                    }\n                  } else if (scope.equipment.DeviceMode == 'deviceGroupModel') {\n                    if (currentView) {\n                      scope.saveAndExit = saveAsDeviceGroupModel;\n                      runAsDeviceGroupModel.call(scope, id, currentView.JSON.elements);\n                    } else {\n                      scope.saveAndExit = saveAsDeviceGroupModel;\n                      runAsDeviceGroupModel.call(scope, id);\n                    }\n                  }\n                } else {\n                  throw event.message;\n                }\n              }, function error(err) {\n                console.log(err);\n              });\n            } else {\n              throw event.message;\n            }\n          } catch (err) {\n            console.log(err);\n          }\n        });\n      }\n\n      function saveAsDeviceModel() {\n        var data = [];\n\n        if (scope.receivedList instanceof Array) {\n          data = scope.receivedList.map(function (element) {\n            return {\n              instance: element.instance,\n              top: element.top,\n              left: element.left,\n              kpi: {\n                label: element.kpi.label,\n                id: element.kpi.id,\n                icon: element.kpi.icon,\n                nodeId: element.kpi.nodeId\n              },\n              model: {\n                label: element.model.label,\n                id: element.model.id\n              }\n            };\n          });\n        }\n\n        var content = {\n          bgImgId: scope.bgImgId,\n          elements: data\n        };\n        solutionUIService.saveServiceViewContent(solutionId, 0, JSON.stringify(content), callback);\n\n        function callback(event) {\n          console.log(event);\n          window.location.href = \"../app-ac/index.html#/myView\";\n        }\n      }\n\n      ;\n\n      function saveAsDeviceGroupModel() {\n        var data = [];\n\n        if (scope.receivedList instanceof Array) {\n          data = scope.receivedList.map(function (element) {\n            return {\n              instance: element.instance,\n              top: element.top,\n              left: element.left,\n              kpi: {\n                label: element.kpi.label,\n                id: element.kpi.id,\n                icon: element.kpi.icon,\n                nodeId: element.kpi.nodeId\n              },\n              model: {\n                label: element.model.label,\n                id: element.model.id\n              }\n            };\n          });\n        }\n\n        var content = {\n          bgImgId: scope.bgImgId,\n          elements: data\n        };\n        solutionUIService.saveServiceViewContent(solutionId, id, 0, JSON.stringify(content), callback);\n\n        function callback(event) {\n          window.location.href = \"../app-ac/index.html#/myView\";\n        }\n      }\n\n      ;\n\n      function runAsDevice(nodeId, receivedList) {\n        var modelId,\n            temlateView,\n            resources = [];\n        scope.step = 1;\n        scope.receivedList = receivedList ? receivedList : [];\n        scope.receivedList = scope.receivedList.map(function (element) {\n          return new rArrList(element);\n        });\n        getServiceViewMap();\n        getResource();\n\n        if ($.isArray(scope.receivedList)) {\n          if (scope.receivedList.length > 0) {\n            scope.receivedList = receivedList ? receivedList : [];\n            scope.receivedList = scope.receivedList.map(function (element) {\n              return new rArrList(element);\n            });\n            getResource();\n          } else {\n            getServiceViewMap();\n          }\n        } else {\n          getServiceViewMap();\n        }\n\n        function getServiceViewMap() {\n          viewFlexService.getServiceViewMap(function (event) {\n            var content = {};\n\n            if (event.code == \"0\") {\n              temlateView = event.data;\n            }\n          });\n          getResource();\n        }\n\n        function getResource() {\n          resourceUIService.getResourceById(nodeId, function (event) {\n            try {\n              if (event.code == '0') {\n                scope.equipment.device = event.data;\n                resources = [event.data].map(function (element) {\n                  return {\n                    id: element.id,\n                    gatewayId: element.gatewayId,\n                    label: element.label,\n                    show: true\n                  };\n                });\n                modelId = event.data.modelId;\n\n                if (typeof temlateView[modelId] == 'string') {\n                  var objectLike = /\\{.*\\}/;\n                  console.log(temlateView);\n\n                  if (objectLike.test(temlateView[modelId])) {\n                    content = JSON.parse(temlateView[modelId]);\n                  }\n\n                  scope.receivedList = content.elements.map(function (element) {\n                    return new rArrList(element);\n                  });\n                  scope.bgImgId = content.bgImgId;\n                }\n\n                resourceUIService.getModelByIds([modelId], function (returnObj) {\n                  if (returnObj.code == \"0\") {\n                    scope.models = returnObj.data;\n                  }\n                });\n                resourceUIService.getKpisByModelId(modelId, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    resources.forEach(function (res) {\n                      res.fold = true;\n                      res.kpiArray = [];\n                      returnObj.data.forEach(function (kpi) {\n                        var used = scope.receivedList.some(function (userkpi) {\n                          return kpi.id == userkpi.kpi.id;\n                        });\n                        kpi.show = !used;\n                        res.kpiArray.push(kpi);\n                      });\n                    });\n                  }\n\n                  scope.resources = resources;\n\n                  for (var i in scope.receivedList) {\n                    (function (index, element) {\n                      var find = resources.find(function (elem) {\n                        return element.resource.id == elem.id;\n                      });\n\n                      if (find) {\n                        element.resource = find;\n                      }\n\n                      ;\n                    })(i, scope.receivedList[i]);\n                  }\n                });\n              } else {\n                throw event.message;\n              }\n            } catch (err) {\n              console.log(err);\n            }\n          });\n        }\n      }\n\n      function runAsDeviceModel(deviceModelId) {\n        solutionUIService.getServiceViewContent(solutionId, 0, deviceModelId, function (event) {\n          var content = {};\n\n          if (event.code == \"0\") {\n            if (typeof event.data == 'string') {\n              var objectLike = /\\{.*\\}/;\n\n              if (objectLike.test(event.data)) {\n                content = JSON.parse(event.data);\n              }\n            }\n\n            if (content.elements) {\n              scope.receivedList = content.elements.map(function (element) {\n                return new rArrList(element);\n              });\n            }\n\n            scope.bgImgId = content.bgImgId;\n          }\n        });\n        scope.step = 1;\n        resourceUIService.getModelByIds([deviceModelId], callback);\n\n        function callback(event) {\n          try {\n            if (event.code == \"0\") {\n              scope.models = event.data;\n\n              for (var i in scope.models) {\n                (function (index, element) {\n                  element.fold = true;\n                  serviceCenterService.kpis.getBymodelId(element.id).then(function (data) {\n                    element.kpiArrays = data;\n                  });\n                })(i, scope.models[i]);\n              }\n\n              console.log(scope.models);\n            } else {\n              throw event.message;\n            }\n          } catch (err) {\n            console.log(err);\n          }\n        }\n\n        ;\n        /* 2016 - 05 - 31\n         resourceUIService.getModelsByGroupId(deviceGroupModelId, callback);\n         function callback(event){\n         try {\n         if (event.code == '0') {\n         deferred.resolve(event.data)\n         } else {\n         throw event.message;\n         }\n         } catch (err) {\n         console.log(err);\n         }\n         }\n         */\n        //resourceUIService.getAttrsByModelId\n      }\n\n      function runAsDeviceGroupModel(deviceGroupModelId) {\n        /* 2016 - 05 - 31\n        var modelGroup = {\n        \tid : deviceGroupModelId\n        };\n        $modelGroup.call(modelGroup, undefined).then(function success(modelGroup) {\n        \tscope.equipment.modelGroup = modelGroup;\n        \tconsole.log(scope.equipment)\n        });\n        */\n        solutionUIService.getServiceViewContent(solutionId, deviceGroupModelId, 0, function (event) {\n          var content = {};\n\n          if (event.code == \"0\") {\n            if (typeof event.data == 'string') {\n              var objectLike = /\\{.*\\}/;\n\n              if (objectLike.test(event.data)) {\n                content = JSON.parse(event.data);\n              }\n            }\n\n            if (content.elements) {\n              scope.receivedList = content.elements.map(function (element) {\n                return new rArrList(element);\n              });\n            }\n\n            scope.bgImgId = content.bgImgId;\n          }\n        });\n        scope.step = 1;\n        solutionUIService.getModelsByGroupId(solutionId, deviceGroupModelId, callback);\n\n        function callback(event) {\n          try {\n            if (event.code == \"0\") {\n              scope.models = event.data;\n\n              for (var i in scope.models) {\n                (function (index, element) {\n                  element.fold == true;\n\n                  element.unfold = function () {\n                    var cur = this;\n                    var bool = !cur.fold;\n\n                    for (var j in scope.models) {\n                      scope.models[j].fold = false;\n                    }\n\n                    cur.fold = bool;\n                  };\n\n                  serviceCenterService.kpis.getBymodelId(element.id).then(function (data) {\n                    element.kpiArrays = data;\n                  });\n                })(i, scope.models[i]);\n              }\n\n              console.log(scope.models);\n            } else {\n              throw event.message;\n            }\n          } catch (err) {\n            console.log(err);\n          }\n        }\n\n        ;\n        /* 2016 - 05 - 31\n        resourceUIService.getModelsByGroupId(deviceGroupModelId, callback);\n        function callback(event){\n        \ttry {\n        \t\tif (event.code == '0') {\n        \t\t\tdeferred.resolve(event.data)\n        \t\t} else {\n        \t\t\tthrow event.message;\n        \t\t}\n        \t} catch (err) {\n        \t\tconsole.log(err);\n        \t}\n        }\n        */\n        //resourceUIService.getAttrsByModelId\n      }\n\n      function runAsDeviceGroup(deviceGroupId, receivedList) {\n        var deviceGroupModelId;\n        var deferred = q.defer();\n        var promise = deferred.promise;\n        var curRes;\n        scope.receivedList = receivedList ? receivedList : [];\n        scope.receivedList = scope.receivedList.map(function (element) {\n          return new rArrList(element);\n        });\n        var modelIdused;\n\n        if (deviceGroupId) {\n          resourceUIService.getResourceById(deviceGroupId, function (event) {\n            try {\n              if (event.code == '0') {\n                deferred.resolve(event.data);\n              } else {\n                throw event.message;\n              }\n            } catch (err) {\n              deferred.reject(err);\n            }\n          });\n        } else {\n          deferred.resolve(undefined);\n        }\n\n        promise.then(function success(resource) {\n          curRes = resource;\n          $DeviceGroupModels.get().then(function success(data) {\n            for (var i in data) {\n              (function (index, element) {\n                attrsFn.call(element);\n              })(i, data[i]);\n            }\n\n            scope.modelGroups = data;\n\n            if (resource != undefined) {\n              var find = scope.modelGroups.find(function (element) {\n                return element.id == resource.modelId && resource.modelId != undefined;\n              });\n\n              if (find) {\n                scope.equipment.modelGroup = find;\n              } else {\n                scope.equipment.modelGroup = scope.modelGroups[0];\n              }\n\n              scope.equipment.modelGroup.onChange();\n            }\n\n            if (scope.equipment.modelGroup) {\n              $modelGroup.call(scope.equipment.modelGroup, resource ? resource.values : undefined).then(function success(modelGroup) {\n                console.log(modelGroup);\n              });\n            }\n          }, function error(err) {\n            console.log(err);\n          });\n        }, function error(err) {\n          console.log(err);\n        });\n\n        function attrsFn() {\n          var cur = this;\n\n          cur.onChange = function () {\n            $modelGroup.call(scope.equipment.modelGroup);\n            viewFlexService.getServiceViewMap(function (event) {\n              var content = {};\n\n              if (event.code == \"0\") {\n                if (typeof event.data[cur.id] == 'string') {\n                  var objectLike = /\\{.*\\}/;\n                  console.log(event.data[cur.id]);\n\n                  if (objectLike.test(event.data[cur.id])) {\n                    content = JSON.parse(event.data[cur.id]);\n                  }\n\n                  if (!id) {\n                    scope.receivedList = content.elements.map(function (element) {\n                      return new rArrList(element);\n                    });\n                  }\n                  /*\n                  for(var i in receivedList)\n                  {\n                  \tvar modelId = receivedList[i].model.id;\n                  \tvar kpiId = receivedList[i].kpi.id;\n                  \tvar find = scope.receivedList.some(function(elem){\n                  \t\tconsole.log(elem.model.id, modelId, elem.kpi.id, kpiId);\n                  \t\treturn elem.model.id == modelId && elem.kpi.id == kpiId\n                  \t});\n                  \t\tif(!find)\n                  \t{\n                  \t\tscope.receivedList.push(receivedList[i]);\n                  \t}\n                  }\n                  */\n\n\n                  scope.bgImgId = content.bgImgId;\n                }\n              }\n            });\n          };\n        }\n\n        scope.nextStep = function () {\n          var defers = [];\n          scope.step = 1; //viewFlexService.getServiceViewMap(callback);\n\n          if (solutionId != 0) {\n            resourceUIService.getModels(callback);\n          } else {\n            $models.getAll().then(function (data) {\n              callback({\n                code: '0',\n                data: data\n              });\n            });\n          }\n\n          function callback(event) {\n            if (event.data instanceof Array) {\n              scope.models = event.data;\n            } else {\n              scope.models = [];\n            } //---------------if model does not exist, must query the model and fill into the list.----------------------\n            //---------------and remove those devices which cannot be found in the list --------------------------------\n\n\n            var clone = [];\n\n            for (var i in scope.receivedList) {\n              (function (index, ele) {\n                if (_typeof(ele.model) != \"object\" || ele.model == null) {\n                  if (_typeof(ele.resource) == \"object\" && ele.resource != null) {\n                    var resourceId = ele.resource.id;\n                    resourceUIService.getResourceById(resourceId, function (event) {\n                      if (event.code == \"0\") {\n                        var find = scope.models.find(function (element) {\n                          if (event.data != null) {\n                            return element.id == event.data.modelId;\n                          } else {\n                            return false;\n                          }\n                        });\n\n                        if (find) {\n                          ele.model = {\n                            id: find.id,\n                            label: find.label\n                          };\n                        }\n                      }\n                    });\n                  }\n                }\n              })(i, scope.receivedList[i]);\n            } //----------------------------------------------------------------------------------------------------------\n\n\n            if (event.code == \"0\") {\n              for (var i in scope.models) {\n                var defer = q.defer();\n                defers.push(defer.promise);\n\n                (function (index, element, defer) {\n                  var modelId = element.id;\n                  element.fold == false;\n\n                  element.unfold = function () {\n                    var cur = this;\n                    var bool = !cur.fold;\n\n                    for (var j in scope.models) {\n                      scope.models[j].fold = false;\n                    }\n\n                    cur.fold = bool;\n                  };\n\n                  serviceCenterService.resources.getBymodelId(modelId).then(function success(data) {\n                    element.resourcesArray = data.map(function (element) {\n                      return {\n                        id: element.id,\n                        gatewayId: element.gatewayId,\n                        label: element.label,\n                        show: true,\n                        fold: false,\n                        unfold: unfold\n                      };\n                    });\n\n                    function unfold() {\n                      var cur = this;\n                      var bool = !cur.fold;\n\n                      for (var j in element.resourcesArray) {\n                        element.resourcesArray[j].fold = false;\n                      }\n\n                      cur.fold = bool;\n                    }\n\n                    ;\n                    serviceCenterService.kpis.getBymodelId(modelId).then(function success(data) {\n                      //console.log(event);\n                      for (var i in element.resourcesArray) {\n                        (function (index, res) {\n                          res.kpiArray = data.map(function (kpi) {\n                            var result = {},\n                                received;\n                            var received = scope.receivedList.find(function (element) {\n                              if (element.resource) {\n                                return element.resource.id == res.id && element.kpi.id == kpi.id;\n                              } else {\n                                return false;\n                              }\n                            });\n                            result = {\n                              show: received == undefined,\n                              icon: kpi.icon,\n                              nodeId: res.id,\n                              id: kpi.id,\n                              label: kpi.label\n                            };\n                            return result;\n                          });\n                          var findRes = scope.receivedList.filter(function (element) {\n                            if (element.resource) {\n                              //console.log(element.resource.id, \"--\", res.id);\n                              return element.resource.id == res.id;\n                            } else {\n                              return false;\n                            }\n                          });\n\n                          if (findRes) {\n                            for (var j in findRes) {\n                              findRes[j].resource.kpiArray = res.kpiArray;\n                            }\n                          }\n                        })(index, element.resourcesArray[i]);\n                      } //resource.kpis = data;\n                      //Array.prototype.push.apply(resources, resource);\n\n\n                      defer.resolve(\"success\");\n                      /*\n                       resourceUIService.getCanRelatedToGroupDevicesByModelId(modelId, function(event){\n                      \t });\n                       */\n                    }, function error(err) {\n                      console.log(err);\n                    });\n                  }, function error(err) {\n                    console.log(err);\n                  });\n                })(i, scope.models[i], defer);\n              }\n\n              q.all(defers).then(function success(data) {\n                //remove Array from list which is not found in resource list.\n                scope.receivedList = scope.receivedList.filter(function (element) {\n                  var modelId = element.model.id;\n                  var find = scope.models.some(function (element) {\n                    return element.id == modelId;\n                  });\n                  return find;\n                  /*\n                  if(typeof element.resource == 'object' && element.resource != null)\n                  {\n                  \treturn element.resource.kpiArray != undefined;\n                  }\n                  else\n                  {\n                  \treturn false;\n                  }\n                  */\n                }); //scope.resources = resources;\n\n                /*\n                scope.receivedList = scope.receivedList.filter(function(element) {\n                \treturn resources.find(function(el) {\n                \t\treturn el.id == element.resource.id\n                \t});\n                });\n                */\n              }, function error(err) {\n                console.log(err);\n              });\n            }\n          }\n          /*\n          $models.getAll().then(function success(data) {\n          \tvar defers = [];\n          }, function error(err) {\n          \tconsole.log(err);\n          });\n          */\n\n        };\n      }\n      /* 2016 - 05 - 31*/\n\n\n      function saveAsDevice() {\n        var data = scope.receivedList.map(function (element) {\n          return {\n            instance: element.instance,\n            top: element.top,\n            left: element.left,\n            kpi: {\n              label: element.kpi.label,\n              id: element.kpi.id,\n              icon: element.kpi.icon,\n              nodeId: element.kpi.nodeId\n            },\n            resource: {\n              label: element.resource.label,\n              id: element.resource.id\n            }\n          };\n        });\n        var content = {\n          nodeId: scope.resources[0].id,\n          bgImgId: scope.bgImgId,\n          elements: data\n        };\n        var param = {\n          viewTitle: scope.resources[0].label,\n          viewName: \"topology\",\n          viewType: \"topology\",\n          content: JSON.stringify(content)\n        };\n        viewFlexService.addView(param, function (event) {\n          if (event.code == 0) {\n            window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n          }\n        });\n      }\n\n      function updateAsDevice() {\n        var data = scope.receivedList.map(function (element) {\n          return {\n            instance: element.instance,\n            top: element.top,\n            left: element.left,\n            kpi: {\n              label: element.kpi.label,\n              id: element.kpi.id,\n              icon: element.kpi.icon,\n              nodeId: element.kpi.nodeId\n            },\n            resource: {\n              label: element.resource.label,\n              id: element.resource.id\n            }\n          };\n        });\n        var content = {\n          nodeId: currentView.JSON.nodeId,\n          bgImgId: scope.bgImgId,\n          elements: data\n        };\n        var param = {\n          viewId: currentView.viewId,\n          originalViewId: 0,\n          viewTitle: scope.resources[0].label,\n          viewName: \"topology\",\n          viewType: \"topology\",\n          content: JSON.stringify(content)\n        };\n        viewFlexService.updateView(param, function (event) {\n          if (event.code == 0) {\n            window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n          }\n        });\n      }\n\n      function saveAsDeviceGroup() {\n        hasEmpty = scope.receivedList.some(function (element) {\n          return element.resource != undefined && element.resource != null;\n        });\n\n        if (hasEmpty) {\n          scope.msg = {\n            title: \"有未绑定数据标签\",\n            content: \"有标签未绑定数据，保存之后这些标签将被删除，是否继续？\",\n            btnlist: [{\n              text: \"取消\",\n              fn: cancelDataFn\n            }, {\n              text: \"继续\",\n              fn: saveDataFn\n            }]\n          };\n        } else {\n          saveDataFn();\n        }\n\n        function cancelDataFn() {\n          scope.msg = undefined;\n        }\n\n        function saveDataFn() {\n          var deviceGroup = {};\n          scope.equipment.modelGroup.attributesDes;\n\n          for (var i in scope.equipment.modelGroup.attributesDes) {\n            (function (index, element) {\n              var attrName = element.name;\n\n              if (scope.equipment.modelGroup.values == undefined) {\n                scope.equipment.modelGroup.values = {};\n              }\n\n              scope.equipment.modelGroup.values[attrName] = element.value;\n            })(i, scope.equipment.modelGroup.attributesDes[i]);\n          }\n\n          scope.equipment.modelGroup.modelId = scope.equipment.modelGroup.id;\n\n          for (var j in scope.equipment.modelGroup) {\n            (function (attr, val) {\n              deviceGroup[attr] = val;\n            })(j, scope.equipment.modelGroup[j]);\n          }\n\n          ;\n          scope.receivedList = scope.receivedList.filter(function (element) {\n            return element.resource != undefined && element.resource != null;\n          });\n          var data = scope.receivedList.map(function (element) {\n            return {\n              title: element.title,\n              instance: element.instance,\n              top: element.top,\n              left: element.left,\n              model: {\n                label: element.model.label,\n                id: element.model.id\n              },\n              kpi: {\n                label: element.kpi.label,\n                id: element.kpi.id,\n                icon: element.kpi.icon,\n                nodeId: element.kpi.nodeId\n              },\n              resource: {\n                label: element.resource.label,\n                id: element.resource.id\n              }\n            };\n          });\n          console.log(data);\n          resourceUIService.saveDeviceGroup(deviceGroup, function (event) {\n            console.log(event);\n\n            try {\n              if (event.code == '0') {\n                var deviceGroupId = event.data.id;\n                deviceToGroup = scope.receivedList.map(function (element) {\n                  return {\n                    label: element.label,\n                    deviceGroupId: deviceGroupId,\n                    deviceId: element.resource.id,\n                    kpiId: element.kpi.id\n                  };\n                });\n                resourceUIService.saveDeviceToGroups(deviceGroupId, deviceToGroup, function (event) {\n                  try {\n                    if (event.code == '0') {\n                      var content = {\n                        label: scope.equipment.label,\n                        nodeId: deviceGroupId,\n                        bgImgId: scope.bgImgId,\n                        elements: data\n                      };\n                      var param = {\n                        viewTitle: \"topology\",\n                        viewName: \"topology\",\n                        viewType: \"topology\",\n                        content: JSON.stringify(content)\n                      };\n                      viewFlexService.addView(param, function (event) {\n                        if (event.code == 0) {\n                          window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n                        } else {\n                          throw event.message;\n                        }\n                      });\n                    } else {\n                      throw event.message;\n                    }\n                  } catch (err) {\n                    console.log(err);\n                  }\n                });\n              } else {\n                throw event.message;\n              }\n            } catch (err) {\n              console.log(err);\n            }\n          });\n        }\n      }\n\n      function updateAsDeviceGroup() {\n        var deviceGroup = {};\n        scope.equipment.modelGroup.attributesDes;\n\n        for (var i in scope.equipment.modelGroup.attributesDes) {\n          (function (index, element) {\n            var attrName = element.name;\n\n            if (scope.equipment.modelGroup.values == undefined) {\n              scope.equipment.modelGroup.values = {};\n            }\n\n            scope.equipment.modelGroup.values[attrName] = element.value;\n          })(i, scope.equipment.modelGroup.attributesDes[i]);\n        }\n\n        scope.equipment.modelGroup.modelId = scope.equipment.modelGroup.id;\n\n        for (var j in scope.equipment.modelGroup) {\n          (function (attr, val) {\n            deviceGroup[attr] = val;\n          })(j, scope.equipment.modelGroup[j]);\n        }\n\n        ;\n        deviceGroup.id = parseInt(id);\n        var data = scope.receivedList.map(function (element) {\n          var result = {\n            instance: element.instance,\n            top: element.top,\n            left: element.left,\n            kpi: {\n              label: element.kpi.label,\n              id: element.kpi.id,\n              icon: element.kpi.icon,\n              nodeId: element.kpi.nodeId\n            },\n            resource: {\n              label: element.resource.label,\n              id: element.resource.id\n            }\n          };\n\n          if (element.model) {\n            result.model = {\n              label: element.model.label,\n              id: element.model.id\n            };\n          } else {}\n\n          return result;\n        });\n        resourceUIService.saveDeviceGroup(deviceGroup, function (event) {\n          try {\n            if (event.code == '0') {\n              var deviceGroupId = event.data.id;\n              deviceToGroup = scope.receivedList.map(function (element) {\n                return {\n                  label: element.label,\n                  deviceGroupId: deviceGroupId,\n                  deviceId: element.resource.id,\n                  kpiId: element.kpi.id\n                };\n              });\n              resourceUIService.saveDeviceToGroups(deviceGroupId, deviceToGroup, function (event) {\n                try {\n                  if (event.code == '0') {\n                    var content = {\n                      label: scope.equipment.label,\n                      nodeId: deviceGroupId,\n                      bgImgId: scope.bgImgId,\n                      elements: data\n                    };\n                    var param = {\n                      viewId: currentView.viewId,\n                      originalViewId: 0,\n                      viewTitle: \"topology\",\n                      viewName: \"topology\",\n                      viewType: \"topology\",\n                      content: JSON.stringify(content)\n                    };\n                    viewFlexService.updateView(param, function (event) {\n                      if (event.code == 0) {\n                        window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n                      } else {\n                        throw event.message;\n                      }\n                    });\n                  } else {\n                    throw event.message;\n                  }\n                } catch (err) {\n                  console.log(err);\n                }\n              });\n            } else {\n              throw event.message;\n            }\n          } catch (err) {\n            console.log(err);\n          }\n        });\n      }\n\n      function bgSelect(path) {\n        var css = {\n          \"background-image\": \"url(../\" + path + \")\"\n        };\n        return css;\n      }\n\n      ;\n\n      function renderBgImg(path) {\n        return path ? {\n          \"background-image\": \"url(../\" + path + \")\"\n        } : {};\n      }\n\n      function kpiIcon(channelType) {\n        switch (channelType) {\n          case \"temperature\":\n            return {\n              \"background-image\": \"url(images/elementIcon/are_temp.svg)\"\n            };\n            break;\n\n          case \"humidity\":\n            return {\n              \"background-image\": \"url(images/elementIcon/area_humid.svg)\"\n            };\n            break;\n\n          default:\n            return {\n              \"background-image\": \"url(images/elementIcon/are_temp.svg)\"\n            };\n            break;\n        }\n      }\n\n      function sensorIcon(channelType) {\n        switch (channelType) {\n          case \"temperature\":\n            return {\n              \"background-image\": \"url(images/elementIcon/are_temp.svg)\"\n            };\n            break;\n\n          case \"humidity\":\n            return {\n              \"background-image\": \"url(images/elementIcon/area_humid.svg)\"\n            };\n            break;\n\n          default:\n            return {\n              \"background-image\": \"url(images/elementIcon/are_temp.svg)\"\n            };\n            break;\n        }\n      }\n\n      function renderImage(id, kpis) {\n        var unit;\n\n        for (var i in kpis) {\n          if (id == kpis[i].id) {\n            unit = kpis[i].unit;\n          }\n        }\n\n        switch (unit) {\n          case \"Amount\":\n            return {\n              \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n            };\n            break;\n\n          case \"Temperature\":\n            return {\n              \"background-image\": \"url(images/elementIcon/agriculture.svg)\"\n            };\n            break;\n\n          default:\n            return {};\n            break;\n        }\n      }\n\n      function createNewGraph() {\n        window.location.reload();\n      }\n\n      function backService() {\n        window.location.href = \"../app-sc/index_consumer.html#/nongye\";\n      }\n\n      function backsolution() {\n        window.location.href = \"../app-ac/index.html#/myView\";\n      }\n\n      function accomplished() {\n        window.open(\"../../app/index_consumer.html#/dashboard3\", \"_self\");\n      }\n\n      function prevStep_Btn() {\n        scope.step = 0;\n      }\n\n      function bgSel_click(obj) {\n        scope.bgImgId = obj.path;\n      }\n\n      function randomString(len) {\n        len = len || 32;\n        var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';\n        var maxPos = $chars.length;\n        var pwd = '';\n\n        for (i = 0; i < len; i++) {\n          pwd += $chars.charAt(Math.floor(Math.random() * maxPos));\n        }\n\n        return pwd;\n      }\n    });\n  }]);\n});"],"sourceRoot":"/source/"}