{"version":3,"sources":["toolkit/single-select.js"],"names":["define","init","dom","format","options","_dom_","_format_","_option_","events","button","$","css","addClass","text","ul","caret","searchWrap","input","submitWrap","closeBtn","append","SelectSingle","label","value","position","on","event","stopPropagation","this","setOption","prototype","eventName","callback","setValue","val","find","elem","target","removeClass","toggle","hasClass","documentClick","search","off","documentKeydown","keyCode","keyDownSearch","timeout","key","i","item","indexOf","children","remove","liDom","index","li","cursor","a","Object","defineProperty","enumerable","document"],"mappings":"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","file":"toolkit/single-select.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return {\n    init: function init(dom, format, options) {\n      var _dom_,\n          _format_,\n          _option_,\n          events = {};\n\n      var button = $(\"<button></button>\").css(\"width\", \"100%\").addClass(\"btn btn-default dropdown-toggle\");\n      button.text(\"请选择一项内容\");\n      var ul = $(\"<ul></ul>\").addClass(\"dropdown-menu\").css(\"width\", \"100%\");\n      var caret = $(\"<span></span>\").addClass(\"caret\");\n      var searchWrap = $(\"<div></div>\").addClass(\"input-group\");\n      var input = $(\"<input />\").addClass(\"form-control\");\n      var submitWrap = $(\"<span></span>\").addClass(\"input-group-btn\");\n      var a = 0;\n      var closeBtn = $(\"<button></button>\").addClass(\"btn btn-default\").append($(\"<span></span>\").addClass(\"glyphicon glyphicon-remove\"));\n\n      var SelectSingle = function SelectSingle(dom, format, options) {\n        var cur = this;\n        _format_ = format || {\n          label: \"label\",\n          value: \"value\"\n        };\n        _dom_ = dom;\n        _option_ = options;\n        searchWrap.append(input);\n        searchWrap.append(submitWrap);\n        submitWrap.append(closeBtn);\n        button.append();\n        $(_dom_).css({\n          \"position\": \"relative\"\n        });\n        ul.on(\"click\", function (event) {\n          event.stopPropagation();\n        });\n        $(_dom_).append(button);\n        $(_dom_).append(ul);\n\n        if (_option_) {\n          cur.setOption(_option_);\n        }\n      };\n\n      SelectSingle.prototype.on = function (eventName, callback) {\n        events[eventName] = callback;\n      };\n\n      SelectSingle.prototype.setValue = function (val) {\n        button.append(caret);\n        var find = _option_.find(function (elem) {\n          elem.target.removeClass(\"active\");\n          return elem[_format_.value] == val;\n        }) || {};\n\n        if (find.target) {\n          find.target.addClass(\"active\");\n          button.text(find[_format_.label]);\n        }\n      };\n\n      SelectSingle.prototype.setOption = function (options) {\n        _option_ = options;\n\n        var toggle = function toggle() {\n          if ($(_dom_).hasClass(\"open\")) {\n            $(_dom_).removeClass(\"open\");\n          } else {\n            $(_dom_).addClass(\"open\");\n          }\n        };\n\n        var documentClick = function documentClick(event) {\n          input.val(\"\");\n          search(\"\");\n          toggle();\n          $(\"body\").off(\"click.toggle\");\n          $(\"body\").off(\"keydown.toggle\");\n        };\n\n        var documentKeydown = function documentKeydown(event) {\n          if (event.keyCode == 13) {\n            var label = input.val();\n            search(label);\n          }\n\n          ;\n        };\n\n        var onClick = function onClick(event) {\n          event.stopPropagation();\n          $(\"body\").on(\"click.toggle\", documentClick);\n          $(\"body\").on(\"keydown.toggle\", documentKeydown); // 初始化下拉按钮\n\n          $('.ng-pristine.ng-untouched.ng-valid.ng-scope.ng-isolate-scope.ng-not-empty').removeClass('open');\n          toggle();\n        };\n\n        var keyDownSearch = function keyDownSearch() {\n          event.stopPropagation();\n          timeout(function () {\n            var label = input.val();\n            search(label);\n          });\n        };\n\n        var search = function search(key) {\n          for (var i in options) {\n            (function (item) {\n              var condition1 = item.label.indexOf(key) != -1;\n              var txt;\n\n              if (typeof format.label == \"function\") {\n                txt = format.label(item);\n              } else {\n                txt = item[format.label];\n              }\n\n              ;\n\n              if (txt.indexOf(key) != -1) {\n                $(item.target).css(\"display\", \"block\");\n              } else {\n                $(item.target).css(\"display\", \"none\");\n              }\n            })(options[i]);\n          }\n        };\n\n        ul.children().remove();\n\n        var liDom = function liDom(index, elem) {\n          var li = $(\"<li></li>\").css({\n            cursor: \"pointer\"\n          });\n          var a = $(\"<a></a>\");\n\n          if (typeof format.label == \"function\") {\n            a.text(format.label(elem));\n          } else {\n            a.text(elem[format.label]);\n          }\n\n          var onClick = function onClick(event) {\n            event.stopPropagation();\n            $(\"body\").off(\"click.toggle\");\n            $(\"body\").off(\"keydown.toggle\");\n            input.val(\"\");\n            search(\"\");\n            ul.find(\"li.active\").removeClass(\"active\");\n            li.addClass(\"active\");\n\n            if (typeof format.label == \"function\") {\n              button.text(format.label(elem));\n            } else {\n              button.text(elem[format.label]);\n            }\n\n            ;\n            toggle();\n            button.append(caret);\n\n            if (events['click']) {\n              events['click'](elem[format.value]);\n            }\n\n            ;\n          };\n\n          li.on(\"click\", onClick);\n          li.append(a);\n          elem.target = li;\n          Object.defineProperty(elem, \"target\", {\n            enumerable: false\n          });\n          return li;\n        };\n\n        var li = $(\"<li></li>\").css(\"padding\", \"2px 10px\");\n        ul.append($(\"<li></li>\").addClass(\"divider\"));\n        ul.append(li.append(searchWrap));\n        ul.append($(\"<li></li>\").addClass(\"divider\"));\n        button.off(\"click\");\n        button.on(\"click\", onClick);\n        closeBtn.on(\"click\", function () {\n          event.stopPropagation();\n          input.val(\"\");\n          search(\"\");\n        });\n        input.off(\"focus\");\n        input.on(\"focus\", function () {\n          event.stopPropagation();\n          $(document).on(\"keydown.search\", keyDownSearch);\n        });\n        input.on(\"blur\", function () {\n          event.stopPropagation();\n          $(document).off(\"keydown.search\");\n        });\n\n        for (var i in _option_) {\n          ul.append(liDom(i, _option_[i]));\n        }\n      };\n\n      return new SelectSingle(dom, format, options);\n    }\n  };\n});"],"sourceRoot":"/source/"}