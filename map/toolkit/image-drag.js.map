{"version":3,"sources":["toolkit/image-drag.js"],"names":["define","init","dom","events","fl","btnGroup","$","canvas","instruction","input","span","button","pv","uploadImage","fn","cur","this","children","remove","css","addClass","append","text","prop","imageprev","height","on","event","readFile","file","removeAttr","FileReader","type","indexOf","reader","onload","evt","target","result","readAsDataURL","files","addEventListener","preventDefault","stopPropagation","dataTransfer","length","arguments","fun","val","eval","prototype","eventName","callback","reset"],"mappings":"AAGAA,OAAO,GAAI,WACT,MAAO,CACLC,KAAM,SAASA,KAAKC,KAClB,IAAIC,OAAS,GACTC,GACAC,SAAWC,EAAE,eACbC,OAASD,EAAE,qBACXE,YAAcF,EAAE,eAChBG,MAAQH,EAAE,4CACVI,KAAOJ,EAAE,iBACTK,OAASL,EAAE,qBACXM,GAAKN,EAAE,eAEPO,YAAc,SAASA,YAAYX,KACrCI,EAAEQ,GAAGD,YAAc,WACjB,IAAIE,IAAMC,KAENf,KAAO,WACTc,IAAIE,WAAWC,SACfH,IAAII,IAAI,UAAW,QAEnBZ,OAAOY,IAAI,QAAS,QACpBZ,OAAOY,IAAI,SAAU,QACrBd,SAASe,SAAS,eAClBV,KAAKW,OAAOV,QACZD,KAAKU,SAAS,mBACdT,OAAOS,SAAS,mBAChBT,OAAOW,KAAK,MACZX,OAAOY,KAAK,WAAY,YACxBlB,SAASgB,OAAOZ,OAChBJ,SAASgB,OAAOX,MAChBF,YAAYW,IAAI,QAAS,QACzBX,YAAYW,IAAI,iBAAkB,QAClCX,YAAYW,IAAI,WAAY,YAC5BX,YAAYW,IAAI,QAAS,qBACzBX,YAAYW,IAAI,OAAQ,OACxBX,YAAYW,IAAI,MAAO,OACvBX,YAAYW,IAAI,SAAU,mBAC1BX,YAAYW,IAAI,aAAc,UAC9BP,GAAGY,YACHhB,YAAYW,IAAI,cAAeP,GAAGa,SAAW,GAAK,MAClDb,GAAGO,IAAI,mBAAoB,QAC3BP,GAAGS,OAAOb,aACVI,GAAGS,OAAOd,QACVC,YAAYc,KAAK,cACjBP,IAAIM,OAAOhB,UAAUgB,OAAOT,IAC5BD,OAAOe,GAAG,QAAS,SAAUC,GAC3BxB,OAAO,OAAUC,MAGnB,IAAIwB,EAAW,SAAkBC,GAK/B,GAJAzB,GAAKyB,EACLrB,YAAYW,IAAI,UAAW,QAC3BR,OAAOmB,WAAW,YAEQ,oBAAfC,aAA6D,GAA/BF,EAAKG,KAAKC,QAAQ,SAAgB,CACzE,IAAIC,EAAS,IAAIH,WAEjBG,EAAOC,OAAS,SAAUC,GACxBxB,GAAGY,UAAU,SAAU,YAAaY,EAAIC,OAAOC,QAC/ChC,EAAE,SAASa,IAAI,UAAW,QAC1Bb,EAAE,cAAca,IAAI,UAAW,QAC/BhB,OAAO,OAAU0B,IAGnBK,EAAOK,cAAcV,KAIzBpB,MAAMiB,GAAG,SAAU,SAAUC,GAC3B,IAAIE,EAAOpB,MAAM,GAAG+B,MAAM,GAC1BZ,EAASC,KAEXtB,OAAO,GAAGkC,iBAAiB,WAAY,SAAUL,GAC/CA,EAAIM,mBACH,GACHnC,OAAO,GAAGkC,iBAAiB,OAAQ,SAAUL,GAC3CA,EAAIM,iBACJN,EAAIO,kBACJ,IAAIH,EAAQJ,EAAIQ,aAAaJ,MAE7B,GAAmB,EAAfA,EAAMK,OAAY,CACpB,IAAIhB,EAAOW,EAAM,GACjB/B,MAAM,GAAG+B,MAAQA,EACjBZ,EAASC,MAEV,IAGL,GAAwB,GAApBiB,UAAUD,OACZ5C,YACK,GAAwB,GAApB6C,UAAUD,QACC,UAAhBC,UAAU,GAAgB,CAC5B,IAAIC,IAAMD,UAAU,GAChBE,IAAMF,UAAU,GACpBG,KAAKF,IAAM,KAAQC,IAAM,QAK/B1C,EAAEJ,KAAKW,eAcT,OAXAA,YAAYqC,UAAUxB,GAAK,SAAUyB,EAAWC,GAC9CjD,OAAOgD,GAAaC,GAGtBvC,YAAYqC,UAAUG,MAAQ,WAC5BjD,GAAK,KACLQ,GAAGY,UAAU,SAAU,SACvBhB,YAAYW,IAAI,UAAW,SAC3BV,MAAMuC,IAAI,OAGL,IAAInC,YAAYX","file":"toolkit/image-drag.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return {\n    init: function init(dom) {\n      var events = {};\n      var fl;\n      var btnGroup = $(\"<div></div>\");\n      var canvas = $(\"<canvas></canvas>\");\n      var instruction = $(\"<div></div>\");\n      var input = $('<input class=\"form-control\" type=\"file\">');\n      var span = $(\"<span></span>\");\n      var button = $(\"<button></button>\");\n      var pv = $(\"<div></div>\");\n\n      var uploadImage = function uploadImage(dom) {\n        $.fn.uploadImage = function () {\n          var cur = this;\n\n          var init = function init() {\n            cur.children().remove();\n            cur.css(\"display\", \"none\"); //cur.css(\"border\", \"1px solid #666\");\n\n            canvas.css(\"width\", \"100%\");\n            canvas.css(\"height\", \"100%\");\n            btnGroup.addClass(\"input-group\");\n            span.append(button);\n            span.addClass(\"input-group-btn\");\n            button.addClass(\"btn btn-primary\");\n            button.text(\"上传\");\n            button.prop(\"disabled\", \"disabled\");\n            btnGroup.append(input);\n            btnGroup.append(span);\n            instruction.css(\"color\", \"#fff\");\n            instruction.css(\"pointer-events\", \"none\");\n            instruction.css(\"position\", \"absolute\");\n            instruction.css(\"width\", \"calc(100% - 10px)\");\n            instruction.css(\"left\", \"5px\");\n            instruction.css(\"top\", \"5px\");\n            instruction.css(\"border\", \"1px dashed #fff\");\n            instruction.css(\"text-align\", \"center\");\n            pv.imageprev();\n            instruction.css(\"line-height\", pv.height() - 15 + \"px\");\n            pv.css(\"background-color\", \"#999\");\n            pv.append(instruction);\n            pv.append(canvas);\n            instruction.text(\"可拖拽一个图片至此。\");\n            cur.append(btnGroup).append(pv);\n            button.on(\"click\", function (event) {\n              events['submit'](fl);\n            });\n\n            var readFile = function readFile(file) {\n              fl = file;\n              instruction.css(\"display\", \"none\");\n              button.removeAttr(\"disabled\");\n\n              if (typeof FileReader !== \"undefined\" && file.type.indexOf(\"image\") != -1) {\n                var reader = new FileReader();\n\n                reader.onload = function (evt) {\n                  pv.imageprev(\"option\", \"changeSrc\", evt.target.result);\n                  $(\".tips\").css(\"display\", \"none\");\n                  $(\".uploadBtn\").css(\"display\", \"none\");\n                  events['change'](file);\n                };\n\n                reader.readAsDataURL(file);\n              }\n            };\n\n            input.on(\"change\", function (event) {\n              var file = input[0].files[0];\n              readFile(file);\n            });\n            canvas[0].addEventListener(\"dragover\", function (evt) {\n              evt.preventDefault();\n            }, false);\n            canvas[0].addEventListener(\"drop\", function (evt) {\n              evt.preventDefault();\n              evt.stopPropagation();\n              var files = evt.dataTransfer.files;\n\n              if (files.length > 0) {\n                var file = files[0];\n                input[0].files = files;\n                readFile(file);\n              }\n            }, false);\n          };\n\n          if (arguments.length == 0) {\n            init();\n          } else if (arguments.length == 3) {\n            if (arguments[0] == \"option\") {\n              var fun = arguments[1];\n              var val = arguments[2];\n              eval(fun + \"(\\\"\" + val + \"\\\")\");\n            }\n          }\n        };\n\n        $(dom).uploadImage();\n      };\n\n      uploadImage.prototype.on = function (eventName, callback) {\n        events[eventName] = callback;\n      };\n\n      uploadImage.prototype.reset = function () {\n        fl = null;\n        pv.imageprev(\"option\", \"clear\");\n        instruction.css(\"display\", \"block\");\n        input.val(null);\n      };\n\n      return new uploadImage(dom);\n    }\n  };\n});"],"sourceRoot":"/source/"}