{"version":3,"sources":["toolkit/component/totalItem.js"],"names":["define","data","kpiQueryModel","element","location","buttonEnabled","resourceUIService","global","window","serviceCenterService","innerContent","$","units","previewMode","$controller","route","current","$$route","controller","expression","resource_applied","kpi_applied","Object","defineProperty","enumerable","$$","runExpression","$attr","funRes","code","fnResult","clickFn","setResource","resources","renderItem","item","inner","addClass","title","text","undefined","value","css","parameters","fontcolor","unit","number","subtitle","name","icon","i","perfix","append","fontColor","bgcolor","on","evt","e","setTitle","target","setSubtitle","subtext","setUnit","setSeries","series","setParameters","rs","dtype","applied","Error","message","run","getCiKpi_back","ci","kpi","checkNoEmptyArray","arr","Array","length","baseOption","getValueList","inrun","failure","category","isRealTimeData","nodeIds","map","elem","id","kpiCodes","timeRange","statisticType","includeInstance","condList","getAll","then","condi","condition","eval","method","type","getValueListBytime","getCiKpi","render","initFn","defer","hasOwnProperty","style"],"mappings":"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","file":"toolkit/component/totalItem.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine(['commonMethod'], function () {\n  return function (data) {\n    var kpiQueryModel = {};\n    var element = data.element;\n    var location = data.location;\n    var buttonEnabled = data.buttonEnabled;\n    var resourceUIService = data.resourceUIService;\n    var global = data.global;\n    var window = data.window;\n    var serviceCenterService = data.serviceCenterService;\n    var innerContent = $(\"<div class='small-box'></div>\");\n    var units = [];\n    var previewMode = data.previewMode;\n    var $controller = data.route.current.$$route.controller;\n    var expression;\n    element.resource_applied = [];\n    element.kpi_applied = [];\n    Object.defineProperty(element, \"resource_applied\", {\n      enumerable: false\n    });\n    Object.defineProperty(element, \"kpi_applied\", {\n      enumerable: false\n    });\n    $$.runExpression(element.$attr(\"advance/expression\"), function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n\n        if (typeof fnResult == 'function') {\n          expression = fnResult(data);\n        } else {\n          expression = fnResult;\n        }\n\n        expression = expression ? expression : {};\n      } else {\n        expression = {};\n        ;\n      }\n    });\n    var clickFn = expression.$attr(\"on/click\");\n\n    element.setResource = function (resources) {\n      element.resource_applied = resources;\n    };\n\n    var renderItem = function renderItem(data) {\n      var item = data.$attr(\"series/0/data/0\") ? data.$attr(\"series/0/data/0\") : {};\n      var inner = $(\"<div></div>\").addClass(\"inner\");\n      var title = $(\"<span></span>\").text(item.value == undefined || item.value == null ? '-' : item.value).css(\"color\", element.parameters.fontcolor);\n      var unit = $(\"<span></span>\").css(\"font-size\", \"20px\").text(item.unit ? item.unit : '').css(\"color\", element.parameters.fontcolor);\n      var number = $(\"<h3></h3>\");\n      var subtitle = $(\"<p></p>\").text(item.name ? item.name : '-').css(\"color\", element.parameters.fontcolor);\n      var icon = $(\"<div></div>\").addClass(\"icon\");\n      var i = $(\"<i></i>\").addClass(element.parameters.icon.perfix + \" \" + element.parameters.icon.css).css(\"font-size\", \"70px\").css(\"pointer-events\", \"none\");\n      icon.append(i);\n      number.append(title).append(unit).append(icon);\n      inner.append(number);\n      inner.append(subtitle);\n      innerContent.css(\"color\", element.parameters.fontColor);\n      innerContent.css('background-color', element.parameters.bgcolor);\n      innerContent.append(inner);\n      innerContent.append(icon);\n\n      if (previewMode) {\n        if (clickFn) {\n          if ($controller != \"freeBoardCtrl\") {\n            innerContent.css(\"cursor\", \"pointer\");\n            innerContent.on(\"click\", function (evt) {\n              try {\n                clickFn({\n                  global: global,\n                  data: data,\n                  element: element\n                });\n              } catch (e) {\n                ;\n              }\n\n              ;\n            });\n          }\n\n          ;\n        }\n\n        ;\n      }\n\n      ;\n    };\n\n    var setTitle = function setTitle(target, text) {\n      target.title.text = text;\n    };\n\n    var setSubtitle = function setSubtitle(target, text) {\n      target.title.subtext = text;\n    };\n\n    var setUnit = function setUnit(target, text) {\n      target.title.unit = text;\n    };\n\n    var setSeries = function setSeries(target, data) {\n      target.series = data;\n    };\n\n    var setParameters = function setParameters(target, parameters, data) {\n      var runExpression = function runExpression(expression, data) {\n        var rs;\n        $$.runExpression(expression, function (funRes) {\n          if (funRes.code == \"0\") {\n            var fnResult = funRes.data;\n\n            if (typeof fnResult == 'function') {\n              rs = fnResult(data);\n            } else {\n              rs = fnResult;\n            }\n          } else {\n            throw new Error(funRes.message);\n          }\n        });\n\n        if (typeof rs == 'function') {\n          return rs(data);\n        } else if (rs == null) {\n          return [];\n        } else {\n          return rs;\n        }\n      };\n\n      var dtype = element.data.applied ? \"bind\" : \"manual\";\n      setTitle(target, parameters.title);\n      setSubtitle(target, parameters.subtitle);\n      setUnit(target, parameters.unit);\n      setSeries(target, runExpression(element.data.series[dtype], data));\n    };\n\n    var run = function run() {\n      var getCiKpi_back = function getCiKpi_back(ci, kpi) {\n        var checkNoEmptyArray = function checkNoEmptyArray(arr) {\n          if (arr instanceof Array) {\n            return arr.length > 0;\n          } else {\n            return false;\n          }\n        };\n\n        if (!checkNoEmptyArray(element.resource_applied)) {\n          element.resource_applied = ci;\n        }\n\n        element.resource_applied = element.resource_applied ? element.resource_applied : ci;\n        element.kpi_applied = kpi;\n        var baseOption = {\n          title: {},\n          series: [{}]\n        };\n        kpiQueryModel = {\n          category: \"ci\",\n          isRealTimeData: true,\n          nodeIds: element.resource_applied.map(function (elem) {\n            return elem.id;\n          }),\n          kpiCodes: element.kpi_applied.map(function (elem) {\n            return elem.id;\n          }),\n          timeRange: \"\",\n          statisticType: \"psiot\",\n          includeInstance: true,\n          condList: []\n        };\n\n        if (element.data.applied) {\n          serviceCenterService.units.getAll().then(function (data) {\n            units = data;\n            var category = element.$attr(\"advance/category\") ? element.$attr(\"advance/category\") : \"time\";\n            var condi = element.$attr(\"advance/condition\");\n            condi = condi ? condi : \"\";\n            var condition;\n\n            try {\n              condition = eval(condi);\n            } catch (e) {}\n\n            ;\n            var method = element.$attr(\"advance/getfunction\") ? element.$attr(\"advance/getfunction\") : 'kpiDataService.getValueList';\n            var type = element.$attr(\"advance/paramtype\") ? element.$attr(\"advance/paramtype\") : \"kpi\";\n            serviceCenterService.getValueListBytime(element.resource_applied, element.kpi_applied, undefined, undefined, undefined, category, type, method, condition).then(getValueList, failure);\n          });\n        } else {\n          inrun({});\n        }\n\n        function getValueList(data) {\n          inrun(data);\n        }\n\n        ;\n\n        function failure(data) {\n          inrun(data);\n        }\n\n        ;\n\n        function inrun(data) {\n          var baseOption = {\n            title: {},\n            series: [{}]\n          };\n          setParameters(baseOption, element.parameters, data);\n          renderItem(baseOption);\n        }\n\n        ;\n      };\n\n      element.getCiKpi(getCiKpi_back);\n    };\n\n    element.render = function () {\n      run();\n    };\n\n    var initFn = expression.$attr(\"on/init\");\n\n    if (initFn) {\n      try {\n        initFn({\n          target: element,\n          global: global\n        });\n      } catch (e) {\n        ;\n      }\n    } else {\n      if (typeof element.data.defer == 'function') {\n        element.data.defer(function () {\n          run();\n        });\n      } else {\n        run();\n      }\n    }\n\n    for (var i in element) {\n      if (element.hasOwnProperty(i) && typeof element[i] == \"function\") {\n        Object.defineProperty(element, i, {\n          enumerable: false\n        });\n      }\n    }\n\n    if (element.style) {\n      innerContent.css(element.style);\n    }\n\n    return innerContent;\n  };\n});"],"sourceRoot":"/source/"}