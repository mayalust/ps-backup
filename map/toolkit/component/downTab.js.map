{"version":3,"sources":["toolkit/component/downTab.js"],"names":["define","data","ra","element","serviceCenterService","innerContent","$","addClass","itag","rate","text","valueDom","disc","append","run","getCiKpi","ci","kpi","applied","getValueListBytime","undefined","then","target","expression","result","dtype","baseOption","series","parameters","$$","runExpression","funRes","code","Error","message","fnResult","val","label","item","vlist","name","length","last","Math","round","isNaN","parseInt","removeClass","abs","replace","renderItem","defer","style","css"],"mappings":"AAGAA,OAAO,GAAI,WACT,OAAO,SAAUC,GACf,IAAIC,EAAK,EACLC,EAAUF,EAAKE,QACfC,EAAuBH,EAAKG,qBAC5BC,EAAeC,EAAE,eAAeC,SAAS,kCACzCC,EAAOF,EAAE,WACTG,EAAOH,EAAE,iBAETI,EAAOJ,EAAE,iBAAiBC,SAAS,0BACnCI,EAAWL,EAAE,aAAaC,SAAS,sBACnCK,EAAON,EAAE,iBAAiBC,SAAS,oBACvCG,EAAKG,OAAOL,GACZE,EAAKG,OAAOJ,GACZJ,EAAaQ,OAAOH,GACpBL,EAAaQ,OAAOF,GACpBN,EAAaQ,OAAOD,GAEpB,IA0EIE,EAAM,WA4BRX,EAAQY,SA3BY,SAAuBC,EAAIC,GAKzCd,EAAQF,KAAKiB,QAEfd,EAAqBe,mBAAmBH,EAAIC,EAAK,YAAsBG,EAAW,MAAO,OAAQ,MAAO,8BADxF,CAAC,MAAO,2BAC0HC,KAAK,SAAiBpB,GACtKa,EAAIb,KAGNa,IAKF,SAASA,EAAIb,GACX,IAzCqCqB,EAAoBrB,EAJ5BqB,EAAQrB,EAKEsB,EAAYtB,EACjDuB,EAiBFC,EAsBIC,EAAa,CACfC,OAAQ,CAAC,KA1C0BL,EA4CvBI,EAAYvB,EAAQyB,WA5CuB3B,EA4CXA,EAzB9CwB,EAAQtB,EAAQF,KAAKiB,QAAU,OAAS,SAvBXI,EAwBvBA,EAnBiCC,EAmBXpB,EAAQF,KAAK0B,OAAOF,GAnBGxB,EAmBKA,EAjB1D4B,GAAGC,cAAcP,EAAY,SAAUQ,GACrC,GAAmB,KAAfA,EAAOC,KAST,MAAM,IAAIC,MAAMF,EAAOG,SARvB,IAAIC,EAAWJ,EAAO9B,KAGpBuB,EADqB,mBAAZW,EACAA,EAASlC,GAETkC,IAdwBlC,EAoBhCuB,EAnBTF,EAAOK,OAAS1B,EAhDD,SAAoBA,GACnC,IAAImC,EAAM,IACNC,EAAQ,IACRC,EAAOrC,EAAK0B,OAAO,GAEvB,GAAIW,EAAM,CACR,IAAIC,EAAQD,EAAKrC,KACjBoC,EAAQC,EAAKE,KAMXJ,EAJiB,EAAfG,EAAME,QACRC,KAAOH,EAAMA,EAAME,OAAS,GAC5BvC,EAAKyC,KAAKC,OAAOF,KAAOH,EAAM,IAAMA,EAAM,GAAK,KAAS,IACxDrC,EAAK2C,MAAM3C,GAAM,IAAM4C,SAAS5C,GAC1BwC,OAENxC,EAAK,EACC,KAIVM,EAAKuC,cACLrC,EAAKqC,cAEI,EAAL7C,GACFM,EAAKD,SAAS,kBACdG,EAAKH,SAAS,aACLL,EAAK,GACdM,EAAKD,SAAS,oBACdG,EAAKH,SAAS,gBAEdC,EAAKD,SAAS,oBACdG,EAAKH,SAAS,cAGZsC,MAAM3C,GACRO,EAAKC,KAAK,QAEVD,EAAKC,KAAK,IAAMiC,KAAKK,IAAI9C,GAAM,KAGjCS,EAASD,KAAK0B,GAEVC,GACFzB,EAAKF,KAAK2B,EAAMY,QAAQ,KAAM,MAqD5BC,CAAWxB,OAqBjB,MAZiC,mBAAtBvB,EAAQF,KAAKkD,MACtBhD,EAAQF,KAAKkD,MAAM,WACjBrC,MAGFA,IAGEX,EAAQiD,OACV/C,EAAagD,IAAIlD,EAAQiD,OAGpB/C","file":"toolkit/component/downTab.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var ra = 0;\n    var element = data.element;\n    var serviceCenterService = data.serviceCenterService;\n    var innerContent = $(\"<div></div>\").addClass(\"description-block border-right\");\n    var itag = $(\"<i></i>\");\n    var rate = $(\"<span></span>\"); //var text = $(\"<span class='description-percentage text-red'><i class='fa fa-caret-up'></i><span id='rate'>\" + (element.attributes.percent ? element.attributes.percent.value : '') + \"%</span></span>\");\n\n    var text = $(\"<span></span>\").addClass(\"description-percentage\");\n    var valueDom = $(\"<h5></h5>\").addClass(\"description-header\");\n    var disc = $(\"<span></span>\").addClass(\"description-text\");\n    text.append(itag);\n    text.append(rate);\n    innerContent.append(text);\n    innerContent.append(valueDom);\n    innerContent.append(disc);\n\n    var renderItem = function renderItem(data) {\n      var val = \"0\",\n          label = \"-\";\n      var item = data.series[0];\n\n      if (item) {\n        var vlist = item.data;\n        label = item.name;\n\n        if (vlist.length > 0) {\n          last = vlist[vlist.length - 1];\n          ra = Math.round((last - vlist[0]) / vlist[0] * 10000) / 100.00;\n          ra = isNaN(ra) ? '-' : parseInt(ra);\n          val = last;\n        } else {\n          ra = 0;\n          val = \"-\";\n        }\n      }\n\n      itag.removeClass();\n      text.removeClass();\n\n      if (ra > 0) {\n        itag.addClass(\"fa fa-caret-up\");\n        text.addClass(\"text-red\");\n      } else if (ra < 0) {\n        itag.addClass(\"fa fa-caret-down\");\n        text.addClass(\"text-green\");\n      } else {\n        itag.addClass(\"fa fa-caret-left\");\n        text.addClass(\"text-gray\");\n      }\n\n      if (isNaN(ra)) {\n        rate.text(' - %');\n      } else {\n        rate.text(' ' + Math.abs(ra) + '%');\n      }\n\n      valueDom.text(val);\n\n      if (label) {\n        disc.text(label.replace(/\\-/, '/'));\n      }\n    };\n\n    var setSeries = function setSeries(target, data) {\n      target.series = data;\n    };\n\n    var setParameters = function setParameters(target, parameters, data) {\n      var runExpression = function runExpression(expression, data) {\n        var result;\n        $$.runExpression(expression, function (funRes) {\n          if (funRes.code == \"0\") {\n            var fnResult = funRes.data;\n\n            if (typeof fnResult == 'function') {\n              result = fnResult(data);\n            } else {\n              result = fnResult;\n            }\n          } else {\n            throw new Error(funRes.message);\n          }\n        });\n        return result;\n      };\n\n      var dtype = element.data.applied ? \"bind\" : \"manual\";\n      setSeries(target, runExpression(element.data.series[dtype], data));\n    };\n\n    var run = function run() {\n      var getCiKpi_back = function getCiKpi_back(ci, kpi) {\n        var baseOption = {\n          series: [{}]\n        };\n\n        if (element.data.applied) {\n          var condition = [\"kpi\", \"{object:kpiQueryModel}\"];\n          serviceCenterService.getValueListBytime(ci, kpi, 7 * 24 * 3600 * 1000, undefined, \"年月日\", \"time\", \"kpi\", \"kpiDataService.getValueList\", condition).then(function success(data) {\n            run(data);\n          });\n        } else {\n          run();\n        }\n\n        ;\n\n        function run(data) {\n          var baseOption = {\n            series: [{}]\n          };\n          setParameters(baseOption, element.parameters, data);\n          renderItem(baseOption);\n        }\n\n        ;\n      };\n\n      element.getCiKpi(getCiKpi_back);\n    };\n\n    if (typeof element.data.defer == 'function') {\n      element.data.defer(function () {\n        run();\n      });\n    } else {\n      run();\n    }\n\n    if (element.style) {\n      innerContent.css(element.style);\n    }\n\n    return innerContent;\n  };\n});"],"sourceRoot":"/source/"}