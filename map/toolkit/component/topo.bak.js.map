{"version":3,"sources":["toolkit/component/topo.bak.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","data","elemData","uuid","undefined","Error","self","element","viewId","all_resources","all_kpis","viewFlexService","serviceProxy","userLoginUIService","commonMethod","q","global","SwSocket","parentheight","parentwidth","json","JSON","taDom","completeCallback","complete","svgId","Math","defer","traverseRow","traverseCol","timeout","route","previewMode","openAngles","persentage","events","expression","mm","id","factory","parse","stringify","topo","$","wrap","extend","a","b","i","runExpression","resourceUIService","max_height","max_width","css","serviceCenterService","kpiDataService","displayModeLink","arrowheadMarkup","toolMarkup","vertexMarkup","itemins","setSelfDom","$on","eventName","callback","off","append","error","str","children","remove","warning","font-size","min-height","text-align","line-height","setResources","resources","composoryRes","Object","defineProperty","enumerable","createDeviceDropList","pos","config","p","hitArea","titleArea","popup","clickFn","$attr","titleClickFn","attr","y","x","on","event","createDom","item","label","status","getAlertColor","text","find","node","prepend","createAttrDisp","t","planeMode","body","title","orderKey","findIndex","arr","length","attrDisp","sort","ka","d","kpiName","indexOf","kb","tr","td1","td2","td3","td4","time","useMomentFormat","arisingTime","button","span1","devName","span2","message","span3","popover","placement","trigger","container","content","this","valueStr","value","toFix","updateValue","unit","val","updateStatus","updateTime","destroy","getData","createCurrentStatus","txt","ins","addOn","circle","wholeClick","getValue","nodeId","getDomainAreaLineTree_alertStatus","domaintree","traverse","getResourceById","resource","getAttrsByModelId","modelId","attrs","sub","sensor","physicalConfig","accessConfigs","n","instance","setParameter","setValue","dataItemId","specialty","navigateToTab","setTimeout","growl","currentStatus","size","setAlarmStatus","createCurrentStatusByItem","filter","elm","ROLE","navigateTo","main","backHistory","createMarker","$$","loadExternalJs","threeDbar","init","createAlarm","createAlarmSmall","smallMode","create3Dbar","getPersentageSite","position","tempPosition","render","inputJson","cb_fun","run","joint","parent","height","width","domwidth","graph","dia","Graph","oldwidth","oldheight","$clone","el","style","domheight","PatternLinkView","LinkView","patternMarkup","join","apply","arguments","model","get","listenTo","update","util","cancelFrame","frameId","pattern","V","_","template","patternImage","origin","findOne","paper","svg","defs","_V","connection","stroke","strokeWidth","nextFrame","bind","fillWithPattern","bbox","g","rect","moveAndExpand","points","concat","sourcePoint","targetPoint","map","point","canvas","document","createElement","ctx","getContext","lineWidth","lineJoin","lineCap","pointsCount","save","gradientPoints","gradient","createLinearGradient","drawPattern","call","restore","dataUri","toDataURL","xlink:href","from","to","angle","toRad","theta","center","line","midpoint","start","fromPolar","end","PI","beginPath","moveTo","lineTo","closePath","strokeStyle","interactive","perpendicularLinks","gridSize","markAvailable","linkConnectionPoint","shapePerimeterConnectionPoint","defaultLink","Link",".marker-source","transform",".marker-target",".connection","linkView","innerWidth","outerWidth","lineColor","move","addColorStop","patternColor","cells","repeat","target","transition","delay","duration","timingFunction","valueFunction","scale","portion","translate","ys","cell","Paper","type","image","substring","fromJSON","getCells","cellView","Element","openCellTools","evt","isString","bgimage","defers","nodes","kpis","pages","routeParam","page","split","distype","getParameter","currentPath","mleft","margin","parseInt","e","loop","kpiId","elementId","elDom","getCell","cellType","nodeStr","kpiStr","findNumber","openAngle","setPos","runRegExp","push","echartViewId","getViewById","view","chartWrap","layout","$remapByChild","elem","nodeIds","$remove","index","getResourceByIds","numStr","strToNumer","getBymodelId","then","traveseByChild","kpi","resolve","jQuery","display","attributes","resourceObj","kpiObj","promise","all","cellsDic","getData_success","findState","createData","setLevel","range","eval","persent","prop","setOpenAngle","fillColor","color","state","color2","stateId","colorAry","colorAry2","interpolate","hexColor","breathFlash","opacityState","flash","defaultOpacity","opacity","timing","inout","o","abs","Number","toFixed","isNumeric","contains","getTransitions","path","bubbleFlash","r","changeIconAndText","forEach","alertText","alertIcon","stateDisplay","valueText","valueIcon","getFill","rs","fill","getType","getTextFill","getAllUnit_success","stateType","allUnits","rangeObj","unitCode","unitType","kpiCode","unitName","res","getKpisByModelId","err","units","getAll","returnData","showEffect","nodeIdAry","cellObj","kpiIdAry","getRealTimeKpiData","returnObj","code","paramSocket","ciid","toString","operation","register","send","unregister","initEvent","clickEvent","wholeClickEvent","underWatch","tools","console","funRes","fnResult"],"mappings":"AAAA,SAASA,QAAQC,GAAwT,OAAtOD,QAArD,mBAAXE,QAAoD,iBAApBA,OAAOC,SAAmC,SAAiBF,GAAO,cAAcA,GAA2B,SAAiBA,GAAO,OAAOA,GAAyB,mBAAXC,QAAyBD,EAAIG,cAAgBF,QAAUD,IAAQC,OAAOG,UAAY,gBAAkBJ,IAAyBA,GAKxVK,OAAO,GAAI,WACT,OAAO,SAAUC,MACf,IAAIC,SAAWD,KAMXE,KAJJ,GAAgBC,MAAZF,SACF,MAAM,IAAIG,MAAM,aAIlB,IAAIC,KAAOJ,SAASK,QAChBC,OAASF,KAAKE,OACdC,cAAgB,GAChBC,SAAW,GACXC,gBAAkBT,SAASS,gBAC3BC,aAAeV,SAASU,aACxBC,mBAAqBX,SAASW,mBAC9BN,QAAUL,SAASK,QACnBO,aAAeP,QAAQT,YACvBiB,EAAIb,SAASa,EACbC,OAASd,SAASc,OAClBC,SAAWf,SAASe,SACpBC,aAAcC,YACdC,KAAOb,QAAQc,KACfC,MACAC,iBAAmBtB,KAAKuB,SACxBC,MAAQ,OAASC,KAAKvB,OACtBwB,MAAQzB,SAASyB,MACjBC,YAAc1B,SAAS0B,YACvBC,YAAc3B,SAAS2B,YACvBC,QAAU5B,SAAS4B,QACnBC,MAAQ7B,SAAS6B,MACjBC,YAAc9B,SAAS8B,YACvBC,WAAa,GACbC,WAAa,EACbC,OAAS,GACTC,WACAC,GAAKV,MAAMW,GACXC,QAAUlB,KAAKmB,MAAMnB,KAAKoB,UAAU7B,eACpC8B,KAAOC,EAAE,eACTC,KAAOD,EAAE,eAab,SAASE,OAAOC,EAAGC,GACjB,IAAK,IAAIC,KAAKD,EACZD,EAAEE,GAAKD,EAAEC,GAGX,OAAOF,EAGT,SAASG,cAAcb,YACrB,IAAIc,kBAAoBhD,SAASgD,kBAC7BC,WAAYC,UAChBV,KAAKW,IAAI,WAAY,YACrB,IAAIH,kBAAoBhD,SAASgD,kBAC7BI,qBAAuBpD,SAASoD,qBAChCC,eAAiBrD,SAASqD,eAC1BC,gBAAkB,CACpBC,gBAAmB,UACnBC,WAAc,UACdC,aAAgB,WAkTdC,QA/S6B,mBAAtBrD,QAAQsD,YACjBtD,QAAQsD,WAAWnB,MAGrBnC,QAAQuD,IAAM,SAAUC,EAAWC,GACjC7B,OAAO4B,GAAaC,GAGtBzD,QAAQ0D,IAAI,sBACZ1D,QAAQ0D,IAAI,wBACZvB,KAAKwB,OAAOtB,MAEZtC,KAAK6D,MAAQ,SAAUC,GACrBxB,KAAKyB,WAAWC,SAChB,IAAIC,EAAU5B,EAAE,MAAQyB,EAAM,QAC9BG,EAAQlB,IAAI,CACVmB,YAAa,OACbC,aAAc,QACdC,aAAc,SACdC,cAAe,UAEjB/B,KAAKsB,OAAOK,IAGdjE,KAAKsE,aAAe,SAAUC,GAC5BvE,KAAKwE,aAAeD,EACpBE,OAAOC,eAAe1E,KAAM,eAAgB,CAC1C2E,YAAY,KAIhB3E,KAAK4E,qBAAuB,SAAUjF,EAAMkF,EAAKC,GAC/C,IAAIC,EAAInD,YAAc,EAClBoD,EAAU3C,EAAE,eACZ4C,EAAY5C,EAAE,eACd6C,EAAQ7C,EAAE,eAEV8C,GADAL,EAASA,GAAU,IACFM,MAAM,SACvBC,EAAeP,EAAOM,MAAM,cAChC/C,EAAE,qBAAqB2B,SACvBgB,EAAQM,KAAK,KAAM,oBACnBL,EAAUlC,IAAI,QAAS,QACvBkC,EAAUlC,IAAI,SAAU,QACxBiC,EAAQjC,IAAI,WAAY,YACxBiC,EAAQjC,IAAI,UAAW,KACvBmC,EAAMnC,IAAI,UAAW,OACrBmC,EAAMnC,IAAI,mBAAoB,WAC9BmC,EAAMnC,IAAI,SAAU,kBACpBmC,EAAMnC,IAAI,aAAc,mCACxBmC,EAAMnC,IAAI,aAAc,SACxBmC,EAAMnC,IAAI,aAAc,UACxBmC,EAAMnC,IAAI,aAAc,QACxBiC,EAAQjC,IAAI,SAAU,WACtBiC,EAAQjC,IAAI,MAAO8B,EAAIU,EAAIR,GAAKD,EAAOS,GAAK,IAAM,MAClDP,EAAQjC,IAAI,OAAQ8B,EAAIW,EAAIT,GAAKD,EAAOU,GAAK,IAAM,MACnDR,EAAQjC,IAAI,mBAAoB,iBAChCiC,EAAQS,GAAG,aAAc,SAAUC,GACjCrD,EAAE,qBAAqB2B,WAEzBiB,EAAUQ,GAAG,QAAS,SAAUC,GAC9BL,MAGF,IAAIM,EAAY,SAAmBC,GACjC,IAAItD,EAAOD,EAAE,eACTwD,EAAQxD,EAAE,iBACVyD,EAASzD,EAAE,eA0Bf,OAzBAC,EAAKgD,KAAK,KAAM,QAChBQ,EAAO/C,IAAI,eAAgB,OAC3B+C,EAAO/C,IAAI,QAAS,QACpB+C,EAAO/C,IAAI,SAAU,QACrB+C,EAAO/C,IAAI,gBAAiB,OAC5B+C,EAAO/C,IAAI,mBAAoB/C,KAAK+F,cAAcH,EAAKE,SACvDA,EAAO/C,IAAI,UAAW,gBACtBT,EAAKS,IAAI,UAAW,YACpB8C,EAAMG,KAAKJ,EAAKC,OAChBA,EAAM9C,IAAI,gBAAiB,QAC3BT,EAAKsB,OAAOkC,GACZxD,EAAKsB,OAAOiC,GACZvD,EAAKmD,GAAG,aAAc,SAAUC,GAC9BV,EAAQiB,KAAK,SAASlD,IAAI,mBAAoB,iBAC9CT,EAAKS,IAAI,mBAAoB,oBAE/BT,EAAKmD,GAAG,aAAc,SAAUC,GAC9BpD,EAAKS,IAAI,mBAAoB,mBAE/BT,EAAKmD,GAAG,QAAS,SAAUC,GACzBP,EAAQS,KAEVA,EAAKpC,IAAI,gBAAiB,SAAU0C,GAClCJ,EAAO/C,IAAI,mBAAoB/C,KAAK+F,cAAcH,EAAKE,WAElDxD,GAGT,IAAK,IAAII,KAAK/C,EACZuF,EAAMtB,OAAO+B,EAAUhG,EAAK+C,KAG9BsC,EAAQpB,OAAOqB,GACfD,EAAQpB,OAAOsB,GACf9C,KAAK+D,QAAQnB,IAIfhF,KAAKoG,eAAiB,SAAUC,EAAG1G,EAAMkF,EAAKnB,EAAU4C,GACtD,IAAIpB,EAAOqB,EAAMC,EAAOlE,EACpBmE,EAAW,CAAC,QAAS,QAAS,KAAM,KAAM,KAAM,KAAM,KAAM,MAEhE,SAASC,EAAUC,EAAKjD,GACtB,IAAIhB,EAEJ,IAAKA,EAAI,EAAGA,EAAIiE,EAAIC,OAAQlE,IAG1B,GAFOgB,EAASiD,EAAIjE,GAAIA,GAGtB,OAAOA,EAKb,SAASmE,IACP3B,EAAQ7C,EAAE,eACVkE,EAAOlE,EAAE,eACTmE,EAAQnE,EAAE,eACVC,EAAOD,EAAE,mBACT6C,EAAMnC,IAAI,WAAY,YACtBmC,EAAMnC,IAAI,UAAW,OACrBmC,EAAMnC,IAAI,mBAAoB,qBAC9BmC,EAAMnC,IAAI,SAAU,kBACpBmC,EAAMnC,IAAI,aAAc,mCACxBmC,EAAMnC,IAAI,UAAW,IAEjBuD,GACFC,EAAKxD,IAAI,aAAc,SACvBwD,EAAKxD,IAAI,YAAa,WAEtBpD,EAAKmH,KAAK,SAAUtE,EAAGC,GAOrB,OANAsE,GAAKL,EAAUD,EAAU,SAAUO,GACjC,OAA6C,IAArCxE,EAAEyE,SAAWzE,EAAEqD,OAAOqB,QAAQF,MAClCxE,EAAEqD,MACRsB,GAAKT,EAAUD,EAAU,SAAUO,GACjC,OAA6C,IAArCvE,EAAEwE,SAAWxE,EAAEoD,OAAOqB,QAAQF,MAClCvE,EAAEoD,MACDkB,GAAKI,IAAM,EAAI,IAExBZ,EAAKxD,IAAI,aAAc,SAGzBwD,EAAKxD,IAAI,aAAc,QACvBwD,EAAKxD,IAAI,WAAY,QACrByD,EAAMzD,IAAI,aAAc,UACxByD,EAAMzD,IAAI,cAAe,QACzByD,EAAMzD,IAAI,UAAW,OACrByD,EAAMzD,IAAI,QAAS,QACnByD,EAAMzD,IAAI,mBAAoB,WAC9ByD,EAAMR,KAAKK,GACXnB,EAAMnC,IAAI,MAAO8B,EAAIU,EAAI,MACzBL,EAAMnC,IAAI,OAAQ8B,EAAIW,EAAI,MAC1BN,EAAMtB,OAAO4C,GAEb,IAAIb,EAAY,SAAmBC,GACjC,IAAIwB,EAAK/E,EAAE,aACPgF,EAAMhF,EAAE,aACRiF,EAAMjF,EAAE,aACRkF,EAAMlF,EAAE,aACRmF,EAAMnF,EAAE,aACRoF,EAAOC,gBAAgB9B,EAAK+B,YAAa,uBAC7CN,EAAItE,IAAI,UAAW,mBACnBuE,EAAIvE,IAAI,UAAW,mBACnBwE,EAAIxE,IAAI,UAAW,mBACnByE,EAAIzE,IAAI,UAAW,mBACnBsE,EAAItE,IAAI,iBAAkB,UAC1BuE,EAAIvE,IAAI,iBAAkB,UAC1BwE,EAAIxE,IAAI,iBAAkB,UAC1ByE,EAAIzE,IAAI,iBAAkB,UAC1B,IAAI8C,EAAQxD,EAAE,iBACVuF,EAASvF,EAAE,gDAEf,GAAKiE,EAYE,CACL,IAAIuB,EAAQxF,EAAE,SAAWuD,EAAKkC,QAAU,WACpCC,EAAQ1F,EAAE,SAAWuD,EAAKoC,QAAU,WACpCC,EAAQ5F,EAAE,SAAWqF,gBAAgB9B,EAAK+B,YAAa,uBAAyB,WACpFE,EAAM9E,IAAI,cAAe,UACzBgF,EAAMhF,IAAI,cAAe,UACzBkF,EAAMlF,IAAI,cAAe,UACzB8E,EAAM9E,IAAI,UAAW,gBACrBgF,EAAMhF,IAAI,UAAW,gBACrBkF,EAAMlF,IAAI,UAAW,gBACrB8E,EAAM9E,IAAI,YAAa,SACvBgF,EAAMhF,IAAI,YAAa,SACvBsE,EAAIzD,OAAOiE,GACXN,EAAI3D,OAAOmE,GACXP,EAAI5D,OAAOqE,QAzBXL,EAAOM,QAAQ,CACbC,UAAW,QACXC,QAAS,SACT5B,MAAO,OACP6B,UAAW,OACXC,QAAS,WACP,OAAOb,KAERhC,GAAG,aA4BR,WACMY,GACFhE,EAAEkG,MAAML,QAAQ,UA9BczC,GAAG,aAkCrC,WACEpD,EAAEkG,MAAML,QAAQ,UAlChBrC,EAAMG,KAAKJ,EAAKC,OAChBwB,EAAIzD,OAAOiC,GA0Fb,OAxEID,EAAK4C,SACPZ,EAAO5B,KAAKJ,EAAK4C,UACM,KAAd5C,EAAK6C,MACdb,EAAO5B,KAAKhG,KAAK0I,MAAM9C,EAAK6C,MAAO,IAEnCb,EAAO5B,KAAK,KAcdH,EAAM9C,IAAI,QAAS,QACnB8C,EAAM9C,IAAI,gBAAiB,QAE3B6C,EAAK+C,YAAc,SAAUF,EAAOG,GAElC,IAAIC,EAAM,MAAOJ,EAA0CA,EAAQ,IACnEI,EAAoB,iBAAPA,EAAkB7I,KAAK0I,MAAMG,EAAK,GAAKA,EAExC,MAARD,GAAgBA,IAClBC,GAAOD,GAGThB,EAAO5B,KAAK6C,GACZN,KAAKE,MAAQA,GAGf7C,EAAKkD,aAAe,SAAUL,GAC5BF,KAAKzC,OAAS2C,EACdb,EAAO7E,IAAI,mBAAoB/C,KAAK+F,cAAc0C,KAGpD7C,EAAKmD,WAAa,SAAU1C,GACtBA,IACFoB,EAAOC,gBAAgBrB,EAAG,yBAI9BuB,EAAO7E,IAAI,YAAa,QACxB6E,EAAO7E,IAAI,aAAc,UACzB6E,EAAO7E,IAAI,cAAe,QAC1B6E,EAAO7E,IAAI,SAAU,GACrB6E,EAAO7E,IAAI,QAAS,QACpB6E,EAAO7E,IAAI,gBAAiB,QAC5B6E,EAAO7E,IAAI,mBAAoB/C,KAAK+F,cAAcH,EAAKE,SACvD8B,EAAOnC,GAAG,QAAS,SAAUC,GAC3BrD,EAAEkG,MAAML,QAAQ,WAEZxE,GACFA,EAASkC,KAITA,EAAKC,OACPuB,EAAGxD,OAAOyD,GAGRf,IACFc,EAAGxD,OAAO2D,GACVH,EAAGxD,OAAO4D,IAGZJ,EAAGxD,OAAO0D,GACVA,EAAI1D,OAAOgE,GACJR,GAGT,IAAK,IAAI1E,KAAK/C,EACZ2C,EAAKsB,OAAO+B,EAAUhG,EAAK+C,KAG7B6D,EAAK3C,OAAOtB,GACZ4C,EAAMtB,OAAO2C,GACbnE,KAAKwB,OAAOsB,GAWd,OARA2B,EAASpH,UAAUuJ,QAAU,WAC3B9D,EAAMlB,UAGR6C,EAASpH,UAAUwJ,QAAU,WAC3B,OAAOtJ,GAGF,IAAIkH,GAKb7G,KAAKkJ,oBAAsB,SAAUC,EAAKtE,EAAKiB,GAC7C,IAIIsD,EAJA9G,EAAOF,KAAK6D,KAAK,eACjBO,EAAQnE,EAAE,eACVgH,EAAQhH,EAAE,eACViH,EAASjH,EAAE,eAKf,SAASkH,IACPlH,EAAE,QAAQsB,IAAI,SACdyF,EAAIJ,UAEA1F,SACFA,QAAQ0F,UAIZ,SAAS7D,EAAQO,GACf,IAAIX,EAAInD,YAAc,EAClBjC,EAAOK,KAAKwJ,SAAS,iBAErBJ,GACFA,EAAIJ,UAGN3G,EAAE,QAAQsB,IAAI,SAEVhE,IACgB,EAAdA,EAAKiH,QACPwC,EAAMpJ,KAAKoG,eAAe,OAAQzG,EAAM,CACtC6F,EAAGX,EAAIW,EAAIT,EAAI,IACfQ,EAAGV,EAAIU,EAAIR,EAAI,IACd,SAAUa,GACX,IAAI6D,EAAS7D,EAAK6D,OAEPzJ,KAAKwJ,SAAS,eACzBxJ,KAAK0J,kCAAkC,SAAUC,GAC/CA,EAAWC,SAAS,SAAU1D,GACxBA,EAAKlE,IAAMyH,GACbzJ,KAAK6J,gBAAgB3D,EAAKlE,GAAI,SAAU8H,GACtC9J,KAAK+J,kBAAkBD,EAASE,QAAS,SAAUC,GACjD1H,OAAO2D,EAAM4D,GACb,IAAII,EAEAC,GADgBjE,EAAKkE,eAAeC,eAAiB,IAC9BpE,KAAK,SAAUqE,GACxC,OAAOA,EAAEC,WAAa3E,EAAK2E,YACvB,KACNvK,KAAKwK,aAAa,KAAMtE,EAAKlE,IAC7BhC,KAAKyK,SAAS,mBAAoB7E,EAAK+B,aACvC3H,KAAKyK,SAAS,kBAAmBvE,GACjClG,KAAKyK,SAAS,gBAAiBN,GAC/BnK,KAAKyK,SAAS,kBAAmB7E,EAAK2E,UACtCvK,KAAKwK,aAAa,WAAYL,EAAOO,YAGnCR,EADoB,KAAlBtE,EAAK+E,UACD,EACqB,KAAlB/E,EAAK+E,UACR,EAEA,EAGR3K,KAAK4K,cAAc,WAAYV,EAAK,aAM7C,GACHW,WAAW,WACTxI,EAAE,QAAQoD,GAAG,QAAS8D,MAGxBvJ,KAAK8K,MAAM,gBAKjB,SAASC,IACPzI,EAAKS,IAAI,WAAY,YACrB,IAAIgC,EAAInD,YAAc,EACtBU,EAAKS,IAAI,SAAU,WACnBT,EAAKS,IAAI,MAAO8B,EAAIU,EAAIR,EAAI,MAC5BzC,EAAKS,IAAI,OAAQ8B,EAAIW,EAAIT,EAAI,MAC7ByB,EAAMR,KAAKmD,GACX3C,EAAMzD,IAAI,gBAAiB,OAC3ByD,EAAMzD,IAAI,cAAe,QACzByD,EAAMzD,IAAI,cAAe,QACzByD,EAAMzD,IAAI,UAAW,gBACrByD,EAAMzD,IAAI,QAAS,QACnBsG,EAAMtG,IAAI,UAAW,gBACrBuG,EAAOvG,IAAI,UAAW,SACtBuG,EAAOvG,IAAI,WAAY,YACvBuG,EAAOvG,IAAI,MAAO,OAClBuG,EAAOvG,IAAI,QAAS,QACpBuG,EAAOvG,IAAI,SAAU,QACrBuG,EAAOvG,IAAI,gBAAiB,OAC5BuG,EAAOvG,IAAI,mBAAoB/C,KAAK+F,cAAcD,IAClDwD,EAAOvG,IAAI,aAAc,kCAEZ,EAAT+C,IACFU,EAAMzD,IAAI,kBAAmB,aAC7BT,EAAKqB,IAAI,SACTrB,EAAKmD,GAAG,QAASN,IAGnBkE,EAAMzF,OAAO0F,GACbhH,EAAKsB,OAAO4C,GACZlE,EAAKsB,OAAOyF,GACZjH,KAAKwB,OAAOtB,GAad,OArHAA,EAAOA,EAAK0I,OAAS1I,EAAOD,EAAE,6BACzB0B,WAAWC,SA0GhB+G,EAActL,UAAUwL,eAAiB,SAAUnF,GACjDwD,EAAOvG,IAAI,mBAAoB/C,KAAK+F,cAAcD,IAErC,EAATA,IACFU,EAAMzD,IAAI,kBAAmB,aAC7BT,EAAKqB,IAAI,SACTrB,EAAKmD,GAAG,QAASN,KAId,IAAI4F,GAGb/K,KAAKkL,0BAA4B,SAAUlJ,EAAI6C,GAC7C,SAAS0E,IACPlH,EAAE,QAAQsB,IAAI,SACVL,SAASA,QAAQ0F,UAGvB,IACMjE,EACApF,EADAoF,EAAInD,YAAc,EAClBjC,EAAOK,KAAKwJ,SAAS,iBAErBlG,SACFA,QAAQ0F,UAGVrJ,EAAOA,EAAKwL,OAAO,SAAUC,GAC3B,OAAOA,EAAI3B,QAAUzH,IAEvBK,EAAE,QAAQsB,IAAI,SAEI,EAAdhE,EAAKiH,QACPtD,QAAUtD,KAAKoG,eAAe,OAAQzG,EAAM,CAC1C6F,EAAGX,EAAIW,EAAIT,EACXQ,EAAGV,EAAIU,EAAIR,GACV,SAAUa,GACX,IAAI6D,EAAS7D,EAAK6D,OAEd4B,EAAOrL,KAAKwJ,SAAS,eACzBxJ,KAAK0J,kCAAkC,SAAUC,GAC/CA,EAAWC,SAAS,SAAU1D,GAC5B,IAAIgE,EAEAhE,EAAKlE,IAAMyH,IACbzJ,KAAKyK,SAAS,kBAAmBvE,GACjClG,KAAKyK,SAAS,kBAAmB7E,EAAK2E,UACtCvK,KAAKyK,SAAS,gBAAiB7E,GAC/B5F,KAAKyK,SAAS,mBAAoB7E,EAAK+B,aACvC3H,KAAKwK,aAAa,WAAY5E,EAAK5D,IAGjCkI,EADoB,KAAlBhE,EAAKyE,UACD,EACqB,KAAlBzE,EAAKyE,UACR,EAEA,EAGI,GAARU,EACFrL,KAAKsL,WAAW,QAAS,CACvBC,KAAM,EACNrB,IAAKA,EACLsB,YAAa,GACZ,QACc,GAARH,EACTrL,KAAKsL,WAAW,QAAS,CACvBC,KAAM,EACNrB,IAAKA,EACLsB,YAAa,GACZ,QACc,GAARH,EACTrL,KAAKsL,WAAW,QAAS,CACvBC,KAAM,EACNrB,IAAKA,EACLsB,YAAa,GACZ,QAEHxL,KAAK8K,MAAM,sBAKlB,GACHD,WAAW,WACTxI,EAAE,QAAQoD,GAAG,QAAS8D,MAGxBvJ,KAAK8K,MAAM,mBAOjB9K,KAAKyL,aAAe,SAAUjF,EAAO9C,GACnCgI,GAAGC,eAAe,CAAC,4BAA6B,SAAUC,GACxD,IAAIxC,EAAMwC,EAAUC,KAAK1K,MAAO,CAC9BqF,MAAOA,IAET9C,EAAS0F,MAIbpJ,KAAK8L,YAAc,SAAUtF,EAAO9C,GAClCgI,GAAGC,eAAe,CAAC,2BAA4B,SAAUC,GACvD,IAAIxC,EAAMwC,EAAUC,KAAK1K,MAAO,CAC9BqF,MAAOA,IAET9C,EAAS0F,MAIbpJ,KAAK+L,iBAAmB,SAAUvF,EAAO9C,GACvCgI,GAAGC,eAAe,CAAC,2BAA4B,SAAUC,GACvD,IAAIxC,EAAMwC,EAAUC,KAAK1K,MAAO,CAC9BqF,MAAOA,EACPwF,WAAW,IAEbtI,EAAS0F,MAIbpJ,KAAKiM,YAAc,SAAUzF,EAAO9C,GAClCgI,GAAGC,eAAe,CAAC,gCAAiC,SAAUC,GAC5D,IAAIxC,EAAMwC,EAAUC,KAAK1K,MAAO,CAC9BqF,MAAOA,IAIT9C,EAAS0F,MAKbpJ,KAAKkM,kBAAoB,SAAUC,GACjC,IAAIpH,EAAInD,YAAc,EAClBwK,EAAe,CACjB5G,EAAG,EACHD,EAAG,GAIL,OAFA6G,EAAa5G,EAAI2G,EAAS3G,EAAIT,EAC9BqH,EAAa7G,EAAI4G,EAAS5G,EAAIR,EACvBqH,GAGTpM,KAAKqM,OAAS,SAAUC,UAAWC,QACjC,IAAIC,IAAM,SAASA,IAAI1L,MACrB,GAAqB,UAAjB1B,QAAQ0B,OAA6B,MAARA,KAAc,CAC7C,IAAI4C,SAAW,SAASA,SAAS+I,OAC/BjL,QAAQ,WACNZ,aAAewB,KAAKsK,SAASC,SAC7B9L,YAAcuB,KAAKsK,SAASE,QAC5B,IAAIC,SAAWzK,KAAKwK,QAChBE,MAAQ,IAAIL,MAAMM,IAAIC,MACtBC,SAAWnM,KAAK8L,MAChBM,UAAYpM,KAAK6L,OACjB7H,OAAShE,KAAKqM,SAClB7K,KAAKyB,WAAWC,SAChBc,OAAOsI,GAAK9K,KAAK,GAEZrC,QAAQoN,MAAMV,QACjBvK,KAAKW,IAAI,SAAU8J,SAAWK,UAAYD,SAAW,MAGvD,IAAIK,UAAYlL,KAAKuK,SACjBY,gBAAkBd,MAAMM,IAAIS,SAASjL,OAAO,CAC9CkL,cAAe,CAAC,iEAAkE,yBAA0B,cAAcC,KAAK,IAC/HrB,OAAQ,WAGN,GAFAI,MAAMM,IAAIS,SAAS/N,UAAU4M,OAAOsB,MAAMpF,KAAMqF,YAE5CrF,KAAKsF,OAAUtF,KAAKsF,MAAMC,IAAI,WAKlC,OADAvF,KAAKwF,SAASxF,KAAKsF,MAAO,qCAAsCtF,KAAKyF,QAC9DzF,MAETvE,OAAQ,WACNyI,MAAMwB,KAAKC,YAAY3F,KAAK4F,SAC5B1B,MAAMM,IAAIS,SAAS/N,UAAUuE,OAAO2J,MAAMpF,KAAMqF,WAE5CrF,KAAK6F,UACP7F,KAAK6F,QAAQpK,SACbuE,KAAK6F,QAAU,OAGnBJ,OAAQ,WAGN,GAFAvB,MAAMM,IAAIS,SAAS/N,UAAUuO,OAAOL,MAAMpF,KAAMqF,YAE5CrF,KAAKsF,OAAUtF,KAAKsF,MAAMC,IAAI,WAmBlC,OAfKvF,KAAK6F,UACR7F,KAAK6F,QAAU3B,MAAM4B,EAAEC,EAAEC,SAAShG,KAAKkF,cAAhBa,CAA+B,CACpDtM,GAAIuG,KAAKvG,MAEXuG,KAAKiG,aAAevM,QAAQwM,OAASlG,KAAK6F,QAAQM,QAAQ,SAC1DjC,MAAM4B,EAAE9F,KAAKoG,MAAMC,KAAKC,OAAOjL,OAAO2E,KAAK6F,UAG7C7F,KAAKuG,GAAGC,WAAWzJ,KAAK,CACtB0J,OAAU,gBAAkBzG,KAAKvG,GAAK,MAGxCuG,KAAK0G,YAAc1G,KAAKuG,GAAGC,WAAWzJ,KAAK,iBAAmB,EAC9DmH,MAAMwB,KAAKC,YAAY3F,KAAK4F,SAC5B5F,KAAK4F,QAAU1B,MAAMwB,KAAKiB,UAAUZ,EAAEa,KAAK5G,KAAK6G,gBAAiB7G,OAC1DA,MAET6G,gBAAiB,WACf,IAAIH,EAAc1G,KAAK0G,YACnBI,EAAO5C,MAAM6C,EAAEC,KAAK9C,MAAM4B,EAAE9F,KAAK6E,IAAIiC,MAAK,IAAOG,cAAc,CACjEhK,GAAIyJ,EACJ1J,GAAI0J,EACJrC,MAAO,EAAIqC,EACXtC,OAAQ,EAAIsC,IAEVQ,EAAS,GAAGC,OAAOnH,KAAKoH,YAAapH,KAAK9G,MAAO8G,KAAKqH,aAC1DH,EAASnB,EAAEuB,IAAIJ,EAAQ,SAAUK,GAC/B,OAAOrD,MAAM6C,EAAEQ,MAAMA,EAAMtK,EAAI6J,EAAK7J,EAAGsK,EAAMvK,EAAI8J,EAAK9J,KAExD,IAAIwK,EAASC,SAASC,cAAc,UACpCF,EAAOnD,MAAQyC,EAAKzC,MACpBmD,EAAOpD,OAAS0C,EAAK1C,OACrB,IAAIuD,EAAMH,EAAOI,WAAW,MAC5BD,EAAIE,UAAYnB,EAChBiB,EAAIG,SAAW,QACfH,EAAII,QAAU,QAEd,IAAK,IAAI5N,EAAI,EAAG6N,EAAcd,EAAO7I,OAAS,EAAGlE,EAAI6N,EAAa7N,IAAK,CACrEwN,EAAIM,OACJ,IAAIC,EAAiBlI,KAAKkI,eAAehB,EAAO/M,GAAI+M,EAAO/M,EAAI,GAAIuM,GAC/DyB,EAAWR,EAAIS,qBAAqBhD,MAAMuC,EAAKO,GACnDlI,KAAKqI,YAAYC,KAAKtI,KAAM2H,EAAKT,EAAO/M,GAAI+M,EAAO/M,EAAI,GAAIuM,EAAayB,EAAUjB,EAAQ/M,GAC1FwN,EAAIY,UAGN,IAAIC,EAAU9O,QAAQwM,OAASsB,EAAOiB,UAAU,aAChDzI,KAAK6F,QAAQ9I,KAAK+J,GAClB9G,KAAKiG,aAAalJ,KAAK,CACrBsH,MAAOyC,EAAKzC,MACZD,OAAQ0C,EAAK1C,OACbsE,aAAcF,KAGlBN,eAAgB,SAAwBS,EAAMC,EAAIvE,GAChD,IAAIwE,EAAQ3E,MAAM6C,EAAE+B,MAAMH,EAAKI,MAAMH,GAAM,IACvCI,EAAS9E,MAAM6C,EAAEkC,KAAKN,EAAMC,GAAIM,WAChCC,EAAQjF,MAAM6C,EAAEQ,MAAM6B,UAAU/E,EAAQ,EAAGwE,EAAOG,GAClDK,EAAMnF,MAAM6C,EAAEQ,MAAM6B,UAAU/E,EAAQ,EAAGxL,KAAKyQ,GAAKT,EAAOG,GAC9D,MAAO,CAACG,EAAMlM,EAAGkM,EAAMnM,EAAGqM,EAAIpM,EAAGoM,EAAIrM,IAEvCqL,YAAa,SAAqBV,EAAKgB,EAAMC,EAAIvE,EAAO8D,GACtDR,EAAI4B,YACJ5B,EAAI6B,OAAOb,EAAK1L,EAAG0L,EAAK3L,GACxB2K,EAAI8B,OAAOb,EAAG3L,EAAG2L,EAAG5L,GACpB2K,EAAIlB,SACJkB,EAAI+B,YACJ/B,EAAI4B,YACJ5B,EAAIgC,YAAc,QAClBhC,EAAIE,UAAYxD,EAAQ,EACxBsD,EAAI6B,OAAOb,EAAK1L,EAAG0L,EAAK3L,GACxB2K,EAAI8B,OAAOb,EAAG3L,EAAG2L,EAAG5L,GACpB2K,EAAIlB,SACJkB,EAAI+B,eAGRnN,OAAO+I,MAAQf,MACfhI,OAAOqN,aAAc,EACrBrN,OAAOsN,oBAAqB,EAC5BtN,OAAOuN,SAAW,GAClBvN,OAAOwN,eAAgB,EACvBxN,OAAOyN,oBAAsB9F,MAAMwB,KAAKuE,8BACxC1N,OAAO2N,YAAc,IAAIhG,MAAMM,IAAI2F,KAAK,CACtCzI,MAAO,CACL0I,iBAAkB,CAChB3L,EAAG,yBACH4L,UAAW,gBAEbC,iBAAkB,CAChB7L,EAAG,0BAEL8L,cAAe,CACb9D,OAAQ,YAIdlK,OAAOiO,SAAWxF,gBAAgBhL,OAAO,CACvCqO,YAAa,SAAqBV,EAAKgB,EAAMC,EAAIvE,EAAO8D,GACtD,IAAIsC,EAAapG,EAAQ,EACrBqG,EAAarG,EAGbsG,GAFWzG,MAAM6C,EAAEQ,MAAMoB,GAAMiC,KAAKhC,GAAK8B,EAAa,GAC7CxG,MAAM6C,EAAEQ,MAAMqB,GAAIgC,KAAKjC,GAAO+B,EAAa,GACxC,QAEZ1K,KAAKsF,MAAMC,IAAI,UAAYvF,KAAKsF,MAAMC,IAAI,SAAS,iBACrDoF,EAAY3K,KAAKsF,MAAMC,IAAI,SAAS,eAAe,OAAYvF,KAAKsF,MAAMC,IAAI,SAAS,eAAe,OAAYoF,GAGpHxC,EAAS0C,aAAa,GAAOF,GAC7B,IAAIG,EAAe,UAEf9K,KAAKsF,MAAMC,IAAI,kBACjBuF,EAAe9K,KAAKsF,MAAMC,IAAI,iBAGhC4C,EAAS0C,aAAa,GAAOC,GAC7B3C,EAAS0C,aAAa,GAAOF,GAC7BhD,EAAI4B,YACJ5B,EAAIE,UAAY4C,EAChB9C,EAAIgC,YAAcxB,EAClBR,EAAI6B,OAAOb,EAAK1L,EAAG0L,EAAK3L,GACxB2K,EAAI8B,OAAOb,EAAG3L,EAAG2L,EAAG5L,GACpB2K,EAAIlB,SACJkB,EAAI+B,sBAGDnN,OAAOwO,MAEd,IAAIC,OAAS,SAASA,EAAOC,GAC3BA,EAAOlO,KAAK,iBAAkB,GAC9BkO,EAAOlO,KAAK,WAAY,GACxBkO,EAAOC,WAAW,iBAAkB,GAAI,CACtCC,MAAO,EACPC,SAAU,IACVC,eAAgB,SAAwBvN,GACtC,OAAOA,EAAIA,GAEbwN,cAAe,SAAuBrR,EAAGC,GACvC,OAAO,SAAU4D,GACf,OAAO7D,GAAKC,EAAID,GAAK6D,MAI3BmN,EAAOC,WAAW,uBAAwB,EAAG,CAC3CC,MAAO,EACPC,SAAU,IACVC,eAAgB,SAAwBvN,GACtC,OAAOA,EAAIA,GAEbwN,cAAe,SAAuBrR,EAAGC,GACvC,OAAO,SAAU4D,GACf,OAAO7D,GAAKC,EAAID,GAAK6D,MAI3B7E,QAAQ,WACN+R,EAAOC,IACN,OAGDM,MAAQ,EACRC,QACAC,UAAY,MACZC,GAAK,EAwBMC,GAJf,GAnBAH,QAAU9G,SAAWC,UAOnBtL,WALEqL,SAAWC,UAAYL,SAAWS,WACpCwG,MAAQxG,UAAYJ,UACpBpI,OAAO8H,MAAQU,UAAYyG,QAC3BjP,OAAO6H,OAASW,UAChB2G,IAAMpH,SAAW/H,OAAO8H,OAAS,EACpBM,UAAYI,YAEzBwG,MAAQjH,SAAWI,SACnBnI,OAAO8H,MAAQC,SACf/H,OAAO6H,OAASE,SAAWkH,QACd9G,SAAWJ,UAG1BvK,KAAKyB,WAAWC,SAChB1B,KAAKS,IAAI,QAAS+B,OAAO8H,OACzBtK,KAAKS,IAAI,SAAU+B,OAAO6H,QAEP,EAAf7H,OAAO8H,OAA6B,EAAhB9H,OAAO6H,OAAY,CACzC,IAAIgC,MAAQ,IAAIlC,MAAMM,IAAIoH,MAAMrP,QAEhC,IAAK,IAAIpC,KAAK5B,KAAKwS,MACNY,GAKRpT,KAAKwS,MAAM5Q,GAJK,eAAbwR,GAAKE,OACPF,GAAKjK,MAAMoK,MAAM,cAAgBpS,QAAQwM,OAASyF,GAAKjK,MAAMoK,MAAM,cAAcC,UAAU,IAMjGxH,MAAMyH,SAASzT,MAEXe,OAAO,sBACTA,OAAO,qBAAwBiL,MAAM0H,YAGvCvU,QAAQmI,QAAQ,uBAAwB0E,MAAM0H,YAC9C7F,MAAMlJ,GAAG,iBAAkB,SAAUgP,GAC/BA,EAAS5G,iBAAiBpB,MAAMM,IAAI2H,SACtCC,cAAcF,KAGlB9F,MAAMlJ,GAAG,eAAgB,SAAUmP,EAAKH,EAAUjP,EAAGD,GACnDoP,cAAcF,KAGZ/I,GAAGmJ,SAAS/T,KAAKgU,UACnBxS,KAAK2D,KAAK,OAAOlD,IAAI,mBAAoB,OAASd,QAAQwM,OAAS3N,KAAKgU,QAAU,KAGpFxS,KAAK2D,KAAK,OAAOlD,IAAI,kBAAmB,WACxCT,KAAK2D,KAAK,OAAOlD,IAAI,oBAAqB,aAC1CT,KAAK2D,KAAK,OAAOlD,IAAI,sBAAuB,iBAC5CT,KAAK2D,KAAK,OAAOX,KAAK,KAAMnE,OAC5BmB,KAAK2D,KAAK,aAAaX,KAAK,YAAa,SAAWwO,MAAQ,KAC5DxR,KAAK2D,KAAK,eAAelD,IAAI,UAAW,QACxC,IAAIgS,OAAS,GACTC,MAAQ,GACRC,KAAO,GACPC,MAAQ,GAERtV,SAASuV,WAAWC,OACtBF,MAAQtV,SAASuV,WAAWC,KAAKC,MAAM,MAGzC,IAAIC,QAAUtV,KAAKuV,aAAa,QAC5BC,YAAcN,MAAMA,MAAMtO,OAAS,GACnC6O,MAAQxV,QAAQoN,MAAMqI,OAE1B,IACMD,QACFA,MAAQE,SAASF,MAAMJ,MAAM,MAAM,KAErC,MAAOO,IAIT,IAAIC,KAAO,SAAc3B,GACvB,IAKIzK,EAEAqM,EAPAzU,EAAQZ,EAAEY,QACV0U,EAAY7B,EAAKlS,GACjBgU,EAAQlJ,MAAMmJ,QAAQF,GACtBG,EAAWhC,EAAKE,KAChB+B,EAAUH,EAAMlI,IAAI,UAEpBsI,EAASJ,EAAMlI,IAAI,SAEnBuI,EAAa,gBACb9T,EAASyT,EAAMlI,IAAI,UAiDvB,GA/Cc,SAAVvL,IACFyT,EAAM1Q,KAAK,qBAAsB,QACjC0Q,EAAM1Q,KAAK,qBAAsB,QACjCoG,GAAGC,eAAe,CAAC,+BAAgC,SAAU2K,GAC3D,IAAIlN,EAAMkN,EAAUzK,KAAK1K,QACzBQ,WAAWuS,EAAKlS,IAAMoH,GAClBmN,OAAOrC,EAAK/H,UAChB/C,EAAIqB,SAAS,MAIE,SAAf+K,aAAqC,SAAXF,SACb,KAAXa,IACF1M,EAASiC,GAAG8K,UAAUL,EAASE,EAAY,IAGzC5M,IACFA,EAASkM,SAASlM,KAGU,GAA1BuL,MAAM9N,QAAQuC,IAAiBA,GACjCuL,MAAMyB,KAAKhN,IAEJzJ,KAAKwE,cAC8B,GAAxCwQ,MAAM9N,QAAQlH,KAAKwE,aAAaxC,KAClCgT,MAAMyB,KAAKzW,KAAKwE,aAAaxC,KAG/ByH,EAASzJ,KAAKuV,aAAa,eAEG,GAA1BP,MAAM9N,QAAQuC,IAChBuL,MAAMyB,KAAKhN,IAID,KAAV2M,IACFN,EAAQpK,GAAG8K,UAAUJ,EAAQC,EAAY,IAGvCP,GAAkB,QAATA,IACXA,EAAQH,SAASG,KAGS,GAAxBb,KAAK/N,QAAQ4O,IAAgBrM,GAAmB,QAATqM,GAAmBA,GAC5Db,KAAKwB,KAAKX,GAGI,cAAZI,EAA0B,CAC5B,IAAI/J,EAAW+H,EAAK/H,SAChBnB,EAAOkJ,EAAKlJ,KAEZ9K,GADAmW,EAAa,gBACJ3K,GAAG8K,UAAUtC,EAAKwC,aAAcL,EAAY,IACzDrW,KAAK2W,YAAYzW,EAAQ,SAAU0W,GACjC,GAAIA,EAAM,CACR,IAAIC,EAAYxU,EAAE,eAClBwU,EAAU9T,IAAI,QAASiI,EAAK4B,MAAQkH,MAAQ,MAC5C+C,EAAU9T,IAAI,SAAU,QACxB8T,EAAU9T,IAAI,MAAOoJ,EAAS5G,EAAIuO,MAAQ,MAC1C+C,EAAU9T,IAAI,OAAQoJ,EAAS3G,EAAIsO,MAAQG,GAAK,EAAI,MACpD4C,EAAU9T,IAAI,WAAY,YAC1B8T,EAAU9T,IAAI,mBAAoB,QAClC8T,EAAU9T,IAAI,aAAc,mCAC5B8T,EAAU9T,IAAI,gBAAiB,OAC/BT,KAAK6D,QAAQ0Q,GACb,IAAI/V,EAAOC,KAAKmB,MAAM0U,EAAKtO,SAC3BxH,EAAKgW,OAAShW,EAAKgW,OAAOC,cAAc,SAAU9W,GAEhD,OADS,IAAIO,aAAaP,KAG5B,IAAI6W,EAAShW,EAAKgW,OAIlB,GAHA7W,QAAQ8D,SAAW+S,EAAO/S,SAC1B9D,QAAQ2J,SAAS,SAAUoN,MAEvB9C,EAAK+C,QAKP,GAJA/C,EAAK+C,QAAQC,QAAQ,SAAUC,EAAOlX,GACpC,OAAkB,GAAXA,IAGiB,EAAtBiU,EAAK+C,QAAQrQ,OAAY,CAqC3BhE,kBAAkBwU,iBAbD,SAAoBzQ,GACnC,IAAK,IAAIjE,KAAKiE,EACZ,GAAqB,iBAAVA,EAAIjE,KACqB,GAA9BiE,EAAIjE,GAAGwE,QAAQ,WAAkB,CACnC,IAAImQ,EAAS1Q,EAAIjE,GAAG2S,MAAM,WAAW,GACrC1O,EAAIjE,GAAKiT,SAAS0B,GAKxB,OAAO1Q,EAG0B2Q,CAAWpD,EAAK+C,SApCpC,SAAkBvR,GAC/B,GAAIA,EAAO,CACT,IAAIoE,EAAWpE,EAAMwO,EAAK+C,QAAQ,IAE9BnN,GAcF9G,qBAAqBiS,KAAKsC,aAAazN,EAASE,SAASwN,KAb3C,SAAiB7X,GAC7BmX,EAAOW,eAAe,SAAUT,GAC9B,GAAiB,UAAbA,EAAK5C,KAAkB,CACzB4C,EAAKrX,KAAKmK,SAAW,CAACA,GACtB,IAAImL,EAAO+B,EAAKrX,KAAK+X,IACrBV,EAAKrX,KAAK+X,IAAM/X,EAAKwL,OAAO,SAAUC,GACpC,OAAgC,GAAzB6J,EAAK/N,QAAQkE,EAAIpJ,SAI9BV,YAAYuV,EAAWC,EAAO/S,UAAU,aAuBhDzC,YAAYuV,EAAWC,EAAO/S,UAAU,QAG1CzC,YAAYuV,EAAWC,EAAO/S,UAAU,MAI9C1C,EAAMsW,QAAQ,gBASd,GAPiB,QAAbzD,EAAKE,OACPwD,OAAOrV,OAAO2R,EAAMhR,iBACpBgR,EAAKjK,MAAM,oBAAsB,CAC/B4N,QAAS,SAIT7B,EAAM8B,WAAWrO,OAEnB,GAAIA,EAAQ,CAoCV7G,kBAAkBwU,iBAAiB,CAAC3N,GAnCrB,SAAkB/D,GAC/B,GAAIA,EAAO,CACT,IAAIoE,EAAWpE,EAAM+D,GACrByK,EAAK6D,YAAcjO,EACnBkM,EAAM+B,YAAcjO,EAEpB3J,cAAcsW,KAAKvC,EAAK6D,aAEpBjO,EACY,SAAVvH,GACFyT,EAAMgC,OAAS9D,EAAK8D,OAAS,CAC3BhW,GAAI,QAENX,EAAMsW,QAAQ,YACI7X,MAATgW,GAA+B,KAATA,GAAyB,MAATA,EAS/C9S,qBAAqBiS,KAAKsC,aAAazN,EAASE,SAASwN,KAR3C,SAAiB7X,GAC7BqW,EAAMgC,OAAS9D,EAAK8D,OAASrY,EAAKsG,KAAK,SAAU+Q,GAC/C,OAAOA,EAAKhV,IAAM8T,IAEpB1V,SAASqW,KAAKvC,EAAK8D,QACnB3W,EAAMsW,QAAQ,aAKhBtW,EAAMsW,QAAQ,WAGhBtW,EAAMsW,QAAQ,gBAGhBtW,EAAMsW,QAAQ,kBAMlBtW,EAAMsW,QAAQ,gBAGhBtW,EAAMsW,QAAQ,WAIlB,OAAOtW,EAAM4W,SAGf,IAAK,IAAIvV,KAAK5B,KAAKwS,MACjByB,OAAO0B,KAAKZ,KAAK/U,KAAKwS,MAAM5Q,KAG9BjC,EAAEyX,IAAInD,QAAQyC,KAAK,WACjB,IAAIW,SAAW,GAEXC,gBAAkB,SAASA,gBAAgBzY,MAC7C,IAAIkW,KAAO,SAASA,KAAK3B,KAAMjO,KAAMoS,WACnC,IAAItC,UAAY7B,KAAKlS,GACjBgU,MAAQlJ,MAAMmJ,QAAQF,WAE1B,GAAI7B,KAAK6D,YAAa,CACpB,IAAI1B,WAAa,gBAEjB,GAAmB,SAAfb,aAAqC,SAAXF,QAAoB,CAChD,IAAIa,QAAUH,MAAMlI,IAAI,UACpBrE,OACJA,OAASiC,GAAG8K,UAAUL,QAASE,WAAY,QACtC,GAAIrW,KAAKwE,aACd,IAAIiF,OAASzJ,KAAKwE,aAAaxC,QAE/B,IAAIyH,OAASzJ,KAAKuV,aAAa,cAGjC,IAAIO,MAAQ5B,KAAK9O,MAAM,aAEvB,GAAIa,MAAQoS,UAAW,CACrB,IAAIC,WAAa,SAASA,WAAWrS,MACnC,IAAIsS,SAAW,SAASA,SAASrE,KAAMzL,OACrC,IAAI+P,MAAQtE,KAAK4D,WAAWU,MAExBA,QACFA,MAAQC,KAAKD,QAGf,IAAIE,SAAWjQ,MAAQ+P,MAAM,KAAOA,MAAM,GAAKA,MAAM,IACrDtE,KAAKyE,KAAK,kBAAmB,IAC7BzE,KAAKT,WAAW,aAAc,CAC5Bb,UAAa,iBACbjG,OAAU,GAAK+L,SACd,CACDhF,MAAO,EACPC,SAAU,IACVE,cAAe,SAAuBnC,EAAOE,GAC3C,OAAO,SAAUnK,GACf,IAAIkF,EAAS+E,EAAM,QAAaE,EAAI,OAAYF,EAAM,QAAajK,EAEnE,MAAO,CACLmL,UAAa,gBAAkB,GAAKjG,GAAU,IAC9CA,OAAUA,QAOhBiM,aAAe,SAAsB1E,EAAMzL,EAAOxI,GACxCiU,EAAK4D,WAAWU,MAA5B,IACIxW,EAAKkS,EAAKlS,GACdL,WAAWK,GAAIyI,SAAShC,IAGtBoQ,UAAY,SAAmB3E,EAAME,EAAM0E,EAAOC,EAAOC,GAC3D,IAAIC,EAAU/E,EAAKpG,IAAI,WAEvB,GAAImL,EAAS,CACPF,EAAQ,IAAGA,EAAQ,GACvB7E,EAAK6E,MAAQA,EACb,IAAIG,EAAW,CAACJ,EAAO,UAAW,UAAW,UAAW,WACpDK,EAAY,CAACH,EAAQ,UAAW,UAAW,UAAW,WAE3C,YAAXC,GAAoC,YAAXA,GACvB7E,GAAQ8E,EAASH,IACnB7E,EAAKT,WAAW,SAAWW,EAAO,QAAS8E,EAASH,GAAQ,CAC1DrF,MAAO,IACPC,SAAU,IACVE,cAAepH,MAAMwB,KAAKmL,YAAYC,WAK5B,YAAXJ,GAAoC,YAAXA,IAA0BE,EAAUJ,IAChE7E,EAAKT,WAAW,kBAAmB0F,EAAUJ,GAAQ,CACnDrF,MAAO,IACPC,SAAU,IACVE,cAAepH,MAAMwB,KAAKmL,YAAYC,aAM1CC,YAAc,SAAqBpF,EAAME,EAAM0E,EAAOC,EAAOQ,GAC/D,IAAIN,EAAU/E,EAAKpG,IAAI,WAEnB0L,EAAQ,SAAepM,GACzB,IAAIqM,EAAiBF,EAAe,EAAInM,EAAGsM,QAC3CtM,EAAGqG,WAAW,SAAWW,EAAO,WAAYqF,EAAgB,CAC1D/F,MAAO,EACPC,SAAU,IACVC,eAAgBnH,MAAMwB,KAAK0L,OAAOC,MAClC/F,cAAe,SAAuBrR,EAAGC,GACvC,OAAO,SAAU4D,GACf,IAAIwT,EAAIrX,EAAIC,GAAKgX,EAAiBrY,KAAK0Y,IAAIL,EAAiB,EAAIA,EAAiBpT,IACjF,OAAO0T,OAAOF,EAAEG,QAAQ,SAMhC,GAAIf,EAAS,CACPF,EAAQ,IAAGA,EAAQ,GACvB,IAAIG,EAAW,CAACJ,EAAO,UAAW,UAAW,UAAW,WAMxD,GAJe,YAAXG,IACF7E,EAAO,QAGLA,EASF,GARKF,EAAKwF,UACRxF,EAAKwF,QAAU9B,OAAOqC,UAAU/F,EAAKyE,KAAK,SAAWvE,EAAO,aAAeF,EAAKyE,KAAK,SAAWvE,EAAO,YAAc,GAGvHF,EAAK6E,MAAQA,EACb7E,EAAKyE,KAAK,SAAWvE,EAAO,WAAY,IACxCF,EAAKyE,KAAK,SAAWvE,EAAO,QAAS8E,EAASH,IAE7B,EAAb7E,EAAK6E,MAAW,CAClB,GAAIzK,EAAE4L,SAAShG,EAAKiG,iBAAkB,SAAW/F,EAAO,YAAa,OACrEF,EAAKzO,GAAG,iBAAkB,SAAU2H,EAAIgN,GACvB,EAAXhN,EAAG2L,MACLS,EAAMpM,IAENA,EAAGzJ,IAAI,kBACPyJ,EAAGuL,KAAK,SAAWvE,EAAO,WAAYhH,EAAGsM,YAG7CF,EAAMtF,QAENA,EAAKyE,KAAK,SAAWvE,EAAO,WAAYF,EAAKwF,WAMjDW,YAAc,SAAqBnG,EAAME,EAAM0E,EAAOC,EAAOQ,GAC/D,IAAIN,EAAU/E,EAAKpG,IAAI,WAEnB0L,EAAQ,WACVtF,EAAKyE,KAAK,SAAWvE,EAAO,KAAM,GAClCF,EAAKyE,KAAK,SAAWvE,EAAO,WAAYmF,EAAe,EAAIrF,EAAKwF,SAChExF,EAAKT,WAAW,SAAWW,EAAM,CAC/BkG,EAAKpG,EAAKoG,EACVZ,QAAW,GACV,CACDhG,MAAO,EACPC,SAAU,KACVE,cAAe,SAAuBnC,EAAOE,GAC3C,OAAO,SAAUnK,GACf,MAAO,CACL6S,EAAK5I,EAAM,GAAQE,EAAI,EAAOF,EAAM,GAAQjK,EAC5CiS,QAAWhI,EAAM,QAAaA,EAAM,QAAajK,QAO3D,GAAIwR,EAAS,CACPF,EAAQ,IAAGA,EAAQ,GACvB,IAAIG,EAAW,CAACJ,EAAO,UAAW,UAAW,UAAW,WAMxD,GAJe,YAAXG,IACF7E,EAAO,QAGLA,EAUF,GATKF,EAAKwF,UACRxF,EAAKwF,QAAU9B,OAAOqC,UAAU/F,EAAKyE,KAAK,SAAWvE,EAAO,aAAeF,EAAKyE,KAAK,SAAWvE,EAAO,YAAc,EACrHF,EAAKoG,EAAIpG,EAAKyE,KAAK,SAAWvE,EAAO,MACrCF,EAAKyE,KAAK,SAAWvE,EAAO,WAAYmF,EAAe,EAAIrF,EAAKwF,UAGlExF,EAAK6E,MAAQA,EACb7E,EAAKyE,KAAK,SAAWvE,EAAO,QAAS8E,EAASH,IAE7B,EAAb7E,EAAK6E,MAAW,CAClB,GAAIzK,EAAE4L,SAAShG,EAAKiG,iBAAkB,SAAW/F,GAAO,OACxDF,EAAKzO,GAAG,iBAAkB,SAAU2H,GACnB,EAAXA,EAAG2L,MACLS,KAEAtF,EAAKyE,KAAK,SAAWvE,EAAO,WAAYF,EAAKwF,SAC7CxF,EAAKyE,KAAK,SAAWvE,EAAO,KAAMF,EAAKoG,MAG3Cd,SAEAtF,EAAKyE,KAAK,SAAWvE,EAAO,WAAYF,EAAKwF,SAC7CxF,EAAKyE,KAAK,SAAWvE,EAAO,KAAMF,EAAKoG,KAM3CC,kBAAoB,SAA2BrG,EAAM6E,EAAO3E,GAG9D,GAFKA,IAAMA,EAAO,eAEN,eAARA,EACcF,EAAKpG,IAAI,eAGnBiL,EAAQ,IAAGA,EAAQ,GACL7E,EAAKpG,IAAIsG,GACfoG,QAAQ,SAAU5U,GACxBA,EAAK5D,IAAM+W,IACTnT,EAAK6U,WAAWvG,EAAKyE,KAAK,kBAAmB/S,EAAK6U,WAClD7U,EAAK8U,WAAWxG,EAAKyE,KAAK,yBAA0B1W,QAAQwM,OAAS7I,EAAK8U,oBAI/E,GAAY,eAARtG,EAAuB,CACdF,EAAKpG,IAAIsG,GACfoG,QAAQ,SAAU5U,GAC5BA,EAAK+U,cAAe,EAEhB/U,EAAKgV,WAAa7B,IACpBnT,EAAK+U,cAAe,EAChB/U,EAAKgV,WAAW1G,EAAKyE,KAAK,kBAAmB/S,EAAKgV,WAClDhV,EAAKiV,WAAW3G,EAAKyE,KAAK,yBAA0B1W,QAAQwM,OAAS7I,EAAKiV,gBAMlFC,QAAU,SAAiBzb,GAC7B,IAAI0b,EAAK,GAET,IAAK,IAAIrY,KAAKrD,EAAK,CACjB0b,EAAK1b,EAAIqD,GACT,MAGF,OAAOqY,EAAGC,MAGRC,QAAU,SAAiB7G,GAC7B,MAAY,cAARA,EACK,OACU,gBAARA,EACF,cADF,GAKL8G,YAAc,SAAqB7b,GACrC,OAAOA,EAAI,KAAQ,MAGjB8b,mBAAqB,SAA4Bxb,GACnD,IA4BiC+D,EA5B7BnB,EAASyT,MAAMlI,IAAI,UAEvB,GAAc,SAAVvL,GAAqB8V,UACvBkC,kBAAkBvE,MAAOqC,UAAU5P,YAC9B,GAAc,SAAVlG,GAAqB0D,KAC9BsU,kBAAkBvE,MAAO/P,KAAKwC,MAAO,oBAChC,GAAc,SAAVlG,GAAqB0D,KAC9BsS,SAASvC,MAAO/P,KAAKwC,YAChB,GAAc,SAAVlG,GAAqB0D,KAC9B2S,aAAa5C,MAAO/P,KAAKwC,MAAOyL,UAC3B,CACL,GAAImE,UAAW,CACb,IAAI+C,EAAYlH,KAAK,UAEJ,YAAbkH,EACF9B,YAAYtD,MAAOiF,QAAQ/G,KAAK,MAAU4G,QAAQ5G,KAAK,OAAWmE,UAAU5P,OAAO,GAC7D,YAAb2S,EACTf,YAAYrE,MAAOiF,QAAQ/G,KAAK,MAAU4G,QAAQ5G,KAAK,OAAWmE,UAAU5P,OAAO,GAC7D,YAAb2S,EACT9B,YAAYtD,MAAOiF,QAAQ/G,KAAK,MAAU4G,QAAQ5G,KAAK,OAAWmE,UAAU5P,OAAO,GAC7D,YAAb2S,EACTf,YAAYrE,MAAOiF,QAAQ/G,KAAK,MAAU4G,QAAQ5G,KAAK,OAAWmE,UAAU5P,OAAO,GAEnFoQ,UAAU7C,MAAOiF,QAAQ/G,KAAK,MAAU4G,QAAQ5G,KAAK,OAAWmE,UAAU5P,MAAOyS,YAAYhH,KAAK,QAItG,GAAIjO,KAAM,CACR,IAiBIoV,EAAW1b,EAjBc+D,EAkBtB,SAAUsU,GACf,IASIsD,EATA1S,EAAOyS,EAASpV,KAAK,SAAU+Q,GACjC,OAAI9C,KAAK8D,OAAehB,EAAKuE,UAAYrH,KAAK8D,OAAOpP,KAAiB,KAEpE4S,GAAW,EAEXxF,MAAMlI,IAAI,cACZ0N,EAAwD,GAA7CxF,MAAMlI,IAAI,YAAYuH,MAAM,WAAW,IAKhDnB,KAAK6D,YAAY/N,UACnBsR,EAAW1Y,kBAAkBwC,MAAM,iBAAmB8O,KAAK6D,YAAY/N,QAAU,WAAa/D,KAAKwV,QAAU,aAC7GxV,KAAKwC,MAAQ6S,EAAWA,EAASrV,KAAKwC,OAASxC,KAAKwC,OAGtD,IAAIlD,EAAIyQ,MAAM8B,WAAW3L,SAAS5G,EAE9BqD,GAAQ4S,EACVxF,MAAM2C,KAAK,kBAAmB1S,KAAKwC,MAAQ,GAAKG,EAAK8S,UAErD1F,MAAM2C,KAAK,kBAAmB1S,KAAKwC,OAGrCuN,MAAM2C,KAAK,aAAcpT,IA1CrB2O,KAAK8D,OACPtU,EAASwQ,KAAK8D,QAEdxE,OAAO3J,gBAAgBJ,OAAQ,SAAUkS,GACvC,IAAI3R,EAAU2R,EAAI3R,QAClBwJ,OAAOoI,iBAAiB5R,EAAS,SAAUiL,GACzC,IAAIyC,EAAMzC,EAAKhP,KAAK,SAAUyR,GAC5B,MAAO,UAAYA,EAAI1V,IAAMkS,KAAK4B,QAEpC5B,KAAK8D,OAASN,EACdhU,EAASwQ,KAAK8D,eAsCxBnU,MAAQ,SAAegY,GACzB7F,MAAM2C,KAAK,kBAAmB1S,KAAKwC,QAGrCzF,qBAAqB8Y,MAAMC,SAASvE,KAAK2D,mBAAoBtX,QAG/DyU,WAAWrS,SAKjBtG,KAAK6a,QAAQ,SAAUwB,GACK,QAAtBA,EAAWP,QAETtD,SAAS6D,EAAWvS,QAEtB0O,SAAS6D,EAAWvS,QAAQ+Q,QAAQ,SAAUtG,GAC5C,GAAIA,EAAK6E,OAASiD,EAAWvT,MAAO,CAClC,IAAIwT,GAAa,EAgBjB,GAdI/H,EAAK,OAA6B,YAAjBA,EAAK,MACpB8H,EAAWzR,SACT,UAAYyR,EAAWzR,UAAY2J,EAAK,QAC1C+H,GAAa,GAGfA,GAAa,EAGXD,EAAWzR,WACb0R,GAAa,IAIZA,EAAY,OACjBpG,KAAK3B,EAAM,KAAM8H,MAIrBlb,KAAKwS,MAAMkH,QAAQ,SAAUtG,GAC3B,GAAIA,EAAK,OAAW,CAClB,IAAIgI,EAAYhI,EAAK,OAAUmB,MAAM,KAErC,GAAuB,EAAnB6G,EAAUtV,QAAcsV,EAAUA,EAAUtV,OAAS,IAAMoV,EAAWvS,OAAQ,CAC3E0O,SAAS6D,EAAWvS,UAAS0O,SAAS6D,EAAWvS,QAAU,IAChE0O,SAAS6D,EAAWvS,QAAQgN,KAAKvC,GACjC,IAAI+H,GAAa,EAgBjB,GAdI/H,EAAK,OAA6B,YAAjBA,EAAK,MACpB8H,EAAWzR,SACT,UAAYyR,EAAWzR,UAAY2J,EAAK,QAC1C+H,GAAa,GAGfA,GAAa,EAGXD,EAAWzR,WACb0R,GAAa,IAIZA,EAAY,OACjBpG,KAAK3B,EAAM,KAAM8H,OAMrB7D,SAAS6D,EAAWvS,OAAS,IAAMuS,EAAWP,SAChDtD,SAAS6D,EAAWvS,OAAS,IAAMuS,EAAWP,SAASjB,QAAQ,SAAU2B,GACvEtG,KAAKsG,EAASH,EAAY,QAG5BlP,MAAM0H,WAAWgG,QAAQ,SAAUtG,GAEjC,GAAIA,EAAK9O,MAAM,mBAAqB4W,EAAWvS,SACzCyK,EAAK,OAAYA,EAAK9O,MAAM,cAAc,CAC5C,GAAI8O,EAAK,MACP,IAAIkI,EAAWlI,EAAK,MAASmB,MAAM,KAGrC,GAAInB,EAAK9O,MAAM,aACTgX,EAAW,CAAClI,EAAK9O,MAAM,cAGP,EAAlBgX,EAASxV,QAAcwV,EAASA,EAASxV,OAAS,IAAMoV,EAAWP,UACP3b,MAA1DqY,SAAS6D,EAAWvS,OAAS,IAAMuS,EAAWP,WAChDtD,SAAS6D,EAAWvS,OAAS,IAAMuS,EAAWP,SAAW,IAG3DtD,SAAS6D,EAAWvS,OAAS,IAAMuS,EAAWP,SAAShF,KAAKvC,GAC5D2B,KAAK3B,EAAM8H,EAAY,aAWvC/Y,eAAeoZ,mBAAmBrH,MAAO,CAAC,QAAS,SAAUsH,GACrC,GAAlBA,EAAUC,MACZnE,gBAAgBkE,EAAU3c,QAE3B,GAEHsD,eAAeoZ,mBAAmBrH,MAAOC,KAAM,SAAUqH,GACjC,GAAlBA,EAAUC,MACZnE,gBAAgBkE,EAAU3c,QAI9BsV,KAAKwB,KAAK,QACV,IAAI+F,YAAc,CAChBC,KAAMzH,MAAM0H,WACZhF,IAAKzC,KAAKyH,YAEZ7c,KAAOuB,KAAKvB,OACZ,IAAI8c,UAAY,WAChBhc,SAASic,SAAS/c,KAAM8c,UAAW,SAAUjX,GAC3C0S,gBAAgB,CAAC1S,EAAM/F,SAEzBgB,SAASkc,KAAKhd,KAAM8c,UAAW,MAAOH,aAElC3a,OAAO,oBACTA,OAAO,mBAAsBiL,MAAM0H,YAGrCvU,QAAQmI,QAAQ,qBAAsB0E,MAAM0H,cAE9CnS,EAAE,qBAAqBiD,KAAK,UAAW,QACvCjD,EAAE,uBAAuBiD,KAAK,UAAW,QACzCjD,EAAE,gBAAgBiD,KAAK,UAAW,QAMlCjD,EAAE,eAAeoD,GAAG,YAAa,WAC/B9E,SAASmc,WAAWjd,YAM5B6L,GAAGC,eAAe,CAAC,eAAgB,SAAU,YAAajI,eAE1DpB,KAAKsB,OAAOK,UAIZqI,WACFxL,KAAOwL,UACPE,IAAI1L,OAEJd,KAAK2W,YAAYzW,OAAQ,SAAU0W,GACjC9V,KAAOC,KAAKmB,MAAM0U,EAAKtO,SACvBkE,IAAI1L,gBAKHb,QAAQD,KACfoC,KAAKW,IAAI,QAAS,QAClBX,KAAKW,IAAI,sBAAuB,OAChCX,KAAKW,IAAI,kBAAmB,WAC5BjB,WAAaA,YAA0B,GACvC,IAAIib,UAAYjb,WAAWsD,MAAM,WAC7B4X,WAAalb,WAAWsD,MAAM,YAC9B6X,gBAAkBnb,WAAWsD,MAAM,iBAMvC,GAJInF,QAAQoN,OACVjL,KAAKW,IAAI9C,QAAQoN,OAGK,mBAAb0P,UACT,IACE3a,KAAK8a,WAAaH,UAAU,CAC1BvJ,OAAQxT,KACRA,KAAMA,KACNU,OAAQA,OACRyc,MAAOvd,UACN,WACDyB,MAAMsW,QAAQ,eACbtW,MAAMW,IACT,MAAO4T,GACPwH,QAAQvZ,MAAM+R,QAGhB5V,KAAKqM,OAAOvL,MAGdsB,KAAKqD,GAAG,QAAS,SAAUC,GACzB,GAA8B,mBAAnBuX,gBACT,IACEA,gBAAgB,CACdzJ,OAAQxT,KACRU,OAAQA,SAEV,MAAOkV,GACPwH,QAAQvZ,MAAM+R,MAMtB,OA3lDA3T,QAAQwM,OAASxM,QAAQwM,OAAS,IAClC/C,GAAG/I,cAAc1C,QAAQmF,MAAM,sBAAuB,SAAUiY,GAC9D,GAAmB,KAAfA,EAAOd,KAAa,CACtB,IAAIe,EAAWD,EAAO1d,KACtBmC,WAAawb,EAKf3a,cAAcb,cAklDTM","file":"toolkit/component/topo.bak.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var elemData = data;\n\n    if (elemData == undefined) {\n      throw new Error(\"undefined\");\n    }\n\n    var uuid;\n    var self = elemData.element;\n    var viewId = self.viewId;\n    var all_resources = [];\n    var all_kpis = [];\n    var viewFlexService = elemData.viewFlexService;\n    var serviceProxy = elemData.serviceProxy;\n    var userLoginUIService = elemData.userLoginUIService;\n    var element = elemData.element;\n    var commonMethod = element.constructor;\n    var q = elemData.q;\n    var global = elemData.global;\n    var SwSocket = elemData.SwSocket;\n    var parentheight, parentwidth;\n    var json = element.JSON;\n    var taDom;\n    var completeCallback = data.complete;\n    var svgId = \"svg_\" + Math.uuid();\n    var defer = elemData.defer;\n    var traverseRow = elemData.traverseRow;\n    var traverseCol = elemData.traverseCol;\n    var timeout = elemData.timeout;\n    var route = elemData.route;\n    var previewMode = elemData.previewMode;\n    var openAngles = {};\n    var persentage = 0;\n    var events = {};\n    var expression;\n    var mm = defer.id;\n    var factory = JSON.parse(JSON.stringify(serviceProxy));\n    var topo = $(\"<div></div>\");\n    var wrap = $(\"<div></div>\");\n    factory.origin = factory.origin + \"/\";\n    $$.runExpression(element.$attr(\"advance/expression\"), function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n        expression = fnResult;\n      } else {\n        ;\n      }\n\n      runExpression(expression);\n    });\n\n    function extend(a, b) {\n      for (var i in b) {\n        a[i] = b[i];\n      }\n\n      return a;\n    }\n\n    function runExpression(expression) {\n      var resourceUIService = elemData.resourceUIService;\n      var max_height, max_width;\n      topo.css(\"position\", \"relative\");\n      var resourceUIService = elemData.resourceUIService;\n      var serviceCenterService = elemData.serviceCenterService;\n      var kpiDataService = elemData.kpiDataService;\n      var displayModeLink = {\n        \"arrowheadMarkup\": \"<g></g>\",\n        \"toolMarkup\": \"<g></g>\",\n        \"vertexMarkup\": \"<g></g>\"\n      };\n\n      if (typeof element.setSelfDom == \"function\") {\n        element.setSelfDom(topo);\n      }\n\n      element.$on = function (eventName, callback) {\n        events[eventName] = callback;\n      };\n\n      element.off(\"$loadCiKpiComplete\");\n      element.off(\"$renderGraphComplete\");\n      topo.append(wrap);\n\n      self.error = function (str) {\n        wrap.children().remove();\n        var warning = $(\"<p>\" + str + \"</p>\");\n        warning.css({\n          \"font-size\": \"12px\",\n          \"min-height\": \"300px\",\n          \"text-align\": \"center\",\n          \"line-height\": \"300px\"\n        });\n        wrap.append(warning);\n      };\n\n      self.setResources = function (resources) {\n        self.composoryRes = resources;\n        Object.defineProperty(self, \"composoryRes\", {\n          enumerable: false\n        });\n      };\n\n      self.createDeviceDropList = function (data, pos, config) {\n        var p = persentage || 1;\n        var hitArea = $(\"<div></div>\");\n        var titleArea = $(\"<div></div>\");\n        var popup = $(\"<div></div>\");\n        var config = config || {};\n        var clickFn = config.$attr(\"click\");\n        var titleClickFn = config.$attr(\"titleClick\");\n        $(\"#devicelistscroll\").remove();\n        hitArea.attr(\"id\", \"devicelistscroll\");\n        titleArea.css(\"width\", \"100%\");\n        titleArea.css(\"height\", \"50px\");\n        hitArea.css(\"position\", \"absolute\");\n        hitArea.css(\"z-index\", 199);\n        popup.css(\"padding\", \"2px\");\n        popup.css(\"background-color\", \"#1e415d\");\n        popup.css(\"border\", \"1px solid #000\");\n        popup.css(\"box-shadow\", \"1px 1px 10px 1px rgba(0,0,0,.5)\");\n        popup.css(\"max-height\", \"150px\");\n        popup.css(\"overflow-x\", \"hidden\");\n        popup.css(\"overflow-y\", \"auto\");\n        hitArea.css(\"cursor\", \"pointer\");\n        hitArea.css(\"top\", pos.y / p - (config.y || 30) + \"px\");\n        hitArea.css(\"left\", pos.x / p - (config.x || 50) + \"px\");\n        hitArea.css(\"background-color\", \"rgba(0,0,0,0)\");\n        hitArea.on(\"mouseleave\", function (event) {\n          $(\"#devicelistscroll\").remove();\n        });\n        titleArea.on(\"click\", function (event) {\n          titleClickFn();\n        });\n\n        var createDom = function createDom(item) {\n          var wrap = $(\"<div></div>\");\n          var label = $(\"<span></span>\");\n          var status = $(\"<div></div>\");\n          wrap.attr(\"id\", \"wrap\");\n          status.css(\"margin-right\", \"5px\");\n          status.css(\"width\", \"10px\");\n          status.css(\"height\", \"10px\");\n          status.css(\"border-radius\", \"50%\");\n          status.css(\"background-color\", self.getAlertColor(item.status));\n          status.css(\"display\", \"inline-block\");\n          wrap.css(\"padding\", \"5px 15px\");\n          label.text(item.label);\n          label.css(\"padding-right\", \"10px\");\n          wrap.append(status);\n          wrap.append(label);\n          wrap.on(\"mouseenter\", function (event) {\n            hitArea.find(\"#wrap\").css(\"background-color\", \"rgba(0,0,0,0)\");\n            wrap.css(\"background-color\", \"rgba(0,0,0,.3)\");\n          });\n          wrap.on(\"mouseleave\", function (event) {\n            wrap.css(\"background-color\", \"rgba(0,0,0,0)\");\n          });\n          wrap.on(\"click\", function (event) {\n            clickFn(item);\n          });\n          item.$on(\"statusChanged\", function (node) {\n            status.css(\"background-color\", self.getAlertColor(item.status));\n          });\n          return wrap;\n        };\n\n        for (var i in data) {\n          popup.append(createDom(data[i]));\n        }\n\n        hitArea.append(titleArea);\n        hitArea.append(popup);\n        topo.prepend(hitArea);\n      }; //150 - 235\n\n\n      self.createAttrDisp = function (t, data, pos, callback, planeMode) {\n        var popup, body, title, wrap;\n        var orderKey = [\"速度有效值\", \"冲击平均值\", '震动', '冲击', '速度', '温度', '电压', '电流'];\n\n        function findIndex(arr, callback) {\n          var i, find;\n\n          for (i = 0; i < arr.length; i++) {\n            find = callback(arr[i], i);\n\n            if (find) {\n              return i;\n            }\n          }\n        }\n\n        function attrDisp() {\n          popup = $(\"<div></div>\");\n          body = $(\"<div></div>\");\n          title = $(\"<div></div>\");\n          wrap = $(\"<table></table>\");\n          popup.css(\"position\", \"absolute\");\n          popup.css(\"padding\", \"2px\");\n          popup.css(\"background-color\", \"rgba(30,65,93,.9)\");\n          popup.css(\"border\", \"1px solid #000\");\n          popup.css(\"box-shadow\", \"1px 1px 10px 1px rgba(0,0,0,.5)\");\n          popup.css(\"z-index\", 99);\n\n          if (planeMode) {\n            body.css(\"max-height\", \"300px\");\n            body.css(\"min-width\", \"380px\");\n          } else {\n            data.sort(function (a, b) {\n              ka = findIndex(orderKey, function (d) {\n                return (a.kpiName || a.label).indexOf(d) != -1;\n              }) || a.label;\n              kb = findIndex(orderKey, function (d) {\n                return (b.kpiName || b.label).indexOf(d) != -1;\n              }) || b.label;\n              return ka < kb ? -1 : 1;\n            });\n            body.css(\"max-height\", \"50px\");\n          }\n\n          body.css(\"overflow-y\", \"auto\");\n          body.css(\"overflow\", \"auto\");\n          title.css(\"text-align\", \"center\");\n          title.css(\"font-weight\", \"bold\");\n          title.css(\"padding\", \"3px\");\n          title.css(\"color\", \"#fff\");\n          title.css(\"background-color\", \"#295375\");\n          title.text(t);\n          popup.css(\"top\", pos.y + \"px\");\n          popup.css(\"left\", pos.x + \"px\");\n          popup.append(title);\n\n          var createDom = function createDom(item) {\n            var tr = $(\"<tr></tr>\");\n            var td1 = $(\"<td></td>\");\n            var td2 = $(\"<td></td>\");\n            var td3 = $(\"<td></td>\");\n            var td4 = $(\"<td></td>\");\n            var time = useMomentFormat(item.arisingTime, \"yyyy-MM-dd hh:mm:ss\");\n            td1.css(\"padding\", \"5px 6px 1px 6px\");\n            td2.css(\"padding\", \"5px 6px 1px 6px\");\n            td3.css(\"padding\", \"5px 6px 1px 6px\");\n            td4.css(\"padding\", \"5px 6px 1px 6px\");\n            td1.css(\"vertical-align\", \"middle\");\n            td2.css(\"vertical-align\", \"middle\");\n            td3.css(\"vertical-align\", \"middle\");\n            td4.css(\"vertical-align\", \"middle\");\n            var label = $(\"<span></span>\");\n            var button = $('<button id=\"button\" rel=\"popover\" ></button>');\n\n            if (!planeMode) {\n              button.popover({\n                placement: \"right\",\n                trigger: \"manual\",\n                title: \"上报时间\",\n                container: \"body\",\n                content: function content() {\n                  return time;\n                }\n              }).on(\"mouseenter\", mouseenter).on(\"mouseleave\", mouseleave);\n              label.text(item.label);\n              td1.append(label);\n            } else {\n              var span1 = $(\"<span>\" + item.devName + \"</span>\");\n              var span2 = $(\"<span>\" + item.message + \"</span>\");\n              var span3 = $(\"<span>\" + useMomentFormat(item.arisingTime, \"yyyy-MM-dd hh:mm:ss\") + \"</span>\");\n              span1.css(\"white-space\", \"normal\");\n              span2.css(\"white-space\", \"normal\");\n              span3.css(\"white-space\", \"normal\");\n              span1.css(\"display\", \"inline-block\");\n              span2.css(\"display\", \"inline-block\");\n              span3.css(\"display\", \"inline-block\");\n              span1.css(\"max-width\", \"100px\");\n              span2.css(\"max-width\", \"220px\");\n              td1.append(span1);\n              td3.append(span2);\n              td4.append(span3);\n            }\n\n            if (item.valueStr) {\n              button.text(item.valueStr);\n            } else if (item.value != \"-\") {\n              button.text(self.toFix(item.value, 2));\n            } else {\n              button.text(\"-\");\n            }\n\n            function mouseenter() {\n              if (t) {\n                $(this).popover(\"show\");\n              }\n            }\n\n            function mouseleave() {\n              $(this).popover(\"hide\");\n            } //button.popover(\"hide\");\n\n\n            label.css(\"color\", \"#aaa\");\n            label.css(\"padding-right\", \"10px\");\n\n            item.updateValue = function (value, unit) {\n              //;\n              var val = typeof value !== \"undefined\" && value !== null ? value : \"-\";\n              val = typeof val == \"number\" ? self.toFix(val, 2) : val;\n\n              if (unit != \"NA\" && unit) {\n                val += unit;\n              }\n\n              button.text(val);\n              this.value = value;\n            };\n\n            item.updateStatus = function (value) {\n              this.status = value;\n              button.css(\"background-color\", self.getAlertColor(value));\n            };\n\n            item.updateTime = function (t) {\n              if (t) {\n                time = useMomentFormat(t, \"yyyy-MM-dd hh:mm:ss\"); //button.popover(\"show\");\n              }\n            };\n\n            button.css(\"min-width\", \"50px\");\n            button.css(\"text-align\", \"center\");\n            button.css(\"line-height\", \"12px\");\n            button.css(\"border\", 0);\n            button.css(\"color\", \"#fff\");\n            button.css(\"border-radius\", \"10px\");\n            button.css(\"background-color\", self.getAlertColor(item.status));\n            button.on(\"click\", function (event) {\n              $(this).popover(\"destroy\");\n\n              if (callback) {\n                callback(item);\n              }\n            });\n\n            if (item.label) {\n              tr.append(td1);\n            }\n\n            if (planeMode) {\n              tr.append(td3);\n              tr.append(td4);\n            }\n\n            tr.append(td2);\n            td2.append(button);\n            return tr;\n          };\n\n          for (var i in data) {\n            wrap.append(createDom(data[i]));\n          }\n\n          body.append(wrap);\n          popup.append(body);\n          topo.append(popup);\n        }\n\n        attrDisp.prototype.destroy = function () {\n          popup.remove();\n        };\n\n        attrDisp.prototype.getData = function () {\n          return data;\n        };\n\n        return new attrDisp();\n      };\n\n      var itemins;\n\n      self.createCurrentStatus = function (txt, pos, status) {\n        var wrap = topo.find(\"div#cStatus\");\n        var title = $(\"<div></div>\");\n        var addOn = $(\"<div></div>\");\n        var circle = $(\"<div></div>\");\n        var ins;\n        wrap = wrap.size() ? wrap : $(\"<div id=\\\"cStatus\\\"></div>\");\n        wrap.children().remove();\n\n        function wholeClick() {\n          $(\"body\").off(\"click\");\n          ins.destroy();\n\n          if (itemins) {\n            itemins.destroy();\n          }\n        }\n\n        function clickFn(event) {\n          var p = persentage || 1;\n          var data = self.getValue(\"device/alerts\");\n\n          if (ins) {\n            ins.destroy();\n          }\n\n          $(\"body\").off(\"click\");\n\n          if (data) {\n            if (data.length > 0) {\n              ins = self.createAttrDisp(\"告警信息\", data, {\n                x: pos.x / p - 200,\n                y: pos.y / p + 15\n              }, function (item) {\n                var nodeId = item.nodeId;\n                var resource;\n                var ROLE = self.getValue(\"global/ROLE\");\n                self.getDomainAreaLineTree_alertStatus(function (domaintree) {\n                  domaintree.traverse(function (node) {\n                    if (node.id == nodeId) {\n                      self.getResourceById(node.id, function (resource) {\n                        self.getAttrsByModelId(resource.modelId, function (attrs) {\n                          extend(node, resource);\n                          var sub,\n                              accessConfigs = node.physicalConfig.accessConfigs || {},\n                              sensor = accessConfigs.find(function (n) {\n                            return n.instance === item.instance;\n                          }) || null;\n                          self.setParameter(\"id\", node.id);\n                          self.setValue(\"global/alertTime\", item.arisingTime);\n                          self.setValue(\"global/resource\", node);\n                          self.setValue(\"global/sensor\", sensor);\n                          self.setValue(\"global/instance\", item.instance);\n                          self.setParameter(\"sensorId\", sensor.dataItemId);\n\n                          if (item.specialty == \"Z\") {\n                            sub = 0;\n                          } else if (item.specialty == \"D\") {\n                            sub = 1;\n                          } else {\n                            sub = 7;\n                          }\n\n                          self.navigateToTab(\"analysis\", sub, 1);\n                        });\n                      });\n                    }\n                  });\n                });\n              }, true);\n              setTimeout(function () {\n                $(\"body\").on(\"click\", wholeClick);\n              });\n            } else {\n              self.growl(\"暂无未处理的告警信息！\");\n            }\n          }\n        }\n\n        function currentStatus() {\n          wrap.css(\"position\", \"absolute\");\n          var p = persentage || 1;\n          wrap.css(\"cursor\", \"pointer\");\n          wrap.css(\"top\", pos.y / p + \"px\");\n          wrap.css(\"left\", pos.x / p + \"px\");\n          title.text(txt);\n          title.css(\"padding-right\", \"6px\");\n          title.css(\"font-weight\", \"bold\");\n          title.css(\"line-height\", \"14px\");\n          title.css(\"display\", \"inline-block\");\n          title.css(\"color\", \"#fff\");\n          addOn.css(\"display\", \"inline-block\");\n          circle.css(\"display\", \"block\");\n          circle.css(\"position\", \"absolute\");\n          circle.css(\"top\", \"1px\");\n          circle.css(\"width\", \"14px\");\n          circle.css(\"height\", \"14px\");\n          circle.css(\"border-radius\", \"50%\");\n          circle.css(\"background-color\", self.getAlertColor(status));\n          circle.css(\"box-shadow\", \"1px 1px 10px 1px rgba(0,0,0,1)\");\n\n          if (status > 0) {\n            title.css(\"text-decoration\", \"underline\");\n            wrap.off(\"click\");\n            wrap.on(\"click\", clickFn);\n          }\n\n          addOn.append(circle);\n          wrap.append(title);\n          wrap.append(addOn);\n          topo.append(wrap);\n        }\n\n        currentStatus.prototype.setAlarmStatus = function (status) {\n          circle.css(\"background-color\", self.getAlertColor(status));\n\n          if (status > 0) {\n            title.css(\"text-decoration\", \"underline\");\n            wrap.off(\"click\");\n            wrap.on(\"click\", clickFn);\n          }\n        };\n\n        return new currentStatus();\n      };\n\n      self.createCurrentStatusByItem = function (id, pos) {\n        function wholeClick() {\n          $(\"body\").off(\"click\");\n          if (itemins) itemins.destroy();\n        }\n\n        function clickFn(event) {\n          var p = persentage || 1;\n          var data = self.getValue(\"device/alerts\");\n\n          if (itemins) {\n            itemins.destroy();\n          }\n\n          data = data.filter(function (elm) {\n            return elm.nodeId == id;\n          });\n          $(\"body\").off(\"click\");\n\n          if (data.length > 0) {\n            itemins = self.createAttrDisp(\"告警信息\", data, {\n              x: pos.x / p,\n              y: pos.y / p\n            }, function (item) {\n              var nodeId = item.nodeId;\n              var resource;\n              var ROLE = self.getValue(\"global/ROLE\");\n              self.getDomainAreaLineTree_alertStatus(function (domaintree) {\n                domaintree.traverse(function (node) {\n                  var sub;\n\n                  if (node.id == nodeId) {\n                    self.setValue(\"global/resource\", node);\n                    self.setValue(\"global/instance\", item.instance);\n                    self.setValue(\"global/sensor\", item);\n                    self.setValue(\"global/alertTime\", item.arisingTime);\n                    self.setParameter(\"sensorId\", item.id);\n\n                    if (node.specialty == \"Z\") {\n                      sub = 0;\n                    } else if (node.specialty == \"D\") {\n                      sub = 1;\n                    } else {\n                      sub = 7;\n                    }\n\n                    if (ROLE == 1) {\n                      self.navigateTo(\"index\", {\n                        main: 2,\n                        sub: sub,\n                        backHistory: 1\n                      }, \"self\");\n                    } else if (ROLE == 2) {\n                      self.navigateTo(\"index\", {\n                        main: 2,\n                        sub: sub,\n                        backHistory: 1\n                      }, \"self\");\n                    } else if (ROLE == 3) {\n                      self.navigateTo(\"index\", {\n                        main: 2,\n                        sub: sub,\n                        backHistory: 1\n                      }, \"self\");\n                    } else {\n                      self.growl(\"此角色无法显示特征曲线\");\n                    }\n                  }\n                });\n              });\n            }, true);\n            setTimeout(function () {\n              $(\"body\").on(\"click\", wholeClick);\n            });\n          } else {\n            self.growl(\"此设备暂无未处理的告警信息！\");\n          }\n        }\n\n        clickFn();\n      };\n\n      self.createMarker = function (title, callback) {\n        $$.loadExternalJs([\"toolkit/configure/marker\"], function (threeDbar) {\n          var ins = threeDbar.init(svgId, {\n            title: title\n          });\n          callback(ins);\n        });\n      };\n\n      self.createAlarm = function (title, callback) {\n        $$.loadExternalJs([\"toolkit/configure/alarm\"], function (threeDbar) {\n          var ins = threeDbar.init(svgId, {\n            title: title\n          });\n          callback(ins);\n        });\n      };\n\n      self.createAlarmSmall = function (title, callback) {\n        $$.loadExternalJs(['toolkit/configure/alarm'], function (threeDbar) {\n          var ins = threeDbar.init(svgId, {\n            title: title,\n            smallMode: true\n          });\n          callback(ins);\n        });\n      };\n\n      self.create3Dbar = function (title, callback) {\n        $$.loadExternalJs(['toolkit/configure/3dbarchart'], function (threeDbar) {\n          var ins = threeDbar.init(svgId, {\n            title: title\n          }); //ins.setPos(cell.position());\n          //ins.setValue(0);\n\n          callback(ins);\n        });\n      }; //获得缩放的点位\n\n\n      self.getPersentageSite = function (position) {\n        var p = persentage || 1;\n        var tempPosition = {\n          x: 0,\n          y: 0\n        };\n        tempPosition.x = position.x / p;\n        tempPosition.y = position.y / p;\n        return tempPosition;\n      };\n\n      self.render = function (inputJson, cb_fun) {\n        var run = function run(json) {\n          if (_typeof(json) == \"object\" && json != null) {\n            var callback = function callback(joint) {\n              timeout(function () {\n                parentheight = topo.parent().height();\n                parentwidth = topo.parent().width();\n                var domwidth = topo.width();\n                var graph = new joint.dia.Graph();\n                var oldwidth = json.width;\n                var oldheight = json.height;\n                var config = json.$clone();\n                wrap.children().remove();\n                config.el = wrap[0];\n\n                if (!element.style.height) {\n                  topo.css(\"height\", domwidth * oldheight / oldwidth + \"px\");\n                }\n\n                var domheight = topo.height();\n                var PatternLinkView = joint.dia.LinkView.extend({\n                  patternMarkup: ['<pattern id=\"pattern-<%= id %>\" patternUnits=\"userSpaceOnUse\">', '<image xlink:href=\"\"/>', '</pattern>'].join(''),\n                  render: function render() {\n                    joint.dia.LinkView.prototype.render.apply(this, arguments);\n\n                    if (this.model && !this.model.get(\"pattern\")) {\n                      return;\n                    }\n\n                    this.listenTo(this.model, \"change:pattern change:patternColor\", this.update);\n                    return this;\n                  },\n                  remove: function remove() {\n                    joint.util.cancelFrame(this.frameId);\n                    joint.dia.LinkView.prototype.remove.apply(this, arguments);\n\n                    if (this.pattern) {\n                      this.pattern.remove();\n                      this.pattern = null;\n                    }\n                  },\n                  update: function update() {\n                    joint.dia.LinkView.prototype.update.apply(this, arguments);\n\n                    if (this.model && !this.model.get(\"pattern\")) {\n                      return;\n                    }\n\n                    if (!this.pattern) {\n                      this.pattern = joint.V(_.template(this.patternMarkup)({\n                        id: this.id\n                      }));\n                      this.patternImage = factory.origin + this.pattern.findOne(\"image\");\n                      joint.V(this.paper.svg).defs().append(this.pattern);\n                    }\n\n                    this._V.connection.attr({\n                      \"stroke\": \"url(#pattern-\" + this.id + \")\"\n                    });\n\n                    this.strokeWidth = this._V.connection.attr(\"stroke-width\") || 1;\n                    joint.util.cancelFrame(this.frameId);\n                    this.frameId = joint.util.nextFrame(_.bind(this.fillWithPattern, this));\n                    return this;\n                  },\n                  fillWithPattern: function fillWithPattern() {\n                    var strokeWidth = this.strokeWidth;\n                    var bbox = joint.g.rect(joint.V(this.el).bbox(true)).moveAndExpand({\n                      x: -strokeWidth,\n                      y: -strokeWidth,\n                      width: 2 * strokeWidth,\n                      height: 2 * strokeWidth\n                    });\n                    var points = [].concat(this.sourcePoint, this.route, this.targetPoint);\n                    points = _.map(points, function (point) {\n                      return joint.g.point(point.x - bbox.x, point.y - bbox.y);\n                    });\n                    var canvas = document.createElement(\"canvas\");\n                    canvas.width = bbox.width;\n                    canvas.height = bbox.height;\n                    var ctx = canvas.getContext(\"2d\");\n                    ctx.lineWidth = strokeWidth;\n                    ctx.lineJoin = \"round\";\n                    ctx.lineCap = \"round\";\n\n                    for (var i = 0, pointsCount = points.length - 1; i < pointsCount; i++) {\n                      ctx.save();\n                      var gradientPoints = this.gradientPoints(points[i], points[i + 1], strokeWidth);\n                      var gradient = ctx.createLinearGradient.apply(ctx, gradientPoints);\n                      this.drawPattern.call(this, ctx, points[i], points[i + 1], strokeWidth, gradient, points, i);\n                      ctx.restore();\n                    }\n\n                    var dataUri = factory.origin + canvas.toDataURL(\"image/png\");\n                    this.pattern.attr(bbox);\n                    this.patternImage.attr({\n                      width: bbox.width,\n                      height: bbox.height,\n                      \"xlink:href\": dataUri\n                    });\n                  },\n                  gradientPoints: function gradientPoints(from, to, width) {\n                    var angle = joint.g.toRad(from.theta(to) - 90);\n                    var center = joint.g.line(from, to).midpoint();\n                    var start = joint.g.point.fromPolar(width / 2, angle, center);\n                    var end = joint.g.point.fromPolar(width / 2, Math.PI + angle, center);\n                    return [start.x, start.y, end.x, end.y];\n                  },\n                  drawPattern: function drawPattern(ctx, from, to, width, gradient) {\n                    ctx.beginPath();\n                    ctx.moveTo(from.x, from.y);\n                    ctx.lineTo(to.x, to.y);\n                    ctx.stroke();\n                    ctx.closePath();\n                    ctx.beginPath();\n                    ctx.strokeStyle = \"white\";\n                    ctx.lineWidth = width - 2;\n                    ctx.moveTo(from.x, from.y);\n                    ctx.lineTo(to.x, to.y);\n                    ctx.stroke();\n                    ctx.closePath();\n                  }\n                });\n                config.model = graph;\n                config.interactive = false;\n                config.perpendicularLinks = true;\n                config.gridSize = 10;\n                config.markAvailable = true;\n                config.linkConnectionPoint = joint.util.shapePerimeterConnectionPoint;\n                config.defaultLink = new joint.dia.Link({\n                  attrs: {\n                    \".marker-source\": {\n                      d: \"M 10 0 L 0 5 L 10 10 z\",\n                      transform: \"scale(0.001)\"\n                    },\n                    \".marker-target\": {\n                      d: \"M 10 0 L 0 5 L 10 10 z\"\n                    },\n                    \".connection\": {\n                      stroke: \"black\"\n                    }\n                  }\n                });\n                config.linkView = PatternLinkView.extend({\n                  drawPattern: function drawPattern(ctx, from, to, width, gradient) {\n                    var innerWidth = width - 4;\n                    var outerWidth = width;\n                    var buttFrom = joint.g.point(from).move(to, -outerWidth / 2);\n                    var buttTo = joint.g.point(to).move(from, -outerWidth / 2);\n                    var lineColor = \"blue\";\n\n                    if (this.model.get(\"attrs\") && this.model.get(\"attrs\")[\".connection\"]) {\n                      lineColor = this.model.get(\"attrs\")[\".connection\"][\"stroke\"] ? this.model.get(\"attrs\")[\".connection\"][\"stroke\"] : lineColor;\n                    }\n\n                    gradient.addColorStop(0.300, lineColor);\n                    var patternColor = \"#ffffff\";\n\n                    if (this.model.get(\"patternColor\")) {\n                      patternColor = this.model.get(\"patternColor\");\n                    }\n\n                    gradient.addColorStop(0.500, patternColor);\n                    gradient.addColorStop(0.700, lineColor);\n                    ctx.beginPath();\n                    ctx.lineWidth = innerWidth;\n                    ctx.strokeStyle = gradient;\n                    ctx.moveTo(from.x, from.y);\n                    ctx.lineTo(to.x, to.y);\n                    ctx.stroke();\n                    ctx.closePath();\n                  }\n                });\n                delete config.cells;\n\n                var repeat = function repeat(target) {\n                  target.attr(\"circle/opacity\", 1);\n                  target.attr(\"circle/r\", 1);\n                  target.transition(\"attrs/circle/r\", 30, {\n                    delay: 0,\n                    duration: 1000,\n                    timingFunction: function timingFunction(t) {\n                      return t * t;\n                    },\n                    valueFunction: function valueFunction(a, b) {\n                      return function (t) {\n                        return a + (b - a) * t;\n                      };\n                    }\n                  });\n                  target.transition(\"attrs/circle/opacity\", 0, {\n                    delay: 0,\n                    duration: 1000,\n                    timingFunction: function timingFunction(t) {\n                      return t * t;\n                    },\n                    valueFunction: function valueFunction(a, b) {\n                      return function (t) {\n                        return a + (b - a) * t;\n                      };\n                    }\n                  });\n                  timeout(function () {\n                    repeat(target);\n                  }, 1600);\n                };\n\n                var scale = 1,\n                    portion,\n                    translate = \"0,0\",\n                    ys = 0;\n                portion = oldwidth / oldheight;\n\n                if (oldwidth / oldheight < domwidth / domheight) {\n                  scale = domheight / oldheight;\n                  config.width = domheight * portion;\n                  config.height = domheight;\n                  ys = (domwidth - config.width) / 2;\n                  persentage = oldheight / domheight;\n                } else {\n                  scale = domwidth / oldwidth;\n                  config.width = domwidth;\n                  config.height = domwidth / portion;\n                  persentage = oldwidth / domwidth;\n                }\n\n                wrap.children().remove();\n                wrap.css(\"width\", config.width);\n                wrap.css(\"height\", config.height); //wrap.css(\"margin\", \"auto\");\n\n                if (config.width > 0 && config.height > 0) {\n                  var paper = new joint.dia.Paper(config);\n\n                  for (var i in json.cells) {\n                    (function (cell) {\n                      if (cell.type == \"basic.Image\") {\n                        cell.attrs.image['xlink:href'] = factory.origin + cell.attrs.image['xlink:href'].substring(1);\n                        ;\n                      }\n                    })(json.cells[i]);\n                  }\n\n                  graph.fromJSON(json);\n\n                  if (events[\"$renderGraphComplete\"]) {\n                    events[\"$renderGraphComplete\"](graph.getCells());\n                  }\n\n                  element.trigger(\"$renderGraphComplete\", graph.getCells());\n                  paper.on(\"cell:pointerup\", function (cellView) {\n                    if (cellView.model instanceof joint.dia.Element) {\n                      openCellTools(cellView);\n                    }\n                  });\n                  paper.on(\"link:options\", function (evt, cellView, x, y) {\n                    openCellTools(cellView);\n                  });\n\n                  if ($$.isString(json.bgimage)) {\n                    wrap.find(\"svg\").css(\"background-image\", \"url(\" + factory.origin + json.bgimage + \")\");\n                  }\n\n                  wrap.find(\"svg\").css(\"background-size\", \"contain\");\n                  wrap.find(\"svg\").css(\"background-repeat\", \"no-repeat\");\n                  wrap.find(\"svg\").css(\"background-position\", \"center center\");\n                  wrap.find(\"svg\").attr(\"id\", svgId);\n                  wrap.find(\".viewport\").attr(\"transform\", \"scale(\" + scale + \")\");\n                  wrap.find(\".chart.Plot\").css(\"display\", \"none\");\n                  var defers = [],\n                      nodes = [],\n                      kpis = [];\n                  var pages = [];\n\n                  if (elemData.routeParam.page) {\n                    pages = elemData.routeParam.page.split(\"|\");\n                  }\n\n                  var distype = self.getParameter(\"type\");\n                  var currentPath = pages[pages.length - 1];\n                  var mleft = element.style.margin;\n\n                  try {\n                    if (mleft) {\n                      mleft = parseInt(mleft.split(\"px\")[0]);\n                    }\n                  } catch (e) {\n                    ;\n                  } finally {}\n\n                  var loop = function loop(cell) {\n                    var defer = q.defer();\n                    var elementId = cell.id;\n                    var elDom = graph.getCell(elementId);\n                    var cellType = cell.type;\n                    var nodeStr = elDom.get(\"nodeId\"),\n                        nodeId;\n                    var kpiStr = elDom.get(\"kpiId\"),\n                        kpiId;\n                    var findNumber = /^number\\:(.*)/;\n                    var extend = elDom.get(\"extend\");\n\n                    if (extend == \"angle\") {\n                      elDom.attr(\"text/style/display\", \"none\");\n                      elDom.attr(\"rect/style/display\", \"none\");\n                      $$.loadExternalJs([\"toolkit/configure/openAngle\"], function (openAngle) {\n                        var ins = openAngle.init(svgId);\n                        openAngles[cell.id] = ins;\n                        ins.setPos(cell.position);\n                        ins.setValue(0);\n                      });\n                    }\n\n                    if (currentPath != \"panel\" && distype != \"panel\") {\n                      if (nodeStr != \"?\") {\n                        nodeId = $$.runRegExp(nodeStr, findNumber, 1);\n                      }\n\n                      if (nodeId) {\n                        nodeId = parseInt(nodeId);\n                      }\n\n                      if (nodes.indexOf(nodeId) == -1 && nodeId) {\n                        nodes.push(nodeId);\n                      }\n                    } else if (self.composoryRes) {\n                      if (nodes.indexOf(self.composoryRes.id) == -1) {\n                        nodes.push(self.composoryRes.id);\n                      }\n                    } else {\n                      nodeId = self.getParameter(\"resourceId\");\n\n                      if (nodes.indexOf(nodeId) == -1) {\n                        nodes.push(nodeId);\n                      }\n                    }\n\n                    if (kpiStr != \"?\") {\n                      kpiId = $$.runRegExp(kpiStr, findNumber, 1);\n                    }\n\n                    if (kpiId && kpiId != \"null\") {\n                      kpiId = parseInt(kpiId);\n                    }\n\n                    if (kpis.indexOf(kpiId) == -1 && nodeId && kpiId != \"null\" && kpiId) {\n                      kpis.push(kpiId);\n                    }\n\n                    if (cellType == \"chart.Plot\") {\n                      var position = cell.position;\n                      var size = cell.size;\n                      var findNumber = /^number\\:(.*)/;\n                      var viewId = $$.runRegExp(cell.echartViewId, findNumber, 1);\n                      self.getViewById(viewId, function (view) {\n                        if (view) {\n                          var chartWrap = $(\"<div></div>\");\n                          chartWrap.css(\"width\", size.width * scale + \"px\");\n                          chartWrap.css(\"height\", \"auto\");\n                          chartWrap.css(\"top\", position.y * scale + \"px\");\n                          chartWrap.css(\"left\", position.x * scale + ys + 5 + \"px\");\n                          chartWrap.css(\"position\", \"absolute\");\n                          chartWrap.css(\"background-color\", \"#eee\");\n                          chartWrap.css(\"box-shadow\", \"1px 1px 10px 1px rgba(0,0,0,.2)\");\n                          chartWrap.css(\"border-radius\", \"2px\");\n                          wrap.prepend(chartWrap);\n                          var json = JSON.parse(view.content);\n                          json.layout = json.layout.$remapByChild(function (element) {\n                            var rs = new commonMethod(element);\n                            return rs;\n                          });\n                          var layout = json.layout;\n                          element.children = layout.children;\n                          element.traverse(function (elem) {});\n\n                          if (cell.nodeIds) {\n                            cell.nodeIds.$remove(function (index, element) {\n                              return element == 0;\n                            });\n\n                            if (cell.nodeIds.length > 0) {\n                              var callback = function callback(event) {\n                                if (event) {\n                                  var resource = event[cell.nodeIds[0]];\n\n                                  if (resource) {\n                                    var success = function success(data) {\n                                      layout.traveseByChild(function (elem) {\n                                        if (elem.type == \"echart\") {\n                                          elem.data.resource = [resource];\n                                          var kpis = elem.data.kpi;\n                                          elem.data.kpi = data.filter(function (elm) {\n                                            return kpis.indexOf(elm.id) != -1;\n                                          });\n                                        }\n                                      });\n                                      traverseRow(chartWrap, layout.children, true);\n                                    };\n\n                                    serviceCenterService.kpis.getBymodelId(resource.modelId).then(success);\n                                  }\n                                }\n                              };\n\n                              var strToNumer = function strToNumer(arr) {\n                                for (var i in arr) {\n                                  if (typeof arr[i] == \"string\") {\n                                    if (arr[i].indexOf(\"number:\") != -1) {\n                                      var numStr = arr[i].split(\"number:\")[1];\n                                      arr[i] = parseInt(numStr);\n                                    }\n                                  }\n                                }\n\n                                return arr;\n                              };\n\n                              resourceUIService.getResourceByIds(strToNumer(cell.nodeIds), callback);\n                            } else {\n                              traverseRow(chartWrap, layout.children, true);\n                            }\n                          } else {\n                            traverseRow(chartWrap, layout.children, true);\n                          }\n                        }\n                      });\n                      defer.resolve(\"success\");\n                    } else {\n                      if (cell.type == \"link\") {\n                        jQuery.extend(cell, displayModeLink);\n                        cell.attrs[\".connection-wrap\"] = {\n                          display: \"none\"\n                        };\n                      }\n\n                      if (elDom.attributes.nodeId) {\n                        //                    elDom.attr('circle/opacity', 0); 这个是为什么要设置为0呢？zhangfa12月15日取消\n                        if (nodeId) {\n                          var callback = function callback(event) {\n                            if (event) {\n                              var resource = event[nodeId];\n                              cell.resourceObj = resource;\n                              elDom.resourceObj = resource; //;\n\n                              all_resources.push(cell.resourceObj);\n\n                              if (resource) {\n                                if (extend == \"alert\") {\n                                  elDom.kpiObj = cell.kpiObj = {\n                                    id: 999999\n                                  };\n                                  defer.resolve(\"success\");\n                                } else if (kpiId != undefined && kpiId != \"0\" && kpiId != null) {\n                                  var success = function success(data) {\n                                    elDom.kpiObj = cell.kpiObj = data.find(function (elem) {\n                                      return elem.id == kpiId;\n                                    });\n                                    all_kpis.push(cell.kpiObj);\n                                    defer.resolve(\"success\");\n                                  };\n\n                                  serviceCenterService.kpis.getBymodelId(resource.modelId).then(success);\n                                } else {\n                                  defer.resolve(\"success\");\n                                }\n                              } else {\n                                defer.resolve(\"success\");\n                              }\n                            } else {\n                              defer.resolve(\"success\");\n                            }\n                          };\n\n                          resourceUIService.getResourceByIds([nodeId], callback);\n                        } else {\n                          defer.resolve(\"success\");\n                        }\n                      } else {\n                        defer.resolve(\"success\");\n                      }\n                    }\n\n                    return defer.promise;\n                  };\n\n                  for (var i in json.cells) {\n                    defers.push(loop(json.cells[i]));\n                  }\n\n                  q.all(defers).then(function () {\n                    var cellsDic = {}; //拓扑节点集合的定义\n\n                    var getData_success = function getData_success(data) {\n                      var loop = function loop(cell, find, findState) {\n                        var elementId = cell.id;\n                        var elDom = graph.getCell(elementId);\n\n                        if (cell.resourceObj) {\n                          var findNumber = /^number\\:(.*)/;\n\n                          if (currentPath != \"panel\" && distype != \"panel\") {\n                            var nodeStr = elDom.get(\"nodeId\"),\n                                nodeId;\n                            nodeId = $$.runRegExp(nodeStr, findNumber, 1);\n                          } else if (self.composoryRes) {\n                            var nodeId = self.composoryRes.id;\n                          } else {\n                            var nodeId = self.getParameter(\"resourceId\");\n                          }\n\n                          var kpiId = cell.$attr(\"kpiObj/id\");\n\n                          if (find || findState) {\n                            var createData = function createData(find) {\n                              var setLevel = function setLevel(cell, value) {\n                                var range = cell.attributes.range;\n\n                                if (range) {\n                                  range = eval(range);\n                                }\n\n                                var persent = (value - range[0]) / (range[1] - range[0]);\n                                cell.prop(\"attrs/text/text\", \"\");\n                                cell.transition(\"attrs/rect\", {\n                                  \"transform\": \"translate(0,0)\",\n                                  \"height\": 60 * persent\n                                }, {\n                                  delay: 0,\n                                  duration: 1000,\n                                  valueFunction: function valueFunction(start, end) {\n                                    return function (time) {\n                                      var height = start[\"height\"] + (end[\"height\"] - start[\"height\"]) * time;\n                                      var all = 0;\n                                      return {\n                                        \"transform\": \"translate(0,\" + (60 - height) + \")\",\n                                        \"height\": height\n                                      };\n                                    };\n                                  }\n                                });\n                              };\n\n                              var setOpenAngle = function setOpenAngle(cell, value, element) {\n                                var range = cell.attributes.range;\n                                var id = cell.id;\n                                openAngles[id].setValue(value);\n                              };\n\n                              var fillColor = function fillColor(cell, type, color, state, color2) {\n                                var stateId = cell.get(\"stateId\");\n\n                                if (stateId) {\n                                  if (state < 1) state = 0;\n                                  cell.state = state;\n                                  var colorAry = [color, \"#25bce7\", \"#e1cd0a\", \"#ed9700\", \"#e7675d\"];\n                                  var colorAry2 = [color2, \"#25bce7\", \"#e1cd0a\", \"#ed9700\", \"#e7675d\"];\n\n                                  if (stateId == \"number:1\" || stateId == \"number:3\") {\n                                    if (type && colorAry[state]) {\n                                      cell.transition(\"attrs/\" + type + \"/fill\", colorAry[state], {\n                                        delay: 300,\n                                        duration: 500,\n                                        valueFunction: joint.util.interpolate.hexColor\n                                      });\n                                    }\n                                  }\n\n                                  if ((stateId == \"number:2\" || stateId == \"number:3\") && colorAry2[state]) {\n                                    cell.transition(\"attrs/text/fill\", colorAry2[state], {\n                                      delay: 300,\n                                      duration: 500,\n                                      valueFunction: joint.util.interpolate.hexColor\n                                    });\n                                  }\n                                }\n                              };\n\n                              var breathFlash = function breathFlash(cell, type, color, state, opacityState) {\n                                var stateId = cell.get(\"stateId\");\n\n                                var flash = function flash(el) {\n                                  var defaultOpacity = opacityState ? 1 : el.opacity;\n                                  el.transition(\"attrs/\" + type + \"/opacity\", defaultOpacity, {\n                                    delay: 0,\n                                    duration: 3000,\n                                    timingFunction: joint.util.timing.inout,\n                                    valueFunction: function valueFunction(a, b) {\n                                      return function (t) {\n                                        var o = a + b * (defaultOpacity - Math.abs(defaultOpacity - 2 * defaultOpacity * t));\n                                        return Number(o.toFixed(2));\n                                      };\n                                    }\n                                  });\n                                };\n\n                                if (stateId) {\n                                  if (state < 0) state = 0;\n                                  var colorAry = [color, \"#25bce7\", \"#e1cd0a\", \"#ed9700\", \"#e7675d\"];\n\n                                  if (stateId == \"number:2\") {\n                                    type = \"text\";\n                                  }\n\n                                  if (type) {\n                                    if (!cell.opacity) {\n                                      cell.opacity = jQuery.isNumeric(cell.prop(\"attrs/\" + type + \"/opacity\")) ? cell.prop(\"attrs/\" + type + \"/opacity\") : 1;\n                                    }\n\n                                    cell.state = state;\n                                    cell.prop(\"attrs/\" + type + \"/opacity\", 0.1);\n                                    cell.prop(\"attrs/\" + type + \"/fill\", colorAry[state]);\n\n                                    if (cell.state > 0) {\n                                      if (_.contains(cell.getTransitions(), \"attrs/\" + type + \"/opacity\")) return;\n                                      cell.on(\"transition:end\", function (el, path) {\n                                        if (el.state > 0) {\n                                          flash(el);\n                                        } else {\n                                          el.off(\"transition:end\");\n                                          el.prop(\"attrs/\" + type + \"/opacity\", el.opacity);\n                                        }\n                                      });\n                                      flash(cell);\n                                    } else {\n                                      cell.prop(\"attrs/\" + type + \"/opacity\", cell.opacity);\n                                    }\n                                  }\n                                }\n                              };\n\n                              var bubbleFlash = function bubbleFlash(cell, type, color, state, opacityState) {\n                                var stateId = cell.get(\"stateId\");\n\n                                var flash = function flash() {\n                                  cell.prop(\"attrs/\" + type + \"/r\", 0);\n                                  cell.prop(\"attrs/\" + type + \"/opacity\", opacityState ? 1 : cell.opacity);\n                                  cell.transition(\"attrs/\" + type, {\n                                    \"r\": cell.r,\n                                    \"opacity\": 0\n                                  }, {\n                                    delay: 0,\n                                    duration: 1500,\n                                    valueFunction: function valueFunction(start, end) {\n                                      return function (time) {\n                                        return {\n                                          \"r\": start[\"r\"] + (end[\"r\"] - start[\"r\"]) * time,\n                                          \"opacity\": start[\"opacity\"] - start[\"opacity\"] * time\n                                        };\n                                      };\n                                    }\n                                  });\n                                };\n\n                                if (stateId) {\n                                  if (state < 0) state = 0;\n                                  var colorAry = [color, \"#25bce7\", \"#e1cd0a\", \"#ed9700\", \"#e7675d\"];\n\n                                  if (stateId == \"number:2\") {\n                                    type = \"text\";\n                                  }\n\n                                  if (type) {\n                                    if (!cell.opacity) {\n                                      cell.opacity = jQuery.isNumeric(cell.prop(\"attrs/\" + type + \"/opacity\")) ? cell.prop(\"attrs/\" + type + \"/opacity\") : 1;\n                                      cell.r = cell.prop(\"attrs/\" + type + \"/r\");\n                                      cell.prop(\"attrs/\" + type + \"/opacity\", opacityState ? 1 : cell.opacity);\n                                    }\n\n                                    cell.state = state;\n                                    cell.prop(\"attrs/\" + type + \"/fill\", colorAry[state]);\n\n                                    if (cell.state > 0) {\n                                      if (_.contains(cell.getTransitions(), \"attrs/\" + type)) return;\n                                      cell.on(\"transition:end\", function (el) {\n                                        if (el.state > 0) {\n                                          flash();\n                                        } else {\n                                          cell.prop(\"attrs/\" + type + \"/opacity\", cell.opacity);\n                                          cell.prop(\"attrs/\" + type + \"/r\", cell.r);\n                                        }\n                                      });\n                                      flash();\n                                    } else {\n                                      cell.prop(\"attrs/\" + type + \"/opacity\", cell.opacity);\n                                      cell.prop(\"attrs/\" + type + \"/r\", cell.r);\n                                    }\n                                  }\n                                }\n                              };\n\n                              var changeIconAndText = function changeIconAndText(cell, state, type) {\n                                if (!type) type = \"alertConfig\";\n\n                                if (type == \"alertConfig\") {\n                                  var alertIcon = cell.get(\"alertIcon\");\n\n                                  if (alertIcon) {\n                                    if (state < 1) state = 0;\n                                    var alertConfig = cell.get(type);\n                                    alertConfig.forEach(function (item) {\n                                      if (item.id == state) {\n                                        if (item.alertText) cell.prop(\"attrs/text/text\", item.alertText);\n                                        if (item.alertIcon) cell.prop(\"attrs/image/xlink:href\", factory.origin + item.alertIcon);\n                                      }\n                                    });\n                                  }\n                                } else if (type == \"valueConfig\") {\n                                  var valueConfig = cell.get(type);\n                                  valueConfig.forEach(function (item) {\n                                    item.stateDisplay = false;\n\n                                    if (item.valueText == state) {\n                                      item.stateDisplay = true;\n                                      if (item.valueText) cell.prop(\"attrs/text/text\", item.valueText);\n                                      if (item.valueIcon) cell.prop(\"attrs/image/xlink:href\", factory.origin + item.valueIcon);\n                                    }\n                                  });\n                                }\n                              };\n\n                              var getFill = function getFill(obj) {\n                                var rs = {};\n\n                                for (var i in obj) {\n                                  rs = obj[i];\n                                  break;\n                                }\n\n                                return rs.fill;\n                              };\n\n                              var getType = function getType(type) {\n                                if (type == \"basic.Rect\") {\n                                  return \"rect\";\n                                } else if (type == \"basic.Circle\") {\n                                  return \"circle\";\n                                }\n                              };\n\n                              var getTextFill = function getTextFill(obj) {\n                                return obj[\"text\"][\"fill\"];\n                              };\n\n                              var getAllUnit_success = function getAllUnit_success(data) {\n                                var extend = elDom.get(\"extend\");\n\n                                if (extend == \"alert\" && findState) {\n                                  changeIconAndText(elDom, findState.value);\n                                } else if (extend == \"value\" && find) {\n                                  changeIconAndText(elDom, find.value, \"valueConfig\");\n                                } else if (extend == \"level\" && find) {\n                                  setLevel(elDom, find.value);\n                                } else if (extend == \"angle\" && find) {\n                                  setOpenAngle(elDom, find.value, cell);\n                                } else {\n                                  if (findState) {\n                                    var stateType = cell[\"stateType\"];\n\n                                    if (stateType == \"number:1\") {\n                                      breathFlash(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, false);\n                                    } else if (stateType == \"number:2\") {\n                                      bubbleFlash(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, false);\n                                    } else if (stateType == \"number:3\") {\n                                      breathFlash(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, true);\n                                    } else if (stateType == \"number:4\") {\n                                      bubbleFlash(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, true);\n                                    } else {\n                                      fillColor(elDom, getType(cell[\"type\"]), getFill(cell[\"attrs\"]), findState.value, getTextFill(cell[\"attrs\"]));\n                                    }\n                                  }\n\n                                  if (find) {\n                                    var getKpi = function getKpi(callback) {\n                                      if (cell.kpiObj) {\n                                        callback(cell.kpiObj);\n                                      } else {\n                                        target.getResourceById(nodeId, function (res) {\n                                          var modelId = res.modelId;\n                                          target.getKpisByModelId(modelId, function (kpis) {\n                                            var kpi = kpis.find(function (kpi) {\n                                              return \"number:\" + kpi.id == cell.kpiId;\n                                            });\n                                            cell.kpiObj = kpi;\n                                            callback(cell.kpiObj);\n                                          });\n                                        });\n                                      }\n                                    };\n\n                                    var allUnits = data;\n                                    getKpi(function (kpiObj) {\n                                      var unit = allUnits.find(function (elem) {\n                                        if (cell.kpiObj) return elem.unitCode == cell.kpiObj.unit;else return \"\";\n                                      });\n                                      var unitType = false;\n\n                                      if (elDom.get(\"unitType\")) {\n                                        unitType = elDom.get(\"unitType\").split(\"number:\")[1] == 1;\n                                      }\n\n                                      var rangeObj;\n\n                                      if (cell.resourceObj.modelId) {\n                                        rangeObj = resourceUIService.$attr(\"rootModelsDic/\" + cell.resourceObj.modelId + \"/kpiDic/\" + find.kpiCode + \"/rangeObj\");\n                                        find.value = rangeObj ? rangeObj[find.value] : find.value;\n                                      }\n\n                                      var y = elDom.attributes.position.y;\n\n                                      if (unit && unitType) {\n                                        elDom.prop(\"attrs/text/text\", find.value + \"\" + unit.unitName);\n                                      } else {\n                                        elDom.prop(\"attrs/text/text\", find.value);\n                                      }\n\n                                      elDom.prop(\"position/y\", y);\n                                    });\n                                  }\n                                }\n                              };\n\n                              var error = function error(err) {\n                                elDom.prop(\"attrs/text/text\", find.value);\n                              };\n\n                              serviceCenterService.units.getAll().then(getAllUnit_success, error);\n                            };\n\n                            createData(find);\n                          }\n                        }\n                      };\n\n                      data.forEach(function (returnData) {\n                        if (returnData.kpiCode == 999999) {\n                          //节点告警状态处理\n                          if (cellsDic[returnData.nodeId]) {\n                            //已经存在的节点\n                            cellsDic[returnData.nodeId].forEach(function (cell) {\n                              if (cell.state != returnData.value) {\n                                var showEffect = true;\n\n                                if (cell[\"kpiId\"] && cell[\"kpiId\"] != \"number:0\") {\n                                  if (returnData.instance) {\n                                    if (\"number:\" + returnData.instance != cell[\"kpiId\"]) {\n                                      showEffect = false;\n                                    }\n                                  } else {\n                                    showEffect = false;\n                                  }\n                                } else {\n                                  if (returnData.instance) {\n                                    showEffect = false;\n                                  }\n                                }\n\n                                if (!showEffect) return;\n                                loop(cell, null, returnData);\n                              }\n                            });\n                          } else {\n                            json.cells.forEach(function (cell) {\n                              if (cell[\"nodeId\"]) {\n                                var nodeIdAry = cell[\"nodeId\"].split(\":\");\n\n                                if (nodeIdAry.length > 0 && nodeIdAry[nodeIdAry.length - 1] == returnData.nodeId) {\n                                  if (!cellsDic[returnData.nodeId]) cellsDic[returnData.nodeId] = [];\n                                  cellsDic[returnData.nodeId].push(cell);\n                                  var showEffect = true;\n\n                                  if (cell[\"kpiId\"] && cell[\"kpiId\"] != \"number:0\") {\n                                    if (returnData.instance) {\n                                      if (\"number:\" + returnData.instance != cell[\"kpiId\"]) {\n                                        showEffect = false;\n                                      }\n                                    } else {\n                                      showEffect = false;\n                                    }\n                                  } else {\n                                    if (returnData.instance) {\n                                      showEffect = false;\n                                    }\n                                  }\n\n                                  if (!showEffect) return;\n                                  loop(cell, null, returnData);\n                                }\n                              }\n                            });\n                          }\n                        } else {\n                          if (cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode]) {\n                            cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode].forEach(function (cellObj) {\n                              loop(cellObj, returnData, null);\n                            });\n                          } else {\n                            graph.getCells().forEach(function (cell) {\n                              /** 考虑的组态内变量被负值的情况用cell.resourceObj.id来判断*/\n                              if (cell.$attr(\"resourceObj/id\") == returnData.nodeId) {\n                                if (cell[\"kpiId\"] || cell.$attr(\"kpiObj/id\")) {\n                                  if (cell[\"kpiId\"]) {\n                                    var kpiIdAry = cell[\"kpiId\"].split(\":\");\n                                  }\n\n                                  if (cell.$attr(\"kpiObj/id\")) {\n                                    var kpiIdAry = [cell.$attr(\"kpiObj/id\")];\n                                  }\n\n                                  if (kpiIdAry.length > 0 && kpiIdAry[kpiIdAry.length - 1] == returnData.kpiCode) {\n                                    if (cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode] == undefined) {\n                                      cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode] = [];\n                                    }\n\n                                    cellsDic[returnData.nodeId + \"_\" + returnData.kpiCode].push(cell);\n                                    loop(cell, returnData, null);\n                                  }\n                                }\n                              }\n                            });\n                          }\n                        }\n                      });\n                    }; //获得设备的告警状态，包括实例\n\n\n                    kpiDataService.getRealTimeKpiData(nodes, [999999], function (returnObj) {\n                      if (returnObj.code == 0) {\n                        getData_success(returnObj.data);\n                      }\n                    }, true); //获得设备的数据\n\n                    kpiDataService.getRealTimeKpiData(nodes, kpis, function (returnObj) {\n                      if (returnObj.code == 0) {\n                        getData_success(returnObj.data);\n                      }\n                    }); //加入节点告警状态\n\n                    kpis.push(999999);\n                    var paramSocket = {\n                      ciid: nodes.toString(),\n                      kpi: kpis.toString()\n                    };\n                    uuid = Math.uuid();\n                    var operation = \"register\";\n                    SwSocket.register(uuid, operation, function (event) {\n                      getData_success([event.data]);\n                    });\n                    SwSocket.send(uuid, operation, \"kpi\", paramSocket);\n\n                    if (events[\"$loadCiKpiComplete\"]) {\n                      events[\"$loadCiKpiComplete\"](graph.getCells());\n                    }\n\n                    element.trigger(\"$loadCiKpiComplete\", graph.getCells());\n                  });\n                  $(\"g.marker-vertices\").attr(\"display\", \"none\");\n                  $(\"g.marker-arrowheads\").attr(\"display\", \"none\");\n                  $(\"g.link-tools\").attr(\"display\", \"none\");\n                  /**\n                   * PROMETHEUS-586\n                   * 注销scope时注销方法heartBeat，回调函数callback\n                   */\n\n                  $(\"#free-board\").on(\"naviClick\", function () {\n                    SwSocket.unregister(uuid);\n                  });\n                }\n              });\n            };\n\n            $$.loadExternalJs([\"rappid-joint\", \"lodash\", \"backbone\"], callback);\n          } else {\n            wrap.append(warning);\n          }\n        };\n\n        if (inputJson) {\n          json = inputJson;\n          run(json);\n        } else {\n          self.getViewById(viewId, function (view) {\n            json = JSON.parse(view.content);\n            run(json);\n          });\n        }\n      };\n\n      delete element.self;\n      topo.css(\"width\", \"100%\");\n      topo.css(\"background-position\", \"top\");\n      topo.css(\"background-size\", \"contain\");\n      expression = expression ? expression : {};\n      var initEvent = expression.$attr(\"on/init\");\n      var clickEvent = expression.$attr(\"on/click\");\n      var wholeClickEvent = expression.$attr(\"on/wholeClick\");\n\n      if (element.style) {\n        topo.css(element.style);\n      }\n\n      if (typeof initEvent == \"function\") {\n        try {\n          topo.underWatch = initEvent({\n            target: self,\n            self: self,\n            global: global,\n            tools: elemData\n          }, function complete() {\n            defer.resolve(\"underwatch\");\n          }, defer.id);\n        } catch (e) {\n          console.error(e);\n        }\n      } else {\n        self.render(json);\n      }\n\n      topo.on(\"click\", function (event) {\n        if (typeof wholeClickEvent == \"function\") {\n          try {\n            wholeClickEvent({\n              target: self,\n              global: global\n            });\n          } catch (e) {\n            console.error(e);\n          }\n        }\n      }); // console.assert(topo.underWatch != undefined, \"underWatch没设置\");\n    }\n\n    return topo;\n  };\n});"],"sourceRoot":"/source/"}