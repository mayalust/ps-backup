{"version":3,"sources":["toolkit/component/datalist.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","data","innerContent","$","ulDom","header","tbody","table","element","serviceCenterService","timeout","global","system","setParameters","target","runExpression","expression","result","$$","funRes","code","Error","message","fnResult","dtype","$attr","clone","length","slice","i","index","dt","last","series","$clone","style","undefined","name","$remove","hasOwnProperty","setSeries","axis","array","type","j","setAxisByCategory","append","baseOption","legend","xAxis","css","getCiKpi","ci","kpi","condition","timespan","frequency","format","category","rs","method","run","dom","events","addEvent","event","handler","on","evt","echart","tools","ui","addEvents","parameters","children","remove","loop","tab","renderTbody","content","td1","text","td2","addClass","find","removeClass","this","createTr","serie","td","tr","th","createTh","setOptioin","getValueListBytime","then"],"mappings":"AAAA,SAASA,QAAQC,GAAwT,OAAtOD,QAArD,mBAAXE,QAAoD,iBAApBA,OAAOC,SAAmC,SAAiBF,GAAO,cAAcA,GAA2B,SAAiBA,GAAO,OAAOA,GAAyB,mBAAXC,QAAyBD,EAAIG,cAAgBF,QAAUD,IAAQC,OAAOG,UAAY,gBAAkBJ,IAAyBA,GASxVK,OAAO,GAAI,WACT,OAAO,SAAUC,GACf,IAAIC,EAAeC,EAAE,eACjBC,EAAQD,EAAE,mCACVE,EAASF,EAAE,yCACXG,EAAQH,EAAE,mBACVI,EAAQJ,EAAE,4DACVK,EAAUP,EAAKO,QACfC,EAAuBR,EAAKQ,qBAC5BC,EAAUT,EAAKS,QACfC,EAASV,EAAKU,OAyDdC,EAAS,GAiDTC,EAAgB,SAAuBC,EAAQb,GACjD,IALiCa,EAAQb,EAKrCc,EAAgB,SAAuBC,EAAYf,EAAMW,GAC3D,IAAIK,EAeJ,OAdAC,GAAGH,cAAcC,EAAY,SAAUG,GACrC,GAAmB,KAAfA,EAAOC,KAUT,MAAM,IAAIC,MAAMF,EAAOG,SATvB,IAAIC,EAAWJ,EAAOlB,KAEtB,MAAuB,mBAAZsB,EACTN,EAASM,EAAStB,EAAMW,GAGjBK,IAMNA,GAGLO,EAAQhB,EAAQiB,MAAM,gBAAkB,OAAS,SAEjDjB,EAAQiB,MAAM,iBA1BeX,EA2BrBA,EA3B6Bb,EA2BrBc,EAAcP,EAAQiB,MAAM,eAAeD,GAAQvB,EAAMW,GA1B7EE,EAAOW,MAAM,cAAexB,IA5Cd,SAAmBa,EAAQb,GACzC,GAAIA,EAAM,CACR,IAYIyB,EAtEY,GADiBzB,EAuEVA,GAtEhB0B,QAC6B,GAAhC1B,EAAKA,EAAK0B,OAAS,GAAGA,OACjB1B,EAAK2B,MAAM,GAAI,GAKjB3B,EAiEP,IAAK,IAAI4B,KAAKH,GACZ,SAAWI,EAAOC,GAChB,IAAIC,EAGFA,EADElB,EAAOmB,OAAOnB,EAAOmB,OAAON,OAAS,GAChCb,EAAOmB,OAAOnB,EAAOmB,OAAON,OAAS,GAAGO,SAExC,GAGT,IAAIC,EAAgCC,MAAxBtB,EAAOmB,OAAOH,GAAsBE,EAAOlB,EAAOmB,OAAOH,GAAOI,SAC5EC,EAAME,KAAON,EAAGM,KAChBF,EAAMlC,KAAO8B,EAAG9B,KAEYmC,MAAxBtB,EAAOmB,OAAOH,KAChBhB,EAAOmB,OAAOH,GAASK,GAGzBrB,EAAOmB,OAAOH,GAAOO,KAAON,EAAGM,KAC/BvB,EAAOmB,OAAOH,GAAO7B,KAAO8B,EAAG9B,KAlBjC,CAmBG4B,EAAGH,EAAMG,IAGGf,EApCRmB,OAAOK,QAAQ,SAAUR,EAAOtB,GACrC,QAAIA,EAAQ+B,eAAe,SACC,EAAtB/B,EAAQP,KAAK0B,UAHA,IA3DU1B,EAkInCuC,CAAU1B,EAAQC,EAAcP,EAAQiB,MAAM,eAAeD,GAAQvB,EAAMW,IAtHrD,SAA2BE,EAAQiB,EAAIU,GAC7D,IAAqDC,EAYjDzC,GAZiDyC,EAYvBX,GAVY,GAAlCW,EAAMA,EAAMf,OAAS,GAAGA,OACnBe,EAAMd,MAAM,GAAI,GAEhBc,EAGF,GAMX,GAAIzC,EAAK0B,QAAUb,EAAO2B,GAAMd,OAAQ,CACtC,IAAK,IAAIE,EAAI,EAAGA,EAAIf,EAAO2B,GAAMd,OAAQE,IACvCf,EAAO2B,GAAMZ,GAAGc,KAAO,WACvB7B,EAAO2B,GAAMZ,GAAG5B,KAAOA,EAAK4B,GAK9B,IAFA,IAAIH,EAAQZ,EAAO2B,GAAMZ,EAAI,GAEpBe,EAAIf,EAAGe,EAAI3C,EAAK0B,OAAQiB,IAC/B9B,EAAO2B,GAAMG,GAAKlB,EAClBZ,EAAO2B,GAAMG,GAAGD,KAAO,WACvB7B,EAAO2B,GAAMG,GAAG3C,KAAOA,EAAK2C,OAEzB,CACL,IAASf,EAAI,EAAGA,EAAI5B,EAAK0B,OAAQE,IAC/Bf,EAAO2B,GAAMZ,GAAGc,KAAO,WACvB7B,EAAO2B,GAAMZ,GAAG5B,KAAOA,EAAK4B,GAK9B,IAFIH,EAAQzB,EAAK4B,EAAI,GAEZe,EAAIf,EAAGe,EAAI9B,EAAO2B,GAAMd,OAAQiB,IACvC9B,EAAO2B,GAAMG,GAAGD,KAAO,WACvB7B,EAAO2B,GAAMG,GAAG3C,KAAOyB,GAiF3BmB,CAAkB/B,EAAQC,EAAcP,EAAQiB,MAAM,cAAcD,GAAQvB,EAAMW,GAAS,UAGjD,GAAxCJ,EAAQiB,MAAM,uBAChBlB,EAAMuC,OAAOzC,GAAQyC,OAAOxC,GAE5BC,EAAMuC,OAAOxC,GAIfJ,EAAa4C,OAAO1C,GACpBF,EAAa4C,OAAOvC,GACpB,IAAIwC,EAAa,CACfd,OAAQ,CAAC,IACTe,OAAQ,CACN/C,KAAM,IAERgD,MAAO,CAAC,CACNN,KAAM,WACN1C,KAAM,MAwLV,OApLIO,EAAQ2B,OACVjC,EAAagD,IAAI1C,EAAQ2B,OAI3BzB,EAAQ,WA6KNF,EAAQ2C,SA5KY,SAAuBC,EAAIC,GAC7C,IAIIrC,EASAsC,EAbAC,EAAW/C,EAAQiB,MAAM,iBAAmBjB,EAAQiB,MAAM,iBAAmB,EAC7E+B,EAAYhD,EAAQiB,MAAM,kBAAoBjB,EAAQiB,MAAM,kBAAoB,EAChFgC,EAASjD,EAAQiB,MAAM,eAAiBjB,EAAQiB,MAAM,eAAiB,GACvEiC,EAAWlD,EAAQiB,MAAM,oBAAsBjB,EAAQiB,MAAM,oBAAsB,GAEvFP,GAAGH,cAAcP,EAAQiB,MAAM,sBAAuB,SAAUF,GAC9D,GAAqB,KAAjBA,EAASH,KAIX,MAAM,IAAIC,MAAME,EAASD,SAHzB,IAAIqC,EAAKpC,EAAStB,KAClBe,EAAa2C,GAAU,KAM3BzC,GAAGH,cAAcP,EAAQiB,MAAM,qBAAsB,SAAUF,GAC7D,GAAqB,KAAjBA,EAASH,KAIX,MAAM,IAAIC,MAAME,EAASD,SAHzB,IAAIqC,EAAKpC,EAAStB,KAClBqD,EAAYK,GAAU,KAK1B,IAAIC,EAASpD,EAAQiB,MAAM,uBAAyBjB,EAAQiB,MAAM,uBAAyB,8BACvFkB,EAAOnC,EAAQiB,MAAM,qBAAuBjB,EAAQiB,MAAM,qBAAuB,MAoBrF,SAASoC,EAAI5D,GAoBXY,EAAckC,EAAY9C,GAnBV,SAAmB6D,EAAKC,GACtC,IAAIC,EAAW,SAAkBC,EAAOC,GACtCJ,EAAIK,GAAGF,EAAO,SAAUG,GACtBF,EAAQ,CACNG,OAAQD,EACRzD,OAAQA,EACR2D,MAAOrE,EACPsE,GAAI/D,OAKV,IAAK,IAAIqB,KAAKkC,EACZC,EAASnC,EAAGkC,EAAOlC,IAOvB2C,CAAUtE,EAAcc,EAAWS,MAAM,OAgGN,UAA/B/B,QAAQc,EAAQiE,aAClB5D,EAAckC,EAAYvC,EAAQiE,YA/FnB,SAAoB1B,GACnC,GAA4C,GAAxCvC,EAAQiB,MAAM,uBAAgC,CAEhDrB,EAAMsE,WAAWC,SAEjB,IAAIC,EAAO,SAAc/C,EAAGI,GAC1B,IAAI4C,EAAM1E,EAAE,UAAY4C,EAAWC,OAAO/C,KAAK4B,GAAK,aAEhDiD,EAAc,SAAqB7E,GAGrC,IAAK,IAAI2C,KAFTtC,EAAMoE,WAAWC,SAEH1E,EAAM,CAClB,IAAI8E,EAAU5E,EAAE,aAEZ6E,EAAM7E,EAAE,aAAa+C,IAAI,QAAS,OAAO+B,KAAKhC,MAAML,IACpDsC,EAAM/E,EAAE,aAAa+C,IAAI,QAAS,OAAO+B,KAAKhF,EAAK2C,IACvDmC,EAAQjC,OAAOkC,GAAKlC,OAAOoC,GAC3B5E,EAAMwC,OAAOiC,KAIjBF,EAAI3B,IAAI,SAAU,WAClB2B,EAAI5E,KAAK,MAAO4B,GApBL,GAsBPA,GACFgD,EAAIM,SAAS,UAGf/E,EAAM0C,OAAO+B,GACbA,EAAIV,GAAG,QAAS,WACd/D,EAAMgF,KAAK,MAAMC,YAAY,UAC7BlF,EAAEmF,MAAMH,SAAS,UACjBL,EAAY7C,EAAOJ,GAAG5B,QAExB6E,EAAY7C,EAAOJ,GAAG5B,OAGxB,IAAK,IAAI4B,KAAKkB,EAAWd,OACvB2C,EAAK/C,EAAGkB,EAAWd,YAEhB,CACL3B,EAAMoE,WAAWC,SAEjB,IAqBIY,EAAW,SAAkB1D,EAAG2D,GAClC,IAGsCvF,EAChCwF,EAJFC,EAAKvF,EAAE,aACPwF,EAAKxF,EAAE,aAAa+C,IAAI,QAAS,WAAWA,IAAI,aAAc,QAAQ+B,KAAKlC,EAAWC,OAAO/C,KAAK4B,IAetG,IAAK,IAAIA,KAHT6D,EAAG5C,OAAO6C,GACVrF,EAAMwC,OAAO4C,GAECF,EAAMvF,KAClByF,EAAG5C,QAdiC7C,EAcduF,EAAMvF,KAAK4B,GAb7B4D,OAAAA,EAAAA,EAAKtF,EAAE,aAAa+C,IAAI,QAAS,QAAQA,IAAI,aAAc,UAAUA,IAAI,cAAe,QAAQ+B,KAAKhF,GAErG4B,EAAI,GAAK,GACX4D,EAAGvC,IAAI,mBAAoB,QAGtBuC,KAaX,IAAK,IAAI5D,KAFTvB,EAAMwC,OA3CS,SAAkBG,GAC/B,IAGiCpB,EAAG5B,EAC9B0F,EAJFD,EAAKvF,EAAE,aAaX,IAAK,IAAI0B,KAZT6D,EAAG5C,OAAO3C,EAAE,aAAa8E,KAAK,OAYhBhC,EACZyC,EAAG5C,QAX+B7C,EAWZgD,EAXSpB,EAWZA,GAVf8D,OAAAA,EAAAA,EAAKxF,EAAE,aAAa8E,KAAKhF,GAAMiD,IAAI,aAAc,UAEjDrB,EAAI,GAAK,GACX8D,EAAGzC,IAAI,mBAAoB,QAGtByC,IAOT,OAAOD,EAyBIE,CAAS7C,EAAWE,MAAM,GAAGhD,OAE5B8C,EAAWd,OACvB3B,EAAMwC,OAAOyC,EAAS1D,EAAGkB,EAAWd,OAAOJ,MAUjDgE,CAAW9C,GA5ITvC,EAAQiB,MAAM,gBAChBhB,EAAqBqF,mBAAmB1C,EAAIC,EAAKE,EAAUC,EAAWC,EAAQC,EAAUf,EAAMiB,EAAQN,GAAWyC,KAKnH,SAAsB9F,GACpB4D,EAAI5D,IAKN,SAAiBA,GACf4D,EAAI5D,KAVJ4D,EAAI,QAiJH3D","file":"toolkit/component/datalist.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/**\n * Created by leonlin on 16/11/3.\n */\n\n/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var innerContent = $(\"<div></div>\");\n    var ulDom = $('<ul class=\"nav nav-pills\"></ul>');\n    var header = $(\"<thead><th>时间</th><th>数据</th></thead>\");\n    var tbody = $(\"<tbody></tbody>\");\n    var table = $(\"<table width='100%' class='table table-hover no-margin'>\");\n    var element = data.element;\n    var serviceCenterService = data.serviceCenterService;\n    var timeout = data.timeout;\n    var global = data.global;\n\n    var removeLast = function removeLast(data) {\n      if (data.length > 0) {\n        if (data[data.length - 1].length == 0) {\n          return data.slice(0, -1);\n        } else {\n          return data;\n        }\n      } else {\n        return data;\n      }\n    };\n\n    var setAxisByCategory = function setAxisByCategory(target, dt, axis) {\n      var removeBlankELement = function removeBlankELement(array) {\n        if (array) {\n          if (array[array.length - 1].length == 0) {\n            return array.slice(0, -1);\n          } else {\n            return array;\n          }\n        } else {\n          return [];\n        }\n      };\n\n      var data = removeBlankELement(dt);\n\n      if (data.length >= target[axis].length) {\n        for (var i = 0; i < target[axis].length; i++) {\n          target[axis][i].type = 'category';\n          target[axis][i].data = data[i];\n        }\n\n        var clone = target[axis][i - 1];\n\n        for (var j = i; j < data.length; j++) {\n          target[axis][j] = clone;\n          target[axis][j].type = 'category';\n          target[axis][j].data = data[j];\n        }\n      } else {\n        for (var i = 0; i < data.length; i++) {\n          target[axis][i].type = 'category';\n          target[axis][i].data = data[i];\n        }\n\n        var clone = data[i - 1];\n\n        for (var j = i; j < target[axis].length; j++) {\n          target[axis][j].type = 'category';\n          target[axis][j].data = clone;\n        }\n      }\n    };\n\n    var system = {};\n\n    var setSeries = function setSeries(target, data) {\n      if (data) {\n        var removeEmptyStyle = function removeEmptyStyle(target) {\n          target.series.$remove(function (index, element) {\n            if (element.hasOwnProperty(\"data\")) {\n              if (element.data.length > 0) {\n                return false;\n              }\n            }\n\n            return true;\n          });\n        };\n\n        var clone = removeLast(data);\n\n        for (var i in clone) {\n          (function (index, dt) {\n            var last;\n\n            if (target.series[target.series.length - 1]) {\n              last = target.series[target.series.length - 1].$clone();\n            } else {\n              last = {};\n            }\n\n            var style = target.series[index] == undefined ? last : target.series[index].$clone();\n            style.name = dt.name;\n            style.data = dt.data;\n\n            if (target.series[index] == undefined) {\n              target.series[index] = style;\n            }\n\n            target.series[index].name = dt.name;\n            target.series[index].data = dt.data;\n          })(i, clone[i]);\n        }\n\n        removeEmptyStyle(target);\n      }\n    };\n\n    var setLegend = function setLegend(target, data) {\n      target.$attr(\"legend/data\", data);\n    };\n\n    var setParameters = function setParameters(target, data) {\n      var runExpression = function runExpression(expression, data, system) {\n        var result;\n        $$.runExpression(expression, function (funRes) {\n          if (funRes.code == \"0\") {\n            var fnResult = funRes.data;\n\n            if (typeof fnResult == 'function') {\n              result = fnResult(data, system);\n              return result;\n            } else {\n              return result;\n            }\n          } else {\n            throw new Error(funRes.message);\n          }\n        });\n        return result;\n      };\n\n      var dtype = element.$attr(\"data/applied\") ? \"bind\" : \"manual\";\n\n      if (element.$attr(\"data/legend\")) {\n        setLegend(target, runExpression(element.$attr(\"data/legend\")[dtype], data, system));\n      }\n\n      setSeries(target, runExpression(element.$attr(\"data/series\")[dtype], data, system));\n      setAxisByCategory(target, runExpression(element.$attr(\"data/xAxis\")[dtype], data, system), 'xAxis');\n    };\n\n    if (element.$attr(\"attributes/vertical\") == true) {\n      table.append(header).append(tbody);\n    } else {\n      table.append(tbody);\n    }\n\n    ;\n    innerContent.append(ulDom);\n    innerContent.append(table);\n    var baseOption = {\n      series: [{}],\n      legend: {\n        data: []\n      },\n      xAxis: [{\n        type: \"category\",\n        data: []\n      }]\n    };\n\n    if (element.style) {\n      innerContent.css(element.style);\n    }\n\n    ;\n    timeout(function () {\n      var getCiKpi_back = function getCiKpi_back(ci, kpi) {\n        var timespan = element.$attr(\"data/timespan\") ? element.$attr(\"data/timespan\") : 0;\n        var frequency = element.$attr(\"data/frequency\") ? element.$attr(\"data/frequency\") : 0;\n        var format = element.$attr(\"data/format\") ? element.$attr(\"data/format\") : \"\";\n        var category = element.$attr(\"advance/category\") ? element.$attr(\"advance/category\") : \"\";\n        var expression;\n        $$.runExpression(element.$attr(\"advance/expression\"), function (fnResult) {\n          if (fnResult.code == \"0\") {\n            var rs = fnResult.data;\n            expression = rs ? rs : {};\n          } else {\n            throw new Error(fnResult.message);\n          }\n        });\n        var condition;\n        $$.runExpression(element.$attr(\"advance/condition\"), function (fnResult) {\n          if (fnResult.code == \"0\") {\n            var rs = fnResult.data;\n            condition = rs ? rs : {};\n          } else {\n            throw new Error(fnResult.message);\n          }\n        });\n        var method = element.$attr(\"advance/getfunction\") ? element.$attr(\"advance/getfunction\") : 'kpiDataService.getValueList';\n        var type = element.$attr(\"advance/paramtype\") ? element.$attr(\"advance/paramtype\") : \"kpi\";\n\n        if (element.$attr(\"data/applied\")) {\n          serviceCenterService.getValueListBytime(ci, kpi, timespan, frequency, format, category, type, method, condition).then(getValueList, failure);\n        } else {\n          run({});\n        }\n\n        function getValueList(data) {\n          run(data);\n        }\n\n        ;\n\n        function failure(data) {\n          run(data);\n        }\n\n        ;\n\n        function run(data) {\n          var addEvents = function addEvents(dom, events) {\n            var addEvent = function addEvent(event, handler) {\n              dom.on(event, function (evt) {\n                handler({\n                  echart: evt,\n                  global: global,\n                  tools: data,\n                  ui: element\n                });\n              });\n            };\n\n            for (var i in events) {\n              addEvent(i, events[i]);\n            }\n\n            ;\n          };\n\n          setParameters(baseOption, data);\n          addEvents(innerContent, expression.$attr(\"on\"));\n\n          var setOptioin = function setOptioin(baseOption) {\n            if (element.$attr(\"parameters/vertical\") == true) {\n              var curInx = 0;\n              ulDom.children().remove();\n\n              var loop = function loop(i, series) {\n                var tab = $('<li><a>' + baseOption.legend.data[i] + '</a></li>');\n\n                var renderTbody = function renderTbody(data) {\n                  tbody.children().remove();\n\n                  for (var j in data) {\n                    var content = $(\"<tr></tr>\");\n                    ;\n                    var td1 = $(\"<td></td>\").css(\"width\", \"50%\").text(xAxis[j]);\n                    var td2 = $(\"<td></td>\").css(\"width\", \"50%\").text(data[j]);\n                    content.append(td1).append(td2);\n                    tbody.append(content);\n                  }\n                };\n\n                tab.css('cursor', 'pointer');\n                tab.data('inx', i);\n\n                if (i == curInx) {\n                  tab.addClass(\"active\");\n                }\n\n                ulDom.append(tab);\n                tab.on(\"click\", function () {\n                  ulDom.find(\"li\").removeClass('active');\n                  $(this).addClass('active');\n                  renderTbody(series[i].data);\n                });\n                renderTbody(series[i].data);\n              };\n\n              for (var i in baseOption.series) {\n                loop(i, baseOption.series);\n              }\n            } else {\n              tbody.children().remove();\n\n              var createTh = function createTh(xAxis) {\n                var tr = $('<tr></tr>');\n                tr.append($(\"<th></th>\").text(\"时间\"));\n\n                var createTd = function createTd(i, data) {\n                  var th = $(\"<th></th>\").text(data).css(\"text-align\", \"center\");\n\n                  if (i % 2 == 0) {\n                    th.css(\"background-color\", \"#eee\");\n                  }\n\n                  return th;\n                };\n\n                for (var i in xAxis) {\n                  tr.append(createTd(i, xAxis[i]));\n                }\n\n                return tr;\n              };\n\n              var createTr = function createTr(i, serie) {\n                var tr = $('<tr></tr>');\n                var th = $('<th></th>').css(\"color\", \"#3c8dbc\").css(\"text-align\", \"left\").text(baseOption.legend.data[i]);\n\n                var addTdDom = function addTdDom(inx, data) {\n                  var td = $('<td></td>').css(\"color\", \"#777\").css(\"text-align\", \"center\").css(\"font-weight\", \"bold\").text(data);\n\n                  if (i % 2 == 0) {\n                    td.css(\"background-color\", \"#eee\");\n                  }\n\n                  return td;\n                };\n\n                tr.append(th);\n                tbody.append(tr);\n\n                for (var i in serie.data) {\n                  tr.append(addTdDom(i, serie.data[i]));\n                }\n              };\n\n              tbody.append(createTh(baseOption.xAxis[0].data));\n\n              for (var i in baseOption.series) {\n                tbody.append(createTr(i, baseOption.series[i]));\n              }\n            }\n          };\n\n          if (_typeof(element.parameters) == \"object\") {\n            setParameters(baseOption, element.parameters, data);\n          }\n\n          ;\n          setOptioin(baseOption);\n        }\n\n        ;\n      };\n\n      element.getCiKpi(getCiKpi_back);\n    });\n    return innerContent;\n  };\n});"],"sourceRoot":"/source/"}