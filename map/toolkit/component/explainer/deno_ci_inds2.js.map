{"version":3,"sources":["toolkit/component/explainer/deno_ci_inds2.js"],"names":["define","simulate","data","tools","callback","nodesDes","kpisDes","group","instance","ci","kpi","rs","loop","children","instanceDic","ciKey","key","nodeId","id","value","find","elem","kpiCode","push","i","regroup","getSeries","formatter","gr","name","label","item","getLegend","nodes","kpis","legend","series"],"mappings":"AAGAA,OAAO,CAAC,YAAa,SAAUC,GAC7B,OAAO,SAAUC,EAAMC,EAAOC,GAC5B,IAAIC,EAAWF,EAAME,SACjBC,EAAUH,EAAMG,QA6DhBC,GA5DWJ,EAAMK,SACJL,EAAMF,SAET,SAAiBQ,EAAIC,GACjC,IAAIC,EAAK,GAELC,EAAO,SAAcF,GACvB,IAAIC,EAAK,CACPD,IAAKA,EACLG,SAAU,IAERC,EAAc,GAElB,IAAK,IAAIC,KAASN,EAEhB,IAAK,IAAIO,KAAOd,EAEVA,EAAKc,GAAKC,QAAUR,EAAGM,GAAOG,IAAOJ,EAAYZ,EAAKc,GAAKR,YAC7DM,EAAYZ,EAAKc,GAAKR,UAAY,CAACN,EAAKc,GAAKR,SAAUC,EAAGM,KAOhE,IAYIH,EAAO,SAAcH,GACvB,MAAO,CACLA,GAAIA,EAAG,GACPD,SAAUC,EAAG,GACbU,OAhB+BV,EAgBdA,EAhBkBC,EAgBdA,EAfnBU,EAAOlB,EAAKkB,KAAK,SAAUC,GAC7B,OAAOA,EAAKC,SAAWZ,EAAIQ,IAAMG,EAAKb,UAAYC,EAAG,IAAMY,EAAKJ,QAAUR,EAAG,GAAGS,KAG9EE,EACKA,EAAKD,MAEL,MARK,IAAmBV,EAAIC,EACjCU,GAmBN,IAAK,IAAIZ,KAAYM,EAEnBH,EAAGE,SAASU,KAAKX,EAAKE,EAAYN,KAGpC,OAAOG,GAGT,IAAK,IAAIa,KAAKd,EACZC,EAAGY,KAAKX,EAAKF,EAAIc,KAGnB,OAAOb,EAGGc,CAAQpB,EAAUC,IAE1BoB,EAAY,SAAmBC,GACjC,IAAIhB,EAAK,GAELC,EAAO,SAAcgB,GACvB,IAAIjB,EAAK,CACPkB,KAAMD,EAAGlB,IAAIoB,MACb5B,KAAM,IAGJU,EAAO,SAAcmB,GAavB,MAAO,CACLF,KAXsB,mBAAbF,EACFA,EAAU,CACflB,GAAIsB,EAAKtB,GAAGqB,MAAQ,IAAMC,EAAKvB,SAC/BE,IAAKkB,EAAGlB,IAAIoB,MACZX,MAAOY,EAAKZ,QAGPS,EAAGlB,IAAIoB,MAAQ,IAAMC,EAAKtB,GAAGqB,MAAQ,IAAMC,EAAKvB,SAKvDW,MAAOY,EAAKZ,QAIhB,IAAK,IAAIK,KAAKI,EAAGf,SACfF,EAAGT,KAAKqB,KAAKX,EAAKgB,EAAGf,SAASW,KAGhC,OAAOb,GAGT,IAAK,IAAIa,KAAKjB,EACZI,EAAGY,KAAKX,EAAKL,EAAMiB,KAIrB,OAAOb,GAGLqB,EAAY,SAAmBL,GACjC,IAAIhB,EAAK,GAELC,EAAO,SAAcgB,GACvB,IAAIhB,EAAO,SAAcmB,GAavB,MAVwB,mBAAbJ,EACFA,EAAU,CACflB,GAAIsB,EAAKtB,GAAGqB,MAAQ,IAAMC,EAAKvB,SAC/BE,IAAKkB,EAAGlB,IAAIoB,MACZX,MAAOY,EAAKZ,QAGPS,EAAGlB,IAAIoB,MAAQ,IAAMC,EAAKtB,GAAGqB,MAAQ,IAAMC,EAAKvB,UAM3D,IAAK,IAAIgB,KAAKI,EAAGf,SACfF,EAAGY,KAAKX,EAAKgB,EAAGf,SAASW,MAI7B,IAAK,IAAIA,KAAKjB,EACZK,EAAKL,EAAMiB,IAIb,OAAOb,GAaTP,EAVS,CACPsB,UAAWA,EACXM,UAAWA,EACX9B,KAAM,CACJ+B,MAAO5B,EACP6B,KAAM5B,EACN6B,OAAQH,IACRI,OAAQV","file":"toolkit/component/explainer/deno_ci_inds2.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine(['simulate'], function (simulate) {\n  return function (data, tools, callback) {\n    var nodesDes = tools.nodesDes;\n    var kpisDes = tools.kpisDes;\n    var instance = tools.instance;\n    var simulateFn = tools.simulate; //var data = simulate(\"ci\", nodesDes, kpisDes, instance, simulateFn);\n\n    var regroup = function regroup(ci, kpi) {\n      var rs = [];\n\n      var loop = function loop(kpi) {\n        var rs = {\n          kpi: kpi,\n          children: []\n        };\n        var instanceDic = {};\n\n        for (var ciKey in ci) {\n          //nodeIds\n          for (var key in data) {\n            //数据\n            if (data[key].nodeId == ci[ciKey].id && !instanceDic[data[key].instance]) {\n              instanceDic[data[key].instance] = [data[key].instance, ci[ciKey]]; //0 实例；1 node节点\n            }\n          }\n        }\n\n        ;\n\n        var findValue = function findValue(ci, kpi) {\n          var find = data.find(function (elem) {\n            return elem.kpiCode == kpi.id && elem.instance == ci[0] && elem.nodeId == ci[1].id;\n          });\n\n          if (find) {\n            return find.value;\n          } else {\n            return \"-\";\n          }\n        };\n\n        var loop = function loop(ci) {\n          return {\n            ci: ci[1],\n            instance: ci[0],\n            value: findValue(ci, kpi)\n          };\n        };\n\n        for (var instance in instanceDic) {\n          //ci为node节点          \n          rs.children.push(loop(instanceDic[instance]));\n        }\n\n        return rs;\n      };\n\n      for (var i in kpi) {\n        rs.push(loop(kpi[i]));\n      }\n\n      return rs;\n    };\n\n    var group = regroup(nodesDes, kpisDes);\n\n    var getSeries = function getSeries(formatter) {\n      var rs = [];\n\n      var loop = function loop(gr) {\n        var rs = {\n          name: gr.kpi.label,\n          data: []\n        };\n\n        var loop = function loop(item) {\n          var name;\n\n          if (typeof formatter == \"function\") {\n            name = formatter({\n              ci: item.ci.label + '-' + item.instance,\n              kpi: gr.kpi.label,\n              value: item.value\n            });\n          } else {\n            name = gr.kpi.label + \"-\" + item.ci.label + '-' + item.instance;\n          }\n\n          return {\n            name: name,\n            value: item.value\n          };\n        };\n\n        for (var i in gr.children) {\n          rs.data.push(loop(gr.children[i]));\n        }\n\n        return rs;\n      };\n\n      for (var i in group) {\n        rs.push(loop(group[i]));\n      }\n\n      ;\n      return rs;\n    };\n\n    var getLegend = function getLegend(formatter) {\n      var rs = [];\n\n      var loop = function loop(gr) {\n        var loop = function loop(item) {\n          var name;\n\n          if (typeof formatter == \"function\") {\n            name = formatter({\n              ci: item.ci.label + \"-\" + item.instance,\n              kpi: gr.kpi.label,\n              value: item.value\n            });\n          } else {\n            name = gr.kpi.label + \"-\" + item.ci.label + \"-\" + item.instance;\n          }\n\n          return name;\n        };\n\n        for (var i in gr.children) {\n          rs.push(loop(gr.children[i]));\n        }\n      };\n\n      for (var i in group) {\n        loop(group[i]);\n      }\n\n      ;\n      return rs;\n    };\n\n    var rs = {\n      getSeries: getSeries,\n      getLegend: getLegend,\n      data: {\n        nodes: nodesDes,\n        kpis: kpisDes,\n        legend: getLegend(),\n        series: getSeries()\n      }\n    };\n    callback(rs);\n  };\n});"],"sourceRoot":"/source/"}