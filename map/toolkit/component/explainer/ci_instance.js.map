{"version":3,"sources":["toolkit/component/explainer/ci_instance.js"],"names":["define","data","tools","callback","nodesDes","kpisDes","allInstance","group","ci","kpi","rs","loop","item","indexOf","instance","push","i","children","find","elem","kpiCode","id","nodeId","value","findValues","regroup","getSeries","formatter","gr","obj","name","label","getLegend","getxAxis","nodes","kpis","legend","series"],"mappings":"AAGAA,OAAO,GAAI,WACT,OAAO,SAAUC,EAAMC,EAAOC,GAC5B,IAAIC,EAAWF,EAAME,SACjBC,EAAUH,EAAMG,QAChBC,EAAc,GA4DdC,EA1DU,SAAiBC,EAAIC,GACjC,IAAIC,EAAK,GAELC,EAAO,SAAcC,IACoB,GAAvCN,EAAYO,QAAQD,EAAKE,WAC3BR,EAAYS,KAAKH,EAAKE,WAI1B,IAAK,IAAIE,KAAKf,EACZU,EAAKV,EAAKe,IAGRL,EAAO,SAAcH,GACvB,IAAIE,EAAK,CACPF,GAAIA,EACJS,SAAU,IAqBRN,EAAO,SAAcF,GACvB,MAAO,CACLA,IAAKA,EACLR,KArBa,SAAoBO,EAAIC,GACvC,IAAIC,EAAK,GAET,IAAK,IAAIM,KAAKV,EAAa,CACzB,IAAIY,EAAOjB,EAAKiB,KAAK,SAAUC,GAC7B,OAAOA,EAAKC,SAAWX,EAAIY,IAAMF,EAAKG,QAAUd,EAAGa,IAAMF,EAAKL,UAAYR,EAAYU,KAGpFE,EACFR,EAAGK,KAAKG,EAAKK,OAEbb,EAAGK,KAAK,KAIZ,OAAOL,EAMCc,CAAWhB,EAAIC,KAIzB,IAAK,IAAIO,KAAKP,EACZC,EAAGO,SAASF,KAAKJ,EAAKF,EAAIO,KAG5B,OAAON,GAGT,IAAK,IAAIM,KAAKR,EACZE,EAAGK,KAAKJ,EAAKH,EAAGQ,KAGlB,OAAON,EAGGe,CAAQrB,EAAUC,GAO1BqB,EAAY,SAAmBC,GACjC,IAAIjB,EAAK,GAELC,EAAO,SAAciB,GACvB,IAAIjB,EAAO,SAAcC,GACvB,IAAIiB,EAAM,CACRC,KAAMF,EAAGpB,GAAGuB,MAAQ,IAAMnB,EAAKH,IAAIsB,MACnC9B,KAAMW,EAAKX,MAEbS,EAAGK,KAAKc,IAGV,IAAK,IAAIb,KAAKY,EAAGX,SACfN,EAAKiB,EAAGX,SAASD,KAIrB,IAAK,IAAIA,KAAKT,EACZI,EAAKJ,EAAMS,IAGb,OAAON,GAGLsB,EAAY,SAAmBL,GACjC,IAAIjB,EAAK,GAELC,EAAO,SAAciB,GACvB,IAAIjB,EAAO,SAAcC,GAavB,MAVwB,mBAAbe,EACFA,EAAU,CACfnB,GAAIoB,EAAGpB,GAAGuB,MACVtB,IAAKG,EAAKH,IAAIsB,MACdR,MAAOX,EAAKW,QAGPK,EAAGpB,GAAGuB,MAAQ,IAAMnB,EAAKH,IAAIsB,OAMxC,IAAK,IAAIf,KAAKY,EAAGX,SACfP,EAAGK,KAAKJ,EAAKiB,EAAGX,SAASD,MAI7B,IAAK,IAAIA,KAAKT,EACZI,EAAKJ,EAAMS,IAGb,OAAON,GAcTP,EAXS,CACPuB,UAAWA,EACXO,SA/Da,SAAkBN,GAE/B,MADS,CAACrB,IA+DV0B,UAAWA,EACX/B,KAAM,CACJiC,MAAO9B,EACP+B,KAAM9B,EACN+B,OAAQJ,IACRK,OAAQX","file":"toolkit/component/explainer/ci_instance.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data, tools, callback) {\n    var nodesDes = tools.nodesDes;\n    var kpisDes = tools.kpisDes;\n    var allInstance = [];\n\n    var regroup = function regroup(ci, kpi) {\n      var rs = [];\n\n      var loop = function loop(item) {\n        if (allInstance.indexOf(item.instance) == -1) {\n          allInstance.push(item.instance);\n        }\n      };\n\n      for (var i in data) {\n        loop(data[i]);\n      }\n\n      var loop = function loop(ci) {\n        var rs = {\n          ci: ci,\n          children: []\n        };\n\n        var findValues = function findValues(ci, kpi) {\n          var rs = [];\n\n          for (var i in allInstance) {\n            var find = data.find(function (elem) {\n              return elem.kpiCode == kpi.id && elem.nodeId == ci.id && elem.instance == allInstance[i];\n            });\n\n            if (find) {\n              rs.push(find.value);\n            } else {\n              rs.push(\"-\");\n            }\n          }\n\n          return rs;\n        };\n\n        var loop = function loop(kpi) {\n          return {\n            kpi: kpi,\n            data: findValues(ci, kpi)\n          };\n        };\n\n        for (var i in kpi) {\n          rs.children.push(loop(kpi[i]));\n        }\n\n        return rs;\n      };\n\n      for (var i in ci) {\n        rs.push(loop(ci[i]));\n      }\n\n      return rs;\n    };\n\n    var group = regroup(nodesDes, kpisDes);\n\n    var getxAxis = function getxAxis(formatter) {\n      var rs = [allInstance];\n      return rs;\n    };\n\n    var getSeries = function getSeries(formatter) {\n      var rs = [];\n\n      var loop = function loop(gr) {\n        var loop = function loop(item) {\n          var obj = {\n            name: gr.ci.label + \"-\" + item.kpi.label,\n            data: item.data\n          };\n          rs.push(obj);\n        };\n\n        for (var i in gr.children) {\n          loop(gr.children[i]);\n        }\n      };\n\n      for (var i in group) {\n        loop(group[i]);\n      }\n\n      return rs;\n    };\n\n    var getLegend = function getLegend(formatter) {\n      var rs = [];\n\n      var loop = function loop(gr) {\n        var loop = function loop(item) {\n          var name;\n\n          if (typeof formatter == \"function\") {\n            name = formatter({\n              ci: gr.ci.label,\n              kpi: item.kpi.label,\n              value: item.value\n            });\n          } else {\n            name = gr.ci.label + \"-\" + item.kpi.label;\n          }\n\n          return name;\n        };\n\n        for (var i in gr.children) {\n          rs.push(loop(gr.children[i]));\n        }\n      };\n\n      for (var i in group) {\n        loop(group[i]);\n      }\n\n      return rs;\n    };\n\n    var rs = {\n      getSeries: getSeries,\n      getxAxis: getxAxis,\n      getLegend: getLegend,\n      data: {\n        nodes: nodesDes,\n        kpis: kpisDes,\n        legend: getLegend(),\n        series: getSeries()\n      }\n    };\n    callback(rs);\n  };\n});"],"sourceRoot":"/source/"}