{"version":3,"sources":["toolkit/component/explainer/scatterMap_kangda.js"],"names":["define","data","tools","callback","nodesDes","kpisDes","item","kpiDataService","resourceUIService","series","name","getLegend","getSeries","resources","modelIds","deviceStatusKpi","finished","kpiQueryModel","kpis","concat","map","elem","id","event","code","loop","obj","online","find","el","nodeId","kpiCode","status","deviceStatus","some","ele","values","standardAddress","label","value","longitude","latitude","indexOf","push","i","category","isRealTimeData","nodeIds","kpiCodes","startTime","endTime","timeRange","statisticType","includeInstance","condList","getValueList","modelId","repeat","inx","getKpisByModelId"],"mappings":"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","file":"toolkit/component/explainer/scatterMap_kangda.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data, tools, callback) {\n    ;\n    var nodesDes = tools.nodesDes;\n    var kpisDes = tools.kpisDes;\n    var kpiDataService = tools.kpiDataService;\n    var resourceUIService = tools.resourceUIService;\n    var series = [{\n      name: \"highlight\",\n      data: []\n    }, {\n      name: \"正常\",\n      data: []\n    }, {\n      name: \"机组状态\",\n      data: []\n    }, {\n      name: \"警告告警\",\n      data: []\n    }, {\n      name: \"主要告警\",\n      data: []\n    }, {\n      name: \"重要告警\",\n      data: []\n    }, {\n      name: \"离线设备\",\n      data: []\n    }, {\n      name: \"select\",\n      data: []\n    }];\n\n    var getLegend = function getLegend() {\n      return ['正常', '机组状态', '警告告警', '主要告警', '重要告警', '离线设备'];\n    };\n\n    var getKpiValue = function getKpiValue(nodes, kpis, callback) {\n      var kpiQueryModel = {\n        category: \"ci\",\n        isRealTimeData: true,\n        nodeIds: nodes,\n        kpiCodes: kpis,\n        startTime: null,\n        endTime: null,\n        timeRange: \"\",\n        statisticType: \"psiot\",\n        includeInstance: true,\n        condList: []\n      };\n      kpiDataService.getValueList([\"kpi\", kpiQueryModel], callback);\n    };\n\n    var getSeries = function getSeries() {\n      return series;\n    };\n\n    var resources = [];\n    var modelIds = [];\n    var deviceStatusKpi = [];\n\n    var loop = function loop(item) {\n      resources.push(item.id);\n\n      if (modelIds.indexOf(item.modelId) == -1) {\n        modelIds.push(item.modelId);\n      }\n    };\n\n    var j = 0;\n\n    var finished = function finished() {\n      var kpis = [999998, 999999].concat(deviceStatusKpi.map(function (elem) {\n        return elem.id;\n      }));\n      getKpiValue(resources, kpis, function (event) {\n        if (event.code == 0) {\n          var loop = function loop(item) {\n            var obj = {};\n            var online = event.data.find(function (el) {\n              return el.nodeId == item.id && el.kpiCode == \"999998\";\n            });\n            var status = event.data.find(function (el) {\n              return el.nodeId == item.id && el.kpiCode == \"999999\";\n            });\n            var deviceStatus = event.data.find(function (el) {\n              return el.nodeId == item.id && deviceStatusKpi.some(function (ele) {\n                return ele.id == el.kpiCode;\n              });\n            });\n\n            if (item.values.standardAddress) {\n              obj.name = item.values.standardAddress;\n              obj.label = item.label;\n              obj.value = [item.values.longitude, item.values.latitude];\n              obj.id = item.id;\n              obj.status = status ? status.value : 0;\n              obj.online = online ? online.value : 0;\n              obj.deviceStatus = deviceStatus ? deviceStatus.value : 0;\n\n              if (obj.label.indexOf(\"铅山温氏\") != -1 || obj.label.indexOf(\"永丰温氏\") != -1) {\n                ;\n              }\n\n              if (obj.online == 0) {\n                //series[2].data.push(obj);\n                series[6].data.push(obj);\n              } else {\n                if (obj.deviceStatus == 0) {\n                  series[1].data.push(obj);\n                } else {\n                  if (obj.status < 1) {\n                    series[2].data.push(obj);\n                  } else if (obj.status < 2) {\n                    series[3].data.push(obj);\n                  } else if (obj.status < 3) {\n                    series[4].data.push(obj);\n                  } else if (obj.status < 4) {\n                    series[5].data.push(obj);\n                  }\n\n                  ;\n                } //series[1].data.push(obj);\n                //series[2].data.push(obj);\n\n              }\n            }\n          };\n\n          for (var i in data) {\n            loop(data[i]);\n          }\n\n          callback({\n            getLegend: getLegend,\n            getSeries: getSeries,\n            data: {\n              series: getSeries()\n            }\n          });\n        }\n      });\n    };\n\n    var repeat = function repeat(inx) {\n      var modelId = modelIds[inx];\n\n      if (modelId) {\n        resourceUIService.getKpisByModelId(modelId, function (event) {\n          if (event.code == 0) {\n            var find = event.data.find(function (elem) {\n              return elem.label == \"Device_Status\";\n            });\n\n            if (find) {\n              deviceStatusKpi.push(find);\n            }\n\n            inx++;\n            repeat(inx);\n          }\n\n          ;\n        });\n      } else {\n        finished();\n      }\n    };\n\n    for (var i in data) {\n      loop(data[i]);\n    }\n\n    ;\n    repeat(j);\n  };\n});"],"sourceRoot":"/source/"}