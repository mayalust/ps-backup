{"version":3,"sources":["toolkit/component/multiselect.js"],"names":["define","commonMethod","data","self","regExp","getValue","str","item","test","val","$$","runRegExp","eval","autoload","resourceUIService","dictionaryService","global","element","timeout","serviceCenterService","userLoginUIService","customMethodService","viewFlexService","wrap","$","addClass","addOn","css","b","append","select","condition","expression","runExpression","advance","funRes","code","Error","message","fnResult","getResources","callback","event","getKpisByModelId","modelId","getCurrentProjects","getDomainsByFilter","$attr","undefined","attr","removeAttr","style","method","setCondition","cond","renderData","params","i","push","tools","ui","run","initFn","target","e","render","getModels","id","label","concat","getDevices","getEnterpriseDomainsByFilter","layer","unshift","getAllDicts","returnObj","forEach","dictCode","param","getViewByProjectId","resId","getViewsOnlyPublishedByTypeAndDomainPath","user","domainPath","find","view","template","resourceType","resourceId","getViewById","viewId","getSelect","arr","each","index","ele","loop","formatter","value","text","children","remove","loadExternalJs","multiselect","buttonWidth","parent","width","buttonText","options","length","selected","this","substr","onChange","elem","checked","changeFn","values"],"mappings":"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","file":"toolkit/component/multiselect.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine(['commonMethod'], function (commonMethod) {\n  return function (data) {\n    var self = new commonMethod(data);\n    var regExp = /\\{item\\:(\\w+)\\}/;\n\n    var getValue = function getValue(str, item) {\n      if (regExp.test(str)) {\n        var val = $$.runRegExp(str, regExp, 1);\n      } else {\n        var val = str;\n      }\n\n      ;\n\n      if (val) {\n        return eval(\"item.\" + val);\n      } else {\n        return val;\n      }\n    };\n\n    var autoload = true;\n    var resourceUIService = data.resourceUIService;\n    var dictionaryService = data.dictionaryService;\n    var global = data.global;\n    var element = data.element;\n    var timeout = data.timeout;\n    var serviceCenterService = data.serviceCenterService;\n    var resourceUIService = data.resourceUIService;\n    var userLoginUIService = data.userLoginUIService;\n    var customMethodService = data.customMethodService;\n    var viewFlexService = data.viewFlexService;\n    var wrap = $(\"<div></div>\").addClass(\"input-group btn-group\");\n    var addOn = $(\"<button></button>\").addClass(\"btn btn-default\").css(\"padding\", \"6px 12px\");\n    var b = $(\"<b></b>\").addClass(\"glyphicon glyphicon-refresh\");\n    addOn.append(b);\n    var select = $(\"<select></select>\").addClass(\"multiselect\");\n    wrap.append(select); //wrap.append(addOn);\n\n    var condition;\n    $$.runExpression(element.advance.condition, function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n\n        if (typeof fnResult == 'function') {\n          condition = fnResult(data);\n        } else {\n          condition = fnResult;\n        }\n\n        condition = condition ? condition : {};\n      } else {\n        throw new Error(funRes.message);\n      }\n    });\n    var expression;\n    $$.runExpression(element.advance.expression, function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n\n        if (typeof fnResult == 'function') {\n          expression = fnResult(data);\n        } else {\n          expression = fnResult;\n        }\n\n        expression = expression ? expression : {};\n      } else {\n        expression = {};\n        ; //throw new Error(funRes.message);\n      }\n    });\n\n    self.getResources = function (callback) {\n      resourceUIService.getResources(function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    self.getKpisByModelId = function (modelId, callback) {\n      resourceUIService.getKpisByModelId(modelId, function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    self.getCurrentProjects = function (callback) {\n      resourceUIService.getDomainsByFilter({\n        modelId: 302\n      }, function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    if (expression) {\n      autoload = expression.$attr(\"formatter/autoload\");\n\n      if (autoload == undefined) {\n        autoload = true;\n      }\n    }\n\n    if (expression.$attr(\"type\") == \"multiple\") {\n      select.attr(\"multiple\", \"multiple\");\n    } else {\n      select.removeAttr(\"multiple\");\n    }\n\n    ;\n\n    if (element.style) {\n      wrap.css(element.style);\n    }\n\n    ; //var method = element.$attr(\"advance/getfunction\") ? element.$attr(\"advance/getfunction\") : 'kpiDataService.getValueList';\n\n    var method = element.$attr(\"advance/getMultiSelect\");\n\n    element.setCondition = function (cond) {\n      condition = cond;\n    };\n\n    element.renderData = function () {\n      var params = [];\n\n      var loop = function loop(item) {\n        if (typeof item == \"function\") {\n          return item({\n            global: global,\n            tools: data,\n            ui: element\n          });\n        } else {\n          return item;\n        }\n      };\n\n      for (var i in condition) {\n        params.push(loop(condition[i]));\n      }\n\n      ;\n\n      var run = function run(data) {\n        var initFn = expression.$attr(\"on/init\");\n\n        if (typeof initFn == \"function\") {\n          try {\n            initFn({\n              global: global,\n              target: element,\n              self: self,\n              tools: data,\n              ui: element\n            });\n          } catch (e) {\n            ;\n          }\n\n          ;\n        } else {\n          element.render(data);\n        }\n\n        ;\n      };\n\n      if (method == 'models') {\n        resourceUIService.getModels(function (event) {\n          if (event.code == 0) {\n            var allModels = [{\n              id: \"\",\n              label: \"全部\"\n            }];\n            run(allModels.concat(event.data));\n          }\n\n          ;\n        });\n      } else if (method == 'devices') {\n        resourceUIService.getDevices(function (event) {\n          if (event.code == 0) {\n            run(event.data);\n          }\n        });\n      } else if (method == 'projects') {\n        resourceUIService.getDomainsByFilter({\n          modelId: 302\n        }, function (event) {\n          if (event.code == 0) {\n            run(event.data);\n          }\n        });\n      } else if (method == 'domains') {\n        resourceUIService.getDomainsByFilter({\n          modelId: 300\n        }, function (event) {\n          if (event.code == 0) {\n            run(event.data);\n          }\n        });\n      } else if (method == 'enterprises') {\n        resourceUIService.getEnterpriseDomainsByFilter({\n          modelId: 303,\n          layer: 2\n        }, function (event) {\n          if (event.code == 0) {\n            event.data.unshift({\n              id: '',\n              label: '请选择'\n            });\n            run(event.data);\n          }\n        });\n      } else if (method == 'industrys') {\n        dictionaryService.getAllDicts(function (returnObj) {\n          if (returnObj.code == 0) {\n            var data = [];\n            returnObj.data.forEach(function (item) {\n              if (item.dictCode == 'industryShortType') {\n                item.id = item.label;\n                data.push(item);\n              }\n            });\n            data.unshift({\n              id: 0,\n              label: '请选择',\n              param: '请选择'\n            });\n            run(data);\n          }\n        });\n      } else if (method == 'energys') {\n        dictionaryService.getAllDicts(function (returnObj) {\n          if (returnObj.code == 0) {\n            var data = [];\n            returnObj.data.forEach(function (item) {\n              if (item.dictCode == 'energyType') {\n                item.id = item.label;\n                data.push(item);\n              }\n            });\n            data.unshift({\n              id: 0,\n              label: '请选择'\n            });\n            run(data);\n          }\n        });\n      }\n      /**\n      if(method.indexOf(\"serviceCenterService\") == -1){\n        params.push(function(event){\n          if(event.code == 0){\n            run(event.data);\n          }\n        });\n       //;\n        eval(method).apply(null, params)\n      } else {\n        var success = function(dt){\n          run(dt);\n        };\n        var call = method + \"(\" + params.toString() +  \")\";\n        //;\n        eval(call).then(success);\n      }\n       */\n\n    };\n\n    self.getViewByProjectId = function (resId, callback) {\n      //viewFlexService.getAllMyViews(function(event){\n      viewFlexService.getViewsOnlyPublishedByTypeAndDomainPath('configure', userLoginUIService.user.domainPath, function (event) {\n        var views = event.data;\n        var find = views.find(function (view) {\n          if (view.template) {\n            if (view.template.resourceType == \"project\") {\n              if (view.template.resourceId == resId) {\n                return true;\n              }\n            }\n          }\n\n          return false;\n        });\n\n        if (find) {\n          viewFlexService.getViewById(find.viewId, function (event) {\n            if (event.code == 0) {\n              callback(event.data);\n            }\n          });\n        } else {\n          callback(null);\n        }\n      });\n    };\n\n    element.render = function (data) {\n      var cur = this;\n\n      var getSelect = function getSelect() {\n        var arr = [];\n        var filter = wrap.find(\"ul.dropdown-menu li.active\");\n        filter.each(function (index, element) {\n          var target = $(element).find(\"input\");\n          var find = data.find(function (ele) {\n            return ele.id == target.attr(\"value\");\n          });\n          arr.push(find);\n        });\n        return arr;\n      };\n\n      element.getSelect = getSelect;\n\n      var loop = function loop(item) {\n        var formatter = expression.$attr(\"formatter\");\n\n        if (formatter) {\n          var label = getValue(formatter.label, item);\n          var value = getValue(formatter.value, item);\n        }\n\n        ;\n        var option = $(\"<option></option>\").attr(\"value\", value).text(label);\n        return option;\n      };\n\n      select.children().remove();\n\n      for (var i in data) {\n        select.append(loop(data[i]));\n      }\n\n      var domready = function domready() {\n        var toolReady = function toolReady(multiselect) {\n          var buttonText = function buttonText(options) {\n            if (options.length == 0) {\n              return '无做出任何选择';\n            } else if (options.length > 1) {\n              return \"已选择\" + options.length + \"个\";\n            } else {\n              var selected = '';\n              options.each(function () {\n                selected += $(this).text() + ', ';\n              });\n              return selected.substr(0, selected.length - 2);\n            }\n          };\n\n          var onChange = function onChange(elem, checked) {\n            var changeFn = expression.$attr(\"on/change\");\n            var values = 1;\n\n            if (typeof changeFn == \"function\") {\n              try {\n                changeFn({\n                  target: element,\n                  element: element,\n                  global: global,\n                  tools: data,\n                  self: self,\n                  values: getSelect(),\n                  ui: {\n                    values: getSelect()\n                  }\n                });\n              } catch (e) {\n                ;\n              }\n            }\n          };\n\n          select.multiselect('destroy');\n          select.multiselect({\n            buttonWidth: wrap.parent().width(),\n            buttonText: buttonText,\n            onChange: onChange\n          });\n          /**\n          addOn.on(\"click\", function(event){\n            ;\n          });*/\n        };\n\n        $$.loadExternalJs([\"bootstrap-multiselect\"], toolReady);\n      };\n\n      timeout(domready);\n    };\n\n    self.render = element.render;\n\n    if (autoload) {\n      element.renderData();\n    }\n\n    return wrap;\n  };\n});"],"sourceRoot":"/source/"}