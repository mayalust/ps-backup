{"version":3,"sources":["toolkit/component/dropdowntree.js"],"names":["define","$","fn","dropdowntree","obj","options","select","format","addClass","value","key","mark","children","placeholder","wraps","container","attr","css","childrenDom","changeFn","change","on","event","preventDefault","append","docClick","off","removeClass","hasClass","setTimeout","this","traverse","level","forEach","child","wrap","handler","label","data","clone","inx","text","i","push","remove","elem","trigger","stopPropagation","animate","height","opacity","display","position"],"mappings":"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","file":"toolkit/component/dropdowntree.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  $.fn.dropdowntree = function (obj) {\n    var options = obj.options || {};\n    var format = obj.format || {\n      \"id\": \"id\",\n      \"children\": \"children\"\n    };\n    var select = $(\"<select></select>\").addClass(\"form-control\");\n    var value = obj.value;\n    var key = obj.format.key || \"id\";\n    var mark = obj.format.children || \"children\";\n    var placeholder = obj.placeholder || \"请选择...\";\n    var wraps = [];\n    var container = $(\"<div></div>\").attr(\"id\", \"container\").addClass(\"noview\").css(\"border-top\", \"1px solid #ddd\");\n    var childrenDom = $(\"<div></div>\").addClass(\"children\");\n    var changeFn = obj.change;\n    ;\n    select.on(\"mousedown\", function (event) {\n      event.preventDefault();\n    });\n    select.append($(\"<option id='selectlabel' value='selectlabel'>\" + placeholder + \"</option>\"));\n    select.on(\"click\", function (event) {\n      if (container.hasClass(\"noview\")) {\n        container.removeClass(\"noview\");\n        select.addClass(\"extend\");\n        setTimeout(function () {\n          $('body').on(\"click.body\", docClick);\n        });\n      }\n\n      function docClick() {\n        container.addClass(\"noview\");\n        $('body').off(\"click.body\");\n        select.removeClass(\"extend\");\n      }\n    });\n    container.append(childrenDom);\n    this.append(select);\n    this.append(container);\n    this.addClass(\"dropdowntree\");\n    traverse(options[mark], childrenDom, 1);\n\n    function traverse(children, container, level) {\n      children.forEach(function (child) {\n        var wrap = $(\"<div></div>\").addClass(\"wrap\");\n        var handler = $(\"<div></div>\").addClass(\"glyphicon\");\n        var label = $(\"<span></span>\").addClass(\"labeltxt\");\n        var childrenDom = $(\"<div></div>\").addClass(\"children\");\n        var find = false;\n        var children = child[mark];\n        /**\n        var checkhasViewId = function(child){\n          if(child.viewId == scope.ngModel){\n            return true;\n          } else {\n            if(child.hasOwnProperty(mark)){\n              var checkViewId = function(chd){\n                return checkhasViewId(chd);\n              };\n              for(var i in child[mark]){\n                if(checkViewId(child[mark][i])){\n                  return true;\n                }\n              }\n            }\n          }\n          return false;\n        };*/\n\n        handler.data(\"children\", children);\n        var lb = 'label';\n        child.label = child[lb];\n        label.text(child.label ? child.label : child.text);\n\n        for (var i = 0; i <= level; i++) {\n          (function (clone, inx) {\n            if (inx == level - 1) {\n              clone.addClass(\"last\");\n            }\n\n            clone.css(\"left\", 10 + inx * 8 + \"px\");\n            wrap.append(clone);\n          })($(\"<div></div>\").addClass(\"vline\"), i);\n        }\n\n        wrap.append(handler);\n        wrap.append(label);\n        wrap.attr(key, child[key]);\n        wrap.css(\"padding-left\", level * 8 + \"px\");\n        wraps.push(wrap);\n        container.append(wrap);\n\n        if (child[key] == value) {\n          select.children().remove();\n          select.append($(\"<option id='selectlabel' value='selectlabel'>\" + (child.label ? child.label : \"请选择...\") + \"</option>\"));\n          wrap.removeClass(\"active\");\n          wrap.addClass(\"active\");\n        }\n\n        ;\n        wrap.on(\"click\", function (event) {\n          if (typeof changeFn == \"function\") {\n            changeFn({\n              data: child\n            });\n          }\n\n          ;\n          select.children().remove();\n          select.append($(\"<option id='selectlabel' value='selectlabel'>\" + (child.label ? child.label : \"请选择...\") + \"</option>\"));\n          wraps.forEach(function (elem) {\n            elem.removeClass(\"active\");\n          });\n          wrap.addClass(\"active\");\n          /**\n          if(attr.hasOwnProperty(\"model\")) {\n            attr[\"model\"] = child[key];\n            $(element).attr(\"model\", child[key]);\n          } else {\n            scope.ngModel = child[key];\n          }*/\n\n          $('body').trigger(\"click.body\");\n        });\n\n        if (children) {\n          /**\n          if(checkhasViewId(child) == false){\n            childrenDom.addClass(\"hidechildren\");\n            handler.addClass(\"glyphicon-plus\");\n          } else {\n            handler.addClass(\"glyphicon-minus\");\n          }*/\n          handler.addClass(\"glyphicon-minus\");\n          handler.on(\"click\", function (event) {\n            event.stopPropagation();\n\n            if (handler.hasClass(\"glyphicon-minus\")) {\n              handler.removeClass(\"glyphicon-minus\").addClass(\"glyphicon-plus\");\n              childrenDom.css(\"overflow\", \"hidden\");\n              childrenDom.animate({\n                \"height\": \"100%\",\n                opacity: 0\n              }, 300, function () {\n                childrenDom.css({\n                  display: \"none\"\n                }).css(\"overflow\", \"auto\");\n              });\n            } else {\n              handler.removeClass(\"glyphicon-plus\").addClass(\"glyphicon-minus\");\n              childrenDom.css(\"overflow\", \"hidden\").css(\"display\", \"block\");\n              childrenDom.animate({\n                \"height\": \"100%\",\n                \"position\": \"absolute\",\n                opacity: 1\n              }, 300);\n            }\n          });\n          container.append(childrenDom);\n          traverse(children, childrenDom, level + 1);\n        } else {\n          handler.addClass(\"glyphicon glyphicon-duplicate\").css(\"opacity\", 0);\n        }\n      });\n    }\n\n    ;\n  };\n\n  return null;\n});"],"sourceRoot":"/source/"}