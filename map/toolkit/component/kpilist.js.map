{"version":3,"sources":["toolkit/component/kpilist.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","commonMethod","data","modeType","elemData","kpiDes","global","growl","element","self","SwSocket","serviceCenterService","webSocket","$attr","getoption","colwidth","formstyle","$$","runExpression","funRes","code","Error","message","fnResult","expression","system","resourceUIService","type","list","innerContent","$","addClass","initFn","socket","find","elem","kpiCode","dom","utext","attr","text","value","render","children","remove","arr","loop","kdef","val","id","units","getAll","then","ufind","el","unitCode","unit","domUnit","unitName","wrap","col_r_inner","row","col_l","css","label","col_r","on","event","hasClass","directives","getBymodelId","modelId","Array","com","kpiDefinitionIds","indexOf","param","params","sendDeviceDirective","nodes","removeClass","append","push","loop1","item","format","format1","format2","regExp","val1","runRegExp","val2","kpiUnit","subname","selclass","style","k","selclass_inner","length","i","err","target","tools","e","getCiKpi","resources","kpisData","map","kpis","paramSocket","ciid","toString","kpi","uuid","Math","operation","register","send","getValues","error"],"mappings":"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","file":"toolkit/component/kpilist.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/**\n * Created by leonlin on 16/11/3.\n */\ndefine(['commonMethod'], function (commonMethod) {\n  return function (data) {\n    var elemData = data;\n    var kpiDes = [],\n        modeType;\n    var global = data.global;\n    var growl = data.growl;\n    var element = data.element;\n    var self = new commonMethod(data);\n    var SwSocket = data.SwSocket;\n    var serviceCenterService = data.serviceCenterService;\n    var webSocket = element.$attr(\"parameters/webSocket\");\n    var expression;\n    var getoption = element.$attr(\"advance/getoption\");\n    var colwidth = element.$attr(\"parameters/colwidth\");\n    var formstyle = element.$attr(\"parameters/itemstyle\");\n    $$.runExpression(element.$attr(\"advance/expression\"), function (funRes) {\n      if (funRes.code == \"0\") {\n        var fnResult = funRes.data;\n\n        if (typeof fnResult == 'function') {\n          expression = fnResult(data, system);\n        } else {\n          expression = fnResult;\n        }\n\n        expression = expression ? expression : {};\n      } else {\n        throw new Error(funRes.message);\n      }\n    });\n    var resourceUIService = data.resourceUIService;\n    var expression;\n    ;\n\n    if (expression) {\n      modeType = expression.type;\n    }\n\n    ;\n    var list = [];\n    var innerContent = $(\"<div></div>\").addClass(\"free-board-kpilist-\" + formstyle).addClass(\"row\");\n    var initFn = expression.$attr(\"on/init\");\n\n    element.socket = function (data) {\n      if (webSocket) {\n        var find = list.find(function (elem) {\n          return elem.data(\"kpiId\") == data.kpiCode;\n        });\n\n        if (find) {\n          var dom = find.find(\"#col-value\");\n          var utext = find.attr(\"unit\");\n\n          if (utext) {\n            dom.text(data.value + \" \" + utext);\n          } else {\n            dom.text(data.value);\n          }\n        }\n      }\n    };\n\n    element.render = function (data) {\n      innerContent.children().remove();\n      var arr = data;\n\n      var loop = function loop(kdef) {\n        var val = arr.find(function (elem) {\n          return elem.kpiCode == kdef.id;\n        });\n\n        var allUnit = function allUnit(units) {\n          var ufind = units.find(function (el) {\n            return el.unitCode == kdef.unit;\n          });\n          var value = val ? val.value : \"-\";\n          var domUnit = \"\";\n\n          if (ufind && ufind.unitName != \" \") {\n            domUnit = ufind.unitName;\n            value = value + (\" \" + ufind.unitName);\n          } else {\n            value = value;\n          }\n\n          ;\n          var wrap = $(\"<div></div>\").addClass(\"col-md-\" + 12 / colwidth).attr(\"unit\", domUnit);\n          wrap.data(\"kpiId\", kdef.id);\n          var row = $(\"<div></div>\").addClass(\"row\");\n          var col_l = $(\"<div></div>\").addClass(\"col-md-6\").css(\"line-height\", \"30px\").css(\"font-weight\", \"bold\").css(\"color\", \"#888\").css(\"padding\", \"5px 15px\").text(kdef.label);\n          var col_r = $(\"<div></div>\").addClass(\"col-md-6 col-right\");\n          var col_r_inner;\n\n          if (modeType == 'button') {\n            var col_r_inner = $(\"<button></button>\").addClass(\"btn btn-primary\");\n            col_r_inner.text(\"复位\");\n\n            if (value == 1) {\n              col_r_inner.addClass(\"active\");\n            }\n\n            col_r_inner.on(\"click\", function (event) {\n              var value = col_r_inner.hasClass(\"active\") ? 0 : 1;\n              serviceCenterService.directives.getBymodelId(modelId).then(function success(event) {\n                if (event instanceof Array) {\n                  var com = event.find(function (elem) {\n                    return elem.kpiDefinitionIds.indexOf(kdef.id) != -1;\n                  });\n\n                  if (com) {\n                    var param = {};\n                    param[com.params[0].label] = value;\n\n                    if (com) {\n                      resourceUIService.sendDeviceDirective(nodes[0], com.id, param, function (event) {\n                        ;\n                      });\n                    }\n                  } else {}\n                }\n              });\n\n              if (col_r_inner.hasClass(\"active\")) {\n                col_r_inner.removeClass(\"active\");\n              } else {\n                col_r_inner.addClass(\"active\");\n              }\n            });\n          } else {\n            col_r_inner = $(\"<div></div>\").attr(\"id\", \"col-value\").addClass(\"col-right-inner\").text(value);\n          }\n\n          col_r.append(col_r_inner);\n          row.append(col_l).append(col_r);\n          wrap.append(row);\n          innerContent.append(wrap);\n          list.push(wrap);\n        };\n\n        serviceCenterService.units.getAll().then(allUnit);\n      };\n\n      var loop1 = function loop1(item) {\n        var format = expression.format;\n        var format1 = format[0].value;\n        var format2 = format[1].value;\n        var regExp = /\\{item:(.*)\\}/;\n        var val1 = $$.runRegExp(format1, regExp, 1);\n        var val2 = $$.runRegExp(format2, regExp, 1);\n        var value = item ? item[val2] : \"-\";\n\n        if (item.kpiUnit) {\n          value = value + \" \" + item.kpiUnit;\n        }\n\n        var wrap = $(\"<div></div>\").addClass(\"col-md-\" + 12 / colwidth).attr(\"unit\", item.kpiUnit);\n        wrap.data(\"kpiId\", item.kpiCode);\n        var row = $(\"<div></div>\").addClass(\"row\");\n        var col_l = $(\"<div></div>\").text(item[val1] + (format[0].subname ? format[0].subname : '')); //如果标签有class设置\n\n        if (format[0].selclass) {\n          col_l.addClass(format[0].selclass);\n        } else {\n          col_l.addClass(\"col-md-6\");\n        } //如果标签有css设置\n\n\n        if (format[0].style) {\n          for (var k in format[0].style) {\n            col_l.css(k, format[0].style[k]);\n          }\n        } else {\n          col_l.css(\"line-height\", \"30px\").css(\"font-weight\", \"bold\").css(\"color\", \"#888\").css(\"padding\", \"5px 15px\");\n        } //标签上不带单位了\n        //.text(item.kpiUnit ? item[val1] + (\" (\" + item.kpiUnit + \")\") : item[val1]);\n\n\n        var col_r = $(\"<div></div>\"); //如果内容外框有class设置\n\n        if (format[1].selclass) {\n          col_r.addClass(format[1].selclass);\n        } else {\n          col_r.addClass(\"col-md-6 col-right\");\n        }\n\n        var col_r_inner;\n        col_r_inner = $(\"<div></div>\").attr(\"id\", \"col-value\").text(value); //如果内容内框有class设置\n\n        if (format[1].selclass_inner) {\n          col_r_inner.addClass(format[1].selclass_inner);\n        } else {\n          col_r_inner.addClass(\"col-right-inner\");\n        } //如果标签有css设置\n\n\n        if (format[1].style) {\n          for (var k in format[1].style) {\n            col_r_inner.css(k, format[1].style[k]);\n          }\n        }\n\n        col_r.append(col_r_inner);\n        row.append(col_l).append(col_r);\n        wrap.append(row);\n        innerContent.append(wrap);\n        list.push(wrap);\n      };\n\n      if (kpiDes.length > 0) {\n        for (var i in kpiDes) {\n          loop(kpiDes[i]);\n        }\n      } else if (data.length > 0) {\n        for (var i in data) {\n          loop1(data[i]);\n        }\n      } else {\n        var err = $(\"<div></div>\");\n        err.css(\"text-align\", \"center\");\n        err.css(\"background-color\", \"#fff\");\n        err.css(\"padding\", \"10px\");\n        err.text(\"没有符合条件的记录。\");\n        innerContent.append(err);\n      }\n\n      ;\n    };\n\n    if (typeof initFn == \"function\") {\n      ;\n\n      try {\n        initFn({\n          target: element,\n          global: global,\n          self: self,\n          tools: elemData\n        });\n      } catch (e) {\n        ;\n      }\n\n      ;\n    } else {\n      ;\n\n      if (getoption == \"selected-kpi\") {\n        var getCiKpi_back = function getCiKpi_back(resources, kpisData) {\n          var nodes = resources.map(function (element) {\n            return element.id;\n          });\n          kpiDes = kpisData;\n          var kpis = kpiDes.map(function (element) {\n            if (_typeof(element) == \"object\") {\n              return element.id;\n            } else {\n              return element;\n            }\n          });\n          var paramSocket = {\n            ciid: nodes.toString(),\n            kpi: kpis.toString()\n          };\n          var uuid = Math.uuid();\n          var operation = \"register\";\n          SwSocket.register(uuid, operation, function (event) {\n            element.socket(event.data);\n          });\n          SwSocket.send(uuid, operation, 'kpi', paramSocket);\n          serviceCenterService.getValues(nodes, kpis).then(element.render, function error(err) {\n            growl.error(err);\n          });\n        };\n\n        self.getCiKpi(getCiKpi_back);\n      }\n    }\n\n    ; //;\n    //innerContent[0].onclick = function(){\n    //  ;\n    //};\n\n    return innerContent;\n  };\n});"],"sourceRoot":"/source/"}