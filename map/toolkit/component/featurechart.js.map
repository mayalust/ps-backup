{"version":3,"sources":["toolkit/component/featurechart.js"],"names":["define","data","wrap","$","css","position","width","element","index","chartOptionService","timeout","echartDom","echartAlert","button","margin","append","style","$$","loadExternalJs","echarts","_repeat","renderChart","linechart","target","init","pres_xAxis","pres_data1","pres_data2","inx","setTitle","text","xAxis","start","Date","getTime","parameters","type","data1","data2","i","Math","round","random","tg","push","setTimeformat","setLegend","setxAxis","xAxis_formatted","getxAxis","setSeries","name","smooth","markLine","label","normal","show","lineStyle","color","yAxis","itemStyle","markArea","length","option","returnOption","max","min","setOption","on","event","cur","currentTarget","slice","removeClass","addClass","undefined","window","resize"],"mappings":"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","file":"toolkit/component/featurechart.js","sourcesContent":["/**\n * Created by leonlin on 16/11/3.\n */\ndefine([], function () {\n  return function (data) {\n    var wrap = $(\"<div></div>\").css({\n      position: \"relative\",\n      width: \"100%\"\n    });\n    var index = data.index;\n    var element = data.element;\n    var chartOptionService = data.chartOptionService;\n    var timeout = data.timeout;\n    /*\n    var linData = {\n      label : \"选择监测类型\",\n      value : \"in\",\n      type : \"select\",\n      option : [{\n        label : \"进水口波动偏差预警\",\n        value : \"in\"\n      },{\n        label : \"出水口边缘工况预警\",\n        value : \"out\"\n      }]\n    }\n    */\n\n    var echartDom = $(\"<div></div>\");\n    var echartAlert = $(\"<div>偏差值低预警</div>\");\n    var button = $(\"<button class='btn btn-primary'>模拟分析过程</button>\").css({\n      margin: \"10px\"\n    });\n    echartAlert.css(\"background-color\", \"red\");\n    echartAlert.css(\"position\", \"absolute\");\n    echartAlert.css(\"color\", \"#fff\");\n    echartAlert.css(\"padding\", \"10px\");\n    echartAlert.css(\"top\", \"30px\");\n    echartAlert.css(\"right\", \"90px\");\n    echartAlert.css(\"width\", \"140px\");\n    echartAlert.css(\"text-align\", \"center\");\n    echartAlert.css(\"font-weight\", \"bold\");\n    echartAlert.css(\"font-size\", \"16px\");\n    echartAlert.css(\"border-radius\", \"8px\");\n    echartAlert.css(\"box-shadow\", \"1px 1px 10px #ff5a00\");\n    echartAlert.css(\"display\", \"none\");\n    echartAlert.css(\"z-index\", 999);\n    wrap.append(echartDom);\n    wrap.append(button);\n    timeout(function () {\n      if (element.style) {\n        echartDom.css(element.style);\n      }\n\n      echartDom.css(\"width\", wrap.width());\n      $$.loadExternalJs(['echarts', 'macarons'], function (echarts) {\n        var _repeat, renderChart;\n\n        var linechart = new chartOptionService.linechart();\n        var target = echarts.init(echartDom[0], \"macarons\");\n        var pres_xAxis = [],\n            pres_data1 = [],\n            pres_data2 = [],\n            inx = 0;\n        linechart.setTitle({\n          text: \"\"\n        });\n        var xAxis = [],\n            xAxis_offset = [],\n            legend = ['估计值', \"测量值\"];\n        var start = new Date().getTime() - 3 * 24 * 3600 * 1000;\n\n        if (element.parameters.type == 1) {\n          var data1 = [69, 70, 71, 70, 69, 68, 69, 70, 69, 71, 70, 71, 70, 70, 71, 71, 72, 71, 71, 70, 71, 72, 71, 71, 70, 70, 70, 70, 70, 69, 69, 70, 70, 70, 71, 71, 71, 71, 70, 71, 70, 71, 71, 71, 72, 72, 71, 72, 72, 70];\n          var data2 = [68.4, 69.8, 70.6, 69.4, 68.7, 67.6, 68.6, 69.4, 68.6, 70.8, 69.4, 70.6, 69.8, 69.7, 70.6, 70.4, 71.6, 70.6, 70.4, 69.6, 70.8, 71.8, 70.7, 68.4, 67.3, 67.6, 67.9, 68.6, 69.4, 68.7, 67.6, 67.2, 67.4, 67.8, 68.1, 68.8, 69.6, 68.3, 67.4, 67.8, 68.3, 69.4, 70.6, 69.8, 69.4, 69.1, 69.9, 71.6, 70.1, 69.5];\n        } else {\n          var data1 = [85, 80, 80, 80, 79, 82, 82, 80, 78, 83, 84, 83, 80, 80, 81, 82, 84, 85, 85, 83, 81, 82, 81, 81, 80, 80, 80, 80, 80, 79, 79, 81, 83, 82, 79, 77, 80, 82, 79, 78, 80, 81, 82, 79, 84, 83, 81, 82, 84, 79];\n          var data2 = [84, 79, 79.6, 79.4, 79, 81.5, 81, 79.6, 77.6, 82.5, 83.7, 82.6, 79.4, 79.6, 80.6, 81.5, 83.7, 84.6, 84.5, 82.7, 80.8, 81.4, 80.6, 80.8, 79.8, 79.9, 79.9, 79.8, 78.6, 78.6, 78.4, 80.6, 82.7, 81.7, 78.6, 76.8, 79.4, 81.8, 78.6, 77.8, 79.8, 80.8, 81.9, 78.4, 83.8, 82.4, 80.9, 81.6, 83.4, 78.9];\n\n          for (var i in data1) {\n            if (data1[i] + i * i / 200 < 88) {\n              data1[i] += i * i / 200;\n              data2[i] += i * i / 200;\n            } else {\n              data1[i] = Math.round((88 - Math.random() * 2) * 100) / 100;\n              data2[i] = Math.round((88 - Math.random() * 2) * 100) / 100;\n            }\n          }\n        }\n\n        var data1offset1 = [],\n            data2offset2 = [],\n            base1 = 70,\n            base2 = 69.5;\n\n        for (var i in data1) {\n          xAxis.push(start + i * 300 * 1000);\n        }\n\n        linechart.setTimeformat(\"时分\");\n        linechart.setLegend(legend);\n\n        (function (tg, button) {\n          renderChart = function renderChart(xAxis, data1, data2) {\n            linechart.setxAxis({\n              data: xAxis\n            });\n            var xAxis_formatted = linechart.getxAxis();\n            linechart.setSeries([{\n              name: \"估计值\",\n              data: data1,\n              smooth: true,\n              markLine: {\n                label: {\n                  normal: {\n                    show: true\n                  }\n                },\n                lineStyle: {\n                  normal: {\n                    color: \"#cc2424\"\n                  }\n                },\n                data: [{\n                  name: '报警温度',\n                  yAxis: 90\n                }]\n              },\n              itemStyle: {\n                normal: {\n                  color: \"#66c9d8\"\n                }\n              }\n            }, {\n              name: \"测量值\",\n              data: data2,\n              smooth: true,\n              markLine: {\n                label: {\n                  normal: {\n                    show: true\n                  }\n                },\n                lineStyle: {\n                  normal: {\n                    type: \"solid\",\n                    color: \"#cc2424\"\n                  }\n                },\n                data: [{\n                  name: '跳闸温度',\n                  yAxis: 100\n                }]\n              },\n              markArea: {\n                data: function () {\n                  if (element.parameters.type == 1) {\n                    return [[{\n                      name: '波动偏差过大',\n                      xAxis: xAxis_formatted[22]\n                    }, {\n                      xAxis: function () {\n                        if (xAxis_formatted.length <= 26) {\n                          return xAxis_formatted[xAxis_formatted.length - 1];\n                        } else {\n                          return xAxis_formatted[26];\n                        }\n                      }()\n                    }], [{\n                      name: '波动偏差过大',\n                      xAxis: xAxis_formatted[29]\n                    }, {\n                      xAxis: function () {\n                        if (xAxis_formatted.length <= 40) {\n                          return xAxis_formatted[xAxis_formatted.length - 1];\n                        } else {\n                          return xAxis_formatted[40];\n                        }\n                      }()\n                    }], [{\n                      name: '波动偏差过大',\n                      xAxis: xAxis_formatted[43]\n                    }, {\n                      xAxis: function () {\n                        if (xAxis_formatted.length <= 45) {\n                          return xAxis_formatted[xAxis_formatted.length - 1];\n                        } else {\n                          return xAxis_formatted[45];\n                        }\n                      }()\n                    }]];\n                  } else {\n                    return [[{\n                      name: '长时间接近告警温度',\n                      xAxis: xAxis_formatted[32]\n                    }, {\n                      xAxis: function () {\n                        if (xAxis_formatted.length <= 48) {\n                          return xAxis_formatted[xAxis_formatted.length - 1];\n                        } else {\n                          return xAxis_formatted[48];\n                        }\n                      }()\n                    }]];\n                  }\n                }(),\n                itemStyle: {\n                  normal: {\n                    color: \"#f7dde2\"\n                  }\n                }\n              },\n              itemStyle: {\n                normal: {\n                  color: \"#8e66d8\"\n                }\n              }\n            }]);\n            var option = linechart.returnOption();\n            option.yAxis.max = 100;\n            option.yAxis.min = 60; //console.log(JSON.stringify(option, null, 2));\n\n            tg.setOption(option);\n          };\n\n          button.on(\"click\", function (event) {\n            var cur = $(event.currentTarget); //;\n\n            pres_xAxis = xAxis.slice(0, 20);\n            pres_data1 = data1.slice(0, 20);\n            pres_data2 = data2.slice(0, 20);\n            renderChart(pres_xAxis, pres_data1, pres_data2);\n\n            if (cur.text() == '模拟分析过程') {\n              _repeat = function repeat() {\n                if (inx < xAxis.length) {\n                  pres_xAxis.push(xAxis[inx]);\n                  pres_data1.push(data1[inx]);\n                  pres_data2.push(data2[inx]);\n                  timeout(function () {\n                    renderChart(pres_xAxis, pres_data1, pres_data2);\n                    inx++;\n\n                    if (typeof _repeat == 'function') {\n                      _repeat();\n                    }\n                  }, 1000);\n                }\n              };\n\n              inx = 21;\n              cur.text('返回初始状态');\n              cur.removeClass(\"btn-primary\");\n              cur.addClass(\"btn-cancel\");\n\n              _repeat();\n            } else if (cur.text() == '返回初始状态') {\n              cur.text('模拟分析过程');\n              cur.removeClass(\"btn-cancel\");\n              cur.addClass(\"btn-primary\");\n              _repeat = undefined;\n            }\n          });\n          renderChart(xAxis.slice(0, 20), data1.slice(0, 20), data2.slice(0, 20));\n        })(target, button);\n\n        $(window).on('resize', function (event) {\n          target.resize();\n        });\n      });\n    });\n    return wrap;\n  };\n});"],"sourceRoot":"/source/"}