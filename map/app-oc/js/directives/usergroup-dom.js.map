{"version":3,"sources":["app-oc/js/directives/usergroup-dom.js"],"names":["define","directives","datatables","initDirective","$timeout","$compile","restrict","controller","$scope","$element","$attrs","table","domMain","$on","Event","USERGROUPINIT","event","args","destroy","DataTable","dom","language","datatable","data","order","columns","title","orderable","columnDefs","targets","render","type","full","isEdit","str","argData","enterpriseData","enterpriseUser","i","length","index","j","userID","userName","on","parentDom","$","parent","html","e","preventDefault","tr","this","closest","rowData","row","context","cellIndex","stopPropagation","selVal","val","doAction"],"mappings":"AAAAA,OAAO,CAAC,wBAAyB,iBAAkB,qBAAsB,SAAUC,EAAYC,GAC7F,aAEAD,EAAWE,cAAc,iBAAkB,CAAC,WAAY,WAAY,SAAUC,EAAUC,GACtF,MAAO,CACLC,SAAU,IACVC,WAAY,CAAC,SAAU,WAAY,SAAU,SAAUC,EAAQC,EAAUC,GACvE,IACIC,EADAC,EAAUH,EAGdD,EAAOK,IAAIC,MAAMC,cAAe,SAAUC,EAAOC,GAC3CN,GACFA,EAAMO,WAGI,EACZP,EAAQC,EAAQO,UAAU,CACxBC,IAAK,qHACLC,SAAUpB,EAAWqB,UAAUD,SAC/BE,KAAMN,EAAKM,KACXC,MAAS,CAAC,CAAC,EAAG,SACdC,QAAS,CAAC,CACRC,MAAO,OACPH,KAAM,YACL,CACDG,MAAO,QACPH,KAAM,aACL,CACDG,MAAO,OACPH,KAAM,eACL,CACDG,MAAO,KACPC,WAAW,EACXJ,KAAM,WAERK,WAAY,CAAC,CACXC,QAAW,EACXN,KAAQ,WACRO,OAAU,SAAgBP,EAAMQ,EAAMC,GAEpC,GAAmB,GAAfA,EAAKC,QAAuB,WAARF,EAsBtB,OAAOR,EAjBP,IAJA,IAAIW,EAAM,qHACNC,EAAUlB,EAAKM,KACfa,EAAiB5B,EAAO6B,eAEnBC,EAAI,EAAGA,EAAIF,EAAeG,OAAQD,IAAK,CAG9C,IAFA,IAAIE,GAAS,EAEJC,EAAI,EAAGA,EAAIN,EAAQI,SAAUE,EAChCN,EAAQM,GAAGC,QAAUN,EAAeE,GAAGI,SACzCF,EAAQC,IAIE,GAAVD,IACFN,GAAO,kBAAoBE,EAAeE,GAAGI,OAAS,KAAON,EAAeE,GAAGK,SAAW,aAK9F,OADAT,GAAO,cAMV,CACDL,QAAW,EACXN,KAAQ,SACRO,OAAU,SAAgBP,EAAMQ,EAAMC,GACpC,IAAIE,EAAM,uCAUV,OARmB,GAAfF,EAAKC,QACPC,GAAO,oJACPA,GAAO,uJAEPA,GAAO,kJAGTA,GAAO,gBAUftB,EAAQgC,GAAG,UAAW,WACpB,IAAIC,EAAYC,EAAE,gBAAgBC,SAClCF,EAAUG,KAAK,mKACf3C,EAASwC,EAATxC,CAAoBG,KAEtBI,EAAQgC,GAAG,QAAS,KAAM,SAAUK,GAClCA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MAErBC,EADM3C,EAAM4C,IAAIJ,GACF5B,OAElB,GAAI+B,EAAS,CACX,GAAiC,GAA7BR,EAAEM,MAAMI,QAAQC,WAAoC,GAAlBH,EAAQrB,OAC5C,OAGEqB,EAAQrB,UAGhBrB,EAAQgC,GAAG,QAAS,YAAa,SAAUK,GACzCA,EAAES,kBACOZ,EAAEM,MAAMC,QAAQ,MACT1C,EAAM4C,IAAI,UAD1B,IAEII,EAASb,EAAE,mBAAmBc,MAClCpD,EAAOqD,SAAS,WAAYF,KAE9B/C,EAAQgC,GAAG,QAAS,cAAe,SAAUK,GAC3CA,EAAES,mBACU,EACI/C,EAAM4C,IAAI,UAC1B/C,EAAOqD,SAAS,YAElBjD,EAAQgC,GAAG,QAAS,WAAY,SAAUK,GACxCA,EAAEC,iBACF,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MACrBE,EAAM5C,EAAM4C,IAAIJ,GACpB3C,EAAOqD,SAAS,aAAcN,EAAIhC,UAEpCX,EAAQgC,GAAG,QAAS,oBAAqB,SAAUK,GAIjD,GAHAA,EAAEC,mBACU,EAEI,EACF,EACZ,IAAIC,EAAKL,EAAEM,MAAMC,QAAQ,MACf1C,EAAM4C,IAAIJ,GAChB5B,OAAOU,OAAS,KAGxBrB,EAAQgC,GAAG,QAAS,oBAAqB,SAAUK,IAErC,EACZ,IAAIE,EAAKL,EAAEM,MAAMC,QAAQ,MACrBE,EAAM5C,EAAM4C,IAAIJ,GACJxC,EAAM4C,IAAI,UAC1B/C,EAAOqD,SAAS,eAAgBN,EAAIhC","file":"app-oc/js/directives/usergroup-dom.js","sourcesContent":["define(['directives/directives', 'datatables.net', 'datatables.net-bs'], function (directives, datatables) {\n  'use strict';\n\n  directives.initDirective('userGroupTable', ['$timeout', '$compile', function ($timeout, $compile) {\n    return {\n      restrict: 'A',\n      controller: ['$scope', '$element', '$attrs', function ($scope, $element, $attrs) {\n        var domMain = $element;\n        var table;\n        var isEditing = false;\n        $scope.$on(Event.USERGROUPINIT, function (event, args) {\n          if (table) {\n            table.destroy();\n          }\n\n          isEditing = false;\n          table = domMain.DataTable({\n            dom: '<\"row\"<\"col-sm-6\"<\"special-btn\">><\"col-sm-6\"f>><\"row\"<\"clo-sm-12\">>t<\"row\"<\"col-sm-2\"i><\"col-sm-2\"l><\"col-sm-8\"p>>',\n            language: directives.datatable.language,\n            data: args.data,\n            \"order\": [[0, \"desc\"]],\n            columns: [{\n              title: \"用户名称\",\n              data: \"userName\"\n            }, {\n              title: \"手机/邮箱\",\n              data: \"userEmail\"\n            }, {\n              title: \"办公电话\",\n              data: \"officePhone\"\n            }, {\n              title: \"操作\",\n              orderable: false,\n              data: \"option\"\n            }],\n            columnDefs: [{\n              \"targets\": 0,\n              \"data\": \"userName\",\n              \"render\": function render(data, type, full) {\n                //返回自定义名字\n                if (full.isEdit == 2 && type == \"display\") {\n                  var str = '<select id=\"userDomainName\" name=\"userName\" class=\"combobox form-control input-sm\">' + '<option value=\"\">请选择用户</option>';\n                  var argData = args.data;\n                  var enterpriseData = $scope.enterpriseUser;\n\n                  for (var i = 0; i < enterpriseData.length; i++) {\n                    var index = -1;\n\n                    for (var j = 0; j < argData.length; ++j) {\n                      if (argData[j].userID == enterpriseData[i].userID) {\n                        index = j;\n                      }\n                    }\n\n                    if (index == -1) {\n                      str += '<option value=\"' + enterpriseData[i].userID + '\">' + enterpriseData[i].userName + '</option>';\n                    }\n                  }\n\n                  str += '</select>';\n                  return str;\n                } else {\n                  return data;\n                }\n              }\n            }, {\n              \"targets\": 3,\n              \"data\": \"option\",\n              \"render\": function render(data, type, full) {\n                var str = \"<div class='btn-group btn-group-sm'>\";\n\n                if (full.isEdit == 2) {\n                  str += \"<a id='save-btn'  class='btn btn-default btn-sm' ><i class='fa fa-save hidden-lg hidden-md hidden-sm '></i><span class='hidden-xs'> 保存</span></a>\";\n                  str += \"<a id='cancel-btn' class='btn btn-default btn-sm' ><i class='fa fa-times  hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 取消</span></a>\";\n                } else {\n                  str += \"<a id='del-btn' class='btn btn-default btn-sm' ><i class='fa fa-minus hidden-lg hidden-md hidden-sm'></i><span class='hidden-xs'> 移出</span></a>\";\n                }\n\n                str += \"</div>\";\n                return str;\n              }\n            }]\n          });\n        });\n        /**\n         * 监听表格初始化后，添加按钮\n         */\n\n        domMain.on('init.dt', function () {\n          var parentDom = $(\".special-btn\").parent();\n          parentDom.html('<a ng-click=\"addGroupUser()\"  ng-disabled=\"!selectedGroup\" class=\"btn btn-default btn-sm\"><i class=\"fa fa-plus\"></i><span class=\"hidden-xs\"> 添加用户组用户</span></a>');\n          $compile(parentDom)($scope);\n        });\n        domMain.on('click', 'td', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var rowData = row.data();\n\n          if (rowData) {\n            if ($(this).context.cellIndex == 4 && rowData.isEdit == 0) {\n              return;\n            }\n\n            if (rowData.isEdit == 1) {}\n          }\n        });\n        domMain.on('click', '#save-btn', function (e) {\n          e.stopPropagation();\n          var tr = $(this).closest('tr');\n          var selectRow = table.row('.shown');\n          var selVal = $(\"#userDomainName\").val();\n          $scope.doAction('saveUser', selVal);\n        });\n        domMain.on('click', '#cancel-btn', function (e) {\n          e.stopPropagation();\n          isEditing = false;\n          var selectRow = table.row('.shown');\n          $scope.doAction('cancel');\n        });\n        domMain.on('click', '#del-btn', function (e) {\n          e.preventDefault();\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          $scope.doAction('removeUser', row.data());\n        });\n        domMain.on('click', '#changeDomain-btn', function (e) {\n          e.preventDefault();\n          isEditing = false;\n\n          if (!isEditing) {\n            isEditing = true;\n            var tr = $(this).closest('tr');\n            var row = table.row(tr);\n            row.data().isEdit = 1;\n          }\n        });\n        domMain.on('click', '#removeDomain-btn', function (e) {\n          //e.preventDefault();\n          isEditing = false;\n          var tr = $(this).closest('tr');\n          var row = table.row(tr);\n          var selectRow = table.row('.shown');\n          $scope.doAction('removeDomain', row.data());\n        });\n      }]\n    };\n  }]);\n});"],"sourceRoot":"/source/"}