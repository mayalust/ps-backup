{"version":3,"sources":["app-oc/js/controllers/permission_ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","initController","scope","timeout","q","routeParams","location","serviceCenterService","ngDialog","userInitService","userLoginUIService","userEnterpriseService","userUIService","growl","userRoleUIService","userFunctionService","userDomainService","marketplaceUIService","viewFlexService","dictionaryService","_currentRole","_roleComponet","_models","_dictions","_roleview","_roleres","roleID","panel","navigateTo","window","href","path","_allviews","_dashboardviews","_viewtypes","TEXT","SUBMIT","CANCEL","VIEWTYPES","dashboard","template","configAlert","designView","configure","initViewPremission","defer","models","getAll","then","allModels","resolve","promise","getDictValues","event","code","data","reject","message","dictions","params","roleId","findRoleViews","roleview","findRoleRes","roleres","defers","loadViewByTypeAndRole","type","domainPath","user","getViewsOnlyPublishedByTypeAndDomainPath","dt","Array","push","apply","all","filter","v","releaseStatus","resourceId","keyValue","viewType","applied","elem","viewId","find","el","resId","avaliable","i","setTemplate","object","dispart","source","resType","title","label","editable","sortable","filterable","format","value","id","filterFormat","options","modes","default","showheader","header","icon","class","style","margin","mark","events","click","row","fnlist","width","border-radius","font-size","font-weight","padding","fn","sourceAva","selected","resIds","map","addRoleRes","loop","item","disabled","$remove","index","close","success","datatablesource","miniSize","pageResize","rowclass","some","concat","resourceType","columnDefs","dialog","button","open","className","roleRes","deleteRoleRes","pushbefore","unshift","removeAllChecked","description","DASHBOARD_VIEW","forEach","command","functionCode","valueCode","buttons","cache","sourceAll","showSelector","page","resAddIds","resDeleteIds","role","roleDeleted","deleteFunctionParam","deleteRoleView_back","deleteRV","rv","element","addFunctionParam","showMsg","length","addRoleView","deleteRoleView","setDashboard","MODEL_VIEW","CONFIGALERT","DESIGNVIEW","CONFIGURE","views","getUnselected","e","isComp","values","component","getSelected","r","removeUndefined","findUsed","name","alias","initComponents","cached","allSelectedDashboard","queryEnterpriseRole","returnObj","str","objLike","arrLike","RegExp","test","JSON","parse","attrs","getDashboard","remap","inx","parseInt","attr","getAllMyViews","getAllDashboard","dashboardviews","view","alldashboards","addView","text","onSelect","onInit","save","json","des","exclude","indexOf","stringify","roleName","modifyRole","moveup","splice","active","movedown","remove","pageInitialized","saveMenuPremission","nodes","functionTree","getCheckNode","param","addFunction2Role","resultObj","warning","queryAllFunctionByUser","userID","getFunction","belong","function","traverse","dics","dic","equipments","addIds","roler","removeIds","sou","addRoleSuccess","isAuthenticated","$on","evt","d"],"mappings":"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","file":"app-oc/js/controllers/permission_ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers', 'Array'], function (controllers) {\n  'use strict';\n\n  function permissionCtrl(scope, timeout, q, routeParams, location, serviceCenterService, ngDialog, userInitService, userLoginUIService, userEnterpriseService, userUIService, growl, userRoleUIService, userFunctionService, userDomainService, marketplaceUIService, viewFlexService, dictionaryService) {\n    var roleID = routeParams.roleID;\n    scope.panel = routeParams.panel;\n\n    scope.navigateTo = function (panel) {\n      if (panel == \"prod_componentpermiss\") {\n        window.location.href = \"../../../app-oc/index.html#/prod_componentpermiss/\" + roleID;\n      } else {\n        location.path(\"usermanager/permission/\" + panel + \"/\" + roleID);\n      }\n    };\n\n    var _currentRole, _roleComponet;\n\n    var _models, _dictions, _roleview, _roleres;\n\n    var _allviews = [];\n    var _dashboardviews = [];\n    var _viewtypes = {};\n    var TEXT = {\n      \"SUBMIT\": \"确定\",\n      \"CANCEL\": \"取消\"\n    };\n    var VIEWTYPES = {\n      dashboard: 'dashboard',\n      template: 'template',\n      configAlert: \"configAlert\",\n      designView: \"designView\",\n      configure: \"configure\"\n    };\n\n    function getAllModels() {\n      var defer = q.defer();\n      serviceCenterService.models.getAll().then(function (allModels) {\n        defer.resolve(allModels);\n      });\n      return defer.promise;\n    }\n\n    function clone(a) {\n      return JSON.parse(JSON.stringify(a));\n    }\n\n    function getAllDicts() {\n      var defer = q.defer();\n      dictionaryService.getDictValues(['functionCode'], function (event) {\n        if (event.code == 0) {\n          defer.resolve(event.data);\n        } else {\n          defer.reject(event.message);\n        }\n      });\n      return defer.promise;\n    }\n\n    function findRoleViews(params) {\n      var defer = q.defer();\n      userRoleUIService.findRoleViews(params, function (event) {\n        if (event.code == 0) {\n          defer.resolve(event.data);\n        } else {\n          defer.reject(event.message);\n        }\n      });\n      return defer.promise;\n    }\n\n    function findRoleRes(params) {\n      var defer = q.defer();\n      userRoleUIService.findRoleRes(params, function (event) {\n        if (event.code == 0) {\n          defer.resolve(event.data);\n        } else {\n          defer.reject(event.message);\n        }\n      });\n      return defer.promise;\n    }\n\n    function getCurrentRole() {\n      var defer = q.defer();\n      userEnterpriseService.queryEnterpriseRole(function (returnObj) {\n        if (returnObj.code == 0) {\n          var role = returnObj.data.find(function (item) {\n            return item.roleID == roleID;\n          });\n          defer.resolve(role);\n        } else {\n          defer.reject(returnObj);\n        }\n      });\n      return defer.promise;\n    }\n\n    function queryRoleName() {\n      userEnterpriseService.queryEnterpriseRole(function (returnObj) {\n        if (returnObj.code == 0) {\n          scope.roleName = returnObj.data.find(function (item) {\n            return item.roleID == roleID;\n          }).roleName;\n        }\n      });\n      return defer.promise;\n    }\n\n    function initMenuPremission() {\n      scope.saveMenuPremission = function () {\n        var nodes = scope.functionTree.getCheckNode().map(function (elem) {\n          return elem.functionCode;\n        });\n        var param = [];\n\n        for (var i in nodes) {\n          if (nodes[i]) {\n            param.push(nodes[i]);\n          }\n        }\n\n        userFunctionService.addFunction2Role(roleID, param, function (resultObj) {\n          if (resultObj.code == 0) {\n            growl.success(\"功能分配成功\", {});\n          } else {\n            growl.warning(\"功能分配失败!\", {});\n          }\n        });\n      };\n\n      var queryAllFunctionByUser_back = function queryAllFunctionByUser_back(event) {\n        if (event.code == 0) {\n          var traverse = function traverse(data) {\n            var find = 0;\n\n            var getFunction = function getFunction(item) {\n              if (item.belong == 1) {\n                find = 1;\n              }\n\n              for (var i in item.function) {\n                getFunction(item.function[i]);\n              }\n            };\n\n            for (var i in data) {\n              getFunction(data[i]);\n            }\n\n            return find;\n          };\n\n          var some = traverse(event.data);\n          scope.functionTree = {\n            name: '全部',\n            belong: some,\n            function: event.data\n          };\n        }\n      };\n\n      userFunctionService.queryAllFunctionByUser(userLoginUIService.user.userID, roleID, queryAllFunctionByUser_back);\n    }\n\n    function loadViewByType(type) {\n      var defer = q.defer();\n      var domainPath = userLoginUIService.user.domainPath;\n      viewFlexService.getViewsOnlyPublishedByTypeAndDomainPath(type, domainPath, function (event) {\n        if (event.code == 0) {\n          defer.resolve(event.data);\n        } else {\n          defer.reject(event);\n        }\n      });\n      return defer.promise;\n    }\n\n    function getAllDashboard() {\n      var defer = q.defer();\n      var attrs = [['text', 'viewTitle'], 'viewId', 'values'];\n\n      function getDashboard(e) {\n        return e.viewType == \"dashboard\";\n      }\n\n      function remap(e, inx) {\n        var obj = {\n          id: parseInt(inx)\n        };\n\n        for (var i in attrs) {\n          var attr = attrs[i];\n\n          if (typeof attr == \"string\") {\n            obj[attr] = e[attr];\n          } else if (_typeof(attr) == \"object\") {\n            obj[attr[0]] = e[attr[1]];\n          }\n        }\n\n        return obj;\n      }\n\n      viewFlexService.getAllMyViews(function (event) {\n        if (event.code == \"0\") {\n          event.data = event.data || [];\n          defer.resolve(event.data.filter(getDashboard).map(remap));\n        } else {\n          defer.reject(event);\n        }\n      });\n      return defer.promise;\n    }\n\n    function initViewPremission() {\n      /** var allViews = []; */\n      function getAllModels_success(models) {\n        _models = models;\n        return getAllDicts();\n      }\n\n      function getAllDicts_success(dictions) {\n        _dictions = dictions;\n        var params = {\n          roleId: roleID\n        };\n        return findRoleViews(params);\n      }\n\n      function findRoleViews_success(roleview) {\n        _roleview = roleview;\n        var params = {\n          roleId: roleID\n        };\n        return findRoleRes(params);\n      }\n\n      function findRoleRes_success(roleres) {\n        _roleres = roleres;\n        var defers = [];\n\n        function loadViewByTypeAndRole(type) {\n          var defer = q.defer();\n          loadViewByType(type).then(function (dt) {\n            if (type == 'dashboard') {\n              Array.prototype.push.apply(_allviews, dt);\n            }\n\n            ;\n            _viewtypes[type] = _viewtypes[type] || {};\n            var all = dt.filter(function (v) {\n              if (v.releaseStatus == '1') {\n                var template = v.template;\n\n                if (type == 'dashboard') {\n                  return template ? template.resourceId == 0 : true;\n                } else if (type == 'template') {\n                  if (template) {\n                    return template.resourceId != 0 && template.keyValue != \"default\";\n                  } else {\n                    return false;\n                  }\n                } else {\n                  return v.viewType == type;\n                }\n              } else {\n                return false;\n              }\n            });\n            _viewtypes[type].all = all;\n            _viewtypes[type].applied = all.filter(function (elem) {\n              var viewId = elem.viewId;\n\n              var some = _roleres.find(function (el) {\n                return el.resId == viewId;\n              });\n\n              return some;\n            });\n            _viewtypes[type].avaliable = all.filter(function (elem) {\n              var viewId = elem.viewId;\n\n              var some = _roleres.find(function (el) {\n                return el.resId == viewId;\n              });\n\n              return !some;\n            });\n            defer.resolve(\"success\");\n          });\n          return defer.promise;\n        }\n\n        for (var i in VIEWTYPES) {\n          defers.push(loadViewByTypeAndRole(VIEWTYPES[i]));\n        }\n\n        ;\n        return q.all(defers);\n      }\n\n      function allViewLoaded() {\n        //console.log(_allviews, _viewtypes);\n        function setDashboard(object) {\n          object.source.forEach(function (elem) {\n            var loop = function loop(command) {\n              var find = _roleview.find(function (el) {\n                return el.functionCode == command.valueCode;\n              });\n\n              if (find) {\n                if (elem.viewId == find.viewId) {\n                  elem[command.valueCode] = true;\n                }\n              }\n            };\n\n            for (var i in _dictions) {\n              loop(_dictions[i]);\n            }\n\n            elem.selected = true;\n          });\n\n          var saveClick = function saveClick(source) {\n            var resAddIds = source.filter(function (elem) {\n              var some = _roleres.find(function (el) {\n                return el.resId == elem.viewId;\n              });\n\n              return !some;\n            }).map(function (elem) {\n              return elem.viewId;\n            });\n\n            var resDeleteIds = _roleres.filter(function (role) {\n              var some = source.some(function (el) {\n                return role.resId == el.viewId;\n              });\n              return !some && role.resType == 21;\n            });\n\n            var deleteRoleRes = function deleteRoleRes() {\n              var roleDeleted = function roleDeleted() {\n                var deleteFunctionParam = [];\n\n                var loop = function loop(command) {\n                  var find = _roleview.find(function (elem) {\n                    return elem.functionCode == command.valueCode;\n                  });\n\n                  if (find) {\n                    deleteFunctionParam.push(find);\n                  }\n                };\n\n                for (var i in _dictions) {\n                  loop(_dictions[i]);\n                }\n\n                ;\n\n                var deleteRoleView_back = function deleteRoleView_back(event) {\n                  if (event.code == 0) {\n                    var deleteRV = function deleteRV(rv) {\n                      _roleview.$remove(function (index, element) {\n                        return element.viewId == rv.viewId;\n                      });\n                    };\n\n                    for (var i in deleteFunctionParam) {\n                      deleteRV(deleteFunctionParam[i]);\n                    }\n\n                    ;\n                    var addFunctionParam = [];\n\n                    var loop = function loop(command) {\n                      var find = source.find(function (elem) {\n                        return elem[command.valueCode] == true;\n                      });\n\n                      if (find) {\n                        addFunctionParam.push({\n                          roleId: roleID,\n                          viewId: find.viewId,\n                          functionCode: command.valueCode\n                        });\n                      }\n                    };\n\n                    for (var i in _dictions) {\n                      loop(_dictions[i]);\n                    }\n\n                    ;\n\n                    var showMsg = function showMsg() {\n                      growl.success(\"仪表板视图授权成功\");\n\n                      if (resAddIds.length > 0 || resDeleteIds.length > 0 || deleteFunctionParam.length > 0 || addFunctionParam.length > 0) {\n                        /** growl.success(\"仪表板视图授权成功\"); */\n                      } else {\n                          /** growl.success(\"仪表板视图授权成功\"); */\n                        }\n                    };\n\n                    var addRoleView_callback = function addRoleView_callback(event) {\n                      if (event.code == \"0\") {\n                        Array.prototype.push.apply(_roleview, event.data);\n                        showMsg();\n                      }\n                    };\n\n                    if (addFunctionParam.length > 0) {\n                      userRoleUIService.addRoleView(addFunctionParam, addRoleView_callback);\n                    } else {\n                      showMsg();\n                    }\n                  }\n                };\n\n                if (deleteFunctionParam.length > 0) {\n                  userRoleUIService.deleteRoleView(deleteFunctionParam, deleteRoleView_back);\n                } else {\n                  deleteRoleView_back({\n                    code: 0,\n                    data: null\n                  });\n                }\n              };\n\n              var deleteRoleRes_callback = function deleteRoleRes_callback(event) {\n                if (event.code == 0) {\n                  for (var i in resDeleteIds) {\n                    _roleres.$remove(function (index, elem) {\n                      return elem.resId == resDeleteIds[i].resId;\n                    });\n                  }\n\n                  roleDeleted();\n                }\n              };\n\n              if (resDeleteIds.length > 0) {\n                userRoleUIService.deleteRoleRes(resDeleteIds, deleteRoleRes_callback);\n              } else {\n                roleDeleted();\n              }\n\n              ;\n            };\n\n            if (resAddIds.length > 0) {\n              var addRoleRes_callback = function addRoleRes_callback(event) {\n                if (event.code == 0) {\n                  Array.prototype.push.apply(_roleres, event.data);\n                  deleteRoleRes();\n                }\n              };\n\n              userInitService.addRoleRes(roleID, 21, resAddIds, addRoleRes_callback);\n            } else {\n              deleteRoleRes();\n            }\n          };\n\n          var buttons = _dictions.map(function (elem) {\n            var setClick = function setClick(row) {\n              var cache = row[elem.valueCode];\n              var find = object.sourceAll.find(function (el) {\n                return el[elem.valueCode] == true;\n              });\n\n              if (find) {\n                find[elem.valueCode] = false;\n              }\n\n              row[elem.valueCode] = cache ? false : true;\n            };\n\n            return {\n              label: elem.label,\n              type: \"button\",\n              disabled: function disabled(row) {\n                return row.selected != true;\n              },\n              class: function _class(row) {\n                if (row[elem.valueCode]) {\n                  return 'btn btn-success';\n                } else {\n                  return 'btn btn-default';\n                }\n              },\n              events: {\n                click: setClick\n              }\n            };\n          });\n\n          return {\n            title: \"仪表板视图\",\n            source: {\n              source: object.sourceAll,\n              showheader: true,\n              showSelector: true,\n              miniSize: true,\n              page: true,\n              header: [{\n                icon: \"glyphicon glyphicon-floppy-save\",\n                class: \"btn btn-primary btn-sm\",\n                label: \"保存\",\n                style: {\n                  margin: \"2px\"\n                },\n                events: {\n                  click: saveClick\n                },\n                type: \"button\"\n              }],\n              events: {\n                click: function click(row) {\n                  if (row.selected != true) {\n                    var loop = function loop(command) {\n                      row[command.valueCode] = false;\n                    };\n\n                    for (var i in _dictions) {\n                      loop(_dictions[i]);\n                    }\n                  }\n                }\n              },\n              columnDefs: [{\n                label: \"视图名称\",\n                editable: false,\n                sortable: true,\n                filterable: true,\n                data: \"viewTitle\",\n                type: \"text\",\n                modes: {\n                  default: {\n                    type: \"text\"\n                  }\n                }\n              }, {\n                label: \"视图描述\",\n                editable: false,\n                sortable: true,\n                filterable: true,\n                data: \"description\",\n                type: \"text\",\n                modes: {\n                  default: {\n                    type: \"text\"\n                  }\n                }\n              }, {\n                label: \"应用于\",\n                type: \"buttonGroup\",\n                filterable: false,\n                sortable: false,\n                width: \"141px\",\n                modes: {\n                  default: {\n                    options: buttons\n                  }\n                }\n              }]\n            }\n          };\n        }\n\n        ;\n\n        function setTemplate(object) {\n          var dispart;\n\n          for (var i in object.source) {\n            if (object.source[i].template) {\n              object.source[i].resourceId = object.source[i].template.resourceId;\n            }\n          }\n\n          ;\n          var resType = object.resType;\n\n          if (object.title == \"设备视图\") {\n            dispart = {\n              label: \"设备模板\",\n              editable: false,\n              sortable: true,\n              filterable: true,\n              data: \"resourceId\",\n              format: function format(value) {\n                var find = _models.find(function (elem) {\n                  return elem.id == value;\n                });\n\n                if (find) {\n                  return find.label;\n                } else {\n                  return \"-\";\n                }\n              },\n              filterFormat: {\n                label: \"label\",\n                value: \"id\"\n              },\n              type: \"select\",\n              options: _models,\n              modes: {\n                default: {\n                  type: \"text\"\n                }\n              }\n            };\n          } else {\n            dispart = {\n              label: \"视图描述\",\n              editable: false,\n              sortable: true,\n              filterable: true,\n              data: \"description\",\n              type: \"text\",\n              modes: {\n                default: {\n                  type: \"text\"\n                }\n              }\n            };\n          }\n\n          var addNewClick = function addNewClick(row) {\n            var submitClick = function submitClick() {\n              var source = object.sourceAva.filter(function (elem) {\n                return elem.selected == true;\n              });\n              Array.prototype.push.apply(object.source, source);\n              var resIds = source.map(function (elem) {\n                elem.selected = false;\n                return elem.viewId;\n              });\n\n              var addRoleRes_callback = function addRoleRes_callback(event) {\n                if (event.code == 0) {\n                  var loop = function loop(item) {\n                    item.disabled = false;\n                    object.sourceAva.$remove(function (index, elem) {\n                      return elem == item;\n                    });\n                  };\n\n                  for (var i in source) {\n                    loop(source[i]);\n                  }\n\n                  ngDialog.close();\n                  growl.success(object.title + \"添加成功\");\n                }\n              };\n\n              userInitService.addRoleRes(roleID, resType, resIds, addRoleRes_callback);\n            };\n\n            var fnlist = [{\n              label: TEXT.SUBMIT,\n              icon: 'btn btn-primary',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: submitClick\n            }, {\n              label: TEXT.CANCEL,\n              icon: 'btn btn-default',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn() {\n                ngDialog.close();\n              }\n            }];\n            var datatablesource = {\n              source: object.sourceAva,\n              miniSize: true,\n              pageResize: false,\n              header: [],\n              rowclass: function rowclass(row) {\n                var inUse = object.sourceAva.filter(function (elem) {\n                  return elem.selected == true && elem != row;\n                }).concat(object.source);\n                var some = inUse.some(function (elem) {\n                  if (elem.template && row.template) {\n                    if (row.template.resourceType == \"device\") {\n                      return row.template.resourceId == elem.template.resourceId;\n                    } else {\n                      return false;\n                    }\n                  } else {\n                    return false;\n                  }\n                });\n                row.disabled = some;\n                return some ? \"disabled\" : \"\";\n              },\n              columnDefs: [{\n                label: \"视图名称\",\n                editable: false,\n                sortable: true,\n                filterable: true,\n                data: \"viewTitle\",\n                type: \"text\",\n                modes: {\n                  default: {\n                    type: \"text\"\n                  }\n                }\n              }, dispart]\n            };\n            scope.dialog = {\n              title: \"添加\" + object.title,\n              datatablesource: datatablesource,\n              button: fnlist\n            };\n            ngDialog.open({\n              template: '../partials/dialogue/data_table_dia.html',\n              className: 'ngdialog-theme-plain',\n              scope: scope\n            });\n          };\n\n          var deleteClick = function deleteClick(source) {\n            var fnlist = [{\n              label: TEXT.SUBMIT,\n              icon: 'btn btn-success',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn() {\n                ngDialog.close();\n                var roleRes = source.map(function (elem) {\n                  return {\n                    roleId: roleID,\n                    resType: resType,\n                    resId: elem.viewId\n                  };\n                });\n\n                var deleteRoleRes_callback = function deleteRoleRes_callback(event) {\n                  if (event.code == \"0\") {\n                    for (var i in source) {\n                      if (typeof object.sourceAva.pushbefore == \"function\") {\n                        object.sourceAva.pushbefore(source[i]);\n                      } else {\n                        object.sourceAva.unshift(source[i]);\n                      }\n\n                      source[i].selected = false;\n                      /**\n                       for(var j in object.source){\n                                      if(object.source[j] == source[i]){\n                                        object.source[j].remove();\n                                      }\n                                    }\n                       */\n\n                      object.source.$remove(function (index, elem) {\n                        return source[i] == elem;\n                      });\n                      object.source.removeAllChecked();\n                    }\n\n                    ;\n                    growl.success(object.title + \"使用权限删除成功\");\n                  }\n                };\n\n                userRoleUIService.deleteRoleRes(roleRes, deleteRoleRes_callback);\n              }\n            }, {\n              label: TEXT.CANCEL,\n              icon: 'btn btn-default',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn() {\n                ngDialog.close();\n              }\n            }];\n            scope.dialog = {\n              title: {\n                label: '提示'\n              },\n              description: {\n                label: '确认要删除此用户使用这些' + object.title + '的权限吗？'\n              },\n              fnlist: fnlist\n            };\n            ngDialog.open({\n              template: '../partials/dialogue/common_dia_prompt.html',\n              className: 'ngdialog-theme-plain',\n              scope: scope\n            });\n          };\n\n          return {\n            title: object.title,\n            source: {\n              source: object.source,\n              showheader: true,\n              header: [{\n                icon: \"fa fa-plus\",\n                class: \"btn btn-primary btn-sm\",\n                label: \"添加\",\n                style: {\n                  margin: \"2px\"\n                },\n                mark: \"viewTitle\",\n                id: \"viewId\",\n                type: \"button\",\n                events: {\n                  click: addNewClick\n                }\n              }, {\n                icon: \"fa fa-minus\",\n                class: \"btn btn-default btn-sm\",\n                label: \"删除\",\n                style: {\n                  margin: \"2px\"\n                },\n                disabled: function disabled(source) {\n                  return !source.some(function (elem) {\n                    return elem.selected;\n                  });\n                },\n                events: {\n                  click: deleteClick\n                },\n                type: \"button\"\n              }],\n              columnDefs: [{\n                label: \"视图名称\",\n                editable: false,\n                sortable: true,\n                filterable: true,\n                data: \"viewTitle\",\n                type: \"text\",\n                modes: {\n                  default: {\n                    type: \"text\"\n                  }\n                }\n              }, dispart]\n            }\n          };\n        }\n\n        ;\n        var DASHBOARD_VIEW = setDashboard({\n          title: \"仪表板视图\",\n          sourceAll: _allviews,\n          source: _viewtypes.dashboard.applied,\n          resType: 21,\n          sourceAva: _viewtypes.dashboard.avaliable\n        });\n        var MODEL_VIEW = setTemplate({\n          title: \"设备视图\",\n          source: _viewtypes.template.applied,\n          resType: 21,\n          sourceAva: _viewtypes.template.avaliable\n        });\n        var CONFIGALERT = setTemplate({\n          title: \"告警视图\",\n          resType: 23,\n          source: _viewtypes.configAlert.applied,\n          sourceAva: _viewtypes.configAlert.avaliable\n        });\n        var DESIGNVIEW = setTemplate({\n          title: \"分析视图\",\n          resType: 24,\n          source: _viewtypes.designView.applied,\n          sourceAva: _viewtypes.designView.avaliable\n        });\n        var CONFIGURE = setTemplate({\n          title: \"组态视图\",\n          resType: 25,\n          source: _viewtypes.configure.applied,\n          sourceAva: _viewtypes.configure.avaliable\n        });\n        scope.views = [DASHBOARD_VIEW, MODEL_VIEW, CONFIGALERT, DESIGNVIEW, CONFIGURE];\n      }\n\n      getAllModels().then(getAllModels_success).then(getAllDicts_success).then(findRoleViews_success).then(findRoleRes_success).then(allViewLoaded);\n    }\n\n    ;\n\n    function initEquipmentPremission() {\n      var params = {\n        roleId: roleID\n      };\n\n      var getAllDicts_callback = function getAllDicts_callback(event) {\n        if (event.code == 0) {\n          var dics = event.data;\n\n          var findRoleRes_callback = function findRoleRes_callback(event) {\n            if (event.code == 0) {\n              var roleRes = event.data.filter(function (elem) {\n                return elem.resType == 30;\n              });\n\n              var loop = function loop(dic) {\n                var find = roleRes.find(function (elem) {\n                  return elem.resId == dic.valueCode;\n                });\n\n                if (find) {\n                  dic.selected = true;\n                }\n              };\n\n              for (var i in dics) {\n                loop(dics[i]);\n              }\n\n              var saveClick = function saveClick(source) {\n                var addIds = source.filter(function (el) {\n                  var some = roleRes.some(function (roler) {\n                    return roler.resId == el.valueCode;\n                  });\n                  return !some;\n                }).map(function (elem) {\n                  return elem.valueCode;\n                });\n                var removeIds = roleRes.filter(function (el) {\n                  var some = source.some(function (sou) {\n                    return sou.valueCode == el.resId;\n                  });\n                  return !some;\n                }).map(function (elem) {\n                  return {\n                    roleId: roleID,\n                    resId: elem.resId\n                  };\n                });\n\n                var success = function success() {\n                  growl.success(\"修改设备控制功能成功。\");\n                };\n\n                var addRoleSuccess = function addRoleSuccess() {\n                  if (removeIds.length > 0) {\n                    userRoleUIService.deleteRoleRes(removeIds, function (event) {\n                      success();\n                    });\n                  } else {\n                    success();\n                  }\n\n                  ;\n                };\n\n                if (addIds.length > 0) {\n                  userInitService.addRoleRes(roleID, 30, addIds, function (event) {\n                    addRoleSuccess();\n                  });\n                } else {\n                  addRoleSuccess();\n                }\n              };\n\n              scope.equipments = {\n                title: \"设备控制\",\n                source: dics,\n                showheader: true,\n                showSelector: true,\n                page: true,\n                header: [{\n                  icon: \"glyphicon glyphicon-floppy-save\",\n                  class: \"btn btn-primary btn-sm\",\n                  label: \"保存\",\n                  style: {\n                    margin: \"2px\"\n                  },\n                  events: {\n                    click: saveClick\n                  },\n                  type: \"button\"\n                }],\n                columnDefs: [{\n                  label: \"指令类型\",\n                  editable: false,\n                  sortable: true,\n                  filterable: true,\n                  data: \"label\",\n                  type: \"text\",\n                  modes: {\n                    default: {\n                      type: \"text\"\n                    }\n                  }\n                }]\n              };\n            }\n          };\n\n          userRoleUIService.findRoleRes(params, findRoleRes_callback);\n        }\n      };\n\n      dictionaryService.getDictValues(['commandType'], getAllDicts_callback);\n    }\n\n    ;\n\n    function getUnselected(e) {\n      var isComp = false;\n\n      if (e.values) {\n        isComp = e.values.component;\n      }\n\n      return e.selected != true && isComp;\n    }\n\n    function getSelected(e) {\n      var find = _dashboardviews.find(function (r) {\n        return r.viewId == e.viewId;\n      });\n\n      return find;\n    }\n\n    function removeUndefined(e) {\n      return e;\n    }\n\n    function stringify(json) {\n      json = json.map(function (e) {\n        var obj = {};\n        var exclude = [\"active\", \"selected\", \"$$hashKey\", \"id\"];\n\n        for (var i in e) {\n          if (exclude.indexOf(i) == -1) {\n            obj[i] = e[i];\n          }\n        }\n\n        return obj;\n      });\n      return JSON.stringify(json);\n    }\n\n    function parseJson(str) {\n      var objLike = new RegExp(\"^\\\\{.*\\\\}$\", \"g\");\n      var arrLike = new RegExp(\"^\\\\[.*\\\\]$\", \"g\");\n\n      if (objLike.test(str) || arrLike.test(str)) {\n        return JSON.parse(str);\n      } else {\n        return null;\n      }\n    }\n\n    function findUsed(e) {\n      var find = _roleComponet.find(function (r) {\n        return r.viewId == e.viewId;\n      });\n\n      if (find) {\n        e.name = find.name;\n        e.alias = find.alias;\n        e.selected = true;\n      }\n\n      return e;\n    }\n\n    function initComponents() {\n      var _ROLEKEY = \"values\";\n      var cached = {};\n\n      function editDescription(des) {\n        var defer = q.defer();\n        var role = {\n          roleName: _currentRole.roleName,\n          roleID: _currentRole.roleID\n        };\n        role[_ROLEKEY] = des;\n        userRoleUIService.modifyRole(role, function (event) {\n          if (event.code == 0) {\n            defer.resolve(event.data);\n          } else {\n            defer.reject(event);\n          }\n        });\n        return defer.promise;\n      }\n\n      scope.allSelectedDashboard = [];\n      getCurrentRole().then(function (role) {\n        _currentRole = role;\n        _roleComponet = parseJson(role[_ROLEKEY]) || [];\n        return getAllDashboard();\n      }).then(function (dashboardviews) {\n        var view;\n        _dashboardviews = dashboardviews.map(findUsed);\n        scope.alldashboards = _dashboardviews.filter(getUnselected);\n        scope.allSelectedDashboard = _roleComponet.map(getSelected).filter(removeUndefined);\n\n        scope.addView = function () {\n          view.selected = true;\n          scope.alldashboards = _dashboardviews.filter(getUnselected);\n          view.name = view.text;\n          view.alias = \"\";\n          scope.allSelectedDashboard.push(view);\n        };\n\n        scope.onSelect = function (v) {\n          view = v;\n        };\n\n        scope.onInit = function (v) {\n          view = v;\n        };\n\n        scope.save = function () {\n          var json = stringify(scope.allSelectedDashboard);\n          editDescription(json).then(function (e) {\n            growl.success(\"添加组件成功\");\n          });\n        };\n\n        scope.moveup = function (v) {\n          var inx = scope.allSelectedDashboard.indexOf(v);\n\n          if (inx > 0) {\n            scope.allSelectedDashboard.splice(inx, 1);\n            scope.allSelectedDashboard.splice(inx - 1, 0, v);\n          }\n\n          cached.active = false;\n          v.active = true;\n          cached = v;\n        };\n\n        scope.movedown = function (v) {\n          var inx = scope.allSelectedDashboard.indexOf(v);\n\n          if (inx < scope.allSelectedDashboard.length) {\n            scope.allSelectedDashboard.splice(inx, 1);\n            scope.allSelectedDashboard.splice(inx + 1, 0, v);\n          }\n\n          cached.active = false;\n          v.active = true;\n          cached = v;\n        };\n\n        scope.remove = function (v) {\n          var inx = scope.allSelectedDashboard.indexOf(v);\n          scope.allSelectedDashboard.splice(inx, 1);\n          delete v.alias;\n          delete v.name;\n          delete v.selected;\n\n          if (cached == v) {\n            cached = {};\n          }\n\n          scope.alldashboards = _dashboardviews.filter(getUnselected);\n        };\n      });\n    }\n    /**\n     * 标准的登录状态判定\n     * 登陆后执行初始化init方法\n     */\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          pageInitialized();\n        }\n      });\n    } else {\n      pageInitialized();\n    }\n\n    function pageInitialized() {\n      if (scope.panel == 'menus') {\n        initMenuPremission();\n      } else if (scope.panel == 'view') {\n        initViewPremission();\n      } else if (scope.panel == 'equipment') {\n        initEquipmentPremission();\n      } else if (scope.panel == 'component') {\n        initComponents();\n      }\n\n      ;\n    }\n  }\n\n  controllers.initController('permissionCtrl', ['$scope', '$timeout', '$q', '$routeParams', '$location', 'serviceCenterService', 'ngDialog', 'userInitService', 'userLoginUIService', 'userEnterpriseService', 'userUIService', 'growl', 'userRoleUIService', 'userFunctionService', 'userDomainService', 'marketplaceUIService', 'viewFlexService', 'dictionaryService', permissionCtrl]);\n});"],"sourceRoot":"/source/"}