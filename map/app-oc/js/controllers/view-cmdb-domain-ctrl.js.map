{"version":3,"sources":["app-oc/js/controllers/view-cmdb-domain-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","$location","$routeParams","$timeout","kpiDataService","userLoginUIService","resourceUIService","alertService","SwSocket","Info","viewFlexService","unitService","growl","userDomainService","userEnterpriseService","dialogue","console","info","domainList","domainId","label","startSearch","tree","rs","listData","treeData","traverse","children","child","i","push","filter","elem","name","indexOf","query","undefined","$broadcast","init","domainHandler","returnObj","code","data","treeList","id","loop","item","parentID","parent","find","Object","defineProperty","enumerable","createTree","menuitems","baseConfig","extendDomain","getDomainsByFilter","findEnterpriseDomain","menuitemsWatch","$watch","o","n","user","isAuthenticated","$on","evt","d"],"mappings":"AAAAA,OAAO,CAAC,0BAA2B,mBAAoB,SAAU,SAAUC,EAAaC,GACtF,aAEAD,EAAYE,eAAe,qBAAsB,CAAC,SAAU,YAAa,eAAgB,WAAY,iBAAkB,qBAAsB,oBAAqB,eAAgB,WAAY,OAAQ,kBAAmB,cAAe,QAAS,oBAAqB,wBAAyB,WAAY,SAAUC,EAAQC,EAAWC,EAAcC,EAAUC,EAAgBC,EAAoBC,EAAmBC,EAAcC,EAAUC,EAAMC,EAAiBC,EAAaC,EAAOC,EAAmBC,EAAuBC,GAClgBC,QAAQC,KAAK,UACb,IACIC,EADAC,EAAWjB,EAAakB,MAoE5BpB,EAAOqB,YAAc,WACnB,IAlEiCC,EAC7BC,EAkEAC,GAnE6BF,EAkEX,CAACtB,EAAOyB,UAjE1BF,EAAK,GAEM,SAASG,EAASC,GAC/B,IAAyBC,EAQzB,IAAK,IAAIC,KAAKF,EARWC,EASlBD,EAASE,GARdN,EAAGO,KAAKF,GAEJA,EAAMD,UACRD,EAASE,EAAMD,UASrBD,CAASJ,GACFC,GAiDcQ,OAAO,SAAUC,GACpC,OAA2C,GAApCA,EAAKC,KAAKC,QAAQlC,EAAOmC,SAGd,IAAhBnC,EAAOmC,OAA+BC,MAAhBpC,EAAOmC,MAC/BnC,EAAOqC,WAAW,aAAcb,GAEhCxB,EAAOqC,WAAW,eAItB,IAAIC,EAAO,WAET,IAAIC,EAAgB,SAAuBC,GACzC,GAAsB,GAAlBA,EAAUC,KAGZ,GAFAvB,EAAasB,EAAUE,KAEnBvB,EAAU,CACZ,IAAIwB,EAAW,GAEf,IAAK,IAAId,KAAKX,EACZ,GAAIA,EAAWW,GAAGe,IAAMzB,EAAU,CAChCwB,EAAWzB,EAAWW,GACtB,MAIJ7B,EAAOyB,SAAWkB,OAElB3C,EAAOyB,SA3EE,SAAoBiB,GACnC,IAAInB,EAEAsB,EAAO,SAAcC,GACvB,IAAIC,EAAWD,EAAKC,SAChBC,EAASN,EAAKO,KAAK,SAAUjB,GAC/B,OAAOe,GAAYf,EAAKY,KAGV,GAAZG,GACEC,GAAoBZ,MAAVY,GACWZ,MAAnBY,EAAOrB,WACTqB,EAAOrB,SAAW,IAGpBmB,EAAKE,OAASA,EACdE,OAAOC,eAAeL,EAAM,SAAU,CACpCM,YAAY,IAEdJ,EAAOrB,SAASG,KAAKgB,KAUvBA,EAAKE,OAAS,KACdE,OAAOC,eAAeL,EAAM,SAAU,CACpCM,YAAY,IAEd7B,EAAKuB,IAIT,IAAK,IAAIjB,KAAKa,EACZG,EAAKH,EAAKb,IAGZ,OAAON,EAkCiB8B,CAAWnC,IAKnC,GAAKlB,EAAOsD,UAAU,SAYXtD,EAAOuD,WAAWC,aAC3BlD,EAAkBmD,mBAAmB,GAAIlB,GAEzCzB,EAAsB4C,qBAAqBnB,QAd3C,IAAIoB,EAAiB3D,EAAO4D,OAAO,YAAa,SAAUC,EAAGC,GACvD9D,EAAOsD,UAAU,WACftD,EAAOuD,WAAWC,aACpBlD,EAAkBmD,mBAAmB,GAAIlB,GAEzCzB,EAAsB4C,qBAAqBnB,GAG7CoB,OAED,IAQFtD,EAAmB0D,KAAKC,gBAO3B1B,IANAtC,EAAOiE,IAAI,qBAAsB,SAAUC,EAAKC,GAC1C9D,EAAmB0D,KAAKC,iBAC1B1B","file":"app-oc/js/controllers/view-cmdb-domain-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog', 'Array'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('ViewCmdbDomainCtrl', ['$scope', '$location', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'SwSocket', 'Info', 'viewFlexService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', 'dialogue', function ($scope, $location, $routeParams, $timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, SwSocket, Info, viewFlexService, unitService, growl, userDomainService, userEnterpriseService, dialogue) {\n    console.info(\"切换到域管理\");\n    var domainId = $routeParams.label;\n    var domainList;\n\n    var treeToArr = function treeToArr(tree) {\n      var rs = [];\n\n      var traverse = function traverse(children) {\n        var loop = function loop(child) {\n          rs.push(child);\n\n          if (child.children) {\n            traverse(child.children);\n          }\n        };\n\n        for (var i in children) {\n          loop(children[i]);\n        }\n      };\n\n      traverse(tree);\n      return rs;\n    };\n\n    var createTree = function createTree(data) {\n      var rs;\n\n      var loop = function loop(item) {\n        var parentID = item.parentID;\n        var parent = data.find(function (elem) {\n          return parentID == elem.id;\n        });\n\n        if (parentID != 0) {\n          if (parent && parent != undefined) {\n            if (parent.children == undefined) {\n              parent.children = [];\n            }\n\n            item.parent = parent;\n            Object.defineProperty(item, \"parent\", {\n              enumerable: false\n            });\n            parent.children.push(item);\n          } else {\n            //现在存在一个情况有父id没有父\n            item.parent = null;\n            Object.defineProperty(item, \"parent\", {\n              enumerable: false\n            });\n            rs = item;\n          }\n        } else {\n          item.parent = null;\n          Object.defineProperty(item, \"parent\", {\n            enumerable: false\n          });\n          rs = item;\n        }\n      };\n\n      for (var i in data) {\n        loop(data[i]);\n      }\n\n      return rs;\n    };\n\n    $scope.startSearch = function () {\n      var dlist = treeToArr([$scope.treeData]);\n      var listData = dlist.filter(function (elem) {\n        return elem.name.indexOf($scope.query) != -1;\n      });\n\n      if ($scope.query != '' && $scope.query != undefined) {\n        $scope.$broadcast(\"SEARCHDATA\", listData);\n      } else {\n        $scope.$broadcast(\"RENDERDATA\");\n      }\n    };\n\n    var init = function init() {\n      /** 查询企业域目录 */\n      var domainHandler = function domainHandler(returnObj) {\n        if (returnObj.code == 0) {\n          domainList = returnObj.data;\n\n          if (domainId) {\n            var treeList = [];\n\n            for (var i in domainList) {\n              if (domainList[i].id == domainId) {\n                treeList = domainList[i];\n                break;\n              }\n            }\n\n            $scope.treeData = treeList;\n          } else {\n            $scope.treeData = createTree(domainList);\n          }\n        }\n      };\n\n      if (!$scope.menuitems[\"isloaded\"]) {\n        var menuitemsWatch = $scope.$watch('menuitems', function (o, n) {\n          if ($scope.menuitems[\"isloaded\"]) {\n            if ($scope.baseConfig.extendDomain) {\n              resourceUIService.getDomainsByFilter({}, domainHandler);\n            } else {\n              userEnterpriseService.findEnterpriseDomain(domainHandler);\n            }\n\n            menuitemsWatch();\n          }\n        }, true);\n      } else if ($scope.baseConfig.extendDomain) {\n        resourceUIService.getDomainsByFilter({}, domainHandler);\n      } else {\n        userEnterpriseService.findEnterpriseDomain(domainHandler);\n      }\n    };\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]);\n});"],"sourceRoot":"/source/"}