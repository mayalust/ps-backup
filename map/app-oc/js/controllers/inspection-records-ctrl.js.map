{"version":3,"sources":["app-oc/js/controllers/inspection-records-ctrl.js"],"names":["define","controllers","BootstrapDialog","echarts","initController","$scope","userInitService","$location","$routeParams","$timeout","maintenanceUIService","userLoginUIService","Info","growl","userEnterpriseService","initHistory","inspectionRecords","teamId","userId","startDate","endDate","teamTypes","teamType","typeName","ifTables","allTeams","usersByTeam","selectedTeam","id","undefined","getUsersByTeamId","returnObj","code","data","getUsersByTeam","saveRecords","arr","i","push","getInspectionRecordsByCondition","imgUrl","split","$broadcast","Event","INSPECTIONRECORDS","option","cancelRecords","getAllTeams","ngDialog","unitService","userDomainService","resourceUIService","kpiDataService","customerUIService","projectUIService","userUIService","configUIService","domainListDic","domainListTree","rootModel","selectedItem","rootModelDic","routePathNodes","selectedDitem","devices","copy","devicesData","nodeIds","kpiQueryModelObj","showDeviceData","queryState","tableDataLoading","times","timePeriod","get","info","emcsAlertColor","emcsSetTime","getOption","chartData","title","text","tooltip","trigger","legend","toolbox","feature","saveAsImage","right","grid","left","bottom","containLabel","xAxis","type","boundaryGap","xData","yAxis","series","name","stack","label","normal","show","position","areaStyle","expObj","kPIsExportOrder","queryExpInitObj","Object","prototype","toString","call","value","JSON","parse","getConfigsByGroupName","length","packNumber","packType","censusNumber","censusType","paramkpis","kpiCodes","forEach","kpiCode","kpisObj","kpiObj","jQuery","extend","index","start","end","val","status","startGetTime","Date","startTime","getTime","time","endTime","days","str","parseInt","msecConvert","count","domain","modelId","nodeId","kpiId","customerId","projectId","kpis","clearSelectTime","exportKpi","retStatus","warning","closeDialog","loadingShow","sort","a","b","kpi","stringify","saveConfig","packMis","censusMis","queryObj","isRealTimeData","exportKpiValueList","res","console","log","msgDetail","indexOf","window","location","href","uploadFileUrl","closable","message","buttons","cssClass","action","dialogRef","close","exportClick","Format","sp1","sp2","open","template","scope","className","formatDate","datestr","formatKpiValue","r","v","e","querydeviceData","kpiQueryModel","searchTypeName","queryDeviceData","k","deviceName","instance","j","kpiName","range","kpiValue","unit","tableData","chartDataDir","arisingTime","ECHARTINFOSINIT","reverse","DEVICEDATAINIT","getAllUnits","formatUnits","getDeviceByDeviceType","modelID","getDevicesByCondition","visible","getDevices","getKpisBymodelId","projectsCustomerList","customerChange","projectsListAll","projectsList","projectChange","domainPath","arrIds","getselectedDevice","p","getKpi","clearSearch","sel","searchData","attrSearchCount","baseConfig","searchNodeIds","projectsDic","projectName","customersDic","customerName","domainInfo","includeInstance","modelList","getModels","modelListSelect","obj","parentModelId","addNodes","parentNode","modeid","nodes","key","handler","getDataItemsByModelId","regExp","unitCode","unitName","find","test","rangeObj","rangeAry","Array","min","max","customersList","queryProject","findProjectsByCondition","item","unshift","activeListTab","init","$","on","aname","target","attr","$apply","resize","kpiData","idArray","unitArray","labelArray","granularityArray","granularityUnitArray","domainCallback","menuitems","extendDomain","getExtendDomainsByFilter","queryDomainTree","user","userID","menuitemsWatch","$watch","o","n","domainTreeQuery","findCustomersByCondition","customerDic","getRootModel","isAuthenticated","$on","evt","d","$filter","nodeType","statisticType","statisticTimeType","kpilabel","statiMethod","smId","smName","history","subtext","x","y","formatter","params","date","axisLabel","AdminLTE","boxWidget","collapse","timeflag","f","setOption","onresize","dom","newObj","parentID","description","domains","menu_list","initTreeview","tags","belong","state","checked","icon","domainID","tree","cmpObj"],"mappings":"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","file":"app-oc/js/controllers/inspection-records-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog', 'echarts'], function (controllers, BootstrapDialog, echarts) {\n  'use strict';\n\n  controllers.initController('inspectionRecordsCtrl', ['$scope', 'userInitService', '$location', '$routeParams', '$timeout', 'maintenanceUIService', 'userLoginUIService', 'Info', 'growl', 'userEnterpriseService', function ($scope, userInitService, $location, $routeParams, $timeout, maintenanceUIService, userLoginUIService, Info, growl, userEnterpriseService) {\n    //设备类型\n    $scope.teamTypes = [{\n      \"teamType\": \"polling\",\n      \"typeName\": \"巡检组\"\n    }, {\n      \"teamType\": \"security\",\n      \"typeName\": \"保安组\"\n    }];\n    $scope.ifTables = true; //查询及展示数据字段\n\n    function initHistory() {\n      $scope.inspectionRecords = {\n        'teamId': '',\n        'userId': '',\n        'startDate': '',\n        'endDate': ''\n      };\n    }\n\n    $scope.allTeams = null;\n    $scope.usersByTeam = null; //获取所有班组名称（班组名称）\n\n    function getAllTeams() {\n      maintenanceUIService.getAllTeams(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.allTeams = returnObj.data;\n        }\n      });\n    } //获取班组名称Id对应下的所有用户（巡检人）\n\n\n    function getUsersByTeam(teamId) {\n      if (teamId == '' || teamId == undefined) {\n        $scope.inspectionRecords.userId = '';\n        return;\n      } else {\n        var id = teamId;\n        maintenanceUIService.getUsersByTeamId(id, function (returnObj) {\n          if (returnObj.code == 0) {\n            // var arr = [];\n            // for (var i in returnObj.data) {\n            //     arr[i] = returnObj.data[i].user;\n            // }\n            $scope.usersByTeam = returnObj.data;\n          }\n        });\n      }\n    }\n\n    $scope.selectedTeam = function (id) {\n      getUsersByTeam(id);\n    }; //查询\n\n\n    $scope.saveRecords = function () {\n      $scope.ifTables = true;\n      var arr = [];\n\n      for (var i in $scope.inspectionRecords) {\n        arr.push($scope.inspectionRecords[i]);\n      }\n\n      maintenanceUIService.getInspectionRecordsByCondition(arr, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            if (returnObj.data[i].imgUrl) {\n              // var imageUrl = \"/upload/20161118101131538.png;/upload/20161118101131538.png;/upload/20161118101131538.png\";\n              returnObj.data[i].imgUrl = returnObj.data[i].imgUrl.split(';');\n            }\n          }\n\n          $timeout(function () {\n            $scope.$broadcast(Event.INSPECTIONRECORDS, {\n              \"option\": [returnObj.data]\n            });\n          });\n        }\n      });\n    }; //取消\n\n\n    $scope.cancelRecords = function () {\n      initHistory();\n      $scope.ifTables = false;\n    };\n\n    var init = function init() {\n      initHistory();\n      getAllTeams();\n    };\n\n    init();\n  }]);\n  /**\n   * 设备数据查询\n   * Issue：PROMETHEUS-496、PROMETHEUS-585\n   * 说明：测点导出时能够保存状态\n   */\n\n  controllers.initController('queryDeviceDataCtrl', ['$scope', 'ngDialog', 'userInitService', 'unitService', 'userDomainService', 'resourceUIService', '$location', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'Info', 'growl', 'customerUIService', 'projectUIService', 'userUIService', 'configUIService', function ($scope, ngDialog, userInitService, unitService, userDomainService, resourceUIService, $location, $routeParams, $timeout, kpiDataService, userLoginUIService, Info, growl, customerUIService, projectUIService, userUIService, configUIService) {\n    $scope.domainListDic = {}; //域字典\n\n    $scope.domainListTree = {};\n    $scope.rootModel = {};\n    $scope.selectedItem = {};\n    $scope.rootModelDic = {}; //    $scope.routePaths = [];\n\n    $scope.routePathNodes = {};\n    $scope.selectedDitem = {\n      'devices': [] //用于在视图中展示设备信息\n\n    };\n    $scope.copy = {\n      'devicesData': [],\n      //存储设备模板或者设备域过滤出来的所有设备\n      'nodeIds': []\n    };\n    $scope.kpiQueryModelObj = '';\n    $scope.showDeviceData = [];\n    $scope.queryState = false;\n    $scope.ifTables = true;\n    $scope.tableDataLoading = false;\n    $scope.times = null;\n    $scope.timePeriod = \"10\";\n    var path = \"../localdb/info.json\";\n    var colorArray = [];\n    Info.get(path, function (info) {\n      colorArray = info.emcsAlertColor;\n      $scope.times = info.emcsSetTime;\n    }); //定义EChart option\n\n    var getOption = function getOption(chartData) {\n      var option = {\n        title: {\n          text: chartData.title\n        },\n        tooltip: {\n          trigger: 'axis'\n        },\n        legend: {\n          data: []\n        },\n        toolbox: {\n          feature: {\n            saveAsImage: {}\n          },\n          right: \"5%\"\n        },\n        grid: {\n          left: '3%',\n          right: '4%',\n          bottom: '3%',\n          containLabel: true\n        },\n        xAxis: [{\n          type: 'category',\n          boundaryGap: false,\n          data: chartData.xData\n        }],\n        yAxis: [{\n          type: 'value'\n        }],\n        series: [{\n          name: chartData.title,\n          type: 'line',\n          stack: '总量',\n          label: {\n            normal: {\n              show: true,\n              position: 'top'\n            }\n          },\n          areaStyle: {\n            normal: {}\n          },\n          data: chartData.series.data\n        }]\n      };\n      return option;\n    };\n\n    $scope.expObj = {};\n    $scope.kPIsExportOrder;\n    /**\n     * PROMETHEUS-585 初始化时查询是否有保存在全局配置里的设置，并且恢复\n     */\n\n    var queryExpInitObj = function queryExpInitObj() {\n      if (!$scope.kPIsExportOrder) {\n        configUIService.getConfigsByGroupName(\"KPIsExportOrder\", function (returnObj) {\n          if (returnObj.code == 0 && returnObj.data.length > 0) {\n            if (returnObj.data[0].value) {\n              returnObj.data[0].value = JSON.parse(returnObj.data[0].value);\n            }\n\n            $scope.kPIsExportOrder = returnObj.data[0];\n          }\n        });\n      } else {\n        if (Object.prototype.toString.call($scope.kPIsExportOrder.value) !== \"[object Object]\") {\n          $scope.kPIsExportOrder.value = JSON.parse($scope.kPIsExportOrder.value);\n        }\n      }\n\n      $scope.expObj = {\n        \"packNumber\": 1,\n        \"packType\": \"天\",\n        \"censusNumber\": 1,\n        \"censusType\": \"分钟\"\n      };\n      $scope.expObj.paramkpis = [];\n\n      if ($scope.selectedItem.kpiCodes) {\n        var i = 0;\n        $scope.selectedItem.kpiCodes.forEach(function (kpiCode) {\n          if ($scope.selectedDitem.kpisObj[kpiCode] != undefined) {\n            var kpiObj = jQuery.extend(true, {}, $scope.selectedDitem.kpisObj[kpiCode]);\n            kpiObj.index = $scope.kPIsExportOrder.value[kpiObj.id] ? $scope.kPIsExportOrder.value[kpiObj.id] : i;\n            $scope.expObj.paramkpis.push(kpiObj);\n            i++;\n          }\n        });\n      }\n    };\n    /**\n     * 根据开始时间跟结束时间段算天，小时，分钟，秒钟\n     * @param type  提示字段的类型\n     * @param start  开始时间\n     * @param end    结束时间\n     * @param val    传填写好的值\n     * @param status  例如：天，小时，分钟，秒钟\n     */\n\n\n    var timePeriod = function timePeriod(type, start, end, val, status) {\n      var startGetTime = new Date($scope.selectedItem.startTime).getTime();\n      var endGetTime = new Date($scope.selectedItem.endTime).getTime();\n      var time = endGetTime - startGetTime;\n      var days = 0;\n      var str = true;\n\n      if (status == '小时') {\n        if (val > 0) {\n          days = parseInt(time / (1000 * 60 * 60));\n\n          if (val > days) {\n            str = \"您选择的\" + type + \"\" + status + \"大于时间范围，最大值不能超过\" + days + \"\" + status + \"\";\n          }\n        }\n      } else if (status == '天') {\n        if (val > 0) {\n          days = parseInt(time / (1000 * 60 * 60 * 24));\n\n          if (val > days) {\n            str = \"您选择的\" + type + \"\" + status + \"大于时间范围，最大值不能超过\" + days + \"\" + status + \"\";\n          }\n        }\n      } else if (status == '分钟') {\n        if (val > 0) {\n          days = parseInt(time / (1000 * 60));\n\n          if (val > days) {\n            str = \"您选择的\" + type + \"\" + status + \"大于时间范围，最大值不能超过\" + days + \"\" + status + \"\";\n          }\n        }\n      } else if (status == '秒钟') {\n        if (val > 0) {\n          days = parseInt(time / 1000);\n\n          if (val > days) {\n            str = \"您选择的\" + type + \"\" + status + \"大于时间范围，最大值不能超过\" + days + \"\" + status + \"\";\n          }\n        }\n      }\n\n      return str;\n    };\n\n    var msecConvert = function msecConvert(count, type) {\n      var time = \"\";\n\n      if (type == '小时') {\n        if (count > 0) {\n          time = count * (1000 * 60 * 60);\n        }\n      } else if (type == '天') {\n        if (count > 0) {\n          time = count * (24 * 60 * 60 * 1000);\n        }\n      } else if (type == '分钟') {\n        if (count > 0) {\n          time = count * (1000 * 60);\n        }\n      } else if (type == '秒钟') {\n        if (count > 0) {\n          time = count * 1000;\n        }\n      }\n\n      return time;\n    };\n\n    $scope.exportKpi = function () {\n      if ($scope.expObj.packNumber && $scope.expObj.packType) {\n        var retStatus = timePeriod(\"打包时间\", $scope.selectedItem.startTime, $scope.selectedItem.endTime, $scope.expObj.packNumber, $scope.expObj.packType);\n\n        if (retStatus != true) {\n          growl.warning(retStatus, {});\n          return;\n        }\n      }\n\n      if ($scope.expObj.censusNumber && $scope.expObj.censusType) {\n        var retStatus = timePeriod(\"统计周期\", $scope.selectedItem.startTime, $scope.selectedItem.endTime, $scope.expObj.censusNumber, $scope.expObj.censusType);\n\n        if (retStatus != true) {\n          growl.warning(retStatus, {});\n          return;\n        }\n      }\n\n      $scope.closeDialog();\n      $scope.loadingShow = true; // PROMETHEUS-496 导出时对数据进行排序\n\n      $scope.expObj.paramkpis.sort(function (a, b) {\n        return parseInt(a.index) - parseInt(b.index);\n      });\n      var kpiCodes = [];\n      $scope.expObj.paramkpis.forEach(function (kpi) {\n        kpiCodes.push(kpi.id);\n        $scope.kPIsExportOrder.value[kpi.id] = kpi.index;\n      }); // PROMETHEUS-585 保存到全局配置\n\n      if ($scope.kPIsExportOrder) {\n        $scope.kPIsExportOrder.value = JSON.stringify($scope.kPIsExportOrder.value);\n        configUIService.saveConfig($scope.kPIsExportOrder, function (returnObj) {\n          if (returnObj.code == 0) {}\n        });\n      }\n\n      var packMis = 0;\n      var censusMis = 0;\n      var queryObj = {\n        isRealTimeData: false,\n        startTime: new Date($scope.selectedItem.startTime),\n        endTime: new Date($scope.selectedItem.endTime),\n        // timePeriod: endTime - startTime,\n        nodeIds: $scope.selectedItem.nodeIds,\n        kpiCodes: kpiCodes\n      };\n\n      if ($scope.expObj.packNumber > 0 && $scope.expObj.packType) {\n        packMis = msecConvert($scope.expObj.packNumber, $scope.expObj.packType);\n      } else {\n        growl.warning(\"打包时间不能填0哦！\", {});\n        return;\n      }\n\n      if ($scope.expObj.censusNumber > 0 && $scope.expObj.censusType) {\n        censusMis = msecConvert($scope.expObj.censusNumber, $scope.expObj.censusType);\n      } else {\n        growl.warning(\"统计周期不能填0哦！\", {});\n        return;\n      }\n\n      kpiDataService.exportKpiValueList([\"kpi\", queryObj, censusMis, packMis, false], function (res) {\n        $scope.loadingShow = false;\n\n        if (res.code == 0) {\n          console.log(\"JSON.straing\" + res.data);\n          var msgDetail = res.data;\n\n          if (msgDetail.indexOf('download') > 0) {\n            window.location.href = userUIService.uploadFileUrl + \"/\" + msgDetail;\n          } else {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              message: res.data,\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  $scope.loadingShow = true;\n                  kpiDataService.exportKpiValueList([\"kpi\", queryObj, censusMis, packMis, true], function (returnObj) {\n                    if (returnObj.code == 0) {\n                      $scope.loadingShow = false;\n\n                      if (returnObj.data.indexOf('/') > 0) {\n                        window.location.href = userUIService.uploadFileUrl + \"/\" + returnObj.data;\n                      } else {\n                        growl.info(\"操作异常请联系管理员\");\n                      }\n                    }\n                  });\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  dialogRef.close();\n                }\n              }]\n            });\n          }\n        }\n      });\n    }; //查询及展示数据字段\n\n\n    function initHistory() {\n      queryExpInitObj();\n      $scope.selectedItem = {\n        \"domain\": \"\",\n        \"modelId\": null,\n        \"nodeIds\": [],\n        //设备id的数组\n        \"nodeId\": '',\n        //所选单个设备Id\n        \"kpiCodes\": [],\n        //\n        \"kpiId\": \"\",\n        \"startTime\": \"\",\n        \"endTime\": \"\",\n        \"customerId\": \"\",\n        \"projectId\": \"\",\n        \"time\": null\n      };\n      $scope.selectedDitem.devices = [];\n      $scope.selectedDitem.kpis = [];\n      $scope.selectedDitem.nodeIds = [];\n      $scope.selectedDitem.kpiCodes = [];\n\n      if ($scope.clearSelectTime) {\n        $scope.clearSelectTime();\n      }\n    }\n\n    $scope.exportClick = function () {\n      var startTime = new Date($scope.selectedItem.endTime).Format(\"yyyy-MM-dd\");\n      var time = new Date($scope.selectedItem.startTime).Format(\"yyyy-MM-dd\");\n      var sp1 = startTime.split('-');\n      var sp2 = time.split('-');\n\n      if (parseInt(sp1[0]) < parseInt(sp2[0]) || parseInt(sp1[1]) < parseInt(sp2[1]) || parseInt(sp1[1]) == parseInt(sp2[1]) && parseInt(sp1[2]) < parseInt(sp2[2])) {\n        growl.warning(\"您选择的开始时间小于结束时间\", {});\n        return;\n      }\n\n      queryExpInitObj();\n      ngDialog.open({\n        template: '../partials/dialogue/query_device.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n    };\n    /**\n     * 格式化时间格式(YYYY-MM-Day HH:MM:SS)\n     */\n\n\n    var formatDate = function formatDate(datestr) {\n      // datestr = $filter('date')(datestr, 'yyyy-MM-dd HH:mm:ss');\n      datestr = new Date(datestr).Format(\"yyyy-MM-dd hh:mm:ss\");\n      return datestr;\n    };\n    /**\n     * 格式化返回历史数据\n     * @param data\n     */\n\n\n    function formatData(data) {\n      //chart图数据\n      var chartData = {\n        \"title\": \"\",\n        \"xData\": [],\n        \"series\": {\n          \"data\": []\n        }\n      }; //表格数据\n\n      var tableData = {\n        \"name\": \"\",\n        \"unit\": \"\",\n        \"data\": []\n      }; //处理图表数据，遍历出xData,series.data\n\n      var chartDataDir = {};\n      $scope.selectedItem.kpiCodes.forEach(function (kpiCode) {\n        if ($scope.selectedDitem.kpisObj[kpiCode] != undefined) {\n          chartData.title = $scope.selectedDitem.kpisObj[kpiCode].name;\n          chartDataDir[kpiCode] = jQuery.extend(true, {}, chartData);\n        }\n      });\n      data.forEach(function (e) {\n        chartDataDir[e.kpiCode].title = e.kpiName;\n        chartDataDir[e.kpiCode].xData.push(formatDate(e.arisingTime));\n        chartDataDir[e.kpiCode].series.data.push(e.value); //Table表格数据\n\n        tableData.data.push({\n          \"name\": formatDate(e.arisingTime),\n          \"value\": e.value\n        });\n      });\n      $scope.selectedItem.kpiCodes.forEach(function (kpiCode) {\n        $scope.$broadcast(Event.ECHARTINFOSINIT, {\n          name: kpiCode,\n          option: getOption(chartDataDir[kpiCode])\n        });\n      }); //聚合Table表格展示的数据\n\n      tableData.data.reverse();\n      $scope.tableData = tableData;\n    }\n    /**\n     * 格式化kpi值\n     * @param r = range\n     * @param v = value\n     */\n\n\n    function formatKpiValue(r, v) {\n      if (r == null || r == undefined || r == '') {\n        return v;\n      }\n\n      if (r.indexOf('{') > -1 && r.indexOf(':') > -1) {\n        //说明返回的是json格式\n        try {\n          r = JSON.parse(r);\n          v = r[v];\n        } catch (e) {\n          console.log(\"返回值不是标准对象，在转换JSON时报错: \" + e);\n        }\n      }\n\n      return v;\n    }\n\n    ;\n    /**\n     * 指标参数\n     */\n\n    var initKpiData = function initKpiData() {\n      $scope.kpiData = {\n        \"idArray\": [],\n        \"unitArray\": [],\n        \"labelArray\": [],\n        \"granularityArray\": [],\n        \"granularityUnitArray\": []\n      };\n      var xData = [];\n      var series = [{\n        \"data\": []\n      }];\n    }; //格式化单位\n\n\n    (function () {\n      unitService.getAllUnits(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.formatUnits = returnObj.data;\n        }\n      });\n    })(); //设备模板选择获取设备和kpi指标\n\n\n    $scope.getDeviceByDeviceType = function (modelId) {\n      $scope.selectedItem.kpiId = \"\";\n      $scope.selectedItem.nodeId = \"\"; //清空选中的设备\n\n      if (modelId) {\n        $scope.queryState = true;\n        getResourceDevices(modelId);\n        getKpisBymodelId(modelId);\n      } else {\n        $scope.queryState = false;\n      }\n    };\n\n    $scope.projectsCustomerList = [];\n\n    $scope.customerChange = function () {\n      if ($scope.selectedItem.customerId) {\n        $scope.projectsCustomerList = $scope.projectsListAll;\n        $scope.projectsList = $scope.projectsListAll;\n      } else {\n        $scope.projectsCustomerList = [];\n        $scope.projectsList = [];\n      } //如果设备模板、项目、客户都没有选择，那么按照域查询指标\n\n\n      if (!$scope.selectedDitem.modelId && !$scope.selectedItem.projectId) getKpisBymodelId(301);\n    };\n\n    $scope.projectChange = function () {\n      //如果设备模板、项目、客户都没有选择，那么按照域查询指标\n      if (!$scope.selectedDitem.modelId) getKpisBymodelId(302);\n    }; //根据域和设备模板过滤设备\n\n\n    $scope.getDevices = function (domainPath) {\n      if (domainPath) {\n        var arrIds = [];\n\n        for (var i in $scope.selectedDitem.devices) {\n          if ($scope.selectedDitem.devices[i].domainPath.indexOf(domainPath) > -1) {\n            arrIds.push($scope.selectedDitem.devices[i].id);\n            $scope.selectedDitem.devices[i].visible = true;\n          } else {\n            $scope.selectedDitem.devices[i].visible = false;\n          }\n        }\n\n        $scope.selectedItem.nodeIds = arrIds;\n        $scope.selectedDitem.nodeIds = arrIds; //如果设备模板、项目、客户都没有选择，那么按照域查询指标\n        //这里有一个bug，如果两次以上选中一个模板时，测点显示就不对了\n\n        if (!$scope.selectedItem.modelId && !$scope.selectedItem.projectId && !$scope.selectedItem.customerId) getKpisBymodelId(300);\n      }\n    }; //根据域和设备筛选出的设备进行二次选择\n\n\n    $scope.getselectedDevice = function (p) {\n      if (p) {\n        $scope.selectedItem.nodeIds = [];\n        $scope.selectedItem.nodeIds.push(p);\n      } else if (p == null) {\n        $scope.selectedItem.nodeIds = $scope.selectedDitem.nodeIds;\n      }\n    }; //根据选取的kpi过滤设备\n\n\n    $scope.getKpi = function (kpiId) {\n      if (kpiId && kpiId.length > 0) {\n        //这里有一个bug，kpiId长度是0的时候，也是需要进行初始化设置\n        $scope.selectedItem.kpiCodes = [];\n        $scope.selectedItem.kpiCodes = kpiId;\n      } else {\n        $scope.selectedItem.kpiCodes = $scope.selectedDitem.kpiCodes;\n      }\n    };\n\n    function querydeviceData(kpiQueryModel, searchTypeName) {\n      var value = \"\";\n      $scope.tableDataLoading = true;\n      $scope.kpiQueryModelObj = kpiQueryModel;\n      kpiDataService.queryDeviceData(kpiQueryModel, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.tableDataLoading = false;\n\n          for (var i in returnObj.data) {\n            $scope.showDeviceData[i] = returnObj.data[i];\n            $scope.showDeviceData[i].deviceName = searchTypeName;\n\n            if (returnObj.data[i].instance == null || returnObj.data[i].instance == \"null\") {\n              $scope.showDeviceData[i].instance = \"\";\n            }\n\n            for (var k in $scope.selectedDitem.devices) {\n              if (returnObj.data[i].nodeId == $scope.selectedDitem.devices[k].id) {\n                $scope.showDeviceData[i].deviceName = $scope.selectedDitem.devices[k].label;\n              }\n            }\n\n            for (var j in $scope.selectedDitem.kpis) {\n              if (returnObj.data[i].kpiCode == $scope.selectedDitem.kpis[j].id) {\n                $scope.showDeviceData[i].kpiName = $scope.selectedDitem.kpis[j].label;\n                value = formatKpiValue($scope.selectedDitem.kpis[j].range, returnObj.data[i].value);\n                $scope.showDeviceData[i].kpiValue = value + $scope.selectedDitem.kpis[j].unit;\n              }\n            }\n          }\n\n          $timeout(function () {\n            //初始化图表数据\n            $scope.tableData = {\n              \"name\": \"\",\n              \"unit\": \"\",\n              \"data\": []\n            }; //历史数据table数据的展示\n\n            if ($scope.showDeviceData.length != 0) {\n              formatData($scope.showDeviceData);\n            }\n\n            $scope.$broadcast(Event.DEVICEDATAINIT, {\n              \"option\": [$scope.showDeviceData]\n            });\n          });\n        }\n      });\n    }\n\n    ;\n\n    $scope.clearSearch = function (sel) {\n      if (sel == \"domain\") {\n        $scope.selectedItem.customerId = '';\n        $scope.selectedItem.projectId = '';\n        $scope.selectedItem.modelId = '';\n        $scope.selectedItem.nodeId = '';\n        $scope.selectedDitem.devices = [];\n      } else if (sel == \"customers\") {\n        $scope.selectedItem.projectId = '';\n        $scope.selectedItem.modelId = '';\n        $scope.selectedItem.nodeId = '';\n        $scope.selectedDitem.devices = [];\n      } else if (sel == \"project\") {\n        $scope.selectedItem.modelId = '';\n        $scope.selectedItem.nodeId = '';\n        $scope.selectedDitem.devices = [];\n      }\n    }; //查询\n\n\n    $scope.searchData = function () {\n      var attrSearchCount = $scope.baseConfig && $scope.baseConfig.attrSearchCount ? $scope.baseConfig.attrSearchCount : 99999; //      if(!$scope.selectedItem.modelId || $scope.selectedItem.modelId == undefined) {\n      //        growl.info(\"请选择设备模板再进行查询\", {});\n      //        $scope.queryState = false;\n      //        return;\n      //      }\n\n      if (!$scope.selectedItem.kpiCodes && $scope.selectedItem.kpiCodes.length == 0) {\n        growl.info(\"测点数量不能为空\", {});\n        $scope.queryState = false;\n        return;\n      }\n\n      if ($scope.selectedItem.kpiId && $scope.selectedItem.kpiId.length > attrSearchCount) {\n        growl.info(\"测点数量最多不超过\" + attrSearchCount + \"个\", {});\n        $scope.queryState = false;\n        return;\n      }\n\n      $scope.ifTables = true;\n      $scope.showDeviceData = [];\n      var kpiQueryModel = {};\n      var nowTime = new Date().getTime();\n      var searchNodeIds = [];\n      var searchTypeName = \"\";\n\n      if ($scope.selectedItem.nodeIds && $scope.selectedItem.nodeIds.length > 0) {\n        //如果有设备\n        searchNodeIds = $scope.selectedItem.nodeIds;\n      } else if ($scope.selectedItem.projectId) {\n        //如果项目\n        searchNodeIds = [$scope.selectedItem.projectId];\n        searchTypeName = $scope.projectsDic[$scope.selectedItem.projectId].projectName;\n      } else if ($scope.selectedItem.customerId) {\n        //如果客户\n        searchNodeIds = [$scope.selectedItem.customerId];\n        searchTypeName = $scope.customersDic[$scope.selectedItem.customerId].customerName;\n      } else if ($scope.selectedItem.domain) {\n        //如果域\n        var domainInfo = $scope.domainListDic[$scope.selectedItem.domain];\n        searchNodeIds = [domainInfo.id];\n        searchTypeName = domainInfo.label;\n      }\n\n      if ($scope.selectedItem.startTime && $scope.selectedItem.endTime) {\n        kpiQueryModel = {\n          isRealTimeData: false,\n          startTime: new Date($scope.selectedItem.startTime),\n          endTime: new Date($scope.selectedItem.endTime),\n          // timePeriod: endTime - startTime,\n          nodeIds: searchNodeIds,\n          kpiCodes: $scope.selectedItem.kpiCodes,\n          includeInstance: true\n        };\n        querydeviceData(kpiQueryModel, searchTypeName);\n      } else {\n        kpiQueryModel = {\n          isRealTimeData: true,\n          nodeIds: searchNodeIds,\n          kpiCodes: $scope.selectedItem.kpiCodes,\n          includeInstance: true\n        };\n        querydeviceData(kpiQueryModel, searchTypeName);\n      }\n    }; //取消\n\n\n    $scope.cancelRecords = function () {\n      initHistory();\n      $scope.queryState = false;\n      $scope.projectsList = [];\n    }; //通过设备模板获取设备\n\n\n    function getResourceDevices(modelID) {\n      $scope.selectedItem.nodeIds = [];\n      $scope.selectedDitem.devices = [];\n      resourceUIService.getDevicesByCondition({\n        \"modelId\": modelID\n      }, function (returnObj) {\n        if (returnObj.code == 0) {\n          var arr = [];\n\n          for (var i in returnObj.data) {\n            arr.push(returnObj.data[i].id);\n            returnObj.data[i].visible = true;\n          }\n\n          $scope.selectedItem.nodeIds = arr;\n          $scope.selectedDitem.nodeIds = arr;\n          $scope.selectedDitem.devices = returnObj.data;\n          if ($scope.selectedItem.domain) $scope.getDevices($scope.selectedItem.domain);\n        }\n      });\n    }\n\n    ; //根据用户Id查用户域\n\n    var domainTreeQuery = function domainTreeQuery() {\n      var domainCallback = function domainCallback(data) {\n        $scope.domainListTree = data.domainListTree;\n        $scope.domainListDic = data.domainListDic;\n      };\n\n      if (!$scope.menuitems[\"isloaded\"]) {\n        var menuitemsWatch = $scope.$watch('menuitems', function (o, n) {\n          if ($scope.menuitems[\"isloaded\"]) {\n            if ($scope.baseConfig.extendDomain) {\n              resourceUIService.getExtendDomainsByFilter({}, domainCallback);\n            } else {\n              userDomainService.queryDomainTree(userLoginUIService.user.userID, domainCallback);\n            }\n\n            menuitemsWatch();\n          }\n        }, true);\n      } else if ($scope.baseConfig.extendDomain) {\n        resourceUIService.getExtendDomainsByFilter({}, domainCallback);\n      } else {\n        userDomainService.queryDomainTree(userLoginUIService.user.userID, domainCallback);\n      }\n    }; //设备模板目录树拼接\n\n\n    function handler(returnObj) {\n      if (returnObj.code == 0) {\n        resourceUIService.rootModelDic = {};\n\n        for (var i in returnObj.data) {\n          var obj = returnObj.data[i];\n          if (!$scope.routePathNodes[obj.parentModelId]) $scope.routePathNodes[obj.parentModelId] = [];\n          $scope.routePathNodes[obj.parentModelId].push(obj);\n          if (!$scope.routePathNodes[obj.id]) $scope.routePathNodes[obj.id] = [];\n          resourceUIService.rootModelDic[obj.id] = obj;\n        }\n\n        var addNodes = function addNodes(parentNode) {\n          for (var modeid in $scope.routePathNodes) {\n            if (modeid == parentNode.id) {\n              parentNode.nodes = $scope.routePathNodes[modeid];\n\n              for (var i in parentNode.nodes) {\n                addNodes(parentNode.nodes[i]);\n              }\n\n              if (parentNode.nodes.length == 0) {\n                parentNode.nodes = null;\n              }\n            }\n          }\n        };\n\n        var initRoutePath = function initRoutePath(node, arr) {\n          for (var i in node.nodes) {\n            if ($routeParams.modelId == node.nodes[i].id) {\n              if (node.id != arr[0].id) arr.push(node);\n              break;\n            } else {\n              initRoutePath(node.nodes[i], arr);\n            }\n          }\n        };\n\n        addNodes(resourceUIService.rootModel);\n\n        for (var key in $scope.routePathNodes) {\n          if (key != resourceUIService.rootModel.id && !resourceUIService.rootModelDic[key]) {\n            for (var i in $scope.routePathNodes[key]) {\n              addNodes($scope.routePathNodes[key][i]);\n              if (!resourceUIService.rootModel.nodes) resourceUIService.rootModel.nodes = [];\n              $scope.routePathNodes[key][i].parentModelId = resourceUIService.rootModel.id;\n              resourceUIService.rootModel.nodes.push($scope.routePathNodes[key][i]);\n            }\n          }\n        }\n\n        resourceUIService.rootModelDic[resourceUIService.rootModel.id] = resourceUIService.rootModel;\n        $scope.rootModelDic = resourceUIService.rootModelDic;\n        $scope.rootModel = resourceUIService.rootModel;\n      }\n    }\n\n    ; //查询所有的设备模板\n\n    var modelList = function modelList() {\n      resourceUIService.getModels(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.modelListSelect = returnObj.data;\n          handler(returnObj);\n        }\n      });\n    }; // 通过设备模板获取kpi指标\n\n\n    function getKpisBymodelId(modelID) {\n      $scope.selectedItem.kpiCodes = [];\n      $scope.selectedDitem.kpis = [];\n      $scope.selectedDitem.kpisObj = {};\n      if (!$scope.rootModelDic[modelID]) $scope.rootModelDic[modelID] = {};\n\n      if (!$scope.rootModelDic[modelID][\"kpiloaded\"]) {\n        resourceUIService.getDataItemsByModelId(modelID, function (returnObj) {\n          if (returnObj.code == 0) {\n            var regExp = /\\{|\\[.*\\}|\\]/;\n            var kpiCodes = [];\n\n            for (var i in returnObj.data) {\n              kpiCodes.push(returnObj.data[i].id);\n              $scope.selectedDitem.kpisObj[returnObj.data[i].id] = returnObj.data[i]; //格式化kpi单位\n\n              $scope.formatUnits.forEach(function (e) {\n                if (e.unitCode == returnObj.data[i].unit) {\n                  returnObj.data[i].unit = e.unitName;\n                }\n              });\n\n              if (returnObj.data[i].range) {\n                var find = regExp.test(returnObj.data[i].range);\n                var rangeObj = [];\n\n                if (find) {\n                  try {\n                    rangeObj = find ? JSON.parse(returnObj.data[i].range) : [];\n                  } catch (e) {}\n                }\n\n                returnObj.data[i].rangeAry = rangeObj;\n\n                if (rangeObj instanceof Array) {\n                  returnObj.data[i].rangeAry = rangeObj;\n\n                  if (rangeObj.length == 2) {\n                    returnObj.data[i].min = rangeObj[0];\n                    returnObj.data[i].max = rangeObj[1];\n                  }\n                } else if (rangeObj instanceof Object) {\n                  returnObj.data[i].rangeObj = rangeObj;\n                }\n              }\n            }\n\n            $scope.rootModelDic[modelID][\"kpiloaded\"] = true;\n            $scope.rootModelDic[modelID].kpis = returnObj.data;\n            $scope.selectedDitem.kpis = returnObj.data;\n            $scope.rootModelDic[modelID].kpiCodes = kpiCodes;\n            $scope.selectedDitem.kpiCodes = kpiCodes;\n            $scope.selectedItem.kpiCodes = kpiCodes;\n          }\n        });\n      } else {\n        $scope.selectedDitem.kpis = $scope.rootModelDic[modelID].kpis;\n        $scope.selectedDitem.kpiCodes = $scope.rootModelDic[modelID].kpiCodes;\n        $scope.selectedItem.kpiCodes = $scope.rootModelDic[modelID].kpiCodes;\n\n        for (var j in $scope.rootModelDic[modelID].kpis) {\n          $scope.selectedDitem.kpisObj[$scope.rootModelDic[modelID].kpis[j].id] = $scope.rootModelDic[modelID].kpis[j];\n        }\n      }\n    }\n\n    ;\n    /**\n     * 获得客户列表\n     */\n\n    $scope.customersList;\n    $scope.customersDic = {};\n\n    var queryCustomer = function queryCustomer() {\n      customerUIService.findCustomersByCondition({}, function (returnObj) {\n        $scope.customersDic = returnObj.customerDic;\n        returnObj.data.forEach(function (item) {\n          item.text = item.customerName;\n        });\n        var obj = {\n          \"text\": \"请选择\",\n          \"value\": \"-1\"\n        };\n        returnObj.data.unshift(obj);\n        $scope.customersList = returnObj.data;\n      });\n    };\n    /**\n     * 查询项目\n     */\n\n\n    $scope.projectsList;\n    $scope.projectsListAll;\n    $scope.projectsDic = {};\n\n    $scope.queryProject = function () {\n      projectUIService.findProjectsByCondition({}, function (returnObj) {\n        if (returnObj.code == 0) {\n          returnObj.data.forEach(function (item) {\n            $scope.projectsDic[item.id] = item;\n            item.text = item.projectName;\n          });\n          var obj = {\n            \"text\": \"请选择\",\n            \"value\": \"-1\"\n          };\n          returnObj.data.unshift(obj);\n          $scope.projectsListAll = returnObj.data;\n        }\n      });\n    };\n\n    $scope.activeListTab = \"tab1\";\n\n    var initEvent = function initEvent() {\n      var attrSearchCount = $scope.baseConfig && $scope.baseConfig.attrSearchCount ? $scope.baseConfig.attrSearchCount : 99999;\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        var aname = $(e.target).attr(\"name\");\n        var targetText = $(e.target).text();\n\n        if (aname) {\n          $scope.activeListTab = aname;\n\n          if (aname == 'tab2') {\n            if ($scope.selectedItem.nodeId == '' || $scope.selectedItem.nodeId == null) {\n              growl.info(\"请选择一个设备\", {});\n            } else if ($scope.selectedItem.kpiId.length <= 0) {\n              growl.info(\"请选择一个测点\", {});\n            } else if ($scope.selectedItem.kpiId.length > attrSearchCount) {\n              growl.info(\"测点最多不超过\" + attrSearchCount + \"个\", {});\n            }\n          }\n\n          $scope.$apply();\n          $timeout(function () {\n            $('.chart').resize();\n          }, 300);\n        }\n      });\n    };\n\n    var init = function init() {\n      initEvent();\n      initHistory();\n      initKpiData();\n      domainTreeQuery();\n      queryCustomer();\n      $scope.queryProject();\n      resourceUIService.getRootModel(function (returnObj) {\n        if (returnObj.code == 0) {\n          resourceUIService.rootModel = returnObj.data;\n          modelList();\n        }\n      });\n      $timeout(function () {\n        $scope.$broadcast(Event.DEVICEDATAINIT, {\n          \"option\": []\n        });\n      });\n    };\n    /**\n     * 标准初始化，在用户登录后执行\n     */\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]); //设备数据统计\n\n  controllers.initController('statisticsDeviceDataCtrl', ['$scope', '$filter', 'userInitService', 'unitService', 'userDomainService', 'resourceUIService', '$location', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'Info', 'growl', function ($scope, $filter, userInitService, unitService, userDomainService, resourceUIService, $location, $routeParams, $timeout, kpiDataService, userLoginUIService, Info, growl) {\n    $scope.domainListDic = {}; //域字典\n\n    $scope.domainListTree = {};\n    $scope.rootModel = {};\n    $scope.rootModelDic = {};\n    $scope.routePathNodes = {};\n    $scope.modelListSelect; //模型的列表\n\n    $scope.chartData = {\n      //图表\n      \"xData\": [],\n      \"series\": {\n        \"name\": \"\",\n        \"type\": \"line\",\n        \"data\": []\n      }\n    };\n    var target = echarts.init($(\"#linedataview\")[0]);\n    $scope.selectedDitem = {\n      'label': [],\n      //用于在视图中展示设备信息\n      'kpisObj': {}\n    };\n    $scope.statiMethod = [{\n      smId: \"max\",\n      smName: \"最大值\"\n    }, {\n      smId: \"min\",\n      smName: \"最小值\"\n    }, {\n      smId: \"avg\",\n      smName: \"平均值\"\n    }, {\n      smId: \"sum\",\n      smName: \"求和\"\n    }];\n    $scope.copy = {\n      'devicesData': [],\n      //存储设备模板或者设备域过滤出来的所有设备\n      'nodeIds': []\n    };\n    $scope.showDeviceData = []; // $scope.shyj = 1;\n\n    $scope.ifTables = false;\n    $scope.history = ''; //查询及展示数据字段\n\n    function initHistory() {\n      $scope.selectedItem = {\n        \"nodeType\": \"\",\n        \"domain\": \"\",\n        \"nodeIds\": [],\n        //设备id的数组\n        \"kpiCodes\": [],\n        //\n        \"kpiId\": \"\",\n        \"statisticType\": '',\n        //统计方式\n        \"statisticTimeType\": '',\n        //统计粒度\n        \"startTime\": \"\",\n        \"endTime\": \"\",\n        \"kpilabel\": \"\"\n      };\n      $scope.selectedDitem.label = [];\n      $scope.selectedDitem.kpis = [];\n    }\n    /**\n     * 格式化kpi值\n     * @param r = range\n     * @param v = value\n     */\n\n\n    function formatKpiValue(r, v) {\n      if (r == null || r == undefined || r == '') {\n        return v;\n      }\n\n      if (r.indexOf('{') > -1 && r.indexOf(':') > -1) {\n        //说明返回的是json格式\n        try {\n          r = JSON.parse(r);\n          v = r[v];\n        } catch (e) {\n          console.log(\"返回值不是标准对象，在转换JSON时报错: \" + e);\n        }\n      }\n\n      return v;\n    }\n\n    ; //格式化单位\n\n    (function () {\n      unitService.getAllUnits(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.formatUnits = returnObj.data;\n        }\n      });\n    })(); //定义EChart option\n\n\n    var getOption = function getOption(chartData) {\n      return {\n        title: {\n          text: '',\n          subtext: '',\n          x: 'center',\n          y: 'top'\n        },\n        tooltip: {\n          trigger: 'axis',\n          formatter: function formatter(params) {\n            params = params[0];\n            var date = params.name;\n            var value = params.value || params.value == 0 ? params.value : '';\n            var name = chartData.series.name ? chartData.series.name : '';\n            return date ? date + '<br>' + name + ' : ' + value : '没有数据';\n          }\n        },\n        // toolbox: {\n        //   feature: {\n        //     dataView: {},\n        //     saveAsImage: {\n        //       type: 'png'\n        //     }\n        //   }\n        // },\n        xAxis: [{\n          type: 'category',\n          boundaryGap: false,\n          data: chartData.xData //[]\n\n        }],\n        yAxis: [{\n          type: 'value',\n          axisLabel: {\n            formatter: '{value}'\n          }\n        }],\n        series: chartData.series //{name:'',type:'',data:[]}\n\n      };\n    }; //格式化设备数据\n\n\n    function formatData(data) {\n      //chart图数据\n      var chartData = {\n        \"xData\": [],\n        \"series\": {\n          \"name\": \"\",\n          \"type\": \"line\",\n          \"data\": []\n        }\n      };\n      data.forEach(function (e) {\n        if ($scope.selectedItem.statisticTimeType == \"hour\") {\n          chartData.xData.push($filter('date')(new Date(e.timeflag), 'yyyy-MM-dd HH:mm:ss'));\n        } else if ($scope.selectedItem.statisticTimeType == \"day\") {\n          chartData.xData.push($filter('date')(new Date(e.timeflag), 'yyyy-MM-dd'));\n        }\n\n        chartData.series.data.push(e.value);\n        var rangeObj = null;\n        $scope.selectedDitem.kpis.forEach(function (f) {\n          if (f.id == e.kpiCode) {\n            chartData.series.name = f.label;\n            if (f.rangeObj) rangeObj = f.rangeObj;\n          }\n        });\n      });\n      target.setOption(getOption(chartData)); //监听浏览器变化\n\n      $timeout(function () {\n        window.onresize = function () {\n          target.resize();\n        };\n      }); //聚合Chart数据\n\n      $scope.chartData = chartData;\n    }\n\n    ; //设备模板选择获取设备和kpi指标\n\n    $scope.getDeviceByDeviceType = function (modelId) {\n      getResourceDeviceLabel(modelId);\n      getKpisBymodelId(modelId);\n    }; //根据域和设备模板过滤设备\n\n\n    $scope.getDevices = function (domainPath) {\n      var arrIds = []; //存储筛选出来的设备Id\n\n      var arr = []; //存储筛选出来的设备信息\n\n      for (var i in $scope.copy.devicesData) {\n        if ($scope.copy.devicesData[i].domainPath.indexOf(domainPath) > -1) {\n          arrIds.push($scope.copy.devicesData[i].id);\n          arr.push($scope.copy.devicesData[i]);\n        }\n      }\n\n      $scope.selectedItem.nodeIds = arrIds;\n      $scope.copy.nodeIds = arrIds;\n      $scope.selectedDitem.label = arr;\n    }; //根据域和设备筛选出的设备进行二次选择\n\n\n    $scope.getselectedDevice = function (p) {\n      if (p) {\n        $scope.selectedItem.nodeIds = [];\n        $scope.selectedItem.nodeIds.push(p);\n      } else if (p == null) {\n        $scope.selectedItem.nodeIds = [];\n      }\n    }; //根据选取的kpi过滤设备\n\n\n    $scope.getKpi = function (kpiId) {\n      $scope.kpiId = kpiId;\n\n      if (kpiId == null) {\n        $scope.selectedItem.kpilabel = '';\n      } else {\n        for (var i in $scope.selectedDitem.kpis) {\n          if ($scope.selectedDitem.kpis[i].id == kpiId) {\n            $scope.selectedItem.kpilabel = $scope.selectedDitem.kpis[i].label;\n            break;\n          }\n        }\n      }\n    }; //查询函数\n\n\n    function querydeviceData(kpiQueryModel) {\n      var value = \"\";\n      kpiDataService.queryDeviceData(kpiQueryModel, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.ifTables = true;\n\n          if (jQuery(\"#devicecollapse\").find(\".fa.fa-plus\").length > 0) {\n            jQuery.AdminLTE.boxWidget.collapse(jQuery(\"#devicecollapse\"));\n          }\n\n          formatData(returnObj.data);\n        }\n      });\n    } //查询\n\n\n    $scope.searchData = function () {\n      $scope.showDeviceData = [];\n      $scope.selectedItem.kpiCodes = [];\n      var kpiQueryModel = {};\n      var nowTime = new Date().getTime();\n      var startTime = new Date($scope.selectedItem.startTime).getTime();\n      var endTime = new Date($scope.selectedItem.endTime).getTime();\n\n      if ($scope.selectedItem.nodeType == \"\" || $scope.selectedItem.nodeType == undefined) {\n        growl.info(\"请选择设备模板再进行查询\", {});\n        $scope.ifTables = false;\n        return;\n      }\n\n      if ($scope.kpiId == '' || $scope.kpiId == undefined || $scope.kpiId == null || $scope.selectedItem.nodeIds.length == 0) {\n        growl.info(\"请选择完整必选项\", {});\n        $scope.ifTables = false;\n        return;\n      } else {\n        $scope.selectedItem.kpiCodes.push($scope.kpiId);\n      }\n\n      if (!$scope.selectedItem.endTime || !$scope.selectedItem.startTime || !$scope.selectedItem.statisticType || !$scope.selectedItem.statisticTimeType) {\n        growl.info(\"请选择完整必选项\", {});\n        $scope.ifTables = false;\n        return;\n      }\n\n      if ($scope.selectedItem.startTime && $scope.selectedItem.endTime) {\n        if (endTime - startTime > 2592000000) {\n          growl.info('时间选择范围请控制在30天之内', {});\n          $scope.ifTables = false;\n          return;\n        }\n\n        if (endTime - startTime < 0) {\n          growl.info('请正确输入时间范围', {});\n          $scope.ifTables = false;\n          return;\n        }\n\n        kpiQueryModel = {\n          isRealTimeData: false,\n          startTime: $scope.selectedItem.startTime,\n          endTime: $scope.selectedItem.endTime,\n          // timePeriod: endTime - startTime,\n          nodeIds: $scope.selectedItem.nodeIds,\n          kpiCodes: $scope.selectedItem.kpiCodes,\n          statisticTimeType: $scope.selectedItem.statisticTimeType,\n          includeInstance: true,\n          statisticType: $scope.selectedItem.statisticType\n        };\n        querydeviceData(kpiQueryModel);\n      }\n    }; //取消\n\n\n    $scope.cancelRecords = function () {\n      initHistory();\n      $scope.ifTables = false;\n    }; //通过设备模板获取设备\n\n\n    function getResourceDeviceLabel(modelID) {\n      $scope.selectedItem.domain = '';\n      $scope.selectedItem.nodeIds = [];\n      $scope.selectedDitem.label = [];\n      resourceUIService.getDevicesByCondition({\n        \"modelId\": modelID\n      }, function (returnObj) {\n        if (returnObj.code == 0) {\n          var arr = [];\n          $scope.selectedDitem.label = returnObj.data;\n          $scope.copy.devicesData = returnObj.data;\n\n          for (var i in returnObj.data) {\n            arr.push(returnObj.data[i].id);\n          }\n\n          $scope.copy.nodeIds = arr;\n        }\n      });\n    } //通过设备模板获取kpi指标\n\n\n    function getKpisBymodelId(modelID) {\n      $scope.selectedItem.kpiCodes = [];\n      resourceUIService.getDataItemsByModelId(modelID, function (returnObj) {\n        if (returnObj.code == 0) {\n          var regExp = /\\{|\\[.*\\}|\\]/;\n\n          for (var i in returnObj.data) {\n            //格式化kpi单位\n            $scope.formatUnits.forEach(function (e) {\n              if (e.unitCode == returnObj.data[i].unit) {\n                returnObj.data[i].unit = e.unitName;\n              }\n            });\n\n            if (returnObj.data[i].range) {\n              var find = regExp.test(returnObj.data[i].range);\n              var rangeObj = [];\n\n              if (find) {\n                try {\n                  rangeObj = find ? JSON.parse(returnObj.data[i].range) : [];\n                } catch (e) {}\n              }\n\n              returnObj.data[i].rangeAry = rangeObj;\n\n              if (rangeObj instanceof Array) {\n                returnObj.data[i].rangeAry = rangeObj;\n\n                if (rangeObj.length == 2) {\n                  returnObj.data[i].min = rangeObj[0];\n                  returnObj.data[i].max = rangeObj[1];\n                }\n              } else if (rangeObj instanceof Object) {\n                returnObj.data[i].rangeObj = rangeObj;\n              }\n            }\n          }\n\n          $scope.selectedDitem.kpis = returnObj.data;\n        }\n      });\n    }\n    /**\n     * 获取设备类型\n     *\n     */\n\n\n    function domainTreeQuery() {\n      var initTreeview = function initTreeview(obj) {\n        if (obj.domains) {\n          obj.nodes = [];\n\n          for (var i in obj.domains) {\n            obj.nodes.push(initTreeview(obj.domains[i]));\n          }\n\n          obj.tags = [obj.nodes.length];\n        }\n\n        if (obj.belong == 1) {\n          obj.state = {\n            checked: true\n          };\n        } else {\n          obj.state = {\n            checked: false\n          };\n        }\n\n        obj.text = obj.name;\n        obj.icon = \"ion ion-ios-color-filter\";\n        $scope.domainListDic[obj.domainPath] = obj;\n        if (obj.domainID) $scope.domainListDic[obj.domainID] = obj;else $scope.domainListDic[0] = obj;\n        return obj;\n      };\n\n      userDomainService.queryDomainTree(userLoginUIService.user.userID, function (data) {\n        var dom = [];\n        var newObj = {\n          parentID: \"\",\n          domainPath: \"\",\n          name: \"\",\n          description: \"\",\n          domains: data.data\n        };\n        dom.push(newObj);\n        var menu_list = initTreeview(dom[0]);\n        $scope.domainListTree = menu_list.nodes; // initSearchAlerts();\n      });\n    }\n    /**\n     * 设备模板名称汉化\n     * @param ciName\n     */\n\n\n    function urmpTree(ciName) {\n      resourceUIService.getModels(function (returnObj) {\n        if (returnObj.code == 0) {\n          resourceUIService.rootModelDic = {};\n          var tree = returnObj.data;\n\n          for (var i in tree) {\n            var obj = tree[i];\n            obj.text = obj.label;\n            if (!$scope.routePathNodes[obj.parentModelId]) $scope.routePathNodes[obj.parentModelId] = [];\n            $scope.routePathNodes[obj.parentModelId].push(obj);\n            if (!$scope.routePathNodes[obj.id]) $scope.routePathNodes[obj.id] = [];\n            var cmpObj = jQuery.extend(true, {}, obj);\n            resourceUIService.rootModelDic[cmpObj.id] = cmpObj;\n          }\n\n          var addNodes = function addNodes(parentNode) {\n            for (var modeid in $scope.routePathNodes) {\n              if (modeid == parentNode.id) {\n                parentNode.nodes = $scope.routePathNodes[modeid];\n\n                for (var i in parentNode.nodes) {\n                  addNodes(parentNode.nodes[i]);\n                }\n\n                if (parentNode.nodes.length == 0) {\n                  parentNode.nodes = null;\n                }\n              }\n            }\n          };\n\n          addNodes(resourceUIService.rootModel);\n\n          for (var key in $scope.routePathNodes) {\n            if (key != resourceUIService.rootModel.id && !resourceUIService.rootModelDic[key]) {\n              for (var i in $scope.routePathNodes[key]) {\n                addNodes($scope.routePathNodes[key][i]);\n                if (!resourceUIService.rootModel.nodes) resourceUIService.rootModel.nodes = [];\n                resourceUIService.rootModel.nodes.push($scope.routePathNodes[key][i]);\n              }\n            }\n          }\n\n          resourceUIService.rootModelDic[resourceUIService.rootModel.id] = resourceUIService.rootModel;\n          $scope.rootModel = resourceUIService.rootModel;\n          $scope.rootModelDic = resourceUIService.rootModelDic;\n        }\n      });\n    }\n\n    ;\n\n    if (!resourceUIService.rootModel) {\n      resourceUIService.getRootModel(function (returnObj) {\n        if (returnObj.code == 0) {\n          resourceUIService.rootModel = returnObj.data;\n          domainTreeQuery();\n        }\n      });\n    } else {\n      $scope.rootModel = resourceUIService.rootModel;\n      urmpTree();\n      domainTreeQuery();\n    }\n\n    var init = function init() {\n      initHistory();\n    };\n\n    init();\n  }]);\n});"],"sourceRoot":"/source/"}