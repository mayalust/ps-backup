{"version":3,"sources":["app-oc/js/controllers/view-cmdb-ctrl.js"],"names":["define","controllers","BootstrapDialog","controller","$scope","$routeParams","$timeout","kpiDataService","userLoginUIService","resourceUIService","alertService","SwSocket","Info","viewFlexService","unitService","growl","userDomainService","userEnterpriseService","console","info","routePaths","routePathNodes","selectedDitem","selectedDomainitem","selectedGateitem","selectedDirective","visible","editVisible","treeAry","domainsAry","gatewaysAry","activeMainTab","activeTab","previousMainTab","activeListTab","queryDomin","previousDomainID","previousDomainPath","uuid","Math","addUserStatus","getIcon","get","iconList","qualityIcon","kpiIconList","kpiIcon","random","icon","getDomainDeviceCount","domain","callback","getResourcesByDomainPath","domainPath","returnObj","domainDevices","data","count","length","getResourceCount","model","getResourceByModelId","id","code","resources","isLoaded","getUserFromThisDomain","getAssociateDomain2User","resultObj","i","isEdit","domainUserData","$broadcast","Event","DOMAININFOSINIT","domainUsers","gatewayDevices","gatewayactiveDevices","getDevices","gateway","devices","managedStatus","push","CMDBINFOSINIT","getResourcesByGatewayId","getResourceAttrs","getAttrsByModelId","attrs","initModelAtts","obj","idx","alertlv","type","getinstanceList","getKpisByModelId","kpis","getAlertsByModelId","alerts","objId","alertId","getThresholds","response","alertCode","thresholdsData","directives","getDirectivesByModelId","initDomainAtts","domainID","domainName","description","label","name","initGatewayAtts","externalGwId","accessName","accessPassword","protocolType","operationStatus","onlineStatus","activeTime","newDateJson","Format","GetDateCategoryStrByLabel","expireTime","validTime","urmpTree","ciName","getModels","tree","parentModelId","jQuery","extend","addNodes","parentNode","modeid","nodes","rootModel","modelId","arr","initRoutePath","node","reverse","click","item","ids","newObjAry","nodeIds","viewId","pName","viewList","v","viewType","search","viewTitle","getViewId","newObj","option","createTime","state","floor","externalDevId","values","health","selected","nodeId","getRealTimeKpiData","j","selectedInstances","value","selectedAttrs","reLoader","changeDItem","KPIEDITINIT","ALERTEDITINIT","DIRECTIVESINIT","columns","title","orderable","columnDefs","targets","render","full","str","userGridData","userID","userName","domainDeviceData","getDomainDeviceList","DOMAINDEVICESINIT","delDomainSubItem","success","domainTree","splice","eidtModel","addModel","show","closable","message","buttons","cssClass","action","dialogRef","newModelName","warning","newModel","doSave","getModalBody","find","val","close","$","eq","attr","delModel","deleteModel","queryDeleteDomain","deleteDomain","deleteGateway","gateWayTree","updateModel","addModelSubItem","isNew","isDel","newAttr","canEdit","dataType","newKpi","unit","range","number","granularity","granularityUnit","newAlert","expression","attrLabel","iconClick","indexId","thisId","delModelSubItem","saveModelSubItem","checkPass","saveAttrs","err","saveKpis","saveAlerts","saveDirectives","trim","test","addDomain","parentID","modifyDomain","cloudAdapter","saveGateway","addGateway","updateGateway","addUserToDomain","emailAddress","mobilePhone","officePhone","domainId","userType","userTypeLabel","jobTitle","discription","edit","addIns","gatewayId","doAction","select","addData","addResource","updataData","updateResource","deleteResource","location","href","params","checkDirectiveParam","split","changeDomainTabItem","deleteDomain2User","newDomainPath","changeDeviceDomain","addDomainUser","registerDevice","activateDevice","unregisterDevice","deactivateDevice","user","queryEnterpriseUser","hide","undefined","queryDomainByUser","getAllGateways","changeManagedStatus","activateGateway","deactivateGateway","qrCode","$textAndPic","qrcode","text","window","open","initEvent","on","e","aname","target","targetText","$apply","CMDBINFOS4MAPINIT","relatedTarget","$on","log","unregister","gotoPath","newAry","showChildren","init","getRootModel","queryDomainTree","domainListDic","domainListTree","directiveBack","saveThresholds","modelData","thresholds","hasThreshold","isAuthenticated","evt","d"],"mappings":"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","file":"app-oc/js/controllers/view-cmdb-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.controller('ViewCmdbCtrl', ['$scope', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'SwSocket', 'Info', 'viewFlexService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', function ($scope, $routeParams, $timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, SwSocket, Info, viewFlexService, unitService, growl, userDomainService, userEnterpriseService) {\n    console.info(\"切换到资源管理\");\n    $scope.routePaths = [];\n    $scope.routePathNodes = {};\n    $scope.selectedDitem = null;\n    $scope.selectedDomainitem = null;\n    $scope.selectedGateitem = null;\n    $scope.selectedDirective = null;\n    $scope.visible = false;\n    $scope.editVisible = false;\n    $scope.treeAry = [];\n    $scope.domainsAry = [];\n    $scope.gatewaysAry = [];\n    $scope.activeMainTab = \"设备类型视图\";\n    $scope.activeTab = '属性';\n    $scope.previousMainTab;\n    $scope.activeListTab = \"tab1\";\n    $scope.queryDomin = \"\";\n    var uuid = Math.uuid();\n    var columns = [];\n    var columsData = [];\n    var activeTab;\n    var previousTab;\n    var previousDomainID;\n    var previousDomainPath;\n    var addUserStatus = false;\n    var info = Info.get(\"localdb/icon.json\", function (info) {\n      $scope.iconList = info.qualityIcon;\n      $scope.kpiIconList = info.kpiIcon;\n    });\n\n    var callback = function callback(evendata) {\n      console.log(\"callback:\", evendata);\n      var addDatas = [];\n      $scope.$broadcast('OptionStatusChange', {\n        \"data\": addDatas\n      });\n    };\n\n    var getViewId = function getViewId(pName) {\n      for (var i in viewFlexService.viewList) {\n        var v = viewFlexService.viewList[i];\n\n        if (v.viewType == 'designView' && pName.search(v.viewTitle) > -1) {\n          return v.viewId;\n        }\n      }\n\n      return 0;\n    };\n\n    var getColumns = function getColumns(ary) {\n      for (var i in ary) {\n        var col = ary[i];\n\n        if (col.visible == true || col.visible == \"true\") {\n          var colobj = new Object();\n          colobj.data = col.dataField;\n          colobj.title = col.headerText;\n          columns.push(colobj);\n        }\n      }\n    };\n\n    var formatDate = function formatDate(str) {\n      if (str) {\n        str = newDateJson(str).Format(GetDateCategoryStrByLabel());\n      }\n\n      return str;\n    };\n\n    var getIcon = function getIcon(random) {\n      var icon;\n\n      switch (true) {\n        case random > 0.9:\n          icon = \"fa fa-hospital-o\";\n          break;\n\n        case random > 0.8:\n          icon = \"fa fa-truck\";\n          break;\n\n        case random > 0.7:\n          icon = \"fa fa-tv\";\n          break;\n\n        case random > 0.6:\n          icon = \"fa fa-users\";\n          break;\n\n        case random > 0.5:\n          icon = \"fa fa-bolt\";\n          break;\n\n        case random > 0.4:\n          icon = \"fa fa-bank\";\n          break;\n\n        default:\n          icon = \"fa fa-plus\";\n      }\n\n      return icon;\n    };\n\n    var getDomainUserCount = function getDomainUserCount(domain, callback) {\n      userDomainService.getAssociateDomain2User(domain.domainPath, function (returnObj) {\n        var domainUsers = returnObj.data;\n        domain.count = domainUsers.length;\n      });\n    };\n\n    var getDomainDeviceCount = function getDomainDeviceCount(domain, callback) {\n      resourceUIService.getResourcesByDomainPath(domain.domainPath, function (returnObj) {\n        var domainDevices = returnObj.data;\n        domain.count = domainDevices.length;\n      });\n    };\n\n    var getResourceCount = function getResourceCount(model, callback) {\n      resourceUIService.getResourceByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          var resources = returnObj.data;\n          model.count = resources.length;\n          model.resources = resources;\n          model.isLoaded = model.isLoaded + 1;\n\n          if (callback) {\n            callback();\n          }\n        }\n\n        ;\n      });\n    };\n\n    var initDateRanger = function initDateRanger() {\n      return;\n      $('input[name=\"daterange\"]').daterangepicker({\n        timePicker: true,\n        timePicker24Hour: true,\n        autoUpdateInput: true,\n        opens: \"left\",\n        locale: {\n          format: 'YYYY/MM/DD HH:mm:ss'\n        }\n      });\n    };\n    /**\n     * 获取资源域视图,此资源域下关联的域用户\n     */\n\n\n    var getUserFromThisDomain = function getUserFromThisDomain() {\n      //获取域用户\n      var domainPath = $scope.selectedDomainitem.domainPath; //查看资源域关联的 域用户\n\n      if (domainPath != \"\") {\n        userDomainService.getAssociateDomain2User(domainPath, function (resultObj) {\n          if (resultObj.code == 0) {\n            for (var i in resultObj.data) {\n              var obj = resultObj.data[i];\n              obj.isEdit = 0;\n            }\n\n            $scope.domainUserData.data = resultObj.data;\n            $scope.$broadcast(Event.DOMAININFOSINIT, $scope.domainUserData);\n          }\n        });\n      } else {\n        $scope.domainUserData.data = [];\n        $scope.$broadcast(Event.DOMAININFOSINIT, $scope.domainUserData);\n      }\n    };\n\n    $scope.domainUsers = [];\n\n    var getDomainUsers = function getDomainUsers() {\n      $scope.domainUsers = [];\n      getUserFromThisDomain();\n    };\n\n    $scope.gatewayDevices = [];\n    $scope.gatewayactiveDevices = [];\n\n    var getDevices = function getDevices(gateway) {\n      $scope.gatewayDevices = [];\n      $scope.gatewayactiveDevices = [];\n      gateway.devices = gateway.devices ? gateway.devices : [];\n\n      for (var i in gateway.devices) {\n        if (gateway.devices[i].managedStatus != \"active\") {\n          $scope.gatewayDevices.push(gateway.devices[i]);\n        }\n      }\n\n      $scope.$broadcast(Event.CMDBINFOSINIT + \"GATE\", {\n        data: $scope.gatewayDevices\n      });\n      resourceUIService.getResourcesByGatewayId(gateway.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            if (returnObj.data[i].managedStatus == \"active\") $scope.gatewayactiveDevices.push(returnObj.data[i]);\n          }\n\n          $scope.$broadcast(Event.CMDBINFOSINIT + \"GATEACTIVE\", {\n            data: $scope.gatewayactiveDevices\n          });\n        }\n\n        ;\n      });\n    };\n\n    var getResourceAttrs = function getResourceAttrs(model, callback) {\n      resourceUIService.getAttrsByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.attrs = returnObj.data;\n          model.isLoaded = model.isLoaded + 1;\n\n          if (callback) {\n            callback();\n          }\n        }\n\n        ;\n      });\n    };\n\n    var getResourceKpis = function getResourceKpis(model) {\n      resourceUIService.getKpisByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.kpis = returnObj.data;\n        }\n\n        ;\n      });\n    };\n\n    var getResourceAlerts = function getResourceAlerts(model) {\n      resourceUIService.getAlertsByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.alerts = returnObj.data;\n          model[\"thresholds\"] = [];\n\n          for (var i = 0; i < model.alerts.length; i++) {\n            (function (obj, objId, alertId) {\n              resourceUIService.getThresholds(objId, alertId, function (response) {\n                if (response.code == 0) {\n                  if (response.data.length > 0) {\n                    obj[\"thresholds\"].push({\n                      \"alertCode\": alertId,\n                      \"thresholdsData\": response.data\n                    });\n                  }\n                }\n\n                ;\n              });\n            })(model, model.id, model.alerts[i].id);\n          }\n        }\n\n        ;\n      });\n    };\n\n    var getResourceDirectives = function getResourceDirectives(model) {\n      model.directives = [];\n      resourceUIService.getDirectivesByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.directives = returnObj.data;\n        }\n\n        ;\n      });\n    };\n\n    var getResourceState = function getResourceState(ids) {\n      kpiDataService.getRealTimeKpiData(ids, [999999], function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            for (var j in resourceUIService.selectedInstances) {\n              if (returnObj.data[i].nodeId == resourceUIService.selectedInstances[j].id) {\n                resourceUIService.selectedInstances[j].health = 100 - returnObj.data[i].value * 20;\n              }\n            }\n\n            $scope.$broadcast(Event.CMDBINFOSINIT, {\n              \"option\": [resourceUIService.selectedInstances, resourceUIService.selectedAttrs]\n            });\n          }\n        }\n      });\n    };\n\n    var initModelAtts = function initModelAtts(obj, idx) {\n      obj.count = 0;\n      var random = Math.random(); // obj.icon = getIcon(random);\n\n      obj.alertlv = random > 0.75 ? \"bg-red\" : random > 0.5 ? \"bg-orange\" : random > 0.25 ? \"bg-yellow\" : \"bg-green\";\n      obj.isLoaded = 0;\n      obj.type = 0;\n\n      if (idx == 0) {\n        getResourceCount(obj, function () {\n          if ($scope.selectedDitem.isLoaded >= 2) getinstanceList($scope.selectedDitem);\n        });\n        getResourceAttrs(obj, function () {\n          if ($scope.selectedDitem.isLoaded >= 2) getinstanceList($scope.selectedDitem);\n        });\n      } else {\n        getResourceCount(obj);\n        getResourceAttrs(obj);\n      }\n\n      getResourceKpis(obj);\n      getResourceAlerts(obj);\n      getResourceDirectives(obj);\n      return obj;\n    };\n\n    var initDomainData = function initDomainData() {\n      var obj = {};\n      obj.id = 0;\n      obj.domainID = 0;\n      obj.domainPath = \"\";\n      obj.domainName = \"\";\n      obj.description = \"\";\n      obj.count = 0;\n      var random = Math.random();\n      obj.icon = getIcon(random);\n      obj.alertlv = random > 0.75 ? \"bg-red\" : random > 0.5 ? \"bg-orange\" : random > 0.25 ? \"bg-yellow\" : \"bg-green\";\n      obj.isLoaded = 0;\n      obj.type = 1;\n      obj.label = obj.name;\n      return obj;\n    };\n\n    var initDomainAtts = function initDomainAtts(obj, idx) {\n      obj.id = obj.id ? obj.id : 0;\n      obj.domainID = obj.domainID ? obj.domainID : 0;\n      obj.domainPath = obj.domainPath ? obj.domainPath : \"\";\n      obj.domainName = obj.domainName ? obj.domainName : \"\";\n      obj.description = obj.description ? obj.description : \"\";\n      obj.count = 0;\n      var random = Math.random();\n      obj.icon = getIcon(random);\n      obj.alertlv = random > 0.75 ? \"bg-red\" : random > 0.5 ? \"bg-orange\" : random > 0.25 ? \"bg-yellow\" : \"bg-green\";\n      obj.isLoaded = 0;\n      obj.type = 1;\n      obj.label = obj.name;\n\n      if (idx == 0) {\n        getDomainDeviceCount(obj, function () {//待增加内容：获取设备列表的列表\n        });\n      } else {\n        getDomainDeviceCount(obj, function () {//待增加内容：获取设备列表的列表\n        });\n      }\n\n      return obj;\n    };\n\n    var initGatewayAtts = function initGatewayAtts(obj, idx) {\n      obj.id = obj.id ? obj.id : 0;\n      obj.name = obj.name ? obj.name : \"新增网关\";\n      obj.externalGwId = obj.externalGwId ? obj.externalGwId : \"\";\n      obj.accessName = obj.accessName ? obj.accessName : \"\";\n      obj.accessPassword = obj.accessPassword ? obj.accessPassword : \"\";\n      obj.protocolType = obj.protocolType ? obj.protocolType : \"\";\n      obj.count = obj.devices ? obj.devices.length : 0;\n      var random = Math.random();\n      obj.icon = getIcon(random);\n      obj.alertlv = obj.operationStatus == 4 ? \"bg-red\" : obj.operationStatus == 3 ? \"bg-orange\" : obj.operationStatus == 2 ? \"bg-yellow\" : \"bg-green\";\n      obj.isLoaded = 0;\n      obj.label = obj.name;\n      obj.onlineStatus = obj.onlineStatus ? obj.onlineStatus : 'online';\n      obj.managedStatus = obj.managedStatus ? obj.managedStatus : 'deactive'; //\t\t\t\tobj.onlineStatuslab = obj.onlineStatus== 'offline'?'离线':'在线';\n      //\t\t\t\tobj.onlineStatuslv = obj.onlineStatus== 'offline'?'bg-aqua':'bg-green';\n      //\t\t\t\tobj.managedStatuslab = obj.managedStatus==\"deactive\"?'未激活':'激活';\n      //\t\t\t\tobj.managedStatuslv = obj.managedStatus==\"deactive\"?'bg-aqua':'bg-green';\n\n      obj.activeTime = obj.activeTime ? newDateJson(obj.activeTime).Format(GetDateCategoryStrByLabel('')) : \"\";\n      obj.expireTime = obj.expireTime ? newDateJson(obj.expireTime).Format(GetDateCategoryStrByLabel('')) : \"\";\n      obj.validTime = \"\";\n\n      if (obj.activeTime && obj.expireTime) {\n        obj.validTime = \"从\" + obj.activeTime + \"到\" + obj.expireTime;\n      }\n\n      return obj;\n    };\n\n    var urmpTree = function urmpTree(ciName) {\n      resourceUIService.getModels(function (returnObj) {\n        resourceUIService.treeAry = [];\n\n        if (returnObj.code == 0) {\n          var tree = returnObj.data;\n\n          for (var i in tree) {\n            var obj = tree[i];\n            if (!$scope.routePathNodes[obj.parentModelId]) $scope.routePathNodes[obj.parentModelId] = [];\n            $scope.routePathNodes[obj.parentModelId].push(obj);\n            if (!$scope.routePathNodes[obj.id]) $scope.routePathNodes[obj.id] = [];\n            resourceUIService.treeAry.push(jQuery.extend(true, {}, obj));\n            initModelAtts(obj);\n          }\n\n          var addNodes = function addNodes(parentNode) {\n            for (var modeid in $scope.routePathNodes) {\n              if (modeid == parentNode.id) {\n                parentNode.nodes = $scope.routePathNodes[modeid];\n\n                for (var i in parentNode.nodes) {\n                  addNodes(parentNode.nodes[i]);\n                }\n              }\n            }\n          };\n\n          var initRoutePath = function initRoutePath(node, arr) {\n            for (var i in node.nodes) {\n              if ($routeParams.modelId == node.nodes[i].id) {\n                arr.push(node);\n                break;\n              } else {\n                initRoutePath(node.nodes[i], arr);\n              }\n            }\n          };\n\n          addNodes(resourceUIService.rootModel);\n\n          if ($routeParams.modelId) {\n            if ($scope.routePathNodes[$routeParams.modelId]) {\n              var arr = [];\n              initRoutePath(resourceUIService.rootModel, arr);\n              arr.push(resourceUIService.rootModel);\n              $scope.routePaths = arr.reverse();\n              var parentNode = arr[arr.length - 1];\n\n              for (var i in parentNode.nodes) {\n                if ($routeParams.modelId == parentNode.nodes[i].id) {\n                  $scope.click(parentNode.nodes[i]);\n                  initModelAtts(parentNode.nodes[i], 0);\n                  $scope.treeAry = parentNode.nodes;\n                  break;\n                }\n              }\n            } else {\n              $scope.click(resourceUIService.rootModel.nodes[0]);\n              initModelAtts(resourceUIService.rootModel.nodes[0], 0);\n              $scope.treeAry = resourceUIService.rootModel.nodes;\n            }\n          } else {\n            $scope.click(resourceUIService.rootModel.nodes[0]);\n            initModelAtts(resourceUIService.rootModel.nodes[0], 0);\n            $scope.treeAry = resourceUIService.rootModel.nodes;\n          }\n        }\n      });\n    };\n\n    var getinstanceList = function getinstanceList(item) {\n      var newObjAry = [];\n      var nodeIds = [];\n      var viewId = getViewId(item.label);\n\n      for (var i in item.resources) {\n        var obj = item.resources[i];\n        var newObj = {};\n        newObj.option = \"\";\n        newObj.id = obj.id;\n        newObj.label = obj.label;\n        newObj.viewId = viewId;\n        newObj.createTime = newDateJson(obj.createTime).Format(GetDateCategoryStrByLabel());\n        newObj.state = 1;\n        newObj.onlineStatus = obj.onlineStatus ? obj.onlineStatus : 'online';\n        newObj.alertlv = Math.floor(Math.random() * 4);\n        newObj.externalDevId = obj.externalDevId ? obj.externalDevId : \"\";\n        newObj.values = obj.values;\n        newObj.data = obj;\n        newObj.health = 100;\n        newObj.isEdit = 0;\n        newObj.selected = false;\n\n        if (newObj.id == $routeParams.nodeId) {\n          newObj.selected = true;\n        }\n\n        newObjAry.push(newObj);\n        nodeIds.push(obj.id);\n      }\n\n      getResourceState(nodeIds);\n      resourceUIService.selectedInstances = newObjAry;\n      resourceUIService.selectedAttrs = item.attrs;\n      $scope.$broadcast(Event.CMDBINFOSINIT, {\n        \"option\": [resourceUIService.selectedInstances, resourceUIService.selectedAttrs]\n      });\n    };\n\n    var reLoader = function reLoader() {\n      $scope.selectedDitem.isLoaded = 1;\n      getResourceCount($scope.selectedDitem, function () {\n        getinstanceList($scope.selectedDitem);\n      });\n    };\n    /**\n     * 在设备类型模式下切换属性/指标/告警/指令\n     */\n\n\n    var changeDItem = function changeDItem() {\n      if ($scope.activeTab == null || $scope.activeTab == \"属性\") {} else if ($scope.activeTab == \"指标\") {\n        $scope.$broadcast(Event.KPIEDITINIT, {\n          \"data\": $scope.selectedDitem.kpis\n        });\n      } else if ($scope.activeTab == \"告警\") {\n        $scope.$broadcast(Event.ALERTEDITINIT, {\n          \"data\": $scope.selectedDitem\n        });\n      } else if ($scope.activeTab == \"指令\") {\n        $scope.$broadcast(Event.DIRECTIVESINIT, {\n          \"data\": $scope.selectedDitem.directives\n        });\n      }\n    }; //资源域视图 域用户\n\n\n    $scope.domainUserData = {\n      columns: [{\n        title: \"姓名\",\n        data: \"userName\"\n      }, {\n        title: \"Email\",\n        data: \"emailAddress\"\n      }, {\n        title: \"移动电话\",\n        data: \"mobilePhone\"\n      }, {\n        title: \"办公电话\",\n        data: \"officePhone\"\n      }, {\n        title: \"操作\",\n        orderable: false,\n        data: \"option\"\n      }],\n      data: [{}],\n      columnDefs: [{\n        \"targets\": 0,\n        \"data\": \"userName\",\n        \"render\": function render(data, type, full) {\n          //返回自定义名字\n          if (full.isEdit == 2 && type == \"display\") {\n            var str = '<select id=\"userDomainName\" name=\"userName\" class=\"combobox form-control\">' + '<option value=\"\">请选择用户</option>'; //赋值\n            //判断：\n\n            for (var i in $scope.userGridData.data) {\n              //\tfor (var j in $scope.domainUserData.data) {\n              //\t\tif ($scope.userGridData.data[i].userName != $scope.domainUserData.data[j].userName){\n              //\t\t\tstr += '<option value=\"' + $scope.userGridData.data[i].userID + '\">' + $scope.userGridData.data[i].userName + '</option>';\n              //\t\t}\n              //\t}\n              //if ($scope.domainUserData.data[i].userName == data) {\n              str += '<option value=\"' + $scope.userGridData.data[i].userID + '\">' + $scope.userGridData.data[i].userName + '</option>'; //} else {\n              //\tstr += '<option value=\"' + $scope.userGridData.data[i].domainID + '\">' + $scope.userGridData.data[i].name + '</option>';\n              //}\n            }\n\n            str += '</select>';\n            $scope.domainUserData.data = [];\n            return str;\n          } else {\n            return data;\n          }\n        }\n      }, {\n        \"targets\": 4,\n        \"data\": \"option\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          if (full.isEdit == 2) {\n            var str = \"<div class='input-group'>\";\n            str += \"<a id='save-btn' class='btn btn-social-icon'><i class='fa fa-check'></i></a>\";\n            str += \"<a id='del-btn' class='btn btn-social-icon'><i class='fa fa-close'></i></a>\";\n            str += \"</div>\";\n            return str;\n          } else {\n            var str = \"<div class='input-group'>\";\n            str += \"<a id='removeDomain-btn' class='btn btn-social-icon' data-toggle='tooltip' title='删除'><i class='fa fa-minus-square-o'></i></a>\";\n            str += \"</div>\";\n            return str;\n          }\n        }\n      }] //end\n      //资源域视图 设备列表\n\n    };\n    $scope.domainDeviceData = {\n      columns: [{\n        data: \"id\",\n        title: \"编码\"\n      }, {\n        data: \"label\",\n        title: \"名称\"\n      }, {\n        data: \"createTime\",\n        title: \"上线时间\"\n      }, {\n        data: \"onlineStatus\",\n        title: \"在线状态\"\n      }, {\n        data: \"health\",\n        title: \"健康度\",\n        visible: false\n      }, {\n        data: \"domainPath\",\n        title: \"资源域\"\n      }, {\n        data: \"option\",\n        title: \"操作\",\n        orderable: false\n      }],\n      columnDefs: [{\n        \"targets\": 3,\n        \"data\": \"onlineStatus\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          return \"<span class='label \" + (data == 'online' ? \"label-primary\" : \"label-warning\") + \"'>\" + (data == 'online' ? \"在线\" : \"离线\") + \"</span>\";\n        }\n      }, {\n        \"targets\": 4,\n        \"data\": \"health\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          //自定义随机的健康度---等待接口的实现连接\n          data = Math.random() * 100;\n          return \"<div class='progress progress-xs progress-striped active'><div class='progress-bar \" + (data > 90 ? \"progress-bar-success\" : data > 60 ? \"progress-bar-yellow\" : \"progress-bar-red\") + \"' style='width:\" + data + \"%'></div></div>\";\n        }\n      }, {\n        \"targets\": 5,\n        \"data\": \"domainPath\",\n        \"render\": function render(data, type, full) {\n          //return \"<input name='domainPath' domain-Picker class='form-control' type='text'>\";\n          var str = \"\";\n\n          if (data != null && data != \"\") {\n            for (var i in $scope.domainsAry) {\n              if ($scope.domainsAry[i].domainPath == data) {\n                str += \"<input name='domainPath' domain-Picker class='form-control' type='text' value='\" + $scope.domainsAry[i].label + \"' domainPath='\" + $scope.domainsAry[i].domainPath + \"' data-original-title title>\"; //str += \"<input name='domainPath'  domain-Picker class='form-control' type='text' domainPath='' value='请选择...'>\"\n              }\n            }\n          }\n\n          if (!str) {\n            str += \"<input name='domainPath'  domain-Picker class='form-control' type='text' domainPath='' value='请选择...'>\";\n          }\n\n          return str;\n        }\n      }, {\n        \"targets\": 6,\n        \"data\": \"option\",\n        \"render\": function render(data, type, full) {\n          return '<div class=\"input-group\">' + '<a id=\"save-btn\" class=\"btn btn-social-icon\" data-toggle=\"tooltip\" title=\"保存\"><i class=\"fa fa-check hidden-lg hidden-md hidden-sm\"></i></a>' + '</div>';\n        }\n      }]\n    };\n    /**\n     * 获取资源域视图 设备列表\n     */\n\n    var getDomainDeviceList = function getDomainDeviceList() {\n      var domainPath = $scope.selectedDomainitem.domainPath;\n\n      if (domainPath != \"\") {\n        resourceUIService.getResourcesByDomainPath(domainPath, function (resultObj) {\n          if (resultObj.code == 0) {\n            for (var i in resultObj.data) {\n              var obj = resultObj.data[i];\n              obj.isEdit = 0;\n              obj.onlineStatus = obj.onlineStatus ? obj.onlineStatus : 'online';\n            }\n\n            $scope.domainDeviceData.data = resultObj.data;\n            $scope.$broadcast(Event.DOMAINDEVICESINIT, $scope.domainDeviceData);\n          }\n        });\n      } else {\n        $scope.domainDeviceData.data = [];\n        $scope.$broadcast(Event.DOMAINDEVICESINIT, $scope.domainDeviceData);\n      }\n    };\n\n    $scope.delDomainSubItem = function (item) {\n      $scope.editVisible = false;\n      growl.success(\"取消添加资源域成功\", {});\n      domainTree();\n    };\n\n    $scope.click = function (item) {\n      $scope.editVisible = false;\n      $scope.selectedDirective = null;\n\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        if ($scope.selectedDitem == item) return;\n\n        for (var i in $scope.routePaths) {\n          if ($scope.selectedDitem && $scope.routePaths[i].id == $scope.selectedDitem.id) {\n            $scope.routePaths.splice(i, 1);\n          }\n        }\n\n        $scope.selectedDitem = item;\n        $scope.routePaths.push(item);\n        $scope.visible = true;\n\n        if (item.isLoaded >= 2) {\n          getinstanceList(item);\n          changeDItem();\n        }\n\n        $scope.activeListTab = \"tab1\";\n      } else if ($scope.activeMainTab == \"资源域视图\") {\n        $scope.selectedDomainitem = item; //判断是否是已经存在的域还是新添加的域\n\n        if ($scope.selectedDomainitem.domainID != 0) {\n          $scope.visible = true;\n\n          if ($scope.activeListTab == \"tab3\") {\n            getDomainDeviceList();\n          } else if ($scope.activeListTab == \"tab4\") {\n            //获取域用户\n            getUserFromThisDomain();\n          }\n        } else {\n          return;\n        } //if (item.isLoaded >= 2) {\n        //\t$scope.activeListTab = \"tab3\";\n        //\tchangeTabItem();\n        //}\n\n      } else if ($scope.activeMainTab == \"网关视图\") {\n        $scope.selectedGateitem = item; //\t\t\t\t\t$scope.selectedGateitem.isVirtual = $scope.selectedGateitem.isVirtual ? 'true' : 'false';\n\n        getDevices($scope.selectedGateitem);\n      }\n    };\n\n    $scope.eidtModel = function () {\n      initDateRanger();\n      $scope.editVisible = !$scope.editVisible;\n    };\n\n    $scope.addModel = function () {\n      //判断点击的是设备类型的添加按钮、资源域试图的添加按钮、网关试图的添加按钮\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        if ($scope.selectedDitem) {\n          var doSave = function doSave(newModelName) {\n            for (var i in $scope.treeAry) {\n              if (newModelName == $scope.treeAry[i].label) {\n                growl.warning(\"当前有重复设备类型名称，请修改\", {});\n                return;\n              }\n            }\n\n            var newModel = {};\n            newModel.label = newModelName;\n            newModel.id = 0;\n            newModel.count = 0;\n            newModel.icon = getIcon(0);\n            newModel.isLoaded = 0;\n            newModel.resources = [];\n            newModel.parentModelId = $scope.selectedDitem.id;\n            resourceUIService.addModel(newModel, function (returnObj) {\n              if (returnObj.code == 0) {\n                $scope.selectedDitem = initModelAtts(returnObj.data, 0);\n                $scope.treeAry.push($scope.selectedDitem);\n                $scope.click($scope.selectedDitem);\n                $scope.editVisible = true;\n              }\n            });\n          };\n\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE, //<input type=\"text\" value=\"新建' + $scope.selectedDitem.label + '\" class=\"form-control\">\n            message: '设备类型名称: ' + '<input type=\"text\" onkeydown=\"validatorHTML(event)\" onpaste=\"return false\" value=\"新建' + $scope.selectedDitem.label + '\" class=\"form-control\">',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                var fruit = dialogRef.getModalBody().find('input').val();\n                doSave(fruit);\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        }\n      } else if ($scope.activeMainTab == \"资源域视图\") {\n        for (var i in $scope.domainsAry) {\n          var obj = $scope.domainsAry[i];\n\n          if (obj.domainID == 0) {\n            growl.warning(\"当前有未保存资源域\", {});\n            return;\n          }\n        } //传递当前所选择的domainID,domainPath\n        //保存当前选择资源域的domainID，domainPath\n\n\n        previousDomainID = $scope.selectedDomainitem.domainID;\n        previousDomainPath = $scope.selectedDomainitem.domainPath;\n        $scope.selectedDomainitem = initDomainData();\n        $scope.domainsAry.push($scope.selectedDomainitem);\n        $scope.editVisible = true; //域名输入框获取到光标\n\n        $('#domain-form input').eq(0).attr('autofocus', 'autofocus'); //添加操作，把域下面的设备列表和域用户清空\n\n        getDomainDeviceList();\n        getDomainUsers();\n      } else if ($scope.activeMainTab == \"网关视图\") {\n        for (var i in $scope.gatewaysAry) {\n          var obj = $scope.gatewaysAry[i];\n\n          if (obj.id == 0) {\n            growl.warning(\"当前有未保存网关\", {});\n            return;\n          }\n        }\n\n        $scope.selectedGateitem = initGatewayAtts({}, i);\n        $scope.gatewaysAry.push($scope.selectedGateitem);\n        $scope.editVisible = true; //新增网关，把该忘关下面的未激活和激活设备列表清空\n\n        $scope.gatewayDevices = [];\n        $scope.gatewayactiveDevices = [];\n        $scope.$broadcast(Event.CMDBINFOSINIT + \"GATE\", {\n          data: $scope.gatewayDevices\n        });\n        $scope.$broadcast(Event.CMDBINFOSINIT + \"GATEACTIVE\", {\n          data: $scope.gatewayactiveDevices\n        });\n      }\n    };\n\n    $scope.delModel = function () {\n      //增加判断哪一个tab页（设备类型视图，资源域视图，网关视图）\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        //先判断设备类型是否有子设备类型，在执行是否删除操作\n        //有子节点的设备类型不允许删除\n        for (var i in $scope.treeAry) {\n          if ($scope.selectedDitem.id == $scope.treeAry[i].parentModelId) {\n            growl.warning($scope.selectedDitem.label + \" 设备类型有子域，不能删除\", {});\n            return;\n          }\n        }\n\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认删除 ' + $scope.selectedDitem.label + ' 设备类型吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              //判断：若该设备类型关联1个或多个设备，不能删除\n              if ($scope.selectedDitem.count != 0) {\n                growl.warning($scope.selectedDitem.label + \" 设备类型关联着设备，不能删除\", {});\n                dialogRef.close();\n                return;\n              } else {\n                if ($scope.selectedDitem) {\n                  resourceUIService.deleteModel($scope.selectedDitem.id, function (returnObj) {\n                    if (returnObj.code == 0) {\n                      for (var i in $scope.treeAry) {\n                        if ($scope.treeAry[i].id == $scope.selectedDitem.id) {\n                          $scope.treeAry.splice(i, 1);\n                        }\n                      }\n\n                      growl.success(\"删除 \" + $scope.selectedDitem.label + \" 设备类型成功\");\n                      $scope.editVisible = false;\n                      $scope.selectedDitem = initModelAtts($scope.treeAry[$scope.treeAry.length - 1], 0);\n                    }\n                  });\n                }\n              }\n\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if ($scope.activeMainTab == \"资源域视图\") {\n        //判断删除的资源域是否是先添加的还未保存，还是已经存在的资源域。\n        if ($scope.selectedDomainitem.domainID != 0) {\n          var domain = {\n            \"domainID\": $scope.selectedDomainitem.domainID,\n            \"domainPath\": $scope.selectedDomainitem.domainPath\n          }; //接口判断是否可以删除该资源域\n\n          userDomainService.queryDeleteDomain(domain, function (resultObj) {\n            // code  data \"true\"\n            if (resultObj.data != \"true\") {\n              growl.warning(resultObj.data, {});\n              return;\n            } else {\n              BootstrapDialog.show({\n                title: '提示',\n                closable: false,\n                //size:BootstrapDialog.SIZE_WIDE,\n                message: '确认删除 ' + $scope.selectedDomainitem.name + ' 资源域吗？',\n                buttons: [{\n                  label: '确定',\n                  cssClass: 'btn-success',\n                  action: function action(dialogRef) {\n                    if ($scope.selectedDomainitem) {\n                      userDomainService.deleteDomain($scope.selectedDomainitem.domainID, $scope.selectedDomainitem.domainPath, function (returnObj) {\n                        if (returnObj.code == 0) {\n                          $scope.editVisible = false;\n\n                          for (var i in $scope.domainsAry) {\n                            if ($scope.selectedDomainitem.domainID == $scope.domainsAry[i].domainID) {\n                              $scope.domainsAry.splice(i, 1);\n\n                              if (i > 1) {\n                                $scope.selectedDomainitem = $scope.domainsAry[i - 1];\n                              } else {\n                                $scope.selectedDomainitem = $scope.domainsAry[0];\n                              }\n                            }\n                          } //domainTree();\n\n\n                          growl.success(\"删除资源域成功\", {});\n                        }\n                      });\n                    }\n\n                    dialogRef.close();\n                  }\n                }, {\n                  label: '取消',\n                  action: function action(dialogRef) {\n                    dialogRef.close();\n                  }\n                }]\n              });\n            }\n          });\n        } else {\n          domainTree();\n          $scope.editVisible = false;\n          growl.success(\"资源域删除成功\", {});\n          return;\n        }\n      } else if ($scope.activeMainTab == \"网关视图\") {\n        if ($scope.selectedGateitem.managedStatus == 'active') {\n          growl.warning(\"激活状态的网关不能删除，请先停用该网关。\", {});\n          return;\n        } //删除网关\n\n\n        BootstrapDialog.show({\n          title: '删除网关',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认删除' + $scope.selectedGateitem.name + '网关以及该网关下的设备吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              if ($scope.selectedGateitem) {\n                resourceUIService.deleteGateway($scope.selectedGateitem.id, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    $scope.editVisible = false;\n                    $scope.selectedGateitem = null;\n                    gateWayTree();\n                    growl.success(\"删除网关成功\", {});\n                  }\n                });\n              }\n\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n\n    $scope.updateModel = function () {\n      if ($scope.selectedDitem) {\n        for (var i in resourceUIService.treeAry) {\n          if (resourceUIService.treeAry[i].id == $scope.selectedDitem.id && resourceUIService.treeAry[i].label == $scope.selectedDitem.label && resourceUIService.treeAry[i].icon == $scope.selectedDitem.icon) {\n            return;\n          }\n        }\n\n        var obj = {};\n        obj.id = $scope.selectedDitem.id;\n        obj.label = $scope.selectedDitem.label;\n        obj.icon = $scope.selectedDitem.icon;\n        resourceUIService.updateModel(obj, function (returnObj) {\n          if (returnObj.code == 0) {\n            for (var i in $scope.treeAry) {\n              if ($scope.treeAry[i].id == $scope.selectedDitem.id) {\n                $scope.treeAry[i].label = returnObj.data.label;\n                resourceUIService.treeAry[i].label = returnObj.data.label;\n                $scope.selectedDitem.label = returnObj.data.label;\n              }\n            }\n\n            growl.success(\"修改设备类型视图成功\", {});\n          }\n        });\n      }\n    };\n\n    $scope.addModelSubItem = function () {\n      if ($scope.activeTab == null || $scope.activeTab == \"属性\") {\n        for (var i = $scope.selectedDitem.attrs.length - 1; i > -1; i--) {\n          if ($scope.selectedDitem.attrs[i].isNew) {\n            if (!$scope.selectedDitem.attrs[i].isDel) {\n              growl.warning(\"当前有未保存属性\", {});\n              return;\n            } else {\n              $scope.selectedDitem.attrs.splice(i, 1);\n            }\n          }\n        }\n\n        var newAttr = {\n          canEdit: true,\n          label: \"\",\n          name: \"\",\n          dataType: 0,\n          id: Math.uuid(),\n          isNew: true\n        };\n        $scope.selectedDitem.attrs.push(newAttr);\n      } else if ($scope.activeTab == \"指标\") {\n        for (var i = $scope.selectedDitem.kpis.length - 1; i > -1; i--) {\n          if ($scope.selectedDitem.kpis[i].isNew) {\n            if (!$scope.selectedDitem.kpis[i].isDel) {\n              growl.warning(\"当前有未保存指标\", {});\n              return;\n            } else {\n              $scope.selectedDitem.kpis.splice(i, 1);\n            }\n          }\n        }\n\n        var newKpi = {\n          isEdit: 2,\n          canEdit: true,\n          label: \"\",\n          name: \"\",\n          unit: \"\",\n          range: \"\",\n          number: \"\",\n          granularity: \"\",\n          granularityUnit: \"\",\n          option: \"\",\n          id: Math.uuid(),\n          isNew: true\n        };\n        $scope.selectedDitem.kpis.push(newKpi);\n        $scope.$broadcast(Event.KPIEDITINIT, {\n          \"data\": $scope.selectedDitem.kpis\n        });\n      } else if ($scope.activeTab == \"告警\") {\n        for (var i = $scope.selectedDitem.alerts.length - 1; i > -1; i--) {\n          if ($scope.selectedDitem.alerts[i].isNew) {\n            if (!$scope.selectedDitem.alerts[i].isDel) {\n              growl.warning(\"当前有未保存告警\", {});\n              return;\n            } else {\n              $scope.selectedDitem.alerts.splice(i, 1);\n            }\n          }\n        }\n\n        var newAlert = {\n          isEdit: 2,\n          canEdit: true,\n          label: \"\",\n          name: \"\",\n          description: \"\",\n          option: \"\",\n          id: Math.uuid(),\n          isNew: true\n        };\n        $scope.selectedDitem.alerts.push(newAlert);\n        $scope.$broadcast(Event.ALERTEDITINIT, {\n          \"data\": $scope.selectedDitem\n        });\n      } else if ($scope.activeTab == \"指令\") {\n        for (var i = $scope.selectedDitem.directives.length - 1; i > -1; i--) {\n          if ($scope.selectedDitem.directives[i].isNew) {\n            if (!$scope.selectedDitem.directives[i].isDel) {\n              growl.warning(\"当前有未保存指令\", {});\n              return;\n            } else {\n              $scope.selectedDitem.directives.splice(i, 1);\n            }\n          }\n        }\n\n        var newDir = {\n          isEdit: 2,\n          canEdit: true,\n          label: \"\",\n          name: \"\",\n          description: \"\",\n          option: \"\",\n          expression: \"\",\n          protocolType: \"\",\n          id: 0,\n          isNew: true\n        };\n        $scope.selectedDitem.directives.push(newDir);\n        $scope.$broadcast(Event.DIRECTIVESINIT, {\n          \"data\": $scope.selectedDitem.directives\n        });\n      }\n    };\n\n    $scope.attrLabel = \"\"; //属性显示名称\n\n    $scope.iconClick = function (type, indexId, thisId) {\n      if ($(\"#label\" + indexId + \"\").val() != \"图标\") {\n        $scope.attrLabel = $(\"#label\" + indexId + \"\").val();\n      }\n\n      if (type == 'icon') {\n        $(\"#label\" + indexId + \"\").val(\"图标\");\n        $(\"#label\" + indexId + \"\").attr(\"disabled\", true);\n        $scope.selectedDitem.attrs[indexId].label = \"图标\";\n      } else {\n        if ($(\"#label\" + indexId + \"\").val() == \"图标\") {\n          $(\"#label\" + indexId + \"\").val($scope.attrLabel);\n        }\n\n        $(\"#label\" + indexId + \"\").attr(\"disabled\", false);\n      }\n    };\n\n    $scope.delModelSubItem = function (item) {\n      if ($scope.activeTab == null || $scope.activeTab == \"属性\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认删除 ' + $scope.selectedDitem.label + ' 设备的属性吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              for (var i in $scope.selectedDitem.attrs) {\n                var delItem = $scope.selectedDitem.attrs[i];\n\n                if (delItem.id == item.id) {\n                  $scope.selectedDitem.attrs.splice(i, 1);\n                  break;\n                }\n              }\n\n              growl.info(\"设备属性删除成功，请点击保存按钮以保存修改\", {});\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if ($scope.activeTab == \"指标\") {} else if ($scope.activeTab == \"告警\") {} else if ($scope.activeTab == \"指令\") {}\n    };\n\n    $scope.saveModelSubItem = function () {\n      var checkPass = true; //增加三种视图（设备类型，资源域，网关）的判断\n\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        if ($scope.activeTab == null || $scope.activeTab == \"属性\") {\n          for (var i in $scope.selectedDitem.attrs) {\n            var obj = $scope.selectedDitem.attrs[i];\n            if (obj.isNew) obj.id = 0;\n\n            if (!obj.label) {\n              growl.warning(\"请输入显示名称\", {});\n              return;\n            }\n\n            if (!obj.name) {\n              growl.warning(\"请输入属性名称\", {});\n              return;\n            }\n\n            if (!obj.dataType) {\n              growl.warning(\"请选择数据类型\", {});\n              return;\n            }\n          }\n\n          resourceUIService.saveAttrs($scope.selectedDitem.id, $scope.selectedDitem.attrs, function (returnObj) {\n            if (returnObj.code == 0) {\n              if (returnObj.data) $scope.selectedDitem.attrs = returnObj.data; //$scope.editVisible = false;\n\n              growl.success(\"保存属性成功\", {});\n            }\n          });\n        } else if ($scope.activeTab == \"指标\") {\n          for (var i = $scope.selectedDitem.kpis.length - 1; i > -1; i--) {\n            var obj = $scope.selectedDitem.kpis[i];\n\n            if (!obj.label || !obj.name) {\n              if (obj.isNew) {\n                $scope.selectedDitem.kpis.splice(i, 1);\n                continue;\n              } else {\n                obj.err = \".danger\";\n                checkPass = false;\n              }\n            }\n\n            if (obj.isNew) {\n              if (obj.isEdit > 0) {\n                growl.info(\"请√当前修改的数据\", {});\n                return;\n              } else {\n                obj.id = 0;\n              }\n            }\n\n            if (obj.isDel) $scope.selectedDitem.kpis.splice(i, 1);\n          }\n\n          if (checkPass) {\n            resourceUIService.saveKpis($scope.selectedDitem.id, $scope.selectedDitem.kpis, function (returnObj) {\n              if (returnObj.code == 0) {\n                if (returnObj.data) $scope.selectedDitem.kpis = returnObj.data;\n                growl.success(\"保存指标定义成功\", {}); //$scope.editVisible = false;\n\n                changeDItem();\n              }\n            });\n          } else {\n            growl.warning(\"检查数据完整性\", {});\n          }\n        } else if ($scope.activeTab == \"告警\") {\n          for (var i = $scope.selectedDitem.alerts.length - 1; i > -1; i--) {\n            var obj = $scope.selectedDitem.alerts[i];\n\n            if (!obj.label || !obj.name) {\n              if (obj.isNew) {\n                $scope.selectedDitem.alerts.splice(i, 1);\n                continue;\n              } else {\n                obj.err = \".danger\";\n                checkPass = false;\n              }\n            }\n\n            if (obj.isNew) {\n              if (obj.isEdit > 0) {\n                growl.warning(\"请√当前修改的数据\", {});\n                return;\n              } else {\n                obj.id = 0;\n              }\n            }\n\n            if (obj.isDel) $scope.selectedDitem.alerts.splice(i, 1);\n          }\n\n          if (checkPass) {\n            resourceUIService.saveAlerts($scope.selectedDitem.id, $scope.selectedDitem.alerts, function (returnObj) {\n              if (returnObj.code == 0) {\n                growl.success(\"保存告警定义成功\", {});\n                if (returnObj.data) $scope.selectedDitem.alerts = returnObj.data; //$scope.editVisible = false;\n\n                changeDItem();\n              }\n            });\n          } else {\n            growl.warning(\"检查数据完整性\", {});\n          }\n        } else if ($scope.activeTab == \"指令\") {\n          resourceUIService.saveDirectives($scope.selectedDitem.id, $scope.selectedDitem.directives, function (returnObj) {\n            if (returnObj.code == 0) {\n              for (var i in $scope.selectedDitem.directives) {\n                if ($scope.selectedDitem.directives[i].isNew) {\n                  $scope.selectedDitem.directives[i].isNew = false;\n                }\n              } //$scope.editVisible = false;\n\n\n              growl.success(\"保存指令成功\", {});\n            }\n          });\n        }\n      } else if ($scope.activeMainTab == \"资源域视图\") {\n        var name = $.trim($(\"#domain-form input\").eq(0).val());\n        var description = $.trim($(\"#domain-form input\").eq(1).val()); //域名name不能是非法字符\n\n        var reg = /^[\\u4E00-\\u9FA5\\w\\d]+$/;\n\n        if (!reg.test(name)) {\n          growl.warning(\"域名只能输入字母、数字、汉字、下划线\", {});\n          return;\n        } //新增或修改资源域\n\n\n        if (name != \"\" && $.trim(name) != \"\") {\n          //域名输入限制\n          if ($scope.selectedDomainitem.domainID == 0) {\n            var domainID = previousDomainID;\n            var domainPath = previousDomainPath;\n            userDomainService.addDomain(domainID, domainPath, name, description, function (returnObj) {\n              if (returnObj.code == 0) {\n                if (returnObj.data) {\n                  //$scope.domainsAry.push(initDomainAtts(returnObj.data));\n                  //domainTree();\n                  //$scope.selectedDomainitem = returnObj.data;\n                  $scope.selectedDomainitem.domainID = returnObj.data.domainID;\n                  $scope.selectedDomainitem.domainPath = returnObj.data.domainPath;\n                  $scope.selectedDomainitem.name = returnObj.data.name;\n                  $scope.selectedDomainitem.description = returnObj.data.description;\n                  $scope.selectedDomainitem.parentID = returnObj.data.parentID;\n                  $scope.domainsAry[$scope.domainsAry.length - 1] = $scope.selectedDomainitem;\n                }\n\n                $scope.editVisible = false;\n                growl.success(\"新增资源域成功\", {});\n              } else {\n                growl.warning(\"新增资源域失败\", {});\n                return;\n              }\n            });\n          } else {\n            userDomainService.modifyDomain($scope.selectedDomainitem.domainID, name, description, function (returnObj) {\n              if (returnObj.code == 0) {\n                if (returnObj.data) {\n                  //$scope.selectedDomainitem.attrs = returnObj.data;\n                  domainTree();\n                }\n\n                $scope.editVisible = false;\n                growl.success(\"修改资源域成功\", {});\n              } else {\n                growl.warning(\"修改资源域失败\", {});\n                return;\n              }\n            });\n          }\n        } else {\n          growl.warning(\"域名为必填项，并且不能为空格\", {});\n          return;\n        }\n      } else if ($scope.activeMainTab == \"网关视图\") {\n        //\t\t\t\t\t$scope.selectedGateitem.isVirtual = $scope.selectedGateitem.isVirtual == 'true' ? true : false;\n        if (!$scope.selectedGateitem.type) {\n          growl.warning(\"请选择网关类型\", {});\n          return;\n        }\n\n        if (!$scope.selectedGateitem.protocolType) {\n          growl.warning(\"请选择协议类型\", {});\n          return;\n        }\n\n        if (!$scope.selectedGateitem.cloudAdapter) {\n          growl.warning(\"请选择适配器类型\", {});\n          return;\n        }\n\n        if (!$scope.selectedGateitem.domain) {\n          growl.warning(\"请选网关所属域\", {});\n          return;\n        }\n\n        if (!$scope.selectedGateitem.externalGwId) {\n          growl.warning(\"请选输入网关标识\", {});\n          return;\n        }\n\n        if (!$scope.selectedGateitem.name) {\n          growl.warning(\"请选输入网关名称\", {});\n          return;\n        }\n\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认保存' + $scope.selectedGateitem.name + '吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              saveGateway();\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n\n        var saveGateway = function saveGateway() {\n          if ($scope.selectedGateitem.id == 0) {\n            resourceUIService.addGateway($scope.selectedGateitem, function (returnObj) {\n              if (returnObj.code == 0) {\n                if (returnObj.data) {\n                  for (var i in $scope.gatewaysAry) {\n                    var obj = $scope.gatewaysAry[i];\n\n                    if (obj.id == 0) {\n                      $scope.gatewaysAry[i] = initGatewayAtts(returnObj.data);\n                      $scope.selectedGateitem = $scope.gatewaysAry[i];\n                    }\n                  }\n                }\n\n                $scope.editVisible = false;\n                growl.success(\"新增网关成功\", {});\n              }\n            });\n          } else {\n            resourceUIService.updateGateway($scope.selectedGateitem, function (returnObj) {\n              if (returnObj.code == 0) {\n                if (returnObj.data) {\n                  for (var i in $scope.gatewaysAry) {\n                    var obj = $scope.gatewaysAry[i];\n\n                    if (obj.id == returnObj.data.id) {\n                      $scope.gatewaysAry[i] = initGatewayAtts(returnObj.data);\n                      $scope.selectedGateitem = $scope.gatewaysAry[i];\n                    }\n                  }\n                }\n\n                $scope.editVisible = false;\n                growl.success(\"修改网关成功\", {});\n              }\n            });\n          }\n        };\n      }\n    };\n\n    $scope.userGridData = {\n      columns: [{\n        title: \"姓名\",\n        data: \"userName\"\n      }, {\n        title: \"Email\",\n        data: \"emailAddress\"\n      }, {\n        title: \"移动电话\",\n        data: \"mobilePhone\"\n      }, {\n        title: \"办公电话\",\n        data: \"officePhone\"\n      }, {\n        title: \"操作\",\n        orderable: false,\n        data: \"option\"\n      }],\n      columnDefs: [{\n        \"targets\": 0,\n        \"data\": \"userName\",\n        \"render\": function render(data, type, full) {\n          //返回自定义名字\n          if (full.isEdit == 2 && type == \"display\") {\n            var str = '<select id=\"userDomainName\" name=\"userName\" class=\"combobox form-control\">' + '<option value=\"\">请选择用户</option>'; //赋值\n            //判断：\n\n            for (var i in $scope.userGridData.data) {\n              //\tfor (var j in $scope.domainUserData.data) {\n              //\t\tif ($scope.userGridData.data[i].userName != $scope.domainUserData.data[j].userName){\n              //\t\t\tstr += '<option value=\"' + $scope.userGridData.data[i].userID + '\">' + $scope.userGridData.data[i].userName + '</option>';\n              //\t\t}\n              //\t}\n              //if ($scope.domainUserData.data[i].userName == data) {\n              str += '<option value=\"' + $scope.userGridData.data[i].userID + '\">' + $scope.userGridData.data[i].userName + '</option>'; //} else {\n              //\tstr += '<option value=\"' + $scope.userGridData.data[i].domainID + '\">' + $scope.userGridData.data[i].name + '</option>';\n              //}\n            }\n\n            str += '</select>';\n            $scope.domainUserData.data = [];\n            return str;\n          } else {\n            return data;\n          }\n        }\n      }, {\n        \"targets\": 4,\n        \"data\": \"option\",\n        \"render\": function render(data, type, full) {\n          // 返回自定义内容\n          if (full.isEdit == 2) {\n            var str = \"<div class='input-group'>\";\n            str += \"<a id='save-btn' class='btn btn-social-icon'><i class='fa fa-check'></i></a>\";\n            str += \"<a id='del-btn' class='btn btn-social-icon'><i class='fa fa-close'></i></a>\";\n            str += \"</div>\";\n            return str;\n          } else {\n            var str = \"<div class='input-group'>\";\n            str += \"<a id='removeDomain-btn' class='btn btn-social-icon' data-toggle='tooltip' title='删除'><i class='fa fa-minus-square-o'></i></a>\";\n            str += \"</div>\";\n            return str;\n          }\n        }\n      }] //添加用户到该域下面\n\n    };\n\n    $scope.addUserToDomain = function () {\n      //getDomainUsers();\n      //addUserStatus为false时，执行添加操作；\n      if (addUserStatus == false) {\n        addUserStatus = true;\n        var item = $scope.selectedDomainitem;\n\n        if (item) {\n          for (var i in $scope.domainUsers) {\n            var obj = $scope.domainUsers[i];\n\n            if (obj.domainID == 0) {\n              growl.warning(\"当前有未保存资源域\", {});\n              return;\n            }\n          }\n\n          var newObj = {\n            userName: '选择用户',\n            emailAddress: '',\n            mobilePhone: '',\n            officePhone: '',\n            id: 0,\n            domainId: '',\n            domainPath: '',\n            isEdit: 2,\n            userType: 2,\n            userTypeLabel: \"普通用户\",\n            jobTitle: \"\",\n            discription: \"\",\n            edit: \"\",\n            userID: null\n          };\n\n          for (var i in $scope.domainUserData.data) {\n            if ($scope.domainUserData.data[i].userID == null) {\n              $scope.domainUserData.data[i] = newObj; //\t$scope.domainUserData.columnDefs[i] 重新定义\n\n              $scope.domainUserData.columnDefs[i] = {\n                \"targets\": 4,\n                \"data\": \"option\",\n                \"render\": function render(data, type, full) {\n                  // 返回自定义内容\n                  var str = \"<div class='input-group'>\";\n                  if (full.id == 0) str += \"<a id='save-btn' class='btn btn-social-icon'><i class='fa fa-save'></i></a>\";else str += \"<a id='save-btn' class='btn btn-social-icon'><i class='fa fa-check'></i></a>\";\n                  str += \"<a id='del-btn' class='btn btn-social-icon'><i class='fa fa-minus-square-o'></i></a>\";\n                  str += \"</div>\";\n                  return str;\n                }\n              };\n              $scope.$broadcast(Event.DOMAININFOSINIT, $scope.domainUserData);\n              return;\n            }\n          }\n\n          $scope.domainUserData.data.push(newObj);\n          $scope.$broadcast(Event.DOMAININFOSINIT, $scope.domainUserData);\n        }\n      } else {\n        growl.warning('当前正在添加域用户', {});\n      }\n    };\n    /**\n     * 给网关添加一个未激活设备，等同于网关自动发现\n     */\n\n\n    $scope.addIns = function () {\n      var item = $scope.selectedGateitem;\n\n      if (item) {\n        for (var i in $scope.gatewayDevices) {\n          var obj = $scope.gatewayDevices[i];\n\n          if (obj.id == 0) {\n            growl.warning(\"当前有未添加到网关设备，请点击保存按钮\", {});\n            return;\n          }\n        }\n\n        var newObj = {\n          gatewayId: item.id,\n          label: '新增设备' + $scope.gatewayDevices.length,\n          id: 0,\n          domainPath: '',\n          domainId: '',\n          modelId: '',\n          externalDevId: '',\n          managedStatus: 'deactive',\n          onlineStatus: 'offline',\n          operationStatus: 0,\n          isEdit: 2\n        };\n        $scope.gatewayDevices.push(newObj);\n        $scope.$broadcast(Event.CMDBINFOSINIT + \"GATE\", {\n          data: $scope.gatewayDevices\n        });\n      }\n    };\n    /**\n     * datatables内部操作处理\n     * @param {Object} type\n     * @param {Object} select\n     */\n\n\n    $scope.doAction = function (type, select) {\n      //增加三种视图（设备类型，资源域，网关）显示页的判断\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        if (type == \"save\") {\n          select.isEdit = 0;\n\n          if (select.id == 0) {\n            var addData = {};\n            addData.label = select.label;\n            addData.id = select.id;\n            addData.values = select.values;\n            addData.modelId = $scope.selectedDitem.id;\n            resourceUIService.addResource(addData, function (returnObj) {\n              if (returnObj.code == 0) {\n                reLoader();\n                growl.success(\"保存成功\", {});\n              }\n            });\n          } else if (select.id > 0) {\n            var updataData = select.data;\n            updataData.label = select.label;\n            updataData.id = select.id;\n            updataData.values = select.values;\n            resourceUIService.updateResource(updataData, function (returnObj) {\n              if (returnObj.code == 0) {\n                reLoader();\n                growl.success(\"保存成功\", {});\n              }\n            });\n          }\n        } else if (type == \"cancel\") {\n          for (var i in resourceUIService.selectedInstances) {\n            resourceUIService.selectedInstances[i][\"isEdit\"] = 0;\n          }\n\n          $scope.$broadcast(Event.CMDBINFOSINIT, {\n            \"option\": [resourceUIService.selectedInstances, $scope.selectedDitem.attrs]\n          });\n        } else if (type == \"delete\") {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '是否要删除设备:' + select.label + '',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                resourceUIService.deleteResource(select.id, function (resultObj) {\n                  if (resultObj.code == 0) {\n                    reLoader();\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == \"change\") {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '是否要改变设备状态为:' + (select.state == 1 ? '离线' : '在线') + '',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                for (var i in resourceUIService.selectedInstances) {\n                  if (resourceUIService.selectedInstances[i].id == select.id) {\n                    if (select.state == 1) {\n                      resourceUIService.selectedInstances[i].state = 0;\n                    } else {\n                      resourceUIService.selectedInstances[i].state = 1;\n                    }\n                  }\n                }\n\n                $scope.$broadcast(Event.CMDBINFOSINIT, {\n                  \"option\": [resourceUIService.selectedInstances, resourceUIService.selectedAttrs]\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == \"eidterror\") {\n          growl.warning(\"当前有正在编辑的设备\", {});\n        } else if (type == \"directive\") {\n          location.href = '#directiveview/' + select.data.modelId + '/' + select.id;\n        } else if (type == \"directive-save\") {\n          for (var i = $scope.selectedDitem.directives.length - 1; i > -1; i--) {\n            if ($scope.selectedDitem.directives[i].id == select.id) {\n              $scope.selectedDitem.directives[i] = select;\n              if ($scope.selectedDirective) $scope.selectedDitem.directives[i].params = $scope.selectedDirective.params;\n            }\n          }\n        } else if (type == \"params\") {\n          resourceUIService.checkDirectiveParam(select, function (returnObj) {\n            if (returnObj.code == 0) {\n              if (returnObj.data.params.length > 0) {\n                $scope.selectedDirective = returnObj.data;\n              } else {\n                growl.info(\"当前表达式无法解析出参数\", {});\n              }\n            }\n          });\n        } else if (type == \"message\") {\n          if ($scope.activeTab == \"指令\") {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              //size:BootstrapDialog.SIZE_WIDE,\n              message: '确认删除:' + $scope.selectedDitem.label + \"设备下的指令吗\",\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  for (var i in $scope.selectedDitem.directives) {\n                    var delItem = $scope.selectedDitem.directives[i];\n\n                    if (delItem.id == item.id) {\n                      $scope.selectedDitem.directives.splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  growl.warning(\"指令删除成功，请点击保存按钮\", {}); //growl.info(select, {});\n\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  dialogRef.close();\n                }\n              }]\n            });\n          } else if ($scope.activeTab == \"告警\") {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              //size:BootstrapDialog.SIZE_WIDE,\n              message: '确认删除:' + $scope.selectedDitem.label + \"设备下的告警吗\",\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  for (var i in $scope.selectedDitem.alerts) {\n                    var delItem = $scope.selectedDitem.alerts[i];\n\n                    if (delItem.id == item.id) {\n                      $scope.selectedDitem.alerts.splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  growl.warning(\"告警删除成功，请点击保存按钮\", {}); //growl.info(select, {});\n\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  dialogRef.close();\n                }\n              }]\n            });\n          } else if ($scope.activeTab == \"指标\") {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              //size:BootstrapDialog.SIZE_WIDE,\n              message: '确认删除:' + $scope.selectedDitem.label + \"设备下的指标吗\",\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  for (var i in $scope.selectedDitem.kpis) {\n                    var delItem = $scope.selectedDitem.kpis[i];\n\n                    if (delItem.id == item.id) {\n                      $scope.selectedDitem.kpis.splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  growl.warning(\"指标删除成功，请点击保存按钮\", {}); //growl.info(select, {});\n\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  dialogRef.close();\n                }\n              }]\n            });\n          }\n        } else if (type == 'thresholdMessage') {\n          growl.warning(select, {});\n        }\n      } else if ($scope.activeMainTab == \"资源域视图\") {\n        if (type == \"save\") {\n          select.isEdit = 0;\n          var userID = select.userID;\n          var newDomainID = $(\"#domain-selector\").val().split(\" \")[0];\n          var newDomainPath = $(\"#domain-selector\").val().split(\" \")[1];\n          var oldDomainID = $scope.selectedDomainitem.domainID;\n        } else if (type == \"cancel\") {\n          growl.success(\"取消切换域\", {});\n          changeDomainTabItem();\n        } else if (type == \"removeDomain\") {\n          //select.isEdit = 0;\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '确认将用户 ' + select.userName + ' 移出 ' + $scope.selectedDomainitem.name + ' 资源域吗？',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                //根域下面的管理员用户不能被删除\n                if (select.userType == 3 && $scope.selectedDomainitem.parentID == 0) {\n                  growl.warning(\"根域：\" + $scope.selectedDomainitem.name + \" 下的管理员用户：\" + select.userName + \"不能被移出\", {});\n                  dialogRef.close();\n                  return;\n                } else {\n                  var userID = select.userID;\n                  userDomainService.deleteDomain2User($scope.selectedDomainitem.domainID, userID, function (returnObj) {\n                    if (returnObj.code == 0) {\n                      growl.success(\"用户移出域成功\", {});\n                      changeDomainTabItem();\n                    }\n                  });\n                  dialogRef.close();\n                }\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == \"saveChangedDomain\") {\n          //提示\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '确认将资源域 ' + $scope.selectedDomainitem.name + ' 切换到资源域  ' + select.domainName + ' 吗？',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                var newDomainPath = select.domainPath;\n                var deviceID = select.id;\n                resourceUIService.changeDeviceDomain(select.id, newDomainPath, function (resultObj) {\n                  if (resultObj.code == 0) {\n                    //growl.success(\"切换资源域成功\", {});\n                    domainTree();\n                  }\n                }); //刷新页面\n\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == \"delDomain\") {\n          changeDomainTabItem();\n        } else if (type == \"cancelAddUser2Domain\") {\n          addUserStatus = false;\n          growl.success(\"取消添加用户到该域\", {});\n          changeDomainTabItem();\n        } else if (type == \"saveUserToDomain\") {\n          var domainID = $scope.selectedDomainitem.domainID;\n          var domainPath = $scope.selectedDomainitem.domainPath;\n          var userID = $('#userDomainName').val().split(\" \")[0];\n          var userName = $('#userDomainName').val().split(\" \")[1];\n          var domain = {\n            \"domainID\": domainID,\n            \"domainPath\": domainPath\n          }; //增加判断，如果选择的用户不存在则返回失败\n\n          if (userID == \"\") {\n            growl.warning(\"请选择用户\", {});\n            return;\n          } else {\n            //增加判断，用户是否已经存在该域中 Strat\n            //增加判断，用户是否已经存在该域中 END\n            userDomainService.addDomainUser(domain, userID, function (resultObj) {\n              if (resultObj.code == 0) {\n                growl.success(\"添加用户到域成功\", {}); // 查询刷新域用户面板\n\n                addUserStatus = false;\n                getUserFromThisDomain();\n              } else {\n                growl.warning(\"用户已经存在该域中，添加失败\", {});\n                return;\n              }\n            });\n          }\n        }\n      } else if ($scope.activeMainTab == \"网关视图\") {\n        if (type == 'gateSave') {\n          if (!select.label) {\n            growl.warning(\"名称不能为空\", {});\n            return;\n          }\n\n          if (!select.externalDevId) {\n            growl.warning(\"设备地址不能为空\", {});\n            return;\n          }\n\n          resourceUIService.registerDevice($scope.selectedGateitem.id, select, function (returnObj) {\n            if (returnObj.code == 0) {\n              gateWayTree();\n              growl.success(\"注册成功\", {});\n            }\n          });\n        } else if (type == 'gateActive') {\n          if ($scope.selectedGateitem.managedStatus != 'active') {\n            growl.warning(\"网关不是激活状态，无法启用设备!\", {});\n            return;\n          }\n\n          if (!select.modelId) {\n            growl.warning(\"模型不能为空\", {});\n            return;\n          }\n\n          if (!select.domainPath) {\n            growl.warning(\"资源域不能为空\", {});\n            return;\n          } //\t\t\t\t\t\tselect.createTime = \"2015-10-01T00:00:00.000\"\n          //\t\t\t\t\t\tselect.updateTime = \"2015-10-01T00:00:00.000\"\n\n\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '确认从 ' + $scope.selectedGateitem.name + ' 网关启用 ' + (select.label ? select.label : '') + ' 设备吗？',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                resourceUIService.activateDevice(select, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    gateWayTree();\n                    growl.success(\"启用成功\", {});\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == 'gateDel') {\n          //增加注销确认步骤\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '确认从 ' + $scope.selectedGateitem.name + ' 网关注销 ' + select.label + ' 设备吗？',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                resourceUIService.unregisterDevice($scope.selectedGateitem.id, select.id, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    gateWayTree();\n                    growl.success(\"注销成功\", {});\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        } else if (type == 'gateActivedelete') {\n          BootstrapDialog.show({\n            title: '提示',\n            closable: false,\n            //size:BootstrapDialog.SIZE_WIDE,\n            message: '确认从 ' + $scope.selectedGateitem.name + ' 网关停用 ' + select.label + ' 设备吗？',\n            buttons: [{\n              label: '确定',\n              cssClass: 'btn-success',\n              action: function action(dialogRef) {\n                resourceUIService.deactivateDevice(select.id, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    gateWayTree();\n                    growl.success(\"停用成功\", {});\n                  }\n                });\n                dialogRef.close();\n              }\n            }, {\n              label: '取消',\n              action: function action(dialogRef) {\n                dialogRef.close();\n              }\n            }]\n          });\n        }\n      }\n    };\n\n    var changeDomainItem = function changeDomainItem() {\n      $scope.editVisible = false;\n\n      if ($scope.activeMainTab == \"设备类型视图\") {\n        $scope.activeTab = '属性';\n        $scope.activeListTab = \"tab1\";\n        urmpTree();\n      } else if ($scope.activeMainTab == \"资源域视图\") {\n        //if ($scope.domainsAry.length == 0) {\n        //\tdomainTree();\n        //}\n        domainTree();\n        $scope.activeListTab = \"tab3\"; //changeDomainTabItem();\n      } else if ($scope.activeMainTab == \"网关视图\") {\n        //\t\t\t\t\tif ($scope.gatewaysAry.length == 0) {\n        gateWayTree(); //\t\t\t\t\t}\n\n        $scope.activeListTab = \"tab5\";\n      }\n\n      $scope.$apply();\n    };\n\n    var changeDomainTabItem = function changeDomainTabItem() {\n      addUserStatus = false; //增加过滤，如果是正在添加的资源域，那么取消这个tab页面切换操作\n\n      if ($scope.selectedDomainitem.domainID != 0) {\n        if ($scope.activeListTab == \"tab3\") {\n          //资源域视图,获取设备列表\n          getDomainDeviceList(); //var obj;\n          ////obj.domainPath = $scope.sel\n          //getDomainDeviceCount(obj);\n        } else if ($scope.activeListTab == \"tab4\") {\n          //资源域视图,获取域用户列表\n          getUserFromThisDomain(); //更新资源域用户count总数\n          //var userCount = 0;\n          //var domainPath = $scope.selectedDomainitem.domainPath;\n          //userDomainService.getAssociateDomain2User(domainPath, function(resultObj) {\n          //\tif (resultObj.code == 0) {\n          //\t\tfor (var i in resultObj.data) {\n          //\t\t\tvar obj = resultObj.data[i];\n          //\t\t\tobj.isEdit = 0;\n          //\t\t}\n          //\t\tinitDomainAtts({});\n          //\t\tvar domainUsers = resultObj.data;\n          //\t\tuserCount = domainUsers.length;\n          //\t\t$scope.domainUserData.data = resultObj.data;\n          //\t\t$scope.$broadcast(Event.DOMAININFOSINIT, $scope.domainUserData);\n          //\t}\n          //});\n          //\n          //var obj = {\n          //\tcount:userCount,\n          //\tdomainPath:domainPath\n          //};\n          //getDomainUserCount(obj,function(){\n          //\t//待增加内容：获取设备列表的列表\n          //});\n        }\n      } else {\n        growl.warning(\"请先保存新添加的资源域，再进行以下操作\", {});\n        return;\n      }\n    };\n\n    var changeTabItem = function changeTabItem() {\n      $scope.$apply();\n\n      if ($scope.activeListTab == \"tab2\") {\n        $timeout(function () {\n          $scope.$broadcast(Event.CMDBINFOS4MAPINIT, {\n            \"option\": [resourceUIService.selectedInstances, resourceUIService.selectedAttrs]\n          });\n        });\n      }\n    };\n\n    var domainTree = function domainTree() {\n      if (userLoginUIService.user.userType == 3) {\n        //3-企业管理员\n        $('#showbyusertype').show(); //获取用户\n\n        userEnterpriseService.queryEnterpriseUser(function (resultObj) {\n          if (resultObj.code == 0) {\n            //for (var i in resultObj.data) {\n            //\tvar obj = resultObj.data[i];\n            //\tobj.isEdit = 0;\n            //\tobj.userTypeLabel = obj.userType == 2 ? \"普通用户\" : \"管理员\";\n            //}\n            $scope.userGridData.data = resultObj.data;\n            $scope.$broadcast(Event.DOMAININFOSINIT, $scope.userGridData);\n          }\n        });\n      } else if (userLoginUIService.user.userType == 1 || userLoginUIService.user.userType == 2) {\n        //1-个人用户 2-企业普通用户\n        $('#showbyusertype').hide();\n      }\n\n      if ($scope.domainsAry != null || $scope.domainsAry != undefined || $scope.domainsAry != \"\") {\n        $scope.domainsAry = [];\n        userDomainService.queryDomainByUser(userLoginUIService.user.userID, function (returnObj) {\n          if (returnObj.code == 0) {\n            var tree = returnObj.data;\n\n            for (var i in tree) {\n              $scope.domainsAry.push(initDomainAtts(tree[i], i));\n\n              if ($scope.selectedDomainitem == null && i == 0) {\n                $scope.selectedDomainitem = $scope.domainsAry[i]; //获取该域下面的设备列表\n\n                getDomainDeviceList();\n              } else if ($scope.selectedDomainitem.domainPath == $scope.domainsAry[i].domainPath) {\n                $scope.selectedDomainitem = $scope.domainsAry[i];\n                getDomainDeviceList();\n              }\n            }\n          }\n        });\n      }\n    };\n\n    var gateWayTree = function gateWayTree() {\n      $scope.gatewaysAry = [];\n      resourceUIService.getAllGateways(function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            $scope.gatewaysAry.push(initGatewayAtts(returnObj.data[i], i));\n\n            if ($scope.selectedGateitem == null && i == 0) {\n              $scope.selectedGateitem = $scope.gatewaysAry[i];\n              getDevices($scope.selectedGateitem);\n            } else if ($scope.selectedGateitem.id == $scope.gatewaysAry[i].id) {\n              $scope.selectedGateitem = $scope.gatewaysAry[i];\n              getDevices($scope.selectedGateitem);\n            }\n          }\n        }\n      });\n    };\n\n    $scope.changeManagedStatus = function () {\n      if ($scope.selectedGateitem.managedStatus == 'deactive') {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认启用 ' + $scope.selectedGateitem.name + ' 网关吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              resourceUIService.activateGateway($scope.selectedGateitem.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  gateWayTree();\n                  growl.success(\"启用成功\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '停用网关的操作会使该网关下所有的设备一并停用，请确认要停用 ' + $scope.selectedGateitem.name + ' 网关吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              resourceUIService.deactivateGateway($scope.selectedGateitem.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  gateWayTree();\n                  growl.success(\"停用成功\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n\n    $scope.qrCode = function () {\n      var $textAndPic = $('<div style=\"padding-left:157px\"></div>');\n      $textAndPic.qrcode({\n        text: \"\" + $scope.selectedGateitem.id\n      });\n      BootstrapDialog.show({\n        title: '扫一扫加入' + $scope.selectedGateitem.label,\n        closable: true,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: $textAndPic,\n        buttons: [{\n          label: '下载APP',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            window.open(\"http://7mj4hc.com1.z0.glb.clouddn.com/index.html\");\n            dialogRef.close();\n          }\n        }, {\n          label: '关闭',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    var initEvent = function initEvent() {\n      //\t\t   \t\t$('a[data-toggle=\"tab\"]').off('shown.bs.tab');\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\n        $scope.selectedDirective = null;\n        var aname = $(e.target).attr(\"name\");\n        var targetText = $(e.target).text();\n\n        if (!aname) {\n          if (targetText.search(\"视图\") > -1) {\n            // 获取已激活主页的名称\n            $scope.activeMainTab = $.trim($(e.target).text()); // 获取前一个激活的主页的名称\n\n            $scope.previousMainTab = $(e.relatedTarget).text();\n            changeDomainItem();\n          } else {\n            // 获取已激活的标签页的名称\n            $scope.activeTab = $.trim($(e.target).text()); // 获取前一个激活的标签页的名称\n\n            previousTab = $.trim($(e.relatedTarget).text());\n            changeDItem();\n          }\n        } else {\n          $scope.activeListTab = aname;\n          changeTabItem();\n          changeDomainTabItem();\n        }\n      });\n    };\n\n    $scope.$on(\"$destroy\", function () {\n      console.log(\"on-destroy\");\n      SwSocket.unregister(uuid);\n    });\n\n    var domainTreeQuery = function domainTreeQuery() {\n      userDomainService.queryDomainTree(userLoginUIService.user.userID, function (data) {\n        $scope.domainListDic = data.domainListDic;\n        $scope.domainListTree = data.domainListTree;\n      });\n    };\n\n    $scope.gotoPath = function (item) {\n      if (item.nodes == $scope.treeAry) return;\n      var newAry = [];\n\n      for (var i in $scope.routePaths) {\n        if ($scope.routePaths[i].id == item.id) {\n          newAry.push($scope.routePaths[i]);\n          break;\n        }\n\n        newAry.push($scope.routePaths[i]);\n      }\n\n      $scope.routePaths = newAry;\n      $scope.showChildren(item);\n    };\n\n    $scope.showChildren = function (item) {\n      $scope.treeAry = item.nodes;\n      $scope.selectedDitem = null;\n      $scope.click($scope.treeAry[0]);\n    };\n\n    var init = function init() {\n      resourceUIService.getRootModel(function (returnObj) {\n        if (returnObj.code == 0) {\n          resourceUIService.rootModel = returnObj.data;\n          $scope.routePaths.push(returnObj.data);\n          urmpTree();\n        }\n      });\n      domainTree();\n      initEvent();\n      domainTreeQuery(); //\t\t\t\t}\n    };\n\n    $scope.directiveBack = function () {\n      $scope.doAction(\"directive-save\", $scope.selectedDirective);\n      $scope.selectedDirective = null;\n    };\n\n    $scope.saveThresholds = function (modelData, alertCode, thresholds) {\n      resourceUIService.saveThresholds(thresholds, function (returnObj) {\n        if (returnObj.code == 0) {\n          growl.success(\"阈值设置保存成功\", {});\n          var hasThreshold = false;\n\n          for (var i = 0; i < modelData.thresholds.length; i++) {\n            if (modelData.thresholds[i].alertCode == alertCode) {\n              modelData.thresholds[i].thresholdsData = returnObj.data;\n              hasThreshold = true;\n              break;\n            }\n          }\n\n          if (!hasThreshold) {\n            modelData.thresholds.push({\n              \"alertCode\": alertCode,\n              \"thresholdsData\": returnObj.data\n            });\n          }\n        }\n      });\n    };\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]);\n});"],"sourceRoot":"/source/"}