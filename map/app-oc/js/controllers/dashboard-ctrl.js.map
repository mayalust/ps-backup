{"version":3,"sources":["app-oc/js/controllers/dashboard-ctrl.js"],"names":["define","controllers","controller","$scope","Info","$timeout","viewFlexService","kpiDataService","alertService","resourceUIService","userLoginUIService","growl","SwSocket","ticketService","$location","q","console","info","deviceitems","totalItems2","orderList","get","totalItems","leftTitle","week","title","i","gotoShow","item","location","href","url","window","sessionStorage","setItem","user","functionCodeSet","changeKpiDisPlay","subitem","visible","gotoDeviceShow","modelId","id","changeBindData","flg","dashboardItems","timespan","$broadcast","getBaseViewInfo","rootCi","getManageDashboard","event","code","msg","v","data","userInfo","userID","viewType","content","charAt","jQuery","xml2json","SubViews","chartObj","chart","hasOwnProperty","j","titleObj","getChartProperty","value","queryData","topDatahandler","left2DataHandler","left3DataHandler","rightDataHandler","s","JSON","parse","elements","ele","option","text","nodes","err","log","p","params","states","countFromCache","returnObj","obj","kpiName","total","uuid","Math","callback","evendata","getKpiValueList","kpiCode","kpisDic","kpi","name","nodeIds","recordList","kpirecord","param","ciid","toString","kpiCodes","operation","register","send","$on","unregister","arr","newObj","lv","state","rate","push","round","abs","totalItems3","valuelist","totalItems4","handlerFun","timePeriod","category","formatStr","Object","kpis","type","defaultChart","getKpisInfo","dataSource","filters","getNodesInfo","kpiQueryModel","isRealTimeData","getResourceByIds","nodesDic","modelIds","getModelByIds","defers","defer","getKpisByModelId","find","element","resolve","promise","all","then","getOrderList","getTicketsByStatus","status","statuslab","priorityCode","severitylab","severitybg","getNewResources","getLatestDevices","getAlertPieInfo","subtext","x","tooltip","trigger","formatter","toolbox","show","feature","mark","dataView","readOnly","magicType","funnel","width","funnelAlign","max","restore","saveAsImage","calculable","series","radius","center","getKpiHierarchyValueList","alert_code_count","length","Event","ECHARTINFOSINIT","initAlertPei","alertTypeInfos","isAuthenticated","viewLoadFinished"],"mappings":"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","file":"app-oc/js/controllers/dashboard-ctrl.js","sourcesContent":["define(['controllers/controllers'], function (controllers) {\n  'use strict';\n\n  controllers.controller('Dashboard2Ctrl', ['$scope', 'Info', '$timeout', 'viewFlexService', 'kpiDataService', 'alertService', 'resourceUIService', 'userLoginUIService', 'growl', 'SwSocket', 'ticketService', '$location', '$q', function ($scope, Info, $timeout, viewFlexService, kpiDataService, alertService, resourceUIService, userLoginUIService, growl, SwSocket, ticketService, $location, q) {\n    console.info(\"切换到设备概览\");\n    $scope.deviceitems = [];\n    $scope.totalItems2 = [];\n    $scope.orderList = [];\n    var sparkCharts = [];\n    var info = Info.get(\"localdb/dashboard2.json\", function (info) {\n      $scope.totalItems = info.totalItems;\n      $scope.leftTitle = info.week.title;\n    });\n    /**\n     * 点击主显示块跳转到详细展示\n     */\n\n    $scope.gotoShow = function (item) {\n      location.href = item.url;\n\n      if (window.sessionStorage) {\n        if (item.title == \"待处理紧急工单数\") {\n          sessionStorage.setItem(\"indexTabOrder\", \"0\");\n        } else if (item.title == \"待处理工单数\") {\n          sessionStorage.setItem(\"indexTabOrder\", \"1\");\n        } else if (item.title == \"由我发起工单\") {\n          sessionStorage.setItem(\"indexTabOrder\", \"2\");\n        } else if (item.title == \"所有工单\") {\n          sessionStorage.setItem(\"indexTabOrder\", \"3\");\n        }\n      }\n    };\n    /**\n     * 切换主显示模块\n     * @param {Object} item\n     * @param {Object} subitem\n     */\n\n\n    for (var i in userLoginUIService.user.functionCodeSet) {}\n\n    $scope.changeKpiDisPlay = function (item, subitem) {\n      item.visible = false;\n      subitem.visible = true;\n    };\n    /**\n     * 点击设备到资源管理\n     */\n\n\n    $scope.gotoDeviceShow = function (item) {\n      location.href = \"#/resource/\" + item.modelId + \"/\" + item.id;\n    };\n    /**\n     * 切换周/月数据显示\n     */\n\n\n    $scope.changeBindData = function (flg) {\n      if (info[flg]) {\n        $scope.leftTitle = info[flg].title;\n\n        for (var i in $scope.dashboardItems) {\n          var item = $scope.dashboardItems[i];\n          item.timespan = info[flg].timespan;\n          $scope.$broadcast('itemChanger', item);\n        }\n      }\n    };\n    /**\n     * 获得告警数量\n     */\n\n\n    var queryAlertCount = function queryAlertCount() {\n      var params = {};\n      params.states = \"0\";\n      alertService.countFromCache(params, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in $scope.totalItems) {\n            var obj = $scope.totalItems[i];\n\n            if (obj.kpiName == \"toHandleAlertNum\") {\n              obj.value = returnObj.data.total;\n              break;\n            }\n          }\n        }\n      });\n    };\n    /**\n     * 获得基础的信息基于名为dashboard的性能视图\n     */\n\n\n    var getBaseViewInfo = function getBaseViewInfo() {\n      if (!$scope.rootCi) {\n        $timeout(function () {\n          getBaseViewInfo();\n        });\n      }\n\n      sparkCharts = [];\n      $scope.dashboardItems = [];\n      viewFlexService.getManageDashboard(function (event) {\n        try {\n          if (event.code == 0) {\n            var v = event.data;\n            var userName = $scope.userInfo.userID;\n\n            if (v.viewType == \"designView\") {\n              if (v.content.charAt(0) == \"<\") {\n                var content = jQuery.xml2json(v.content);\n\n                if (content.SubViews) {\n                  var chartObj = content.SubViews.chart;\n\n                  if (chartObj.hasOwnProperty(\"length\")) {\n                    for (var j in chartObj) {\n                      var titleObj = kpiDataService.getChartProperty(chartObj[j], \"title\");\n\n                      if (titleObj.value == \"TOP\") {\n                        queryData(chartObj[j], topDatahandler);\n                      }\n\n                      if (titleObj.value == \"LEFT\") {\n                        titleObj.value = \"\";\n                        $scope.dashboardItems = [chartObj[j]];\n                      }\n\n                      if (titleObj.value == \"LEFT2\") {\n                        queryData(chartObj[j], left2DataHandler);\n                      }\n\n                      if (titleObj.value == \"LEFT3\") {\n                        queryData(chartObj[j], left3DataHandler);\n                      }\n\n                      if (titleObj.value == \"RIGHT\") {\n                        queryData(chartObj[j], rightDataHandler);\n                      }\n                    }\n                  } else {\n                    var titleObj = kpiDataService.getChartProperty(chartObj, \"title\");\n\n                    if (titleObj.value == \"TOP\") {\n                      queryData(chartObj, topDatahandler);\n                    }\n                  }\n                }\n              } else {\n                var s = v.content;\n                content = JSON.parse(s);\n\n                for (var i in content.elements) {\n                  var ele = content.elements[i];\n\n                  if (ele.option.title.text == \"企业概览\") {\n                    queryData(ele, topDatahandler);\n                  } else if (ele.option.title.text == \"告警趋势\") {\n                    ele.option.title.text = \"\";\n                    ele.nodes = [$scope.rootCi];\n                    $scope.dashboardItems = [ele];\n                  } else if (ele.option.title.text == \"环比情况\") {\n                    queryData(ele, left2DataHandler);\n                  } else if (ele.option.title.text == \"处理情况\") {\n                    queryData(ele, left3DataHandler);\n                  } else if (ele.option.title.text == \"运行情况\") {\n                    queryData(ele, rightDataHandler);\n                  }\n                }\n              }\n            }\n          } else {\n            throw event.msg;\n          }\n        } catch (err) {\n          console.log(err);\n        }\n      });\n      /*\n      for (var i in viewFlexService.viewList) {\n      var v = viewFlexService.viewList[i];\n      }\n      */\n    };\n\n    var topDatahandler = function topDatahandler(p) {\n      queryAlertCount(); //获得告警\n\n      var uuid = Math.uuid();\n\n      var callback = function callback(evendata) {\n        console.info(\"监听到事件\");\n      };\n\n      kpiDataService.getKpiValueList(p, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var kpiCode in returnObj.kpisDic) {\n            var isHava = false;\n\n            for (var j in $scope.totalItems) {\n              var obj = $scope.totalItems[j];\n\n              if (kpiCode == obj.kpi) {\n                obj.name = p[1].nodeIds[0] + \"?\" + kpiCode;\n                isHava = true;\n                break;\n              }\n            }\n          }\n\n          for (var i in returnObj.data.recordList) {\n            var kpirecord = returnObj.data.recordList[i];\n\n            for (var j in $scope.totalItems) {\n              var obj = $scope.totalItems[j];\n              if (kpirecord[obj.name]) obj.value = kpirecord[obj.name];\n            }\n          }\n\n          var param = {\n            ciid: p[1].nodeIds.toString(),\n            kpi: p[1].kpiCodes.toString()\n          };\n          var operation = \"register\"; //考虑极端情况，一个页面有多个模块监听同一个方法  \n          //但展示在页面的数据需对接收的实时监听的数据做不同处理 \n\n          SwSocket.register(uuid, operation, callback); //websocket发送请求\n\n          SwSocket.send(uuid, operation, 'kpi', param);\n        }\n      });\n      /**\n       * 注销scope时注销方法heartBeat，回调函数callback  \n       */\n\n      $scope.$on(\"$destroy\", function () {\n        console.log(\"on-destroy\");\n        SwSocket.unregister(uuid);\n      });\n    };\n\n    var left2DataHandler = function left2DataHandler(p) {\n      var uuid = Math.uuid();\n\n      var callback = function callback(evendata) {\n        console.info(\"监听到事件\");\n      };\n\n      kpiDataService.getKpiValueList(p, function (returnObj) {\n        if (returnObj.code == 0) {\n          var arr = [];\n\n          for (var kpiCode in returnObj.kpisDic) {\n            var newObj = {\n              \"title\": returnObj.kpisDic[kpiCode],\n              \"lv\": \"text-green\",\n              \"value\": null,\n              \"state\": \"fa-caret-up\",\n              \"rate\": 0,\n              \"name\": p[1].nodeIds[0] + \"?\" + kpiCode\n            };\n            arr.push(newObj);\n          }\n\n          for (var i in returnObj.data.recordList) {\n            var kpirecord = returnObj.data.recordList[i];\n\n            for (var j in arr) {\n              var obj = arr[j];\n\n              if (obj.value) {\n                var rate = 0;\n                if (kpirecord[obj.name] && kpirecord[obj.name] != 0) rate = (kpirecord[obj.name] - obj.value) / kpirecord[obj.name];else rate = -1;\n\n                if (rate < 0) {\n                  obj.rate = Math.round(Math.abs(rate) * 100);\n                  obj.value = kpirecord[obj.name];\n                  obj.state = \"fa-caret-down\";\n                } else if (rate > 0) {\n                  obj.rate = Math.round(rate * 100);\n                  obj.value = kpirecord[obj.name];\n                  obj.state = \"fa-caret-up\";\n                  obj.lv = \"text-red\";\n                } else {\n                  obj.rate = Math.round(rate * 100);\n                  obj.value = kpirecord[obj.name];\n                  obj.state = \"fa-caret-left\";\n                  obj.lv = \"text-black\";\n                }\n              } else {\n                if (kpirecord[obj.name]) obj.value = kpirecord[obj.name];\n              }\n            }\n          }\n\n          $scope.totalItems2 = arr;\n          return;\n          var param = {\n            ciid: p[1].nodeIds.toString(),\n            kpi: p[1].kpiCodes.toString()\n          };\n          var operation = \"register\"; //考虑极端情况，一个页面有多个模块监听同一个方法  \n          //但展示在页面的数据需对接收的实时监听的数据做不同处理 \n\n          SwSocket.register(uuid, operation, callback); //websocket发送请求\n\n          SwSocket.send(uuid, operation, 'kpi', param);\n        }\n      });\n      /**\n       * 注销scope时注销方法heartBeat，回调函数callback  \n      \n      $scope.$on(\"$destroy\", function() {\n      \tconsole.log(\"on-destroy\");\n      \tSwSocket.unregister(uuid);\n      });\n       */\n    };\n\n    var left3DataHandler = function left3DataHandler(p) {\n      var uuid = Math.uuid();\n\n      var callback = function callback(evendata) {\n        console.info(\"监听到事件\");\n      };\n\n      kpiDataService.getKpiValueList(p, function (returnObj) {\n        if (returnObj.code == 0) {\n          var arr = [];\n\n          for (var kpiCode in returnObj.kpisDic) {\n            var newObj = {\n              \"title\": returnObj.kpisDic[kpiCode],\n              \"lv\": \"progress-bar-aqua\",\n              \"value\": null,\n              \"state\": \"\",\n              \"rate\": 0,\n              \"name\": p[1].nodeIds[0] + \"?\" + kpiCode\n            };\n            arr.push(newObj);\n          }\n\n          for (var i in returnObj.data.recordList) {\n            var kpirecord = returnObj.data.recordList[i];\n\n            for (var j in arr) {\n              var obj = arr[j];\n\n              if (kpirecord[obj.name]) {\n                obj.value = kpirecord[obj.name];\n                obj.rate = kpirecord[obj.name];\n\n                switch (true) {\n                  case obj.rate == 100:\n                    obj.lv = \"progress-bar-aqua\";\n                    break;\n\n                  case obj.rate > 90:\n                    obj.lv = \"progress-bar-green\";\n                    break;\n\n                  case obj.rate > 80:\n                    obj.lv = \"progress-bar-yellow\";\n                    break;\n\n                  case obj.rate > 70:\n                    obj.lv = \"progress-bar-yellow\";\n                    break;\n\n                  case obj.rate > 60:\n                    obj.lv = \"progress-bar-red\";\n                    break;\n\n                  default:\n                    obj.lv = \"progress-bar-danger\";\n                }\n              }\n            }\n          }\n\n          $scope.totalItems3 = arr;\n          return;\n          var param = {\n            ciid: p[1].nodeIds.toString(),\n            kpi: p[1].kpiCodes.toString()\n          };\n          var operation = \"register\"; //考虑极端情况，一个页面有多个模块监听同一个方法  \n          //但展示在页面的数据需对接收的实时监听的数据做不同处理 \n\n          SwSocket.register(uuid, operation, callback); //websocket发送请求\n\n          SwSocket.send(uuid, operation, 'kpi', param);\n        }\n      });\n      /**\n       * 注销scope时注销方法heartBeat，回调函数callback  \n       \n      $scope.$on(\"$destroy\", function() {\n      \tconsole.log(\"on-destroy\");\n      \tSwSocket.unregister(uuid);\n      });\n      */\n    };\n\n    var rightDataHandler = function rightDataHandler(p) {\n      var uuid = Math.uuid();\n\n      var callback = function callback(evendata) {\n        console.info(\"监听到事件\");\n      };\n\n      kpiDataService.getKpiValueList(p, function (returnObj) {\n        if (returnObj.code == 0) {\n          var arr = [];\n\n          for (var kpiCode in returnObj.kpisDic) {\n            var newObj = {\n              \"title\": returnObj.kpisDic[kpiCode],\n              \"value\": 0,\n              \"valuelist\": \"\",\n              \"name\": p[1].nodeIds[0] + \"?\" + kpiCode\n            };\n            arr.push(newObj);\n          }\n\n          for (var i in returnObj.data.recordList) {\n            var kpirecord = returnObj.data.recordList[i];\n\n            for (var j in arr) {\n              var obj = arr[j];\n\n              if (kpirecord[obj.name]) {\n                if (obj.valuelist) {\n                  obj.valuelist = obj.valuelist + \",\" + kpirecord[obj.name];\n                } else {\n                  obj.valuelist = kpirecord[obj.name];\n                } //\t\t\t\t\t\t\t\tobj.valuelist.push(kpirecord[obj.name]);\n\n\n                obj.value = kpirecord[obj.name];\n              }\n            }\n\n            if (i > 6) {\n              break;\n            }\n          }\n\n          $scope.totalItems4 = arr;\n          return;\n          var param = {\n            ciid: p[1].nodeIds.toString(),\n            kpi: p[1].kpiCodes.toString()\n          };\n          var operation = \"register\"; //考虑极端情况，一个页面有多个模块监听同一个方法  \n          //但展示在页面的数据需对接收的实时监听的数据做不同处理 \n\n          SwSocket.register(uuid, operation, callback); //websocket发送请求\n\n          SwSocket.send(uuid, operation, 'kpi', param);\n        }\n      });\n      /**\n       * 注销scope时注销方法heartBeat，回调函数callback  \n      \n      $scope.$on(\"$destroy\", function() {\n      \tconsole.log(\"on-destroy\");\n      \tSwSocket.unregister(uuid);\n      });\n       */\n    };\n\n    var queryData = function queryData(item, handlerFun) {\n      var kpiCodes = [];\n      var kpiName2Code = new Object();\n      var timePeriod;\n      var nodeIds = [$scope.rootCi];\n      var category;\n      var option;\n      var formatStr;\n      var addDatas = [];\n      var perIndex = -1;\n\n      if (item.hasOwnProperty(\"option\")) {\n        if (item.hasOwnProperty('timespan')) {\n          kpiCodes = item.kpis;\n          timePeriod = item.timespan;\n          category = item.category;\n\n          if (item.type == \"line\" || item.type == \"bar\") {} else if (item.type == \"pie\" || item.type == 'gauge') {\n            timePeriod = 0;\n          }\n\n          formatStr = {};\n          formatStr.value = '';\n          if (item.formatStr) formatStr.value = item.formatStr;\n        } else {\n          defaultChart = true;\n        }\n      } else {\n        formatStr = kpiDataService.getChartProperty(item, \"categoryAxisFormatStr\");\n        var arr = kpiDataService.getKpisInfo(item);\n        kpiCodes = arr[0];\n        kpiName2Code = arr[1];\n        category = item.dataSource.filters.category;\n        var arr = kpiDataService.getNodesInfo(item);\n        timePeriod = arr[1];\n      }\n\n      var kpiQueryModel = {\n        category: category,\n        isRealTimeData: true,\n        timePeriod: timePeriod,\n        nodeIds: nodeIds,\n        kpiCodes: kpiCodes\n      };\n      resourceUIService.getResourceByIds(nodeIds, function (returnObj) {\n        kpiQueryModel.nodesDic = returnObj;\n        var modelIds = [];\n\n        for (var i in returnObj) {\n          modelIds.push(returnObj[i].modelId);\n        }\n\n        resourceUIService.getModelByIds(modelIds, function (event) {\n          console.log(event);\n          var models = event.data;\n          var defers = [];\n\n          for (var i in event.data) {\n            var defer = q.defer();\n\n            (function (defer) {\n              var modelId = event.data[i].id;\n              resourceUIService.getKpisByModelId(modelId, function (event) {\n                console.log(event.data);\n\n                for (var j in kpiCodes) {\n                  var find = event.data.find(function (element) {\n                    return element.id == kpiCodes[j];\n                  });\n\n                  if (find) {\n                    if (kpiQueryModel.kpisDic) {\n                      kpiQueryModel.kpisDic[kpiCodes[j]] = find;\n                    } else {\n                      kpiQueryModel.kpisDic = {};\n                      kpiQueryModel.kpisDic[kpiCodes[j]] = find;\n                    }\n                  }\n                }\n\n                defer.resolve(\"success\");\n              });\n              defers.push(defer.promise);\n            })(defer);\n          }\n\n          q.all(defers).then(function (data) {\n            //console.log(kpiQueryModel);\n            handlerFun([\"kpi\", kpiQueryModel]);\n          });\n        });\n        /*\n        if (kpiQueryModel.kpisDic) {\n        \thandlerFun([\"kpi\", kpiQueryModel]);\n        }\n        */\n      });\n      /*\n      resourceUIService.getKpisByKpiIds(kpiCodes,function(returnObj){\n      \tkpiQueryModel.kpisDic = returnObj;\n      \tif (kpiQueryModel.nodesDic) {\n      \t\thandlerFun([\"kpi\", kpiQueryModel]);\n      \t}\n      });\n      */\n    }; //查看执行中工单\n\n\n    var getOrderList = function getOrderList() {\n      var status = 100;\n      ticketService.getTicketsByStatus(status, function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            if (i < 10) {\n              var obj = returnObj.data[i];\n\n              if (obj.status == 0) {\n                obj.statuslab = \"待处理\";\n              } else if (obj.status == 100) {\n                obj.statuslab = \"处理中\";\n              } else {\n                obj.statuslab = \"已完成\";\n              }\n\n              if (obj.priorityCode == 200) {\n                obj.severitylab = \"高\";\n                obj.severitybg = \"alerts-critical\";\n              } else if (obj.priorityCode == 100) {\n                obj.severitylab = \"中\";\n                obj.severitybg = \"alerts-major\";\n              } else {\n                obj.severitylab = \"低\";\n                obj.severitybg = \"alerts-minor\";\n              }\n\n              $scope.orderList.push(obj);\n            }\n          }\n        }\n      });\n    };\n\n    var getNewResources = function getNewResources() {\n      resourceUIService.getLatestDevices(function (returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            var obj = returnObj.data[i]; //\t\t\t\t\t\t\tobj.time = new Date(obj.createTime).Format(GetDateCategoryStrByLabel());\n\n            $scope.deviceitems.push(obj);\n          }\n        }\n      });\n    };\n\n    var getAlertPieInfo = function getAlertPieInfo() {\n      var option = {\n        title: {\n          text: '',\n          subtext: '',\n          x: 'center'\n        },\n        tooltip: {\n          trigger: 'item',\n          formatter: \"{a} <br/>{b} : {c} ({d}%)\"\n        },\n        toolbox: {\n          show: true,\n          feature: {\n            mark: {\n              show: false\n            },\n            dataView: {\n              show: false,\n              readOnly: false\n            },\n            magicType: {\n              show: false,\n              type: ['pie', 'funnel'],\n              option: {\n                funnel: {\n                  x: '25%',\n                  width: '50%',\n                  funnelAlign: 'left',\n                  max: 1548\n                }\n              }\n            },\n            restore: {\n              show: true\n            },\n            saveAsImage: {\n              show: false\n            }\n          }\n        },\n        calculable: true,\n        series: [{\n          name: '常见告警',\n          type: 'pie',\n          radius: '55%',\n          center: ['50%', '40%'],\n          data: [{\n            value: 0,\n            name: '暂无告警可供分析'\n          }]\n        }]\n      };\n\n      var initAlertPei = function initAlertPei(recordList) {\n        option.series[0].data = [];\n\n        for (var i in recordList) {\n          var obj = {};\n          obj.value = recordList[i].alert_code_count;\n          obj.name = recordList[i].category;\n          option.series[0].data.push(obj);\n          if (option.series[0].data.length > 5) break;\n        }\n\n        $scope.$broadcast(Event.ECHARTINFOSINIT, {\n          \"option\": option,\n          \"name\": \"dashboard\"\n        });\n      };\n\n      var kpiQueryModel = {\n        category: 'ci',\n        isRealTimeData: true,\n        timePeriod: 0,\n        kpiCodes: [\"alert_code_count\"]\n      };\n      var p = [\"alert\", kpiQueryModel];\n      kpiDataService.getKpiHierarchyValueList(p, function (returnObj) {\n        if (returnObj.code == 0) {\n          initAlertPei(returnObj.data.recordList);\n          $scope.alertTypeInfos = returnObj.data.recordList;\n        }\n      });\n    };\n\n    if (userLoginUIService.user.isAuthenticated && viewFlexService.viewLoadFinished) {\n      getBaseViewInfo();\n      getOrderList();\n      getNewResources();\n      getAlertPieInfo();\n    } else {\n      $scope.$on('viewLoadFinished', function (event, msg) {\n        getBaseViewInfo();\n        getOrderList();\n        getNewResources();\n        getAlertPieInfo();\n      });\n    }\n  }]);\n});"],"sourceRoot":"/source/"}