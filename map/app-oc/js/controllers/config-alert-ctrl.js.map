{"version":3,"sources":["app-oc/js/controllers/config-alert-ctrl.js"],"names":["define","controllers","initController","scope","$scope","q","viewFlexService","$timeout","growl","dialogue","ngDialog","userDomainService","userLoginUIService","resourceUIService","getAllMyViews","returnObj","code","configAlerts","data","filter","elem","viewType","editAlertView","view","namelist","viewTitle","map","newTitle","$$","duplicateName","run","domainlist","rootModel","dt","JSON","parse","content","stateToArr","target","arr","split","i","value","indexOf","replacer","dialog","input","label","type","composory","events","change","item","error","button","disabled","undefined","domain","key","mark","options","fontsize","width","nodeType","pageSize","test","messageFilter","states","severities","icon","fn","close","param","loop","index","push","toString","$attr","stringify","getData","viewId","updateView","addView","event","success","viewlist","source","console","log","checkAllLoaded","window","queryDomainTree","user","userID","getRootModel","getModels","Array","prototype","apply","open","template","className","header","class","style","margin","click","visible","some","selected","self","viewIds","viewTitles","fnlist","border-radius","font-size","font-weight","padding","deleteViews","remove","title","description","columnDefs","filterable","sortable","format","insertAfter","placeholder","onChange","this","find","element"],"mappings":"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","file":"app-oc/js/controllers/config-alert-ctrl.js","sourcesContent":["define(['controllers/controllers', 'Array'], function (controllers) {\n  'use strict';\n\n  controllers.initController('configAlertDialog', ['$scope', function (scope) {}]);\n  controllers.initController('configAlertCtrl', ['$scope', '$q', 'viewFlexService', '$timeout', 'growl', 'dialogue', 'ngDialog', 'userDomainService', 'userLoginUIService', 'resourceUIService', function ($scope, q, viewFlexService, $timeout, growl, dialogue, ngDialog, userDomainService, userLoginUIService, resourceUIService) {\n    function initViews() {\n      var getAllMyViews_callback = function getAllMyViews_callback(returnObj) {\n        if (returnObj.code == 0) {\n          /**\n          var del = returnObj.data.filter(function(elem){\n            return elem.viewType == null;\n          }).map(function(elem){\n            return elem.viewId;\n          });\n          viewFlexService.deleteViews(del, function(event){\n            console.log(event);\n          });\n           */\n          var configAlerts = returnObj.data.filter(function (elem) {\n            return elem.viewType == \"configAlert\";\n          });\n\n          var editAlertView = function editAlertView(view) {\n            var namelist = configAlerts.filter(function (elem) {\n              if (view) {\n                return elem.viewTitle != view.viewTitle;\n              } else {\n                return true;\n              }\n            }).map(function (elem) {\n              return elem.viewTitle;\n            });\n            var newTitle = $$.duplicateName(\"新建告警组\", namelist);\n\n            var run = function run(domainlist, rootModel) {\n              if (view) {\n                var dt = JSON.parse(view.content);\n              }\n\n              var stateToArr = function stateToArr(target, data) {\n                var arr = data.split(\",\");\n\n                var loop = function loop(elem) {\n                  elem.value = arr.indexOf(elem.replacer + \"\") > -1;\n                };\n\n                for (var i in target) {\n                  loop(target[i]);\n                }\n\n                return target;\n              };\n\n              var getData = function getData(data) {\n                var param = {};\n\n                var loop = function loop(index, elem) {\n                  var type = elem.type;\n                  var value;\n\n                  if (type == \"checkbox\") {\n                    value = [];\n\n                    for (var i in elem.options) {\n                      if (elem.options[i].value) {\n                        value.push(elem.options[i].replacer);\n                      }\n                    }\n\n                    value = value.toString();\n                  } else {\n                    value = elem.value;\n                  }\n\n                  param.$attr(elem.data, value);\n                };\n\n                for (var i in data) {\n                  loop(i, data[i]);\n                }\n\n                param.content = JSON.stringify(param.content);\n                return param;\n              };\n\n              var alertOption = [{\n                label: \"新产生\",\n                replacer: 0\n              }, {\n                label: \"已确认\",\n                replacer: 5\n              }, {\n                label: \"处理中\",\n                replacer: 10\n              }, {\n                label: \"已解决\",\n                replacer: 20\n              }];\n              var severities = [{\n                label: \"警告\",\n                replacer: 1,\n                value: false\n              }, {\n                label: \"次要\",\n                replacer: 2,\n                value: false\n              }, {\n                label: \"重要\",\n                replacer: 3,\n                value: false\n              }, {\n                label: \"严重\",\n                replacer: 4,\n                value: false\n              }];\n              $scope.dialog = {\n                input: [{\n                  \"label\": \"告警组名称\",\n                  \"value\": view ? view.viewTitle : newTitle,\n                  \"data\": \"viewTitle\",\n                  \"type\": \"input\",\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(item) {\n                      if (namelist.indexOf(item.value) != -1) {\n                        item.error = \"告警视图以存在，请更换视图名称\";\n                        $scope.dialog.button[0].disabled = true;\n                      } else if (item.value == \"\") {\n                        item.error = \"告警视图名称不可为空\";\n                        $scope.dialog.button[0].disabled = true;\n                      } else {\n                        item.error = undefined;\n                        $scope.dialog.button[0].disabled = false;\n                      }\n                    }\n                  }\n                }, {\n                  \"label\": \"资源域\",\n                  \"value\": view ? dt.domain : null,\n                  \"data\": \"content/domain\",\n                  \"type\": \"tree\",\n                  \"key\": \"domainPath\",\n                  \"mark\": \"domain\",\n                  \"options\": domainlist,\n                  \"fontsize\": \"12px\",\n                  \"width\": \"200px\"\n                }, {\n                  \"label\": \"设备模板\",\n                  \"value\": view ? dt.nodeType : null,\n                  \"data\": \"content/nodeType\",\n                  \"type\": \"tree\",\n                  \"key\": \"id\",\n                  \"mark\": \"nodes\",\n                  \"options\": rootModel,\n                  \"fontsize\": \"12px\",\n                  \"width\": \"200px\"\n                }, {\n                  \"value\": view ? dt.pageSize : 1000,\n                  \"label\": \"取得告警数量\",\n                  \"data\": \"content/pageSize\",\n                  \"type\": \"input\",\n                  \"events\": {\n                    \"change\": function change(item) {\n                      var regExp = /\\d.*/;\n                      var test = regExp.test(item.value);\n\n                      if (test) {\n                        item.error = undefined;\n                        $scope.dialog.button[0].disabled = false;\n                      } else {\n                        item.error = \"请输入数字\";\n                        $scope.dialog.button[0].disabled = true;\n                      }\n                    }\n                  }\n                }, {\n                  \"label\": \"内容关键词\",\n                  \"value\": view ? dt.messageFilter : \"\",\n                  \"data\": \"content/messageFilter\",\n                  \"type\": \"input\"\n                }, {\n                  \"label\": \"告警状态\",\n                  \"data\": \"content/states\",\n                  \"type\": \"checkbox\",\n                  \"options\": stateToArr(alertOption, view ? dt.states : \"\")\n                }, {\n                  \"label\": \"告警级别\",\n                  \"data\": \"content/severities\",\n                  \"type\": \"checkbox\",\n                  \"options\": stateToArr(severities, view ? dt.severities : \"\")\n                }],\n                button: [{\n                  label: view ? \"编辑\" : \"创建\",\n                  icon: \"btn btn-primary\",\n                  fn: function fn() {\n                    ngDialog.close();\n                    var param = getData($scope.dialog.input);\n                    var fn;\n                    param.viewType = \"configAlert\";\n\n                    if (view) {\n                      param.viewId = view.viewId;\n                      fn = viewFlexService.updateView;\n                    } else {\n                      fn = viewFlexService.addView;\n                    }\n\n                    fn(param, function (event) {\n                      if (event.code == \"0\") {\n                        if (view) {\n                          view.viewTitle = event.data.viewTitle;\n                          view.content = event.data.content;\n                          growl.success(\"告警视图 [ \" + event.data.viewTitle + \" ] 修改成功\", {});\n                        } else {\n                          $scope.viewlist.source.push(event.data);\n                          growl.success(\"创建告警视图成功\", {});\n                        }\n\n                        ;\n                      }\n                    });\n                  }\n                }, {\n                  label: \"取消\",\n                  icon: \"btn btn-default\",\n                  fn: function fn() {\n                    ngDialog.close();\n                  }\n                }]\n              };\n              console.log($scope.dialog);\n            };\n\n            var checkAllLoaded = function checkAllLoaded() {\n              if (window['domainlist'] == undefined) {\n                userDomainService.queryDomainTree(userLoginUIService.user.userID, function (event) {\n                  if (event.code == 0) {\n                    window['domainlist'] = event.data;\n                    checkAllLoaded();\n                  }\n                });\n              } else if (window['rootModel'] == undefined) {\n                var getRootModel_back = function getRootModel_back(event) {\n                  if (event.code == 0) {\n                    window['rootModel'] = [event.data];\n\n                    var getModels_back = function getModels_back(event) {\n                      Array.prototype.push.apply(window['rootModel'], event.data);\n                      checkAllLoaded();\n                    };\n\n                    resourceUIService.getModels(getModels_back);\n                  }\n                };\n\n                resourceUIService.getRootModel(getRootModel_back);\n              } else {\n                run(window['domainlist'], window['rootModel']);\n              }\n            };\n\n            checkAllLoaded();\n            ngDialog.open({\n              template: '../partials/config-alert-dialog.html',\n              className: 'ngdialog-theme-plain',\n              scope: $scope\n            });\n          };\n\n          var addNewClick = function addNewClick(event) {\n            editAlertView();\n          };\n\n          var designClick = function designClick(event, source) {\n            editAlertView(event, source);\n          };\n\n          var removeGraph = function removeGraph(event) {\n            var self = event;\n            var viewIds = event.map(function (elem) {\n              return elem.viewId;\n            });\n            var viewTitles = event.map(function (elem) {\n              return elem.viewTitle;\n            });\n            var fnlist = [{\n              label: '是',\n              icon: 'btn btn-success',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn() {\n                dialogue.close();\n                viewFlexService.deleteViews(viewIds, function (event) {\n                  if (event.code == 0) {\n                    growl.success(\"告警视图 [ \" + viewTitles.toString() + \" ] 删除成功\", {});\n\n                    for (var i in self) {\n                      self[i].remove();\n                    }\n\n                    ;\n                  }\n                });\n              }\n            }, {\n              label: '否',\n              icon: 'btn btn-default',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn() {\n                dialogue.close();\n              }\n            }];\n            dialogue.open({\n              title: {\n                label: '删除告警视图'\n              },\n              description: {\n                label: '确认要删除告警视图   [ ' + viewTitles.toString() + ' ]  吗？'\n              },\n              fnlist: fnlist\n            });\n            console.log(viewIds);\n          };\n\n          var viewClick = function viewClick(event) {\n            location.href = \"../app-configure/index.html#/display/\" + event.viewId;\n          };\n\n          var deleteClick = function deleteClick(event) {\n            var self = event;\n            var viewId = event.viewId;\n            var viewTitle = event.viewTitle;\n            var fnlist = [{\n              label: '是',\n              icon: 'btn btn-success',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn() {\n                dialogue.close();\n                viewFlexService.deleteViews([viewId], function (event) {\n                  if (event.code == 0) {\n                    growl.success(\"告警视图 [ \" + viewTitle + \" ] 删除成功\", {});\n                    self.remove(); //getViews();\n                  }\n                });\n              }\n            }, {\n              label: '否',\n              icon: 'btn btn-default',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn() {\n                dialogue.close();\n              }\n            }];\n            dialogue.open({\n              title: {\n                label: '删除告警视图'\n              },\n              description: {\n                label: '确认要删除告警视图   [ ' + viewTitle + ' ]  吗？'\n              },\n              fnlist: fnlist\n            });\n          };\n\n          var duplicateClick = function duplicateClick(event) {\n            var self = event;\n            var namelist = $scope.viewlist.source.map(function (elem) {\n              return elem.viewTitle;\n            });\n            var duplicateName = $$.duplicateName(event.viewTitle, namelist);\n            var content = event.content;\n            var fnlist = [{\n              label: '创建',\n              icon: 'btn btn-success',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn(event) {\n                console.log(event.input);\n                var param = {\n                  viewType: \"configure\",\n                  viewTitle: event.input[0].value,\n                  content: content\n                };\n                viewFlexService.addView(param, function (event) {\n                  if (event.code == 0) {\n                    growl.success(\"复制告警视图[\" + event.data.viewTitle + \"]成功\", {});\n                    dialogue.close();\n                    self.insertAfter(event.data);\n                  }\n                });\n              }\n            }, {\n              label: '取消',\n              icon: 'btn btn-default',\n              style: {\n                width: '50%',\n                'border-radius': 0,\n                'font-size': '18px',\n                'font-weight': 'bold',\n                'padding': 10\n              },\n              fn: function fn() {\n                dialogue.close();\n              }\n            }];\n            dialogue.open({\n              title: {\n                label: '复制视图'\n              },\n              input: [{\n                value: duplicateName,\n                composory: true,\n                label: '新视图名称',\n                placeholder: '新视图名称',\n                onChange: function onChange(event) {\n                  var value = this.value;\n                  var find = $scope.viewlist.source.find(function (element) {\n                    return element.viewTitle == value;\n                  });\n\n                  if (find) {\n                    event.error = \"此视图名已被占用，请更换.\";\n                    fnlist[0].disabled = true;\n                  } else {\n                    if (value == \"\") {\n                      event.error = \"视图名不可为空.\";\n                      fnlist[0].disabled = true;\n                    } else {\n                      event.error = null;\n                      fnlist[0].disabled = false;\n                    }\n                  }\n                }\n              }],\n              fnlist: fnlist\n            });\n          };\n\n          $scope.viewlist = {\n            source: configAlerts,\n            header: [{\n              label: \"新建告警视图\",\n              icon: \"fa fa-plus\",\n              type: \"button\",\n              class: \"btn btn-primary btn-sm\",\n              style: {\n                margin: \"2px\"\n              },\n              events: {\n                click: addNewClick\n              }\n            }, {\n              label: \"删除\",\n              icon: \"fa fa-minus\",\n              type: \"button\",\n              visible: function visible(event) {\n                var some = event.some(function (elem) {\n                  return elem.selected == true;\n                });\n                return !some;\n              },\n              class: \"btn btn-default btn-sm\",\n              style: {\n                margin: \"2px\"\n              },\n              events: {\n                click: removeGraph\n              }\n            }],\n            columnDefs: [{\n              label: \"视图名称\",\n              data: \"viewTitle\",\n              type: \"text\",\n              filterable: true,\n              sortable: true\n            }, {\n              label: \"创建时间\",\n              data: \"createTime\",\n              type: \"date\",\n              format: \"yy-mm-dd, hh:nn:ss\",\n              filterable: false,\n              sortable: true\n            }, {\n              label: \"更新时间\",\n              data: \"updateTime\",\n              type: \"date\",\n              format: \"yy-mm-dd, hh:nn:ss\",\n              filterable: false,\n              sortable: true\n            }, {\n              label: \"操作\",\n              width: 141,\n              type: \"buttonGroup\",\n              filterable: false,\n              sortable: false,\n              options: [{\n                label: \"编辑\",\n                type: \"button\",\n                class: \"btn btn-primary\",\n                events: {\n                  click: designClick\n                }\n              }, {\n                label: \"删除\",\n                type: \"button\",\n                events: {\n                  click: deleteClick\n                }\n              }, {\n                label: \"复制\",\n                type: \"button\",\n                events: {\n                  click: duplicateClick\n                }\n              }]\n            }]\n          };\n          /**\n           $scope.$broadcast('RAPPIDVIEWS', {\n            \"data\": $scope.configureView\n          });\n           */\n        }\n      };\n\n      viewFlexService.getAllMyViews(getAllMyViews_callback);\n    }\n\n    initViews();\n  }]);\n});"],"sourceRoot":"/source/"}