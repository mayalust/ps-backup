{"version":3,"sources":["app-oc/js/controllers/energy-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","$routeParams","$q","$timeout","$location","ngDialog","userLoginUIService","resourceUIService","energyConsumeUIService","growl","structureList","$watch","n","o","energyTypeList","myDicts","dataSourceTypeList","energyStrucInfo","title","query","statisticsType","statisticsTypeList","MONTH","YEAR","QUARTER","ifShow","user","userType","commitFun","show","closable","message","buttons","label","cssClass","action","dialogRef","saveEnergyConsumeTree","returnObj","code","ifCommit","success","$broadcast","close","createTree","data","rs","loop","item","parentID","parent","find","elem","id","undefined","children","Object","defineProperty","enumerable","push","i","startSearch","listData","filter","name","indexOf","Event","ENTERPRISEINIT","option","enterpriseId","queryDomainsByEnterpriseId","structureData","getDomainsByFilter","modelId","state","some","commit","isAuthenticated","$on","evt","d","unitService","userDomainService","viewType","view","energySignatureTypeId","signatureId","selectedCount","forEach","valueCode","text","broardFun","type","objList","dialog","input","energyType","valentweight","equal","createTime","Date","select","button","disabled","scope","every","right","fn","tableInit","convertStandardYear","dataObj","index","queryConvertList","info","warning","mistakeMesg","verifyFun","value","r","test","header","delete","year","yearList","event","addClick","window","location","href","addEnergyClick","open","template","className","saveClick","param","energyConvertStandard","energyConvertStandardDetails","addEnergyConvertStandardDto","parseInt","updateEnergyConvertStandardDto","copyClick","copyEnergyConvertStandardDto","queryAllList","goClear","queryState","doAction","callback","deleteEnergyConvertStandardDto","sel","splice","$apply","effectEnergyConvertStandard","searchData","findEnergyConvertStandards","init","convertStandardByEnergyId","$controller","kpiDataService","FileUploader","userUIService","ifshowState","hash","search","ifView","energyTypeDic","serviceOrigin","uploadFileUrl","fileFormat","args","response","console","log","uploader","onAfterAddingFile","fileItem","queue","length","queueLimit","removeFromQueue","formData","config","uploadAll","energyConsumeRecords","energyConsumeValue","saveEnergyConsumeRecords","selectedId","time","enterpriseName","overdue","import","selObj","$","click","timeImport","getFullYear","month","getMonth","domiansAry","domains","split","generateEnergyConsumeRecordTaskByTime","export","encodeURI","statisticsPeriod","startTime","endTime","substring","RecordsByTaskId","findEnergyConsumeRecordsByTaskId","nodeIdsAry","map","energyConsumeNodeId","energyAry","obj","category","isRealTimeData","nodeIds","kpiCodes","granularityUnit","aggregateType","queryInstances","join","timeRange","statisticType","includeInstance","condList","timePeriod","dataType","getValueList","labelDic","energyTypeName","instance","energyConsumeNodeName","nodeId","energyTypeUnit","energyConsumeTreeNodeName","updateEnergyConsumeRecordTaskState","findConsumeRecordTasksByCondition","directiveStrategyUIService","kqiManagerUIService","TEXT","granularityUnits","condition","getDirectivesByModelIdNotByRole","$$","cacheAsyncData","call","getDevicesByCondition","getDataItemsByModelId","dataDic","dtree","domaintree","nodes","domainInfos","allModels","allInstructAry","editInstruc","target","hours","minutes","days","months","weekdays","KPIlIST","composory","options","events","change","varnamelist","deviceAry","directiveAry","TABLE","apply","groups","deviceModelId","domainPath","directiveDomainPath","devices","directive","kpi","targetCi","directiveId","params","inputs","concat","kpiId","maxlength","placeholder","thresholds","targetKpiId","compareType","thresholdValue","start","$tabInx","naviClick","CALMODE","cron","granular","GRANULARITYUNIT","granularChange","SECONDS","textAfter","filterFormat","SECONDSCOUNT","DAYS","DAYSCOUNT","MINUTES","textBefore","MINUTESCOUNT","HOURS","HOURSCOUNT","WEEKDAYS","MONTHS","frequency","error","TIMESELECT","INSTRUCNAME","DESCRIPTION","description","DOMAINPATH","sortable","filterable","key","mark","modes","default","tabs","TARGETSOURCE","DEVICElIST","deviceIds","DIRECTIVELIST","ciList","values","cronVal","granularObj","regExp","dt","runRegExp","cronToTime","note","icon","disabledFn","opt","p","inp","self","newVar","kpiDefinitionIds","timeToCron","arrcount","arr","fd","weekOrDay","calcExp","findVal","repeat","result","repeatcount","judgeValue","judgeAlarm","val","calculable","updateDirectiveStrategys","addDirectiveStrategys","pushbefore","strHeader","strEdit","strDel","optList","menuitems","class","style","margin","fnlist","remove","width","border-radius","font-size","font-weight","padding","deleteDirectiveStrategy","instructions","source","showSelector","columnDefs","editable","edit","format","row","getDirectiveStrategys","getModels","queryDomainTree","userID","init2","instrId","pipeline","opts","conf","extend","pages","url","method","cacheLower","cacheUpper","cacheLastRequest","cacheLastJson","request","drawCallback","settings","ajax","requestStart","drawStart","requestLength","requestEnd","sort","columns","order","column","sortType","dir","clearCache","JSON","stringify","isFunction","isPlainObject","pageRequest","statCount","draw","getHistoryByPage","queryList","total","json","recordsTotal","recordsFiltered","queryItem","getDirectiveStrategyHistory","goSearch","way"],"mappings":"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","file":"app-oc/js/controllers/energy-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog', 'Array'], function (controllers, BootstrapDialog) {\n  'use strict'; //能耗结构管理\n\n  controllers.initController('energyStructureCtrl', ['$scope', '$routeParams', '$q', '$timeout', '$location', 'ngDialog', 'userLoginUIService', 'resourceUIService', 'energyConsumeUIService', 'growl', function ($scope, $routeParams, $q, $timeout, $location, ngDialog, userLoginUIService, resourceUIService, energyConsumeUIService, growl) {\n    var structureList;\n    $scope.$watch(\"myDicts\", function (n, o) {\n      if (n) {\n        $scope.energyTypeList = $scope.myDicts['energyType'];\n        $scope.dataSourceTypeList = $scope.myDicts['dataSourceType'];\n      }\n    });\n    $scope.energyStrucInfo = {\n      title: \"能耗结构管理\",\n      query: \"\",\n      //查询字段\n      statisticsType: \"\",\n      //显示类型\n      statisticsTypeList: {\n        MONTH: '月',\n        YEAR: '年',\n        QUARTER: '季度'\n      },\n      ifShow: userLoginUIService.user.userType == 1000 ? true : false,\n      commitFun: function commitFun() {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '提交后将不能进行修改和删除，确认提交吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              energyConsumeUIService.saveEnergyConsumeTree(function (returnObj) {\n                if (returnObj.code == 0) {\n                  $scope.ifCommit = true;\n                  growl.success(\"能耗结构已提交\", {});\n                  $scope.$broadcast(\"commit\");\n                  dialogRef.close();\n                }\n              });\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              $scope.ifCommit = false;\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n\n    var createTree = function createTree(data) {\n      var rs;\n\n      var loop = function loop(item) {\n        var parentID = item.parentID;\n        var parent = data.find(function (elem) {\n          //找父亲，根据parentId来找\n          return parentID == elem.id;\n        });\n\n        if (parent) {\n          if (parent.children == undefined) {\n            parent.children = []; //给找着的父亲添加孩子属性，如果它还没有孩子的话\n          }\n\n          item.parent = parent; //给传进来的数据，把这个父亲的属性添加进去\n\n          Object.defineProperty(item, \"parent\", {\n            enumerable: false\n          });\n          parent.children.push(item); //并把自己的这条数据放进父亲的属性中\n        } else {\n          item.parent = null;\n          Object.defineProperty(item, \"parent\", {\n            enumerable: false\n          });\n          rs = item;\n        }\n\n        ;\n      };\n\n      for (var i in data) {\n        loop(data[i]);\n      }\n\n      return rs;\n    };\n\n    $scope.startSearch = function () {\n      var listData = structureList.filter(function (elem) {\n        return elem.name.indexOf($scope.query) != -1;\n      });\n\n      if ($scope.query != '' && $scope.query != undefined) {\n        $scope.$broadcast(\"FILTERDATA\", listData);\n      } else {\n        $scope.$broadcast(\"FILTERDATA_allData\");\n      }\n    };\n\n    $timeout(function () {\n      $scope.$broadcast(Event.ENTERPRISEINIT + \"_energy\", {\n        \"option\": []\n      });\n    }); //获取节点信息\n\n    if ($routeParams.enterpriseId) {\n      energyConsumeUIService.queryDomainsByEnterpriseId($routeParams.enterpriseId, function (returnObj) {\n        if (returnObj.code == 0) {\n          structureList = returnObj.data;\n          $scope.structureData = createTree(structureList);\n        }\n      });\n    } else {\n      resourceUIService.getDomainsByFilter([{\n        \"modelId\": 303\n      }], function (returnObj) {\n        if (returnObj.code == 0) {\n          var state = returnObj.data.some(function (item) {\n            return item.commit == 'yes';\n          });\n          structureList = returnObj.data;\n          $scope.structureData = createTree(structureList);\n\n          if (state) {\n            //提交\n            $scope.ifCommit = true;\n          } else {\n            $scope.ifCommit = false;\n          }\n        }\n      });\n    }\n\n    var init = function init() {// findEnterpriseInfoById();\n    };\n    /**\n     * 监听登录状态\n     */\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]); //能源折标系数管理\n\n  controllers.initController('energySignatureCtrl', ['$scope', '$routeParams', '$timeout', '$q', '$location', 'ngDialog', 'unitService', 'userLoginUIService', 'energyConsumeUIService', 'growl', 'userDomainService', function ($scope, $routeParams, $timeout, $q, $location, ngDialog, unitService, userLoginUIService, energyConsumeUIService, growl, userDomainService) {\n    if ($routeParams.viewType == 'View') {\n      $scope.view = true;\n    }\n\n    var energySignatureTypeId = $routeParams.signatureId;\n    $scope.selectedCount = 0;\n    $scope.$watch(\"myDicts\", function (n, o) {\n      if (n) {\n        var energyTypeList = $scope.myDicts['energyType'];\n        $scope.energyTypeList = energyTypeList;\n        energyTypeList.forEach(function (item) {\n          item.id = item.valueCode;\n          item.text = item.label;\n        });\n      }\n    });\n\n    var broardFun = function broardFun(type, objList) {\n      if (type == 'edit_convert') {\n        $timeout(function () {\n          $scope.$broadcast(Event.ENTERPRISEINIT + \"_convertedit\", {\n            \"option\": [objList]\n          });\n        });\n      } else if (type == 'convert') {\n        $timeout(function () {\n          $scope.$broadcast(Event.ENTERPRISEINIT + \"_convert\", {\n            \"option\": [objList]\n          });\n        });\n      }\n    }; //初始化数据\n\n\n    var initData = function initData() {\n      $scope.dialog.input = {\n        energyType: '',\n        valentweight: '',\n        equal: '',\n        createTime: new Date(),\n        id: -1\n      };\n    }; //折标系数dialog\n\n\n    $scope.dialog = {\n      title: \"能源折标系数\",\n      input: {\n        energyType: \"\",\n        //能源类型\n        valentweight: \"\",\n        //当量系数\n        equal: \"\",\n        //等价系数\n        // id: -1,\n        createTime: new Date()\n      },\n      select: {// energyTypeList: energyTypeList\n      },\n      button: [{\n        label: \"确定\",\n        disabled: function disabled() {\n          var every = scope.dialog.input.every(function (elem) {\n            return elem.right != false;\n          });\n          return !every;\n        },\n        fn: function fn() {\n          if (!$scope.tableInit.input.convertStandardYear) {\n            growl.warning(\"请选择生效年度\", {});\n            return;\n          }\n\n          var dataObj = $scope.dialog.input,\n              index = 0;\n          $scope.queryConvertList.forEach(function (item) {\n            if (item.createTime == dataObj.createTime) {\n              //编辑\n              item.energyType = dataObj.energyType;\n              item.equal = dataObj.equal;\n              item.valentweight = dataObj.valentweight;\n              index++;\n            }\n          });\n\n          if (index == 0) {\n            delete dataObj.id;\n            $scope.queryConvertList.push(dataObj);\n          }\n\n          broardFun('edit_convert', $scope.queryConvertList);\n          growl.info(\"请点击“保存模板”按钮，以便对修改的内容进行保存！\", {}); // if ($scope.dialog.input.id == -1) { //新增\n          //   energyConsumeUIService.addEnergyConvertStandardDetail([dataObj], addproduct_callback);\n          // } else if ($scope.dialog.input.id > 0) { //编辑           \n          //   energyConsumeUIService.updateEnergyConvertStandardDetail([dataObj], updataproduct_callback);\n          // }\n\n          ngDialog.close();\n        }\n      }, {\n        label: \"取消\",\n        fn: function fn() {\n          ngDialog.close();\n        }\n      }]\n    }; //验证阈值\n\n    $scope.mistakeMesg = {};\n\n    $scope.verifyFun = function (value, type) {\n      var reg, r;\n      reg = /^[+-]?([1-9][0-9]*|0)(\\.[0-9]+)?%?$/; //全体实数\n\n      r = reg.test(value);\n\n      if (!r) {\n        //不为数字\n        $scope.mistakeMesg[type] = true;\n      } else {\n        $scope.mistakeMesg[type] = false;\n      }\n    }; //折标\n\n\n    $scope.tableInit = {\n      'header': {\n        'label': \"能源折标系数管理\",\n        'delete': \"删除折标系数\"\n      },\n      'input': {\n        'convertStandardYear': '',\n        'state': '',\n        'id': -1\n      },\n      'select': {\n        'year': function () {\n          var yearList = [];\n\n          for (var i = 2015; i < 2026; i++) {\n            yearList.push({\n              id: i,\n              text: i + '年'\n            });\n          }\n\n          ;\n          return yearList;\n        }()\n      },\n      'event': {\n        'addClick': function addClick() {\n          window.location.href = './index.html#/energySignatureInfo/' + '0';\n        },\n        'addEnergyClick': function addEnergyClick() {\n          initData();\n          ngDialog.open({\n            template: '../partials/dialogue/energy_signatrue_dia.html',\n            className: 'ngdialog-theme-plain',\n            scope: $scope\n          });\n        },\n        'saveClick': function saveClick() {\n          if (!$scope.tableInit.input.convertStandardYear) {\n            growl.warning(\"请选择生效年度\", {});\n            return;\n          }\n\n          var addproduct_callback = function addproduct_callback(returnObj) {\n            if (returnObj.code == 0) {\n              $scope.tableInit.input.id = returnObj.data.energyConvertStandard.id; // $scope.queryAllList.push(returnObj.data.energyConvertStandard);\n              // broardFun('convert', $scope.queryAllList);\n\n              growl.success(\"能源折标系数添加成功\", {});\n            }\n          };\n\n          var updataproduct_callback = function updataproduct_callback(returnObj) {\n            if (returnObj.code == 0) {\n              growl.success(\"能源折标系数修改成功\", {});\n              return; // $scope.queryAllList.forEach(function(item) {\n              //   if (item.id == $scope.tableInit.input.id) {\n              //     $.extend(item, returnObj.data.energyConvertStandard);\n              //   }\n              //   broardFun('convert', $scope.queryAllList);\n              //   growl.success(\"能源折标系数修改成功\", {});\n              //   return;\n              // })\n            }\n          };\n\n          if ($scope.tableInit.input.id == -1) {\n            //新增\n            var param = [{\n              energyConvertStandard: {\n                \"convertStandardYear\": $scope.tableInit.input.convertStandardYear\n              },\n              energyConvertStandardDetails: $scope.queryConvertList\n            }];\n            energyConsumeUIService.addEnergyConvertStandardDto(param, addproduct_callback);\n          } else if ($scope.tableInit.input.id > 0) {\n            //编辑\n            var param = [{\n              energyConvertStandard: {\n                \"id\": parseInt($scope.tableInit.input.id),\n                \"convertStandardYear\": $scope.tableInit.input.convertStandardYear\n              },\n              energyConvertStandardDetails: $scope.queryConvertList\n            }];\n            energyConsumeUIService.updateEnergyConvertStandardDto(param, updataproduct_callback);\n          }\n        },\n        'copyClick': function copyClick() {\n          energyConsumeUIService.copyEnergyConvertStandardDto([$scope.selectedCount], function (returnObj) {\n            if (returnObj.code == 0) {\n              $scope.queryAllList.push(returnObj.data);\n              broardFun('convert', $scope.queryAllList);\n              growl.success(\"成功复制折标系数\", {});\n              $scope.selectedCount = 0;\n            }\n          });\n        },\n        'goClear': function goClear() {\n          $scope.tableInit.select.convertStandardYear = $scope.queryState.state == 1 ? $scope.tableInit.select.convertStandardYear : null;\n          $scope.tableInit.select.state = $scope.queryState.state == 1 ? $scope.tableInit.select.state : null;\n        }\n      }\n    }; //table动作\n\n    $scope.doAction = function (type, select, callback) {\n      if (type == 'delete') {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除该折标系数？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              energyConsumeUIService.deleteEnergyConvertStandardDto([select], function (returnObj) {\n                callback(returnObj);\n\n                if (returnObj.code == 0) {\n                  select.forEach(function (sel) {\n                    for (var i in $scope.queryAllList) {\n                      if (sel == $scope.queryAllList[i].id) {\n                        $scope.queryAllList.splice(i, 1);\n                      }\n                    }\n                  });\n                  growl.success(\"折标系数已删除\", {});\n                  $scope.selectedCount = 0;\n                  $scope.$apply();\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              callback(false);\n              dialogRef.close();\n              $scope.selectedCount = 0;\n              $scope.$apply();\n            }\n          }]\n        });\n      } else if (type == 'deleteDetail') {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除该折标系数？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              var returnObj = {\n                code: 0\n              };\n              callback(returnObj);\n              select.forEach(function (sel) {\n                for (var i in $scope.queryConvertList) {\n                  if (sel == $scope.queryConvertList[i].id) {\n                    $scope.queryConvertList.splice(i, 1);\n                  }\n                }\n              });\n              growl.info(\"请点击“保存模板”按钮，以便对修改的内容进行保存！\", {});\n              $scope.selectedCount = 0;\n              $scope.$apply();\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              callback(false);\n              dialogRef.close();\n              $scope.selectedCount = 0;\n              $scope.$apply();\n            }\n          }]\n        });\n      } else if (type == 'effect') {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认生效该折标系数？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              energyConsumeUIService.effectEnergyConvertStandard(select, function (returnObj) {\n                callback(returnObj);\n\n                if (returnObj.code == 0) {\n                  growl.success(\"折标系数已生效\", {});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              callback(false);\n              dialogRef.close();\n              $scope.selectedCount = 0;\n              $scope.$apply();\n            }\n          }]\n        });\n      }\n    };\n\n    $scope.searchData = function () {\n      var param = {\n        \"id\": energySignatureTypeId ? energySignatureTypeId : \"\",\n        \"convertStandardYear\": $scope.tableInit.select.convertStandardYear ? $scope.tableInit.select.convertStandardYear : \"\",\n        \"state\": $scope.tableInit.select.state ? $scope.tableInit.select.state : \"\"\n      };\n      energyConsumeUIService.findEnergyConvertStandards([param], function (returnObj) {\n        if (returnObj.code == 0) {\n          if (energySignatureTypeId > 0) {\n            $scope.tableInit.input.convertStandardYear = returnObj.data[0].convertStandardYear;\n          }\n\n          $scope.queryAllList = returnObj.data;\n          broardFun('convert', returnObj.data);\n        }\n      });\n    };\n\n    var init = function init() {\n      if (energySignatureTypeId > 0) {\n        $scope.tableInit.input.id = energySignatureTypeId;\n\n        (function () {\n          energyConsumeUIService.convertStandardByEnergyId([energySignatureTypeId], function (returnObj) {\n            if (returnObj.code == 0) {\n              $scope.queryConvertList = returnObj.data;\n              broardFun('edit_convert', returnObj.data);\n            }\n          });\n        })();\n      } else {\n        $scope.queryConvertList = [];\n        broardFun('edit_convert', []);\n      }\n\n      $scope.searchData();\n    };\n    /**\n     * 监听登录状态\n     */\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]); //数据上报管理\n\n  controllers.initController('energyTasksCtrl', ['$scope', '$routeParams', '$timeout', '$controller', 'kpiDataService', 'FileUploader', '$q', 'userUIService', '$location', 'ngDialog', 'unitService', 'userLoginUIService', 'energyConsumeUIService', 'growl', 'userDomainService', function ($scope, $routeParams, $timeout, $controller, kpiDataService, FileUploader, $q, userUIService, $location, ngDialog, unitService, userLoginUIService, energyConsumeUIService, growl, userDomainService) {\n    $scope.ifshowState = false; //数据上报\n\n    $scope.userType = userLoginUIService.user.userType;\n\n    if (location.hash.search(\"#/InfoOnStateManagement\") > -1) {\n      $scope.ifshowState = true; //信息状态\n    }\n\n    ;\n\n    if (userLoginUIService.user.userType == 100) {\n      $scope.state = [{\n        id: 'commit',\n        label: '未审核'\n      }, {\n        id: 'pass',\n        label: '审核'\n      }];\n    } else {\n      $scope.state = [{\n        id: 'commit',\n        label: '提交'\n      }, {\n        id: 'nocommit',\n        label: '草稿'\n      }];\n    }\n\n    $scope.ifView = false; //查看标识符\n\n    $scope.selectedCount = 0; //选择导入导出\n\n    var energyTypeList = [],\n        energyTypeDic = {};\n    $scope.$watch(\"myDicts\", function (n, o) {\n      if (n) {\n        var energyTypeList = $scope.myDicts['energyType'];\n        energyTypeList.forEach(function (item) {\n          energyTypeDic[item.valueCode] = item; // item.id = item.valueCode;\n          // item.text = item.label;\n        });\n      }\n    }); //导入模板\n\n    $scope.serviceOrigin = userUIService.uploadFileUrl + '/api/rest/import/energyConsumeUIService/importEnergyConsumeRecords';\n    $scope.fileFormat = '|xls|xlsx|';\n    $controller('AppUploadCtrl', {\n      $scope: $scope,\n      growl: growl,\n      FileUploader: FileUploader\n    });\n\n    var download = function download(config) {\n      $scope.uploader.formData = [];\n      $scope.uploader.formData.push({\n        config: 'energyConsumeRecordModel'\n      });\n      $scope.uploader.uploadAll();\n      growl.info(\"能耗记录导入处理中，请耐心等待...\");\n    };\n\n    $scope.$on(\"uploadTemplate\", function (event, args) {\n      if (args.response.code == 0) {\n        growl.success('能耗录入导入成功', {});\n        console.log('记得刷新一下');\n      }\n    });\n\n    $scope.uploader.onAfterAddingFile = function (fileItem) {\n      if ($scope.uploader.queue.length > $scope.queueLimit) {\n        $scope.uploader.removeFromQueue(0);\n      }\n\n      download();\n    };\n\n    var broardFun = function broardFun(objList) {\n      $timeout(function () {\n        $scope.$broadcast(Event.ENTERPRISEINIT + \"_recordTask\", {\n          \"option\": [objList]\n        });\n      });\n    }; //初始化数据\n\n\n    var initData = function initData() {\n      $scope.dialog.input = {\n        energyType: '',\n        valentweight: '',\n        equal: '',\n        createTime: new Date(),\n        id: -1\n      };\n    };\n\n    $scope.dialog = {\n      title: \"能耗统计信息\",\n      button: [{\n        label: \"确定\",\n        fn: function fn() {\n          var param = [];\n          $scope.energyConsumeRecords.forEach(function (item) {\n            param.push({\n              'id': item.id,\n              'energyConsumeValue': item.energyConsumeValue\n            });\n          });\n\n          var saveEnergy_callback = function saveEnergy_callback(returnObj) {\n            if (returnObj.code == 0) {\n              growl.success(\"能耗统计信息保存成功\", {});\n            }\n          };\n\n          energyConsumeUIService.saveEnergyConsumeRecords([param, $scope.selectedId], saveEnergy_callback);\n          ngDialog.close();\n        }\n      }, {\n        label: \"取消\",\n        fn: function fn() {\n          ngDialog.close();\n        }\n      }]\n    }; //验证阈值\n\n    $scope.mistakeMesg = {};\n\n    $scope.verifyFun = function (value, type) {\n      var reg, r;\n      reg = /^[+-]?([1-9][0-9]*|0)(\\.[0-9]+)?%?$/; //全体实数\n\n      r = reg.test(value);\n\n      if (!r) {\n        //不为数字\n        $scope.mistakeMesg[type] = true;\n      } else {\n        $scope.mistakeMesg[type] = false;\n      }\n    }; //数据上报\n\n\n    $scope.tableInit = {\n      'header': {\n        'label': $scope.ifshowState ? \"信息状态管理\" : \"统计数据上报\",\n        'time': ''\n      },\n      'select': {\n        'enterpriseName': '',\n        'statisticsType': '',\n        'state': '',\n        'overdue': ''\n      },\n      'event': {\n        'goClear': function goClear() {\n          $scope.tableInit.select.enterpriseName = $scope.queryState.state == 1 ? $scope.tableInit.select.enterpriseName : null;\n          $scope.tableInit.select.statisticsType = $scope.queryState.state == 2 ? $scope.tableInit.select.statisticsType : null;\n          $scope.tableInit.select.state = $scope.queryState.state == 3 ? $scope.tableInit.select.state : null;\n          $scope.tableInit.select.overdue = $scope.queryState.state == 4 ? $scope.tableInit.select.overdue : null;\n        },\n        'import': function _import(selObj) {\n          $('#nv-file-select-task').click();\n        },\n        timeImport: function timeImport() {\n          if (!$scope.tableInit.header.time) {\n            growl.warning(\"请先选择时间\", {});\n            return;\n          }\n\n          var year = new Date($scope.tableInit.header.time).getFullYear();\n          var month = new Date($scope.tableInit.header.time).getMonth() + 1;\n\n          if (month < 10) {\n            month = '0' + month;\n          }\n\n          var time = year + '-' + month;\n          var domiansAry = userLoginUIService.user.domains.split('/');\n          var param = [time, domiansAry[domiansAry.length - 2]];\n          energyConsumeUIService.generateEnergyConsumeRecordTaskByTime(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              if (returnObj.data.length > 0) {\n                $scope.queryAllList.push(returnObj.data[0]);\n                broardFun($scope.queryAllList);\n              } else {\n                growl.info(\"新建任务数据为空，请重新选择时间范围\", {});\n              }\n            }\n          });\n        },\n        'export': function _export(selObj) {\n          location.href = '' + userUIService.uploadFileUrl + '/api/rest/export/energyConsumeUIService/exportEnergyConsumeRecord/' + encodeURI(encodeURI(selObj.statisticsPeriod)) + '.xls/' + selObj.id + '/energyConsumeRecord/';\n        }\n      }\n    }; //table动作\n\n    $scope.doAction = function (type, select, callback) {\n      var startTime = '';\n      var endTime = '';\n      var year = '';\n      var month = '';\n\n      if (select.statisticsType == 'MONTH' || select.statisticsType == 'QUARTER') {\n        year = select.statisticsPeriod.substring(0, 4);\n        month = select.statisticsPeriod.substring(5);\n        startTime = new Date(year + '-' + month + '-' + '01');\n        endTime = new Date(year + '-' + month + '-' + '02');\n      } else if (select.statisticsType == 'YEAR') {\n        startTime = new Date(select.statisticsPeriod + '-01-01');\n        endTime = new Date(select.statisticsPeriod + '-01-02');\n      }\n\n      var kpiList = function kpiList(obj, data, callback) {\n        var param = [\"kpi\", {\n          \"category\": \"time\",\n          \"isRealTimeData\": false,\n          startTime: obj.startTime,\n          endTime: obj.endTime,\n          \"nodeIds\": obj.nodeIdsAry,\n          \"kpiCodes\": [3300],\n          \"granularityUnit\": obj.statisticsType,\n          \"aggregateType\": [\"ORIGINAL\"],\n          \"queryInstances\": obj.energyAry.join(','),\n          \"timeRange\": \"\",\n          \"statisticType\": \"psiot\",\n          \"includeInstance\": true,\n          \"condList\": [],\n          \"timePeriod\": 0,\n          \"dataType\": 1\n        }];\n        kpiDataService.getValueList(param, function (returnObj) {\n          if (returnObj.code == 0) {\n            var labelDic = {};\n            data.forEach(function (item) {\n              labelDic[item.energyConsumeNodeId] = item;\n            });\n            returnObj.data.forEach(function (item) {\n              // item.energyTypeName = energyTypeDic[item.energyType].label;\n              item.energyTypeName = item.instance;\n              item.energyConsumeValue = item.value;\n              item.energyConsumeNodeName = labelDic[item.nodeId].energyConsumeNodeName;\n              item.energyTypeUnit = labelDic[item.nodeId].energyTypeUnit;\n              item.energyConsumeTreeNodeName = labelDic[item.nodeId].energyConsumeTreeNodeName;\n            });\n            $scope.energyConsumeRecords = returnObj.data;\n\n            if (callback) {\n              callback();\n            }\n          }\n        });\n      };\n\n      var RecordsByTaskId = function RecordsByTaskId(type, id) {\n        energyConsumeUIService.findEnergyConsumeRecordsByTaskId([id], function (returnObj) {\n          if (returnObj.code == 0) {\n            var param = {};\n            param.nodeIdsAry = returnObj.data.map(function (item) {\n              return item.energyConsumeNodeId;\n            });\n            param.energyAry = returnObj.data.map(function (item) {\n              return energyTypeDic[item.energyType].label;\n            });\n            param.startTime = startTime;\n            param.endTime = endTime;\n            param.statisticsType = select.statisticsType;\n\n            if (type == 'pass') {\n              kpiList(param, returnObj.data, function () {\n                ngDialog.open({\n                  template: '../partials/dialogue/consume_record_tasks_dia.html',\n                  className: 'ngdialog-theme-plain',\n                  scope: $scope\n                });\n              });\n            } else {\n              returnObj.data.forEach(function (item) {\n                item.energyTypeName = energyTypeDic[item.energyType].label;\n              });\n              $scope.energyConsumeRecords = returnObj.data;\n              ngDialog.open({\n                template: '../partials/dialogue/consume_record_tasks_dia.html',\n                className: 'ngdialog-theme-plain',\n                scope: $scope\n              });\n            }\n          }\n        });\n      };\n\n      if (type == 'edit') {\n        $scope.selectedId = select.id;\n        $scope.ifView = false;\n        RecordsByTaskId(select.state, select.id);\n      } else if (type == 'commit') {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认' + (userLoginUIService.user.userType == 100 ? '审核' : '提交') + '该能耗统计信息？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              var state = userLoginUIService.user.userType == 100 ? 'pass' : 'commit';\n              energyConsumeUIService.updateEnergyConsumeRecordTaskState([select, state], function (returnObj) {\n                callback(returnObj);\n\n                if (returnObj.code == 0) {\n                  if (userLoginUIService.user.userType == 100) {\n                    growl.success(\"能耗统计信息已审核\", {});\n                  } else {\n                    growl.success(\"能耗统计信息已提交\", {});\n                  }\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              callback(false);\n              dialogRef.close();\n              $scope.selectedCount = 0;\n              $scope.$apply();\n            }\n          }]\n        });\n      } else if (type == 'view') {\n        $scope.ifView = true;\n        RecordsByTaskId(select.state, select.id);\n      }\n    };\n\n    $scope.searchData = function () {\n      if ($scope.userType == 100 || $scope.userType == 3) {\n        //政府\n        var param = {\n          // \"id\": energySignatureTypeId ? energySignatureTypeId : \"\",\n          \"enterpriseName\": $scope.tableInit.select.enterpriseName ? $scope.tableInit.select.enterpriseName : \"\",\n          \"overdue\": $scope.tableInit.select.overdue ? $scope.tableInit.select.overdue : \"\",\n          \"statisticsType\": $scope.tableInit.select.statisticsType ? $scope.tableInit.select.statisticsType : \"\",\n          \"state\": $scope.tableInit.select.state ? $scope.tableInit.select.state : \"\"\n        };\n      } else {\n        //企业\n        var param = {\n          // \"id\": energySignatureTypeId ? energySignatureTypeId : \"\",\n          \"statisticsType\": $scope.tableInit.select.statisticsType ? $scope.tableInit.select.statisticsType : \"\",\n          \"state\": $scope.tableInit.select.state ? $scope.tableInit.select.state : \"\"\n        };\n      }\n\n      energyConsumeUIService.findConsumeRecordTasksByCondition([param], function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.queryAllList = returnObj.data;\n          broardFun(returnObj.data);\n        }\n      });\n    };\n\n    var init = function init() {\n      $scope.searchData();\n    };\n    /**\n     * 监听登录状态\n     */\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n  }]); //指令策略管理\n\n  controllers.initController('instructCtrl', ['$scope', '$routeParams', '$timeout', '$controller', 'directiveStrategyUIService', 'kqiManagerUIService', '$q', 'resourceUIService', '$location', 'ngDialog', 'unitService', 'userLoginUIService', 'energyConsumeUIService', 'growl', 'userDomainService', function (scope, $routeParams, $timeout, $controller, directiveStrategyUIService, kqiManagerUIService, $q, resourceUIService, $location, ngDialog, unitService, userLoginUIService, energyConsumeUIService, growl, userDomainService) {\n    var TEXT = {\n      \"SUBMIT\": \"确定\",\n      \"CANCEL\": \"取消\"\n    };\n    var granularityUnits = [{\n      id: \"MINUTE\",\n      label: \"每分钟\"\n    }, {\n      id: \"HOUR\",\n      label: \"每小时\"\n    }, {\n      id: \"DAY\",\n      label: \"每天\"\n    }, {\n      id: \"WEEK\",\n      label: \"每周\"\n    }, {\n      id: \"MONTH\",\n      label: \"每月\"\n      /**,{id:\"QUARTER\",label:\"每季度\"}*/\n\n    }, {\n      id: \"YEAR\",\n      label: \"每年\"\n    }];\n    var condition = [{\n      'label': '大于',\n      'id': 'GT'\n    }, {\n      'label': '大于等于',\n      'id': 'GE'\n    }, {\n      'label': '等于',\n      'id': 'EQ'\n    }, {\n      'label': '不等于',\n      'id': 'NE'\n    }, {\n      'label': '小于',\n      'id': 'LT'\n    }, {\n      'label': '小于等于',\n      'id': 'LE'\n    }, {\n      'label': 'js脚本',\n      'id': 'JS'\n    }];\n\n    var queryDomainTree = function queryDomainTree(callback) {\n      $$.cacheAsyncData.call(userDomainService.queryDomainTree, [userLoginUIService.user.userID], function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    var getModels = function getModels(callback) {\n      $$.cacheAsyncData.call(resourceUIService.getModels, [], function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    var getDirectivesByModelIdNotByRole = function getDirectivesByModelIdNotByRole(id, callback) {\n      $$.cacheAsyncData.call(resourceUIService.getDirectivesByModelIdNotByRole, [id], function (event) {\n        if (event.code == 0) {\n          event.data.forEach(function (item) {\n            item.label = item.name;\n          });\n          callback(event.data);\n        }\n      });\n    };\n\n    var getDevicesByCondition = function getDevicesByCondition(param, callback) {\n      $$.cacheAsyncData.call(resourceUIService.getDevicesByCondition, [param], function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    var getDataItemsByModelId = function getDataItemsByModelId(modelId, callback) {\n      $$.cacheAsyncData.call(resourceUIService.getDataItemsByModelId, [modelId], function (event) {\n        if (event.code == 0) {\n          var dataDic = {};\n          event.data.forEach(function (item) {\n            dataDic[item.id] = item;\n          });\n          /*if (!dataDic[0]) {\n            event.data.unshift({\n              label: '请选择',\n              name: '请选择',\n              id: 0\n            });\n          }*/\n\n          callback(event.data);\n        }\n      });\n    };\n\n    var getDirectiveStrategys = function getDirectiveStrategys(callback) {\n      $$.cacheAsyncData.call(directiveStrategyUIService.getDirectiveStrategys, [], function (event) {\n        if (event.code == 0) {\n          if (event.data == undefined || event.data == null) {\n            event.data = [];\n          }\n\n          callback(event.data);\n        }\n      });\n    };\n\n    var init = function init() {\n      queryDomainTree(function (dtree) {\n        var domaintree = {\n          nodes: dtree,\n          domainInfos: dtree\n        };\n        getModels(function (allModels) {\n          getDirectiveStrategys(function (allInstructAry) {\n            var editInstruc = function editInstruc(target) {\n              // getModels(function(obj) {\n              // var allModels = [{\n              //   id: 300,\n              //   label: \"管理域\"\n              // }, {\n              //   id: 301,\n              //   label: \"客户\"\n              // }, {\n              //   id: 302,\n              //   label: \"项目\"\n              // }].concat(obj);\n              // var allModels = obj;\n              var hours = function () {\n                var rs = [];\n\n                for (var i = 0; i < 24; i++) {\n                  rs.push({\n                    id: i,\n                    label: i\n                  });\n                }\n\n                return rs;\n              }();\n\n              var minutes = function () {\n                var rs = [];\n\n                for (var i = 0; i < 60; i++) {\n                  rs.push({\n                    id: i,\n                    label: i\n                  });\n                }\n\n                return rs;\n              }();\n\n              var days = function () {\n                var rs = [];\n\n                for (var i = 1; i < 32; i++) {\n                  rs.push({\n                    id: i,\n                    label: i\n                  });\n                }\n\n                return rs;\n              }();\n\n              var months = function () {\n                var rs = [];\n\n                for (var i = 1; i < 13; i++) {\n                  rs.push({\n                    id: i,\n                    label: i\n                  });\n                }\n\n                return rs;\n              }();\n\n              var weekdays = [{\n                id: 1,\n                label: \"一\"\n              }, {\n                id: 2,\n                label: \"二\"\n              }, {\n                id: 3,\n                label: \"三\"\n              }, {\n                id: 4,\n                label: \"四\"\n              }, {\n                id: 5,\n                label: \"五\"\n              }, {\n                id: 6,\n                label: \"六\"\n              }, {\n                id: 7,\n                label: \"日\"\n              }];\n              var KPIlIST = {\n                \"label\": \"KPI指标\",\n                \"value\": \"\",\n                \"right\": true,\n                \"data\": \"kpi\",\n                \"type\": \"select\",\n                \"composory\": false,\n                \"options\": [],\n                \"events\": {\n                  \"change\": function change(data) {}\n                }\n              };\n              var CONDITION = {\n                \"label\": \"条件\",\n                \"value\": \"\",\n                \"right\": true,\n                \"data\": \"condition\",\n                \"type\": \"select\",\n                \"composory\": false,\n                \"options\": condition,\n                \"events\": {\n                  \"change\": function change(data) {}\n                }\n              };\n              var varnamelist = allInstructAry.map(function (elem) {\n                return elem.name;\n              });\n              var deferList = [],\n                  deviceAry = [],\n                  directiveAry = [];\n              var TABLE = {\n                \"label\": \"\",\n                \"value\": 0,\n                \"apply\": true,\n                \"right\": true,\n                \"data\": \"thresholds\",\n                \"message\": '如若需要选择数据项，则条件和值都必须填写',\n                \"type\": \"table\",\n                \"composory\": false,\n                \"groups\": [{\n                  composory: true,\n                  value: 1,\n                  label: '配置项'\n                }, {\n                  composory: true,\n                  value: 2,\n                  label: '取值'\n                }, {\n                  composory: false,\n                  value: 3,\n                  label: '数据项'\n                }, {\n                  composory: false,\n                  value: 4,\n                  label: '条件'\n                }, {\n                  composory: false,\n                  value: 5,\n                  label: '值'\n                }],\n                \"options\": []\n              };\n\n              if (target) {\n                if (target.deviceModelId) {\n                  var modelId = target.deviceModelId;\n                  getDevicesByCondition({\n                    modelId: modelId ? modelId : '',\n                    domainPath: target.directiveDomainPath ? target.directiveDomainPath : ''\n                  }, function (devices) {\n                    deviceAry = devices;\n                  });\n                  getDirectivesByModelIdNotByRole(modelId, function (directive) {\n                    directiveAry = directive;\n                    getDataItemsByModelId(modelId, function (kpi) {\n                      KPIlIST.options = kpi;\n                      var targetCi = directiveAry.find(function (item) {\n                        return item.id == target.directiveId;\n                      }).params;\n\n                      if (targetCi) {\n                        TABLE.options = targetCi;\n                        TABLE.options.forEach(function (elem) {\n                          elem.inputs = [];\n                          elem.inputs = elem.inputs.concat([{\n                            \"label\": \"配置项\",\n                            \"text\": elem.label,\n                            \"right\": true,\n                            \"data\": \"value\",\n                            \"type\": \"text\",\n                            \"composory\": false\n                          }, {\n                            \"label\": \"取值\",\n                            \"value\": target.params.find(function (item) {\n                              return item.kpiId == elem.id;\n                            }).value,\n                            \"maxlength\": 12,\n                            \"right\": true,\n                            \"data\": \"value\",\n                            \"type\": \"input\",\n                            \"placeholder\": \"请填写取值\",\n                            \"composory\": false,\n                            \"events\": {\n                              \"change\": function change(data) {}\n                            }\n                          }, {\n                            \"label\": \"KPI指标\",\n                            \"value\": target.thresholds.find(function (item) {\n                              return item.targetKpiId == elem.id;\n                            }).kpiId,\n                            \"right\": true,\n                            \"data\": \"kpiId\",\n                            \"type\": \"select\",\n                            \"composory\": false,\n                            \"options\": KPIlIST.options,\n                            \"events\": {\n                              \"change\": function change(data) {// if (data.value > 0) {\n                                //   TABLE.groups.forEach(function(item) {\n                                //     item.composory = true;\n                                //   });\n                                // } else {\n                                //   TABLE.groups.forEach(function(item) {\n                                //     if (item.value > 2) {\n                                //       item.composory = false;\n                                //     } else {\n                                //       item.composory = true;\n                                //     }\n                                //   });\n                                // }\n                              }\n                            }\n                          }, {\n                            \"label\": \"条件\",\n                            \"value\": target.thresholds.find(function (item) {\n                              return item.targetKpiId == elem.id;\n                            }).compareType,\n                            \"right\": true,\n                            \"data\": \"compareType\",\n                            \"type\": \"select\",\n                            \"composory\": false,\n                            \"options\": condition,\n                            \"events\": {\n                              \"change\": function change(data) {}\n                            }\n                          }, {\n                            \"label\": \"阈值\",\n                            \"value\": target.thresholds.find(function (item) {\n                              return item.targetKpiId == elem.id;\n                            }).thresholdValue,\n                            \"right\": true,\n                            \"maxlength\": 12,\n                            \"data\": \"thresholdValue\",\n                            \"type\": \"input\",\n                            \"placeholder\": \"请填写内容\",\n                            \"composory\": false,\n                            \"events\": {\n                              \"change\": function change(data) {}\n                            }\n                          }]); // elem.inputs = elem.inputs.concat([KPIlIST, CONDITION]);\n                          // $.extend(elem.inputs, KPIlIST, CONDITION);\n                        });\n                      }\n\n                      start();\n                    });\n                  });\n                }\n              }\n\n              ;\n\n              function start() {\n                scope.$tabInx = 0;\n\n                scope.naviClick = function (id) {\n                  scope.$tabInx = id;\n                };\n\n                var CALMODE = {\n                  \"label\": \"计算方式\",\n                  \"value\": target && target.cron.indexOf('/') > -1 ? 'count' : \"assign\",\n                  \"right\": true,\n                  \"data\": \"calmode\",\n                  \"type\": \"select\",\n                  \"composory\": false,\n                  \"options\": [{\n                    id: 'assign',\n                    label: '指定方式'\n                  }, {\n                    id: 'count',\n                    label: '执行次数'\n                  }],\n                  \"events\": {\n                    \"change\": function change(data) {\n                      var value = data.value;\n                      var granular = GRANULARITYUNIT.value;\n                      console.log(value);\n                      console.log(granular);\n                      granularChange(granular, '', value);\n                    }\n                  }\n                };\n                var SECONDS = {\n                  \"label\": \"计算时间\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"right\": true,\n                  \"data\": \"second\",\n                  \"apply\": false,\n                  \"textAfter\": \"秒\",\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"options\": minutes,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var SECONDSCOUNT = {\n                  \"label\": \"计算时间\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"right\": true,\n                  \"data\": \"secondcount\",\n                  \"apply\": false,\n                  \"textAfter\": \"秒\",\n                  \"type\": \"select\",\n                  \"options\": minutes,\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var DAYS = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"right\": true,\n                  \"data\": \"day\",\n                  \"apply\": false,\n                  \"options\": days,\n                  \"textAfter\": \"日\",\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var DAYSCOUNT = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"right\": true,\n                  \"data\": \"daycount\",\n                  \"apply\": false,\n                  \"options\": days,\n                  \"textAfter\": \"日\",\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var MINUTES = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"apply\": false,\n                  \"right\": true,\n                  \"data\": \"minute\",\n                  \"options\": minutes,\n                  \"textBefore\": '',\n                  \"textAfter\": '分',\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var MINUTESCOUNT = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"apply\": false,\n                  \"right\": true,\n                  \"data\": \"minutecount\",\n                  \"options\": minutes,\n                  \"textBefore\": '',\n                  \"textAfter\": '分',\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var HOURS = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"apply\": true,\n                  \"right\": true,\n                  \"data\": \"hour\",\n                  \"textAfter\": \"点\",\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  options: hours,\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var HOURSCOUNT = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"apply\": true,\n                  \"right\": true,\n                  \"data\": \"hourcount\",\n                  \"textAfter\": \"点\",\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  options: hours,\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var WEEKDAYS = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"apply\": false,\n                  \"right\": true,\n                  \"data\": \"week\",\n                  \"textBefore\": \"星期\",\n                  \"options\": weekdays,\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var WEEKDAYSCOUNT = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"apply\": false,\n                  \"right\": true,\n                  \"data\": \"weekcount\",\n                  \"textBefore\": \"星期\",\n                  \"options\": weekdays,\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var MONTHS = {\n                  \"label\": \"开始计算\",\n                  \"apply\": false,\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"right\": true,\n                  \"data\": \"month\",\n                  \"textAfter\": \"月\",\n                  \"type\": \"select\",\n                  \"options\": months,\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var MONTHSCOUNT = {\n                  \"label\": \"开始计算\",\n                  \"apply\": false,\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"right\": true,\n                  \"data\": \"monthcount\",\n                  \"textAfter\": \"月\",\n                  \"type\": \"select\",\n                  \"options\": months,\n                  \"composory\": true,\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  },\n                  filterFormat: {\n                    \"label\": \"label\",\n                    \"value\": \"id\"\n                  }\n                };\n                var GRANULARITYUNIT = {\n                  \"label\": \"统计频率\",\n                  \"maxlength\": 12,\n                  \"value\": target ? target.frequency : granularityUnits[2].id,\n                  \"right\": true,\n                  \"data\": \"frequency\",\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"options\": granularityUnits,\n                  \"events\": {\n                    \"change\": function change(data) {\n                      var value = data.value;\n                      CALMODE.value = 'assign';\n\n                      if (data.value == \"\") {\n                        data.error = \"统计频率不可为空\";\n                        data.right = false;\n                      } else {\n                        data.error = undefined;\n                        data.right = true;\n                      }\n\n                      granularChange(value, '', 'assign');\n                    }\n                  }\n                };\n                var TIMESELECT = {\n                  \"label\": \"开始计算\",\n                  \"maxlength\": 12,\n                  \"value\": 0,\n                  \"apply\": true,\n                  \"right\": true,\n                  \"data\": \"cron\",\n                  \"type\": \"groupSelect\",\n                  \"composory\": true,\n                  \"groups\": [HOURS, MINUTES]\n                };\n                var INSTRUCNAME = {\n                  \"label\": \"指令策略名称\",\n                  \"maxlength\": 32,\n                  \"value\": target ? target.name : \"\",\n                  \"right\": target ? true : false,\n                  \"composory\": true,\n                  \"data\": \"name\",\n                  \"placeholder\": \"指令策略名称\",\n                  \"events\": {\n                    \"change\": function change(data) {\n                      if (data.value == \"\") {\n                        data.error = \"指令策略名称不可为空\";\n                        data.right = false;\n                      } else {\n                        if (varnamelist.indexOf(data.value) != -1) {\n                          data.error = \"指令策略名称已存在\";\n                          data.right = false;\n                        } else {\n                          data.error = undefined;\n                          data.right = true;\n                        }\n                      }\n                    }\n                  },\n                  \"type\": \"input\"\n                };\n                var DESCRIPTION = {\n                  \"label\": \"指令策略描述\",\n                  \"maxlength\": 200,\n                  \"value\": target ? target.description : \"\",\n                  \"right\": true,\n                  \"composory\": false,\n                  \"data\": \"description\",\n                  \"placeholder\": \"描述\",\n                  \"type\": \"textarea\"\n                };\n                var DOMAINPATH = {\n                  label: \"域路径\",\n                  value: target ? target.directiveDomainPath : \"\",\n                  right: target ? true : false,\n                  type: \"tree\",\n                  sortable: true,\n                  filterable: true,\n                  composory: true,\n                  data: \"directiveDomainPath\",\n                  key: \"domainPath\",\n                  mark: \"nodes\",\n                  options: domaintree,\n                  modes: {\n                    default: {\n                      type: \"text\"\n                    }\n                  },\n                  \"events\": {\n                    \"change\": function change(data) {\n                      if (data.value == \"\") {\n                        data.error = \"域路径不可为空\";\n                        data.right = false;\n                      } else {\n                        data.error = undefined;\n                        data.right = true;\n                        getDevicesByCondition({\n                          \"domainPath\": data.value,\n                          \"modelId\": scope.dialog.tabs[1].inputs[1].value ? scope.dialog.tabs[1].inputs[1].value : ''\n                        }, function (devices) {\n                          scope.dialog.tabs[1].inputs[3].options = devices;\n                        });\n                      }\n                    }\n                  }\n                };\n                var TARGETSOURCE = {\n                  \"label\": \"资源模板\",\n                  \"maxlength\": 12,\n                  \"value\": target ? target.deviceModelId : \"\",\n                  \"right\": target ? true : false,\n                  \"data\": \"deviceModelId\",\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"options\": allModels,\n                  \"events\": {\n                    \"change\": function change(data) {\n                      if (data.value) {\n                        var modelId = data.value;\n                        getDevicesByCondition({\n                          \"domainPath\": scope.dialog.tabs[1].inputs[0].value ? scope.dialog.tabs[1].inputs[0].value : '',\n                          \"modelId\": modelId\n                        }, function (devices) {\n                          scope.dialog.tabs[1].inputs[3].options = devices;\n                        });\n                        getDirectivesByModelIdNotByRole(modelId, function (directive) {\n                          scope.dialog.tabs[1].inputs[2].options = directive;\n                        });\n                        getDataItemsByModelId(modelId, function (kpi) {\n                          KPIlIST.options = kpi;\n                        });\n                        data.error = \"\";\n                        data.right = true;\n                      } else {\n                        data.error = \"资源模版不可为空\";\n                        data.right = false;\n                      }\n                    }\n                  }\n                };\n                var DEVICElIST = {\n                  \"label\": \"设备\",\n                  \"value\": target ? target.deviceIds : [],\n                  \"right\": true,\n                  \"data\": \"deviceIds\",\n                  \"type\": \"multiple\",\n                  \"composory\": false,\n                  \"options\": target && deviceAry ? deviceAry : [],\n                  \"events\": {\n                    \"change\": function change(data) {}\n                  }\n                };\n                var DIRECTIVELIST = {\n                  \"label\": \"指令\",\n                  \"value\": target ? target.directiveId : \"\",\n                  \"right\": target ? true : false,\n                  \"data\": \"directiveId\",\n                  \"type\": \"select\",\n                  \"composory\": true,\n                  \"options\": target && directiveAry.length > 0 ? directiveAry : [],\n                  \"events\": {\n                    \"change\": function change(data) {\n                      if (data.value) {\n                        var directiveList = scope.dialog.tabs[1].inputs[2].options;\n                        var ciList = directiveList.find(function (item) {\n                          return item.id == data.value;\n                        }).params;\n                        var ary = [];\n\n                        if (ciList) {\n                          scope.dialog.tabs[3].inputs[0].options = ciList;\n                          scope.dialog.tabs[3].inputs[0].options.forEach(function (elem) {\n                            elem.inputs = [];\n                            elem.inputs = elem.inputs.concat([{\n                              \"label\": \"配置项\",\n                              \"text\": elem.label,\n                              \"right\": true,\n                              \"data\": \"value\",\n                              \"type\": \"text\",\n                              \"composory\": false,\n                              \"events\": {\n                                \"change\": function change(data) {}\n                              }\n                            }, {\n                              \"label\": \"取值\",\n                              \"value\": elem.data,\n                              \"maxlength\": 12,\n                              \"right\": false,\n                              \"data\": \"value\",\n                              \"type\": \"input\",\n                              \"placeholder\": \"请填写取值\",\n                              \"composory\": false,\n                              \"events\": {\n                                \"change\": function change(data) {\n                                  if (data.value == \"\") {\n                                    data.error = \"取值不可为空\";\n                                    data.right = false;\n                                  } else {\n                                    data.error = undefined;\n                                    data.right = true;\n                                  }\n                                }\n                              }\n                            }, {\n                              \"label\": \"KPI指标\",\n                              \"value\": elem.kpiId == 'undefined' ? \"请选择kpi指标\" : elem.kpiId,\n                              \"right\": true,\n                              \"data\": \"kpiId\",\n                              \"type\": \"select\",\n                              \"composory\": false,\n                              \"options\": KPIlIST.options,\n                              \"events\": {\n                                \"change\": function change(data) {}\n                              }\n                            }, {\n                              \"label\": \"条件\",\n                              \"value\": elem.condition == 'undefined' ? \"请选择条件\" : elem.condition,\n                              \"right\": true,\n                              \"data\": \"compareType\",\n                              \"type\": \"select\",\n                              \"composory\": false,\n                              \"options\": condition,\n                              \"events\": {\n                                \"change\": function change(data) {}\n                              }\n                            }, {\n                              \"label\": \"阈值\",\n                              \"value\": elem.value,\n                              \"right\": true,\n                              \"maxlength\": 12,\n                              \"data\": \"thresholdValue\",\n                              \"type\": \"input\",\n                              \"placeholder\": \"请填写阈值\",\n                              \"composory\": false,\n                              \"events\": {\n                                \"change\": function change(data) {}\n                              }\n                            }]); // elem.inputs = elem.inputs.concat([KPIlIST, CONDITION]);\n                            // $.extend(elem.inputs, KPIlIST, CONDITION);\n                          });\n                        }\n\n                        data.error = undefined;\n                        data.right = true;\n                      } else {\n                        data.error = \"指令不可为空\";\n                        data.right = false;\n                      }\n                    }\n                  }\n                };\n\n                var granularChange = function granularChange(granular, values, type) {\n                  if (granular == \"MINUTE\" || granular == \"MINUTECOUNT\") {\n                    TIMESELECT.apply = true;\n\n                    if (values) {\n                      SECONDS.value = values[0];\n                    } else {\n                      SECONDS.value = 0;\n                    }\n\n                    SECONDSCOUNT.value = type == 'count' ? values[1] : 0;\n\n                    if (type == 'assign') {\n                      SECONDS.textBefore = '';\n                      SECONDS.textAfter = '秒';\n                      TIMESELECT.groups = [SECONDS];\n                    } else if (type == 'count') {\n                      SECONDS.textBefore = '从';\n                      SECONDS.textAfter = '秒开始';\n                      SECONDSCOUNT.textBefore = '每';\n                      SECONDSCOUNT.textAfter = '秒，执行一次';\n                      TIMESELECT.groups = [SECONDS, SECONDSCOUNT];\n                    }\n                  } else if (granular == \"HOUR\" || granular == \"HOURCOUNT\") {\n                    TIMESELECT.apply = true;\n\n                    if (type == 'assign') {\n                      if (values) {\n                        SECONDS.value = values[0];\n                        MINUTES.value = values[1];\n                      } else {\n                        SECONDS.value = 0;\n                        MINUTES.value = 0;\n                      }\n\n                      MINUTES.textBefore = '';\n                      MINUTES.textAfter = '分';\n                      SECONDS.textBefore = '';\n                      SECONDS.textAfter = '秒';\n                      TIMESELECT.groups = [MINUTES, SECONDS];\n                    } else if (type == 'count') {\n                      if (values) {\n                        SECONDS.value = values[0];\n                        MINUTESCOUNT.value = values[2];\n                        MINUTES.value = values[1];\n                      } else {\n                        SECONDS.value = 0;\n                        MINUTESCOUNT.value = 0;\n                        MINUTES.value = 0;\n                      }\n\n                      MINUTES.textBefore = '从';\n                      MINUTES.textAfter = '分开始';\n                      MINUTESCOUNT.textBefore = '每';\n                      MINUTESCOUNT.textAfter = '分执行一次';\n                      SECONDS.textBefore = '';\n                      SECONDS.textAfter = '秒';\n                      TIMESELECT.groups = [MINUTES, MINUTESCOUNT, SECONDS];\n                    }\n                  } else if (granular == \"DAY\" || granular == \"DAYCOUNT\") {\n                    TIMESELECT.apply = true;\n\n                    if (type == 'assign') {\n                      if (values) {\n                        MINUTES.value = values[0];\n                        HOURS.value = values[1];\n                      } else {\n                        MINUTES.value = 0;\n                        HOURS.value = 0;\n                      }\n\n                      HOURS.textBefore = '';\n                      HOURS.textAfter = '时';\n                      MINUTES.textBefore = '';\n                      MINUTES.textAfter = '分';\n                      TIMESELECT.groups = [HOURS, MINUTES];\n                    } else if (type == 'count') {\n                      if (values) {\n                        MINUTES.value = values[0];\n                        HOURSCOUNT.value = values[2];\n                        HOURS.value = values[1];\n                      } else {\n                        MINUTES.value = 0;\n                        HOURSCOUNT.value = 0;\n                        HOURS.value = 0;\n                      }\n\n                      HOURS.textBefore = '从';\n                      HOURS.textAfter = '时开始';\n                      HOURSCOUNT.textBefore = '每';\n                      HOURSCOUNT.textAfter = '时执行一次';\n                      MINUTES.textBefore = '';\n                      MINUTES.textAfter = '分';\n                      TIMESELECT.groups = [HOURS, HOURSCOUNT, MINUTES];\n                    }\n                  } else if (granular == \"WEEK\") {\n                    if (values) {\n                      HOURS.value = values[0];\n                      WEEKDAYS.value = values[1];\n                    } else {\n                      HOURS.value = 0;\n                      WEEKDAYS.value = 1;\n                    }\n\n                    if (type == 'assign') {\n                      TIMESELECT.apply = true;\n                      WEEKDAYS.textBefore = '星期';\n                      WEEKDAYS.textAfter = '';\n                      HOURS.textBefore = '';\n                      HOURS.textAfter = '点';\n                      TIMESELECT.groups = [WEEKDAYS, HOURS];\n                    } else if (type == 'count') {\n                      TIMESELECT.apply = false; // WEEKDAYS.textBefore = '从星期';\n                      // WEEKDAYS.textAfter = '开始';\n                      // WEEKDAYSCOUNT.textBefore = '每';\n                      // WEEKDAYSCOUNT.textAfter = '星期执行一次';\n                      // HOURS.textBefore = '';\n                      // HOURS.textAfter = '点';\n                      // TIMESELECT.groups = [WEEKDAYS, WEEKDAYSCOUNT, HOURS];\n                    }\n                  } else if (granular == \"MONTH\" || granular == \"MONTHCOUNT\") {\n                    TIMESELECT.apply = true;\n\n                    if (type == 'assign') {\n                      if (values) {\n                        HOURS.value = values[0];\n                        DAYS.value = values[1];\n                      } else {\n                        HOURS.value = 0;\n                        DAYS.value = 1;\n                      }\n\n                      DAYS.textBefore = '';\n                      DAYS.textAfter = '日';\n                      HOURS.textBefore = '';\n                      HOURS.textAfter = '点';\n                      TIMESELECT.groups = [DAYS, HOURS];\n                    } else if (type == 'count') {\n                      if (values) {\n                        HOURS.value = values[0];\n                        DAYSCOUNT.value = values[2];\n                        DAYS.value = values[1];\n                      } else {\n                        HOURS.value = 0;\n                        DAYSCOUNT.value = 1;\n                        DAYS.value = 1;\n                      }\n\n                      DAYS.textBefore = '从';\n                      DAYS.textAfter = '日开始';\n                      DAYSCOUNT.textBefore = '每';\n                      DAYSCOUNT.textAfter = '日执行一次';\n                      HOURS.textBefore = '';\n                      HOURS.textAfter = '点';\n                      TIMESELECT.groups = [DAYS, DAYSCOUNT, HOURS];\n                    }\n                  } else if (granular == \"YEAR\") {\n                    if (values) {\n                      DAYS.value = values[0];\n                      MONTHS.value = values[1];\n                    } else {\n                      DAYS.value = 1;\n                      MONTHS.value = 1;\n                    }\n\n                    if (type == 'assign') {\n                      TIMESELECT.apply = true;\n                      MONTHS.textBefore = '';\n                      MONTHS.textAfter = '月';\n                      DAYS.textBefore = '';\n                      DAYS.textAfter = '日';\n                      TIMESELECT.groups = [MONTHS, DAYS];\n                    } else if (type == 'count') {\n                      TIMESELECT.apply = false; // MONTHS.textBefore = '从';\n                      // MONTHS.textAfter = '月开始';\n                      // MONTHSCOUNT.textBefore = '每';\n                      // MONTHSCOUNT.textAfter = '月执行一次';\n                      // DAYS.textBefore = '';\n                      // DAYS.textAfter = '日';\n                      // TIMESELECT.groups = [MONTHS, MONTHSCOUNT, DAYS];\n                    }\n                  }\n                };\n\n                var cronToTime = function cronToTime(data, type) {\n                  var regExps = [{\n                    name: \"MINUTECOUNT\",\n                    regExp: /(\\d+)\\/(\\d+)\\ \\*\\ \\*\\ \\*\\ \\*\\ \\?\\ \\*/\n                  }, {\n                    name: \"MINUTE\",\n                    regExp: /(\\d+)\\ \\*\\ \\*\\ \\*\\ \\*\\ \\?\\ \\*/\n                  }, {\n                    name: \"HOURCOUNT\",\n                    regExp: /(\\d+)\\ (\\d+)\\/(\\d+)\\ \\*\\ \\*\\ \\*\\ \\?\\ \\*/\n                  }, {\n                    name: \"HOUR\",\n                    regExp: /(\\d+)\\ (\\d+)\\ \\*\\ \\*\\ \\*\\ \\?\\ \\*/\n                  }, {\n                    name: \"DAYCOUNT\",\n                    regExp: /0\\ (\\d+)\\ (\\d+)\\/(\\d+)\\ \\*\\ \\*\\ \\?\\ \\*/\n                  }, {\n                    name: \"DAY\",\n                    regExp: /0\\ (\\d+)\\ (\\d+)\\ \\*\\ \\*\\ \\?\\ \\*/\n                  }, {\n                    name: \"MONTHCOUNT\",\n                    regExp: /0\\ 0\\ (\\d+)\\ (\\d+)\\/(\\d+)\\ \\*\\ \\?\\ \\*/\n                  }, {\n                    name: \"MONTH\",\n                    regExp: /0\\ 0\\ (\\d+)\\ (\\d+)\\ \\*\\ \\?\\ \\*/\n                  }, {\n                    name: \"YEAR\",\n                    regExp: /0\\ 0\\ 0\\ (\\d+)\\ (\\d+)\\ \\?\\ \\*/\n                  }, {\n                    name: \"WEEK\",\n                    regExp: /0\\ 0\\ (\\d+)\\ \\?\\ \\*\\ (\\d+)\\ \\*/\n                  }];\n                  var find = regExps.find(function (elem) {\n                    var regExp = elem.regExp;\n                    var rs = regExp.test(data);\n                    return rs;\n                  });\n\n                  if (find) {\n                    var rs = [];\n\n                    if (type == 'assign') {\n                      for (var i = 1; i < 3; i++) {\n                        var dt = $$.runRegExp(data, find.regExp, i);\n\n                        if (dt) {\n                          rs.push(parseInt(dt));\n                        }\n                      }\n\n                      ;\n                    } else if (type == 'count') {\n                      for (var i = 1; i < 4; i++) {\n                        var dt = $$.runRegExp(data, find.regExp, i);\n\n                        if (dt) {\n                          rs.push(parseInt(dt));\n                        }\n                      }\n                    }\n\n                    return {\n                      granular: find.name,\n                      type: type,\n                      data: rs\n                    };\n                  } else {\n                    return null;\n                  }\n\n                  ;\n                };\n\n                if (target) {\n                  var cronVal = target.cron.indexOf('/') > -1 ? 'count' : 'assign';\n                  var granularObj = cronToTime(target.cron, cronVal);\n                  console.log(granularObj);\n\n                  if (granularObj) {\n                    granularChange(granularObj.granular, granularObj.data, granularObj.type);\n                  } else {\n                    granularChange(\"DAY\", '', 'assign');\n                  }\n                } else {\n                  granularChange(\"DAY\", '', 'assign');\n                }\n\n                scope.dialog = {\n                  title: '指令策略',\n                  note: '',\n                  tabs: [{\n                    id: 0,\n                    label: '基础信息',\n                    inputs: [INSTRUCNAME, DESCRIPTION]\n                  }, {\n                    id: 1,\n                    label: '资源配置',\n                    inputs: [DOMAINPATH, TARGETSOURCE, DIRECTIVELIST, DEVICElIST]\n                  }, {\n                    id: 2,\n                    label: \"定时策略\",\n                    inputs: [GRANULARITYUNIT, CALMODE, TIMESELECT]\n                  }, {\n                    id: 3,\n                    label: \"指令参数\",\n                    inputs: [TABLE]\n                  }],\n                  button: [{\n                    label: TEXT.SUBMIT,\n                    icon: \"btn btn-primary\",\n                    disabledFn: function disabledFn() {\n                      var rs = [];\n\n                      for (var i in scope.dialog.tabs) {\n                        rs = rs.concat(scope.dialog.tabs[i].inputs);\n                      }\n\n                      ;\n                      var some = rs.some(function (elem) {\n                        return elem.right == false;\n                      });\n\n                      if (scope.dialog.tabs[3].inputs[0].options.length > 0) {\n                        var opt = scope.dialog.tabs[3].inputs[0].options;\n\n                        for (var p in opt) {\n                          var inp = opt[p].inputs;\n\n                          for (var n in inp) {\n                            if (inp[n].label == '取值' && !inp[n].value && inp[n].value == undefined) {\n                              return true;\n                            }\n                          }\n                        }\n                      }\n\n                      return some;\n                    },\n                    fn: function fn() {\n                      var self = scope.dialog;\n                      var inputs = [];\n                      var newVar = {\n                        \"kpiDefinitionIds\": [],\n                        \"thresholds\": [],\n                        \"params\": []\n                      };\n\n                      for (var i in self.tabs) {\n                        inputs = inputs.concat(self.tabs[i].inputs);\n                      }\n\n                      ;\n\n                      var timeToCron = function timeToCron(data, type) {\n                        console.log(data);\n                        var rs = \"\";\n                        var arr = ['second', 'minute', 'hour', 'day', 'month', 'week', 'year'];\n                        var arrcount = ['second', 'secondcount', 'minute', 'minutecount', 'hour', 'hourcount', 'day', 'daycount', 'month', 'month', 'week', 'weekcount', 'year', 'yearcount'];\n                        arrcount = ['secondcount', 'minutecount', 'hourcount', 'daycount', 'monthcount', 'weekcount', 'yearcount'];\n                        var fd = data.find(function (elem) {\n                          return elem.data == 'week' || elem.data == 'day';\n                        });\n                        var weekOrDay = 'week';\n\n                        if (fd) {\n                          if (fd.data == 'week') {\n                            weekOrDay = 'day';\n                          } else {\n                            weekOrDay = 'week';\n                          }\n\n                          ;\n                        }\n\n                        ;\n\n                        var calcExp = function calcExp(item) {\n                          var find = data.find(function (elem) {\n                            return elem.data == item;\n                          });\n\n                          if (find) {\n                            return find.value;\n                          } else {\n                            return undefined;\n                          }\n\n                          ;\n                        };\n\n                        var inx = 0;\n                        var findVal = false;\n\n                        var repeat = function repeat(index) {\n                          var result = calcExp(arr[index]);\n\n                          if (result != undefined) {\n                            findVal = true;\n                            rs += result;\n                          } else {\n                            if (findVal == true) {\n                              if (arr[index] == weekOrDay) {\n                                rs += \"?\";\n                              } else {\n                                rs += \"*\";\n                              }\n\n                              ;\n                            } else {\n                              rs += \"0\";\n                            }\n                          }\n\n                          index++;\n\n                          if (arr[index]) {\n                            rs += \" \";\n                            repeat(index);\n                          }\n\n                          ;\n                        };\n\n                        var repeatcount = function repeatcount(index) {\n                          var result = calcExp(arr[index]);\n\n                          if (result != undefined) {\n                            findVal = true;\n                            rs += result;\n                          } else {\n                            if (findVal == true) {\n                              if (arr[index] == weekOrDay) {\n                                rs += \"?\";\n                              } else {\n                                rs += \"*\";\n                              }\n                            } else {\n                              rs += \"0\";\n                            }\n                          }\n                          /* if (index == 0) {\n                             index++;\n                           } else {\n                             index = index + 1;\n                           }*/\n\n\n                          var judgeValue = calcExp(arrcount[index]); //次数值 \n\n                          /* if (index > 1) {\n                             index--;\n                           }*/\n\n                          if (judgeValue) {\n                            //次数有值\n                            rs += '/' + judgeValue + ' ';\n                          } else {\n                            rs += ' ';\n                          }\n\n                          index++;\n\n                          if (arr[index]) {\n                            repeatcount(index);\n                          }\n                        };\n\n                        if (type.value == 'assign') {\n                          repeat(inx);\n                        } else if (type.value == 'count') {\n                          repeatcount(inx);\n                        }\n\n                        console.log(rs);\n                        return rs;\n                      };\n\n                      var judgeAlarm = function judgeAlarm(obj) {\n                        for (var i in obj.params) {\n                          var val = obj.params[i];\n\n                          if (!val.value) {\n                            growl.warning('请输入完整配置项的取值');\n                            return false;\n                          }\n                        }\n\n                        for (var i in obj.thresholds) {\n                          var val = obj.thresholds[i];\n\n                          if (val.kpiId) {\n                            if (!val.compareType) {\n                              growl.warning('请选择数据项的条件');\n                              return false;\n                            } else if (!val.thresholdValue) {\n                              growl.warning('请输入完整数据项的值');\n                              return false;\n                            }\n                          } else if (val.compareType || val.thresholdValue) {\n                            growl.warning('请选择数据项');\n                            return false;\n                          }\n                        }\n\n                        return true;\n                      };\n\n                      if (target) {\n                        target.kpiDefinitionIds = [];\n                        target.thresholds = [];\n                        target.params = [];\n                        /* var type = {\n                           'value': ''\n                         };*/\n\n                        var type = inputs.find(function (item) {\n                          return item.data == 'calmode';\n                        });\n\n                        var loop = function loop(elem) {\n                          if (typeof elem.value != \"function\" && elem.calculable != false && elem.data != \"\") {\n                            if (elem.type == \"groupSelect\") {\n                              /*if (target.cron.indexOf('/') > -1) {\n                                type.value = 'count';\n                              } else {\n                                type.value = 'assign';\n                              }*/\n                              target[elem.data] = timeToCron(elem.groups, type);\n                            } else if (elem.type == \"table\") {\n                              elem.options.forEach(function (item) {\n                                target.kpiDefinitionIds.push(item.id);\n                                target.thresholds.push({\n                                  \"targetKpiId\": item.id,\n                                  \"kpiId\": item.inputs[2].value,\n                                  \"compareType\": item.inputs[3].value,\n                                  \"thresholdValue\": item.inputs[4].value\n                                });\n                                target.params.push({\n                                  \"kpiId\": item.id,\n                                  \"name\": item.name,\n                                  \"value\": item.inputs[1].value\n                                });\n                              });\n                            } else {\n                              target[elem.data] = elem.value;\n                            }\n                          }\n\n                          ;\n                        };\n\n                        for (var i in inputs) {\n                          loop(inputs[i]);\n                        }\n\n                        ;\n\n                        if (!judgeAlarm(target)) {\n                          return;\n                        }\n\n                        ;\n                        directiveStrategyUIService.updateDirectiveStrategys(target, function (event) {\n                          if (event.code == \"0\") {\n                            growl.success(\"指令策略修改完成\");\n                            ngDialog.close();\n                          }\n\n                          ;\n                        });\n                      } else {\n                        var type = inputs.find(function (item) {\n                          return item.data == 'calmode';\n                        });\n\n                        var loop = function loop(elem) {\n                          if (typeof elem.value != \"function\" && elem.calculable != false && elem.data != \"\") {\n                            if (elem.type == \"groupSelect\") {\n                              newVar[elem.data] = timeToCron(elem.groups, type);\n                            } else if (elem.type == \"table\") {\n                              console.log(elem);\n                              elem.options.forEach(function (item) {\n                                newVar.kpiDefinitionIds.push(item.id);\n                                newVar.thresholds.push({\n                                  \"targetKpiId\": item.id,\n                                  \"kpiId\": item.inputs[2].value,\n                                  \"compareType\": item.inputs[3].value,\n                                  \"thresholdValue\": item.inputs[4].value\n                                });\n                                newVar.params.push({\n                                  \"kpiId\": item.id,\n                                  \"name\": item.name,\n                                  \"value\": item.inputs[1].value\n                                });\n                              });\n                            } else {\n                              newVar[elem.data] = elem.value;\n                            }\n                          }\n\n                          ;\n                        };\n\n                        for (var i in inputs) {\n                          loop(inputs[i]);\n                        }\n\n                        ;\n\n                        if (!judgeAlarm(newVar)) {\n                          return;\n                        }\n\n                        ;\n                        directiveStrategyUIService.addDirectiveStrategys(newVar, function (event) {\n                          if (event.code == \"0\") {\n                            allInstructAry.pushbefore(event.data);\n                            growl.success(\"指令策略添加完成\");\n                            ngDialog.close();\n                          }\n\n                          ;\n                        });\n                      }\n                    }\n                  }, {\n                    label: TEXT.CANCEL,\n                    icon: \"btn btn-default\",\n                    fn: function fn() {\n                      ngDialog.close();\n                    }\n                  }]\n                };\n              }\n\n              ;\n\n              if (!target) {\n                start();\n              } // });\n\n\n              ngDialog.open({\n                template: '../partials/dialogue/config_alert_dia2.html',\n                className: 'ngdialog-theme-plain',\n                scope: scope\n              });\n            };\n\n            var addNewClick = function addNewClick() {\n              editInstruc();\n            };\n\n            var editClick = function editClick(target) {\n              editInstruc(target);\n            };\n\n            var deleteInstruc = function deleteInstruc(param, callback) {\n              var fnlist = [{\n                label: TEXT.SUBMIT,\n                icon: 'btn btn-success',\n                style: {\n                  width: '50%',\n                  'border-radius': 0,\n                  'font-size': '18px',\n                  'font-weight': 'bold',\n                  'padding': 10\n                },\n                fn: function fn() {\n                  ngDialog.close();\n                  directiveStrategyUIService.deleteDirectiveStrategy(param, function (event) {\n                    callback(event);\n                  });\n                }\n              }, {\n                label: TEXT.CANCEL,\n                icon: 'btn btn-default',\n                style: {\n                  width: '50%',\n                  'border-radius': 0,\n                  'font-size': '18px',\n                  'font-weight': 'bold',\n                  'padding': 10\n                },\n                fn: function fn() {\n                  ngDialog.close();\n                }\n              }];\n              scope.dialog = {\n                title: {\n                  label: '提示'\n                },\n                description: {\n                  label: '确认要删除此指令策略吗？'\n                },\n                fnlist: fnlist\n              };\n              ngDialog.open({\n                template: '../partials/dialogue/common_dia_prompt.html',\n                className: 'ngdialog-theme-plain',\n                scope: scope\n              });\n            };\n\n            var deleteClick = function deleteClick(target) {\n              deleteInstruc(target.id, function (event) {\n                if (event.code == 0) {\n                  growl.success(\"删除指令策略成功！\");\n                  target.remove();\n                }\n              });\n            };\n\n            var gotoClick = function gotoClick(target) {\n              // window.open(\"../app-oc/index.html#/instructionStrategy/\" + target.id, \"_blank\");\n              location.href = '../app-oc/index.html#/instructionStrategy/' + target.id;\n            };\n\n            var strHeader = {};\n            var strEdit = {};\n            var strDel = {};\n            var optList = [];\n\n            if (scope.menuitems['A01_S34']) {\n              strHeader = {\n                icon: \"fa fa-plus\",\n                class: \"btn btn-primary btn-sm\",\n                label: \"添加指令策略\",\n                style: {\n                  margin: \"2px\"\n                },\n                type: \"button\",\n                events: {\n                  click: addNewClick\n                }\n              };\n            }\n\n            if (scope.menuitems['A02_S34']) {\n              strEdit = {\n                class: \"btn btn-primary\",\n                label: \"编辑\",\n                type: \"button\",\n                events: {\n                  click: editClick\n                }\n              };\n              optList.push(strEdit);\n            }\n\n            if (scope.menuitems['A03_S34']) {\n              strDel = {\n                class: \"btn btn-default\",\n                label: \"删除\",\n                type: \"button\",\n                events: {\n                  click: deleteClick\n                }\n              };\n              optList.push(strDel);\n            }\n\n            if (scope.menuitems['A04_S34']) {\n              strDel = {\n                class: \"btn btn-default\",\n                label: \"详情\",\n                type: \"button\",\n                events: {\n                  click: gotoClick\n                }\n              };\n              optList.push(strDel);\n            }\n\n            scope.instructions = {\n              source: allInstructAry,\n              showSelector: false,\n              header: [strHeader],\n              columnDefs: [{\n                label: \"标识\",\n                width: \"10%\",\n                editable: true,\n                sortable: true,\n                filterable: true,\n                data: \"id\",\n                type: \"text\",\n                modes: {\n                  default: {\n                    type: \"text\"\n                  },\n                  edit: {\n                    type: \"input\",\n                    placeholder: \"\"\n                  }\n                }\n              }, {\n                label: \"名称\",\n                width: \"20%\",\n                editable: true,\n                sortable: true,\n                filterable: true,\n                data: \"name\",\n                type: \"text\",\n                modes: {\n                  default: {\n                    type: \"text\"\n                  },\n                  edit: {\n                    type: \"input\",\n                    placeholder: \"\"\n                  }\n                }\n              }, {\n                \"label\": \"设备模板\",\n                width: \"10%\",\n                editable: true,\n                sortable: true,\n                filterable: true,\n                data: \"deviceModelId\",\n                type: \"select\",\n                options: allModels,\n                filterFormat: {\n                  \"label\": \"label\",\n                  \"value\": \"id\"\n                },\n                format: function format(value, row) {\n                  if (row) {\n                    return allModels.find(function (item) {\n                      return item.id == value;\n                    }).label;\n                  } else {\n                    return '-';\n                  }\n                },\n                modes: {\n                  default: {\n                    type: \"text\"\n                  },\n                  edit: {\n                    type: \"input\",\n                    placeholder: \"\"\n                  }\n                }\n              }, {\n                label: \"创建时间\",\n                data: \"createTime\",\n                type: \"date\",\n                format: \"yy-mm-dd hh:nn:ss\",\n                filterable: false,\n                sortable: true,\n                modes: {\n                  default: {\n                    type: \"date\"\n                  }\n                }\n              }, {\n                label: \"计算频率\",\n                width: \"auto\",\n                editable: true,\n                sortable: true,\n                filterable: true,\n                data: \"frequency\",\n                type: \"select\",\n                options: granularityUnits,\n                filterFormat: {\n                  \"label\": \"label\",\n                  \"value\": \"id\"\n                },\n                format: function format(value, row) {\n                  if (row) {\n                    return granularityUnits.find(function (item) {\n                      return item.id == value;\n                    }).label;\n                  } else {\n                    return '-';\n                  }\n                },\n                modes: {\n                  default: {\n                    type: \"text\"\n                  },\n                  edit: {\n                    type: \"input\",\n                    placeholder: \"\"\n                  }\n                }\n              }, {\n                label: \"操作\",\n                type: \"buttonGroup\",\n                filterable: false,\n                sortable: false,\n                width: \"141px\",\n                modes: {\n                  default: {\n                    options: optList\n                  }\n                }\n              }]\n            };\n          });\n        });\n      });\n    };\n\n    var init2 = function init2(instrId) {\n      scope.pipeline = function (opts) {\n        // Configuration options\n        var conf = $.extend({\n          pages: 1,\n          // number of pages to cache\n          url: '',\n          // script url\n          data: null,\n          // function or object with parameters to send to the server\n          // matching how `ajax.data` works in DataTables\n          method: 'POST' // Ajax HTTP method\n\n        }, opts); // Private variables for storing the cache\n\n        var cacheLower = -1;\n        var cacheUpper = null;\n        var cacheLastRequest = null;\n        var cacheLastJson = null;\n        return function (request, drawCallback, settings) {\n          var ajax = false;\n          var requestStart = request.start;\n          var drawStart = request.start;\n          var requestLength = request.length;\n          var requestEnd = requestStart + requestLength;\n          var sort = request.columns[request.order[0].column].data; //排序字段\n\n          var sortType = request.order[0].dir; //排序方式\n\n          if (settings.clearCache) {\n            // API requested that the cache be cleared\n            ajax = true;\n            settings.clearCache = false;\n          } else if (cacheLower < 0 || requestStart < cacheLower || requestEnd > cacheUpper) {\n            // outside cached data - need to make a request\n            ajax = true;\n          } else if (JSON.stringify(request.order) !== JSON.stringify(cacheLastRequest.order) || JSON.stringify(request.columns) !== JSON.stringify(cacheLastRequest.columns) || JSON.stringify(request.search) !== JSON.stringify(cacheLastRequest.search)) {\n            // properties changed (ordering, columns, searching)\n            ajax = true;\n          } // Store the request for checking next time around\n\n\n          cacheLastRequest = $.extend(true, {}, request);\n\n          if (ajax) {\n            // Need data from the server\n            if (requestStart < cacheLower) {\n              requestStart = requestStart - requestLength * (conf.pages - 1);\n\n              if (requestStart < 0) {\n                requestStart = 0;\n              }\n            }\n\n            cacheLower = requestStart;\n            cacheUpper = requestStart + requestLength * conf.pages;\n            request.start = requestStart;\n            request.length = requestLength * conf.pages; // Provide the same `data` options as DataTables.\n\n            if ($.isFunction(conf.data)) {\n              // As a function it is executed with the data object as an arg\n              // for manipulation. If an object is returned, it is used as the\n              // data object to submit\n              var d = conf.data(request);\n\n              if (d) {\n                $.extend(request, d);\n              }\n            } else if ($.isPlainObject(conf.data)) {\n              // As an object, the data given extends the default\n              $.extend(request, conf.data);\n            }\n\n            var pageRequest = {\n              start: request.start,\n              length: request.length,\n              sort: sort,\n              sortType: sortType,\n              statCount: request.draw == 1\n            };\n            scope.getHistoryByPage(scope.queryList, pageRequest, function (returnObj, total) {\n              var json = {};\n              json.data = returnObj;\n              json.draw = request.draw; // Update the echo for each response\n\n              json.recordsTotal = total != undefined ? total == -1 ? cacheLastJson.recordsTotal : total : returnObj.length;\n              json.recordsFiltered = json.recordsTotal;\n              cacheLastJson = $.extend(true, {}, json);\n\n              if (cacheLower != drawStart) {\n                json.data.splice(0, drawStart - cacheLower);\n              }\n\n              if (requestLength >= -1) {\n                json.data.splice(requestLength, json.data.length);\n              }\n\n              drawCallback(json);\n            });\n          } else {\n            var json = $.extend(true, {}, cacheLastJson);\n            json.draw = request.draw; // Update the echo for each response\n\n            json.data.splice(0, requestStart - cacheLower);\n            json.data.splice(requestLength, json.data.length);\n            drawCallback(json);\n          }\n        };\n      };\n\n      scope.getHistoryByPage = function (queryItem, pageRequest, callback) {\n        directiveStrategyUIService.getDirectiveStrategyHistory([queryItem[0], queryItem[1], pageRequest], function (returnObj) {\n          if (returnObj.code == 0) {\n            if (callback) {\n              callback(returnObj.data.data, returnObj.data.total);\n            }\n          }\n        });\n      };\n\n      scope.goSearch = function (obj) {\n        scope.queryList = [instrId, obj.way];\n        $timeout(function () {\n          scope.$broadcast(Event.ENTERPRISEINIT + \"_history\", {\n            \"option\": []\n          });\n        });\n      };\n\n      if (instrId) {\n        scope.goSearch({\n          way: ''\n        });\n      }\n    };\n    /**\n     * 监听登录状态\n     */\n\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          if ($routeParams.instrId) {\n            init2($routeParams.instrId);\n          } else {\n            init();\n          }\n        }\n      });\n    } else {\n      if ($routeParams.instrId) {\n        init2($routeParams.instrId);\n      } else {\n        init();\n      }\n    }\n  }]);\n});"],"sourceRoot":"/source/"}