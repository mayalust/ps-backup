{"version":3,"sources":["app-oc/js/controllers/sparepart-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","ngDialog","$location","$routeParams","$timeout","sparePartUIService","userEnterpriseService","userLoginUIService","Info","growl","selecteditem","spareInfoList","allSpareInfos","editStatus","ifRouteParams","queryState","addSpareInfo","i","id","isEdit","warning","push","name","unit","model","label","desc","originalNumber","upperLimit","lowerLimit","item","newObjAry","obj","newObj","jQuery","extend","$broadcast","Event","SPAREINFOINIT","option","getSpareInfoList","doActionInfo","type","select","callback","param","saveSparePart","returnObj","code","success","getAllSpareParts","show","title","closable","message","buttons","cssClass","action","dialogRef","deleteSparePart","close","SpareName","getStockOrderBySpareId","getStockOrderItemsBySparePartId","arr","data","handlerPerson","stockOder","createTime","category","sparePartNumber","spareInfos","getSpares","spareinfoId","getSparePartById","isArray","info","getEvent","spareInLists","$parent","selectedSparecalInList","ifSubmitIn","selectedConItem","selected","sparePartId","stockOrderId","relatedDeviceList","$on","getInStockOrders","getStockOrderItemsById","INSPARECLAUSESINIT","addspareIn","unshift","SPAREININIT","getcontectList","doActionIns","length","splice","saveInStockOrder","k","deleteStockOrder","selSpareName","commit","doActionIn","saveStockOrderItem","deleteStockOrderItem","addInSpareClauseItem","sparePartName","getSpareCalList","submitInCaluses","selectedId","commitStockOrder","flg","spareInId","getInStockOrdersByhandlerId","getAllInStockOrders","spareOutLists","selectedSparecalOutList","ifSubmitOut","getOutStockOrders","OUTSPARECLAUSESINIT","addspareOut","SPAREOUTINIT","doAction","saveOutStockOrder","doActionOut","addOutSpareClauseItem","submitOutCaluses","submitFun","getOutStockOrdersByhandlerId","getAllOutStockOrders"],"mappings":"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","file":"app-oc/js/controllers/sparepart-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict'; // ==========================================    备件信息    ===================================\n\n  controllers.initController('sparePartInfoCtrl', ['$scope', 'ngDialog', '$location', '$routeParams', '$timeout', 'sparePartUIService', 'userEnterpriseService', 'userLoginUIService', 'Info', 'growl', function ($scope, ngDialog, $location, $routeParams, $timeout, sparePartUIService, userEnterpriseService, userLoginUIService, Info, growl) {\n    $scope.selecteditem = true; //是否有已选中的备件信息\n\n    $scope.spareInfoList = []; //存储备件信息列表，用于添加\n\n    $scope.allSpareInfos = []; //用来存储备件信息列表\n\n    $scope.editStatus = 3; //3为新增，2为修改\n\n    $scope.ifRouteParams = 0; //是否是跳转，如果是跳转隐藏添加按钮\n\n    $scope.queryState = 1; //用于tab切换\n\n    var getSpareInfoList = function getSpareInfoList(item) {\n      var newObjAry = [];\n\n      for (var i in item) {\n        var obj = item[i];\n        var newObj = jQuery.extend(true, {}, obj);\n        newObj.isEdit = newObj.isEdit ? newObj.isEdit : 0;\n        newObj.id = obj.id;\n        newObj.name = obj.name;\n        newObj.label = obj.label;\n        newObj.unit = obj.unit;\n        newObj.desc = obj.desc;\n        newObj.originalNumber = obj.originalNumber;\n        newObj.upperLimit = obj.upperLimit;\n        newObj.lowerLimit = obj.lowerLimit;\n        newObjAry.push(newObj);\n      }\n\n      $scope.$broadcast(Event.SPAREINFOINIT, {\n        \"option\": [newObjAry]\n      });\n    }; //添加备件信息\n\n\n    $scope.addSpareInfo = function () {\n      $scope.editStatus = 3;\n\n      for (var i in $scope.spareInfoList) {\n        if ($scope.spareInfoList[i].id == 0 || $scope.spareInfoList[i].isEdit == 2) {\n          growl.warning(\"已存在正在编辑的备件信息\", {});\n          return;\n        }\n      }\n\n      var newObj = {\n        \"name\": \"\",\n        \"unit\": \"\",\n        \"model\": \"\",\n        \"label\": \"\",\n        \"desc\": \"\",\n        \"originalNumber\": \"\",\n        \"upperLimit\": \"\",\n        \"lowerLimit\": \"\",\n        'id': 0,\n        'isEdit': 2\n      };\n      $scope.spareInfoList.push(newObj);\n      getSpareInfoList($scope.spareInfoList);\n    };\n\n    $scope.doActionInfo = function (type, select, callback) {\n      if (type == \"savespareInfo\") {\n        if (select != \"\" && select != null) {\n          var param = {}; //说明是修改项目\n\n          if (select.id > 0) {\n            param = {\n              \"name\": select.name,\n              \"unit\": select.unit,\n              \"model\": select.model,\n              \"label\": select.label,\n              \"desc\": select.desc,\n              \"originalNumber\": select.originalNumber,\n              \"upperLimit\": select.upperLimit,\n              \"lowerLimit\": select.lowerLimit,\n              \"id\": select.id\n            };\n          } else {\n            param = {\n              \"name\": select.name,\n              \"unit\": select.unit,\n              \"model\": select.model,\n              \"label\": select.label,\n              \"desc\": select.desc,\n              \"originalNumber\": select.originalNumber,\n              \"upperLimit\": select.upperLimit,\n              \"lowerLimit\": select.lowerLimit\n            };\n          }\n\n          sparePartUIService.saveSparePart(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              if (select.id > 0) {\n                growl.success(\"已成功修改此备件信息\", {});\n              } else {\n                growl.success(\"已成功添加备件信息\", {});\n              }\n\n              getAllSpareParts();\n              return;\n            }\n          });\n        } else {\n          growl.warning(\"请填写完整备件信息\", {});\n          return;\n        }\n      } else if (type == \"deletespareInfo\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除此备件信息吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              sparePartUIService.deleteSparePart(select.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"成功删除此备件信息\", {});\n                  getAllSpareParts();\n                  return;\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"cancel\") {\n        getAllSpareParts();\n      } else if (type == \"showStockOrder\") {\n        $scope.SpareName = select.name;\n        getStockOrderBySpareId(select.id);\n      }\n    }; //根据备件Id获取备件信息\n\n\n    var getSparePartById = function getSparePartById(id) {\n      if (!id) {\n        growl.info(\"此备件信息不存在\", {});\n        return;\n      }\n\n      sparePartUIService.getSparePartById(id, function (returnObj) {\n        if (returnObj.code == 0) {\n          var arr = [];\n\n          if (isArray(returnObj.data)) {\n            arr = returnObj.data;\n          } else {\n            if (returnObj.data == null) {\n              arr = [];\n            } else {\n              arr.push(returnObj.data);\n            }\n          }\n\n          $timeout(function () {\n            $scope.$broadcast(Event.SPAREINFOINIT, {\n              \"option\": [arr]\n            });\n          });\n        }\n      });\n    }; //根据备件Id获取条目信息\n\n\n    var getStockOrderBySpareId = function getStockOrderBySpareId(id) {\n      sparePartUIService.getStockOrderItemsBySparePartId(id, function (returnObj) {\n        if (returnObj.code == 0) {\n          var arr = [];\n\n          for (var i in returnObj.data) {\n            var obj = {};\n            obj.handlerPerson = returnObj.data[i].stockOder.handlerPerson; //处理人\n\n            obj.name = returnObj.data[i].stockOder.name; //库单编号\n\n            obj.createTime = returnObj.data[i].stockOder.createTime; //创建时间\n\n            obj.category = returnObj.data[i].stockOder.category; // 出入库\n\n            obj.sparePartNumber = returnObj.data[i].sparePartNumber; //备件数量\n\n            arr.push(obj);\n          }\n\n          $timeout(function () {\n            $scope.$broadcast(Event.SPAREINFOINIT + \"record\", {\n              \"option\": [arr]\n            });\n          });\n        }\n      });\n    }; //获取所有备件信息\n\n\n    var getAllSpareParts = function getAllSpareParts() {\n      sparePartUIService.getAllSpareParts(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.allSpareInfos = returnObj.data;\n          $scope.spareInfoList = [];\n          $scope.spareInfos = [];\n\n          for (var i in returnObj.data) {\n            var obj = returnObj.data[i];\n            obj.isEdit = 0;\n            $scope.spareInfoList.push(obj);\n          }\n\n          $scope.$broadcast(Event.SPAREINFOINIT, {\n            \"option\": [$scope.spareInfoList]\n          });\n        }\n      });\n    }; //根据条件获取备件信息\n\n\n    var getSpares = function getSpares() {\n      if ($routeParams.spareinfoId) {\n        $scope.ifRouteParams = 2010; //隐藏添加按钮 \n\n        getSparePartById($routeParams.spareinfoId);\n      } else {\n        getAllSpareParts();\n      }\n    };\n\n    getSpares();\n\n    $scope.getEvent = function () {\n      if ($scope.queryState == 1) {\n        getSpares();\n      } else if ($scope.queryState == 2) {\n        $timeout(function () {\n          $scope.$broadcast('spareIn');\n        });\n      } else if ($scope.queryState == 3) {\n        $timeout(function () {\n          $scope.$broadcast('spareOut');\n        });\n      }\n    };\n\n    $scope.getEvent();\n  }]); // ==========================================    备件入库    ===================================\n\n  controllers.initController('spareInPartCtrl', ['$scope', 'ngDialog', '$location', '$routeParams', '$timeout', 'sparePartUIService', 'userEnterpriseService', 'userLoginUIService', 'Info', 'growl', function ($scope, ngDialog, $location, $routeParams, $timeout, sparePartUIService, userEnterpriseService, userLoginUIService, Info, growl) {\n    $scope.selecteditem = true; //是否有已选中的入库单\n\n    $scope.spareInLists = []; //存储入库单列表，用于添加\n\n    $scope.$parent.selectedSparecalInList = []; //存储入库中条目，用于添加\n\n    $scope.$parent.ifSubmitIn = 0;\n    $scope.selectedConItem = {}; //选择到的入库单与设备关联\n\n    $scope.createTime = '';\n    $scope.$parent.selected = {\n      'sparePartId': '',\n      //所选备件Id\n      'stockOrderId': '' //所选库单Id\n\n    };\n    $scope.relatedDeviceList = []; //用于存储关联班组的设备id组\n\n    $scope.$on('spareIn', function () {\n      initIn();\n    });\n\n    var getcontectList = function getcontectList(item) {\n      var newObjAry = [];\n\n      for (var i in item) {\n        var obj = item[i];\n        var newObj = jQuery.extend(true, {}, obj);\n        newObj.isEdit = newObj.isEdit ? newObj.isEdit : 0;\n        newObj.id = obj.id;\n        newObj.name = obj.name;\n        newObj.handlerPerson = obj.handlerPerson;\n        newObj.createTime = obj.createTime;\n        newObj.desc = obj.desc;\n        newObjAry.unshift(newObj);\n      }\n\n      $scope.$broadcast(Event.SPAREININIT, {\n        \"option\": [newObjAry]\n      });\n    };\n\n    var getSpareCalList = function getSpareCalList(item) {\n      var newObjAry = [];\n\n      for (var i in item) {\n        var obj = item[i];\n        var newObj = jQuery.extend(true, {}, obj);\n        newObj.isEdit = newObj.isEdit ? newObj.isEdit : 0;\n        newObj.id = obj.id;\n        newObj.sparePartName = obj.sparePartName;\n        newObj.handlerPerson = obj.handlerPerson;\n        newObj.desc = obj.desc;\n        newObjAry.unshift(newObj);\n      }\n\n      $scope.$parent.$broadcast(Event.INSPARECLAUSESINIT, {\n        \"option\": [newObjAry]\n      });\n    }; //添加入库单\n\n\n    $scope.addspareIn = function () {\n      for (var i in $scope.spareInLists) {\n        if ($scope.spareInLists[i].id == 0) {\n          growl.warning(\"已存在正在编辑的入库单\", {});\n          return;\n        }\n      }\n\n      var newObj = {\n        'name': '',\n        'handlerPerson': '',\n        'createTime': '',\n        'desc': '',\n        'id': 0,\n        'isEdit': 2\n      };\n      $scope.spareInLists.unshift(newObj);\n      getcontectList($scope.spareInLists);\n    };\n\n    $scope.doActionIns = function (type, select, callback) {\n      if (type == \"cancel\") {\n        getInStockOrders(); // for (var i = $scope.spareInLists.length - 1; i > -1; i--) {\n        //   if ($scope.spareInLists[i].id == 0) {\n        //     $scope.spareInLists.splice(i, 1);\n        //   } else {\n        //     $scope.spareInLists[i][\"isEdit\"] = 0;\n        //   }\n        // }\n        // $scope.$broadcast(Event.SPAREININIT, {\n        //   \"option\": [$scope.spareInLists]\n        // });\n      } else if (type == \"saveSpareIn\") {\n        for (var i = $scope.spareInLists.length - 1; i > -1; i--) {\n          if ($scope.spareInLists[i].id == 0) {\n            $scope.spareInLists.splice(i, 1);\n          } else {\n            $scope.spareInLists[i][\"isEdit\"] = 0;\n          }\n        }\n\n        if (select != \"\" && select != null) {\n          var param = {}; //说明是修改项目\n\n          if (select.id > 0) {\n            param = {\n              'name': select.name,\n              'handlerPerson': select.handlerPerson,\n              'createTime': select.createTime,\n              'desc': select.desc,\n              \"id\": select.id\n            };\n          } else {\n            param = {\n              'name': select.name,\n              'handlerPerson': select.handlerPerson,\n              'createTime': select.createTime,\n              'desc': select.desc\n            };\n          }\n\n          sparePartUIService.saveInStockOrder(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              callback(returnObj.data);\n\n              if (select.id > 0) {\n                growl.success(\"已成功保存入库单\", {});\n                var k = -1;\n\n                for (var i in $scope.spareInLists) {\n                  if ($scope.spareInLists[i].id == select.id) {\n                    k = select.id;\n                    $scope.spareInLists[i] = jQuery.extend(true, {}, returnObj.data);\n                    break;\n                  }\n                }\n\n                if (k == -1) {\n                  $scope.spareInLists.push(returnObj.data);\n                }\n              }\n            }\n          });\n        }\n      } else if (type == \"deleteSpareIn\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除此入库单吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              sparePartUIService.deleteStockOrder(select.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"成功删除此入库单\", {});\n                }\n\n                getInStockOrders();\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"showSpareList\") {\n        $scope.$parent.selSpareName = select.name;\n        getStockOrderItemsById(select.id);\n        $scope.$parent.selected.stockOrderId = select.id; //所选库单id\n\n        if (select.commit) {\n          $scope.$parent.ifSubmitIn = 2010;\n        } else {\n          $scope.$parent.ifSubmitIn = 0;\n        }\n      }\n    };\n\n    $scope.$parent.doActionIn = function (type, select, callback) {\n      if (type == \"saveSpareInCaluses\") {\n        if (select != \"\" && select != null) {\n          var param = {}; //说明是修改项目\n\n          if (select.id > 0) {\n            param = {\n              'sparePartId': select.sparePartId,\n              //备件Id\n              'stockOrderId': $scope.$parent.selected.stockOrderId,\n              //库单Id\n              'sparePartNumber': select.sparePartNumber,\n              //备件数量\n              'desc': select.desc,\n              \"id\": select.id\n            };\n          } else {\n            param = {\n              'sparePartId': select.sparePartId,\n              'stockOrderId': $scope.$parent.selected.stockOrderId,\n              'sparePartNumber': select.sparePartNumber,\n              'desc': select.desc\n            };\n          }\n\n          sparePartUIService.saveStockOrderItem(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              if (select.id > 0) {\n                growl.success(\"已成功修改此库单条目\", {});\n              } else {\n                growl.success(\"已成功添加入库单条目\", {});\n              }\n\n              getStockOrderItemsById($scope.$parent.selected.stockOrderId);\n              return;\n            }\n          });\n        }\n      } else if (type == \"cancel\") {\n        for (var i = $scope.$parent.selectedSparecalInList.length - 1; i > -1; i--) {\n          if ($scope.$parent.selectedSparecalInList[i].id == 0) {\n            $scope.$parent.selectedSparecalInList.splice(i, 1);\n          } else {\n            $scope.$parent.selectedSparecalInList[i][\"isEdit\"] = 0;\n          }\n        }\n\n        $scope.$parent.$broadcast(Event.INSPARECLAUSESINIT, {\n          \"option\": [$scope.$parent.selectedSparecalInList]\n        });\n      } else if (type == \"deleteStockOrderItem\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除此条目吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              sparePartUIService.deleteStockOrderItem(select.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"成功删除此条目\", {});\n                  getStockOrderItemsById($scope.$parent.selected.stockOrderId);\n                  return;\n                } else {\n                  growl.warning(\"删除此条目失败\", {});\n                  return;\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    }; //添加条目\n\n\n    $scope.$parent.addInSpareClauseItem = function () {\n      for (var i in $scope.$parent.selectedSparecalInList) {\n        if ($scope.$parent.selectedSparecalInList[i].id == 0) {\n          growl.warning(\"已存在正在编辑的条目\", {});\n          return;\n        }\n      }\n\n      var newObj = {\n        'sparePartName': '',\n        'sparePartNumber': '',\n        'desc': '',\n        'id': 0,\n        'isEdit': 2\n      };\n      $scope.$parent.selectedSparecalInList.push(newObj);\n      getSpareCalList($scope.$parent.selectedSparecalInList);\n    }; //提交库单\n\n\n    $scope.submitInCaluses = function () {\n      var selectedId = $scope.$parent.selected.stockOrderId;\n\n      if (selectedId) {\n        var arr = [selectedId, true];\n        sparePartUIService.commitStockOrder(arr, function (returnObj) {\n          if (returnObj.code == 0) {\n            growl.success(\"已成功提交此入库单\", {});\n            getInStockOrders();\n            $scope.$parent.ifSubmitIn = 2010;\n          } else if (returnObj.code == 20622) {\n            getInStockOrders();\n          }\n        });\n      }\n    }; //根据库单id获取相关条目\n\n\n    function getStockOrderItemsById(id) {\n      sparePartUIService.getStockOrderItemsById(id, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.$parent.selectedSparecalInList = returnObj.data;\n          $timeout(function () {\n            $scope.$parent.$broadcast(Event.INSPARECLAUSESINIT, {\n              \"option\": [returnObj.data]\n            });\n          });\n        }\n      });\n    } //获取所有备件\n\n\n    var getAllSpareParts = function getAllSpareParts() {\n      sparePartUIService.getAllSpareParts(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.spareInfos = returnObj.data;\n        }\n      });\n    }; //获取所有入库单\n\n\n    var getInStockOrders = function getInStockOrders(flg) {\n      if (!$routeParams.spareInId) {\n        sparePartUIService.getAllInStockOrders(function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.spareInLists = returnObj.data;\n\n            for (var i in returnObj.data) {\n              $scope.spareInLists[i].isEdit = 0;\n            }\n\n            $timeout(function () {\n              $scope.$parent.$broadcast(Event.SPAREININIT, {\n                \"option\": [$scope.spareInLists]\n              });\n            });\n          }\n        });\n      } else {\n        sparePartUIService.getInStockOrdersByhandlerId($routeParams.spareInId, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.spareInLists = returnObj.data;\n\n            for (var i in returnObj.data) {\n              $scope.spareInLists[i].isEdit = 0;\n            }\n\n            $timeout(function () {\n              $scope.$parent.$broadcast(Event.SPAREININIT, {\n                \"option\": [$scope.spareInLists]\n              });\n            });\n          }\n        });\n      }\n    };\n\n    function initIn() {\n      getAllSpareParts();\n      getInStockOrders();\n    }\n\n    ;\n  }]); // ==========================================    备件出库    ===================================\n\n  controllers.initController('spareOutPartCtrl', ['$scope', 'ngDialog', '$location', '$routeParams', '$timeout', 'sparePartUIService', 'userEnterpriseService', 'userLoginUIService', 'Info', 'growl', function ($scope, ngDialog, $location, $routeParams, $timeout, sparePartUIService, userEnterpriseService, userLoginUIService, Info, growl) {\n    $scope.selecteditem = true; //是否有已选中的出库单\n\n    $scope.spareOutLists = []; //存储出库单列表，用于添加\n\n    $scope.$parent.selectedSparecalOutList = []; //存储出库中条目，用于添加\n\n    $scope.$parent.ifSubmitOut = 0;\n    $scope.selectedConItem = {}; //选择到的出库单与条目关联\n\n    $scope.$parent.selected = {\n      'sparePartId': '',\n      //所选备件Id\n      'stockOrderId': '' //所选库单Id\n\n    };\n    $scope.$on('spareOut', function () {\n      initOut();\n    });\n\n    var getcontectList = function getcontectList(item) {\n      var newObjAry = [];\n\n      for (var i in item) {\n        var obj = item[i];\n        var newObj = jQuery.extend(true, {}, obj);\n        newObj.isEdit = newObj.isEdit ? newObj.isEdit : 0;\n        newObj.id = obj.id;\n        newObj.name = obj.name;\n        newObj.handlerPerson = obj.handlerPerson;\n        newObj.createTime = obj.createTime;\n        newObj.desc = obj.desc;\n        newObjAry.push(newObj);\n      }\n\n      $scope.$parent.$broadcast(Event.SPAREOUTINIT, {\n        \"option\": [newObjAry]\n      });\n    };\n\n    var getSpareCalList = function getSpareCalList(item) {\n      var newObjAry = [];\n\n      for (var i in item) {\n        var obj = item[i];\n        var newObj = jQuery.extend(true, {}, obj);\n        newObj.isEdit = newObj.isEdit ? newObj.isEdit : 0;\n        newObj.id = obj.id;\n        newObj.sparePartName = obj.sparePartName;\n        newObj.handlerPerson = obj.handlerPerson;\n        newObj.desc = obj.desc;\n        newObjAry.push(newObj);\n      }\n\n      $scope.$parent.$broadcast(Event.OUTSPARECLAUSESINIT, {\n        \"option\": [newObjAry]\n      });\n    }; //添加出库单\n\n\n    $scope.addspareOut = function () {\n      for (var i in $scope.spareOutLists) {\n        if ($scope.spareOutLists[i].id == 0) {\n          growl.warning(\"已存在正在编辑的出库单\", {});\n          return;\n        }\n      }\n\n      var newObj = {\n        'name': '',\n        'handlerPerson': '',\n        'createTime': '',\n        'desc': '',\n        'id': 0,\n        'isEdit': 2\n      };\n      $scope.spareOutLists.push(newObj);\n      getcontectList($scope.spareOutLists);\n    };\n\n    $scope.doAction = function (type, select, callback) {\n      if (type == \"cancel\") {\n        getOutStockOrders();\n      } else if (type == \"saveSpareOut\") {\n        for (var i = $scope.spareOutLists.length - 1; i > -1; i--) {\n          if ($scope.spareOutLists[i].id == 0) {\n            $scope.spareOutLists.splice(i, 1);\n          } else {\n            $scope.spareOutLists[i][\"isEdit\"] = 0;\n          }\n        }\n\n        if (select != \"\" && select != null) {\n          var param = {}; //说明是修改项目\n\n          if (select.id > 0) {\n            param = {\n              'name': select.name,\n              'handlerPerson': select.handlerPerson,\n              'createTime': select.createTime,\n              'desc': select.desc,\n              \"id\": select.id\n            };\n          } else {\n            param = {\n              'name': select.name,\n              'handlerPerson': select.handlerPerson,\n              'createTime': select.createTime,\n              'desc': select.desc\n            };\n          }\n\n          sparePartUIService.saveOutStockOrder(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              callback(returnObj.data);\n\n              if (select.id > 0) {\n                growl.success(\"已成功保存出库单\", {});\n                var k = -1;\n\n                for (var i in $scope.spareOutLists) {\n                  if ($scope.spareOutLists[i].id == select.id) {\n                    k = select.id;\n                    $scope.spareOutLists[i] = jQuery.extend(true, {}, returnObj.data);\n                    break;\n                  }\n                }\n\n                if (k == -1) {\n                  $scope.spareOutLists.push(returnObj.data);\n                }\n              }\n            }\n          });\n        }\n      } else if (type == \"deleteSpareOut\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除此出库单吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              sparePartUIService.deleteStockOrder(select.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"成功删除此出库单\", {});\n                }\n\n                getOutStockOrders();\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      } else if (type == \"showSpareList\") {\n        $scope.$parent.selSpareName = select.name;\n        getStockOrderItemsById(select.id);\n        $scope.$parent.selected.stockOrderId = select.id; //所选库单id\n\n        if (select.commit) {\n          $scope.$parent.ifSubmitOut = 2010;\n        } else {\n          $scope.$parent.ifSubmitOut = 0;\n        }\n      }\n    };\n\n    $scope.$parent.doActionOut = function (type, select, callback) {\n      if (type == \"saveSpareOutCaluses\") {\n        if (select != \"\" && select != null) {\n          var param = {}; //说明是修改项目\n\n          if (select.id > 0) {\n            param = {\n              'sparePartId': select.sparePartId,\n              //备件Id\n              'stockOrderId': $scope.$parent.selected.stockOrderId,\n              //库单Id\n              'sparePartNumber': select.sparePartNumber,\n              //备件数量\n              'desc': select.desc,\n              \"id\": select.id\n            };\n          } else {\n            param = {\n              'sparePartId': select.sparePartId,\n              'stockOrderId': $scope.$parent.selected.stockOrderId,\n              'sparePartNumber': select.sparePartNumber,\n              'desc': select.desc\n            };\n          }\n\n          sparePartUIService.saveStockOrderItem(param, function (returnObj) {\n            if (returnObj.code == 0) {\n              if (select.id > 0) {\n                growl.success(\"已成功修改此库单条目\", {});\n              } else {\n                growl.success(\"已成功添加库单条目\", {});\n              }\n\n              getStockOrderItemsById($scope.$parent.selected.stockOrderId);\n              return;\n            }\n          });\n        }\n      } else if (type == \"cancel\") {\n        for (var i = $scope.$parent.selectedSparecalOutList.length - 1; i > -1; i--) {\n          if ($scope.$parent.selectedSparecalOutList[i].id == 0) {\n            $scope.$parent.selectedSparecalOutList.splice(i, 1);\n          } else {\n            $scope.$parent.selectedSparecalOutList[i][\"isEdit\"] = 0;\n          }\n        }\n\n        $scope.$parent.$broadcast(Event.OUTSPARECLAUSESINIT, {\n          \"option\": [$scope.$parent.selectedSparecalOutList]\n        });\n      } else if (type == \"deleteStockOrderItem\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          message: '确认删除此条目吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              sparePartUIService.deleteStockOrderItem(select.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"成功删除此条目\", {});\n                  getStockOrderItemsById($scope.$parent.selected.stockOrderId);\n                  return;\n                } else {\n                  growl.warning(\"删除此条目失败\", {});\n                  return;\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    }; //添加条目\n\n\n    $scope.$parent.addOutSpareClauseItem = function () {\n      for (var i in $scope.$parent.selectedSparecalOutList) {\n        if ($scope.$parent.selectedSparecalOutList[i].id == 0) {\n          growl.warning(\"已存在正在编辑的条目\", {});\n          return;\n        }\n      }\n\n      var newObj = {\n        'sparePartName': '',\n        'sparePartNumber': '',\n        'desc': '',\n        'id': 0,\n        'isEdit': 2\n      };\n      $scope.$parent.selectedSparecalOutList.push(newObj);\n      getSpareCalList($scope.$parent.selectedSparecalOutList);\n    }; //根据出库单id获取相关条目\n\n\n    function getStockOrderItemsById(id) {\n      sparePartUIService.getStockOrderItemsById(id, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.$parent.selectedSparecalOutList = returnObj.data;\n          $timeout(function () {\n            $scope.$parent.$broadcast(Event.OUTSPARECLAUSESINIT, {\n              \"option\": [returnObj.data]\n            });\n          });\n        }\n      });\n    } //提交函数\n\n\n    function submitFun(arr) {\n      sparePartUIService.commitStockOrder(arr, function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data.length > 0) {\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              message: '此库单显示备件不足,仍确定提交此库单吗？',\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  var arrObj = [arr[0], false];\n                  submitFun(arrObj);\n                  getOutStockOrders();\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  dialogRef.close();\n                }\n              }]\n            });\n          } else {\n            growl.success(\"已成功提交此出库单\", {});\n            getOutStockOrders();\n          }\n        }\n      });\n    } //提交库单\n\n\n    $scope.submitOutCaluses = function () {\n      var selectedId = $scope.$parent.selected.stockOrderId;\n\n      if (selectedId) {\n        var arr = [selectedId, true];\n        submitFun(arr);\n      }\n    }; //获取所有备件\n\n\n    var getAllSpareParts = function getAllSpareParts() {\n      sparePartUIService.getAllSpareParts(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.spareInfos = returnObj.data;\n        }\n      });\n    }; //获取所有出库单\n\n\n    var getOutStockOrders = function getOutStockOrders() {\n      if (!$routeParams.spareInId) {\n        sparePartUIService.getAllOutStockOrders(function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.spareOutLists = returnObj.data;\n\n            for (var i in returnObj.data) {\n              $scope.spareOutLists[i].isEdit = 0;\n            }\n\n            $timeout(function () {\n              $scope.$parent.$broadcast(Event.SPAREOUTINIT, {\n                \"option\": [$scope.spareOutLists]\n              });\n            });\n          }\n        });\n      } else {\n        sparePartUIService.getOutStockOrdersByhandlerId($routeParams.spareInId, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.spareOutLists = returnObj.data;\n\n            for (var i in returnObj.data) {\n              $scope.spareOutLists[i].isEdit = 0;\n            }\n\n            $timeout(function () {\n              $scope.$parent.$broadcast(Event.SPAREOUTINIT, {\n                \"option\": [$scope.spareOutLists]\n              });\n            });\n          }\n        });\n      }\n    };\n\n    function initOut() {\n      getAllSpareParts();\n      getOutStockOrders();\n    }\n\n    ;\n  }]);\n});"],"sourceRoot":"/source/"}