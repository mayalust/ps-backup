{"version":3,"sources":["app-oc/js/controllers/specialist-ctrl.js"],"names":["define","controllers","initController","scope","q","rootScope","$location","$routeParams","timeout","kqiManagerUIService","userRoleUIService","resourceUIService","userLoginUIService","Info","growl","userEnterpriseService","viewFlexService","userDomainService","window","freeboardservice","dialogue","ngDialog","specialListService","addNewClick","path","expertModelType","id","expertModelTypes","this","filterExpertType","elem","kqiModels","some","el","originalId","saveKqiModel","param","callback","event","code","data","publicModel","model","status","success","editModel","applyModel","clone","$clone","$$hashKey","$extension","push","applyExpertDataModel","removeModel","$remove","index","deleteKqiModel","init","allkqiModels","selfkqiModels","i","extraKqiModels","filter","concat","length","map","content","JSON","parse","viewContent","e","sort","a","b","timea","modifyTime","Date","getTime","get","console","log","$$","sloop","call","kqiModel","result","getExpertDataModels","getAllExpertDataModels"],"mappings":"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","file":"app-oc/js/controllers/specialist-ctrl.js","sourcesContent":["define(['controllers/controllers', 'Array'], function (controllers) {\n  'use strict';\n\n  controllers.initController('specialistCtrl', ['$scope', '$q', '$rootScope', '$location', '$routeParams', '$timeout', 'kqiManagerUIService', 'userRoleUIService', 'resourceUIService', 'userLoginUIService', 'Info', 'growl', 'userEnterpriseService', 'viewFlexService', 'userDomainService', \"$window\", \"freeboardservice\", 'dialogue', \"ngDialog\", \"specialListService\", function (scope, q, rootScope, $location, $routeParams, timeout, kqiManagerUIService, userRoleUIService, resourceUIService, userLoginUIService, Info, growl, userEnterpriseService, viewFlexService, userDomainService, window, freeboardservice, dialogue, ngDialog, specialListService) {\n    scope.addNewClick = function () {\n      $location.path(\"specialist/input/0\");\n    };\n\n    scope.expertModelType = $routeParams.id;\n\n    var expertClick = function expertClick() {\n      //scope.expertModelType = this.id;\n      $location.path(\"specialist/\" + this.id);\n    };\n\n    scope.expertModelTypes = specialListService(expertClick);\n\n    scope.filterExpertType = function (elem) {\n      if (elem.expertModelType == 1) {\n        return !scope.kqiModels.some(function (el) {\n          return el.originalId == elem.id;\n        }) && elem.expertModelType == scope.expertModelType;\n      } else {\n        return elem.expertModelType == scope.expertModelType;\n      }\n    };\n\n    var getAllExpertDataModels = function getAllExpertDataModels(callback) {\n      kqiManagerUIService.getAllExpertDataModels(function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n      /**\n      $$.cacheAsyncData.call(kqiManagerUIService.getAllExpertDataModels, [], function(event){\n        if(event.code == 0){\n          callback(event.data);\n        }\n      }, false);*/\n    };\n\n    var getExpertDataModels = function getExpertDataModels(callback) {\n      kqiManagerUIService.getExpertDataModels(function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n      /**\n      $$.cacheAsyncData.call(kqiManagerUIService.getExpertDataModels, [], function(event){\n        if(event.code == 0){\n          callback(event.data);\n        }\n      }, false);*/\n    };\n\n    var applyExpertDataModel = function applyExpertDataModel(id, callback) {\n      kqiManagerUIService.applyExpertDataModel(id, function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    var saveKqiModel = function saveKqiModel(param, callback) {\n      kqiManagerUIService.saveKqiModel(param, function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    var deleteKqiModel = function deleteKqiModel(id, callback) {\n      kqiManagerUIService.deleteKqiModel(id, function (event) {\n        if (event.code == 0) {\n          callback(event);\n        }\n      });\n    };\n\n    var init = function init() {\n      getAllExpertDataModels(function (allkqiModels) {\n        getExpertDataModels(function (selfkqiModels) {\n          var kqiModels = [];\n\n          for (var i in selfkqiModels) {\n            selfkqiModels[i].expertModelType = 0;\n          }\n\n          ;\n          var extraKqiModels = allkqiModels.filter(function (elem) {\n            var some = selfkqiModels.some(function (el) {\n              return elem.id == el.id;\n            });\n            return !some;\n          });\n\n          for (var i in extraKqiModels) {\n            extraKqiModels[i].expertModelType = 1;\n          }\n\n          kqiModels = selfkqiModels.concat(extraKqiModels); //\n          //kqiModels[0].expertModelType = 1;\n          //\n\n          if (kqiModels.length > 0) {\n            scope.kqiModels = kqiModels.map(function (elem) {\n              try {\n                elem.content = JSON.parse(elem.viewContent);\n              } catch (e) {\n                elem.content = null;\n              } finally {\n                return elem;\n              }\n            }).sort(function (a, b) {\n              var timea = a.modifyTime ? new Date(a.modifyTime).getTime() : 0;\n              var timeb = b.modifyTime ? new Date(b.modifyTime).getTime() : 0;\n              return timeb - timea;\n            });\n          } else {\n            Info.get(\"../localdb/specialist.json\", function (kqiModels) {\n              console.log(kqiModels);\n\n              var repeat = function repeat(kqiModel, callback) {\n                saveKqiModel(kqiModel, function (result) {\n                  callback();\n                });\n              };\n\n              var finish = function finish() {\n                init();\n              };\n\n              $$.sloop.call(kqiModels, repeat, finish);\n            });\n          }\n        });\n      });\n    };\n\n    scope.publicModel = function (model) {\n      model.status = 10;\n      saveKqiModel(model, function (event) {\n        growl.success(\"专家模型发布成功!!\");\n      });\n    };\n\n    scope.editModel = function (model) {\n      $location.path(\"specialist/input/\" + model.id);\n    };\n\n    scope.applyModel = function (model) {\n      /**\n      model.status = 10;\n      var clone = model.$clone();\n      delete clone.$$hashKey;\n      clone.originalId = model.id;\n      clone.expertModelType = 0;\n      scope.kqiModels.push(clone);\n      console.log(scope.kqiModels);*/\n\n      /**\n      scope.$apply(function(){\n      scope.$apply(function(){\n        //scope.kqiModels.push(model.$clone());\n      });\n        scope.kqiModels.push(model.$clone());\n      });*/\n      applyExpertDataModel(model.id, function (data) {\n        var clone = model.$clone();\n        delete clone.$$hashKey;\n        clone = clone.$extension(data);\n        model.status = 10;\n        data.expertModelType = 0;\n        scope.kqiModels.push(clone);\n        growl.success(\"已经成功应用模型!!\");\n      });\n    };\n\n    scope.removeModel = function (model) {\n      deleteKqiModel(model.id, function (event) {\n        if (event.code == \"0\") {\n          scope.kqiModels.$remove(function (index, elem) {\n            return elem == model;\n          });\n        }\n      });\n    };\n\n    init();\n  }]);\n});"],"sourceRoot":"/source/"}