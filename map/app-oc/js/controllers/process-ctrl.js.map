{"version":3,"sources":["app-oc/js/controllers/process-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","ngDialog","workflowService","workflowDefinitionService","viewFlexService","$timeout","growl","historyVersion","selectHistory","historyList","updateView","param","saveWorkflowDefinition","returnObj","code","success","id","location","href","data","initViews","closeDialog","getWorkflowDefinitions","configureView","$broadcast","releaseObj","name","version","desc","workflowDefinitionId","addViews","addObj","domainPath","viewContent","isEdit","createTime","updateTime","open","template","className","scope","saveFlow","saveRelease","publishWorkflow","doAction","flg","rowData","fun","getWorkflowByWorkflowDefinitionId","obj","length","warning","show","title","closable","message","buttons","label","cssClass","action","dialogRef","deleteWorkflowDefinitionById","i","splice","close","copyView","jQuery","extend","viewTitle","viewName","viewId","push","find","AdminLTE","boxWidget","collapse","res","deleteWorkflowById","j","closeTable","getWorkflows"],"mappings":"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","file":"app-oc/js/controllers/process-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('processViewsCtrl', ['$scope', 'ngDialog', 'workflowService', 'workflowDefinitionService', 'viewFlexService', '$timeout', 'growl', function ($scope, ngDialog, workflowService, workflowDefinitionService, viewFlexService, $timeout, growl) {\n    $scope.historyVersion = \"\";\n    $scope.selectHistory = \"\";\n    $scope.historyList = \"\";\n\n    var createView = function createView(param) {\n      workflowDefinitionService.saveWorkflowDefinition(param, function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.configureView.push(returnObj.data);\n          $scope.$broadcast('PROCESS', {\n            \"data\": $scope.configureView\n          });\n          growl.success(\"保存成功\");\n        }\n      });\n    };\n\n    var updateView = function updateView(param) {\n      workflowDefinitionService.saveWorkflowDefinition(param, function (returnObj) {\n        if (returnObj.code == 0) {\n          growl.success(\"保存成功\");\n\n          if (param.id == null) {\n            location.href = \"../app-flowsheet/index.html#/flow/\" + returnObj.data.id;\n          } else {\n            initViews();\n            $scope.closeDialog();\n          }\n        }\n      });\n    };\n\n    var initObj = function initObj() {\n      $scope.addObj = {\n        id: null,\n        domainPath: \"\",\n        name: \"\",\n        desc: \"\",\n        viewContent: \"\",\n        isEdit: 0,\n        createTime: \"\",\n        updateTime: \"\"\n      };\n    };\n\n    $scope.releaseObj = {\n      \"name\": \"\",\n      \"version\": \"\",\n      \"desc\": \"\",\n      \"workflowDefinitionId\": \"\"\n    };\n\n    $scope.addViews = function (data) {\n      if (data) {\n        $scope.addObj = data;\n      } else {\n        initObj();\n      }\n\n      ngDialog.open({\n        template: '../partials/dialogue/add_flow.html',\n        className: 'ngdialog-theme-plain',\n        scope: $scope\n      });\n    };\n\n    $scope.saveFlow = function () {\n      updateView($scope.addObj);\n    };\n\n    $scope.saveRelease = function () {\n      workflowDefinitionService.publishWorkflow($scope.releaseObj, function (returnObj) {\n        if (returnObj.code == 0) {\n          growl.success(\"流程视图发布成功\", {});\n          initViews();\n          $scope.closeDialog();\n        }\n      });\n    };\n\n    $scope.doAction = function (flg, rowData, fun) {\n      if (flg == \"attr-delete\") {\n        workflowService.getWorkflowByWorkflowDefinitionId(rowData.id, function (obj) {\n          if (obj.code == 0) {\n            if (obj.data.length > 0) {\n              growl.warning(\"这个流程设计下面有历史版本，请先删除\", {});\n              return;\n            } //删除\n\n\n            BootstrapDialog.show({\n              title: '提示',\n              closable: false,\n              //size:BootstrapDialog.SIZE_WIDE,\n              message: '确认删除该流程视图吗？',\n              buttons: [{\n                label: '确定',\n                cssClass: 'btn-success',\n                action: function action(dialogRef) {\n                  workflowDefinitionService.deleteWorkflowDefinitionById([rowData.id], function (returnObj) {\n                    if (returnObj.code == 0) {\n                      for (var i = 0; i < $scope.configureView.length; i++) {\n                        if ($scope.configureView[i].id == rowData.id) {\n                          $scope.configureView.splice(i, 1);\n                          break;\n                        }\n                      }\n\n                      if (fun) {\n                        fun(true);\n                      }\n                    }\n                  });\n                  dialogRef.close();\n                }\n              }, {\n                label: '取消',\n                action: function action(dialogRef) {\n                  dialogRef.close();\n                }\n              }]\n            });\n          }\n        });\n      } else if (flg == \"view-copy\") {\n        var copyView = jQuery.extend(true, {}, rowData);\n        copyView.viewTitle = copyView.viewTitle + \"复制\";\n        copyView.viewName = copyView.viewTitle;\n        copyView.viewId = 0;\n        createView(copyView);\n      } else if (flg == \"view-save\") {\n        updateView(rowData);\n      } else if (flg == \"release\") {\n        var version = 0;\n\n        if (rowData.version == \"\" || rowData.version == null) {\n          version = 1;\n        } else {\n          version = rowData.version;\n        }\n\n        $scope.releaseObj.version = version;\n        $scope.releaseObj.workflowDefinitionId = rowData.id;\n        $scope.releaseObj.name = rowData.name;\n        $scope.releaseObj.desc = rowData.desc;\n        ngDialog.open({\n          template: '../partials/dialogue/flow_release.html',\n          className: 'ngdialog-theme-plain',\n          scope: $scope\n        });\n      } else if (flg == 'history') {\n        if (jQuery(\"#processcollapse\").find(\".fa.fa-plus\").length == 0) {\n          jQuery.AdminLTE.boxWidget.collapse(jQuery(\"#processcollapse\"));\n        }\n\n        ;\n        workflowService.getWorkflowByWorkflowDefinitionId(rowData.id, function (res) {\n          if (res.code == 0) {\n            $scope.historyList = res.data;\n            $scope.$broadcast(\"PROCESS\" + \"history\", {\n              \"data\": res.data\n            });\n          }\n        });\n        $scope.selectHistory = rowData;\n        $scope.historyVersion = \"version\"; //$scope.$apply();\n      } else if (flg == 'history-delete') {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认要删除流程历史版本？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              workflowService.deleteWorkflowById(rowData.id, function (res) {\n                if (res.code == 0) {\n                  for (var j in $scope.historyList) {\n                    if ($scope.historyList[j].id == rowData.id) {\n                      $scope.historyList.splice(j, 1);\n                    }\n                  }\n\n                  $scope.$broadcast(\"PROCESS\" + \"history\", {\n                    \"data\": $scope.historyList\n                  });\n                  growl.success(\"流程历史版本删除成功\", {});\n                  initViews();\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n\n    $scope.closeTable = function () {\n      if (jQuery(\"#processcollapse\").find(\".fa.fa-plus\").length > 0) {\n        jQuery.AdminLTE.boxWidget.collapse(jQuery(\"#processcollapse\"));\n      }\n\n      $scope.historyVersion = \"\";\n    };\n\n    $scope.configureView = [];\n\n    function initViews() {\n      workflowDefinitionService.getWorkflowDefinitions(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.configureView = returnObj.data;\n          $scope.$broadcast('PROCESS', {\n            \"data\": $scope.configureView\n          });\n        }\n      });\n    }\n\n    initViews();\n  }]);\n  controllers.initController('processReleaseCtrl', ['$scope', 'workflowService', 'viewFlexService', '$timeout', 'growl', function ($scope, workflowService, viewFlexService, $timeout, growl) {\n    $scope.doAction = function (flg, rowData, fun) {\n      if (flg == \"attr-delete\") {\n        //删除\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认删除该流程视图吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              workflowService.deleteWorkflowById([rowData.id], function (returnObj) {\n                if (returnObj.code == 0) {\n                  for (var i = 0; i < $scope.configureView.length; i++) {\n                    if ($scope.configureView[i].id == rowData.id) {\n                      $scope.configureView.splice(i, 1);\n                      break;\n                    }\n                  }\n\n                  if (fun) {\n                    fun(true);\n                  }\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n\n    $scope.configureView = [];\n\n    function initViews() {\n      workflowService.getWorkflows(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.configureView = returnObj.data;\n          $scope.$broadcast('PROCESS-RELEASE', {\n            \"data\": $scope.configureView\n          });\n        }\n      });\n    }\n\n    initViews();\n  }]);\n});"],"sourceRoot":"/source/"}