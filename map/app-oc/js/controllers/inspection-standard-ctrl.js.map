{"version":3,"sources":["app-oc/js/controllers/inspection-standard-ctrl.js"],"names":["define","controllers","BootstrapDialog","initController","$scope","ngDialog","solutionUIService","userInitService","resourceUIService","$location","$routeParams","$timeout","maintenanceUIService","userLoginUIService","Info","growl","userEnterpriseService","columnsData","initHistory","inspectStandard","position","item","standardContext","spotCheckMethod","spotCheckTool","serialNum","spotCheckCategory","modelId","getAllStandards","obj","getInspectionItemsByCondition","returnObj","code","data","$broadcast","Event","INSPECTIONSTANDARD","option","ifAddInspection","routePathNodes","InsStandardItem","queryDitem","loaderValue","goSearch","v","state","attributeName","addInspection","open","template","scope","className","cancelInspection","info","saveInspection","param","id","updateInspectionItem","closeDialog","success","addInspectionItem","doAction","type","select","console","log","selected","domainPath","updateParam","rv","m","o","warning","show","title","closable","message","buttons","label","cssClass","action","dialogRef","deleteInspectionItemById","close","getModels","allModels"],"mappings":"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","file":"app-oc/js/controllers/inspection-standard-ctrl.js","sourcesContent":["define(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('inspectionStandardCtrl', ['$scope', 'ngDialog', 'solutionUIService', 'userInitService', 'resourceUIService', '$location', '$routeParams', '$timeout', 'maintenanceUIService', 'userLoginUIService', 'Info', 'growl', 'userEnterpriseService', function ($scope, ngDialog, solutionUIService, userInitService, resourceUIService, $location, $routeParams, $timeout, maintenanceUIService, userLoginUIService, Info, growl, userEnterpriseService) {\n    var columnsData = [];\n    $scope.ifAddInspection = false; //默认不出现添加巡检标准项\n\n    $scope.routePathNodes = {};\n    $scope.InsStandardItem = {}; //添加巡检标准的返回项\n\n    $scope.queryDitem = {};\n    $scope.loaderValue = \"\"; //巡检标准变量定义\n\n    function initHistory() {\n      $scope.inspectStandard = {\n        \"position\": \"\",\n        //巡检部位\n        \"item\": \"\",\n        //巡检项目\n        \"standardContext\": \"\",\n        //巡检内容\n        \"spotCheckMethod\": \"\",\n        //点检方法\n        \"spotCheckTool\": \"\",\n        //点检工具\n        \"serialNum\": \"\",\n        //序号\n        \"spotCheckCategory\": \"\",\n        //点检类别\n        \"modelId\": null //设备模板Id\n\n      };\n    } //获取设备模板\n\n\n    function getAllModels() {\n      resourceUIService.getModels(function (returnObj) {\n        if (returnObj.code == 0) {\n          $scope.allModels = returnObj.data;\n        }\n      });\n    }\n\n    ; //获取所有巡检标准\n\n    function getAllStandards(obj) {\n      maintenanceUIService.getInspectionItemsByCondition(obj, function (returnObj) {\n        if (returnObj.code == 0) {\n          columnsData = returnObj.data;\n          $timeout(function () {\n            $scope.$broadcast(Event.INSPECTIONSTANDARD, {\n              \"option\": [columnsData]\n            });\n          });\n        }\n      });\n    }\n\n    ; //查询条件事件\n\n    $scope.goSearch = function () {\n      var v = {};\n\n      if ($scope.queryDitem.state > 0) {\n        v[$scope.queryDitem.attributeName] = $scope.loaderValue;\n        getAllStandards(v);\n      } else if (modelId) {\n        v['id'] = modelId;\n        getAllStandards(v);\n      } else {\n        v['spotCheckCategory'] = $scope.loaderValue;\n        getAllStandards(v);\n      }\n    }; //添加巡检标准\n\n\n    $scope.addInspection = function (obj) {\n      if (obj == 0) {\n        initHistory();\n      } else {\n        $scope.inspectStandard = obj;\n      }\n\n      $scope.ifAddInspection = true;\n      ngDialog.open({\n        template: '../partials/dialogue/add_inspection.html',\n        scope: $scope,\n        className: 'ngdialog-theme-plain'\n      });\n    }; //取消巡检标准\n\n\n    $scope.cancelInspection = function () {\n      $scope.ifAddInspection = false;\n      growl.info(\"取消添加巡检标准\", {});\n    }; //保存添加信息\n\n\n    $scope.saveInspection = function () {\n      var param = {\n        \"position\": $scope.inspectStandard.position,\n        //巡检部位\n        \"item\": $scope.inspectStandard.item,\n        //巡检项目\n        \"standardContext\": $scope.inspectStandard.standardContext,\n        //巡检内容\n        \"spotCheckMethod\": $scope.inspectStandard.spotCheckMethod,\n        //点检方法\n        \"spotCheckTool\": $scope.inspectStandard.spotCheckTool,\n        //点检工具\n        \"spotCheckCategory\": $scope.inspectStandard.spotCheckCategory,\n        //点检类别\n        \"serialNum\": $scope.inspectStandard.serialNum,\n        //序号\n        \"modelId\": $scope.inspectStandard.modelId //设备模板Id\n\n      }; //校验必输项\n\n      /* var rv = requiredFiledValidation(param);\n       if(rv != null) {\n         growl.warning(rv, {});\n         return;\n       }*/\n\n      if ($scope.inspectStandard.id > 0) {\n        maintenanceUIService.updateInspectionItem($scope.inspectStandard, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.closeDialog();\n            growl.success(\"维保标准修改成功\", {});\n            getAllStandards({});\n          }\n        });\n      } else {\n        maintenanceUIService.addInspectionItem(param, function (returnObj) {\n          if (returnObj.code == 0) {\n            $scope.closeDialog();\n            $scope.InsStandardItem = returnObj.data;\n            growl.success(\"添加维保标准成功\", {});\n            $scope.ifAddInspection = false;\n            getAllStandards({});\n          }\n        });\n      }\n    };\n    /**\n     * 修改巡检必输项验证\n     * @param o\n     */\n\n\n    var requiredFiledValidation = function requiredFiledValidation(o) {\n      var m = null;\n\n      if (!o.item || o.item == \"\") {\n        m = '巡检项目名称不能为空';\n      } else if (!o.modelId || o.modelId == \"\") {\n        m = '设备模板不能为空';\n      } else if (!o.standardContext || o.standardContext == \"\") {\n        m = '巡检内容不能为空';\n      } else if (!o.spotCheckMethod || o.spotCheckMethod == \"\") {\n        m = '点检方法不能为空';\n      } else if (!o.spotCheckTool || o.spotCheckTool == \"\") {\n        m = '点检工具不能为空';\n      } else if (!o.spotCheckCategory || o.spotCheckCategory == \"\") {\n        m = '点检类别不能为空';\n      } else if (!o.position || o.position == \"\") {\n        m = '点检部位不能为空';\n      }\n\n      return m;\n    }; //option操作\n\n\n    $scope.doAction = function (type, select) {\n      console.log(select);\n\n      if (type == \"update\") {\n        $scope.selected = {\n          \"id\": select.id,\n          \"domainPath\": select.domainPath\n        };\n      } else if (type == \"save-btn\") {\n        var param = {\n          \"id\": $scope.selected.id,\n          \"item\": $scope.updateParam.item,\n          \"standardContext\": $scope.updateParam.standardContext,\n          \"spotCheckMethod\": $scope.updateParam.spotCheckMethod,\n          \"spotCheckTool\": $scope.updateParam.spotCheckTool,\n          \"spotCheckCategory\": $scope.updateParam.spotCheckCategory,\n          \"position\": $scope.updateParam.position,\n          \"modelId\": $scope.updateParam.modelId,\n          \"domainPath\": $scope.selected.domainPath\n        }; //校验必输项\n\n        var rv = requiredFiledValidation(param);\n\n        if (rv != null) {\n          growl.warning(rv, {});\n          return;\n        }\n\n        maintenanceUIService.updateInspectionItem(param, function (returnObj) {\n          if (returnObj.code == 0) {\n            growl.success(\"维保标准修改成功\", {});\n            getAllStandards({});\n          }\n        });\n      } else if (type == \"cancel-btn\") {\n        growl.info(\"取消修改维保标准\", {});\n        $scope.ifAddInspection = false;\n      } else if (type == \"delete\") {\n        BootstrapDialog.show({\n          title: '提示',\n          closable: false,\n          //size:BootstrapDialog.SIZE_WIDE,\n          message: '确认删除 ' + select.item + ' 吗？',\n          buttons: [{\n            label: '确定',\n            cssClass: 'btn-success',\n            action: function action(dialogRef) {\n              maintenanceUIService.deleteInspectionItemById(select.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  growl.success(\"成功删除维保标准\", {});\n                  getAllStandards({});\n                }\n              });\n              dialogRef.close();\n            }\n          }, {\n            label: '取消',\n            action: function action(dialogRef) {\n              dialogRef.close();\n            }\n          }]\n        });\n      }\n    };\n\n    var init = function init() {\n      getAllModels();\n      getAllStandards({});\n      initHistory();\n    };\n\n    init();\n  }]);\n});"],"sourceRoot":"/source/"}