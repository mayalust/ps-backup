{"version":3,"sources":["app-oc/js/controllers/specialist-input-ctrl.js"],"names":["define","controllers","initController","scope","q","rootScope","$location","$routeParams","timeout","kqiManagerUIService","userRoleUIService","resourceUIService","userLoginUIService","Info","growl","userEnterpriseService","viewFlexService","userDomainService","window","freeboardservice","dialogue","ngDialog","specialListService","TEXT","SUBMIT","CANCEL","currentGraph","kqiModel","kqiModelId","parseInt","pos","timePeriod","id","label","thumbs","url","color","kqiModelThumb","expertChange","console","log","this","expertModelTypes","shift","instance","$watch","n","o","s","draw","graph","input","layout","setting","editData","replaceCiKpi","setMode","renderLayout","viewId","insText","content","JSON","parse","type","children","source","parameters","theme","style","margin","width","height","advance","expression","toString","kqiModelName","col","viewTitle","viewType","stringify","runEval","fun","eval","e","getKqiModels","callback","event","code","data","saveKqiModel","param","deleteKqiModel","getKqiModelById","a","navigation","createGraphView","open","template","resourceType","resourceId","addView","error","currentNav","navigateClick","saveSpecialist","viewContent","simulate","variables","thumb","fontcolor","find","elem","kqiModelNameEn","save","kModel","success","path","addSimulate","push","removeSim","sim","$remove","index","runKqi","clone","i","split","map","ele","result","init","run","expertModelType","getManagedViewsByTypeAndRole","kqiGraph","r","getViewById"],"mappings":"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","file":"app-oc/js/controllers/specialist-input-ctrl.js","sourcesContent":["define(['controllers/controllers', 'Array'], function (controllers) {\n  'use strict';\n\n  controllers.initController('specialistInputCtrl', ['$scope', '$q', '$rootScope', '$location', '$routeParams', '$timeout', 'kqiManagerUIService', 'userRoleUIService', 'resourceUIService', 'userLoginUIService', 'Info', 'growl', 'userEnterpriseService', 'viewFlexService', 'userDomainService', \"$window\", \"freeboardservice\", 'dialogue', \"ngDialog\", \"specialListService\", function (scope, q, rootScope, $location, $routeParams, timeout, kqiManagerUIService, userRoleUIService, resourceUIService, userLoginUIService, Info, growl, userEnterpriseService, viewFlexService, userDomainService, window, freeboardservice, dialogue, ngDialog, specialListService) {\n    /** {\"id\":10075,\"name\":\"客户月新增数888hhh\",\"desc\":\"0\",\"kpiId\":3043,\"schedule\":\"0 18 0 1 * ?\",\"targetType\":\"all\",\"target\":null,\"targetResource\":null,\"expression\":\"var dateList = new (Java.type(\\\"java.util.ArrayList\\\"));\\ndateList.add(core.getMonthStart(1));\\ndateList.add(core.getMonthStart(0));\\nvar values=core.count(\\\"resource\\\",\\\"domains\\\",{\\\"modelId\\\":301,\\\"createTime\\\":dateList});\\ncore.toKpiValues(values,{domainPath:\\\"domains\\\",value:\\\"count\\\"});\",\"scriptType\":\"js\",\"domainPath\":\"/0/141935137496068/\",\"createTime\":\"2017-04-28T09:58:00.394+0000\",\"updateTime\":\"2017-05-05T11:20:45.997+0000\",\"solutionId\":0,\"enable\":true,\"real\":false,\"granularity\":1,\"granularityUnit\":\"MONTH\",\"dataType\":0,\"domainCalcType\":1,\"aggregateType\":null,\"forecastMethod\":null}*/\n    var TEXT = {\n      \"SUBMIT\": \"确定\",\n      \"CANCEL\": \"取消\"\n    };\n    var currentGraph = {},\n        kqiModel;\n    var kqiModelId = parseInt($routeParams['id']);\n    var pos = $routeParams['pos'];\n    var timePeriod = [{\n      id: 0,\n      label: \"秒\"\n    }, {\n      id: 1,\n      label: \"分钟\"\n    }, {\n      id: 2,\n      label: \"小时\"\n    }, {\n      id: 3,\n      label: \"天\"\n    }];\n    scope.thumbs = [{\n      label: \"灰色背景\",\n      url: \"../app-freeboard/images/dataModel/dataModel1.jpg\",\n      color: \"#fff\"\n    }, {\n      label: \"水滴背景\",\n      url: \"../app-freeboard/images/dataModel/dataModel2.jpg\",\n      color: \"#fff\"\n    }, {\n      label: \"白色背景\",\n      url: \"../app-freeboard/images/dataModel/dataModel3.jpg\",\n      color: \"#000\"\n    }];\n    scope.kqiModelThumb = scope.thumbs[0].url;\n\n    var expertChange = function expertChange() {\n      console.log(this.id);\n    };\n\n    scope.expertModelTypes = specialListService(expertChange);\n    scope.expertModelTypes.shift();\n    scope.instance = {};\n    scope.$watch(\"currentNav\", function (n, o, s) {\n      if (n == 3) {\n        var draw = function draw(graph) {\n          var input = {\n            layout: graph.layout,\n            setting: graph.setting\n          };\n          var editData = new freeboardservice.replaceCiKpi(input, function () {\n            console.log(editData);\n            timeout(function () {\n              scope.instance.setMode(true);\n              scope.instance.renderLayout(editData);\n            });\n          });\n        };\n\n        if (currentGraph.viewId) {\n          scope.insText = \"编辑分析视图\";\n          var content = currentGraph.content;\n          draw(JSON.parse(content));\n        } else {\n          scope.insText = \"导出到分析视图\";\n          var initFn = \"function(event){\\n\\\n            var target = event.target;\\n\\\n            var global = event.global;\\n\\\n            var inx = 0;\\n\\\n            var execute = \" + scope.expression.toString() + \"\\n\\\n            console.log('execute', execute);\\n\\\n            var option = {\\n\\\n              title: {\\n\\\n                text: \\\"\" + scope.kqiModelName + \"\\\"\\n\\\n              },\\n\\\n              tooltip: {\\\n               trigger: 'axis'\\\n              },\\n\\\n              legend: {\\n\\\n                data: execute().map(function(elem){return elem.name;})\\n\\\n              },\\n\\\n              xAxis: {\\n\\\n                data: execute()[0].data.map(function(elem){ inx++;return inx; })\\n\\\n              },\\n\\\n              yAxis: {},\\n\\\n              series: execute().map(function(elem){ elem.type = elem.type || 'line'; return elem;})\\n\\\n            };\\n\\\n            target.render(option);\\n\\\n          }\\n\";\n          var expression = \"{\\n\\\n            on : {\\n\\\n              init : \" + initFn + \"\\n\\\n            }\\n\\\n          }\\n\";\n          var graph = {\n            \"layout\": {\n              \"type\": \"column\",\n              \"children\": [{\n                \"label\": \"高级视图\",\n                \"type\": \"advanceEchart\",\n                \"source\": \"ADVANCEECHART\",\n                \"parameters\": {\n                  \"theme\": \"default\"\n                },\n                \"style\": {\n                  \"margin\": \"auto\",\n                  \"width\": \"100%\",\n                  \"height\": \"600px\"\n                },\n                \"advance\": {\n                  \"expression\": \"expression = \" + expression\n                }\n              }],\n              \"col\": 12\n            },\n            \"setting\": \"{\\n  \\\"theme\\\": \\\"default\\\"\\n}\"\n          };\n          draw(graph);\n          currentGraph = {\n            viewTitle: scope.kqiModelName + \"(专家模型)\",\n            viewType: \"designView\",\n            content: JSON.stringify(graph)\n          };\n        }\n      }\n    });\n\n    var runEval = function runEval(expression) {\n      var fun;\n\n      try {\n        fun = eval(\"(\" + expression + \")\");\n      } catch (e) {\n        console.log(e);\n      }\n\n      return fun;\n    };\n\n    var getKqiModels = function getKqiModels(callback) {\n      kqiManagerUIService.getKqiModels(function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    var saveKqiModel = function saveKqiModel(param, callback) {\n      kqiManagerUIService.saveKqiModel(param, function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    var deleteKqiModel = function deleteKqiModel(param, callback) {\n      kqiManagerUIService.deleteKqiModel(param, function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    var getKqiModelById = function getKqiModelById(id, callback) {\n      kqiManagerUIService.getKqiModelById(id, function (event) {\n        if (event.code == 0) {\n          callback(event.data);\n        }\n      });\n    };\n\n    scope.a = \"aba\";\n    scope.navigation = [{\n      id: 0,\n      label: \"基础设置\"\n    }, {\n      id: 1,\n      label: \"公式输入\"\n    }, {\n      id: 3,\n      label: \"图形展示\"\n    }];\n\n    scope.createGraphView = function () {\n      if (kqiModelId) {\n        var open = function open() {\n          window.open(\"/app-freeboard/index.html#/editor/view/editor/\" + currentGraph.viewId + \"/0\");\n        };\n\n        if (currentGraph.viewId) {\n          open();\n        } else {\n          currentGraph.template = {\n            resourceType: 'kqiModel',\n            resourceId: kqiModelId\n          };\n          viewFlexService.addView(currentGraph, function (data) {\n            if (data.code == 0) {\n              currentGraph = data.data || {};\n              scope.insText = \"编辑仪表板\";\n              open();\n            }\n          });\n        }\n\n        ;\n      } else {\n        growl.error(\"请先保存您的专家模版\");\n      }\n\n      ;\n    };\n\n    scope.currentNav = scope.navigation[0].id;\n\n    scope.navigateClick = function (id) {\n      scope.currentNav = id;\n    };\n\n    scope.saveSpecialist = function () {\n      var check = function check() {\n        if (!scope.kqiModelName) {\n          growl.error(\"请填写视图名称.\");\n          return false;\n        }\n\n        return true;\n      };\n\n      if (check()) {\n        var viewContent = {};\n        viewContent.expression = scope.expression;\n        viewContent.simulate = scope.simulate;\n        viewContent.variables = scope.variables;\n        viewContent.thumb = scope.kqiModelThumb;\n        viewContent.fontcolor = scope.thumbs.find(function (elem) {\n          return elem.url == scope.kqiModelThumb;\n        }).color;\n        viewContent.kqiModelNameEn = scope.kqiModelNameEn;\n\n        var save = function save(kModel) {\n          kqiModel = kModel;\n          var param = kqiModel ? kqiModel : {};\n          param.label = scope.kqiModelName; //param.expertModelType = scope.expertModelType;\n\n          console.log(JSON.stringify(viewContent, null, 2));\n          param.viewContent = JSON.stringify(viewContent);\n          saveKqiModel(param, function (event) {\n            if (kqiModelId) {\n              growl.success(\"修改专家模型成功。\");\n            } else {\n              growl.success(\"保存专家模型成功。\");\n            }\n\n            $location.path(\"specialist/input/\" + event.id);\n          });\n        };\n\n        if (kqiModelId) {\n          getKqiModelById(kqiModelId, function (kqiModel) {\n            save(kqiModel);\n          });\n        } else {\n          save();\n        }\n\n        ;\n      }\n\n      ;\n    };\n\n    scope.addSimulate = function () {\n      scope.simulate.push({});\n    };\n\n    scope.removeSim = function (sim) {\n      scope.simulate.$remove(function (index, elem) {\n        return sim == elem;\n      });\n    };\n\n    scope.runKqi = function (sim) {\n      var clone = {};\n\n      for (var i in sim) {\n        clone[i] = sim[i].split(\",\").map(function (ele) {\n          return parseInt(ele);\n        });\n      }\n\n      var fun = runEval(scope.expression);\n      var result;\n\n      try {\n        result = fun(clone);\n      } catch (e) {\n        console.log(e);\n      } finally {\n        result = result ? result : \"\";\n      }\n\n      return result;\n    };\n\n    var init = function init() {\n      var run = function run(kqiModel) {\n        if (kqiModel) {\n          scope.kqiModelName = kqiModel.label;\n          scope.expertModelType = kqiModel.expertModelType;\n          var viewContent = JSON.parse(kqiModel.viewContent);\n          scope.kqiModelNameEn = viewContent.kqiModelNameEn;\n          scope.expression = viewContent.expression;\n          scope.simulate = viewContent.simulate;\n          scope.variables = viewContent.variables;\n          scope.kqiModelThumb = viewContent.thumb;\n          viewFlexService.getManagedViewsByTypeAndRole(\"designView\", function (event) {\n            if (event.code == 0) {\n              var allGraph = event.data;\n              var kqiGraph = allGraph.find(function (elem) {\n                var r = false;\n\n                if (elem.template) {\n                  if (elem.template.resourceType == 'kqiModel') {\n                    r = elem.template.resourceId == kqiModel.id;\n                  }\n                }\n\n                return r;\n              });\n\n              if (kqiGraph) {\n                viewFlexService.getViewById(kqiGraph.viewId, function (event) {\n                  if (event.code == 0) {\n                    //var content = event.data.content;\n                    currentGraph = event.data || {};\n                    scope.currentNav = pos ? scope.navigation[pos].id : scope.navigation[0].id;\n                  }\n                });\n              } else {\n                scope.currentNav = pos ? scope.navigation[pos].id : scope.navigation[0].id;\n              }\n\n              ;\n            }\n          });\n        } else {\n          scope.currentNav = pos ? scope.navigation[pos].id : scope.navigation[0].id;\n          scope.expertModelType = 0;\n          scope.expression = \"function(){\\n    return [{\\n        name : \\\"专家模型\\\",\\n        data : [5,7,3,5,8,2,4,7]\\n    }]\\n}\";\n          scope.simulate = [];\n          scope.variables = [];\n        }\n\n        var editVarible = function editVarible(target) {\n          var varnamelist = scope.variables.map(function (elem) {\n            return elem.name;\n          });\n          scope.dialog = {\n            title: \"新增变量\",\n            note: {\n              \"message\": \"新增变量名不可重复使用。\"\n            },\n            input: [{\n              \"label\": \"变量名称\",\n              \"maxlength\": 12,\n              \"value\": target ? target.name : \"\",\n              \"right\": true,\n              \"composory\": true,\n              \"data\": \"name\",\n              \"placeholder\": \"变量名称\",\n              \"events\": {\n                \"change\": function change(data) {\n                  if (data.value == \"\") {\n                    data.error = \"变量名不可为空\";\n                    data.right = false;\n                  } else {\n                    if (varnamelist.indexOf(data.value) != -1) {\n                      data.error = \"变量名已存在\";\n                      data.right = false;\n                    } else {\n                      data.error = undefined;\n                      data.right = true;\n                    }\n                  }\n                }\n              },\n              \"type\": \"input\"\n            }, {\n              \"value\": target ? target.period : null,\n              \"label\": \"统计时段\",\n              \"right\": target ? true : false,\n              \"data\": \"period\",\n              \"type\": \"select\",\n              \"composory\": true,\n              \"options\": timePeriod,\n              \"events\": {\n                \"change\": function change(data) {\n                  if (data.value.length == 0) {\n                    data.error = \"默认角色不可为空\";\n                    data.right = false;\n                  } else {\n                    data.error = undefined;\n                    data.right = true;\n                  }\n                }\n              }\n            }],\n            button: [{\n              label: TEXT.SUBMIT,\n              icon: \"btn btn-primary\",\n              disabledFn: function disabledFn() {\n                var some = scope.dialog.input.some(function (elem) {\n                  return elem.right == false;\n                });\n                return some;\n              },\n              fn: function fn() {\n                var self = scope.dialog;\n\n                if (target) {\n                  var loop = function loop(elem) {\n                    target[elem.data] = elem.value;\n                  };\n\n                  for (var i in self.input) {\n                    loop(self.input[i]);\n                  }\n\n                  ;\n                } else {\n                  var newVar = {};\n\n                  var loop = function loop(elem) {\n                    newVar[elem.data] = elem.value;\n                  };\n\n                  for (var i in self.input) {\n                    loop(self.input[i]);\n                  }\n\n                  ;\n                  scope.variables.push(newVar);\n                }\n\n                ngDialog.close();\n              }\n            }, {\n              label: TEXT.CANCEL,\n              icon: \"btn btn-default\",\n              fn: function fn() {\n                ngDialog.close();\n              }\n            }]\n          };\n          ngDialog.open({\n            template: '../partials/dialogue/config_alert_dia.html',\n            className: 'ngdialog-theme-plain',\n            scope: scope\n          });\n        };\n\n        var addNewClick = function addNewClick() {\n          editVarible();\n        };\n\n        var delectClickGroup = function delectClickGroup(event) {\n          var fnlist = [{\n            label: TEXT.SUBMIT,\n            icon: 'btn btn-success',\n            style: {\n              width: '50%',\n              'border-radius': 0,\n              'font-size': '18px',\n              'font-weight': 'bold',\n              'padding': 10\n            },\n            fn: function fn() {\n              ngDialog.close();\n\n              var removeVar = function removeVar(elem) {\n                scope.variables.$remove(function (inx, el) {\n                  return el == elem;\n                });\n              };\n\n              for (var i in event) {\n                removeVar(event[i]);\n              }\n\n              ;\n            }\n          }, {\n            label: TEXT.CANCEL,\n            icon: 'btn btn-default',\n            style: {\n              width: '50%',\n              'border-radius': 0,\n              'font-size': '18px',\n              'font-weight': 'bold',\n              'padding': 10\n            },\n            fn: function fn() {\n              ngDialog.close();\n            }\n          }];\n          scope.dialog = {\n            title: {\n              label: '提示'\n            },\n            description: {\n              label: '确认要删除所选变量吗？'\n            },\n            fnlist: fnlist\n          };\n          ngDialog.open({\n            template: '../partials/dialogue/common_dia_prompt.html',\n            className: 'ngdialog-theme-plain',\n            scope: scope\n          });\n        };\n\n        var editClick = function editClick(target) {\n          editVarible(target);\n        };\n\n        var delectClick = function delectClick(target) {\n          scope.variables.$remove(function (index, elem) {\n            return elem == target;\n          });\n        };\n        /**\n        scope.valinput = {\n          source: scope.variables,\n          header: [{\n            icon: \"fa fa-plus\",\n            class: \"btn btn-primary btn-sm\",\n            label: \"添加变量\",\n            style: {\n              margin: \"2px\"\n            },\n            type: \"button\",\n            events: {\n              click: addNewClick\n            }\n          }, {\n            icon: \"fa fa-minus\",\n            class: \"btn btn-default btn-sm\",\n            label: \"删除变量\",\n            style: {\n              margin: \"2px\"\n            },\n            type: \"button\",\n            disabled: function(event) {\n              var some = event.some(function(elem) {\n                return elem.selected == true;\n              });\n              return !some;\n            },\n            events: {\n              click: delectClickGroup\n            }\n          }],\n          columnDefs: [{\n            label: \"变量名\",\n            width: \"40%\",\n            editable: true,\n            sortable: true,\n            filterable: true,\n            data: \"name\",\n            type: \"text\",\n            modes: {\n              default: {\n                type: \"text\",\n              },\n              edit: {\n                type: \"input\",\n                placeholder: \"例如：请填写用户名，用户名不可为空\"\n              }\n            }\n          },{\n            label: \"时间段\",\n            editable: true,\n            sortable: true,\n            filterable: true,\n            data: \"period\",\n            type: \"select\",\n            format : function(event){\n              return timePeriod[event].label;\n            },\n            options : timePeriod,\n            filterFormat : {\n              \"value\" : \"id\",\n              \"label\" : \"label\"\n            },\n            modes: {\n              default: {\n                type: \"text\",\n              },\n              edit: {\n                type: \"input\",\n                placeholder: \"例如：请填写用户名，用户名不可为空\"\n              }\n            }\n          }, {\n            label: \"操作\",\n            type: \"buttonGroup\",\n            filterable: false,\n            sortable: false,\n            width: \"141px\",\n            modes: {\n              default: {\n                options: [{\n                  label: \"编辑\",\n                  type: \"button\",\n                  class: \"btn btn-default\",\n                  events: {\n                    click: editClick\n                  }\n                },{\n                  label: \"删除\",\n                  type: \"button\",\n                  class: \"btn btn-default\",\n                  events: {\n                    click: delectClick\n                  }\n                }]\n              }\n            }\n          }]\n        };*/\n\n      };\n\n      if (kqiModelId) {\n        getKqiModelById(kqiModelId, function (kqiModel) {\n          run(kqiModel);\n        });\n      } else {\n        run();\n      }\n    };\n\n    init();\n  }]);\n});"],"sourceRoot":"/source/"}