{"version":3,"sources":["app-editor/js/toolkit/modelPanel.js"],"names":["replaceChar","obj","replace","define","jquery","jui","modelPanel","currentType","category","onNodeSelect","gaugeResourseCreator","label","resourcesId","resources","kpis","kpival","resourceTitle","$","leftDom","find","kpislist","nodelist","gauge","i","text","attr","resourceId","nodelabel","css","html","element","unit","kpiId","id","kpiname","name","kpiunit","kpiunit_char","undefined","indexOf","append","each","index","draggable","revert","cursor","cursorAt","top","left","helper","event","target","currentTarget","selectorWrap","selectTemplate_0","selectTemplate_1","selectTemplate_2","numberSelector","on","createCircle","split","length","inx","num","dropOption","greedy","tolerance","accept","activeClass","hoverClass","drop","dropEndFun","removeClass","addClass","droppable","removeElement","removeSelectItem","ui","attributes","kpiid","this","parent","normalResourseCreator","val","removeAttr","applyBtn_gauge_click","nodes","push","nodeId","parseInt","kpi","units","data","applyBtn_normal_click","is","node","renderModel","console","log","modelData","parentDom","traverse","rs","sub","dom","j","elem","JSON","stringify","stopPropagation","parse","children","icon","hasClass","updateModel","type","display","off","rightContent","prop","normalResourseCreateComplete","nodesIsFind","eventName","callback","fn","extend"],"mappings":"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","file":"app-editor/js/toolkit/modelPanel.js","sourcesContent":["define([\"jquery\", \"jquery-ui\"], function (jquery, jui) {\n  var modelPanel = {};\n  var currentType = '';\n  var currentResourceId;\n  var category = '';\n\n  var onNodeSelect = function onNodeSelect() {};\n\n  modelPanel.renderModel = renderModel;\n  modelPanel.updateModel = updateModel;\n  modelPanel.on = onEvent;\n\n  function onEvent(eventName, callback) {\n    switch (eventName) {\n      case \"onNodeSelect\":\n        onNodeSelect = callback;\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  function updateModel(data) {\n    var nodes = data.nodes;\n    var kpis = data.kpis; //console.log(data.nodes, data.kpis);\n\n    currentType = data.type;\n\n    switch (currentType) {\n      case \"line\":\n        category = \"time\";\n        break;\n\n      case \"bar\":\n        category = \"time\";\n        break;\n\n      case \"pie\":\n        category = \"ci\";\n        break;\n\n      case \"gauge\":\n        category = \"ci\";\n        break;\n    }\n\n    if (currentType == 'gauge') {\n      $(\"[gauge]\").css({\n        display: \"block\"\n      });\n      $(\"#applyBtn\").off(\"click\").on(\"click\", applyBtn_gauge_click);\n    } else {\n      $(\"[gauge]\").css({\n        display: \"none\"\n      });\n      $(\"#applyBtn\").off(\"click\").on(\"click\", applyBtn_normal_click);\n    }\n\n    if (nodes) {\n      nodesIsFind();\n    } else {\n      nodesNotFind();\n    }\n\n    function nodesIsFind() {\n      var resourcesId = nodes[0];\n      var rightContent = $(\"#rightContent\");\n      var label = rightContent.find(\"[id=resourcesId_\" + resourcesId + \"]\").attr(\"label\");\n      console.log(\"nodesIsFind\");\n      var resources = JSON.parse(rightContent.find(\"[id=resourcesId_\" + resourcesId + \"]\").attr(\"resources\"));\n      var kpislist = JSON.parse(rightContent.find(\"[id=resourcesId_\" + resourcesId + \"]\").attr(\"kpis\"));\n\n      if (currentType == 'gauge') {\n        gaugeResourseCreator(label, resourcesId, resources, kpislist, kpis);\n        gaugeResourseCreateComplete();\n      } else {\n        normalResourseCreator(label, resourcesId, resources, kpislist);\n        normalResourseCreateComplete();\n      }\n\n      function gaugeResourseCreateComplete() {}\n\n      ;\n\n      function normalResourseCreateComplete() {\n        $(\".leftContent\").css(\"display\", \"block\");\n        $(\"ul#nodelist input[name=resources]\").removeAttr(\"checked\");\n        $(\"ul#kpislist input[name=kpis]\").removeAttr(\"checked\");\n\n        for (var i in nodes) {\n          var nodeId = nodes[i];\n          $(\"ul#nodelist input[name=resources][resourceid=\" + nodeId + \"]\").prop(\"checked\", \"checked\");\n        }\n\n        for (var j in kpis) {\n          var kpiId = kpis[j];\n          $(\"ul#kpislist input[name=kpis][kpiId=\" + kpiId + \"]\").prop(\"checked\", \"checked\");\n        }\n      }\n\n      ;\n    }\n\n    ;\n\n    function nodesNotFind() {\n      $(\".leftContent\").css(\"display\", \"none\");\n    }\n\n    ;\n  }\n\n  ;\n\n  function renderModel(data) {\n    console.log(\"renderModel\", data);\n    var modelData = data;\n    var parentDom = $(\"#rightContent\");\n    var rs = modelData;\n    traverse(rs, parentDom);\n\n    function traverse(rs, parentDom) {\n      if (rs.sub) {\n        for (var i in rs.sub) {\n          if (rs.sub[i].label) {\n            if (rs.sub[i].sub) {\n              var dom = $(\"<div id='modelId_\" + rs.sub[i].id + \"' class='model_item folder show'><span class='glyphicon glyphicon-folder-open'></span><span class='innerTxt'>\" + rs.sub[i].label + \"</span></div>\");\n            } else {\n              var resources = rs.sub[i].resources;\n\n              if (resources != undefined) {\n                var dom = $(\"<div >\\\n\t\t\t\t\t\t\t\t\t\t<span class='glyphicon glyphicon-zoom-out'></span>\\\n\t\t\t\t\t\t\t\t\t\t<span class='innerTxt'>\" + rs.sub[i].label + \"<span>\\\n\t\t\t\t\t\t\t\t\t</div>\").attr({\n                  id: \"modelId_\" + rs.sub[i].id\n                }).addClass(\"model_item show\");\n\n                for (var j in resources) {\n                  var elem = $(\"<div>\\\n\t\t\t\t\t\t\t\t\t\t<span class='glyphicon glyphicon-briefcase'></span>\\\n\t\t\t\t\t\t\t\t\t\t<span class='innerTxt'>\" + resources[j].label + \"<span>\\\n\t\t\t\t\t\t\t\t\t</div>\").attr({\n                    id: \"resourcesId_\" + resources[j].id,\n                    label: resources[j].label,\n                    resources: JSON.stringify(resources),\n                    kpis: JSON.stringify(rs.sub[i].kpis)\n                  }).addClass(\"model_item show\");\n                  parentDom.append(elem);\n                }\n              } else {\n                var dom = $(\"<div id='modelId_\" + rs.sub[i].id + \"' class='model_item'>\" + rs.sub[i].label + \"</div>\");\n              }\n            } //parentDom.append(dom);\n\n\n            traverse(rs.sub[i], dom);\n          } else {\n            traverse(rs.sub[i], parentDom);\n          }\n        }\n      }\n    }\n\n    ;\n    $(\"[id*=resourcesId_]\").on(\"click\", resourceClick);\n    $(\"[id*=modelId_]\").on(\"click\", folderClick);\n\n    function resourceClick(event) {\n      event.stopPropagation();\n\n      switch (currentType) {\n        case \"pie\":\n        case \"line\":\n        case \"bar\":\n          var label = $(event.currentTarget).attr(\"label\");\n          var resourcesId = $(event.currentTarget).attr(\"id\").split(\"_\")[1];\n          var resources = JSON.parse($(event.currentTarget).attr(\"resources\"));\n          var kpis = JSON.parse($(event.currentTarget).attr(\"kpis\"));\n          normalResourseCreator(label, resourcesId, resources, kpis);\n          break;\n\n        case \"gauge\":\n          var label = $(event.currentTarget).attr(\"label\");\n          var resourcesId = $(event.currentTarget).attr(\"id\").split(\"_\")[1];\n          var resources = JSON.parse($(event.currentTarget).attr(\"resources\"));\n          var kpis = JSON.parse($(event.currentTarget).attr(\"kpis\"));\n          gaugeResourseCreator(label, resourcesId, resources, kpis);\n          break;\n      }\n    }\n\n    ;\n\n    function folderClick(event) {\n      event.stopPropagation();\n      var target = $(event.currentTarget);\n      var children = $(target).children(\".model_item\");\n      var icon = $(target).children(\"span.glyphicon\");\n\n      if (children.hasClass('show')) {\n        children.removeClass('show');\n\n        if (icon.hasClass(\"glyphicon-folder-open\")) {\n          icon.removeClass(\"glyphicon-folder-open\").addClass(\"glyphicon-folder-close\");\n        }\n      } else {\n        children.addClass('show');\n\n        if (icon.hasClass(\"glyphicon-folder-close\")) {\n          icon.removeClass(\"glyphicon-folder-close\").addClass(\"glyphicon-folder-open\");\n        }\n      }\n    }\n\n    ;\n  }\n\n  ;\n\n  function gaugeResourseCreator(label, resourcesId, resources, kpis, kpival) {\n    var resourceTitle = $(\"#resourceTitle\");\n    var leftDom = $(\"#modelPanel\").find(\".leftContent\");\n    var kpislist = $(\"#kpislist\");\n    var nodelist = $(\"#nodelist\");\n    var label = label;\n    var resourcesId = resourcesId;\n    var resources = resources;\n    var kpis = kpis;\n    var kpival = kpival;\n    var gauge = leftDom.find(\"[gauge]\");\n    resourceTitle.text(label).attr({\n      \"resourceId\": resourcesId,\n      \"nodelabel\": label\n    });\n    leftDom.css(\"display\", \"block\");\n    $(\"#compare\").css(\"display\", \"none\");\n    nodelist.html(\"\");\n    kpislist.html(\"\");\n    gauge.html(\"\");\n\n    for (var i in kpis) {\n      var element = $(\"<li id='kpiItem_\" + i + \"' class='dragBox'>\\\n\t\t\t\t<div>\\\n\t\t\t\t\" + kpis[i].label + \" (\" + kpis[i].unit + \")\\\n\t\t\t\t</div>\\\n\t\t\t</li>\");\n      element.find(\"div\").attr({\n        kpiId: kpis[i].id,\n        kpiname: kpis[i].name,\n        kpiunit: replaceChar(kpis[i].unit),\n        kpiunit_char: kpis[i].unit,\n        label: kpis[i].label\n      });\n\n      if (kpival != undefined) {\n        var find = kpival.indexOf(kpis[i].id);\n\n        if (find != -1) {\n          element.css(\"display\", \"none\");\n        }\n      }\n\n      kpislist.append(element);\n    }\n\n    kpislist.find(\"[id*=kpiItem_]\").each(function (index, element) {\n      var id = $(element).attr(\"id\");\n      $(\"#\" + id).draggable({\n        revert: \"invalid\",\n        cursor: \"pointer\",\n        cursorAt: {\n          top: 15,\n          left: 50\n        },\n        helper: createHelper\n      });\n\n      function createHelper(event) {\n        var target = $(event.currentTarget).find(\"div\");\n        var elem = $(\"<div class='draghelper'></div>\").text(target.attr(\"label\"));\n        return elem;\n      }\n    });\n    var selectorWrap = $(\"<div class='wrap'></div>\");\n    var selectTemplate_0 = $(\"<div class='big' template><table><td></td></table></div>\");\n    var selectTemplate_1 = $(\"<div class='big' template><table><td></td></table></div>\");\n    var selectTemplate_2 = $(\"<div class='big' template><table><td></td></table></div>\");\n    var numberSelector = $('<div class=\"btn-group\" role=\"toolbar\" aria-label=\"...\" style=\"margin-left : 80px;\">\\\n \t\t\t<div id=\"n_1\" class=\"btn btn-default\" role=\"group\">1</div>\\\n  \t\t\t<div id=\"n_2\" class=\"btn btn-default\" role=\"group\">2</div>\\\n  \t\t\t<div id=\"n_3\" class=\"btn btn-default\" role=\"group\">3</div>\\\n\t\t</div>');\n    gauge.append($(\"<div class='title'>请选择图表个数</div>\")).append(numberSelector).append(selectorWrap);\n    numberSelector.find(\"[id*=n_]\").on(\"click\", numberClick);\n    createCircle(\"\" + (kpival ? kpival.length > 0 ? kpival.length : 1 : 1));\n    var inx = 0;\n    $(\"[template]\").each(function (index, element) {\n      if (kpival != undefined) {\n        var kpiid = kpival[inx];\n\n        find = function (id) {\n          for (var i in kpis) {\n            if (kpis[i].id == id) {\n              return kpis[i];\n            }\n          }\n\n          return undefined;\n        }(kpiid);\n\n        $(element).find(\"td\").text(find.label);\n      }\n\n      inx++;\n    });\n\n    function numberClick(event) {\n      var target = $(event.currentTarget);\n      var id = target.attr(\"id\").split(\"n_\")[1];\n      createCircle(id);\n    }\n\n    function createCircle(num) {\n      function dropOption(greedy) {\n        return {\n          greedy: greedy ? greedy : false,\n          tolerance: \"pointer\",\n          accept: \".dragBox\",\n          activeClass: \"active-highlight\",\n          hoverClass: \"hover-cls\",\n          drop: dropEndFun\n        };\n      }\n\n      switch (num) {\n        case \"1\":\n          selectorWrap.html(\"\").append(selectTemplate_0);\n          selectTemplate_0.removeClass().addClass(\"big\").css(\"margin\", \"6px 0 0 70px\").droppable(dropOption());\n          selectTemplate_1.removeElement();\n          selectTemplate_2.removeElement();\n          removeSelectItem();\n          break;\n\n        case \"2\":\n          selectorWrap.html(\"\").append(selectTemplate_0).append(selectTemplate_1);\n          selectTemplate_0.removeClass().addClass(\"middle\").css(\"margin\", \"12px 0 0 30px\").droppable(dropOption());\n          selectTemplate_1.removeClass().addClass(\"middle\").css(\"margin\", \"12px 0 0 140px\").droppable(dropOption(true));\n          selectTemplate_2.removeElement();\n          removeSelectItem();\n          break;\n\n        case \"3\":\n          selectorWrap.html(\"\").append(selectTemplate_0).append(selectTemplate_2).append(selectTemplate_1);\n          selectTemplate_0.removeClass().addClass(\"small\").css(\"margin\", \"26px 0 0 10px\").droppable(dropOption());\n          selectTemplate_1.removeClass().addClass(\"middle\").css(\"margin\", \"16px 0 0 85px\").droppable(dropOption(true));\n          selectTemplate_2.removeClass().addClass(\"small\").css(\"margin\", \"26px 0 0 180px\").droppable(dropOption());\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    function dropEndFun(event, ui) {\n      var target = $(ui.draggable).find(\"div\");\n      var attributes = {\n        label: target.attr(\"label\"),\n        kpiid: target.attr(\"kpiid\"),\n        name: target.attr(\"kpiname\"),\n        unit: target.attr(\"kpiunit_char\")\n      };\n      $(this).attr(attributes).find(\"td\").text(target.attr(\"label\"));\n      removeSelectItem();\n    }\n\n    function removeSelectItem() {\n      kpislist.find(\"[id*=kpiItem_]\").css(\"display\", \"block\");\n      selectorWrap.find(\"div\").each(function (index, element) {\n        var kpiid = $(element).attr(\"kpiid\");\n        kpislist.find(\"[id*=kpiItem_] [kpiid=\" + kpiid + \"]\").parent().css(\"display\", \"none\");\n      });\n    }\n  }\n\n  $.fn.extend({\n    removeElement: function removeElement() {\n      $(this).find(\"td\").text(\"\");\n      $(this).removeAttr(\"label\");\n      $(this).removeAttr(\"kpiid\");\n    }\n  });\n\n  function normalResourseCreator(label, resourcesId, resources, kpis) {\n    $(\"#compare\").css(\"display\", \"block\");\n    var resourceTitle = $(\"#resourceTitle\");\n    var leftDom = $(\"#modelPanel\").find(\".leftContent\");\n    var kpislist = $(\"#kpislist\");\n    var nodelist = $(\"#nodelist\");\n    var label = label;\n    var resourcesId = resourcesId;\n    var resources = resources;\n    var kpis = kpis;\n    currentResourceId = resourcesId;\n    leftDom.css(\"display\", \"block\");\n    resourceTitle.text(label).attr(\"resourceId\", resourcesId).attr(\"nodelabel\", label);\n    kpislist.html(\"\");\n    nodelist.html(\"\");\n\n    for (var i in resources) {\n      if (resourcesId != resources[i].id) {\n        var element = $(\"<li id='resourceItem' class='checkbox'>\\\n\t\t\t\t\t  <label>\\\n\t\t\t\t\t    <input type='checkbox'>\\\n\t\t\t\t\t    \" + resources[i].label + \"\\\n\t\t\t\t\t  </label>\\\n\t\t\t\t\t</li>\");\n        element.find(\"input:checkbox\").attr({\n          name: \"resources\",\n          resourceId: resources[i].id,\n          nodelabel: resources[i].label\n        });\n        nodelist.append(element);\n      }\n    }\n\n    for (var i in kpis) {\n      var element = $(\"<li id='kpiItem' class='checkbox'>\\\n\t\t\t\t  <label>\\\n\t\t\t\t    <input type='checkbox'>\\\n\t\t\t\t    \" + kpis[i].label + \" (\" + kpis[i].unit + \")\\\n\t\t\t\t  </label>\\\n\t\t\t\t</li>\");\n      element.find(\"input:checkbox\").attr({\n        name: \"kpis\",\n        kpiId: kpis[i].id,\n        kpiname: kpis[i].name,\n        kpiunit: replaceChar(kpis[i].unit),\n        kpiunit_char: kpis[i].unit,\n        label: kpis[i].label\n      });\n      kpislist.append(element);\n    } //$(\"input[name*=resources]\").on('change', resourseOnChange);\n\n\n    $(\"input[name*=kpis]\").on('change', checkBoxOnChange);\n\n    function resourseOnChange(event) {\n      if ($(\"input[name=resources]:checked\").length) {\n        var kpiId = $(\"input[name=kpis]:checked\").first().attr(\"kpiId\");\n        $(\"input[name=kpis][kpiId!=\" + kpiId + \"]\").removeAttr(\"checked\");\n        $(\"input[name=kpis]\").parent().parent().removeClass(\"avaliable\");\n      } else {\n        var kpiunit = $(\"input[name=kpis]:checked\").attr(\"kpiunit\");\n\n        kpiunitChange = function (ku) {}(kpiunit);\n\n        $(\"input[name=kpis][kpiunit*=\" + kpiunit + \"]\").parent().parent().addClass(\"avaliable\");\n      }\n    }\n\n    function checkBoxOnChange(event) {\n      var target = $(event.currentTarget);\n      var kpiId = target.attr(\"kpiId\");\n      var unit = $(event.currentTarget).attr(\"kpiUnit\");\n      var allcheckItem = $(\"input[name*=kpis]\");\n\n      if (target.val()) {\n        $(\"input[name='kpis'][kpiunit!=\" + unit + \"]\").removeAttr(\"checked\");\n        $(\"input[name='kpis'][kpiunit!=\" + unit + \"]\").parent().parent().removeClass(\"avaliable\");\n        $(\"input[name='kpis'][kpiunit*=\" + unit + \"]\").parent().parent().addClass(\"avaliable\");\n      }\n      /*\n      if(!$(\"input[name=kpis]:checked\").length)\n      {\n      \ttarget.prop(\"checked\", \"checked\");\n      \treturn;\n      }\n      if($(\"input[name=resources]:checked\").length)\n      {\n      \tcheckWhenResourcesNotEmpty();\n      }\n      else\n      {\n      \tcheckWhenResourcesIsEmpty();\n      }\n      function checkWhenResourcesNotEmpty(){\n      \tif(target.val())\n      \t{\n      \t\t$(\"input[name=kpis][kpiId!=\" + kpiId + \"]\").removeAttr(\"checked\");\n      \t\t$(\"input[name=kpis][kpiId!=\" + kpiId + \"]\").parent().parent().removeClass(\"avaliable\");\n      \t}\n      }\n      function checkWhenResourcesIsEmpty(){\n      \tif(target.val())\n      \t{\n      \t\t$(\"input[name='kpis'][kpiunit!=\" + unit + \"]\").removeAttr(\"checked\");\n      \t\t$(\"input[name='kpis'][kpiunit!=\" + unit + \"]\").parent().parent().removeClass(\"avaliable\")\n      \t\t$(\"input[name='kpis'][kpiunit*=\" + unit + \"]\").parent().parent().addClass(\"avaliable\");\n      \t}\n      }\n      */\n\n    }\n  }\n\n  function applyBtn_gauge_click(event) {\n    var nodes = [];\n    var kpis = [];\n    var names = [];\n    var units = [];\n    var labels = [];\n    var resourceTitle = $(\"#resourceTitle\");\n    nodes.push({\n      nodeId: parseInt(resourceTitle.attr(\"resourceid\")),\n      label: resourceTitle.attr(\"nodelabel\")\n    });\n    $(\"[gauge]\").find(\"[template]\").each(function (index, element) {\n      var kpi = {\n        kpiId: parseInt($(element).attr(\"kpiId\")),\n        name: $(element).attr(\"name\"),\n        label: $(element).attr(\"label\"),\n        units: $(element).attr(\"unit\")\n      };\n      kpis.push(kpi);\n    });\n    onNodeSelect({\n      category: category,\n      data: {\n        nodes: nodes,\n        kpis: kpis\n      }\n    });\n  }\n\n  function applyBtn_normal_click(event) {\n    var nodes = [];\n    var kpis = [];\n    var names = [];\n    var units = [];\n    var labels = [];\n    var resourceTitle = $(\"#resourceTitle\");\n    nodes.push({\n      nodeId: parseInt(resourceTitle.attr(\"resourceid\")),\n      label: resourceTitle.attr(\"nodelabel\")\n    });\n    $(\"#nodelist\").find(\"input\").each(function (index, element) {\n      if ($(element).is(\":checked\")) {\n        var node = {\n          nodeId: parseInt($(element).attr(\"resourceId\")),\n          label: $(element).attr(\"nodelabel\")\n        };\n        nodes.push(node);\n      }\n    });\n    $(\"#kpislist\").find(\"input\").each(function (index, element) {\n      if ($(element).is(\":checked\")) {\n        var kpi = {\n          kpiId: parseInt($(element).attr(\"kpiId\")),\n          name: $(element).attr(\"kpiName\"),\n          label: $(element).attr(\"label\"),\n          units: $(element).attr(\"kpiunit_char\")\n        };\n        kpis.push(kpi);\n      }\n    });\n    onNodeSelect({\n      category: category,\n      data: {\n        nodes: nodes,\n        kpis: kpis\n      }\n    });\n  }\n\n  return modelPanel;\n});\n\nfunction replaceChar(obj) {\n  return obj.replace(\"/\", \"dash\").replace(\"%\", \"qmark\");\n}"],"sourceRoot":"/source/"}