{"version":3,"sources":["solution/customview/homepage/deviceDetail.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","on","init","event","complete","df","target","tools","getParameter","isNotUndefined","d","sensorMap","a","b","name","childrenMap","id","getDataItemId","dataItem","dataItemId","getNumber","str","match","exec","prop","cell","attr","val","item","attrs","split","filter","rs","shift","last","pop","getDomainAreaLineTree_alertStatus","resource","getMeasureLocate","then","sensors","reduce","getChildren","n","i","l","children","getBrothers","brothers","fd","find","v","$attr","viewId","getViewById","view","json","JSON","parse","e","content","hooks","tap","cells","next","forEach","nodeId","kpiId","ext","kpis","map","render","$on","is","createCurrentStatus","label","x","y","getAlertState","clear","value","setAlarmStatus"],"mappings":"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","file":"solution/customview/homepage/deviceDetail.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine({\n  \"on\": {\n    \"init\": function init(event, complete, df) {\n      var target = event.target,\n          tools = event.tools,\n          id = target.getParameter(\"id\"),\n          main = target.getParameter(\"main\");\n\n      function parse(str) {\n        var a;\n\n        try {\n          a = JSON.parse(str);\n        } catch (e) {\n          return;\n        }\n\n        return a;\n      }\n\n      function isNotUndefined(d) {\n        return typeof d !== \"undefined\";\n      }\n\n      function sensorMap(a, b) {\n        a[b.name] = b;\n        return a;\n      }\n\n      function childrenMap(a, b) {\n        a[b.id] = b;\n        return a;\n      }\n\n      function getDataItemId(dataItem) {\n        return dataItem.dataItemId;\n      }\n\n      function lessThan(num) {\n        return function (d, i) {\n          return i < num;\n        };\n      }\n\n      function getNumber(str) {\n        var match = /(?:.*\\:)*([^\\:]*)/.exec(str);\n\n        if (typeof str == \"string\" || typeof str == \"number\") {\n          return match ? match[1] - 0 : str;\n        }\n      }\n\n      function getString(str) {\n        var match = /(?:.*\\:)*([^\\:]*)/.exec(str);\n\n        if (typeof str == \"string\" || typeof str == \"number\") {\n          return match ? match[1] : str;\n        }\n      }\n\n      function prop(cell, attr, val) {\n        var attrs = attr.split(\"/\").filter(isNotUndefined),\n            item;\n\n        if (typeof val === \"undefined\") {\n          rs = cell;\n\n          while ((item = attrs.shift()) && rs) {\n            rs = rs[item];\n          }\n\n          return rs;\n        }\n\n        var last = attrs.pop(),\n            rs = cell;\n\n        while ((item = attrs.shift()) && rs) {\n          rs = rs[item];\n        }\n\n        if (_typeof(rs) === \"object\") {\n          rs[last] = val;\n        }\n      }\n\n      function attr(cell, attr, val) {\n        var attrs = attr.split(\"/\").filter(isNotUndefined),\n            item;\n\n        if (typeof val === \"undefined\") {\n          rs = cell.attrs;\n\n          while ((item = attrs.shift()) && rs) {\n            rs = rs[item];\n          }\n\n          return rs;\n        }\n\n        var last = attrs.pop(),\n            rs = cell.attrs;\n\n        while ((item = attrs.shift()) && rs) {\n          rs = rs[item];\n        }\n\n        if (_typeof(rs) === \"object\") {\n          rs[last] = val;\n        }\n      }\n\n      target.getDomainAreaLineTree_alertStatus(function (resource) {\n        resource.getMeasureLocate().then(function (sensors) {\n          sensors = sensors.reduce(sensorMap, {});\n          return resource.getChildren(function (n, i, l) {\n            return true;\n          }).then(function (children) {\n            children = children.reduce(childrenMap, {});\n            return resource.getBrothers().then(function (brothers) {\n              var fd = brothers.find(function (v) {\n                return v.$attr(\"values/view/viewId\");\n              }) || {},\n                  viewId = resource.$attr(\"view/viewId\") || resource.$attr(\"values/view/viewId\") || fd.$attr(\"values/view/viewId\");\n              target.getViewById(viewId, function (view) {\n                var json = parse(view.content);\n                target.hooks.tap(\"viewloaded\", function (cells, next) {\n                  cells.forEach(function (cell) {\n                    var name = attr(cell, \"text/text\"),\n                        nodeId = getNumber(prop(cell, \"nodeId\")),\n                        kpiId = getNumber(prop(cell, \"kpiId\")),\n                        ext = prop(cell, \"extend\");\n                    attr(cell, \"rect/visibility\", \"hidden\");\n                    attr(cell, \"circle/visibility\", \"hidden\");\n                    attr(cell, \"text/visibility\", \"hidden\");\n                    attr(cell, \".connection/stroke\", \"#1f8fd8\");\n                    attr(cell, \".connection/stroke-width\", 2);\n                    attr(cell, \".marker-target/visibility\", \"hidden\");\n\n                    if (ext) {\n                      return;\n                    }\n\n                    if (typeof sensors[name] !== \"undefined\") {\n                      prop(cell, \"extend\", \"kpis\");\n                      prop(cell, \"sensor\", name);\n                      prop(cell, \"currentdevice\", 1);\n                      prop(cell, \"dataItem\", sensors[name].kpis.map(getDataItemId));\n                      return;\n                    }\n\n                    if (nodeId) {\n                      if (typeof children[nodeId] !== \"undefined\") {\n                        prop(cell, \"extend\", \"alert\");\n                      } else {\n                        prop(cell, \"sensor\", \"00\");\n                        prop(cell, \"extend\", \"dataItem\");\n                        prop(cell, \"nodeId\", \"number:\" + resource.id);\n                        prop(cell, \"currentdevice\", 1);\n                        prop(cell, \"dataItem\", [kpiId]);\n                      }\n\n                      return;\n                    }\n                  });\n                  next(cells);\n                });\n                target.render(json);\n                target.$on(\"$loadCiKpiComplete\", function (cells) {\n                  var position = {\n                    x: 290,\n                    y: 0\n                  },\n                      is = target.createCurrentStatus(resource.label, position, resource.getAlertState()),\n                      clear = resource.$on(\"alertStateChange\", function (value) {\n                    is.setAlarmStatus(value);\n                  });\n                  target.on(\"$destroy\", function () {\n                    clear();\n                  });\n                });\n              });\n            });\n          });\n        });\n      });\n    }\n  }\n});"],"sourceRoot":"/source/"}