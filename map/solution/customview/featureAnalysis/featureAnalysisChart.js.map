{"version":3,"sources":["solution/customview/featureAnalysis/featureAnalysisChart.js"],"names":["define","on","init","event","target","startDate","$state","params","startdate","Date","getTime","endDate","enddate","startTime","moment","utc","format","endTime","id","$getResourceById","resource","type","callback","condition","dateRangeTime","ci","kpi","instance","i","kpiDes","push","dataItemId","toString","setValue","showLoading","hideNoData","length","extension","isRealTimeData","includeInstance","queryInstances","dataType","aggregateFunc","aggregatePeriod","getKpiValueList","returnData","hideLoading","minDate","reduce","a","b","dt","dateHandler","arisingTime","before","series","after","map","rdata","filter","vdata","kpiCode","sort","dt1","dt2","name","kpiName","symbolSize","data","elem","dh","minus","value","option","title","textStyle","color","grid","containLabel","left","right","tooltip","trigger","formatter","c","str","time","val","marker","seriesIndex","d","clone","addTimeStamp","getDateString","legend","toolbox","feature","restore","dataZoom","saveAsImage","backgroundColor","iconStyle","normal","borderColor","emphasis","xAxis","boundaryGap","max","axisLabel","yAxis","render","showNoData","renderEchart","getValue","off","dblclick","ui","dataIndex","kpiId"],"mappings":"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","file":"solution/customview/featureAnalysis/featureAnalysisChart.js","sourcesContent":["define({\n  on: {\n    init: function init(event) {\n      var target = event.target;\n      var startDate = target.$state.params.startdate ? new Date(target.$state.params.startdate) : new Date(new Date().getTime() - 2 * 60 * 60 * 1000);\n      var endDate = target.$state.params.enddate ? new Date(target.$state.params.enddate) : new Date();\n      var startTime = moment(startDate).utc().format();\n      var endTime = moment(endDate).utc().format(); // 设备的ID\n\n      var id = target.$state.params.id;\n      target.$getResourceById(id, function (resource) {\n        var type; // 渲染echart图\n\n        var renderEchart = function renderEchart(ci, kpi, instance) {\n          // 扩展参数\n          target.showLoading();\n          target.hideNoData();\n\n          if (ci.length > 0 && kpi.length > 0 && instance) {\n            var extension = {\n              isRealTimeData: false,\n              includeInstance: true,\n              startTime: startTime,\n              endTime: endTime\n            };\n\n            if (type == 1) {\n              extension.queryInstances = \"00\"; // 00havg 之前的时平均\n\n              extension.dataType = 11;\n              extension.aggregateFunc = 2;\n              extension.aggregatePeriod = \"1h\";\n            } else if (type == 2) {\n              extension.queryInstances = \"00\";\n              extension.dataType = 11;\n              extension.aggregateFunc = 2;\n              extension.aggregatePeriod = \"1d\";\n            } else {\n              extension.queryInstances = \"00\";\n            }\n\n            var xAxis = [];\n            target.getKpiValueList(ci, kpi, 0, function (returnData) {\n              if (returnData.length > 0) {\n                target.hideLoading();\n                var minDate = returnData.reduce(function (a, b) {\n                  var dt = target.dateHandler(b.arisingTime);\n\n                  if (a) {\n                    if (dt.before(a)) {\n                      return dt;\n                    } else {\n                      return a;\n                    }\n                  } else {\n                    return dt;\n                  }\n                }, null);\n                var maxDate = returnData.reduce(function (a, b) {\n                  var dt = target.dateHandler(b.arisingTime);\n\n                  if (a) {\n                    if (dt.after(a)) {\n                      return dt;\n                    } else {\n                      return a;\n                    }\n                  } else {\n                    return dt;\n                  }\n                }, null);\n                var endInx = 0;\n                var series = kpiDes.map(function (kpi) {\n                  var rdata = returnData.filter(function (vdata) {\n                    var kpiCode = vdata.kpiCode;\n                    var instance = vdata.instance;\n                    return kpi.dataItemId == kpiCode;\n                  });\n                  rdata.sort(function (a, b) {\n                    var dt1 = new Date(a.arisingTime);\n                    var dt2 = new Date(b.arisingTime);\n                    return dt1.getTime() - dt2.getTime();\n                  });\n                  var rs = {\n                    name: kpi.kpiName,\n                    type: \"line\",\n                    symbolSize: 0,\n                    data: rdata.map(function (elem) {\n                      var dt = new Date(elem.arisingTime);\n                      var dh = target.dateHandler(dt);\n                      var D2017 = target.dateHandler(\"2017/01/01\");\n                      var result = dh.minus(minDate);\n                      return [result, elem.value];\n                    })\n                  };\n                  return rs;\n                });\n                /**\n                 var seriesData = []\n                 if (returnData) {\n                for (var i in kpi) {\n                  var item = {\n                    name: kpiName,\n                    data: returnData.map(function (elem) {\n                      return elem.value;\n                    })\n                  }\n                  seriesData.push(item);\n                }\n                }*/\n\n                var option = {\n                  title: {\n                    textStyle: {\n                      color: \"#fff\"\n                    }\n                  },\n                  grid: {\n                    containLabel: \"true\",\n                    left: \"23px\",\n                    right: \"50px\"\n                  },\n                  tooltip: {\n                    trigger: 'axis',\n                    formatter: function formatter(params, b, c) {\n                      var str = \"\";\n\n                      for (var i in params) {\n                        var time = params[i].value[0];\n                        var val = params[i].value[1];\n                        var marker = params[i].marker;\n                        var seriesIndex = params[i].seriesIndex;\n                        var d = minDate.clone().addTimeStamp(time);\n\n                        if (kpi) {\n                          str += marker + kpiDes[seriesIndex].kpiName;\n                          str += \":\" + val + \"[\" + d.getDateString(\"MM/dd,hh:mm:ss\") + \"]<br>\";\n                        }\n\n                        ;\n                      }\n\n                      return str;\n                    }\n                  },\n                  legend: {\n                    data: series.map(function (elem) {\n                      return elem.name;\n                    })\n                  },\n                  toolbox: {\n                    feature: {\n                      restore: {},\n                      dataZoom: {},\n                      saveAsImage: {\n                        type: \"png\",\n                        name: \"振动分析-特征趋势图\",\n                        backgroundColor: \"#0b2232\"\n                      }\n                    },\n                    iconStyle: {\n                      normal: {\n                        borderColor: \"#fff\"\n                      },\n                      emphasis: {\n                        borderColor: \"#e6e2e2\"\n                      }\n                    }\n                  },\n                  xAxis: {\n                    boundaryGap: false,\n                    type: 'value',\n                    max: \"dataMax\",\n                    axisLabel: {\n                      formatter: function formatter(params) {\n                        var d = minDate.clone().addTimeStamp(params);\n                        return d.getDateString(\"MM/dd,hh:mm:ss\");\n                      }\n                    }\n                  },\n                  yAxis: {\n                    type: 'value'\n                  },\n\n                  /**\n                   dataZoom: [{\n                    show: false,\n                    realtime: true,\n                    start: 80,\n                    end: 100,\n                  }],*/\n                  series: series.map(function (elem) {\n                    elem.type = \"line\";\n                    elem.symbolSize = 0;\n                    elem.data = elem.data;\n                    return elem;\n                  })\n                };\n                var ins = target.render(option);\n              } else {\n                target.showNoData();\n              }\n            }, extension);\n          } else {\n            target.showNoData();\n          }\n        };\n\n        var callback = function callback(condition) {\n          startTime = moment(condition.dateRangeTime[0]).utc().format();\n          endTime = moment(condition.dateRangeTime[1]).utc().format();\n          type = condition.type;\n          var ci = [resource.id];\n          var kpi = [];\n          var instance = [];\n          kpiDes = condition.kpi;\n\n          for (var i in condition.kpi) {\n            kpi.push(condition.kpi[i].dataItemId);\n            instance.push(condition.kpi[i].instance);\n          }\n\n          instance = instance.toString();\n          target.setValue(\"featureEchart\", null);\n          renderEchart(ci, kpi, instance);\n        };\n\n        var condition = target.getValue(\"featureEchart\");\n\n        if (condition) {\n          callback(condition);\n        }\n\n        target.off(\"drawDiagnoseFeatureEchart1\");\n        target.on(\"drawDiagnoseFeatureEchart1\", function (condition) {\n          callback(condition);\n        });\n      });\n    },\n    dblclick: function dblclick(event) {\n      var target = event.target;\n      var returnData = target.getValue(\"echarts/data\"); //如果双击的index在数据里有\n\n      if (returnData && returnData[event.ui.dataIndex]) {\n        var dt = returnData[event.ui.dataIndex];\n        target.setValue(\"global/sensor\", {\n          kpiId: dt.kpiCode,\n          instance: dt.instance\n        });\n        target.setValue(\"global/dt\", dt);\n        target.setValue(\"global/time\", target.dateHandler(dt.arisingTime));\n        target.trigger(\"analysisShakeNavigateTo\", 2);\n      }\n    }\n  }\n});"],"sourceRoot":"/source/"}