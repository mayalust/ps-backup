{"version":3,"sources":["solution/customview/urgentKPIcomparing_1.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","define","on","init","event","target","selections","kpi","instance","instanLists","kpis","kpiss","titles","resourceCache","createCache","getTitle","t","cached","val","clone","rs","i","toLowerCase","str","getPhysicalConfigById","id","callback","getResourceById","resource","console","log","sourceValue","eval","values","MeasurePointLocate","length","k","j","push","physicalConfig","accessConfigs","getDirectChild","n","l","getDomainAreaLineTree","domaintree","getRoot","then","root","traverse","inx","children","modelId","renderByDevice","device","filter","elem","render","ctrlgroup","loop","selection","_row$push","row","type","$location","class","loopElement","element","options","parent","change","sel","resourceType","slice","parseInt","colSpan","name","ele","format","label","btnclass","click","trigger","a"],"mappings":"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","file":"solution/customview/urgentKPIcomparing_1.js","sourcesContent":["function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\ndefine({\n  on: {\n    init: function init(event) {\n      var target = event.target,\n          selections = [],\n          kpi,\n          instance,\n          instanLists = [],\n          kpis = [],\n          kpiss = [],\n          titles = ['基地', '厂区', '产线', '设备区域', '设备'],\n          resourceCache = createCache();\n\n      function getTitle(t) {\n        switch (t) {\n          case \"devicegroup\":\n            return \"虚拟大设备\";\n\n          case \"index\":\n            return \"虚拟大设备\";\n\n          case \"production\":\n            return \"设备区域\";\n\n          case \"navigate\":\n            return \"基地\";\n\n          case \"device\":\n            return \"设备\";\n\n          case \"factory\":\n            return \"厂区\";\n\n          case \"motor\":\n            return \"电机\";\n\n          case \"viewByModel\":\n            return \"设备\";\n        }\n      }\n\n      function createCache() {\n        var cached = function cached(key, val) {\n          cached[key] = val;\n        };\n\n        return cached;\n      }\n\n      function clone(obj) {\n        var rs = [];\n\n        for (var i in obj) {\n          rs[i] = obj[i];\n        }\n\n        ;\n        return rs;\n      }\n\n      function toLowerCase(str) {\n        return typeof str === \"string\" ? str.toLowerCase() : \"\";\n      }\n\n      function getPhysicalConfigById(id, callback) {\n        resourceCache[id] ? callback(resourceCache[id]) : target.getResourceById(id, function (resource) {\n          console.log(\"resource\", resource); // 拼接设备下的所有测点\n\n          var sourceValue = eval(resource.values.MeasurePointLocate);\n\n          if (sourceValue.length > 0) {\n            instanLists = [];\n\n            for (var i = 0; i < sourceValue.length; i++) {\n              for (var k in sourceValue[i]) {\n                for (var j = 0; j < sourceValue[i][k].length; j++) {\n                  instanLists.push(sourceValue[i][k][j]);\n                }\n              }\n            }\n          }\n\n          resourceCache[id] = resource ? resource.physicalConfig ? resource.physicalConfig.accessConfigs : [] : [];\n          callback(resourceCache[id]);\n        });\n      } //获取数据项\n\n\n      function getDirectChild(n, i, l) {\n        return l < 2;\n      }\n\n      target.getDomainAreaLineTree(function (domaintree) {\n        domaintree.getRoot().then(function (root) {\n          function traverse(inx, children) {\n            if (children) {\n              selections[inx] = children[0];\n\n              if (selections[inx].children) {\n                return traverse(inx + 1, selections[inx].children);\n              } else if (selections[inx].modelId > 1000) {\n                return selections[inx];\n              } else {\n                return null;\n              }\n            } else {\n              return null;\n            }\n          }\n\n          function renderByDevice(device) {\n            if (device) {\n              getPhysicalConfigById(device.id, function (accessConfigs) {\n                kpis = accessConfigs.filter(function (elem) {\n                  return true;\n                }); //kpi = kpis[0] || {};\n\n                render();\n              });\n            } else {\n              render();\n            }\n          }\n\n          function render() {\n            var ctrlgroup = [];\n\n            var loop = function loop(inx, selection) {\n              var row = [{\n                type: \"label\",\n                value: getTitle(selection.$location) || titles[inx],\n                class: \"col-md-3\"\n              }];\n\n              if (selections.length > 5 && inx == 4) {\n                var loopElement = function loopElement(i, element) {\n                  row.push({\n                    type: \"select\",\n                    value: selections[i].id,\n                    options: selections[i].parent.children,\n                    class: \"col-md-3\",\n                    on: {\n                      change: function change(event) {\n                        var sel = event.value,\n                            device;\n\n                        if (sel.resourceType !== \"device\") {\n                          selections[i] = sel;\n                          selections = selections.slice(0, i + 1);\n                          device = traverse(i + 1, sel.children);\n                          renderByDevice(device);\n                        } else {\n                          selections[i] = sel;\n                          renderByDevice(sel);\n                        }\n                      }\n                    }\n                  });\n                };\n\n                for (var i = inx; i < selections.length; i++) {\n                  loopElement(i, selections[i]);\n                }\n              } else {\n                var _row$push;\n\n                row.push((_row$push = {\n                  type: \"select\",\n                  value: selection.id,\n                  options: []\n                }, _defineProperty(_row$push, \"options\", selection.parent.children), _defineProperty(_row$push, \"class\", inx != selections.length - 1 ? \"col-md-9\" : \"col-md-6\"), _defineProperty(_row$push, \"colSpan\", 3), _defineProperty(_row$push, \"on\", {\n                  change: function change(event) {\n                    var sel = event.value,\n                        device;\n\n                    if (sel.modelId > 1000) {\n                      selections[inx] = sel;\n                      selections = selections.slice(0, inx + 1);\n                      device = traverse(inx + 1, sel.children);\n                      renderByDevice(device);\n                    } else {\n                      selections[inx] = sel;\n                      renderByDevice(sel);\n                    }\n                  }\n                }), _row$push));\n              }\n\n              ctrlgroup.push(row);\n            };\n\n            for (var i = 0; i < (selections.length > 5 ? 5 : selections.length); i++) {\n              loop(parseInt(i), selections[i]);\n            } // 测点\n\n\n            if (instanLists.length > 0) {\n              ctrlgroup.push([{\n                type: \"label\",\n                value: '测点',\n                class: \"col-md-3\"\n              }, {\n                type: \"select\",\n                value: instance,\n                options: instanLists,\n                class: \"col-md-6\",\n                colSpan: 2,\n                on: {\n                  change: function change(event) {\n                    instance = event.value.name;\n                    kpiss = kpis.filter(function (ele) {\n                      return ele.instance == instance;\n                    });\n                    render();\n                  }\n                },\n                format: {\n                  id: \"name\",\n                  label: \"label\"\n                }\n              }]);\n            }\n\n            ctrlgroup.push([{\n              type: \"label\",\n              value: '指标',\n              class: \"col-md-3\"\n            }, {\n              type: \"select\",\n              //value: kpi.dataItemId,\n              options: kpiss,\n              class: \"col-md-6\",\n              colSpan: 2,\n              on: {\n                change: function change(event) {\n                  var sel = event.value;\n                  kpi = sel; //render();\n                }\n              },\n              format: {\n                id: \"dataItemId\",\n                label: \"kpiName\"\n              }\n            }, {\n              type: \"button\",\n              value: \"加入对比\",\n              class: \"col-md-3\",\n              btnclass: \"btn btn-primary pull-right\",\n              on: {\n                click: function click(event) {\n                  target.trigger(\"addToSelection\", {\n                    selections: clone(selections),\n                    kpi: kpi\n                  });\n                }\n              }\n            }]);\n            target.render(ctrlgroup);\n          }\n\n          var a = traverse(0, root[0].children);\n          console.log(a);\n          renderByDevice(a);\n        });\n      });\n    }\n  }\n});"],"sourceRoot":"/source/"}