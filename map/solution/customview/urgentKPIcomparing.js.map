{"version":3,"sources":["solution/customview/urgentKPIcomparing.js"],"names":["define","on","init","event","kpi","target","selections","kpis","titles","resourceCache","cached","key","val","getDomainAreaLineTree","domaintree","getRoot","then","rootNode","console","log","getChildren","children","traverse","inx","str","resourceType","toLowerCase","renderByDevice","device","id","callback","accessConfigs","filter","elem","instance","render","getResourceById","resource","physicalConfig","ctrlgroup","loop","selection","row","type","value","t","getTitle","$location","class","length","loopElement","i","element","push","options","parent","change","sel","slice","colSpan","parseInt","dataItemId","format","label","btnclass","click","trigger","obj","rs","clone","root"],"mappings":"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","file":"solution/customview/urgentKPIcomparing.js","sourcesContent":["define({\n  on: {\n    init: function init(event) {\n      var target = event.target,\n          selections = [],\n          kpi,\n          kpis = [],\n          titles = ['基地', '厂区', '产线', '设备区域', '设备'];\n      resourceCache = createCache();\n\n      function getTitle(t) {\n        switch (t) {\n          case \"devicegroup\":\n            return \"虚拟大设备\";\n\n          case \"index\":\n            return \"虚拟大设备\";\n\n          case \"production\":\n            return \"设备区域\";\n\n          case \"navigate\":\n            return \"基地\";\n\n          case \"device\":\n            return \"设备\";\n\n          case \"factory\":\n            return \"厂区\";\n\n          case \"motor\":\n            return \"电机\";\n        }\n      }\n\n      function createCache() {\n        var cached = function cached(key, val) {\n          cached[key] = val;\n        };\n\n        return cached;\n      }\n\n      function clone(obj) {\n        var rs = [];\n\n        for (var i in obj) {\n          rs[i] = obj[i];\n        }\n\n        ;\n        return rs;\n      }\n\n      function toLowerCase(str) {\n        return typeof str === \"string\" ? str.toLowerCase() : \"\";\n      }\n\n      function getPhysicalConfigById(id, callback) {\n        resourceCache[id] ? callback(resourceCache[id]) : target.getResourceById(id, function (resource) {\n          resourceCache[id] = resource ? resource.physicalConfig ? resource.physicalConfig.accessConfigs : [] : [];\n          callback(resourceCache[id]);\n        });\n      }\n\n      target.getDomainAreaLineTree(function (domaintree) {\n        domaintree.getRoot().then(function (rootNode) {\n          console.log(rootNode);\n        });\n        domaintree.getChildren(function () {\n          return true;\n        }).then(function (children) {\n          function traverse(inx, children) {\n            return children ? (selections[inx] = children[0], selections[inx].children ? traverse(inx + 1, selections[inx].children) : toLowerCase(selections[inx].resourceType) ? selections[inx] : null) : null;\n          }\n\n          function renderByDevice(device) {\n            if (device) {\n              getPhysicalConfigById(device.id, function (accessConfigs) {\n                kpis = accessConfigs.filter(function (elem) {\n                  return elem.instance == \"00\";\n                });\n                kpi = kpis[0] || {};\n                render();\n              });\n            } else {\n              render();\n            }\n          }\n\n          function render() {\n            var ctrlgroup = [];\n\n            var loop = function loop(inx, selection) {\n              var row = [{\n                type: \"label\",\n                value: getTitle(selection.$location) || titles[inx],\n                class: \"col-md-3\"\n              }];\n\n              if (selections.length > 5 && inx == 4) {\n                var loopElement = function loopElement(i, element) {\n                  row.push({\n                    type: \"select\",\n                    value: selections[i].id,\n                    options: selections[i].parent.children,\n                    class: \"col-md-3\",\n                    on: {\n                      change: function change(event) {\n                        var sel = event.value,\n                            device;\n\n                        if (sel.resourceType !== \"device\") {\n                          selections[i] = sel;\n                          selections = selections.slice(0, i + 1);\n                          device = traverse(i + 1, sel.children);\n                          renderByDevice(device);\n                        } else {\n                          selections[i] = sel;\n                          renderByDevice(sel);\n                        }\n                      }\n                    }\n                  });\n                };\n\n                for (var i = inx; i < selections.length; i++) {\n                  loopElement(i, selections[i]);\n                }\n              } else {\n                row.push({\n                  type: \"select\",\n                  value: selection.id,\n                  options: selection.parent.children,\n                  class: inx != selections.length - 1 ? \"col-md-9\" : \"col-md-6\",\n                  colSpan: 3,\n                  on: {\n                    change: function change(event) {\n                      var sel = event.value,\n                          device;\n\n                      if (sel.resourceType !== \"device\") {\n                        selections[inx] = sel;\n                        selections = selections.slice(0, inx + 1);\n                        device = traverse(inx + 1, sel.children);\n                        renderByDevice(device);\n                      } else {\n                        selections[inx] = sel;\n                        renderByDevice(sel);\n                      }\n                    }\n                  }\n                });\n              }\n\n              ctrlgroup.push(row);\n            };\n\n            for (var i = 0; i < (selections.length > 5 ? 5 : selections.length); i++) {\n              loop(parseInt(i), selections[i]);\n            }\n\n            if (kpi) {\n              ctrlgroup.push([{\n                type: \"label\",\n                value: '指标',\n                class: \"col-md-3\"\n              }, {\n                type: \"select\",\n                value: kpi.dataItemId,\n                options: kpis,\n                class: \"col-md-6\",\n                colSpan: 2,\n                on: {\n                  change: function change(event) {\n                    var sel = event.value;\n                    kpi = sel;\n                    render();\n                  }\n                },\n                format: {\n                  id: \"dataItemId\",\n                  label: \"kpiName\"\n                }\n              }, {\n                type: \"button\",\n                value: \"加入对比\",\n                class: \"col-md-3\",\n                btnclass: \"btn btn-primary pull-right\",\n                on: {\n                  click: function click(event) {\n                    target.trigger(\"addToSelection\", {\n                      selections: clone(selections),\n                      kpi: kpi\n                    });\n                  }\n                }\n              }]);\n            }\n\n            ;\n            target.render(ctrlgroup);\n          }\n\n          renderByDevice(traverse(0, root[0].children));\n        });\n      });\n    }\n  }\n});"],"sourceRoot":"/source/"}