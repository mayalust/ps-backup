{"version":3,"sources":["solution/customview/main_navi.js"],"names":["define","on","init","event","runtime","target","user","getCurrentUser","roleID","currentRoleID","split","getRoleByID","role","tabs","JSON","parse","values","map","t","i","id","label","name","alias","viewId","setValue","length","push","default","CACHEDVALUENAME","CHANGENAVEEVENT","setScopeValue","main","path","temp_view","param","getParameter","Array","indexOf","editMode","subTabs","updateNaviList","obj","saveEditorStatus","select","item","trigger","getScopeValue","saveView","callback","updateView","viewTitle","viewType","data","run","json","getAllMyViews","views","find","view","addView","content","Info","stringify","render","tabFilter","filter","elem","show","tabsClone","clone","$clone","click","el","navigateTo","addOn","icon","linkTo","createPopupBypath","title","theme","width","submit","subTabsFilter","subTabsClone","tabInx","$extension","inx","splice","deleteView","concat","clist","setTimeout","class","format"],"mappings":"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","file":"solution/customview/main_navi.js","sourcesContent":["define({\n  \"on\": {\n    \"init\": function init(event) {\n      runtime(\"主导航TAB开始加载\");\n      var target = event.target;\n      var user = target.getCurrentUser();\n      var roleID = user.currentRoleID ? user.currentRoleID.split(\",\")[0] : user.roleID;\n      target.getRoleByID(roleID, function (role) {\n        var tabs = JSON.parse(role.values) || [];\n        tabs = tabs.map(function (t, i) {\n          return {\n            id: i,\n            label: t.name,\n            alias: t.alias,\n            viewId: t.viewId\n          };\n        });\n        var ROLE = -1; //-1表示不启用任何原来的配置\n\n        target.setValue(\"global/ROLE\", ROLE);\n        target.setValue(\"global/tabs\", tabs); //如果存在choselist和配置，则使用该内容\n        //没有的话设置一个\n\n        if (!tabs || tabs.length == 0) {\n          tabs = [];\n          tabs.push({\n            id: 0,\n            label: \"我的首页\",\n            default: \"baogang/alert/home\"\n          });\n        }\n\n        var CACHEDVALUENAME = \"controlPanelLevel1Navigation\";\n        var CHANGENAVEEVENT = \"lv1viewchange\";\n        var MOVETOEVENT = \"lv1moveTo\";\n        var NAVIGATETO = \"navigateTo\"; // ------------------- 初始化内容在这里设置\n\n        target.setScopeValue(\"CACHEDVALUENAME\", CACHEDVALUENAME);\n        target.setScopeValue(\"CHANGENAVEEVENT\", CHANGENAVEEVENT);\n        target.setScopeValue(\"MOVETOEVENT\", MOVETOEVENT);\n        var param = target.getParameter(\"main\");\n        var main, path, temp_view;\n\n        if (param instanceof Array) {\n          main = param[0];\n          path = param[1];\n\n          if (path.indexOf(\"viewId:\") != -1) {\n            temp_view = {\n              viewId: path.split(\"viewId:\")[1]\n            };\n          }\n        } else {\n          main = param;\n        }\n\n        var editMode = false;\n        var subTabs = [];\n\n        var updateNaviList = function updateNaviList() {\n          var obj = {\n            tabs: tabs,\n            subTabs: subTabs,\n            editMode: editMode\n          };\n          target.saveEditorStatus(CACHEDVALUENAME, obj);\n        };\n\n        var select = function select(item, path) {\n          var viewId = item.viewId;\n\n          if (temp_view) {\n            target.setScopeValue(\"INITPARAMS\", {\n              item: temp_view\n            });\n          } else {\n            target.setScopeValue(\"INITPARAMS\", {\n              item: item,\n              path: path\n            });\n          }\n\n          target.trigger(CHANGENAVEEVENT, target.getScopeValue(\"INITPARAMS\"));\n        };\n\n        var saveView = function saveView(item, callback) {\n          var viewTitle = item.label;\n          var viewType = \"dashboard\";\n          var viewId = item.viewId;\n\n          if (viewId) {\n            target.updateView({\n              viewId: viewId,\n              viewTitle: item.label,\n              viewType: \"dashboard\"\n            }, function (data) {\n              callback(data);\n            });\n          } else {\n            var run = function run(json) {\n              var viewTitle = item.label + \"(\" + (item.default || \"自定义\") + \")\";\n              target.getAllMyViews(function (views) {\n                var find = views.find(function (view) {\n                  viewTitle == view.viewTitle;\n                });\n\n                if (find) {\n                  item.viewId = find.viewId;\n                  callback(find);\n                } else {\n                  target.addView({\n                    viewTitle: item.label + \"(\" + (item.default || \"自定义\") + \")\",\n                    viewType: \"dashboard\",\n                    content: json ? json : null\n                  }, function (data) {\n                    item.viewId = data.data.viewId;\n                    callback(data);\n                  });\n                }\n              });\n            };\n\n            if (item.default) {\n              target.Info(\"../../localdb/echartTemplate/\" + item.default + \".json\", function (json) {\n                run(JSON.stringify(json));\n              });\n            } else {\n              run();\n            }\n          }\n        };\n\n        var deleteView = function deleteView(item) {\n          if (item.viewId) {\n            target.deleteView(item.viewId);\n          }\n\n          ;\n        };\n\n        var render = function render(view) {\n          var tabFilter = tabs.filter(function (elem) {\n            return elem.show != false || editMode;\n          });\n          var tabsClone = tabFilter.map(function (elem) {\n            var clone = elem.$clone();\n            clone.on = {\n              click: function click(el) {\n                /**\n                target.setParameter(\"main\", elem.id);\n                target.trigger(CHANGENAVEEVENT, {\n                  item : elem\n                });\n                main = tabsClone.indexOf(clone);\n                render()*/\n                target.navigateTo(\"index\", {\n                  main: elem.id\n                }, \"self\");\n              }\n            };\n\n            if (editMode) {\n              clone.addOn = [{\n                icon: \"glyphicon glyphicon-scale\",\n                on: {\n                  click: function click(el) {\n                    var run = function run() {\n                      var viewId = elem.viewId;\n                      target.linkTo(\"../app-freeboard/index.html#/freeboard/view/dashboard/\" + elem.viewId + \"/0\");\n                    };\n\n                    if (!elem.viewId) {\n                      saveView(elem, function () {\n                        updateNaviList();\n                        run();\n                      });\n                    } else {\n                      run();\n                    }\n                  }\n                }\n              }, {\n                icon: \"glyphicon glyphicon-edit\",\n                on: {\n                  click: function click(event) {\n                    target.createPopupBypath(\"info\", {\n                      title: \"工作台信息\",\n                      theme: \"system\",\n                      width: 500,\n                      on: {\n                        submit: function submit(item) {}\n                      }\n                    }, elem);\n                  }\n                }\n              }];\n            }\n\n            ;\n            return clone;\n          });\n          var subTabsFilter = subTabs.filter(function (elem) {\n            return elem.show || editMode;\n          });\n          var subTabsClone = subTabsFilter.map(function (elem) {\n            var clone = elem.$clone();\n            clone.on = {\n              click: function click(el) {\n                target.tabInx = tabFilter.length + subTabsFilter.indexOf(elem);\n                render();\n              }\n            };\n\n            if (editMode) {\n              clone.$extension({\n                addOn: [{\n                  icon: \"glyphicon glyphicon-edit\",\n                  on: {\n                    click: function click() {\n                      target.createPopupBypath(\"popup\", {\n                        title: \"编辑工作台\",\n                        theme: \"system\",\n                        width: 500,\n                        on: {\n                          submit: function submit(item) {\n                            elem.label = item.name;\n                            elem.id = item.id;\n                            saveView(elem, function () {\n                              updateNaviList();\n                              render();\n                            });\n                          }\n                        }\n                      }, elem);\n                    }\n                  }\n                }, {\n                  icon: \"glyphicon glyphicon-scale\",\n                  on: {\n                    click: function click(event) {\n                      target.linkTo(\"../app-freeboard/index.html#/freeboard/view/dashboard/\" + elem.viewId + \"/0\");\n                    }\n                  }\n                }, {\n                  icon: \"proudsmart ps-delete-02\",\n                  on: {\n                    click: function click(event) {\n                      var inx = subTabs.indexOf(elem);\n                      subTabs.splice(inx, 1);\n                      deleteView(elem);\n                      updateNaviList();\n                      render();\n                    }\n                  }\n                }]\n              });\n            }\n\n            return clone;\n          });\n          var concat = tabFilter.concat(subTabsFilter);\n\n          if (view) {\n            target.tabInx = concat.indexOf(view);\n          }\n\n          ;\n          var find = concat.find(function (elem) {\n            return elem.id == main;\n          });\n\n          if (find) {\n            target.tabInx = concat.indexOf(find);\n          }\n\n          ;\n\n          if (target.tabInx > concat.length - 1) {\n            target.tabInx = concat.length - 1;\n          }\n\n          ;\n          select(concat[target.tabInx], path);\n\n          if (editMode) {\n            var clist = tabsClone.concat(subTabsClone).concat([{\n              id: -1,\n              label: \"\",\n              icon: \"glyphicon glyphicon-plus\",\n              on: {\n                click: function click(elem) {\n                  target.createPopupBypath(\"popup\", {\n                    title: \"新建工作台\",\n                    theme: \"system\",\n                    width: 500,\n                    on: {\n                      submit: function submit(item) {\n                        var item = {\n                          id: item.id,\n                          label: item.name\n                        };\n                        saveView(item, function () {\n                          subTabs.push(item);\n                          updateNaviList();\n                          render();\n                        });\n                      }\n                    }\n                  });\n                }\n              }\n            }, {\n              id: -1,\n              label: \"\",\n              icon: \"glyphicon glyphicon-cog\",\n              on: {\n                click: function click(elem) {\n                  target.createPopupBypath(\"setting\", {\n                    title: \"设置\",\n                    theme: \"system\",\n                    width: 500,\n                    on: {\n                      submit: function submit(data) {\n                        tabs = data.tabs;\n                        editMode = data.editMode;\n                        subTabs = data.subTabs;\n                        updateNaviList();\n                        render();\n                      }\n                    }\n                  }, {\n                    editMode: editMode,\n                    tabs: tabs,\n                    subTabs: subTabs\n                  });\n                }\n              }\n            }, {\n              id: -2,\n              label: \"\",\n              icon: \"glyphicon glyphicon-transfer\",\n              on: {\n                click: function click(elem) {\n                  target.createPopupBypath(\"viewpare\", {\n                    title: \"配置区域，产线，设备对应的组太视图\",\n                    theme: \"system\",\n                    width: 700,\n                    on: {\n                      submit: function submit(data) {\n                        target.createPopupBypath(\"viewpare\", {\n                          title: \"配置视图\",\n                          theme: \"system\",\n                          width: 500,\n                          on: {\n                            submit: function submit(item) {}\n                          }\n                        });\n                      }\n                    }\n                  });\n                }\n              }\n            }]);\n          } else {\n            var clist = tabsClone.concat(subTabsClone).concat([{\n              id: -1,\n              label: \"\",\n              icon: \"glyphicon glyphicon-cog\",\n              on: {\n                click: function click(elem) {\n                  target.createPopupBypath(\"setting\", {\n                    title: \"设置\",\n                    theme: \"system\",\n                    width: 500,\n                    on: {\n                      submit: function submit(data) {\n                        tabs = data.tabs;\n                        editMode = data.editMode;\n                        subTabs = data.subTabs;\n                        updateNaviList();\n                        render();\n                      }\n                    }\n                  }, {\n                    editMode: editMode,\n                    tabs: tabs,\n                    subTabs: subTabs\n                  });\n                }\n              }\n            }]);\n          }\n\n          setTimeout(function () {\n            target.render(clist, {\n              class: \"steelNavi\"\n            });\n          });\n          runtime(\"主导航TAB加载完成!!\");\n        };\n\n        target.on(\"navigateTo\", function (id) {\n          var concat = tabs.concat(subTabs);\n          var find = concat.find(function (elem) {\n            return elem.id == id;\n          });\n          render(find);\n\n          if (find) {\n            select(find);\n          }\n        });\n        render();\n      });\n    }\n  },\n  \"format\": {\n    \"id\": \"id\",\n    \"label\": \"label\"\n  }\n});"],"sourceRoot":"/source/"}