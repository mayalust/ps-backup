{"version":3,"sources":["app-flowsheet/js/controllers/flow-sheet-ctrl.js"],"names":["define","controllers","keyboardJS","joint","controller","$scope","workflowService","workflowDefinitionService","Info","$routeParams","$compile","$rootScope","userEnterpriseService","viewFlexService","resourceUIService","kpiDataService","SwSocket","growl","timeout","loc","paper","graph","paperScroller","stencil","selection","inspector","selectionView","commandManager","viewId","displayMode","selectedView","shiftHold","backspaceHold","historyView","userGroupList","userList","userAryList","userRoleList","location","hash","search","displayModeLink","arrowheadMarkup","toolMarkup","vertexMarkup","selectedItem","cell","userIds","userGroupIds","roleIds","taskType","taskTypeParam","userType","bind","e","evenType","initialization","scope","element","interactive","dia","Graph","type","Paper","width","height","gridSize","perpendicularLinks","model","markAvailable","defaultLink","shapes","bpmn","Flow","validateConnection","cellViewS","magnetS","cellViewT","magnetT","end","linkView","LinkView","embeddingMode","frontParentOnly","validateEmbedding","childView","parentView","Pool","ui","PaperScroller","autoResizePaper","padding","$el","css","$","append","el","components","scroller","layout","GridLayout","columnWidth","options","columns","rowHeight","resizeToFit","dy","dx","Stencil","dropAnimation","groups","data","on","render","_","each","groupName","load","getGraph","getPaper","fitToContent","Backbone","Collection","SelectionView","evt","x","y","startSelecting","cancelSelection","startPanning","$apply","elementView","pool","get","lanePath","target","closest","console","log","prop","cellView","ctrlKey","metaKey","Link","createSelectionBox","add","destroySelectionBox","findViewByModel","reset","without","oncontextmenu","preventDefault","contains","initBatchCommand","invoke","storeBatchCommand","is","$inspectorHolder","openCellTools","Halo","removeHandles","id","userIdsAry","userTypeAry","toString","split","length","String","Number","content","contentAry","remove","inspectorDefs","Inspector","inputs","commonInspectorInputs","commonInspectorGroups","this","$label","Tooltip","right","direction","html","Element","top","CommandManager","undo","redo","commander","setDimensions","baseWidth","baseHeight","mould","mouldType","i","fromJSON","view","setGrid","backgroundImage","getGridBackgroundImage","bgcolor","bgimage","color","canvas","context","getContext","beginPath","rect","fillStyle","fill","toDataURL","save4Json","viewjson","toJSON","validate","cells","forEach","warning","userExpression","JSONstring","JSON","stringify","param","domainPath","name","desc","viewContent","createTime","updateTime","saveWorkflowDefinition","returnObj","code","success","err","alert","windowName","uniqueId","window","open","document","write","toFront","toBack","embed","parentCell","models","attributes","z","unembed","embeds","cellid","getCell","queryEnterpriseGroup","ary","list","groupID","push","queryEnterpriseUser","userID","userName","queryEnterpriseRole","roleID","roleName","getWorkflowById","parse","jQuery","extend","attrs","display","init","getWorkflowDefinitionById"],"mappings":"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","file":"app-flowsheet/js/controllers/flow-sheet-ctrl.js","sourcesContent":["define(['controllers/controllers', 'keyboardJS', 'rappid-joint'], function (controllers, keyboardJS, joint) {\n  'use strict';\n  /**\n   * 流程图控制器\n   */\n\n  controllers.controller('flowCtrl', ['$scope', 'workflowService', 'workflowDefinitionService', 'Info', '$routeParams', '$compile', '$rootScope', 'userEnterpriseService', 'viewFlexService', 'resourceUIService', 'kpiDataService', 'SwSocket', 'growl', '$timeout', '$location', function ($scope, workflowService, workflowDefinitionService, Info, $routeParams, $compile, $rootScope, userEnterpriseService, viewFlexService, resourceUIService, kpiDataService, SwSocket, growl, timeout, loc) {\n    var paper, graph, paperScroller, stencil, selection, inspector, selectionView, clipboard, commandManager, navigator;\n    var viewId = $routeParams.viewId;\n    $scope.selectedView = {};\n    var displayMode = false;\n    var shiftHold = false;\n    var backspaceHold = false;\n    var historyView = false;\n    $scope.userGroupList = '';\n    $scope.userList = '';\n    $scope.userAryList = '';\n    $scope.userRoleList = '';\n\n    if (location.hash.search(\"#/displayView\") > -1) {\n      displayMode = true;\n    }\n\n    ;\n\n    if (location.hash.search(\"#/historyView\") > -1) {\n      historyView = true;\n    }\n\n    ;\n    var displayModeLink = {\n      'arrowheadMarkup': '<g></g>',\n      'toolMarkup': '<g></g>',\n      'vertexMarkup': '<g></g>'\n    };\n    $scope.selectedItem = {\n      cell: null,\n      userIds: 0,\n      userGroupIds: 0,\n      roleIds: 0,\n      taskType: 0,\n      taskTypeParam: \"user\",\n      userType: \"\"\n    };\n    keyboardJS.bind('shift', function (e) {\n      shiftHold = true;\n    }, function (e) {\n      shiftHold = false;\n    });\n    keyboardJS.bind('shift', null, function (e) {\n      shiftHold = false;\n    });\n    keyboardJS.bind('backspace', function (e) {\n      backspaceHold = true;\n    }, function (e) {\n      backspaceHold = false;\n    });\n    keyboardJS.bind('backspace', null, function (e) {\n      backspaceHold = false;\n    });\n    $scope.evenType = \"start\";\n    /**\n     * 获取用户\n     */\n\n    function getUser() {\n      userEnterpriseService.queryEnterpriseUser(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data.length != 0) {\n            var list = {};\n            var ary = [];\n\n            for (var i in returnObj.data) {\n              list = {};\n              list[\"id\"] = returnObj.data[i].userID;\n              list[\"name\"] = returnObj.data[i].userName;\n              ary.push(list);\n            }\n\n            $scope.userAryList = ary;\n          } else {\n            $scope.userAryList = [];\n          }\n        }\n      });\n    }\n\n    ;\n    /**\n     * 获取角色\n     */\n\n    function getRole() {\n      userEnterpriseService.queryEnterpriseRole(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data.length != 0) {\n            var list = {};\n            var ary = [];\n\n            for (var i in returnObj.data) {\n              list = {};\n              list[\"id\"] = returnObj.data[i].roleID;\n              list[\"name\"] = returnObj.data[i].roleName;\n              ary.push(list);\n            }\n\n            $scope.userRoleList = ary;\n          } else {\n            $scope.userRoleList = [];\n          }\n        }\n      });\n    }\n\n    ;\n    /**\n     * 获取用户组\n     */\n\n    function getUserGroup() {\n      userEnterpriseService.queryEnterpriseGroup(function (returnObj) {\n        if (returnObj.code == 0) {\n          if (returnObj.data.length != 0) {\n            var ary = [];\n\n            for (var i in returnObj.data) {\n              var list = {};\n              list[\"id\"] = returnObj.data[i].groupID;\n              list[\"name\"] = returnObj.data[i].groupName;\n              ary.push(list);\n            }\n\n            $scope.userGroupList = ary;\n          } else {\n            $scope.userGroupList = [];\n          }\n        }\n      });\n    }\n\n    ;\n\n    var showViewContent = function showViewContent(scope, viewId) {\n      if (historyView) {\n        workflowService.getWorkflowById(viewId, function (returnObj) {\n          if (returnObj.code == 0) {\n            scope.selectedView = returnObj.data;\n            scope.data.viewContent = $scope.selectedView.viewContent;\n            scope.selectedView[\"inspector\"] = false;\n\n            if (returnObj.data.viewContent) {\n              var content = JSON.parse(returnObj.data.viewContent);\n\n              if (displayMode) {\n                for (var i = content.cells.length - 1; i > -1; i--) {\n                  if (content.cells[i].type == \"bpmn.Flow\") {\n                    jQuery.extend(content.cells[i], displayModeLink);\n                    content.cells[i].attrs['.connection-wrap'] = {\n                      display: 'none'\n                    };\n                  }\n                }\n              }\n\n              scope.components.graph.fromJSON(content);\n              scope.components.paper.options.gridSize = content.gridSize;\n              scope.components.paper.options.width = content.width;\n              scope.components.paper.options.height = content.height;\n              scope.data.bgimage = content.bgimage;\n              scope.data.bgcolor = content.bgcolor;\n              scope.data.mouldType = \"\";\n              scope.data.width = content.width;\n              scope.data.height = content.height;\n              scope.components.commander.setDimensions();\n              scope.components.commander.setGrid();\n            } else {\n              scope.components.graph.fromJSON(scope.data.init);\n            }\n          }\n        });\n      } else {\n        workflowDefinitionService.getWorkflowDefinitionById(viewId, function (returnObj) {\n          if (returnObj.code == 0) {\n            scope.selectedView = returnObj.data;\n            scope.data.viewContent = $scope.selectedView.viewContent;\n            scope.selectedView[\"inspector\"] = false;\n\n            if (returnObj.data.viewContent) {\n              var content = JSON.parse(returnObj.data.viewContent);\n\n              if (displayMode) {\n                for (var i = content.cells.length - 1; i > -1; i--) {\n                  if (content.cells[i].type == \"bpmn.Flow\") {\n                    console.log(\"linklinklink\");\n                    jQuery.extend(content.cells[i], displayModeLink);\n                    content.cells[i].attrs['.connection-wrap'] = {\n                      display: 'none'\n                    };\n                  }\n                }\n              }\n\n              scope.components.graph.fromJSON(content);\n              scope.components.paper.options.gridSize = content.gridSize;\n              scope.components.paper.options.width = content.width;\n              scope.components.paper.options.height = content.height;\n              scope.data.bgimage = content.bgimage;\n              scope.data.bgcolor = content.bgcolor;\n              scope.data.mouldType = \"\";\n              scope.data.width = content.width;\n              scope.data.height = content.height;\n              scope.components.commander.setDimensions();\n              scope.components.commander.setGrid();\n            } else {\n              scope.components.graph.fromJSON(scope.data.init);\n            }\n          }\n        });\n      }\n    };\n\n    $scope.initialization = [function initializePaper(scope, element) {\n      var interactive = false;\n\n      if (!displayMode) {\n        interactive = true;\n      }\n\n      graph = new joint.dia.Graph({\n        type: 'bpmn'\n      });\n      paper = new joint.dia.Paper({\n        width: 1200,\n        height: 700,\n        gridSize: 10,\n        perpendicularLinks: true,\n        model: graph,\n        markAvailable: true,\n        interactive: interactive,\n        defaultLink: new joint.shapes.bpmn.Flow(),\n        validateConnection: function validateConnection(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n          // don't allow loop links\n          if (cellViewS == cellViewT) return false;\n          var view = end === 'target' ? cellViewT : cellViewS; // don't allow link to link connection\n\n          if (view instanceof joint.dia.LinkView) return false;\n          return true;\n        },\n        embeddingMode: true,\n        frontParentOnly: false,\n        validateEmbedding: function validateEmbedding(childView, parentView) {\n          var Pool = joint.shapes.bpmn.Pool;\n          return parentView.model instanceof Pool && !(childView.model instanceof Pool);\n        }\n      });\n      paperScroller = new joint.ui.PaperScroller({\n        paper: paper,\n        autoResizePaper: true,\n        padding: 0\n      });\n      paperScroller.$el.css('background-color', \"hsl(0, 0%, 100%)\");\n      $('#paper-container1', element).append(paperScroller.el);\n      scope.components.paper = paper;\n      scope.components.scroller = paperScroller;\n      scope.components.graph = graph;\n    }, // 创建模板\n    function initializeStencil(scope, element) {\n      function layout(graph) {\n        joint.layout.GridLayout.layout(graph, {\n          columnWidth: stencil.options.width / 2 - 10,\n          columns: 2,\n          rowHeight: 80,\n          resizeToFit: true,\n          dy: 10,\n          dx: 10\n        });\n      }\n\n      stencil = new joint.ui.Stencil({\n        graph: graph,\n        paper: paper,\n        width: 230,\n        dropAnimation: true,\n        groups: scope.data.stencil.groups,\n        search: scope.data.stencil.search\n      }).on('filter', layout);\n      $('.stencil-container', element).append(stencil.render().el);\n\n      _.each(scope.data.stencil.shapes, function (shapes, groupName) {\n        stencil.load(shapes, groupName);\n        layout(stencil.getGraph(groupName));\n        stencil.getPaper(groupName).fitToContent(1, 1, 10);\n      });\n\n      scope.components.stencil = stencil;\n    }, // 创建选择\n    function initializeSelection(scope, element) {\n      selection = new Backbone.Collection();\n      selectionView = new joint.ui.SelectionView({\n        paper: paper,\n        graph: graph,\n        model: selection\n      }); // Initiate selecting when the user grabs the blank area of the paper while the Shift key is pressed.\n      // 当shift键被按下时，启动用户在页面的空白区域时开始选择。\n      // Otherwise, initiate paper pan.\n      // 否则，页面默认功能\n\n      paper.on('blank:pointerdown', function (evt, x, y) {\n        //          if(_.contains(keyboardJS.getContext(), 'shift')) {\n        if (shiftHold) {\n          selectionView.startSelecting(evt, x, y);\n          scope.selectedView.inspector = true;\n          scope.$apply();\n        } else {\n          selectionView.cancelSelection();\n          paperScroller.startPanning(evt, x, y);\n          scope.selectedView.inspector = false;\n          scope.$apply();\n        }\n      });\n      paper.on('element:pointerup', function (elementView, evt) {\n        var pool = elementView.model;\n\n        if (pool.get('type') === 'bpmn.Activity') {\n          var lanePath = $(evt.target).closest('.lane').data('lane-path') || 'lanes';\n          console.log(pool.prop(lanePath + '/label')); // log the lane label\n        }\n      });\n      paper.on('cell:pointerdown', function (cellView, evt) {\n        // Select an element if CTRL/Meta key is pressed while the element is clicked.\n        // 如果Ctrl /Meta 键是被按下，当元素被点击时，添加到selectionBox中\n        if ((evt.ctrlKey || evt.metaKey) && !(cellView.model instanceof joint.dia.Link)) {\n          selectionView.createSelectionBox(cellView);\n          selection.add(cellView.model);\n        }\n      });\n      selectionView.on('selection-box:pointerdown', function (evt) {\n        // Unselect an element if the CTRL/Meta key is pressed while a selected element is clicked.\n        // 取消之前的效果\n        if (evt.ctrlKey || evt.metaKey) {\n          var cell = selection.get($(evt.target).data('model'));\n          selectionView.destroySelectionBox(paper.findViewByModel(cell));\n          selection.reset(selection.without(cell));\n        }\n      }); // Disable context menu inside the paper.\n      // 取消HTML默认页面菜单\n      // This prevents from context menu being shown when selecting individual elements with Ctrl in OS X.\n\n      paper.el.oncontextmenu = function (evt) {\n        evt.preventDefault();\n      };\n\n      keyboardJS.on('delete, backspace', function (evt) {\n        if (!$.contains(evt.target, paper.el)) {\n          // remove selected elements from the paper only if the target is the paper\n          return;\n        }\n\n        commandManager.initBatchCommand();\n        selection.invoke('remove');\n        commandManager.storeBatchCommand();\n        selectionView.cancelSelection();\n\n        if (backspaceHold && !$(evt.target).is(\"input, textarea\")) {\n          // Prevent Backspace from navigating back.\n          evt.preventDefault();\n        }\n      });\n    }, // 元素控制器，自由转换和属性\n    function initializeHaloAndInspector(scope, element) {\n      var $inspectorHolder = $('.inspector-container', element);\n\n      function openCellTools(cellView) {\n        var cell = cellView.model || cellView;\n        var halo;\n\n        if (displayMode) {\n          halo = new joint.ui.Halo({\n            cellView: cellView\n          }).render();\n          halo.removeHandles();\n        } else {\n          halo = new joint.ui.Halo({\n            cellView: cellView\n          }).render();\n        }\n        /** 取消freeTransform，halo已经具有该功能\n         var freeTransform = new joint.ui.FreeTransform({\n          cellView: cellView\n        }).render();\n         */\n\n\n        if ($scope.selectedItem.cell && $scope.selectedItem.cell.id == cell.id) return;\n        var selectedItem = {\n          cell: null,\n          userIds: 0,\n          userGroupIds: 0,\n          roleIds: 0,\n          taskType: 0,\n          taskTypeParam: \"user\",\n          userType: \"\"\n        };\n        selectedItem.cell = cell; //获得设备选择方式\n\n        if (cell.get('userType')) {\n          var userTypeAry = cell.get('userType').toString().split(\":\");\n          if (userTypeAry.length > 0 && userTypeAry[userTypeAry.length - 1] != '?') selectedItem.userType = String(userTypeAry[userTypeAry.length - 1]);\n        }\n\n        if (cell.get('userIds')) {\n          var userIdsAry = cell.get('userIds').toString().split(\":\");\n          if (userIdsAry.length > 0 && userIdsAry[userIdsAry.length - 1] != '?') selectedItem.userIds = Number(userIdsAry[userIdsAry.length - 1]);\n        }\n\n        if (cell.get('userGroupIds')) {\n          var userIdsAry = cell.get('userGroupIds').toString().split(\":\");\n          if (userIdsAry.length > 0 && userIdsAry[userIdsAry.length - 1] != '?') selectedItem.userGroupIds = Number(userIdsAry[userIdsAry.length - 1]);\n        }\n\n        if (cell.get('roleIds')) {\n          var userIdsAry = cell.get('roleIds').toString().split(\":\");\n          if (userIdsAry.length > 0 && userIdsAry[userIdsAry.length - 1] != '?') selectedItem.roleIds = Number(userIdsAry[userIdsAry.length - 1]);\n        }\n\n        if (cell.get('content')) {\n          //            var contentAry = cell.get('content').toString().split(\":\");\n          //            if (contentAry.length > 0 && contentAry[contentAry.length - 1] != '?')\n          //              selectedItem.content = String(contentAry[contentAry.length - 1]);\n          selectedItem.content = cell.get('content');\n        }\n\n        if (cell.get('taskType')) {\n          var contentAry = cell.get('taskType').toString().split(\":\");\n          if (contentAry.length > 0 && contentAry[contentAry.length - 1] != '?') selectedItem.taskTypeParam = String(contentAry[contentAry.length - 1]);\n        }\n\n        if (cell.get('type') == \"bpmn.Activity\" && cell.get('icon') == \"service\") {\n          selectedItem.taskType = \"2\";\n          selectedItem.taskTypeParam = \"service\"; //$(\".list\").css(\"display\",\"none\");\n        } else {\n          selectedItem.taskType = \"0\";\n          selectedItem.taskTypeParam = \"user\"; //$(\".list\").css(\"display\",\"block\");\n        }\n\n        console.log(selectedItem.taskType);\n        $scope.selectedItem = selectedItem; // No need to re-render inspector if the cellView didn't change.\n\n        if (!inspector || inspector.options.cell !== cell) {\n          if (inspector) {\n            //if (inspector.getModel().collection) {\n            //  // update cell if the model is still in the graph\n            //  inspector.updateCell();\n            //}\n            // Clean up the old inspector if there was one.\n            inspector.remove();\n          }\n\n          var inspectorDefs = scope.inspectorDefs[cell.get('type')];\n          inspector = new joint.ui.Inspector({\n            inputs: inspectorDefs ? inspectorDefs.inputs ? inspectorDefs.inputs : scope.commonInspectorInputs : scope.commonInspectorInputs,\n            groups: inspectorDefs ? inspectorDefs.groups ? inspectorDefs.groups : scope.commonInspectorGroups : scope.commonInspectorGroups,\n            cell: cell\n          }).on('render', function () {\n            this.$('[data-tooltip]').each(function () {\n              var $label = $(this);\n              new joint.ui.Tooltip({\n                target: $label,\n                content: $label.data('tooltip'),\n                right: '.inspector',\n                direction: 'right'\n              });\n            });\n            $compile($inspectorHolder)($scope);\n          });\n          scope.selectedView.inspector = true;\n          scope.$apply();\n          $inspectorHolder.html(inspector.render().el);\n          $compile($inspectorHolder)($scope);\n        } // adjust selection\n\n\n        selectionView.cancelSelection();\n        selection.reset([cellView.model]);\n      }\n\n      ;\n      paper.on('cell:pointerup', function (cellView) {\n        if (!displayMode) {\n          if (cellView.model instanceof joint.dia.Element && !selection.contains(cellView.model)) {\n            scope.selectedView.inspector = true;\n            scope.$apply();\n            openCellTools(cellView);\n          }\n        }\n      });\n      selectionView.on('selection-box:pointerdown', function (evt) {\n        // Unselect an element if the CTRL/Meta key is pressed while a selected element is clicked.\n        // 取消之前的效果\n        if (evt.ctrlKey || evt.metaKey) {\n          var cell = selection.get($(evt.target).data('model'));\n          selectionView.destroySelectionBox(paper.findViewByModel(cell));\n          selection.reset(selection.without(cell));\n        }\n      });\n      paper.on('link:options', function (evt, cellView, x, y) {\n        openCellTools(cellView);\n      });\n    }, function toolTips(scope, element) {\n      $('.toolbar-container [data-tooltip]', element).each(function () {\n        new joint.ui.Tooltip({\n          target: $(this),\n          content: $(this).data('tooltip'),\n          top: '.toolbar-container',\n          direction: 'top'\n        });\n      });\n    }, function initializeCommandManager(scope, element) {\n      commandManager = new joint.dia.CommandManager({\n        graph: graph\n      });\n      keyboardJS.on('ctrl + z', function () {\n        commandManager.undo();\n        selectionView.cancelSelection();\n      });\n      keyboardJS.on('ctrl + y', function () {\n        commandManager.redo();\n        selectionView.cancelSelection();\n      });\n      scope.components.commander = commandManager;\n\n      scope.components.commander.setDimensions = function () {\n        paper.setDimensions(paper.options.width, paper.options.height);\n        paperScroller.options.baseWidth = paper.options.width;\n        paperScroller.options.baseHeight = paper.options.height;\n        paperScroller.$el.css('padding-top', 0);\n      };\n\n      scope.components.commander.mould = function () {\n        if (scope.data.mouldType != \"\" && scope.data.mouldType != null) {\n          for (var i in scope.data.mould) {\n            if (scope.data.mould[i].content == scope.data.mouldType) {\n              scope.components.graph.fromJSON(scope.data.mould[i].view);\n            }\n          }\n        }\n      };\n\n      scope.components.commander.setGrid = function () {\n        var gridSize = paper.options.gridSize;\n        var backgroundImage = getGridBackgroundImage(gridSize);\n\n        if (scope.data.bgcolor) {\n          paper.$el.css('background-color', scope.data.bgcolor);\n        } else {\n          paper.$el.css('background-color', \"#fff\");\n          paper.$el.css('box-shadow', \"0 0 2px white\");\n        }\n\n        if (scope.data.bgimage) {\n          if (!displayMode) {\n            paper.$el.css('background-image', 'url(\"' + backgroundImage + '\"),url(\"' + scope.data.bgimage + '\")');\n          } else {\n            paper.$el.css('background-image', 'url(\"\"),url(\"' + scope.data.bgimage + '\")');\n            paper.$el.css('margin-right', 0);\n          }\n        } else {\n          if (!displayMode) {\n            paper.$el.css('background-image', 'url(\"' + backgroundImage + '\")');\n          } else {\n            paper.$el.css('background-image', 'url(\"\"),url(\"\")');\n            paper.$el.css('margin-right', 0);\n          }\n        }\n      };\n\n      var getGridBackgroundImage = function getGridBackgroundImage(gridSize, color) {\n        var canvas = $('<canvas/>', {\n          width: gridSize,\n          height: gridSize\n        });\n        canvas[0].width = gridSize;\n        canvas[0].height = gridSize;\n        var context = canvas[0].getContext('2d');\n        context.beginPath();\n        context.rect(1, 1, 1, 1);\n        context.fillStyle = color || '#AAAAAA';\n        context.fill();\n        return canvas[0].toDataURL('image/png');\n      };\n\n      scope.components.commander.save4Json = function () {\n        var viewjson = graph.toJSON();\n        var validate = true;\n        viewjson.cells.forEach(function (cell) {\n          if (cell.type == \"bpmn.Activity\" && cell.taskType == 'user') {\n            if (cell.userType == \"\") {\n              growl.warning(\"请选择{\" + cell.content + \"}任务的处理类型\", {});\n              validate = false;\n            }\n\n            if (cell.userType == \"user\" && !cell.userIds) {\n              growl.warning(\"请设置{\" + cell.content + \"}任务的处理用户\", {});\n              validate = false;\n            }\n\n            if (cell.userType == \"expression\" && !cell.userExpression) {\n              growl.warning(\"请设置{\" + cell.content + \"}任务的用户表达式\", {});\n              validate = false;\n            }\n\n            if (cell.userType == \"role\" && !cell.roleIds) {\n              growl.warning(\"请设置{\" + cell.content + \"}任务的处理角色\", {});\n              validate = false;\n            }\n\n            if (cell.userType == \"userGroup\" && !cell.userGroupIds) {\n              growl.warning(\"请设置{\" + cell.content + \"}任务的处理用户组\", {});\n              validate = false;\n            }\n          }\n        });\n        if (!validate) return;\n        viewjson.gridSize = paper.options.gridSize;\n        viewjson.width = paper.options.width;\n        viewjson.height = paper.options.height;\n        viewjson.bgimage = scope.data.bgimage;\n        viewjson.bgcolor = scope.data.bgcolor;\n        var JSONstring = JSON.stringify(viewjson);\n\n        try {\n          var param = {\n            id: scope.selectedView.id,\n            domainPath: \"\",\n            name: scope.selectedView.name,\n            desc: scope.selectedView.desc,\n            viewContent: JSONstring,\n            createTime: scope.selectedView.createTime,\n            updateTime: scope.selectedView.updateTime\n          };\n\n          if (param.viewId == 0) {\n            workflowDefinitionService.saveWorkflowDefinition(param, function (returnObj) {\n              if (returnObj.code == 0) {\n                growl.success(\"保存成功\");\n              }\n            });\n          } else {\n            workflowDefinitionService.saveWorkflowDefinition(param, function (returnObj) {\n              if (returnObj.code == 0) {\n                growl.success(\"保存成功\");\n              }\n            });\n          }\n        } catch (err) {\n          alert(err);\n        }\n      };\n\n      scope.components.commander.toJSON = function () {\n        var windowFeatures = 'menubar=no,location=no,resizable=yes,scrollbars=yes,status=no';\n\n        var windowName = _.uniqueId('json_output');\n\n        var jsonWindow = window.open('', windowName, windowFeatures);\n        jsonWindow.document.write(JSON.stringify(graph.toJSON()));\n      };\n\n      scope.components.commander.toFront = function () {\n        selection.invoke('toFront');\n      };\n\n      scope.components.commander.toBack = function () {\n        selection.invoke('toBack');\n      };\n\n      scope.components.commander.embed = function () {\n        var parentCell;\n        selectionView.model.models.forEach(function (cell) {\n          if (!parentCell) {\n            parentCell = cell;\n          } else {\n            if (parentCell.attributes.z > cell.attributes.z) {\n              parentCell = cell;\n            }\n          }\n        });\n        selectionView.model.models.forEach(function (cell) {\n          if (parentCell.id != cell.id) {\n            parentCell.embed(cell);\n          }\n        });\n      };\n\n      scope.components.commander.unembed = function () {\n        selectionView.model.models.forEach(function (cell) {\n          if (cell.attributes.embeds) {\n            cell.attributes.embeds.forEach(function (cellid) {\n              cell.unembed(graph.getCell(cellid));\n            });\n          }\n        });\n      };\n    }, function initView(scope, element) {\n      getUserGroup();\n      getUser();\n      getRole();\n      showViewContent(scope, viewId);\n    }];\n  }]);\n});"],"sourceRoot":"/source/"}