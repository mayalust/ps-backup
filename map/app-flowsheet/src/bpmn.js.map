{"version":3,"sources":["app-flowsheet/src/bpmn.js"],"names":["_ref","inspector","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","graph","joint","dia","Graph","type","on","add","cell","collection","opt","stencil","sizeMultiplier","bpmn.Pool","bpmn.Choreography","get","originalSize","set","width","height","silent","commandManager","CommandManager","paper","Paper","model","gridSize","shapes","bpmn","Flow","cellViewS","magnetS","cellViewT","magnetT","end","linkView","LinkView","childView","parentView","Pool","blank:pointerdown","evt","x","y","_","contains","KeyboardJS","activeKeys","selectionView","startSelecting","cancelSelection","paperScroller","startPanning","cell:pointerdown","cellView","ctrlKey","metaKey","Element","selection","createSelectionBox","cell:pointerup","openTools","ui","PaperScroller","autoResizePaper","padding","$el","appendTo","center","Backbone","Collection","SelectionView","filter","selection-box:pointerdown","$","target","data","reset","without","destroySelectionBox","findViewByModel","Stencil","options","remove","Inspector","inputs","groups","general","label","index","appearance","prepend","render","el","FreeTransform","Halo","boxContent","safe","showStatus","message","removeClass","addClass","html","dequeue","delay","queue","this","load","Gateway","Activity","Event","Annotation","attrs",".","magnet",".header","fill","lanes","Group",".label","text","Conversation","Choreography","participants","Message","DataObject","layout","GridLayout","getGraph","columns","columnWidth","rowHeight","dy","dx","resizeToFit","getPaper","fitToContent","each","Tooltip","id","content","split","bottom","direction","view","initBatchCommand","invoke","storeBatchCommand","oncontextmenu","preventDefault","top","toolbar","toJSON","windowName","uniqueId","window","open","document","write","JSON","stringify","loadGraph","gdAuth","gdLoad","name","json","parse","fromJSON","getElementById","replace","e","saveGraph","gdSave","file","example"],"mappings":"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","file":"app-flowsheet/src/bpmn.js","sourcesContent":["var _ref;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/*! Rappid v1.7.1 - HTML5 Diagramming Framework\n\nCopyright (c) 2015 client IO\n\n 2016-03-03 \n\n\nThis Source Code Form is subject to the terms of the Rappid License\n, v. 2.0. If a copy of the Rappid License was not distributed with this\nfile, You can obtain one at http://jointjs.com/license/rappid_v2.txt\n or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/\nvar inspector;\n/* GRAPH */\n\nvar graph = new joint.dia.Graph({\n  type: 'bpmn'\n}).on({\n  // this is happening before the view of the model is actually added into the paper\n  'add': function add(cell, collection, opt) {\n    if (!opt.stencil) return;\n    var type = cell.get('type'); // some types of the elements need resizing after they are dropped\n\n    var sizeMultiplier = {\n      'bpmn.Pool': 8,\n      'bpmn.Choreography': 2\n    }[type];\n\n    if (sizeMultiplier) {\n      var originalSize = cell.get('size');\n      cell.set('size', {\n        width: originalSize.width * sizeMultiplier,\n        height: originalSize.height * sizeMultiplier\n      }, {\n        silent: true\n      });\n    }\n  }\n});\nvar commandManager = new joint.dia.CommandManager({\n  graph: graph\n});\n/* PAPER + SCROLLER */\n\nvar paper = new joint.dia.Paper((_ref = {\n  width: 2000,\n  height: 2000,\n  model: graph,\n  gridSize: 10\n}, _defineProperty(_ref, \"model\", graph), _defineProperty(_ref, \"perpendicularLinks\", true), _defineProperty(_ref, \"defaultLink\", new joint.shapes.bpmn.Flow()), _defineProperty(_ref, \"validateConnection\", function validateConnection(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n  // don't allow loop links\n  if (cellViewS == cellViewT) return false;\n  var view = end === 'target' ? cellViewT : cellViewS; // don't allow link to link connection\n\n  if (view instanceof joint.dia.LinkView) return false;\n  return true;\n}), _defineProperty(_ref, \"embeddingMode\", true), _defineProperty(_ref, \"frontParentOnly\", false), _defineProperty(_ref, \"validateEmbedding\", function validateEmbedding(childView, parentView) {\n  var Pool = joint.shapes.bpmn.Pool;\n  return parentView.model instanceof Pool && !(childView.model instanceof Pool);\n}), _ref)).on({\n  'blank:pointerdown': function blankPointerdown(evt, x, y) {\n    if (_.contains(KeyboardJS.activeKeys(), 'shift')) {\n      selectionView.startSelecting(evt, x, y);\n    } else {\n      selectionView.cancelSelection();\n      paperScroller.startPanning(evt, x, y);\n    }\n  },\n  'cell:pointerdown': function cellPointerdown(cellView, evt) {\n    // Select an element if CTRL/Meta key is pressed while the element is clicked.\n    if ((evt.ctrlKey || evt.metaKey) && cellView.model instanceof joint.dia.Element && !(cellView.model instanceof joint.shapes.bpmn.Pool)) {\n      selection.add(cellView.model);\n      selectionView.createSelectionBox(cellView);\n    }\n  },\n  'cell:pointerup': openTools\n});\nvar paperScroller = new joint.ui.PaperScroller({\n  autoResizePaper: true,\n  padding: 50,\n  paper: paper\n});\npaperScroller.$el.appendTo('#paper-container');\npaperScroller.center();\n/* SELECTION */\n\nvar selection = new Backbone.Collection();\nvar selectionView = new joint.ui.SelectionView({\n  paper: paper,\n  graph: graph,\n  model: selection,\n  filter: ['bpmn.Pool'] // don't allow to select a pool\n\n}).on({\n  'selection-box:pointerdown': function selectionBoxPointerdown(evt) {\n    // Unselect an element if the CTRL/Meta key is pressed while a selected element is clicked.\n    if (evt.ctrlKey || evt.metaKey) {\n      var cell = selection.get($(evt.target).data('model'));\n      selection.reset(selection.without(cell));\n      selectionView.destroySelectionBox(paper.findViewByModel(cell));\n    }\n  }\n});\n/* STENCIL */\n\nvar stencil = new joint.ui.Stencil({\n  graph: graph,\n  paper: paper\n});\nstencil.render().$el.appendTo('#stencil-container');\nstencil.load([new joint.shapes.bpmn.Gateway(), new joint.shapes.bpmn.Activity(), new joint.shapes.bpmn.Event(), new joint.shapes.bpmn.Annotation(), // a groups and pools can't be connected with any other elements\nnew joint.shapes.bpmn.Pool({\n  attrs: {\n    '.': {\n      magnet: false\n    },\n    '.header': {\n      fill: '#5799DA'\n    }\n  },\n  lanes: {\n    label: 'Pool'\n  }\n}), new joint.shapes.bpmn.Group({\n  attrs: {\n    '.': {\n      magnet: false\n    },\n    '.label': {\n      text: 'Group'\n    }\n  }\n}), new joint.shapes.bpmn.Conversation(), new joint.shapes.bpmn.Choreography({\n  participants: ['Participant 1', 'Participant 2']\n}), new joint.shapes.bpmn.Message(), new joint.shapes.bpmn.DataObject()]);\njoint.layout.GridLayout.layout(stencil.getGraph(), {\n  columns: 100,\n  columnWidth: 110,\n  rowHeight: 110,\n  dy: 20,\n  dx: 20,\n  resizeToFit: true\n});\nstencil.getPaper().fitToContent(0, 0, 10); // Create tooltips for all the shapes in stencil.\n\nstencil.getGraph().get('cells').each(function (cell) {\n  new joint.ui.Tooltip({\n    target: '.stencil [model-id=\"' + cell.id + '\"]',\n    content: cell.get('type').split('.')[1],\n    bottom: '.stencil',\n    direction: 'bottom',\n    padding: 0\n  });\n});\n/* CELL ADDED: after the view of the model was added into the paper */\n\ngraph.on('add', function (cell, collection, opt) {\n  // TODO: embedding after an element is dropped from the stencil. There is a problem with\n  // the command manager and wrong order of actions (embeding, parenting, adding and as it\n  // must be 3,1,2) in one batch. Can't be done silently either (becoming an attribute\n  // of an element being added) because redo action of `add` (=remove) won't reset the parent embeds.\n  if (!opt.stencil) return; // open inspector after a new element dropped from stencil\n\n  var view = paper.findViewByModel(cell);\n  if (view) openTools(view);\n});\n/* KEYBOARD */\n\nKeyboardJS.on('delete, backspace', function (evt) {\n  if (!$.contains(evt.target, paper.el)) return;\n  commandManager.initBatchCommand();\n  selection.invoke('remove');\n  commandManager.storeBatchCommand();\n  selectionView.cancelSelection();\n}); // Disable context menu inside the paper.\n// This prevents from context menu being shown when selecting individual elements with Ctrl in OS X.\n\npaper.el.oncontextmenu = function (evt) {\n  evt.preventDefault();\n};\n\n$('#toolbar-container [data-tooltip]').each(function () {\n  new joint.ui.Tooltip({\n    target: this,\n    content: $(this).data('tooltip'),\n    top: '#toolbar-container',\n    direction: 'top'\n  });\n});\n\nfunction openTools(cellView) {\n  // No need to re-render inspector if the cellView didn't change.\n  if (!inspector || inspector.options.cellView !== cellView) {\n    if (inspector) {\n      // Clean up the old inspector if there was one.\n      inspector.remove();\n    }\n\n    var type = cellView.model.get('type');\n    inspector = new joint.ui.Inspector({\n      cellView: cellView,\n      inputs: inputs[type],\n      groups: {\n        general: {\n          label: type,\n          index: 1\n        },\n        appearance: {\n          index: 2\n        }\n      }\n    });\n    $('#inspector-container').prepend(inspector.render().el);\n  }\n\n  if (cellView.model instanceof joint.dia.Element && !selection.contains(cellView.model)) {\n    new joint.ui.FreeTransform({\n      cellView: cellView\n    }).render();\n    new joint.ui.Halo({\n      cellView: cellView,\n      boxContent: function boxContent(cellView) {\n        return cellView.model.get('type');\n      }\n    }).render();\n    selectionView.cancelSelection();\n    selection.reset([cellView.model], {\n      safe: true\n    });\n  }\n}\n\nfunction showStatus(message, type) {\n  $('.status').removeClass('info error success').addClass(type).html(message);\n  $('#statusbar-container').dequeue().addClass('active').delay(3000).queue(function () {\n    $(this).removeClass('active');\n  });\n}\n\n;\nvar toolbar = {\n  toJSON: function toJSON() {\n    var windowFeatures = 'menubar=no,location=no,resizable=yes,scrollbars=yes,status=no';\n\n    var windowName = _.uniqueId('json_output');\n\n    var jsonWindow = window.open('', windowName, windowFeatures);\n    jsonWindow.document.write(JSON.stringify(graph.toJSON()));\n  },\n  loadGraph: function loadGraph() {\n    gdAuth(function () {\n      showStatus('loading..', 'info');\n      gdLoad(function (name, content) {\n        try {\n          var json = JSON.parse(content);\n          graph.fromJSON(json);\n          document.getElementById('fileName').value = name.replace(/.json$/, '');\n          showStatus('loaded.', 'success');\n        } catch (e) {\n          showStatus('failed.', 'error');\n        }\n      });\n    }, true);\n  },\n  saveGraph: function saveGraph() {\n    gdAuth(function () {\n      showStatus('saving..', 'info');\n      var name = document.getElementById('fileName').value;\n      gdSave(name, JSON.stringify(graph.toJSON()), function (file) {\n        if (file) {\n          showStatus('saved.', 'success');\n        } else {\n          showStatus('failed.', 'error');\n        }\n      });\n    }, true);\n  }\n}; // load an example graph\n\ngraph.fromJSON(example);"],"sourceRoot":"/source/"}