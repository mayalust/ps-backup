{"version":3,"sources":["app-sc/js/controllers/tglibrary-ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","tglibraryPrevCtrl","scope","q","serviceCenterService","route","userLoginUIService","location","viewFlexService","resourceUIService","timeout","window","allMyViews","$deviceGroup","solutionId","$on","event","path","changePos","user","appData","element","i","this","edit","deviceGroupId","id","detail","addResource","remove","viewId","view","deleteViews","deleteDeviceGroup","deviceGroups","filter","views","getAll","then","data","viewTitle","nodes","kpis","index","jsondata","content","slice","JSON","parse","preview","list","resource","indexOf","push","kpi","success","map","deviceGroup","result","label","find","error","err","console","log","getValues","j","elem","el","kpiCode","nodeId","value","tgeditCtrl","solutionUIService","currentDeviceGroup","currentView","handleView","$resource","$preview","$charts","$clone","$dragElement","groupId","$model","kpiChange","target","length","setValue","parseInt","init","resourceInfoLoaded","code","tg","update","saveNewDeviceGroup","stringify","deviceGroupModel","modelId","saveDeviceGroup","newdeviceGroup","JSONstring","param","viewName","viewType","addView","alert","updateNewDeviceGroup","updateView","mode","saveServiceViewContent","href","getServiceViewContent","undefined","getModelsByGroupId","allModels","drawarea","backgroundImage","charts","handleModel","call","model","cur","modelObj","getBymodelId","icon","unit","k","getResourceById","deviceGroupModels","resources","Array","getServiceViewMap","dataMap","viewContent","handleResource","successKpi","errorKpi","resourceObj","units","current","$$route","originalPath","params","alertOn","stopMove","ui","top","offset","$","left","topPortion","height","leftPortion","width","stopResize","widthPortion","heightPortion","focusOn","parametersEditor","step","exit","createNew","type","show","bar","scale","switch","bgimageOpen","bgimageClose","open","blink","bgimage","ondrop","bgBlinkImage","drawPos","position","transform","calcuRotation","-ms-transform","-moz-transform","-webkit-transform","-o-transform","saveAndExit","getData","title","hasOwnProperty","onChange","attr","attrs","add","concat","item","used","tglibraryCtrl","chartOptionService","SwSocket","uuid","blinks","showCam","allViewLoaded","dt","nodesSocket","kpisSocket","nodesCharts","kpisCharts","directives","message","comId","sendDeviceDirective","Math","ciid","toString","repeat","finalValue","_option_","series","finalTime","xAxis","random","pushData","send","webSocketOpen","allValueLoaded","getValuesListAndMergeByTime","allValueListLoaded","getAllValue","pushValue","colors","legend","ci","$attr","setOptions","timeEnd","Date","getTime","sort","name","color","track","lineChart","linechart","setTitle","setGrid","setTimeformat","setxAxis","$extension","itemStyle","normal","lineStyle","areaStyle","setSeriesByCiKpi","setOption","returnOption","health","wholeClick","panelShow","orderHandlerClick","overviewClick","equipmentClick","malfunctionClick","chartClick","unregister","panelClick","ipcam","camClick","openCam","closeCam","blinkClick","startBlink","stopBlink","initController","$inject"],"mappings":"AAAA,SAASA,QAAQC,GAAwT,OAAtOD,QAArD,mBAAXE,QAAoD,iBAApBA,OAAOC,SAAmC,SAAiBF,GAAO,cAAcA,GAA2B,SAAiBA,GAAO,OAAOA,GAAyB,mBAAXC,QAAyBD,EAAIG,cAAgBF,QAAUD,IAAQC,OAAOG,UAAY,gBAAkBJ,IAAyBA,GAExVK,OAAO,CAAC,0BAA2B,SAAU,SAAUC,GACrD,aAKA,SAASC,EAAkBC,EAAOC,EAAGC,EAAsBC,EAAOC,EAAoBC,EAAUC,EAAiBC,EAAmBC,EAASC,GAM3I,IAAIC,EAAYC,EAAcC,EAL9BZ,EAAMa,IAAI,yBAA0B,SAAUC,GACrB,YAAnBT,EAASU,QACXX,EAAmBY,cAKnBZ,EAAmBa,KAAKC,QAC1BN,EAAaR,EAAmBa,KAAKC,QAAQN,WAE7CZ,EAAMa,IAAI,qBAAsB,WAC9BD,EAAaR,EAAmBa,KAAKC,QAAQN,cAIjDD,EAAe,SAAsBQ,GAGnC,IAAK,IAAIC,KAAKD,EAFJE,KAGJD,GAAKD,EAAQC,KAIRxB,UAAU0B,KAAO,WAC5B,IACIC,EADMF,KACcG,GACxBnB,EAASU,KAAK,eAAiBH,EAAa,IAAMW,IAGpDZ,EAAaf,UAAU6B,OAAS,WAC9B,IACIF,EADMF,KACcG,GACxBnB,EAASU,KAAK,iBAAmBQ,IAGnCvB,EAAM0B,YAAc,WAClBrB,EAASU,KAAK,eAAiBH,IAGjCD,EAAaf,UAAU+B,OAAS,WAC9B,IACIJ,EADMF,KACcG,GACpBI,EAFMP,KAEOQ,KAAKD,OACtBtB,EAAgBwB,YAAY,CAACF,GAE7B,SAAkBd,GAChBP,EAAkBwB,kBAAkBR,EAEpC,SAAkBT,GAChBd,EAAMgC,aAAehC,EAAMgC,aAAaC,OAAO,SAAUd,GACvD,OAAOA,EAAQK,IAAMD,SAM7BrB,EAAqBgC,MAAMC,QAAO,GAAOC,KAEzC,SAAiBC,GACf3B,EAAa2B,EAAKJ,OAAO,SAAUd,GACjC,MAA4B,sBAArBA,EAAQmB,YAEjB,IAAIC,EAAQ,GACRC,EAAO,GAEX,IAAK,IAAIpB,KAAKV,GACZ,SAAW+B,EAAOtB,GAChB,IAOsBA,EAPlBuB,EAAW,GACXC,EAAUxB,EAAQwB,QAEtB,GAA2B,KAAvBA,EAAQC,MAAM,EAAG,IAAkC,KAArBD,EAAQC,OAAO,GAG/C,IAAK,IAAIxB,KAFTsB,EAAWG,KAAKC,MAAMH,IAECI,QAAQC,MACX7B,EAYZuB,EAASK,QAAQC,KAAK5B,IAXd6B,WACiC,GAAvCV,EAAMW,QAAQ/B,EAAQ8B,SAASzB,KACjCe,EAAMY,KAAKhC,EAAQ8B,SAASzB,IAI5BL,EAAQiC,MAC4B,GAAlCb,EAAMW,QAAQ/B,EAAQiC,IAAI5B,KAC5BgB,EAAKW,KAAKhC,EAAQiC,IAAI5B,IAOhCL,EAAQ0B,KAAOH,EAxBjB,CAyBGtB,EAAGV,EAAWU,IAmCnB,SAASiC,EAAQhB,GACfrC,EAAMgC,aAAeK,EAAKiB,IAAI,SAAUC,GACtC,IAAIC,EAAS,CACXhC,GAAI+B,EAAY/B,GAChBiC,MAAOF,EAAYE,MACnB5B,KAAM,MAEJ6B,EAAOhD,EAAWgD,KAAK,SAAU7B,GACnC,OAAOA,EAAKgB,KAAKtB,eAAiBiC,EAAOhC,KAG3C,OADAgC,EAAO3B,KAAO6B,EACP,IAAI/C,EAAa6C,KAI5B,SAASG,EAAMC,GACbC,QAAQC,IAAIF,GAhDd1D,EAAqB6D,UAAUxB,EAAOC,GAAMJ,KAE5C,SAAwBC,GACtB,IAAK,IAAIjB,KAAKV,GACZ,SAAW+B,EAAOtB,GAChB,IAAK,IAAI6C,KAAK7C,EAAQ0B,KAAKE,QAAQC,MACjC,SAAWP,EAAOwB,GAChB,IAAIP,EAAOrB,EAAKqB,KAAK,SAAUQ,GAC7B,SAAID,EAAKb,MAAOa,EAAKhB,YACZiB,EAAGC,SAAWF,EAAKb,IAAI5B,IAAM0C,EAAGE,QAAUH,EAAKhB,SAASzB,MAM/DkC,GACEA,EAAKW,MACPJ,EAAKI,MAAQX,EAAKW,MAKpBJ,EAAKI,MAAQ,IAhBjB,CAkBGL,EAAG7C,EAAQ0B,KAAKE,QAAQC,KAAKgB,IApBpC,CAsBG5C,EAAGV,EAAWU,IAGnBlB,EAAqB8B,aAAaG,QAAO,GAAOC,KAAKiB,EAASM,IA7BCA,IAoDnE,SAAeC,GACbC,QAAQC,IAAIF,KAOhB,SAASU,EAAWtE,EAAOC,EAAGC,EAAsBC,EAAOE,EAAUC,EAAiBC,EAAmBgE,EAAmB9D,EAAQL,GAMlI,IAAIoE,EAAoBC,EAAaC,EAAYC,EAAWC,EAAUC,EAASC,EAAQC,EAAcnE,EAAYW,EAAeyD,EAASC,EAmCzI,SAASC,EAAUC,GACC,MAAdA,EAAO/B,KACuB,UAA5B7D,QAAQ4F,EAAOlC,WAA4C,MAAnBkC,EAAOlC,UACjD/C,EAAqB6D,UAAU,CAACoB,EAAOlC,SAASzB,IAAK,CAAC2D,EAAO/B,IAAI5B,KAAKY,KAI1E,SAAiBC,GACG,EAAdA,EAAK+C,OACuB,mBAAnBD,EAAOE,SAChBF,EAAOE,SAASC,SAASjD,EAAK,GAAGgC,QAEjCc,EAAOd,MAAQiB,SAASjD,EAAK,GAAGgC,OAGlCc,EAAOd,MAAQ,KAInB,SAAeT,MAqdjB,SAAS2B,IA0BP,SAASC,EAAmB1E,GACR,GAAdA,EAAM2E,OACRjB,EAAqB1D,EAAMuB,MAG7BnC,EAAqBgC,MAAMC,SAASC,KAAK,SAAUC,GACjD,IAAIH,EAAQG,EAEZ,IAAK,IAAIjB,KAAKc,EACZ,GAA0B,sBAAtBA,EAAMd,GAAGkB,UAAmC,CAC9C,IAAIoD,EAAK7C,KAAKC,MAAMZ,EAAMd,GAAGuB,SAEzB+C,EAAGnE,eAAiBA,KACtBkD,EAAciB,GACF9D,OAASM,EAAMd,GAAGQ,QAGhC+D,EAAOnB,MAwBf,SAASoB,EAAmBvD,GAG1B,IAAIkB,EAAcV,KAAKC,MAAMD,KAAKgD,UAAU7F,EAAM8F,mBAClDvC,EAAYwC,QAAUxC,EAAY/B,UAC3B+B,EAAY/B,GACnBjB,EAAkByF,gBAAgBzC,EAElC,SAAkBzC,GAChB,IAAImF,EAAiBnF,EAAMuB,KAC3BA,EAAKd,cAAgB0E,EAAezE,GACpC,IAAI0E,EAAarD,KAAKgD,UAAUxD,GAEhC,IACE,IAAI8D,EAAQ,CACV7D,UAAW,qBACX8D,SAAU,qBACVC,SAAU,qBACV1D,QAASuD,GAEX5F,EAAgBgG,QAAQH,EAK1B,SAAkBrF,GAChB+C,QAAQC,IAAIhD,GACZT,EAASU,KAAK,iBANd,MAAO6C,GACP2C,MAAM3C,MAiBZ,SAAS4C,EAAqBnE,GAC5B,IAAIkB,EAAcV,KAAKC,MAAMD,KAAKgD,UAAUrB,IAC5CjE,EAAkByF,gBAAgBzC,EAElC,SAAkBzC,GAChB,IAAImF,EAAiBnF,EAAMuB,KAC3BA,EAAKd,cAAgB0E,EAAezE,GACpC,IAAI0E,EAAarD,KAAKgD,UAAUxD,GAEhC,IACE,IAAI8D,EAAQ,CACVvE,OAAQ6C,EAAY7C,OACpBU,UAAW,qBACX8D,SAAU,qBACVC,SAAU,qBACV1D,QAASuD,GAEX5F,EAAgBmG,WAAWN,EAK7B,SAAkBrF,GAChBT,EAASU,KAAK,iBALd,MAAO6C,GACP2C,MAAM3C,MA5HM,aAAd5D,EAAM0G,KACJ9F,GACF8D,EAgGJ,SAAgCrC,GAC9B,IAAI6D,EAAarD,KAAKgD,UAAUxD,GAChCkC,EAAkBoC,uBAAuB/F,EAAYoE,EAAS,EAAGkB,EAAY,SAAUpF,GACrFL,EAAOJ,SAASuG,KAAO,kCAlGvBrC,EAAkBsC,sBAAsBjG,EAAYoE,EAAS,EA6CjE,SAAuBlE,GACH,KAAdA,EAAM2E,MACiB,iBAAd3E,EAAMuB,OACfoC,EAAc5B,KAAKC,MAAMhC,EAAMuB,OAI/BzB,EACiBkG,MAAfrC,EAiFRF,EAAkBwC,mBAAmBnG,EAAYoE,EAAS,SAAUlE,GAChD,KAAdA,EAAM2E,OACRzF,EAAMgH,UAAYlG,EAAMuB,KAAKiB,IAAI,SAAUnC,GACzC,OAAO,IAAI8D,EAAO9D,KAEpBnB,EAAM+C,QAAU,IAAI6B,EAAS,CAC3B5B,KAAM,KAERhD,EAAMiH,SAAW,CACfjE,KAAM,GACNkE,gBAAiB,wBAEnBlH,EAAMmH,OAAS,IAAItC,EAAQ,CACzB7B,KAAM,QAOZuB,EAAkBwC,mBAAmBnG,EAAYoE,EAAS,SAAUlE,GAClE,GAAkB,KAAdA,EAAM2E,KAAa,CAWrB,IAAK,IAAIrE,KAVTpB,EAAMgH,UAAYlG,EAAMuB,KAAKiB,IAAI,SAAUnC,GACzC,OAAO,IAAI8D,EAAO9D,KAEpBnB,EAAM+C,QAAU,IAAI6B,EAASH,EAAY1B,SACzC/C,EAAMiH,SAAWxC,EAAYwC,SAC7BjH,EAAMiH,SAASjE,KAAOhD,EAAMiH,SAASjE,KAAKM,IAAI,SAAUnC,GACtD,OAAO,IAAI4D,EAAa5D,KAE1BnB,EAAMmH,OAAS,IAAItC,EAAQJ,EAAY0C,QAEzBnH,EAAM+C,QAAQC,KACRiB,EAEZjE,EAAM+C,QAAQC,KAAK5B,GADvBgG,EAAYC,KAAKpD,GAIrB,IAAK,IAAI7C,KAAKpB,EAAMiH,SAASjE,KACTiB,EAEZjE,EAAMiH,SAASjE,KAAK5B,GADxBgG,EAAYC,KAAKpD,GAIrB,IAAK,IAAI7C,KAAKpB,EAAMmH,OAAOnE,KACPiB,EAEZjE,EAAMmH,OAAOnE,KAAK5B,GADtBgG,EAAYC,KAAKpD,GADnB,IAAkBA,EANAA,EANAA,EAkBtB,SAASmD,IACP,IACIE,EADAC,EAAMlG,KAGNkG,EAAID,QACNA,EAAQtH,EAAMgH,UAAUtD,KAAK,SAAUvC,GACrC,OAAOoG,EAAID,MAAM9F,IAAML,EAAQK,OAInC+F,EAAIC,SAAWF,IAGbpH,EAAqBsC,KAAKiF,aAAaH,EAAM9F,IAAIY,KAGnD,SAAoBC,GAClBkF,EAAID,MAAMlE,IAAMf,EAAKiB,IAAI,SAAUnC,GACjC,MAAO,CACLK,GAAIL,EAAQK,GACZiC,MAAOtC,EAAQsC,MACfiE,KAAMvG,EAAQuG,KAAOvG,EAAQuG,KAAO,gBACpCC,KAAMxG,EAAQwG,QAGlBJ,EAAInE,IAAMmE,EAAID,MAAMlE,IAAIM,KAAK,SAAUkE,GACrC,OAAOA,EAAEpG,IAAM+F,EAAInE,IAAI5B,KAEzB0D,EAAUqC,IAGZ,SAAkB3D,GAChBC,QAAQC,IAAIF,QA9Jd+B,EAAOnB,MAzDHjD,GACFmD,EAAa8B,EACbjG,EAAkBsH,gBAAgBtG,EAAeiE,KAEjDd,EAAakB,EA8ZnB1F,EAAqB4H,kBAAkB3F,SAASC,KAEhD,SAAiBC,GAmBf,SAASgB,EAAQhB,GACfrC,EAAM+H,UAAY1F,EAAKiB,IAAI,SAAUnC,GACnC,OAAO,IAAIwD,EAAUxD,KAIzB,SAASwC,EAAMC,GACbC,QAAQC,IAAIF,GAzBd5D,EAAM8H,kBAAoBzF,EAEtBrC,EAAM8H,6BAA6BE,OAAyC,EAAjChI,EAAM8H,kBAAkB1C,SACrEpF,EAAM8F,iBAAmB9F,EAAM8H,kBAAkB,IAGnD9H,EAAM+C,QAAU,IAAI6B,EAAS,CAC3B5B,KAAM,KAERhD,EAAMiH,SAAW,CACfjE,KAAM,GACNkE,gBAAiB,wBAEnBlH,EAAMmH,OAAS,IAAItC,EAAQ,CACzB7B,KAAM,KAER9C,EAAqB6H,UAAU5F,SAASC,KAAKiB,EAASM,IAaxD,SAAeC,GACbC,QAAQC,IAAIF,MA3bW,QAAd5D,EAAM0G,OACXnF,GACFmD,EAAa8B,EACbjG,EAAkBsH,gBAAgBtG,EAAeiE,KAEjDd,EAAakB,EACbtF,EAAgB2H,kBAAkB,SAAUnH,GAuSlD,IAAwBoH,EAClBC,EADkBD,EAtSDpH,EAAMuB,KAwS3BnC,EAAqB4H,kBAAkB3F,SAASC,KAEhD,SAAiBC,GAaf,SAASgB,EAAQhB,GACfrC,EAAM+H,UAAY1F,EAAKiB,IAAI,SAAUnC,GACnC,OAAO,IAAIwD,EAAUxD,KAEvB,IAiBoB8C,EAMAA,EAMAA,EA7BhBlB,EAAUoF,EAAcA,EAAYpF,QAAU,CAChDC,KAAM,IAEJmE,EAASgB,EAAcA,EAAYhB,OAAS,CAC9CnE,KAAM,IAYR,IAAK,IAAI5B,KAVTpB,EAAM+C,QAAU,IAAI6B,EAAS7B,GAC7B/C,EAAMiH,SAAWkB,EAAcA,EAAYlB,SAAW,CACpDjE,KAAM,GACNkE,gBAAiB,wBAEnBlH,EAAMiH,SAASjE,KAAOhD,EAAMiH,SAASjE,KAAKM,IAAI,SAAUnC,GACtD,OAAO,IAAI4D,EAAa5D,KAE1BnB,EAAMmH,OAAS,IAAItC,EAAQsC,GAEbnH,EAAM+C,QAAQC,KACRiB,EAEZjE,EAAM+C,QAAQC,KAAK5B,GADvBgH,EAAef,KAAKpD,GAIxB,IAAK,IAAI7C,KAAKpB,EAAMiH,SAASjE,KACTiB,EAEZjE,EAAMiH,SAASjE,KAAK5B,GADxBgH,EAAef,KAAKpD,GAIxB,IAAK,IAAI7C,KAAKpB,EAAMmH,OAAOnE,KACPiB,EAEZjE,EAAMmH,OAAOnE,KAAK5B,GADtBgH,EAAef,KAAKpD,GAIxB,SAASmE,IACP,IACInF,EADAsE,EAAMlG,KAkBV,SAASgH,EAAWhG,GACdkF,EAAItE,WACNsE,EAAItE,SAASG,IAAMf,EAAKiB,IAAI,SAAUnC,GACpC,MAAO,CACLK,GAAIL,EAAQK,GACZiC,MAAOtC,EAAQsC,MACfiE,KAAMvG,EAAQuG,KAAOvG,EAAQuG,KAAO,gBACpCC,KAAMxG,EAAQwG,QAGlBJ,EAAInE,IAAMmE,EAAItE,SAASG,IAAIM,KAAK,SAAUkE,GACxC,OAAOA,EAAEpG,IAAM+F,EAAInE,IAAI5B,MAI3B0D,EAAUqC,GAGZ,SAASe,EAAS1E,GAChBC,QAAQC,IAAIF,GAlCV2D,EAAID,QACNrE,EAAWjD,EAAM+H,UAAUrE,KAAK,SAAUvC,GACxC,OAAOoG,EAAID,MAAM9F,IAAML,EAAQ4E,WAI/B9C,IACFsE,EAAItE,SAAW,CACbzB,GAAIyB,EAASzB,GACbiC,MAAOR,EAASQ,OAElB8D,EAAIgB,YAActF,EAClB/C,EAAqBsC,KAAKiF,aAAaxE,EAAS8C,SAAS3D,KAAKiG,EAAYC,KA2BhF,SAAS3E,EAAMC,GACbC,QAAQC,IAAIF,GA9Fd5D,EAAM8H,kBAAoBzF,EAEtBrC,EAAM8H,6BAA6BE,OAAyC,EAAjChI,EAAM8H,kBAAkB1C,SACrEpF,EAAM8F,iBAAmB9F,EAAM8H,kBAAkB,GAE7CI,EAAQlI,EAAM8F,iBAAiBtE,MACjC2G,EAActF,KAAKC,MAAMoF,EAAQlI,EAAM8F,iBAAiBtE,OAI5DtB,EAAqB6H,UAAU5F,SAASC,KAAKiB,EAASM,IAwFxD,SAAeC,GACbC,QAAQC,IAAIF,SAhMhB,SAAS+B,EAAOpC,GACdrD,EAAqB6H,UAAU5F,SAASC,KAExC,SAAiBC,GACfrC,EAAM+H,UAAY1F,EAAKiB,IAAI,SAAUnC,GACnC,OAAO,IAAIwD,EAAUxD,KAEvBjB,EAAqB4H,kBAAkB3F,SAASC,KAEhD,SAAiBC,GACfrC,EAAM8H,kBAAoBzF,EAC1BrC,EAAM8F,iBAAmB9F,EAAM8H,kBAAkBpE,KAAK,SAAUvC,GAC9D,OAAOoC,EAAYwC,SAAW5E,EAAQK,KAExC,IAAIuB,EAAU0B,EAAY1B,QACtBoE,EAAS1C,EAAY0C,OAQzB,IAAK,IAAI/F,KAPTpB,EAAM+C,QAAU,IAAI6B,EAAS7B,GAC7B/C,EAAMiH,SAAWxC,EAAYwC,SAC7BjH,EAAMiH,SAASjE,KAAOhD,EAAMiH,SAASjE,KAAKM,IAAI,SAAUnC,GACtD,OAAO,IAAI4D,EAAa5D,KAE1BnB,EAAMmH,OAAS,IAAItC,EAAQsC,GAEbnH,EAAM+C,QAAQC,KACRiB,EAEZjE,EAAM+C,QAAQC,KAAK5B,GADvBgH,EAAef,KAAKpD,GADtB,IAAkBA,EAKpB,IAAK,IAAI7C,KAAKpB,EAAMiH,SAASjE,KACTiB,EAEZjE,EAAMiH,SAASjE,KAAK5B,GADxBgH,EAAef,KAAKpD,GADtB,IAAkBA,EAKpB,IAAK,IAAI7C,KAAKpB,EAAMmH,OAAOnE,KACPiB,EAEZjE,EAAMmH,OAAOnE,KAAK5B,GADtBgH,EAAef,KAAKpD,GADtB,IAAkBA,EAKpB,SAASmE,IACP,IACInF,EADAsE,EAAMlG,KAeV,SAASgH,EAAWhG,GAClBkF,EAAItE,SAASG,IAAMf,EAAKiB,IAAI,SAAUnC,GACpC,MAAO,CACLK,GAAIL,EAAQK,GACZiC,MAAOtC,EAAQsC,MACfiE,KAAMvG,EAAQuG,KAAOvG,EAAQuG,KAAO,gBACpCC,KAAMxG,EAAQwG,QAGlBJ,EAAInE,IAAMmE,EAAItE,SAASG,IAAIM,KAAK,SAAUkE,GACxC,OAAOA,EAAEpG,IAAM+F,EAAInE,IAAI5B,KAEzB0D,EAAUqC,GAGZ,SAASe,EAAS1E,GAChBC,QAAQC,IAAIF,GA5BV2D,EAAItE,WACNA,EAAWjD,EAAM+H,UAAUrE,KAAK,SAAUvC,GACxC,OAAOoG,EAAItE,SAASzB,IAAML,EAAQK,OAItC+F,EAAIgB,YAActF,IAGhB/C,EAAqBsC,KAAKiF,aAAaxE,EAAS8C,SAAS3D,KAAKiG,EAAYC,KAwBhF,SAAe1E,GACbC,QAAQC,IAAIF,MAIhB,SAAeA,GACbC,QAAQC,IAAIF,KAv0BhB5D,EAAMa,IAAI,yBAA0B,SAAUC,GACrB,YAAnBT,EAASU,QACXX,EAAmBY,cAIvBd,EAAqBsI,MAAMrG,SAASC,KAAK,SAAUC,GACzCA,IAGNlC,EAAMsI,UACwD,GAA5DtI,EAAMsI,QAAQC,QAAQC,aAAazF,QAAQ,aAC7ClD,EAAM0G,KAAO,aACmD,GAAvDvG,EAAMsI,QAAQC,QAAQC,aAAazF,QAAQ,UACpDlD,EAAM0G,KAAO,QAGf1B,EAAU7E,EAAMsI,QAAQG,OAAO5D,QAC/BzD,EAAgBpB,EAAMsI,QAAQG,OAAOrH,cACrCvB,EAAMY,WAAaA,EAAaT,EAAMsI,QAAQG,OAAOhI,WACrD2E,KAEAvF,EAAMa,IAAI,kBAAmB,WAC3BmE,EAAU7E,EAAMsI,QAAQG,OAAO5D,QAC/BzD,EAAgBpB,EAAMsI,QAAQG,OAAOrH,cACrCX,EAAaT,EAAMsI,QAAQG,OAAOhI,YAE8B,GAA5DT,EAAMsI,QAAQC,QAAQC,aAAazF,QAAQ,aAC7ClD,EAAM0G,KAAO,aACmD,GAAvDvG,EAAMsI,QAAQC,QAAQC,aAAazF,QAAQ,UACpDlD,EAAM0G,KAAO,QAGfnB,MAIJvF,EAAMkF,UAAYA,EAClBlF,EAAM6I,SAAU,GA0BhB9D,EAAe,SAAsB1C,GAGnC,IAAK,IAAIjB,KAAKiB,EAFJhB,KAGJD,GAAKiB,EAAKjB,KAILxB,UAAUkJ,SAAW,SAAUC,GAC1C,IACIC,EAAMD,EAAGE,OAAOD,IAAME,EAAE,gBAAgBD,SAASD,IACjDG,EAAOJ,EAAGE,OAAOE,KAAOD,EAAE,gBAAgBD,SAASE,KAF7C9H,KAGN2H,IAAMA,EAHA3H,KAIN+H,WAAaJ,EAAME,EAAE,gBAAgBG,SAJ/BhI,KAKN8H,KAAOA,EALD9H,KAMNiI,YAAcH,EAAOD,EAAE,gBAAgBK,SAG7CxE,EAAanF,UAAU4J,WAAa,SAAUT,GAC5C,IAAIxB,EAAMlG,KACVkG,EAAIgC,MAAQL,EAAEH,EAAG5H,SAASoI,QAC1BhC,EAAIkC,aAAelC,EAAIgC,MAAQL,EAAE,gBAAgBK,QACjDhC,EAAI8B,OAASH,EAAEH,EAAG5H,SAASkI,SAC3B9B,EAAImC,cAAgBnC,EAAI8B,OAASH,EAAE,gBAAgBG,UAGrDtE,EAAanF,UAAU+B,OAAS,WAC9B,IAAI4F,EAAMlG,KACVrB,EAAMiH,SAASjE,KAAOhD,EAAMiH,SAASjE,KAAKf,OAAO,SAAUd,GACzD,OAAOA,IAAYoG,KAIvBxC,EAAanF,UAAU+J,QAAU,WAE/B3J,EAAM4J,iBADIvI,MAIZrB,EAAM6J,KAAO,EAEb7J,EAAM8J,KAAO,WACO,KAAdlJ,EACFH,EAAOJ,SAASuG,KAAO,+BAEvBxG,EAAmBY,aAIvBhB,EAAM+J,UAAY,CAChBC,KAAM,MACNC,MAAM,EACNC,IAAK,CACHC,OAAO,EACPZ,MAAO,GACPF,OAAQ,KAEVe,OAAQ,CACND,OAAO,EACPZ,MAAO,IACPF,OAAQ,GACRgB,YAAa,kCACbC,aAAc,iCAEhBC,KAAM,CACJJ,OAAO,EACPZ,MAAO,GACPF,OAAQ,IAEVmB,MAAO,CACLL,OAAO,EACPZ,MAAO,IACPF,OAAQ,IACRoB,QAAS,+BAEXxH,SAAU,KACVG,IAAK,MAGPpD,EAAM0K,OAAS,SAAU3B,GACvB,IAAIC,EAAMD,EAAGE,OAAOD,IAAME,EAAE,gBAAgBD,SAASD,IACjDG,EAAOJ,EAAGE,OAAOE,KAAOD,EAAE,gBAAgBD,SAASE,KACnD3F,EAAS,IAAIuB,EAAa,CAC5BiE,IAAKA,EACLI,WAAYJ,EAAME,EAAE,gBAAgBG,SACpCF,KAAMA,EACNG,YAAaH,EAAOD,EAAE,gBAAgBK,QACtCS,KAAMhK,EAAM+J,UAAUC,KACtBG,MAAOnK,EAAM+J,UAAU/J,EAAM+J,UAAUC,MAAMG,MAC7C7C,MAAOtH,EAAM+J,UAAUzC,MACvBE,SAAUxH,EAAM+J,UAAUvC,SAC1BvE,SAAUjD,EAAM+J,UAAU9G,SAC1BsF,YAAavI,EAAM+J,UAAUxB,YAC7BnF,IAAKpD,EAAM+J,UAAU3G,IACrB6G,KAAMjK,EAAM+J,UAAUE,KACtBV,MAAOvJ,EAAM+J,UAAU/J,EAAM+J,UAAUC,MAAMT,MAC7CE,aAAczJ,EAAM+J,UAAU/J,EAAM+J,UAAUC,MAAMT,MAAQL,EAAE,gBAAgBK,QAC9EF,OAAQrJ,EAAM+J,UAAU/J,EAAM+J,UAAUC,MAAMX,OAC9CK,cAAe1J,EAAM+J,UAAU/J,EAAM+J,UAAUC,MAAMX,OAASH,EAAE,gBAAgBG,SAChFgB,YAAarK,EAAM+J,UAAU/J,EAAM+J,UAAUC,MAAMK,YACnDC,aAActK,EAAM+J,UAAU/J,EAAM+J,UAAUC,MAAMM,aACpDK,aAAc3K,EAAM+J,UAAU/J,EAAM+J,UAAUC,MAAMS,QACpDpG,MAAOrE,EAAM+J,UAAU1F,QAEzBb,EAAOA,EAAOwG,MAAQnH,KAAKC,MAAMD,KAAKgD,UAAU7F,EAAM+J,UAAU/J,EAAM+J,UAAUC,QAE5EhK,EAAMiH,SAASjE,KACjBhD,EAAMiH,SAASjE,KAAKG,KAAKK,GAEzBxD,EAAMiH,SAASjE,KAAO,CAACQ,IAI3BxD,EAAM4K,QAAU,SAAUzJ,GAUxB,MARS,CACP6H,IAAK7H,EAAQ6H,IACbG,KAAMhI,EAAQgI,KACdI,MAAOpI,EAAQoI,MACfF,OAAQlI,EAAQkI,OAChBwB,SAAU,WACVC,UAAW,iBAKf9K,EAAM+K,cAAgB,SAAU5J,GAQ9B,MAPa,CACX2J,UAAa,WAAa3J,EAAQkD,MAAQ,OAC1C2G,gBAAiB,WAAa7J,EAAQkD,MAAQ,OAC9C4G,iBAAkB,WAAa9J,EAAQkD,MAAQ,OAC/C6G,oBAAqB,WAAa/J,EAAQkD,MAAQ,OAClD8G,eAAgB,WAAahK,EAAQkD,MAAQ,SAKjDrE,EAAMoL,YAAc,WAClB,IAAI5H,EAAS,GAMb,SAAS6H,IACP,IACI7H,EAAS,CACXR,KAFQ3B,KAEE2B,KAAKM,IAAI,SAAUnC,GAC3B,IAAIqC,EAAS,GA8Bb,OA7BAA,EAAOC,MAAQtC,EAAQsC,MACvBD,EAAOwG,KAAO7I,EAAQ6I,KAElB7I,EAAQmG,QACV9D,EAAO8D,MAAQ,CACb9F,GAAIL,EAAQmG,MAAM9F,GAClBiC,MAAOtC,EAAQmG,MAAM7D,QAIrBtC,EAAQ8B,WACVO,EAAOP,SAAW,CAChBzB,GAAIL,EAAQ8B,SAASzB,GACrBiC,MAAOtC,EAAQ8B,SAASQ,QAIxBtC,EAAQA,EAAQ6I,QAClBxG,EAAOA,EAAOwG,MAAQ,CACpBxI,GAAIL,EAAQA,EAAQ6I,MAAMxI,GAC1BiC,MAAOtC,EAAQA,EAAQ6I,MAAMvG,MAC7BkE,KAAMxG,EAAQA,EAAQ6I,MAAMrC,MAG1BxG,EAAQA,EAAQ6I,MAAMtC,OACxBlE,EAAOA,EAAOwG,MAAMtC,KAAOvG,EAAQA,EAAQ6I,MAAMtC,OAI9ClE,KAQX,OAzCUnC,KAqCFiK,QACN9H,EAAO8H,MAtCCjK,KAsCWiK,OAGd9H,EA/CTA,EAAOT,QAAUsI,EAAQhE,KAAKrH,EAAM+C,SACpCS,EAAOyD,SAiDP,WACE,IAAIzD,EAuDJ,OArDAA,EAAS,CACPR,KAFQ3B,KAEE2B,KAAKM,IAAI,SAAUnC,GAC3B,IAAIqC,EAAS,GA+Cb,OA7CIrC,EAAQmG,QACV9D,EAAO8D,MAAQ,CACb9F,GAAIL,EAAQmG,MAAM9F,GAClBiC,MAAOtC,EAAQmG,MAAM7D,QAIrBtC,EAAQ8B,WACVO,EAAOP,SAAW,CAChBzB,GAAIL,EAAQ8B,SAASzB,GACrBiC,MAAOtC,EAAQ8B,SAASQ,QAIxBtC,EAAQiC,MACVI,EAAOJ,IAAM,CACX5B,GAAIL,EAAQiC,IAAI5B,GAChBiC,MAAOtC,EAAQiC,IAAIK,QAIvBD,EAAOyG,KAAO9I,EAAQ8I,KACtBzG,EAAO2G,MAAQhJ,EAAQgJ,MACvB3G,EAAOwG,KAAO7I,EAAQ6I,KACtBxG,EAAO+F,MAAQpI,EAAQoI,MACvB/F,EAAOiG,aAAetI,EAAQsI,aAC9BjG,EAAO6F,OAASlI,EAAQkI,OACxB7F,EAAOkG,cAAgBvI,EAAQuI,cAC/BlG,EAAOwF,IAAM7H,EAAQ6H,IACrBxF,EAAO4F,WAAajI,EAAQiI,WAC5B5F,EAAO2F,KAAOhI,EAAQgI,KACtB3F,EAAO8F,YAAcnI,EAAQmI,YAEzBnI,EAAQkJ,cACV7G,EAAO6G,YAAclJ,EAAQkJ,aAG3BlJ,EAAQmJ,eACV9G,EAAO8G,aAAenJ,EAAQmJ,cAG5BnJ,EAAQwJ,eACVnH,EAAOmH,aAAexJ,EAAQwJ,cAGzBnH,MAGJ0D,gBArDG7F,KAqDmB6F,gBACtB1D,GAzGqB6D,KAAKrH,EAAMiH,UACzCzD,EAAO2D,OAASkE,EAAQhE,KAAKrH,EAAMmH,QACnCzC,EAAWlB,IA2GbsB,EAAS,SAAgBzC,GACvB,IAAImB,EAAS,GAEb,IAAK,IAAIpC,KAAKiB,EACH,aAALjB,GAAoBiB,EAAKkJ,eAAenK,KAC1CoC,EAAOpC,GAAKiB,EAAKjB,IAIrB,OAAOoC,IAITyB,EAAS,SAAgB5C,GAGvB,IAAK,IAAIjB,KAAKiB,EACH,aAALjB,GAAoBiB,EAAKkJ,eAAenK,KAClB,UAApB7B,QAAQ8C,EAAKjB,KAAqC,aAAXiB,EAAKjB,GAJ1CC,KAKAD,GAAKyB,KAAKC,MAAMD,KAAKgD,UAAUxD,EAAKjB,KALpCC,KAOAD,GAAKiB,EAAKjB,MAMfxB,UAAU4L,SAAW,SAAUrG,GACpC,IAAIoC,EAAMlG,KACN0E,EAAUwB,EAAI/F,GAEJ,MAAV2D,IACFA,EAAOmC,MAAQxC,EAAOyC,IAGTT,MAAXS,EAAInE,IACNlD,EAAqBsC,KAAKiF,aAAa1B,GAAS3D,KAelD,SAAoBC,GAClBkF,EAAInE,IAAMf,EAAKiB,IAAI,SAAUnC,GAC3B,MAAO,CACLK,GAAIL,EAAQK,GACZiC,MAAOtC,EAAQsC,MACfiE,KAAMvG,EAAQuG,KAAOvG,EAAQuG,KAAO,gBACpCC,KAAMxG,EAAQwG,QAIJ,MAAVxC,IACFA,EAAOmC,MAAMlE,IAAMmE,EAAInE,MAI3B,SAAkBQ,GAChBC,QAAQC,IAAIF,KA7BE,MAAVuB,IACFA,EAAOmC,MAAMlE,IAAMmE,EAAInE,KAIX0D,MAAZS,EAAIkE,KACNvL,EAAqBwL,MAAMjE,aAAa1B,GAAS3D,KA0BnD,SAAqBC,GACnBkF,EAAIkE,KAAOpJ,EAAKiB,IAAI,SAAUnC,GAC5B,MAAO,CACLK,GAAIL,EAAQK,GACZiC,MAAOtC,EAAQsC,SAIL,MAAV0B,IACFA,EAAOmC,MAAMmE,KAAOlE,EAAIkE,OAI5B,SAAmB7H,GACjBC,QAAQC,IAAIF,KAtCE,MAAVuB,IACFA,EAAOmC,MAAMmE,KAAOlE,EAAIkE,QAyC9B9G,EAAY,SAAmBtC,GACnBhB,KACNG,GAAKa,EAAKb,GADJH,KAENoC,MAAQpB,EAAKoB,MAFPpC,KAGN0E,QAAU1D,EAAK0D,UAGXnG,UAAU4L,SAAW,SAAUrG,GACvC,IAAIoC,EAAMlG,KACN0E,EAAUwB,EAAIxB,QAEJ,MAAVZ,IACFA,EAAOlC,SAAW6B,EAAOyC,IAGZT,MAAXS,EAAInE,IACNlD,EAAqBsC,KAAKiF,aAAa1B,GAAS3D,KAelD,SAAoBC,GAClBkF,EAAInE,IAAMf,EAAKiB,IAAI,SAAUnC,GAC3B,MAAO,CACLK,GAAIL,EAAQK,GACZiC,MAAOtC,EAAQsC,MACfiE,KAAMvG,EAAQuG,KAAOvG,EAAQuG,KAAO,gBACpCC,KAAMxG,EAAQwG,QAIJ,MAAVxC,IACFA,EAAOlC,SAASG,IAAMmE,EAAInE,MAI9B,SAAkBQ,GAChBC,QAAQC,IAAIF,KA7BE,MAAVuB,IACFA,EAAOlC,SAASG,IAAMmE,EAAInE,KAId0D,MAAZS,EAAIkE,KACNvL,EAAqBwL,MAAMjE,aAAa1B,GAAS3D,KA0BnD,SAAqBC,GACnBkF,EAAIkE,KAAOpJ,EAAKiB,IAAI,SAAUnC,GAC5B,MAAO,CACLK,GAAIL,EAAQK,GACZiC,MAAOtC,EAAQsC,SAIL,MAAV0B,IACFA,EAAOlC,SAASwI,KAAOlE,EAAIkE,OAI/B,SAAmB7H,GACjBC,QAAQC,IAAIF,KAtCE,MAAVuB,IACFA,EAAOlC,SAASwI,KAAOlE,EAAIkE,QAyCjC5G,EAAU,SAAiBxC,GAGzB,IAAK,IAAIjB,KAAKiB,EAFJhB,KAGJD,GAAKiB,EAAKjB,KAIVxB,UAAU+L,IAAM,WACZtK,KAQN2B,KARM3B,KAQK2B,KAAK4I,OAAO,CAPb,CACZxI,IAAK,KACLkE,MAAO,KACPrE,SAAU,KACVQ,MAAO,GACPuG,KAAM,UAKVnF,EAAQjF,UAAU+B,OAAS,SAAUkK,GACzBxK,KACN2B,KADM3B,KACK2B,KAAKf,OAAO,SAAUd,GACnC,OAAOA,GAAW0K,MAItBjH,EAAW,SAAkBvC,GAG3B,IAAK,IAAIjB,KAAKiB,EAFJhB,KAGJD,GAAKiB,EAAKjB,KAITxB,UAAU+L,IAAM,WACbtK,KAQN2B,KARM3B,KAQK2B,KAAK4I,OAAO,CAPb,CACZxI,IAAK,KACLkE,MAAO,KACPrE,SAAU,KACVQ,MAAO,GACPuG,KAAM,UAKVpF,EAAShF,UAAU+B,OAAS,SAAUkK,GAGhCA,EAAK5I,WACP4I,EAAK5I,SAAS6I,MAAO,GAHbzK,KAMN2B,KANM3B,KAMK2B,KAAKf,OAAO,SAAUd,GACnC,OAAOA,GAAW0K,KAsdxB,SAASE,EAAc/L,EAAOC,EAAGC,EAAsBC,EAAOM,EAAQJ,EAAUE,EAAmByL,EAAoBC,EAAUzL,EAAS+D,EAAmBnE,GAC3JJ,EAAMa,IAAI,yBAA0B,SAAUC,GACrB,YAAnBT,EAASU,QACXX,EAAmBY,cAGvB,IAAIO,EAEAkD,EAGAyH,EAFAC,EAAS,GACTC,GAAU,EA+Gd,SAAS7G,EAAKhE,GACZhB,EAAkBsH,gBAAgBtG,EAAeiE,GAGnD,SAASA,EAAmB1E,GACR,GAAdA,EAAM2E,MACa3E,EAAMuB,KAG7BnC,EAAqBgC,MAAMC,SAASC,KAAKiK,GAG3C,SAASA,EAAchK,GACrB,IAAK,IAAIjB,KAAKiB,EACZ,GAAyB,sBAArBA,EAAKjB,GAAGkB,UAAmC,CAC7C,IAAIgK,EAAKzJ,KAAKC,MAAMT,EAAKjB,GAAGuB,SAExB2J,EAAG/K,eAAiBA,IACtBkD,EAAc6H,EACdzI,QAAQC,IAAIW,IAKlBzE,EAAMmH,OAAS1C,EAAY0C,OAI7B,WACE,IAAI5E,EAAQ,GACRC,EAAO,GACP+J,EAAc,GACdC,EAAa,GACbC,EAAc,GACdC,EAAa,GAEjB,IAAK,IAAItL,KAAKqD,EAAYwC,SAASjE,MACjC,SAAWP,EAAOtB,GACI,UAAhBA,EAAQ6I,OACV7I,EAAQqK,SAAW,SAAUnH,GAC3BR,QAAQC,IAAI,SAAUO,KAIN,SAAhBlD,EAAQ6I,KACVmC,EAAOhJ,KAAKhC,IAEqB,UAA7B5B,QAAQ4B,EAAQ8B,WAA6C,MAApB9B,EAAQ8B,YACR,GAAvCV,EAAMW,QAAQ/B,EAAQ8B,SAASzB,KACjCe,EAAMY,KAAKhC,EAAQ8B,SAASzB,IAGV,OAAhBL,EAAQ6I,OAA8D,GAA7CuC,EAAYrJ,QAAQ/B,EAAQ8B,SAASzB,KAChE+K,EAAYpJ,KAAKhC,EAAQ8B,SAASzB,IAGhB,UAAhBL,EAAQ6I,OAAiE,GAA7CuC,EAAYrJ,QAAQ/B,EAAQ8B,SAASzB,KACnEjB,EAAkBsH,gBAAgB1G,EAAQ8B,SAASzB,GAAI,SAAUV,GAC/D,GAAIA,EAAMuB,KAAM,CACd,IAAI0D,EAAUjF,EAAMuB,KAAK0D,QACzB7F,EAAqByM,WAAWlF,aAAa1B,GAAS3D,KAAK,SAAiBtB,GAC1E,IACE,KAAIA,aAAiBkH,OAUnB,MAAMlH,EAAM8L,QATZ,IAAIC,EAAQ/L,EAAM,GAAGU,GACjB4C,EAASjD,EAAQ8B,SAASzB,GAE9BL,EAAQ2L,oBAAsB,SAAUzI,GACtC9D,EAAkBuM,oBAAoB1I,EAAQyI,EAAO,CACnDxI,MAAOA,GACN,SAAUvD,OAKjB,MAAO8C,GACPC,QAAQC,IAAIF,SAOF,QAAhBzC,EAAQ6I,OAA+D,GAA7CuC,EAAYrJ,QAAQ/B,EAAQ8B,SAASzB,KACjEjB,EAAkBsH,gBAAgB1G,EAAQ8B,SAASzB,GAAI,SAAUV,GAC/D,GAAIA,EAAMuB,KAAM,CACd,IAAI0D,EAAUjF,EAAMuB,KAAK0D,QACzB7F,EAAqByM,WAAWlF,aAAa1B,GAAS3D,KAAK,SAAiBtB,GAC1E,IACE,KAAIA,aAAiBkH,OAAqBlB,MAAZhG,EAAM,IAUlC,MAAMA,EAAM8L,QATZ,IAAIC,EAAQ/L,EAAM,GAAGU,GACjB4C,EAASjD,EAAQ8B,SAASzB,GAE9BL,EAAQ2L,oBAAsB,SAAUzI,GACtC9D,EAAkBuM,oBAAoB1I,EAAQyI,EAAO,CACnDxI,MAAOA,GACN,SAAUvD,OAKjB,MAAO8C,GACPC,QAAQC,IAAIF,UAQI,UAAxBrE,QAAQ4B,EAAQiC,MAAmC,MAAfjC,EAAQiC,OACT,GAAjCZ,EAAKU,QAAQ/B,EAAQiC,IAAI5B,KAC3BgB,EAAKW,KAAKhC,EAAQiC,IAAI5B,KAGmB,GAAvCgL,EAAWtJ,QAAQ/B,EAAQiC,IAAI5B,KACjCgL,EAAWrJ,KAAKhC,EAAQiC,IAAI5B,MA9EpC,CAkFGJ,EAAGqD,EAAYwC,SAASjE,KAAK5B,IAGlC,IAAK,IAAIA,KAAKqD,EAAY0C,OAAOnE,KAEI,UAA7BzD,SADY4B,EAsBZsD,EAAY0C,OAAOnE,KAAK5B,IArBR6B,WAA6C,MAApB9B,EAAQ8B,YACF,GAA7CwJ,EAAYvJ,QAAQ/B,EAAQ8B,SAASzB,KACvCiL,EAAYtJ,KAAKhC,EAAQ8B,WAGsB,GAA7CsJ,EAAYrJ,QAAQ/B,EAAQ8B,SAASzB,MACvCqC,QAAQC,IAAI,UAAW3C,EAAQ8B,SAASzB,IACxC+K,EAAYpJ,KAAKhC,EAAQ8B,SAASzB,MAIV,UAAxBjC,QAAQ4B,EAAQiC,MAAmC,MAAfjC,EAAQiC,OACF,GAAxCqJ,EAAYvJ,QAAQ/B,EAAQiC,IAAI5B,KAClCkL,EAAWvJ,KAAKhC,EAAQiC,MAGiB,GAAvCoJ,EAAWtJ,QAAQ/B,EAAQiC,IAAI5B,MACjCqC,QAAQC,IAAI,SAAU3C,EAAQiC,IAAI5B,IAClCgL,EAAWrJ,KAAKhC,EAAQiC,IAAI5B,MAnBlC,IAAkBL,GA8BtB,SAAuBoB,EAAOC,GAC5B0J,EAAOa,KAAKb,OACZ,IAAI/F,EAAQ,CACV6G,KAAMzK,EAAM0K,WACZ7J,IAAKZ,EAAKyK,YAEZzM,EAAQ,YAIR,SAAS0M,IACP,IAAK,IAAI9L,KAAKqD,EAAY0C,OAAOnE,KAAM,CACrC,IAAIiB,EAAOQ,EAAY0C,OAAOnE,KAAK5B,GAC/B+L,EAAalJ,EAAKmJ,SAASC,OAAO,GAAGhL,KAAK4B,EAAKmJ,SAASC,OAAO,GAAGhL,KAAK+C,OAAS,GAChFkI,EAAYrJ,EAAKmJ,SAASG,MAAMlL,KAAK4B,EAAKmJ,SAASG,MAAMlL,KAAK+C,OAAS,GAC3E+H,EAAa7H,SAAS6H,GAAc7H,SAASA,SAAS6H,GAAcJ,KAAKS,SAAW,IAAM,MAE1F/I,EAAY0C,OAAOnE,KAAK5B,GAAGqM,SAASN,EAAY7H,SAASgI,GAAa,KACtE9M,EAAQ,WACN0M,KACC,OAbLA,IACC,KAuEHjB,EAASyB,KAAKxB,EAAM,WAAY,MAAO/F,IApFvCwH,CAAcpB,EAAaC,GAC3BtM,EAAqB6D,UAAUxB,EAAOC,GAAMJ,KAAKwL,GACjD1N,EAAqB2N,4BAA4BpB,EAAaC,EAAY,OAAsB,KAAYtK,KAAK0L,GA7HjHC,GAkNF,SAASH,EAAevL,GACtB,IAAK,IAAI2B,KAAKS,EAAYwC,SAASjE,KACfiB,EAEZQ,EAAYwC,SAASjE,KAAKgB,GAD9BgK,EAAU3G,KAAKpD,GADjB,IAAkBA,EAgIP5B,EAzHb,SAAS2L,IACP,IAAIzG,EAAMlG,KACNqC,EAAOrB,EAAKqB,KAAK,SAAUQ,GAC7B,MAAwB,UAApB3E,QAAQgI,EAAInE,MAA+B,MAAXmE,EAAInE,KAAwC,UAAzB7D,QAAQgI,EAAItE,WAAyC,MAAhBsE,EAAItE,WACvFiB,EAAGC,SAAWoD,EAAInE,IAAI5B,IAAM0C,EAAGE,QAAUmD,EAAItE,SAASzB,MAM7DkC,GACEA,EAAKW,MACPkD,EAAIlD,MAAQX,EAAKW,MAKnBkD,EAAIlD,MAAQ,IAwGHhC,EA3HPoC,EA4HNzE,EAAMiH,SAAW5E,EAAK4E,SApGxB,SAAS6G,EAAmBzL,GAC1B,IAAI4L,EAAS,CAAC,UAAW,UAAW,UAAW,UAAW,WAE1D,IAAK,IAAI7M,KAAKpB,EAAMmH,OAAOnE,MACzB,SAAWP,EAAOtB,GAChB,GAAiC,UAA7B5B,QAAQ4B,EAAQ8B,WAA6C,MAApB9B,EAAQ8B,UAA4C,UAAxB1D,QAAQ4B,EAAQiC,MAAmC,MAAfjC,EAAQiC,IAAa,CAChI,IAAIM,EAAOrB,EAAK6L,OAAOxK,KAAK,SAAUO,GACpC,OAAOA,EAAKkK,IAAMhN,EAAQ8B,SAASQ,OAASQ,EAAKb,KAAOjC,EAAQiC,IAAIK,QAE5DpB,EAAK6L,OAAOhL,QAAQQ,GAEwB,GAAlDrB,EAAK+L,MAAM,UAAY3L,EAAQ,iBAA0EqE,MAAlDzE,EAAK+L,MAAM,UAAY3L,EAAQ,gBACxF4L,EAAWhH,KAAKlG,EAAS,CACvB+M,OAAQ,CAAC,SACTX,MAAO,WAIL,IAHA,IAAIA,EAAQ,GACRe,GAAU,IAAIC,MAAOC,UAEhBpN,EAAI,EAAGA,EAAI,GAAIA,IACtBmM,EAAMpK,KAAKmL,EAAU,MAIvB,OADAf,EAAMkB,OACClB,EATF,GAWPF,OAAQ,WAGN,IAFA,IAAIA,EAAS,GAEJjM,EAAI,EAAGA,EAAI,GAAIA,IACtBiM,EAAOlK,KAAKmC,SAAyB,IAAhByH,KAAKS,WAG5B,MAAO,CAAC,CACNkB,KAAM,CACJP,GAAI,KACJ/K,IAAK,MAEPf,KAAMgL,IAZF,IAePY,EAAOxL,EAAQ,IAAI,GAEtB4L,EAAWhH,KAAKlG,EAAS,CACvB+M,OAAQ,CAAC7L,EAAK6L,OAAOzL,IACrB8K,MAAOlL,EAAKkL,MACZF,OAAQ,CAAChL,EAAKgL,OAAO5K,KACpBwL,EAAOxL,EAAQ,KA1CxB,CA6CGrB,EAAGpB,EAAMmH,OAAOnE,KAAK5B,IAI5B,SAASiN,EAAWhM,EAAMsM,EAAOC,GAG3BA,GACF/K,QAAQC,IAAI,UAAWzB,GAGzB,IAAIwM,EAAY,IAAI7C,EAAmB8C,UACvCD,EAAUE,SAAS,CACjB9E,MAAM,IAER4E,EAAUG,QAAQ,CAChBhG,IAAK,KACLG,KAAM,KACNI,MAAO,MACPF,OAAQ,QAEVwF,EAAUI,cAAc,MACxBJ,EAAUK,SAAS,CACjB7M,KAAMA,EAAKkL,QAEblL,EAAKgL,OAAO,GAAG8B,WAAW,CACxBC,UAAW,CACTC,OAAQ,CACNV,MAAOA,IAGXW,UAAW,CACTD,OAAQ,CACNV,MAAOA,IAGXY,UAAW,CACTvF,KAAM,UACNqF,OAAQ,CACNV,MAAOA,MAIbE,EAAUW,iBAAiBnN,EAAKgL,QAEJ,mBAxClBhM,KAwCKoO,WAxCLpO,KAyCJoO,UAAUZ,EAAUa,gBAtd5B1P,EAAM2P,OAAS,GAEf3P,EAAM4P,WAAa,WACjB5P,EAAM6P,WAAY,GAGpB7P,EAAM8P,kBAAoB,WACxBrP,EAAOJ,SAASuG,KAAO,mCAGzB5G,EAAM+P,cAAgB,WACpBtP,EAAOJ,SAASuG,KAAO,mCAGzB5G,EAAMgQ,eAAiB,WACrBvP,EAAOJ,SAASuG,KAAO,mCAGzB5G,EAAMiQ,iBAAmB,WACvBxP,EAAOJ,SAASuG,KAAO,uCAGzB5G,EAAMkQ,WAAa,WACjBzP,EAAOJ,SAASuG,KAAO,oCAGzB5G,EAAM6P,WAAY,EAClB7P,EAAMa,IAAI,WAAY,WACpBoL,EAASkE,WAAWjE,KAGtBlM,EAAMoQ,WAAa,WACjBpQ,EAAM6P,WAAa7P,EAAM6P,WAG3B7P,EAAMqQ,MAAQ,GAEdrQ,EAAMsQ,SAAW,WACXtQ,EAAMqQ,MAAME,SACdvQ,EAAMqQ,MAAME,UAGdnE,GAAU,GAGZpM,EAAMwQ,SAAW,WACXxQ,EAAMqQ,MAAMG,UACdxQ,EAAMqQ,MAAMG,WAGdpE,GAAU,GAGZpM,EAAMoM,QAAU,WACd,OAAOA,GAGTpM,EAAMyQ,WAAa,WAGjB,GAFAzQ,EAAM6I,SAAW7I,EAAM6I,QAEnB7I,EAAM6I,QAAS,CACjB,IAAK,IAAIzH,KAAK+K,EACZA,EAAO/K,GAAGsP,aAGZ1Q,EAAM2P,OAAOe,iBACR,CACL,IAAK,IAAItP,KAAK+K,EACZA,EAAO/K,GAAGuP,YAGZ3Q,EAAM2P,OAAOgB,cAIjB3Q,EAAM4K,QAAU,SAAUzJ,GAUxB,MARS,CACP6H,IAA0B,IAArB7H,EAAQiI,WAAmB,IAChCD,KAA4B,IAAtBhI,EAAQmI,YAAoB,IAClCC,MAA8B,IAAvBpI,EAAQsI,aAAqB,IACpCJ,OAAgC,IAAxBlI,EAAQuI,cAAsB,IACtCoB,UAAW,eACXD,SAAU,aAKd7K,EAAM+K,cAAgB,SAAU5J,GAQ9B,MAPa,CACX2J,UAAa,WAAa3J,EAAQkD,MAAQ,OAC1C2G,gBAAiB,WAAa7J,EAAQkD,MAAQ,OAC9C4G,iBAAkB,WAAa9J,EAAQkD,MAAQ,OAC/C6G,oBAAqB,WAAa/J,EAAQkD,MAAQ,OAClD8G,eAAgB,WAAahK,EAAQkD,MAAQ,SAK7ClE,EAAMsI,QAERlD,EADAhE,EAAgBpB,EAAMsI,QAAQG,OAAOrH,eAGrCvB,EAAMa,IAAI,kBAAmB,WAE3B0E,EADAhE,EAAgBpB,EAAMsI,QAAQG,OAAOrH,iBApvC3CzB,EAAY8Q,eAAe,oBAAqB7Q,GAChDA,EAAkB8Q,QAAU,CAAC,SAAU,KAAM,uBAAwB,SAAU,qBAAsB,YAAa,kBAAmB,oBAAqB,WAAY,WA0JtK/Q,EAAY8Q,eAAe,SAAUtM,GACrCA,EAAWuM,QAAU,CAAC,SAAU,KAAM,uBAAwB,SAAU,YAAa,kBAAmB,oBAAqB,oBAAqB,UAAW,sBAi+B7J/Q,EAAY8Q,eAAe,gBAAiB7E,GAC5CA,EAAc8E,QAAU,CAAC,SAAU,KAAM,uBAAwB,SAAU,UAAW,YAAa,oBAAqB,qBAAsB,WAAY,WAAY,oBAAqB","file":"app-sc/js/controllers/tglibrary-ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers', 'Array'], function (controllers) {\n  'use strict';\n\n  controllers.initController(\"tglibraryPrevCtrl\", tglibraryPrevCtrl);\n  tglibraryPrevCtrl.$inject = ['$scope', '$q', 'serviceCenterService', '$route', 'userLoginUIService', '$location', 'viewFlexService', 'resourceUIService', '$timeout', '$window'];\n\n  function tglibraryPrevCtrl(scope, q, serviceCenterService, route, userLoginUIService, location, viewFlexService, resourceUIService, timeout, window) {\n    scope.$on('$locationChangeSuccess', function (event) {\n      if (location.path() == \"/servers\") {\n        userLoginUIService.changePos();\n      }\n    });\n    var allMyViews, $deviceGroup, solutionId;\n\n    if (userLoginUIService.user.appData) {\n      solutionId = userLoginUIService.user.appData.solutionId;\n    } else {\n      scope.$on(\"loginStatusChanged\", function () {\n        solutionId = userLoginUIService.user.appData.solutionId;\n      });\n    }\n\n    $deviceGroup = function $deviceGroup(element) {\n      var cur = this;\n\n      for (var i in element) {\n        cur[i] = element[i];\n      }\n    };\n\n    $deviceGroup.prototype.edit = function () {\n      var cur = this;\n      var deviceGroupId = cur.id;\n      location.path(\"tongji/edit/\" + solutionId + \"/\" + deviceGroupId);\n    };\n\n    $deviceGroup.prototype.detail = function () {\n      var cur = this;\n      var deviceGroupId = cur.id;\n      location.path(\"tongji/detail/\" + deviceGroupId);\n    };\n\n    scope.addResource = function () {\n      location.path(\"tongji/edit/\" + solutionId);\n    };\n\n    $deviceGroup.prototype.remove = function () {\n      var cur = this;\n      var deviceGroupId = cur.id;\n      var viewId = cur.view.viewId;\n      viewFlexService.deleteViews([viewId], callback);\n\n      function callback(event) {\n        resourceUIService.deleteDeviceGroup(deviceGroupId, callback);\n\n        function callback(event) {\n          scope.deviceGroups = scope.deviceGroups.filter(function (element) {\n            return element.id != deviceGroupId;\n          });\n        }\n      }\n    };\n\n    serviceCenterService.views.getAll(false).then(success, error);\n\n    function success(data) {\n      allMyViews = data.filter(function (element) {\n        return element.viewTitle == \"tongji_deviceGroup\";\n      });\n      var nodes = [];\n      var kpis = [];\n\n      for (var i in allMyViews) {\n        (function (index, element) {\n          var jsondata = {};\n          var content = element.content;\n\n          if (content.slice(0, 1) == \"{\" && content.slice(-1) == \"}\") {\n            jsondata = JSON.parse(content);\n\n            for (var i in jsondata.preview.list) {\n              (function (index, element) {\n                if (element.resource) {\n                  if (nodes.indexOf(element.resource.id) == -1) {\n                    nodes.push(element.resource.id);\n                  }\n                }\n\n                if (element.kpi) {\n                  if (nodes.indexOf(element.kpi.id) == -1) {\n                    kpis.push(element.kpi.id);\n                  }\n                }\n              })(i, jsondata.preview.list[i]);\n            }\n          }\n\n          element.JSON = jsondata;\n        })(i, allMyViews[i]);\n      }\n\n      serviceCenterService.getValues(nodes, kpis).then(allValueLoaded, error);\n\n      function allValueLoaded(data) {\n        for (var i in allMyViews) {\n          (function (index, element) {\n            for (var j in element.JSON.preview.list) {\n              (function (index, elem) {\n                var find = data.find(function (el) {\n                  if (elem.kpi && elem.resource) {\n                    return el.kpiCode == elem.kpi.id && el.nodeId == elem.resource.id;\n                  } else {\n                    return false;\n                  }\n                });\n\n                if (find) {\n                  if (find.value) {\n                    elem.value = find.value;\n                  } else {\n                    elem.value = '-';\n                  }\n                } else {\n                  elem.value = '-';\n                }\n              })(j, element.JSON.preview.list[j]);\n            }\n          })(i, allMyViews[i]);\n        }\n\n        serviceCenterService.deviceGroups.getAll(false).then(success, error);\n      }\n\n      function success(data) {\n        scope.deviceGroups = data.map(function (deviceGroup) {\n          var result = {\n            id: deviceGroup.id,\n            label: deviceGroup.label,\n            view: null\n          };\n          var find = allMyViews.find(function (view) {\n            return view.JSON.deviceGroupId == result.id;\n          });\n          result.view = find;\n          return new $deviceGroup(result);\n        });\n      }\n\n      function error(err) {\n        console.log(err);\n      }\n    }\n\n    function error(err) {\n      console.log(err);\n    }\n  }\n\n  controllers.initController(\"tgedit\", tgeditCtrl);\n  tgeditCtrl.$inject = ['$scope', '$q', 'serviceCenterService', '$route', '$location', 'viewFlexService', 'resourceUIService', 'solutionUIService', '$window', 'userLoginUIService'];\n\n  function tgeditCtrl(scope, q, serviceCenterService, route, location, viewFlexService, resourceUIService, solutionUIService, window, userLoginUIService) {\n    scope.$on('$locationChangeSuccess', function (event) {\n      if (location.path() == \"/servers\") {\n        userLoginUIService.changePos();\n      }\n    });\n    var currentDeviceGroup, currentView, handleView, $resource, $preview, $charts, $clone, $dragElement, solutionId, deviceGroupId, groupId, $model, mode, units;\n    serviceCenterService.units.getAll().then(function (data) {\n      units = data;\n    });\n\n    if (route.current) {\n      if (route.current.$$route.originalPath.indexOf('modeledit') != -1) {\n        scope.mode = 'editmodel';\n      } else if (route.current.$$route.originalPath.indexOf('edit') != -1) {\n        scope.mode = 'edit';\n      }\n\n      groupId = route.current.params.groupId;\n      deviceGroupId = route.current.params.deviceGroupId;\n      scope.solutionId = solutionId = route.current.params.solutionId;\n      init();\n    } else {\n      scope.$on(\"locationChanged\", function () {\n        groupId = route.current.params.groupId;\n        deviceGroupId = route.current.params.deviceGroupId;\n        solutionId = route.current.params.solutionId;\n\n        if (route.current.$$route.originalPath.indexOf('modeledit') != -1) {\n          scope.mode = 'editmodel';\n        } else if (route.current.$$route.originalPath.indexOf('edit') != -1) {\n          scope.mode = 'edit';\n        }\n\n        init();\n      });\n    }\n\n    scope.kpiChange = kpiChange;\n    scope.alertOn = false;\n\n    function kpiChange(target) {\n      if (target.kpi != null) {\n        if (_typeof(target.resource) == \"object\" && target.resource != null) {\n          serviceCenterService.getValues([target.resource.id], [target.kpi.id]).then(success, error);\n        }\n      }\n\n      function success(data) {\n        if (data.length > 0) {\n          if (typeof target.setValue == \"function\") {\n            target.setValue(parseInt(data[0].value));\n          } else {\n            target.value = parseInt(data[0].value);\n          }\n        } else {\n          target.value = \"-\";\n        }\n      }\n\n      function error(err) {}\n    }\n\n    ;\n\n    $dragElement = function $dragElement(data) {\n      var cur = this;\n\n      for (var i in data) {\n        cur[i] = data[i];\n      }\n    };\n\n    $dragElement.prototype.stopMove = function (ui) {\n      var cur = this;\n      var top = ui.offset.top - $(\".drawingArea\").offset().top;\n      var left = ui.offset.left - $(\".drawingArea\").offset().left;\n      cur.top = top;\n      cur.topPortion = top / $(\".drawingArea\").height();\n      cur.left = left;\n      cur.leftPortion = left / $(\".drawingArea\").width();\n    };\n\n    $dragElement.prototype.stopResize = function (ui) {\n      var cur = this;\n      cur.width = $(ui.element).width();\n      cur.widthPortion = cur.width / $(\".drawingArea\").width();\n      cur.height = $(ui.element).height();\n      cur.heightPortion = cur.height / $(\".drawingArea\").height();\n    };\n\n    $dragElement.prototype.remove = function () {\n      var cur = this;\n      scope.drawarea.list = scope.drawarea.list.filter(function (element) {\n        return element !== cur;\n      });\n    };\n\n    $dragElement.prototype.focusOn = function () {\n      var cur = this;\n      scope.parametersEditor = cur;\n    };\n\n    scope.step = 0;\n\n    scope.exit = function () {\n      if (solutionId != \"0\") {\n        window.location.href = \"../app-ac/index.html#/myView\";\n      } else {\n        userLoginUIService.changePos();\n      }\n    };\n\n    scope.createNew = {\n      type: 'bar',\n      show: true,\n      bar: {\n        scale: true,\n        width: 50,\n        height: 131\n      },\n      switch: {\n        scale: false,\n        width: 100,\n        height: 50,\n        bgimageOpen: 'images/tongji/switch_green1.png',\n        bgimageClose: 'images/tongji/switch_red1.png'\n      },\n      open: {\n        scale: true,\n        width: 80,\n        height: 80\n      },\n      blink: {\n        scale: false,\n        width: 100,\n        height: 100,\n        bgimage: 'images/tongji/tank1_red.png'\n      },\n      resource: null,\n      kpi: null\n    };\n\n    scope.ondrop = function (ui) {\n      var top = ui.offset.top - $(\".drawingArea\").offset().top;\n      var left = ui.offset.left - $(\".drawingArea\").offset().left;\n      var result = new $dragElement({\n        top: top,\n        topPortion: top / $(\".drawingArea\").height(),\n        left: left,\n        leftPortion: left / $(\".drawingArea\").width(),\n        type: scope.createNew.type,\n        scale: scope.createNew[scope.createNew.type].scale,\n        model: scope.createNew.model,\n        modelObj: scope.createNew.modelObj,\n        resource: scope.createNew.resource,\n        resourceObj: scope.createNew.resourceObj,\n        kpi: scope.createNew.kpi,\n        show: scope.createNew.show,\n        width: scope.createNew[scope.createNew.type].width,\n        widthPortion: scope.createNew[scope.createNew.type].width / $(\".drawingArea\").width(),\n        height: scope.createNew[scope.createNew.type].height,\n        heightPortion: scope.createNew[scope.createNew.type].height / $(\".drawingArea\").height(),\n        bgimageOpen: scope.createNew[scope.createNew.type].bgimageOpen,\n        bgimageClose: scope.createNew[scope.createNew.type].bgimageClose,\n        bgBlinkImage: scope.createNew[scope.createNew.type].bgimage,\n        value: scope.createNew.value\n      });\n      result[result.type] = JSON.parse(JSON.stringify(scope.createNew[scope.createNew.type]));\n\n      if (scope.drawarea.list) {\n        scope.drawarea.list.push(result);\n      } else {\n        scope.drawarea.list = [result];\n      }\n    };\n\n    scope.drawPos = function (element) {\n      var result = {};\n      result = {\n        top: element.top,\n        left: element.left,\n        width: element.width,\n        height: element.height,\n        position: \"absolute\",\n        transform: 'rotate(0deg)'\n      };\n      return result;\n    };\n\n    scope.calcuRotation = function (element) {\n      var result = {\n        'transform': 'rotate(-' + element.value + 'deg)',\n        '-ms-transform': 'rotate(-' + element.value + 'deg)',\n        '-moz-transform': 'rotate(-' + element.value + 'deg)',\n        '-webkit-transform': 'rotate(-' + element.value + 'deg)',\n        '-o-transform': 'rotate(-' + element.value + 'deg)'\n      };\n      return result;\n    };\n\n    scope.saveAndExit = function () {\n      var result = {};\n      result.preview = getData.call(scope.preview);\n      result.drawarea = getDrawarea.call(scope.drawarea);\n      result.charts = getData.call(scope.charts);\n      handleView(result);\n\n      function getData() {\n        var cur = this;\n        var result = {\n          list: cur.list.map(function (element) {\n            var result = {};\n            result.label = element.label;\n            result.type = element.type;\n\n            if (element.model) {\n              result.model = {\n                id: element.model.id,\n                label: element.model.label\n              };\n            }\n\n            if (element.resource) {\n              result.resource = {\n                id: element.resource.id,\n                label: element.resource.label\n              };\n            }\n\n            if (element[element.type]) {\n              result[result.type] = {\n                id: element[element.type].id,\n                label: element[element.type].label,\n                unit: element[element.type].unit\n              };\n\n              if (element[element.type].icon) {\n                result[result.type].icon = element[element.type].icon;\n              }\n            }\n\n            return result;\n          })\n        };\n\n        if (cur.title) {\n          result.title = cur.title;\n        }\n\n        return result;\n      }\n\n      function getDrawarea() {\n        var result,\n            cur = this;\n        result = {\n          list: cur.list.map(function (element) {\n            var result = {};\n\n            if (element.model) {\n              result.model = {\n                id: element.model.id,\n                label: element.model.label\n              };\n            }\n\n            if (element.resource) {\n              result.resource = {\n                id: element.resource.id,\n                label: element.resource.label\n              };\n            }\n\n            if (element.kpi) {\n              result.kpi = {\n                id: element.kpi.id,\n                label: element.kpi.label\n              };\n            }\n\n            result.show = element.show;\n            result.scale = element.scale;\n            result.type = element.type;\n            result.width = element.width;\n            result.widthPortion = element.widthPortion;\n            result.height = element.height;\n            result.heightPortion = element.heightPortion;\n            result.top = element.top;\n            result.topPortion = element.topPortion;\n            result.left = element.left;\n            result.leftPortion = element.leftPortion;\n\n            if (element.bgimageOpen) {\n              result.bgimageOpen = element.bgimageOpen;\n            }\n\n            if (element.bgimageClose) {\n              result.bgimageClose = element.bgimageClose;\n            }\n\n            if (element.bgBlinkImage) {\n              result.bgBlinkImage = element.bgBlinkImage;\n            }\n\n            return result;\n          })\n        };\n        result.backgroundImage = cur.backgroundImage;\n        return result;\n      }\n    };\n\n    $clone = function $clone(data) {\n      var result = {};\n\n      for (var i in data) {\n        if (i != \"$$hashKey\" && data.hasOwnProperty(i)) {\n          result[i] = data[i];\n        }\n      }\n\n      return result;\n    }; //Object used\n\n\n    $model = function $model(data) {\n      var cur = this;\n\n      for (var i in data) {\n        if (i != \"$$hashKey\" && data.hasOwnProperty(i)) {\n          if (_typeof(data[i]) == 'object' && typeof data[i] != null) {\n            cur[i] = JSON.parse(JSON.stringify(data[i]));\n          } else {\n            cur[i] = data[i];\n          }\n        }\n      }\n    };\n\n    $model.prototype.onChange = function (target) {\n      var cur = this;\n      var modelId = cur.id;\n\n      if (target != null) {\n        target.model = $clone(cur);\n      }\n\n      if (cur.kpi == undefined) {\n        serviceCenterService.kpis.getBymodelId(modelId).then(successKpi, errorKpi);\n      } else {\n        if (target != null) {\n          target.model.kpi = cur.kpi;\n        }\n      }\n\n      if (cur.attr == undefined) {\n        serviceCenterService.attrs.getBymodelId(modelId).then(successAttr, errorAttr);\n      } else {\n        if (target != null) {\n          target.model.attr = cur.attr;\n        }\n      }\n\n      function successKpi(data) {\n        cur.kpi = data.map(function (element) {\n          return {\n            id: element.id,\n            label: element.label,\n            icon: element.icon ? element.icon : 'ps-irrigation',\n            unit: element.unit\n          };\n        });\n\n        if (target != null) {\n          target.model.kpi = cur.kpi;\n        }\n      }\n\n      function errorKpi(err) {\n        console.log(err);\n      }\n\n      function successAttr(data) {\n        cur.attr = data.map(function (element) {\n          return {\n            id: element.id,\n            label: element.label\n          };\n        });\n\n        if (target != null) {\n          target.model.attr = cur.attr;\n        }\n      }\n\n      function errorAttr(err) {\n        console.log(err);\n      }\n    };\n\n    $resource = function $resource(data) {\n      var cur = this;\n      cur.id = data.id;\n      cur.label = data.label;\n      cur.modelId = data.modelId;\n    };\n\n    $resource.prototype.onChange = function (target) {\n      var cur = this;\n      var modelId = cur.modelId;\n\n      if (target != null) {\n        target.resource = $clone(cur);\n      }\n\n      if (cur.kpi == undefined) {\n        serviceCenterService.kpis.getBymodelId(modelId).then(successKpi, errorKpi);\n      } else {\n        if (target != null) {\n          target.resource.kpi = cur.kpi;\n        }\n      }\n\n      if (cur.attr == undefined) {\n        serviceCenterService.attrs.getBymodelId(modelId).then(successAttr, errorAttr);\n      } else {\n        if (target != null) {\n          target.resource.attr = cur.attr;\n        }\n      }\n\n      function successKpi(data) {\n        cur.kpi = data.map(function (element) {\n          return {\n            id: element.id,\n            label: element.label,\n            icon: element.icon ? element.icon : 'ps-irrigation',\n            unit: element.unit\n          };\n        });\n\n        if (target != null) {\n          target.resource.kpi = cur.kpi;\n        }\n      }\n\n      function errorKpi(err) {\n        console.log(err);\n      }\n\n      function successAttr(data) {\n        cur.attr = data.map(function (element) {\n          return {\n            id: element.id,\n            label: element.label\n          };\n        });\n\n        if (target != null) {\n          target.resource.attr = cur.attr;\n        }\n      }\n\n      function errorAttr(err) {\n        console.log(err);\n      }\n    };\n\n    $charts = function $charts(data) {\n      var cur = this;\n\n      for (var i in data) {\n        cur[i] = data[i];\n      }\n    };\n\n    $charts.prototype.add = function () {\n      var cur = this;\n      var newItem = {\n        kpi: null,\n        model: null,\n        resource: null,\n        label: '',\n        type: 'kpi'\n      };\n      cur.list = cur.list.concat([newItem]);\n    };\n\n    $charts.prototype.remove = function (item) {\n      var cur = this;\n      cur.list = cur.list.filter(function (element) {\n        return element != item;\n      });\n    };\n\n    $preview = function $preview(data) {\n      var cur = this;\n\n      for (var i in data) {\n        cur[i] = data[i];\n      }\n    };\n\n    $preview.prototype.add = function () {\n      var cur = this;\n      var newItem = {\n        kpi: null,\n        model: null,\n        resource: null,\n        label: '',\n        type: 'kpi'\n      };\n      cur.list = cur.list.concat([newItem]);\n    };\n\n    $preview.prototype.remove = function (item) {\n      var cur = this;\n\n      if (item.resource) {\n        item.resource.used = false;\n      }\n\n      cur.list = cur.list.filter(function (element) {\n        return element != item;\n      });\n    }; //FUNCTIONS\n\n\n    function init() {\n      if (scope.mode == 'editmodel') {\n        if (solutionId) {\n          handleView = saveServiceViewContent;\n          solutionUIService.getServiceViewContent(solutionId, groupId, 0, allViewLoaded);\n        } else {\n          if (deviceGroupId) {\n            handleView = updateNewDeviceGroup;\n            resourceUIService.getResourceById(deviceGroupId, resourceInfoLoaded);\n          } else {\n            handleView = saveNewDeviceGroup;\n            createNew();\n          }\n        }\n      } else if (scope.mode == 'edit') {\n        if (deviceGroupId) {\n          handleView = updateNewDeviceGroup;\n          resourceUIService.getResourceById(deviceGroupId, resourceInfoLoaded);\n        } else {\n          handleView = saveNewDeviceGroup;\n          viewFlexService.getServiceViewMap(function (event) {\n            createNewByMap(event.data);\n          }); //createNew();\n        }\n      }\n\n      function resourceInfoLoaded(event) {\n        if (event.code == 0) {\n          currentDeviceGroup = event.data;\n        }\n\n        serviceCenterService.views.getAll().then(function (data) {\n          var views = data;\n\n          for (var i in views) {\n            if (views[i].viewTitle == 'tongji_deviceGroup') {\n              var tg = JSON.parse(views[i].content);\n\n              if (tg.deviceGroupId == deviceGroupId) {\n                currentView = tg;\n                currentView.viewId = views[i].viewId;\n              }\n\n              update(currentDeviceGroup);\n            }\n          }\n        });\n      }\n\n      function allViewLoaded(event) {\n        if (event.code == '0') {\n          if (typeof event.data == 'string') {\n            currentView = JSON.parse(event.data);\n          }\n        }\n\n        if (solutionId) {\n          if (currentView == undefined) {\n            newSolution();\n          } else {\n            updateSolution(currentDeviceGroup);\n          }\n        } else {\n          update(currentDeviceGroup);\n        }\n      }\n\n      function saveNewDeviceGroup(data) {\n        //console.log(data);\n        //scope.deviceGroupModel = data;\n        var deviceGroup = JSON.parse(JSON.stringify(scope.deviceGroupModel));\n        deviceGroup.modelId = deviceGroup.id;\n        delete deviceGroup.id;\n        resourceUIService.saveDeviceGroup(deviceGroup, callback);\n\n        function callback(event) {\n          var newdeviceGroup = event.data;\n          data.deviceGroupId = newdeviceGroup.id;\n          var JSONstring = JSON.stringify(data);\n\n          try {\n            var param = {\n              viewTitle: \"tongji_deviceGroup\",\n              viewName: \"tongji_deviceGroup\",\n              viewType: \"tongji_deviceGroup\",\n              content: JSONstring\n            };\n            viewFlexService.addView(param, callback);\n          } catch (err) {\n            alert(err);\n          }\n\n          function callback(event) {\n            console.log(event);\n            location.path(\"tongji/prev\");\n          }\n        }\n      }\n\n      function saveServiceViewContent(data) {\n        var JSONstring = JSON.stringify(data);\n        solutionUIService.saveServiceViewContent(solutionId, groupId, 0, JSONstring, function (event) {\n          window.location.href = \"../app-ac/index.html#/myView\";\n        });\n      }\n\n      function updateNewDeviceGroup(data) {\n        var deviceGroup = JSON.parse(JSON.stringify(currentDeviceGroup));\n        resourceUIService.saveDeviceGroup(deviceGroup, callback);\n\n        function callback(event) {\n          var newdeviceGroup = event.data;\n          data.deviceGroupId = newdeviceGroup.id;\n          var JSONstring = JSON.stringify(data);\n\n          try {\n            var param = {\n              viewId: currentView.viewId,\n              viewTitle: \"tongji_deviceGroup\",\n              viewName: \"tongji_deviceGroup\",\n              viewType: \"tongji_deviceGroup\",\n              content: JSONstring\n            };\n            viewFlexService.updateView(param, callback);\n          } catch (err) {\n            alert(err);\n          }\n\n          function callback(event) {\n            location.path(\"tongji/prev\");\n          }\n        }\n      }\n    }\n\n    ;\n\n    function newSolution() {\n      solutionUIService.getModelsByGroupId(solutionId, groupId, function (event) {\n        if (event.code == '0') {\n          scope.allModels = event.data.map(function (element) {\n            return new $model(element);\n          });\n          scope.preview = new $preview({\n            list: []\n          });\n          scope.drawarea = {\n            list: [],\n            backgroundImage: 'images/tongji/bg.png'\n          };\n          scope.charts = new $charts({\n            list: []\n          });\n        }\n      });\n    }\n\n    function updateSolution(currentDeviceGroup) {\n      solutionUIService.getModelsByGroupId(solutionId, groupId, function (event) {\n        if (event.code == '0') {\n          scope.allModels = event.data.map(function (element) {\n            return new $model(element);\n          });\n          scope.preview = new $preview(currentView.preview);\n          scope.drawarea = currentView.drawarea;\n          scope.drawarea.list = scope.drawarea.list.map(function (element) {\n            return new $dragElement(element);\n          });\n          scope.charts = new $charts(currentView.charts);\n\n          for (var i in scope.preview.list) {\n            (function (index, elem) {\n              handleModel.call(elem);\n            })(i, scope.preview.list[i]);\n          }\n\n          for (var i in scope.drawarea.list) {\n            (function (index, elem) {\n              handleModel.call(elem);\n            })(i, scope.drawarea.list[i]);\n          }\n\n          for (var i in scope.charts.list) {\n            (function (index, elem) {\n              handleModel.call(elem);\n            })(i, scope.charts.list[i]);\n          }\n        }\n\n        function handleModel() {\n          var cur = this,\n              model;\n\n          if (cur.model) {\n            model = scope.allModels.find(function (element) {\n              return cur.model.id == element.id;\n            });\n          }\n\n          cur.modelObj = model;\n\n          if (model) {\n            serviceCenterService.kpis.getBymodelId(model.id).then(successKpi, errorKpi);\n          }\n\n          function successKpi(data) {\n            cur.model.kpi = data.map(function (element) {\n              return {\n                id: element.id,\n                label: element.label,\n                icon: element.icon ? element.icon : 'ps-irrigation',\n                unit: element.unit\n              };\n            });\n            cur.kpi = cur.model.kpi.find(function (k) {\n              return k.id == cur.kpi.id;\n            });\n            kpiChange(cur);\n          }\n\n          function errorKpi(err) {\n            console.log(err);\n          }\n        }\n      });\n    }\n\n    function update(deviceGroup) {\n      serviceCenterService.resources.getAll().then(success, error);\n\n      function success(data) {\n        scope.resources = data.map(function (element) {\n          return new $resource(element);\n        });\n        serviceCenterService.deviceGroupModels.getAll().then(success, error);\n\n        function success(data) {\n          scope.deviceGroupModels = data;\n          scope.deviceGroupModel = scope.deviceGroupModels.find(function (element) {\n            return deviceGroup.modelId == element.id;\n          });\n          var preview = currentView.preview;\n          var charts = currentView.charts;\n          scope.preview = new $preview(preview);\n          scope.drawarea = currentView.drawarea;\n          scope.drawarea.list = scope.drawarea.list.map(function (element) {\n            return new $dragElement(element);\n          });\n          scope.charts = new $charts(charts);\n\n          for (var i in scope.preview.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.preview.list[i]);\n          }\n\n          for (var i in scope.drawarea.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.drawarea.list[i]);\n          }\n\n          for (var i in scope.charts.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.charts.list[i]);\n          }\n\n          function handleResource() {\n            var cur = this,\n                resource;\n\n            if (cur.resource) {\n              resource = scope.resources.find(function (element) {\n                return cur.resource.id == element.id;\n              });\n            }\n\n            cur.resourceObj = resource;\n\n            if (resource) {\n              serviceCenterService.kpis.getBymodelId(resource.modelId).then(successKpi, errorKpi);\n            }\n\n            function successKpi(data) {\n              cur.resource.kpi = data.map(function (element) {\n                return {\n                  id: element.id,\n                  label: element.label,\n                  icon: element.icon ? element.icon : 'ps-irrigation',\n                  unit: element.unit\n                };\n              });\n              cur.kpi = cur.resource.kpi.find(function (k) {\n                return k.id == cur.kpi.id;\n              });\n              kpiChange(cur);\n            }\n\n            function errorKpi(err) {\n              console.log(err);\n            }\n          }\n        }\n\n        function error(err) {\n          console.log(err);\n        }\n      }\n\n      function error(err) {\n        console.log(err);\n      }\n    }\n\n    function createNewByMap(dataMap) {\n      var viewContent;\n      serviceCenterService.deviceGroupModels.getAll().then(success, error);\n\n      function success(data) {\n        scope.deviceGroupModels = data;\n\n        if (scope.deviceGroupModels instanceof Array ? scope.deviceGroupModels.length > 0 : false) {\n          scope.deviceGroupModel = scope.deviceGroupModels[0];\n\n          if (dataMap[scope.deviceGroupModel.id]) {\n            viewContent = JSON.parse(dataMap[scope.deviceGroupModel.id]);\n          }\n        }\n\n        serviceCenterService.resources.getAll().then(success, error);\n\n        function success(data) {\n          scope.resources = data.map(function (element) {\n            return new $resource(element);\n          });\n          var preview = viewContent ? viewContent.preview : {\n            list: []\n          };\n          var charts = viewContent ? viewContent.charts : {\n            list: []\n          };\n          scope.preview = new $preview(preview);\n          scope.drawarea = viewContent ? viewContent.drawarea : {\n            list: [],\n            backgroundImage: 'images/tongji/bg.png'\n          };\n          scope.drawarea.list = scope.drawarea.list.map(function (element) {\n            return new $dragElement(element);\n          });\n          scope.charts = new $charts(charts);\n\n          for (var i in scope.preview.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.preview.list[i]);\n          }\n\n          for (var i in scope.drawarea.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.drawarea.list[i]);\n          }\n\n          for (var i in scope.charts.list) {\n            (function (index, elem) {\n              handleResource.call(elem);\n            })(i, scope.charts.list[i]);\n          }\n\n          function handleResource() {\n            var cur = this,\n                resource;\n\n            if (cur.model) {\n              resource = scope.resources.find(function (element) {\n                return cur.model.id == element.modelId;\n              });\n            }\n\n            if (resource) {\n              cur.resource = {\n                id: resource.id,\n                label: resource.label\n              };\n              cur.resourceObj = resource;\n              serviceCenterService.kpis.getBymodelId(resource.modelId).then(successKpi, errorKpi);\n            }\n\n            function successKpi(data) {\n              if (cur.resource) {\n                cur.resource.kpi = data.map(function (element) {\n                  return {\n                    id: element.id,\n                    label: element.label,\n                    icon: element.icon ? element.icon : 'ps-irrigation',\n                    unit: element.unit\n                  };\n                });\n                cur.kpi = cur.resource.kpi.find(function (k) {\n                  return k.id == cur.kpi.id;\n                });\n              }\n\n              kpiChange(cur);\n            }\n\n            function errorKpi(err) {\n              console.log(err);\n            }\n          }\n        }\n\n        function error(err) {\n          console.log(err);\n        }\n      }\n\n      function error(err) {\n        console.log(err);\n      }\n    }\n\n    function createNew() {\n      serviceCenterService.deviceGroupModels.getAll().then(success, error);\n\n      function success(data) {\n        scope.deviceGroupModels = data;\n\n        if (scope.deviceGroupModels instanceof Array ? scope.deviceGroupModels.length > 0 : false) {\n          scope.deviceGroupModel = scope.deviceGroupModels[0];\n        }\n\n        scope.preview = new $preview({\n          list: []\n        });\n        scope.drawarea = {\n          list: [],\n          backgroundImage: 'images/tongji/bg.png'\n        };\n        scope.charts = new $charts({\n          list: []\n        });\n        serviceCenterService.resources.getAll().then(success, error);\n\n        function success(data) {\n          scope.resources = data.map(function (element) {\n            return new $resource(element);\n          });\n        }\n\n        function error(err) {\n          console.log(err);\n        }\n      }\n\n      function error(err) {\n        console.log(err);\n      }\n    }\n  }\n\n  controllers.initController(\"tglibraryCtrl\", tglibraryCtrl);\n  tglibraryCtrl.$inject = ['$scope', '$q', 'serviceCenterService', '$route', '$window', '$location', 'resourceUIService', \"chartOptionService\", \"SwSocket\", '$timeout', \"solutionUIService\", \"userLoginUIService\"];\n\n  function tglibraryCtrl(scope, q, serviceCenterService, route, window, location, resourceUIService, chartOptionService, SwSocket, timeout, solutionUIService, userLoginUIService) {\n    scope.$on('$locationChangeSuccess', function (event) {\n      if (location.path() == \"/servers\") {\n        userLoginUIService.changePos();\n      }\n    });\n    var deviceGroupId,\n        currentDeviceGroup,\n        currentView,\n        blinks = [],\n        showCam = false,\n        uuid;\n    scope.health = {};\n\n    scope.wholeClick = function () {\n      scope.panelShow = false;\n    };\n\n    scope.orderHandlerClick = function () {\n      window.location.href = \"../app-oc/index.html#/workorder\";\n    };\n\n    scope.overviewClick = function () {\n      window.location.href = \"../app-oc/index.html#/dashboard\";\n    };\n\n    scope.equipmentClick = function () {\n      window.location.href = \"../app-oc/index.html#/gateways2\";\n    };\n\n    scope.malfunctionClick = function () {\n      window.location.href = \"../app-oc/index.html#/configAlert/0\";\n    };\n\n    scope.chartClick = function () {\n      window.location.href = \"../app-oc/index.html#/designView\";\n    };\n\n    scope.panelShow = false;\n    scope.$on(\"$destroy\", function () {\n      SwSocket.unregister(uuid);\n    });\n\n    scope.panelClick = function () {\n      scope.panelShow = !scope.panelShow;\n    };\n\n    scope.ipcam = {};\n\n    scope.camClick = function () {\n      if (scope.ipcam.openCam) {\n        scope.ipcam.openCam();\n      }\n\n      showCam = true;\n    };\n\n    scope.closeCam = function () {\n      if (scope.ipcam.closeCam) {\n        scope.ipcam.closeCam();\n      }\n\n      showCam = false;\n    };\n\n    scope.showCam = function () {\n      return showCam;\n    };\n\n    scope.blinkClick = function () {\n      scope.alertOn = !scope.alertOn;\n\n      if (scope.alertOn) {\n        for (var i in blinks) {\n          blinks[i].startBlink();\n        }\n\n        scope.health.startBlink();\n      } else {\n        for (var i in blinks) {\n          blinks[i].stopBlink();\n        }\n\n        scope.health.stopBlink();\n      }\n    };\n\n    scope.drawPos = function (element) {\n      var result = {};\n      result = {\n        top: element.topPortion * 100 + \"%\",\n        left: element.leftPortion * 100 + \"%\",\n        width: element.widthPortion * 100 + \"%\",\n        height: element.heightPortion * 100 + \"%\",\n        transform: 'rotate(0deg)',\n        position: \"absolute\"\n      };\n      return result;\n    };\n\n    scope.calcuRotation = function (element) {\n      var result = {\n        'transform': 'rotate(-' + element.value + 'deg)',\n        '-ms-transform': 'rotate(-' + element.value + 'deg)',\n        '-moz-transform': 'rotate(-' + element.value + 'deg)',\n        '-webkit-transform': 'rotate(-' + element.value + 'deg)',\n        '-o-transform': 'rotate(-' + element.value + 'deg)'\n      };\n      return result;\n    };\n\n    if (route.current) {\n      deviceGroupId = route.current.params.deviceGroupId;\n      init(deviceGroupId);\n    } else {\n      scope.$on(\"locationChanged\", function () {\n        deviceGroupId = route.current.params.deviceGroupId;\n        init(deviceGroupId);\n      });\n    }\n\n    function init(deviceGroupId) {\n      resourceUIService.getResourceById(deviceGroupId, resourceInfoLoaded);\n    }\n\n    function resourceInfoLoaded(event) {\n      if (event.code == 0) {\n        currentDeviceGroup = event.data;\n      }\n\n      serviceCenterService.views.getAll().then(allViewLoaded); //solutionUIService.getServiceViewContent(solutionId, groupId, allViewLoaded);\n    }\n\n    function allViewLoaded(data) {\n      for (var i in data) {\n        if (data[i].viewTitle == 'tongji_deviceGroup') {\n          var dt = JSON.parse(data[i].content);\n\n          if (dt.deviceGroupId == deviceGroupId) {\n            currentView = dt;\n            console.log(currentView);\n          }\n        }\n      }\n\n      scope.charts = currentView.charts;\n      getAllValue();\n    }\n\n    function getAllValue() {\n      var nodes = [],\n          kpis = [],\n          nodesSocket = [],\n          kpisSocket = [],\n          nodesCharts = [],\n          kpisCharts = [];\n\n      for (var i in currentView.drawarea.list) {\n        (function (index, element) {\n          if (element.type == 'switch') {\n            element.onChange = function (value) {\n              console.log(\"change\", value);\n            };\n          }\n\n          if (element.type == 'blink') {\n            blinks.push(element);\n          } else {\n            if (_typeof(element.resource) == 'object' && element.resource != null) {\n              if (nodes.indexOf(element.resource.id) == -1) {\n                nodes.push(element.resource.id);\n              }\n\n              if (element.type == \"bar\" && nodesSocket.indexOf(element.resource.id) == -1) {\n                nodesSocket.push(element.resource.id);\n              }\n\n              if (element.type == \"switch\" && nodesSocket.indexOf(element.resource.id) == -1) {\n                resourceUIService.getResourceById(element.resource.id, function (event) {\n                  if (event.data) {\n                    var modelId = event.data.modelId;\n                    serviceCenterService.directives.getBymodelId(modelId).then(function success(event) {\n                      try {\n                        if (event instanceof Array) {\n                          var comId = event[0].id;\n                          var nodeId = element.resource.id;\n\n                          element.sendDeviceDirective = function (value) {\n                            resourceUIService.sendDeviceDirective(nodeId, comId, {\n                              value: value\n                            }, function (event) {});\n                          };\n                        } else {\n                          throw event.message;\n                        }\n                      } catch (err) {\n                        console.log(err);\n                      }\n                    });\n                  }\n                });\n              }\n\n              if (element.type == \"open\" && nodesSocket.indexOf(element.resource.id) == -1) {\n                resourceUIService.getResourceById(element.resource.id, function (event) {\n                  if (event.data) {\n                    var modelId = event.data.modelId;\n                    serviceCenterService.directives.getBymodelId(modelId).then(function success(event) {\n                      try {\n                        if (event instanceof Array && event[0] != undefined) {\n                          var comId = event[0].id;\n                          var nodeId = element.resource.id;\n\n                          element.sendDeviceDirective = function (value) {\n                            resourceUIService.sendDeviceDirective(nodeId, comId, {\n                              value: value\n                            }, function (event) {});\n                          };\n                        } else {\n                          throw event.message;\n                        }\n                      } catch (err) {\n                        console.log(err);\n                      }\n                    });\n                  }\n                });\n              }\n            }\n\n            if (_typeof(element.kpi) == 'object' && element.kpi != null) {\n              if (kpis.indexOf(element.kpi.id) == -1) {\n                kpis.push(element.kpi.id);\n              }\n\n              if (kpisSocket.indexOf(element.kpi.id) == -1) {\n                kpisSocket.push(element.kpi.id);\n              }\n            }\n          }\n        })(i, currentView.drawarea.list[i]);\n      }\n\n      for (var i in currentView.charts.list) {\n        (function (index, element) {\n          if (_typeof(element.resource) == 'object' && element.resource != null) {\n            if (nodesCharts.indexOf(element.resource.id) == -1) {\n              nodesCharts.push(element.resource);\n            }\n\n            if (nodesSocket.indexOf(element.resource.id) == -1) {\n              console.log(\"sw:node\", element.resource.id);\n              nodesSocket.push(element.resource.id);\n            }\n          }\n\n          if (_typeof(element.kpi) == 'object' && element.kpi != null) {\n            if (nodesCharts.indexOf(element.kpi.id) == -1) {\n              kpisCharts.push(element.kpi);\n            }\n\n            if (kpisSocket.indexOf(element.kpi.id) == -1) {\n              console.log(\"sw:kpi\", element.kpi.id);\n              kpisSocket.push(element.kpi.id);\n            }\n          }\n        })(i, currentView.charts.list[i]);\n      }\n\n      webSocketOpen(nodesSocket, kpisSocket);\n      serviceCenterService.getValues(nodes, kpis).then(allValueLoaded);\n      serviceCenterService.getValuesListAndMergeByTime(nodesCharts, kpisCharts, 7 * 24 * 3600 * 1000, 100 * 1000).then(allValueListLoaded);\n    }\n\n    function webSocketOpen(nodes, kpis) {\n      uuid = Math.uuid();\n      var param = {\n        ciid: nodes.toString(),\n        kpi: kpis.toString()\n      };\n      timeout(function () {\n        repeat();\n      }, 2000);\n\n      function repeat() {\n        for (var i in currentView.charts.list) {\n          var elem = currentView.charts.list[i];\n          var finalValue = elem._option_.series[0].data[elem._option_.series[0].data.length - 1];\n          var finalTime = elem._option_.xAxis.data[elem._option_.xAxis.data.length - 1];\n          finalValue = parseInt(finalValue) + parseInt(parseInt(finalValue * (Math.random() - .5) / 100)); //console.log(finalValue, finalTime);\n\n          currentView.charts.list[i].pushData(finalValue, parseInt(finalTime) + 100);\n          timeout(function () {\n            repeat();\n          }, 25000);\n        }\n      }\n      /*\n      SwSocket.register(uuid, \"register\", function(event){\n      \ttry{\n      \t\tif(event.data)\n      \t\t{\n      \t\t\tvar kpiId = event.data.kpiCode;\n      \t\t\tvar nodeId = event.data.nodeId;\n      \t\t\tvar findDraw = currentView.drawarea.list.find(function(element){\n      \t\t\t\tif(typeof element.resource == 'object' && element.resource != null && typeof element.kpi == 'object' && element.kpi != null)\n      \t\t\t\t{\n      \t\t\t\t\treturn element.resource.id == nodeId && element.kpi.id == kpiId\n      \t\t\t\t}\n      \t\t\t\telse\n      \t\t\t\t{\n      \t\t\t\t\treturn false;\n      \t\t\t\t}\n      \t\t\t});\n      \t\t\tvar findChart = currentView.charts.list.find(function(element){\n      \t\t\t\tif(typeof element.resource == 'object' && element.resource != null && typeof element.kpi == 'object' && element.kpi != null)\n      \t\t\t\t{\n      \t\t\t\t\tconsole.log(\"back:\", element.resource.id, nodeId, element.kpi.id, kpiId);\n      \t\t\t\t\treturn element.resource.id == nodeId && element.kpi.id == kpiId\n      \t\t\t\t}\n      \t\t\t\telse\n      \t\t\t\t{\n      \t\t\t\t\treturn false;\n      \t\t\t\t}\n      \t\t\t});\n      \t\t\tif(findChart)\n      \t\t\t{\n      \t\t\t\tif(typeof findChart.pushData == 'function')\n      \t\t\t\t{\n      \t\t\t\t\tfindChart.pushData(data.value);\n      \t\t\t\t}\n      \t\t\t\telse\n      \t\t\t\t{\n      \t\t\t\t\tconsole.log(findchart);\n      \t\t\t\t}\n      \t\t\t}\n      \t\t\tif(findDraw)\n      \t\t\t{\n      \t\t\t\tfindDraw.value = data.value;\n      \t\t\t}\n      \t\t}\n      \t\telse\n      \t\t{\n      \t\t\tthrow 'event is undefined!!'\n      \t\t}\n      \t}\n      \tcatch(error){\n      \t\tconsole.log(error);\n      \t}\n      });\n      */\n\n\n      SwSocket.send(uuid, \"register\", 'kpi', param);\n    }\n\n    function allValueLoaded(data) {\n      for (var j in currentView.drawarea.list) {\n        (function (index, elem) {\n          pushValue.call(elem);\n        })(j, currentView.drawarea.list[j]);\n      }\n\n      start(currentView);\n\n      function pushValue() {\n        var cur = this;\n        var find = data.find(function (el) {\n          if (_typeof(cur.kpi) == 'object' && cur.kpi != null && _typeof(cur.resource) == 'object' && cur.resource != null) {\n            return el.kpiCode == cur.kpi.id && el.nodeId == cur.resource.id;\n          } else {\n            return false;\n          }\n        });\n\n        if (find) {\n          if (find.value) {\n            cur.value = find.value;\n          } else {\n            cur.value = '-';\n          }\n        } else {\n          cur.value = '-';\n        }\n      }\n    }\n\n    function allValueListLoaded(data) {\n      var colors = [\"#d99a37\", \"#c25262\", \"#39a4d9\", \"#d97c39\", \"#4ccbb4\"];\n\n      for (var i in scope.charts.list) {\n        (function (index, element) {\n          if (_typeof(element.resource) == \"object\" && element.resource != null && _typeof(element.kpi) == \"object\" && element.kpi != null) {\n            var find = data.legend.find(function (elem) {\n              return elem.ci == element.resource.label && elem.kpi == element.kpi.label;\n            });\n            var inx = data.legend.indexOf(find);\n\n            if (data.$attr('series/' + index + \"/data/length\") == 0 || data.$attr('series/' + index + \"/data/length\") == undefined) {\n              setOptions.call(element, {\n                legend: [''],\n                xAxis: function () {\n                  var xAxis = [];\n                  var timeEnd = new Date().getTime();\n\n                  for (var i = 0; i < 14; i++) {\n                    xAxis.push(timeEnd - 3600 * 100);\n                  }\n\n                  xAxis.sort();\n                  return xAxis;\n                }(),\n                series: function () {\n                  var series = [];\n\n                  for (var i = 0; i < 14; i++) {\n                    series.push(parseInt(Math.random() * 100));\n                  }\n\n                  return [{\n                    name: {\n                      ci: '',\n                      kpi: ''\n                    },\n                    data: series\n                  }];\n                }()\n              }, colors[index % 5], true);\n            } else {\n              setOptions.call(element, {\n                legend: [data.legend[index]],\n                xAxis: data.xAxis,\n                series: [data.series[index]]\n              }, colors[index % 5]);\n            }\n          }\n        })(i, scope.charts.list[i]);\n      }\n    }\n\n    function setOptions(data, color, track) {\n      var cur = this;\n\n      if (track) {\n        console.log(\"tracked\", data);\n      }\n\n      var lineChart = new chartOptionService.linechart();\n      lineChart.setTitle({\n        show: false\n      });\n      lineChart.setGrid({\n        top: \"5%\",\n        left: \"5%\",\n        width: \"90%\",\n        height: \"80%\"\n      });\n      lineChart.setTimeformat(\"\");\n      lineChart.setxAxis({\n        data: data.xAxis\n      });\n      data.series[0].$extension({\n        itemStyle: {\n          normal: {\n            color: color\n          }\n        },\n        lineStyle: {\n          normal: {\n            color: color\n          }\n        },\n        areaStyle: {\n          type: 'default',\n          normal: {\n            color: color\n          }\n        }\n      });\n      lineChart.setSeriesByCiKpi(data.series);\n\n      if (typeof cur.setOption == 'function') {\n        cur.setOption(lineChart.returnOption());\n      }\n    }\n\n    function start(data) {\n      scope.drawarea = data.drawarea;\n    }\n  }\n});"],"sourceRoot":"/source/"}