{"version":3,"sources":["app-sc/js/controllers/view-sensor-ctrl.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","controllers","BootstrapDialog","initController","$scope","$routeParams","$timeout","kpiDataService","userLoginUIService","resourceUIService","alertService","SwSocket","Info","viewFlexService","unitService","growl","userDomainService","userEnterpriseService","window","q","$location","console","info","$on","event","path","changePos","uuids","groupModel","resourceTree","modelIds","alertsDic","viewDics","selectView","undefined","displayState","serviceViews","cam","Object","create","showCam","cur","this","openCam","show","hideCam","closeCam","changeDispaly","showGis","mapShow","backMainPage","viewEdit","item","flg","location","href","user","appData","solutionId","id","viewDelete","title","closable","message","label","buttons","cssClass","action","dialogRef","clearDisplay","i","close","splice","unregister","uuid","deleteDeviceGroup","deleteViews","viewId","resultObj","code","success","deleteDevice","returnObj","deactivateDevice","popClose","selectedElement","elePos","top","left","$","width","getBgImg","img","content","bgImgId","bgs","split","length","background-image","elemCLick","elem","addResource","addGateway","viewDetail","find","model","values","news","reports","selectItem","selectViewElems","JSON","elements","kpielement","resource","modelId","resourceDes","kpi","displayParamObj","chartinterval","min","max","directive","j","directives","name","push","times","data","now","Date","avgprice","date","getTime","getDate","price","Math","floor","random","toFixed","initPriceChart","warning","getStateStyle","state","str","handlerRealTimeValue","evendata","node","handlerKpis","arisingTime","nodeId","kpiCode","instance","kpiValue","value","rangeObj","stateStyle","$broadcast","getResourceAlert","reload","nodeArr","nodeIds","toString","states","queryFromCache","nodeAlerts","hasAlert","severity","time","newDateJson","receiveTime","Format","kpis","alerts","getResourceKpiState","nodeKpis","kpiCodes","tmpView","forEach","tmpkpi","el","concat","filter","element","ci","indexOf","newKpi","icon","unit","unitDics","valueName","kpiQueryModel","category","isRealTimeData","timePeriod","handlerFun","p","getKpiValueList","config","recordList","param","ciid","operation","register","send","getRealTimeValue","getResourceByIds","nodesDic","kpisDic","kpiId","resourceKpisHandler","resourceGroup","getResourceKpis","callback","getKpisByModelId","regExp","range","test","parse","e","rangeAry","Array","displayParam","getResourceAlertsConfig","getAlertsByModelId","alertsConfig","getAllResource","ciName","modelsCallback","viewList","viewTitle","viewType","getMyResouces","getDeviceGroupModels","getModels","deviceGroupCallback","resources","view","dt","sort","prev","next","rg","log","clone","stringify","rid","fd","removed","map","result","hasOwnProperty","arr","standardAddress","city","introduce","installationPosition","specialty","deferers","defer","resolve","promise","all","then","getAllKpis","resourcesCallback","resourceAry","getResourceDirectives","level","getDeviceGroups","getResources","getServiceViewMap","getHierarchyValue","instances","kpiDef","minTimespan","getMSvalue","queryInstances","returnItem","granularityUnit","option","tooltip","trigger","grid","x","y","x2","y2","toolbox","feature","mark","dataView","readOnly","magicType","type","restore","saveAsImage","calculable","xAxis","boundaryGap","splitLine","yAxis","scale","axisLabel","formatter","series","markPoint","textStyle","fontSize","symbolSize","Event","ECHARTINFOSINIT","getDirectivesByModelId","directiveHandler","itemDirValues","sendDeviceDirective","Number","init","viewLoadFinished","isAuthenticated","serviceViewTemplate","managedByGroup","serviceViewId","camDisp","get","evt","d"],"mappings":"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","file":"app-sc/js/controllers/view-sensor-ctrl.js","sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\ndefine(['controllers/controllers', 'bootstrap-dialog'], function (controllers, BootstrapDialog) {\n  'use strict';\n\n  controllers.initController('ViewSensorCtrl', ['$scope', '$routeParams', '$timeout', 'kpiDataService', 'userLoginUIService', 'resourceUIService', 'alertService', 'SwSocket', 'Info', 'viewFlexService', 'unitService', 'growl', 'userDomainService', 'userEnterpriseService', '$window', '$q', '$location', function ($scope, $routeParams, $timeout, kpiDataService, userLoginUIService, resourceUIService, alertService, SwSocket, Info, viewFlexService, unitService, growl, userDomainService, userEnterpriseService, window, q, $location) {\n    console.info(\"切换到传感器管理\");\n    $scope.$on('$locationChangeSuccess', function (event) {\n      if ($location.path() == \"/servers\") {\n        userLoginUIService.changePos();\n      }\n    });\n    var uuids = {},\n        mode = 'device';\n    $scope.groupModel = false;\n    $scope.resourceTree = [];\n    $scope.modelIds;\n    $scope.alertsDic = {};\n    $scope.viewDics = {};\n    $scope.selectView = undefined;\n    $scope.displayState = false;\n    $scope.serviceViews = {};\n    $scope.cam = Object.create({\n      showCam: function showCam() {\n        var cur = this;\n\n        if (cur.openCam) {\n          cur.openCam();\n        }\n\n        cur.show = true;\n      },\n      hideCam: function hideCam() {\n        var cur = this;\n\n        if (cur.closeCam) {\n          cur.closeCam();\n        }\n\n        cur.show = false;\n      }\n    });\n\n    $scope.changeDispaly = function () {\n      $scope.displayState = !$scope.displayState;\n    };\n\n    $scope.showGis = function () {\n      $scope.mapShow = !$scope.mapShow;\n    };\n\n    $scope.backMainPage = function () {\n      $scope.selectView = undefined;\n    };\n\n    $scope.viewEdit = function (item, flg) {\n      if ($scope.groupModel) {\n        location.href = \"../app-topo/index.html#topology/deviceGroup/\" + flg + \"/\" + userLoginUIService.user.appData.solutionId + \"/\" + item.id;\n      } else {\n        location.href = \"../app-topo/index.html#topology/device/\" + flg + \"/\" + userLoginUIService.user.appData.solutionId + \"/\" + item.id;\n      }\n    };\n\n    $scope.viewDelete = function (item) {\n      BootstrapDialog.show({\n        title: '提示',\n        closable: false,\n        //size:BootstrapDialog.SIZE_WIDE,\n        message: '确认删除 ' + item.label + ' 吗？',\n        buttons: [{\n          label: '确定',\n          cssClass: 'btn-success',\n          action: function action(dialogRef) {\n            if ($scope.groupModel) {\n              var clearDisplay = function clearDisplay() {\n                dialogRef.close();\n                delete $scope.viewDics[item.label];\n\n                for (var i in $scope.resourceTree) {\n                  if ($scope.resourceTree[i].id == item.id) {\n                    $scope.resourceTree.splice(i, 1);\n                    SwSocket.unregister(item.uuid);\n                    delete uuids[item.uuid];\n                  }\n                }\n              };\n\n              resourceUIService.deleteDeviceGroup(item.id, function (event) {\n                if ($scope.viewDics[item.label]) {\n                  viewFlexService.deleteViews([$scope.viewDics[item.label].viewId], function (resultObj) {\n                    if (resultObj.code == 0) {\n                      clearDisplay();\n                      growl.success(\"关联视图清空\", {});\n                    }\n                  });\n                } else {\n                  clearDisplay();\n                }\n              });\n              /*\n              var deleteView = function() {\n                if ($scope.viewDics[item.label]) {\n                  viewFlexService.deleteViews([$scope.viewDics[item.label].viewId], function(resultObj) {\n                    if (resultObj.code == 0) {\n                      clearDisplay();\n                      growl.success(\"关联视图清空\", {});\n                    }\n                  });\n                } else {\n                  clearDisplay();\n                }\n              }\n              var deleteDevice = function() {\n                resourceUIService.unregisterDevice(item.gatewayId, item.id, function(returnObj) {\n                  if (returnObj.code == 0) {\n                    deleteView();\n                    growl.success(\"关联对象已删除\", {});\n                  }\n                });\n              }\n              resourceUIService.deactivateDevice(item.id, function(returnObj) {\n                if (returnObj.code == 0) {\n                  deleteDevice();\n                  growl.success(\"关联对象已停用\", {});\n                }\n              });\n              */\n            } else {\n              var clearDisplay = function clearDisplay() {\n                dialogRef.close();\n                delete $scope.viewDics[item.label];\n\n                for (var i in $scope.resourceTree) {\n                  if ($scope.resourceTree[i].label == item.label) {\n                    $scope.resourceTree.splice(i, 1);\n                    SwSocket.unregister(item.uuid);\n                    delete uuids[item.uuid];\n                  }\n                }\n              };\n\n              var deleteView = function deleteView() {\n                if ($scope.viewDics[item.label]) {\n                  viewFlexService.deleteViews([$scope.viewDics[item.label].viewId], function (resultObj) {\n                    if (resultObj.code == 0) {\n                      clearDisplay();\n                      growl.success(\"关联视图清空\", {});\n                    }\n                  });\n                } else {\n                  clearDisplay();\n                }\n              };\n\n              var deleteDevice = function deleteDevice() {\n                resourceUIService.deleteDevice(item.id, function (returnObj) {\n                  if (returnObj.code == 0) {\n                    deleteView();\n                    growl.success(\"关联对象已删除\", {});\n                  }\n                });\n              };\n\n              resourceUIService.deactivateDevice(item.id, function (returnObj) {\n                if (returnObj.code == 0) {\n                  deleteDevice();\n                  growl.success(\"关联对象已停用\", {});\n                }\n              });\n            }\n          }\n        }, {\n          label: '取消',\n          action: function action(dialogRef) {\n            dialogRef.close();\n          }\n        }]\n      });\n    };\n\n    $scope.popClose = function () {\n      $scope.selectedElement = undefined;\n    };\n\n    $scope.elePos = function (top, left) {\n      if ($(window).width() <= 1365) {\n        top = 720 * (top / 960);\n        left = 405 * (left / 540);\n      } else if ($(window).width() <= 1599) {\n        top = 840 * (top / 960);\n        left = 472 * (left / 540);\n      } else if ($(window).width() <= 1919) {\n        top = 1054 * (top / 960);\n        left = 596 * (left / 540);\n      } else {\n        top = 1280 * (top / 960);\n        left = 720 * (left / 540);\n      }\n\n      return {\n        top: top + \"px\",\n        left: left + \"px\"\n      };\n    };\n\n    $scope.getBgImg = function () {\n      var path = \"../images/topo/\";\n      var img = \"topo_bg.png\";\n      $scope.selectView.content.bgImgId; //      if ($scope.selectView.content.path) {\n      //        img = $scope.selectView.content.path\n      //      }\n\n      if ($scope.selectView.content.bgImgId) {\n        var bgs = $scope.selectView.content.bgImgId.split(\"/\");\n        img = bgs[bgs.length - 1];\n      }\n\n      return {\n        \"background-image\": 'url(' + path + img + ')'\n      };\n    };\n\n    $scope.elemCLick = function (elem) {\n      $scope.selectedElement = elem;\n    };\n\n    $scope.addResource = function () {\n      location.href = \"../app-topo/index.html#/topology/deviceGroup/0/\" + userLoginUIService.user.appData.solutionId;\n    };\n\n    $scope.addGateway = function () {\n      location.href = \"#gateway\";\n    };\n\n    $scope.viewDetail = function (item) {\n      var find;\n\n      if ($scope.groupModel) {\n        find = $scope.viewDics[item.id];\n      } else {\n        find = $scope.viewDics[item.label];\n      }\n\n      if (find && find.viewId && find.viewId > 0) {\n        var model = item.values[\"model\"] ? item.values[\"model\"] : \"草莓\";\n        $scope.news = $scope.info[model];\n        $scope.reports = $scope.info[model + \"_记录\"];\n        $scope.selectView = find;\n        $scope.selectItem = item;\n        $scope.selectViewElems = [];\n\n        if ($scope.groupModel) {\n          for (var i in $scope.selectView.JSON.elements) {\n            var kpielement = $scope.selectView.JSON.elements[i];\n            kpielement.id = $scope.selectView.JSON.elements[i].resource.id;\n            kpielement.modelId = kpielement.resourceDes.modelId;\n\n            if ($scope.selectView.JSON.elements[i].kpi.displayParamObj) {\n              kpielement.chartinterval = $scope.selectView.JSON.elements[i].kpi.displayParamObj[\"chartInterval\"];\n            }\n\n            kpielement.min = $scope.selectView.JSON.elements[i].kpi[\"min\"];\n            kpielement.max = $scope.selectView.JSON.elements[i].kpi[\"max\"];\n\n            if (!kpielement.directive && kpielement.kpi) {\n              for (var j in $scope.modelIds[$scope.selectItem.modelId].directives) {\n                if (kpielement.kpi.name == $scope.modelIds[$scope.selectItem.modelId].directives[j].label) {\n                  kpielement.directive = $scope.modelIds[$scope.selectItem.modelId].directives[j];\n                  break;\n                }\n              }\n            }\n\n            $scope.selectViewElems.push(kpielement);\n          }\n        } else {\n          for (var i in $scope.selectView.content.elements) {\n            var kpielement = $scope.selectView.content.elements[i];\n            kpielement.modelId = item.modelId;\n\n            if ($scope.selectView.content.elements[i].kpi.displayParamObj) {\n              kpielement.chartinterval = $scope.selectView.content.elements[i].kpi.displayParamObj[\"chartInterval\"];\n            }\n\n            if ($scope.selectView.JSON) {\n              kpielement.min = $scope.selectView.JSON.elements[i].kpi[\"min\"];\n              kpielement.max = $scope.selectView.JSON.elements[i].kpi[\"max\"];\n            } else {\n              kpielement.min = $scope.selectView.content.elements[i].kpi[\"min\"];\n              kpielement.max = $scope.selectView.content.elements[i].kpi[\"max\"];\n            }\n\n            if (!kpielement.directive && kpielement.kpi) {\n              for (var j in $scope.modelIds[$scope.selectItem.modelId].directives) {\n                if (kpielement.kpi.name == $scope.modelIds[$scope.selectItem.modelId].directives[j].label) {\n                  kpielement.directive = $scope.modelIds[$scope.selectItem.modelId].directives[j];\n                  break;\n                }\n              }\n            }\n\n            $scope.selectViewElems.push(kpielement);\n          }\n        }\n\n        var returnObj = {\n          times: [],\n          data: []\n        };\n        var now = new Date();\n        var avgprice = 0;\n\n        for (var i = 6; i > -1; i--) {\n          var date = new Date(now.getTime() - i * 24 * 3600 * 1000);\n          returnObj.times.push(date.getDate() + \"日\");\n          var price = Math.floor(10 + Math.random() * 10);\n          returnObj.data.push(price);\n          avgprice += price;\n        }\n\n        $scope.selectItem.avgprice = (avgprice / 7).toFixed(2);\n        initPriceChart(returnObj);\n      } else {\n        growl.warning(\"当前没有详细内容可以查看,请点击编辑进行编辑\", {});\n      }\n    };\n\n    var getStateStyle = function getStateStyle(state) {\n      var str;\n\n      switch (state) {\n        case -1:\n          str = \"btn-ps-unknow\";\n          break;\n\n        case 0:\n          str = \"btn-ps-normal\";\n          break;\n\n        default:\n          str = \"btn-ps-critical\";\n      }\n\n      return str;\n    };\n\n    var handlerRealTimeValue = function handlerRealTimeValue(evendata) {\n      var node = uuids[evendata.uuid][0];\n      var handlerKpis = uuids[evendata.uuid][1];\n      var arisingTime = evendata.data.arisingTime;\n\n      for (var i in handlerKpis) {\n        if (evendata.data.nodeId == handlerKpis[i].id && evendata.data.kpiCode == handlerKpis[i].kpiCode) {\n          if (evendata.data.instance && evendata.data.instance != handlerKpis[i].instance) {\n            continue;\n          }\n\n          handlerKpis[i].kpiValue = evendata.data.value;\n          handlerKpis[i].value = handlerKpis[i].kpi && handlerKpis[i].kpi.rangeObj != null ? handlerKpis[i].kpi.rangeObj[handlerKpis[i].kpiValue] : handlerKpis[i].kpiValue;\n          handlerKpis[i].state = 0;\n          handlerKpis[i].stateStyle = getStateStyle(handlerKpis[i].state);\n        }\n      }\n\n      $scope.$broadcast(\"kpiSlickValue\", {\n        id: node.id,\n        value: handlerKpis\n      });\n      getResourceAlert(node, handlerKpis, true);\n    };\n\n    var getRealTimeValue = function getRealTimeValue(node, config, handlerKpis) {\n      var param = {\n        ciid: config.nodeIds.toString(),\n        kpi: config.kpiCodes.toString()\n      };\n      var uuid = Math.uuid();\n      node.uuid = uuid;\n      uuids[uuid] = [node, handlerKpis];\n      var operation = \"register\"; //考虑极端情况，一个页面有多个模块监听同一个方法  \n      //但展示在页面的数据需对接收的实时监听的数据做不同处理 \n\n      SwSocket.register(uuid, operation, handlerRealTimeValue); //websocket发送请求\n\n      SwSocket.send(uuid, operation, 'kpi', param);\n    };\n\n    var getResourceAlert = function getResourceAlert(node, handlerKpis, reload) {\n      var nodeArr = [];\n\n      if ($scope.groupModel) {\n        for (var i in node.JSON.elements) {\n          (function (elem) {\n            nodeArr.push(elem.resource.id);\n          })(node.JSON.elements[i]);\n        }\n\n        var info = {\n          nodeIds: nodeArr.toString(),\n          states: '0,5,10'\n        };\n      } else {\n        var info = {\n          nodeIds: node.id,\n          states: '0,5,10'\n        };\n      }\n\n      alertService.queryFromCache(info, function (returnObj) {\n        if (returnObj.code == 0) {\n          var nodeAlerts = [];\n\n          for (var i in returnObj.data) {\n            var hasAlert = false;\n\n            for (var j in handlerKpis) {\n              if (returnObj.data[i].nodeId == handlerKpis[j].id && returnObj.data[i].kpiCode == handlerKpis[j].kpiCode) {\n                if (returnObj.data[i].instance && returnObj.data[i].instance != handlerKpis[j].instance) {\n                  continue;\n                }\n\n                handlerKpis[j].state = returnObj.data[i].severity;\n                handlerKpis[j].stateStyle = getStateStyle(handlerKpis[j].state);\n                hasAlert = true;\n              }\n            }\n\n            if (hasAlert) {\n              returnObj.data[i].time = newDateJson(returnObj.data[i].receiveTime).Format(\"yyyy-MM-dd hh:mm:ss\");\n              var stateStyle = \"\";\n\n              switch (returnObj.data[i].severity) {\n                case 4:\n                  stateStyle = \"text-red\";\n                  break;\n\n                case 3:\n                  stateStyle = \"text-orange\";\n\n                case 2:\n                  stateStyle = \"text-orange\";\n                  break;\n\n                default:\n                  stateStyle = \"text-yellow\";\n              }\n\n              returnObj.data[i].stateStyle = stateStyle;\n              nodeAlerts.push(returnObj.data[i]);\n            }\n          }\n\n          if (nodeAlerts.length > 0) node.stateStyle = \"box-danger\";else node.stateStyle = \"box-success\";\n          $scope.alertsDic[info.nodeIds] = nodeAlerts;\n\n          if ($scope.groupModel) {\n            node.kpis = handlerKpis;\n            node.alerts = nodeAlerts;\n          } else {\n            node.kpis = handlerKpis;\n            node.alerts = nodeAlerts;\n          }\n\n          ;\n\n          if (reload) {\n            $scope.$broadcast(\"kpiSlickValue\", {\n              id: node.id,\n              value: handlerKpis\n            });\n          }\n        }\n      });\n    };\n\n    var getResourceKpiState = function getResourceKpiState(node, nodeKpis) {\n      //if (!$scope.viewDics[node.label]) return;\n      var nodeIds,\n          kpiCodes = [],\n          nodeArr = [];\n      var elements;\n\n      if ($scope.groupModel) {\n        elements = $scope.viewDics[node.id].content.elements;\n      } else {\n        if ($scope.viewDics[node.label]) {\n          elements = $scope.viewDics[node.label].content.elements;\n        } else {\n          var tmpView = {\n            content: {\n              elements: [],\n              nodeId: node.id\n            }\n          };\n          nodeKpis.forEach(function (kpi) {\n            var tmpkpi = {\n              kpi: {\n                id: kpi.id,\n                label: kpi.label,\n                nodeId: node.id\n              },\n              resource: {\n                id: node.id,\n                label: node.label\n              }\n            };\n            tmpView.content.elements.push(tmpkpi);\n          });\n          $scope.viewDics[node.label] = tmpView;\n          elements = tmpView.content.elements;\n        }\n      }\n\n      if ($scope.groupModel) {\n        nodeKpis = [];\n\n        for (var j in elements) {\n          var el = elements[j];\n          nodeKpis = nodeKpis.concat($scope.modelIds[el.resourceDes.modelId].kpis);\n        }\n      }\n\n      var clone = [];\n      /*-------------------remove those whose kpi is not avaliable------------------*/\n\n      elements = elements.filter(function (elem) {\n        var find = nodeKpis.find(function (element) {\n          if (elem.kpi) {\n            return element.id == elem.kpi.id;\n          } else {\n            return false;\n          }\n        });\n\n        if (find) {\n          return true;\n        } else {\n          return false;\n        }\n      });\n      /* -------------------------------------------------------------------------- */\n\n      for (var i in elements) {\n        var ci = elements[i].resource.id;\n        nodeArr.push(ci);\n\n        if (nodeArr.indexOf(ci) == -1) {\n          nodeArr.push(ci);\n        }\n\n        var newKpi = elements[i];\n\n        if (newKpi.instance) {\n          newKpi.title = newKpi.instance;\n          delete newKpi.instance;\n        }\n\n        for (var j in nodeKpis) {\n          if (newKpi.kpi.id && nodeKpis[j].id == newKpi.kpi.id || newKpi.kpi && nodeKpis[j].id == newKpi.kpi.id) {\n            newKpi.kpiCode = nodeKpis[j].id;\n            kpiCodes.push(nodeKpis[j].id);\n            newKpi.label = newKpi.title ? newKpi.title : nodeKpis[j].label;\n            newKpi.icon = nodeKpis[j].icon;\n            newKpi.unit = unitService.unitDics != null && unitService.unitDics[nodeKpis[j].unit] != 'Amount' ? unitService.unitDics[nodeKpis[j].unit] : '';\n            newKpi.state = -1;\n            newKpi.stateStyle = getStateStyle(newKpi.state);\n\n            if ($scope.groupModel) {\n              newKpi.id = ci;\n              if (newKpi.instance) newKpi.valueName = ci + \"?\" + nodeKpis[j].id;else newKpi.valueName = ci + \"?\" + nodeKpis[j].id;\n            } else {\n              newKpi.id = node.id;\n              if (newKpi.instance) newKpi.valueName = node.id + \"?\" + nodeKpis[j].id;else newKpi.valueName = node.id + \"?\" + nodeKpis[j].id;\n            }\n\n            ;\n            newKpi.kpiValue = 0;\n            newKpi.kpi.name = nodeKpis[j].name;\n\n            if (nodeKpis[j].rangeObj) {\n              newKpi.kpi.rangeObj = nodeKpis[j].rangeObj;\n              newKpi.value = nodeKpis[j].rangeObj[newKpi.kpiValue];\n            }\n\n            if (nodeKpis[j].displayParamObj) {\n              newKpi.kpi.displayParamObj = nodeKpis[j].displayParamObj;\n            }\n\n            newKpi.kpi.min = nodeKpis[j].min;\n            newKpi.kpi.max = nodeKpis[j].max;\n          }\n        }\n      }\n\n      if ($scope.groupModel) {\n        nodeIds = nodeArr;\n      } else {\n        nodeIds = [node.id];\n      }\n\n      ;\n      var kpiQueryModel = {\n        category: \"time\",\n        isRealTimeData: true,\n        timePeriod: 0,\n        nodeIds: nodeIds,\n        kpiCodes: kpiCodes\n      };\n\n      var handlerFun = function handlerFun(p) {\n        kpiDataService.getKpiValueList(p, function (returnObj) {\n          if (returnObj.code == 0) {\n            var config = p[1];\n\n            for (var i in elements) {\n              var newKpi = elements[i];\n              newKpi.kpiValue = \"NA\";\n              newKpi.value = \"NA\";\n\n              for (var j in returnObj.data.recordList) {\n                if (returnObj.data.recordList[j][newKpi.valueName] == null) {}\n\n                if (returnObj.data.recordList[j][newKpi.valueName] != null) {\n                  newKpi.kpiValue = returnObj.data.recordList[j][newKpi.valueName];\n                  newKpi.value = newKpi.kpi && newKpi.kpi.rangeObj != null ? newKpi.kpi.rangeObj[newKpi.kpiValue] : newKpi.kpiValue;\n                  newKpi.state = 0;\n                  newKpi.stateStyle = getStateStyle(newKpi.state);\n                }\n              }\n            }\n\n            getRealTimeValue(node, config, elements);\n            getResourceAlert(node, elements, false);\n          }\n        });\n      };\n\n      resourceUIService.getResourceByIds(nodeIds, function (returnObj) {\n        var model, kpis;\n        kpiQueryModel.nodesDic = returnObj;\n        kpiQueryModel.kpisDic = {};\n\n        for (var i in returnObj) {\n          model = $scope.modelIds[returnObj[i].modelId];\n          kpis = model.kpis;\n\n          for (var j in kpiCodes) {\n            var kpiId = kpiCodes[j];\n            var find = kpis.find(function (el) {\n              return el.id == kpiId;\n            });\n\n            if (find) {\n              kpiQueryModel.kpisDic[find.id] = find;\n            }\n          }\n\n          handlerFun([\"kpi\", kpiQueryModel]);\n        }\n      });\n      /* June 4th 2016, removed By Leon, coz method getKpisBykpiIds is not avaliable anymore!\n      resourceUIService.getKpisByKpiIds(kpiCodes, function(returnObj) {\n        kpiQueryModel.kpisDic = returnObj;\n        if (kpiQueryModel.nodesDic) {\n          handlerFun([\"kpi\", kpiQueryModel]);\n        }\n      });\n      */\n    };\n\n    var getAllKpis = function getAllKpis(callback) {\n      var deferers = [];\n\n      for (var i in $scope.modelIds) {\n        var defer = q.defer();\n\n        (function (model, defer) {\n          getResourceKpis(model, function (returnObj) {\n            defer.resolve(\"success\");\n          });\n          getResourceAlertsConfig(model);\n        })($scope.modelIds[i], defer);\n\n        deferers.push(defer.promise);\n      }\n\n      q.all(deferers).then(function success() {\n        callback();\n      });\n    };\n\n    var resourceKpisHandler = function resourceKpisHandler(model) {\n      if ($scope.groupModel) {\n        for (var i in $scope.resourceTree) {\n          (function (resourceGroup) {\n            if (resourceGroup.modelId == model.id) {\n              getResourceKpiState(resourceGroup, model.kpis);\n            }\n            /*\n            for(var i in resourceGroup.JSON.elements){\n               (function(elem){\n                if (elem.resourceDes.modelId == model.id) {\n                  getResourceKpiState(elem.resourceDes, model.kpis, resourceGroup);\n                }\n              })(resourceGroup.JSON.elements[i])\n            }\n             */\n\n          })($scope.resourceTree[i]);\n        }\n      } else {\n        for (var i in $scope.resourceTree) {\n          if ($scope.resourceTree[i].modelId == model.id) {\n            getResourceKpiState($scope.resourceTree[i], model.kpis);\n          }\n        }\n      }\n    };\n\n    var getResourceKpis = function getResourceKpis(model, callback) {\n      resourceUIService.getKpisByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.kpis = returnObj.data;\n          var regExp = /\\{|\\[.*\\}|\\]/;\n\n          for (var i in model.kpis) {\n            if (model.kpis[i].range) {\n              var find = regExp.test(model.kpis[i].range);\n              var rangeObj = [];\n\n              if (find) {\n                try {\n                  rangeObj = find ? JSON.parse(model.kpis[i].range) : [];\n                } catch (e) {}\n              }\n\n              model.kpis[i].rangeAry = rangeObj;\n\n              if (rangeObj instanceof Array) {\n                model.kpis[i].rangeAry = rangeObj;\n\n                if (rangeObj.length == 2) {\n                  model.kpis[i].min = rangeObj[0];\n                  model.kpis[i].max = rangeObj[1];\n                }\n              } else if (rangeObj instanceof Object) {\n                model.kpis[i].rangeObj = rangeObj;\n              }\n            }\n\n            if (model.kpis[i].displayParam) {\n              var find = regExp.test(model.kpis[i].displayParam);\n              var displayParamObj = {};\n\n              if (find) {\n                displayParamObj = JSON.parse(model.kpis[i].displayParam);\n              }\n\n              model.kpis[i].displayParamObj = displayParamObj;\n            }\n\n            resourceUIService.kpisDic[model.id + \"??\" + model.kpis[i].id] = model.kpis[i];\n            resourceUIService.kpisDic[model.kpis[i].id] = model.kpis[i];\n          }\n\n          if (callback) {\n            callback(model);\n          }\n        }\n\n        ;\n      });\n    };\n\n    var getResourceAlertsConfig = function getResourceAlertsConfig(model) {\n      resourceUIService.getAlertsByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.alertsConfig = returnObj.data;\n        }\n\n        ;\n      });\n    };\n    /**\n     * 获得该用户所有的模型资源\n     * @param {Object} ciName\n     */\n\n\n    var getAllResource = function getAllResource(ciName) {\n      $scope.modelIds = {};\n\n      if ($scope.groupModel) {\n        resourceUIService.getDeviceGroupModels(function (returnObj) {\n          for (var i in returnObj.data) {\n            $scope.modelIds[returnObj.data[i].id] = {\n              id: returnObj.data[i].id,\n              viewId: returnObj.data[i].viewId,\n              model: returnObj.data[i],\n              directives: null\n            };\n          }\n\n          resourceUIService.getModels(modelsCallback);\n        });\n      } else {\n        resourceUIService.getModels(modelsCallback);\n      }\n\n      function modelsCallback(returnObj) {\n        if (returnObj.code == 0) {\n          for (var i in returnObj.data) {\n            for (var j in viewFlexService.viewList) {\n              if (returnObj.data[i].category != 'Sensor') {\n                if (returnObj.data[i].label == viewFlexService.viewList[j].viewTitle) {\n                  if (viewFlexService.viewList[j].viewType == 'designView') {\n                    returnObj.data[i].viewId = viewFlexService.viewList[j].viewId;\n                  }\n\n                  break;\n                }\n              }\n            }\n\n            $scope.modelIds[returnObj.data[i].id] = {\n              id: returnObj.data[i].id,\n              viewId: returnObj.data[i].viewId,\n              model: returnObj.data[i],\n              directives: null\n            };\n          }\n        }\n\n        getMyResouces();\n      }\n      /**\n       * 获得该用户的设备资源\n       */\n\n\n      var resourceGroup = [];\n\n      var getMyResouces = function getMyResouces() {\n        if ($scope.groupModel) {\n          resourceUIService.getDeviceGroups(function (returnObj) {\n            if (returnObj.code == 0) {\n              resourceGroup = returnObj.data;\n            }\n\n            resourceUIService.getResources(deviceGroupCallback);\n          });\n        } else {\n          viewFlexService.getServiceViewMap(function (returnObj) {\n            if (returnObj.code == 0) {\n              $scope.serviceViews = returnObj.data ? returnObj.data : {};\n            }\n\n            resourceUIService.getResources(resourcesCallback);\n          });\n        }\n\n        function deviceGroupCallback(returnObj) {\n          var resources;\n\n          if (returnObj.code == 0) {\n            resources = returnObj.data;\n\n            for (var i in viewFlexService.viewList) {\n              (function (view) {\n                var regExp = /\\{.*}/;\n                var pass = regExp.test(view.content);\n                var dt = pass ? JSON.parse(view.content) : undefined;\n\n                if (dt) {\n                  if (dt.elements instanceof Array) {\n                    dt.elements = dt.elements.sort(function (prev, next) {\n                      if (prev.kpi && next.kpi) {\n                        if (prev.kpi.id > next.kpi.id) {\n                          return 1;\n                        } else {\n                          return -1;\n                        }\n                      } else {\n                        return 1;\n                      }\n                    });\n                  }\n\n                  view.JSON = dt;\n                }\n              })(viewFlexService.viewList[i]);\n            }\n\n            for (var i in resourceGroup) {\n              (function (rg) {\n                var find = viewFlexService.viewList.find(function (view) {\n                  if (view.JSON) {\n                    return view.JSON.nodeId == rg.id;\n                  } else {\n                    return false;\n                  }\n                });\n                console.log(find);\n\n                if (find) {\n                  $scope.viewDics[rg.id] = find; //$scope.viewDics[rg.id].content = find.JSON;\n\n                  rg.JSON = find.JSON;\n                  var clone = JSON.parse(JSON.stringify(rg.JSON.elements));\n\n                  for (var j in clone) {\n                    var rid = clone[j].resource.id;\n                    var fd = resources.find(function (elem) {\n                      if (elem.id == rid) {\n                        //$scope.viewDics[returnObj.elem.label] = view;\n                        $scope.viewDics[elem.label] = {};\n                        $scope.viewDics[elem.label].content = rg.JSON;\n                      } //console.log(elem.id, rid, rg.JSON.elements[j].resource.label, rg.JSON.elements[j]);\n\n\n                      return elem.id == rid;\n                    });\n\n                    if (fd) {\n                      clone[j].resourceDes = fd;\n                    } else {\n                      clone[j].removed = true;\n                    }\n                  }\n\n                  console.log(clone);\n                  rg.JSON.elements = clone.filter(function (elem) {\n                    return elem.removed != true;\n                  });\n                  $scope.viewDics[rg.id].content = rg.JSON;\n                }\n              })(resourceGroup[i]);\n            }\n\n            console.log(resourceGroup);\n            $scope.resourceTree = resourceGroup.map(function (element) {\n              var result = JSON.parse(JSON.stringify(element));\n              result.kpis = [];\n              result.alerts = [];\n              result.viewId = null;\n\n              if (result.values.hasOwnProperty(\"standardAddress\")) {\n                var arr = result.values.standardAddress.split(\",\");\n\n                if (arr.length == 1) {\n                  if (arr[0]) {\n                    result.city = arr[0];\n                  } else {\n                    result.city = '北京';\n                  }\n                } else {\n                  if (arr[0].indexOf(\"市\") > -1) result.city = arr[0];else result.city = arr[1];\n                }\n              } else {\n                result.city = '北京';\n              }\n\n              if (result.values.hasOwnProperty(\"introduce\")) {\n                result.introduce = result.values.introduce;\n              }\n\n              if (result.values.hasOwnProperty(\"installationPosition\")) {\n                result.installationPosition = result.values.installationPosition;\n              }\n\n              if (result.values.hasOwnProperty(\"specialty\")) {\n                result.specialty = result.values.specialty;\n              }\n\n              result.stateStyle = \"box-default\";\n              return result;\n            });\n            getAllKpis(function () {\n              for (var i in $scope.modelIds) {\n                resourceKpisHandler($scope.modelIds[i]);\n              }\n            });\n          }\n        }\n\n        function resourcesCallback(returnObj) {\n          if (returnObj.code == 0) {\n            var resourceAry = [];\n\n            for (var i in returnObj.data) {\n              if (returnObj.data[i].category == 'Sensor') continue;\n              if (!$scope.modelIds[returnObj.data[i].modelId]) continue;\n              if (returnObj.data[i].label == null || returnObj.data[i].label.indexOf('农业大棚模拟') > -1) continue;\n\n              if ($scope.modelIds[returnObj.data[i].modelId].directives == null) {\n                getResourceDirectives($scope.modelIds[returnObj.data[i].modelId]);\n              }\n\n              returnObj.data[i].kpis = [];\n              returnObj.data[i].alerts = [];\n              returnObj.data[i].viewId = $scope.modelIds[returnObj.data[i].modelId].viewId;\n\n              if (returnObj.data[i].values.hasOwnProperty(\"standardAddress\")) {\n                var arr = returnObj.data[i].values.standardAddress.split(\",\");\n\n                if (arr.length == 1) {\n                  if (arr[0]) {\n                    returnObj.data[i].city = arr[0];\n                  } else {\n                    returnObj.data[i].city = '北京';\n                  }\n                } else {\n                  if (arr[0].indexOf(\"市\") > -1) returnObj.data[i].city = arr[0];else returnObj.data[i].city = arr[1];\n                }\n              } else {\n                returnObj.data[i].city = '北京';\n              }\n\n              if (returnObj.data[i].values.hasOwnProperty(\"introduce\")) {\n                returnObj.data[i].introduce = returnObj.data[i].values.introduce;\n              }\n\n              if (returnObj.data[i].values.hasOwnProperty(\"installationPosition\")) {\n                returnObj.data[i].installationPosition = returnObj.data[i].values.installationPosition;\n              }\n\n              if (returnObj.data[i].values.hasOwnProperty(\"specialty\")) {\n                returnObj.data[i].specialty = returnObj.data[i].values.specialty;\n              }\n\n              returnObj.data[i].stateStyle = \"box-default\";\n              $scope.viewDics[returnObj.data[i].label] = $scope.serviceViews[returnObj.data[i].modelId];\n\n              for (var j in viewFlexService.viewList) {\n                (function (index, view) {\n                  var dt,\n                      content = view.content;\n\n                  if (typeof content == 'string') {\n                    dt = JSON.parse(content);\n                  } else if (_typeof(content) == 'object') {\n                    dt = content;\n                  }\n\n                  if (dt ? dt.nodeId == returnObj.data[i].id : false) {\n                    $scope.viewDics[returnObj.data[i].label] = view;\n                    $scope.viewDics[returnObj.data[i].label].content = dt;\n                    returnObj.data[i].title = dt.label;\n                  }\n                })(j, viewFlexService.viewList[j]);\n              }\n\n              resourceAry.push(returnObj.data[i]);\n            }\n\n            $scope.resourceTree = resourceAry;\n\n            if ($routeParams.level) {\n              for (var i in $scope.resourceTree) {\n                if ($scope.resourceTree[i].id == $routeParams.nodeId) {\n                  $scope.viewDetail($scope.resourceTree[i]);\n                }\n              }\n            }\n\n            for (var modelId in $scope.modelIds) {\n              //获得该模型的KPI定义\n              getResourceKpis($scope.modelIds[modelId], resourceKpisHandler); //获得该模型的告警定义\n\n              getResourceAlertsConfig($scope.modelIds[modelId]);\n            }\n          }\n        }\n\n        ;\n      };\n    };\n\n    $scope.getHierarchyValue = function (nodeIds, kpiCodes, instances, callback) {\n      var kpiDef = resourceUIService.kpisDic[kpiCodes[0]];\n      var timePeriod = resourceUIService.getMSvalue(0, kpiDef);\n      var kpiQueryModel = {\n        category: \"time\",\n        isRealTimeData: true,\n        timePeriod: 1000 * 60 * 60 * 12,\n        nodeIds: nodeIds,\n        kpiCodes: kpiCodes,\n        kpisDic: {\n          minTimespan: timePeriod\n        }\n      };\n      /*\n      var kpiQueryModel = {\n        category: \"time\",\n        isRealTimeData: true,\n        timePeriod: timePeriod * 10,\n        nodeIds: nodeIds,\n        kpiCodes: kpiCodes,\n        queryInstances: instances.toString()\n      };\n      */\n\n      var handlerFun = function handlerFun(p) {\n        kpiDataService.getKpiValueList(p, function (returnObj) {\n          if (returnObj.code == 0) {\n            var config = p[1];\n            var valueName = config.nodeIds[0] + \"?\" + config.kpiCodes[0];\n\n            if (config.queryInstances) {\n              valueName += \"?\" + config.queryInstances;\n            }\n\n            var returnItem = {\n              data: [],\n              times: []\n            };\n\n            for (var i in returnObj.data.recordList) {\n              returnItem.data.push(returnObj.data.recordList[i][valueName]);\n              var time;\n              if (kpiDef.granularityUnit == \"SECOND\") time = newDateJson(returnObj.data.recordList[i].arisingTime).Format(\"hh:mm:ss\");else time = newDateJson(returnObj.data.recordList[i].arisingTime).Format(\"hh:mm\");\n              returnItem.times.push(time);\n            }\n\n            callback(returnItem);\n          }\n        });\n      };\n\n      resourceUIService.getResourceByIds(nodeIds, function (returnObj) {\n        var model, kpis;\n        kpiQueryModel.nodesDic = returnObj;\n        kpiQueryModel.kpisDic[kpiDef.id] = kpiDef; //        for (var i in returnObj) {\n        //          model = $scope.modelIds[returnObj[i].modelId];\n        //          kpis = model.kpis;\n        //          for (var j in kpiCodes) {\n        //            var kpiId = kpiCodes[j];\n        //            var find = kpis.find(function(el) {\n        //              return el.id == kpiId;\n        //            });\n        //            if (find) {\n        //              kpiQueryModel.kpisDic = find;\n        //            }\n        //          }\n        //        }\n\n        handlerFun([\"kpi\", kpiQueryModel]);\n      });\n      /* June 4th 2016, removed By Leon, coz method getKpisBykpiIds is not avaliable anymore!\n      resourceUIService.getResourceByIds(nodeIds, function(returnObj) {\n        kpiQueryModel.nodesDic = returnObj;\n        if (kpiQueryModel.kpisDic) {\n          handlerFun([\"kpi\", kpiQueryModel]);\n        }\n       });\n      resourceUIService.getKpisByKpiIds(kpiCodes, function(returnObj) {\n        kpiQueryModel.kpisDic = returnObj;\n        if (kpiQueryModel.nodesDic) {\n          handlerFun([\"kpi\", kpiQueryModel]);\n        }\n      });\n      */\n    };\n\n    var initPriceChart = function initPriceChart(returnObj) {\n      var option = {\n        tooltip: {\n          trigger: 'axis'\n        },\n        grid: {\n          x: 35,\n          y: 30,\n          x2: 40,\n          y2: 30\n        },\n        toolbox: {\n          show: false,\n          feature: {\n            mark: {\n              show: true\n            },\n            dataView: {\n              show: true,\n              readOnly: false\n            },\n            magicType: {\n              show: true,\n              type: ['line', 'bar']\n            },\n            restore: {\n              show: true\n            },\n            saveAsImage: {\n              show: true\n            }\n          }\n        },\n        calculable: true,\n        xAxis: [{\n          type: 'category',\n          boundaryGap: false,\n          data: returnObj.times,\n          splitLine: {\n            show: false\n          }\n        }],\n        yAxis: [{\n          type: 'value',\n          scale: true,\n          axisLabel: {\n            formatter: '{value}'\n          },\n          splitLine: {\n            show: false\n          }\n        }],\n        series: [{\n          name: '每公斤',\n          type: 'line',\n          data: returnObj.data,\n          markPoint: {\n            textStyle: {\n              fontSize: 10\n            },\n            data: [{\n              symbolSize: 10,\n              type: 'max',\n              name: '最大值'\n            }, {\n              symbolSize: 10,\n              type: 'min',\n              name: '最小值'\n            }]\n          }\n        }]\n      };\n      $timeout(function () {\n        $scope.$broadcast(Event.ECHARTINFOSINIT, {\n          \"name\": \"priceMain\",\n          \"option\": option\n        });\n      });\n    };\n\n    var getResourceDirectives = function getResourceDirectives(model) {\n      model.directives = [];\n      resourceUIService.getDirectivesByModelId(model.id, function (returnObj) {\n        if (returnObj.code == 0) {\n          model.directives = returnObj.data;\n        }\n\n        ;\n      });\n    };\n\n    var directiveHandler = function directiveHandler() {\n      var sendDeviceDirective = function sendDeviceDirective(param) {\n        param.nodeId = $scope.selectItem.id;\n        param.itemDirValues = {\n          value: param.itemDirValues\n        };\n        resourceUIService.sendDeviceDirective(param.nodeId, Number(param.id), param.itemDirValues, function (returnObj) {\n          if (returnObj.code == 0) {\n            growl.success(\"指令发送成功\", {});\n          }\n        });\n      };\n\n      $scope.$on(\"switchChange\", function (e, param) {\n        sendDeviceDirective(param);\n      });\n    };\n\n    var getNews = function getNews() {\n      var info = Info.get(\"localdb/news.json\", function (info) {\n        $scope.info = info;\n      });\n    };\n\n    var init = function init() {\n      if (viewFlexService.viewLoadFinished && userLoginUIService.user.isAuthenticated) {\n        //202表示大棚服务中心框架，managedByGroups==1表示设备组\n        if (userLoginUIService.user.appData.serviceViewTemplate == 202) {\n          if (userLoginUIService.user.appData.managedByGroup == 0) {\n            $scope.groupModel = false;\n          } else {\n            $scope.groupModel = true;\n          }\n        } else {\n          $scope.groupModel = true;\n        }\n\n        $scope.serviceViewId = userLoginUIService.user.appData.serviceViewTemplate;\n        $scope.camDisp = userLoginUIService.user.appData.serviceViewTemplate == 204;\n        getNews();\n        getAllResource();\n        directiveHandler();\n      }\n    };\n\n    $scope.$on('viewLoadFinished', function () {\n      init();\n    });\n\n    if (!userLoginUIService.user.isAuthenticated) {\n      $scope.$on('loginStatusChanged', function (evt, d) {\n        if (userLoginUIService.user.isAuthenticated) {\n          init();\n        }\n      });\n    } else {\n      init();\n    }\n    /**\n     * 注销scope时注销方法heartBeat，回调函数callback  \n     */\n\n\n    $scope.$on(\"$destroy\", function () {\n      for (var uuid in uuids) {\n        SwSocket.unregister(uuid);\n      }\n    });\n  }]);\n});"],"sourceRoot":"/source/"}